<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é›¶ç¢³å›­åŒºæ•°å­—å­ªç”Ÿç³»ç»Ÿ - ä»£ç è´¨é‡ç›‘æ§ä»ªè¡¨æ¿</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@2.29.3/index.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .header .subtitle {
            color: #666;
            font-size: 1.1em;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .metric-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }
        
        .metric-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .metric-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 1.5em;
        }
        
        .metric-title {
            font-size: 1.1em;
            font-weight: 600;
            color: #333;
        }
        
        .metric-value {
            font-size: 2.5em;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .metric-change {
            font-size: 0.9em;
            display: flex;
            align-items: center;
        }
        
        .metric-change.positive {
            color: #28a745;
        }
        
        .metric-change.negative {
            color: #dc3545;
        }
        
        .metric-change.neutral {
            color: #6c757d;
        }
        
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .chart-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .chart-title {
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 20px;
            color: #333;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
        }
        
        .quality-score {
            position: relative;
            width: 200px;
            height: 200px;
            margin: 0 auto;
        }
        
        .score-circle {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(from 0deg, #28a745 0deg, #28a745 var(--score-deg), #e9ecef var(--score-deg), #e9ecef 360deg);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .score-inner {
            width: 80%;
            height: 80%;
            background: white;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .score-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #333;
        }
        
        .score-label {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }
        
        .recommendations {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        
        .recommendations h2 {
            margin-bottom: 20px;
            color: #333;
        }
        
        .recommendation-item {
            background: #f8f9fa;
            border-left: 4px solid #007bff;
            padding: 15px;
            margin: 10px 0;
            border-radius: 0 8px 8px 0;
        }
        
        .recommendation-item.critical {
            border-left-color: #dc3545;
            background: #fff5f5;
        }
        
        .recommendation-item.high {
            border-left-color: #fd7e14;
            background: #fff8f0;
        }
        
        .recommendation-item.medium {
            border-left-color: #ffc107;
            background: #fffbf0;
        }
        
        .recommendation-priority {
            font-weight: bold;
            font-size: 0.9em;
            text-transform: uppercase;
            margin-bottom: 5px;
        }
        
        .recommendation-message {
            margin-bottom: 10px;
        }
        
        .recommendation-action {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            background: #e9ecef;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 0.9em;
        }
        
        .refresh-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 15px 25px;
            font-size: 1em;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s ease;
        }
        
        .refresh-btn:hover {
            transform: scale(1.05);
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 50px;
            color: #666;
        }
        
        .loading.show {
            display: block;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .last-updated {
            text-align: center;
            color: #666;
            font-size: 0.9em;
            margin-top: 20px;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .metrics-grid {
                grid-template-columns: 1fr;
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ä»£ç è´¨é‡ç›‘æ§ä»ªè¡¨æ¿</h1>
            <p class="subtitle">é›¶ç¢³å›­åŒºæ•°å­—å­ªç”Ÿèƒ½ç¢³ç®¡ç†ç³»ç»Ÿ</p>
        </div>
        
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>æ­£åœ¨åŠ è½½è´¨é‡æ•°æ®...</p>
        </div>
        
        <div id="dashboard" style="display: none;">
            <!-- å…³é”®æŒ‡æ ‡ -->
            <div class="metrics-grid" id="metricsGrid">
                <!-- åŠ¨æ€ç”Ÿæˆ -->
            </div>
            
            <!-- å›¾è¡¨ -->
            <div class="charts-grid">
                <div class="chart-card">
                    <h3 class="chart-title">è´¨é‡è¶‹åŠ¿</h3>
                    <div class="chart-container">
                        <canvas id="qualityTrendChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-card">
                    <h3 class="chart-title">æµ‹è¯•è¦†ç›–ç‡åˆ†å¸ƒ</h3>
                    <div class="chart-container">
                        <canvas id="coverageChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-card">
                    <h3 class="chart-title">ä»£ç è´¨é‡è¯„åˆ†</h3>
                    <div class="chart-container">
                        <div class="quality-score" id="qualityScore">
                            <!-- åŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                </div>
                
                <div class="chart-card">
                    <h3 class="chart-title">é—®é¢˜åˆ†å¸ƒ</h3>
                    <div class="chart-container">
                        <canvas id="issuesChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- æ”¹è¿›å»ºè®® -->
            <div class="recommendations" id="recommendations">
                <h2>ğŸ”§ æ”¹è¿›å»ºè®®</h2>
                <div id="recommendationsList">
                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>
        
        <div class="last-updated" id="lastUpdated">
            <!-- åŠ¨æ€ç”Ÿæˆ -->
        </div>
    </div>
    
    <button class="refresh-btn" onclick="loadDashboard()">
        ğŸ”„ åˆ·æ–°æ•°æ®
    </button>
    
    <script>
        // å…¨å±€å˜é‡
        let qualityData = null;
        let charts = {};
        
        // åŠ è½½ä»ªè¡¨æ¿æ•°æ®
        async function loadDashboard() {
            const loading = document.getElementById('loading');
            const dashboard = document.getElementById('dashboard');
            
            loading.classList.add('show');
            dashboard.style.display = 'none';
            
            try {
                // å°è¯•åŠ è½½è´¨é‡æŠ¥å‘Š
                const response = await fetch('/reports/quality-report.json');
                if (response.ok) {
                    qualityData = await response.json();
                } else {
                    // å¦‚æœæ²¡æœ‰æŠ¥å‘Šæ–‡ä»¶ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
                    qualityData = generateMockData();
                }
                
                renderDashboard();
                
            } catch (error) {
                console.warn('æ— æ³•åŠ è½½è´¨é‡æŠ¥å‘Šï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®:', error);
                qualityData = generateMockData();
                renderDashboard();
            } finally {
                loading.classList.remove('show');
                dashboard.style.display = 'block';
            }
        }
        
        // ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®
        function generateMockData() {
            return {
                timestamp: new Date().toISOString(),
                overall: {
                    score: 85,
                    grade: 'B',
                    status: 'PASS'
                },
                checks: {
                    eslint: { status: 'PASS', score: 90, errors: 0, warnings: 3 },
                    prettier: { status: 'PASS', score: 100 },
                    typescript: { status: 'PASS', score: 95 },
                    tests: { status: 'PASS', score: 82, coverage: { statements: { pct: 82 }, branches: { pct: 78 }, functions: { pct: 85 }, lines: { pct: 83 } } },
                    security: { status: 'PASS', score: 100, vulnerabilities: { high: 0, medium: 0, total: 0 } },
                    dependencies: { status: 'WARN', score: 75, outdated: 3 },
                    complexity: { status: 'PASS', score: 80 },
                    duplication: { status: 'PASS', score: 95 }
                },
                metrics: {
                    linesOfCode: 15420,
                    testCoverage: 82.3,
                    technicalDebt: 2.5,
                    maintainabilityIndex: 78
                },
                recommendations: [
                    {
                        category: 'Test Coverage',
                        priority: 'High',
                        message: 'æé«˜æµ‹è¯•è¦†ç›–ç‡è‡³ 85% ä»¥ä¸Š',
                        action: 'ç¼–å†™æ›´å¤šå•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•'
                    },
                    {
                        category: 'Dependencies',
                        priority: 'Medium',
                        message: 'æ›´æ–° 3 ä¸ªè¿‡æœŸä¾èµ–åŒ…',
                        action: 'npm update'
                    }
                ]
            };
        }
        
        // æ¸²æŸ“ä»ªè¡¨æ¿
        function renderDashboard() {
            renderMetrics();
            renderCharts();
            renderRecommendations();
            updateLastUpdated();
        }
        
        // æ¸²æŸ“å…³é”®æŒ‡æ ‡
        function renderMetrics() {
            const metricsGrid = document.getElementById('metricsGrid');
            
            const metrics = [
                {
                    title: 'æ€»ä½“è´¨é‡åˆ†æ•°',
                    value: qualityData.overall.score,
                    unit: '/100',
                    icon: 'ğŸ¯',
                    color: getScoreColor(qualityData.overall.score),
                    change: '+2.5%'
                },
                {
                    title: 'æµ‹è¯•è¦†ç›–ç‡',
                    value: qualityData.metrics.testCoverage.toFixed(1),
                    unit: '%',
                    icon: 'ğŸ§ª',
                    color: getScoreColor(qualityData.metrics.testCoverage),
                    change: '+1.2%'
                },
                {
                    title: 'ä»£ç è¡Œæ•°',
                    value: qualityData.metrics.linesOfCode.toLocaleString(),
                    unit: '',
                    icon: 'ğŸ“',
                    color: '#007bff',
                    change: '+156'
                },
                {
                    title: 'ESLint é—®é¢˜',
                    value: (qualityData.checks.eslint.errors || 0) + (qualityData.checks.eslint.warnings || 0),
                    unit: '',
                    icon: 'ğŸ”§',
                    color: qualityData.checks.eslint.status === 'PASS' ? '#28a745' : '#dc3545',
                    change: '-2'
                },
                {
                    title: 'å®‰å…¨æ¼æ´',
                    value: qualityData.checks.security.vulnerabilities?.total || 0,
                    unit: '',
                    icon: 'ğŸ”’',
                    color: qualityData.checks.security.vulnerabilities?.total === 0 ? '#28a745' : '#dc3545',
                    change: '0'
                },
                {
                    title: 'æŠ€æœ¯å€ºåŠ¡',
                    value: qualityData.metrics.technicalDebt?.toFixed(1) || '2.5',
                    unit: 'h',
                    icon: 'âš ï¸',
                    color: '#ffc107',
                    change: '-0.3h'
                }
            ];
            
            metricsGrid.innerHTML = metrics.map(metric => `
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-icon" style="background: ${metric.color}20; color: ${metric.color};">
                            ${metric.icon}
                        </div>
                        <div class="metric-title">${metric.title}</div>
                    </div>
                    <div class="metric-value" style="color: ${metric.color};">
                        ${metric.value}<span style="font-size: 0.6em; color: #666;">${metric.unit}</span>
                    </div>
                    <div class="metric-change positive">
                        ğŸ“ˆ ${metric.change}
                    </div>
                </div>
            `).join('');
        }
        
        // æ¸²æŸ“å›¾è¡¨
        function renderCharts() {
            renderQualityTrendChart();
            renderCoverageChart();
            renderQualityScore();
            renderIssuesChart();
        }
        
        // è´¨é‡è¶‹åŠ¿å›¾
        function renderQualityTrendChart() {
            const ctx = document.getElementById('qualityTrendChart').getContext('2d');
            
            if (charts.qualityTrend) {
                charts.qualityTrend.destroy();
            }
            
            // æ¨¡æ‹Ÿå†å²æ•°æ®
            const dates = [];
            const scores = [];
            for (let i = 29; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                dates.push(date.toLocaleDateString('zh-CN'));
                scores.push(Math.floor(Math.random() * 20) + 75); // 75-95 ä¹‹é—´çš„éšæœºåˆ†æ•°
            }
            scores[scores.length - 1] = qualityData.overall.score; // æœ€æ–°åˆ†æ•°
            
            charts.qualityTrend = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'è´¨é‡åˆ†æ•°',
                        data: scores,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 60,
                            max: 100
                        },
                        x: {
                            display: false
                        }
                    }
                }
            });
        }
        
        // æµ‹è¯•è¦†ç›–ç‡å›¾
        function renderCoverageChart() {
            const ctx = document.getElementById('coverageChart').getContext('2d');
            
            if (charts.coverage) {
                charts.coverage.destroy();
            }
            
            const coverage = qualityData.checks.tests.coverage || {};
            
            charts.coverage = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['è¯­å¥', 'åˆ†æ”¯', 'å‡½æ•°', 'è¡Œ'],
                    datasets: [{
                        data: [
                            coverage.statements?.pct || 0,
                            coverage.branches?.pct || 0,
                            coverage.functions?.pct || 0,
                            coverage.lines?.pct || 0
                        ],
                        backgroundColor: [
                            '#28a745',
                            '#17a2b8',
                            '#ffc107',
                            '#6f42c1'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }
        
        // è´¨é‡è¯„åˆ†åœ†ç¯
        function renderQualityScore() {
            const scoreElement = document.getElementById('qualityScore');
            const score = qualityData.overall.score;
            const scoreDeg = (score / 100) * 360;
            
            scoreElement.innerHTML = `
                <div class="score-circle" style="--score-deg: ${scoreDeg}deg; background: conic-gradient(from 0deg, ${getScoreColor(score)} 0deg, ${getScoreColor(score)} ${scoreDeg}deg, #e9ecef ${scoreDeg}deg, #e9ecef 360deg);">
                    <div class="score-inner">
                        <div class="score-value">${score}</div>
                        <div class="score-label">è´¨é‡åˆ†æ•°</div>
                    </div>
                </div>
            `;
        }
        
        // é—®é¢˜åˆ†å¸ƒå›¾
        function renderIssuesChart() {
            const ctx = document.getElementById('issuesChart').getContext('2d');
            
            if (charts.issues) {
                charts.issues.destroy();
            }
            
            charts.issues = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['ESLint', 'TypeScript', 'å®‰å…¨', 'ä¾èµ–', 'å¤æ‚åº¦'],
                    datasets: [{
                        label: 'é—®é¢˜æ•°é‡',
                        data: [
                            (qualityData.checks.eslint.errors || 0) + (qualityData.checks.eslint.warnings || 0),
                            qualityData.checks.typescript.errors || 0,
                            qualityData.checks.security.vulnerabilities?.total || 0,
                            qualityData.checks.dependencies.outdated || 0,
                            0 // å¤æ‚åº¦é—®é¢˜
                        ],
                        backgroundColor: [
                            '#dc3545',
                            '#fd7e14',
                            '#6f42c1',
                            '#ffc107',
                            '#28a745'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        
        // æ¸²æŸ“æ”¹è¿›å»ºè®®
        function renderRecommendations() {
            const recommendationsList = document.getElementById('recommendationsList');
            
            if (!qualityData.recommendations || qualityData.recommendations.length === 0) {
                recommendationsList.innerHTML = '<p style="color: #28a745; text-align: center;">ğŸ‰ å¤ªæ£’äº†ï¼æš‚æ— æ”¹è¿›å»ºè®®ï¼Œä»£ç è´¨é‡è‰¯å¥½ï¼</p>';
                return;
            }
            
            recommendationsList.innerHTML = qualityData.recommendations.map(rec => `
                <div class="recommendation-item ${rec.priority.toLowerCase()}">
                    <div class="recommendation-priority">${rec.priority} - ${rec.category}</div>
                    <div class="recommendation-message">${rec.message}</div>
                    <div class="recommendation-action">${rec.action}</div>
                </div>
            `).join('');
        }
        
        // æ›´æ–°æœ€åæ›´æ–°æ—¶é—´
        function updateLastUpdated() {
            const lastUpdated = document.getElementById('lastUpdated');
            const updateTime = new Date(qualityData.timestamp).toLocaleString('zh-CN');
            lastUpdated.textContent = `æœ€åæ›´æ–°: ${updateTime}`;
        }
        
        // è·å–åˆ†æ•°å¯¹åº”çš„é¢œè‰²
        function getScoreColor(score) {
            if (score >= 90) return '#28a745';
            if (score >= 80) return '#17a2b8';
            if (score >= 70) return '#ffc107';
            if (score >= 60) return '#fd7e14';
            return '#dc3545';
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboard();
            
            // æ¯5åˆ†é’Ÿè‡ªåŠ¨åˆ·æ–°ä¸€æ¬¡
            setInterval(loadDashboard, 5 * 60 * 1000);
        });
    </script>
</body>
</html>