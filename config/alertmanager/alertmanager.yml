global:
  smtp_smarthost: 'localhost:587'
  smtp_from: 'alerts@zero-carbon-system.com'
  smtp_auth_username: 'alerts@zero-carbon-system.com'
  smtp_auth_password: 'your-email-password'
  resolve_timeout: 5m

route:
  group_by: ['alertname', 'cluster', 'service']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 1h
  receiver: 'web.hook'
  routes:
    - match:
        severity: critical
      receiver: 'critical-alerts'
      group_wait: 5s
      repeat_interval: 30m
    - match:
        severity: warning
      receiver: 'warning-alerts'
      repeat_interval: 2h
    - match:
        alertname: 'ServiceDown'
      receiver: 'service-down-alerts'
      group_wait: 5s
      repeat_interval: 15m
    - match:
        alertname: 'HighErrorRate'
      receiver: 'error-rate-alerts'
      repeat_interval: 30m
    - match:
        alertname: 'DataQualityLow'
      receiver: 'data-quality-alerts'
      repeat_interval: 1h

receivers:
  - name: 'web.hook'
    webhook_configs:
      - url: 'http://energy-system:3001/api/alerts/webhook'
        send_resolved: true
        http_config:
          basic_auth:
            username: 'alertmanager'
            password: 'webhook-secret'

  - name: 'critical-alerts'
    email_configs:
      - to: 'admin@zero-carbon-system.com'
        subject: 'ğŸš¨ [CRITICAL] {{ .GroupLabels.alertname }} - é›¶ç¢³å›­åŒºç³»ç»Ÿ'
        body: |
          å‘Šè­¦è¯¦æƒ…:
          {{ range .Alerts }}
          - å‘Šè­¦åç§°: {{ .Annotations.summary }}
          - æè¿°: {{ .Annotations.description }}
          - å®ä¾‹: {{ .Labels.instance }}
          - æœåŠ¡: {{ .Labels.job }}
          - ä¸¥é‡ç¨‹åº¦: {{ .Labels.severity }}
          - å¼€å§‹æ—¶é—´: {{ .StartsAt.Format "2006-01-02 15:04:05" }}
          {{ if .EndsAt }}- ç»“æŸæ—¶é—´: {{ .EndsAt.Format "2006-01-02 15:04:05" }}{{ end }}
          
          {{ end }}
          
          è¯·ç«‹å³å¤„ç†æ­¤å‘Šè­¦ï¼
          
          ç›‘æ§é¢æ¿: http://localhost:3000
          Prometheus: http://localhost:9090
    webhook_configs:
      - url: 'http://energy-system:3001/api/alerts/critical'
        send_resolved: true
    slack_configs:
      - api_url: 'YOUR_SLACK_WEBHOOK_URL'
        channel: '#critical-alerts'
        title: 'ğŸš¨ Critical Alert - {{ .GroupLabels.alertname }}'
        text: |
          {{ range .Alerts }}
          *Alert:* {{ .Annotations.summary }}
          *Description:* {{ .Annotations.description }}
          *Instance:* {{ .Labels.instance }}
          *Severity:* {{ .Labels.severity }}
          {{ end }}

  - name: 'warning-alerts'
    email_configs:
      - to: 'ops@zero-carbon-system.com'
        subject: 'âš ï¸ [WARNING] {{ .GroupLabels.alertname }} - é›¶ç¢³å›­åŒºç³»ç»Ÿ'
        body: |
          å‘Šè­¦è¯¦æƒ…:
          {{ range .Alerts }}
          - å‘Šè­¦åç§°: {{ .Annotations.summary }}
          - æè¿°: {{ .Annotations.description }}
          - å®ä¾‹: {{ .Labels.instance }}
          - æœåŠ¡: {{ .Labels.job }}
          - ä¸¥é‡ç¨‹åº¦: {{ .Labels.severity }}
          - å¼€å§‹æ—¶é—´: {{ .StartsAt.Format "2006-01-02 15:04:05" }}
          {{ end }}
          
          è¯·å…³æ³¨æ­¤å‘Šè­¦çŠ¶æ€ã€‚
    webhook_configs:
      - url: 'http://energy-system:3001/api/alerts/warning'
        send_resolved: true

  - name: 'service-down-alerts'
    email_configs:
      - to: 'admin@zero-carbon-system.com,ops@zero-carbon-system.com'
        subject: 'ğŸ”´ [SERVICE DOWN] {{ .GroupLabels.alertname }} - é›¶ç¢³å›­åŒºç³»ç»Ÿ'
        body: |
          æœåŠ¡ä¸‹çº¿å‘Šè­¦:
          {{ range .Alerts }}
          - æœåŠ¡åç§°: {{ .Labels.job }}
          - å®ä¾‹: {{ .Labels.instance }}
          - ä¸‹çº¿æ—¶é—´: {{ .StartsAt.Format "2006-01-02 15:04:05" }}
          - æè¿°: {{ .Annotations.description }}
          {{ end }}
          
          è¯·ç«‹å³æ£€æŸ¥æœåŠ¡çŠ¶æ€ï¼
    webhook_configs:
      - url: 'http://energy-system:3001/api/alerts/service-down'
        send_resolved: true
    slack_configs:
      - api_url: 'YOUR_SLACK_WEBHOOK_URL'
        channel: '#service-alerts'
        title: 'ğŸ”´ Service Down - {{ .GroupLabels.alertname }}'
        text: |
          {{ range .Alerts }}
          *Service:* {{ .Labels.job }}
          *Instance:* {{ .Labels.instance }}
          *Down Since:* {{ .StartsAt.Format "2006-01-02 15:04:05" }}
          {{ end }}

  - name: 'error-rate-alerts'
    email_configs:
      - to: 'dev@zero-carbon-system.com'
        subject: 'ğŸ“ˆ [HIGH ERROR RATE] {{ .GroupLabels.alertname }} - é›¶ç¢³å›­åŒºç³»ç»Ÿ'
        body: |
          é«˜é”™è¯¯ç‡å‘Šè­¦:
          {{ range .Alerts }}
          - æœåŠ¡: {{ .Labels.job }}
          - å®ä¾‹: {{ .Labels.instance }}
          - é”™è¯¯ç‡: {{ .Annotations.value }}
          - é˜ˆå€¼: {{ .Annotations.threshold }}
          - å¼€å§‹æ—¶é—´: {{ .StartsAt.Format "2006-01-02 15:04:05" }}
          {{ end }}
          
          è¯·æ£€æŸ¥åº”ç”¨æ—¥å¿—å’Œæ€§èƒ½æŒ‡æ ‡ã€‚
    webhook_configs:
      - url: 'http://energy-system:3001/api/alerts/error-rate'
        send_resolved: true

  - name: 'data-quality-alerts'
    email_configs:
      - to: 'data@zero-carbon-system.com'
        subject: 'ğŸ“Š [DATA QUALITY] {{ .GroupLabels.alertname }} - é›¶ç¢³å›­åŒºç³»ç»Ÿ'
        body: |
          æ•°æ®è´¨é‡å‘Šè­¦:
          {{ range .Alerts }}
          - æ•°æ®æº: {{ .Labels.datasource }}
          - è´¨é‡è¯„åˆ†: {{ .Annotations.score }}
          - é˜ˆå€¼: {{ .Annotations.threshold }}
          - å½±å“èŒƒå›´: {{ .Annotations.impact }}
          - å¼€å§‹æ—¶é—´: {{ .StartsAt.Format "2006-01-02 15:04:05" }}
          {{ end }}
          
          è¯·æ£€æŸ¥æ•°æ®ç®¡é“å’Œæ•°æ®æºã€‚
    webhook_configs:
      - url: 'http://energy-system:3001/api/alerts/data-quality'
        send_resolved: true

inhibit_rules:
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['alertname', 'instance']
  - source_match:
      alertname: 'ServiceDown'
    target_match_re:
      alertname: '(HighLatency|HighErrorRate)'
    equal: ['instance']

templates:
  - '/etc/alertmanager/templates/*.tmpl'

# å‘Šè­¦æŠ‘åˆ¶é…ç½®
# å½“åŒä¸€å®ä¾‹çš„criticalå‘Šè­¦è§¦å‘æ—¶ï¼ŒæŠ‘åˆ¶warningå‘Šè­¦
# å½“æœåŠ¡ä¸‹çº¿æ—¶ï¼ŒæŠ‘åˆ¶è¯¥æœåŠ¡çš„å…¶ä»–æ€§èƒ½å‘Šè­¦