# é›¶ç¢³å›­åŒºæ•°å­—å­ªç”Ÿç³»ç»Ÿåç«¯

## é¡¹ç›®ç®€ä»‹

é›¶ç¢³å›­åŒºæ•°å­—å­ªç”Ÿç³»ç»Ÿæ˜¯ä¸€ä¸ªåŸºäºSpring Bootçš„ä¼ä¸šçº§åç«¯åº”ç”¨ï¼Œä¸“æ³¨äºæä¾›å®Œæ•´çš„ç”¨æˆ·ç®¡ç†ã€æƒé™æ§åˆ¶ã€æ•°æ®å®‰å…¨å’Œç³»ç»Ÿç›‘æ§åŠŸèƒ½ã€‚ç³»ç»Ÿé‡‡ç”¨ç°ä»£åŒ–çš„å¾®æœåŠ¡æ¶æ„è®¾è®¡ï¼Œå…·å¤‡é«˜æ€§èƒ½ã€é«˜å¯ç”¨ã€é«˜å®‰å…¨æ€§çš„ç‰¹ç‚¹ã€‚

## æŠ€æœ¯æ ˆ

### æ ¸å¿ƒæ¡†æ¶
- **Spring Boot 2.7.x** - åº”ç”¨æ¡†æ¶
- **Spring Security** - å®‰å…¨æ¡†æ¶
- **Spring Data JPA** - æ•°æ®è®¿é—®å±‚
- **Spring Cache** - ç¼“å­˜æŠ½è±¡
- **Spring Scheduling** - å®šæ—¶ä»»åŠ¡

### æ•°æ®åº“
- **MySQL 8.0** - ä¸»æ•°æ®åº“
- **HikariCP** - è¿æ¥æ± 
- **Hibernate** - ORMæ¡†æ¶

### ç¼“å­˜
- **Caffeine** - æœ¬åœ°ç¼“å­˜
- **Redis** - åˆ†å¸ƒå¼ç¼“å­˜ï¼ˆå¯é€‰ï¼‰

### å®‰å…¨è®¤è¯
- **JWT** - ä»¤ç‰Œè®¤è¯
- **BCrypt** - å¯†ç åŠ å¯†

### æ–‡æ¡£å·¥å…·
- **Swagger/OpenAPI 3** - APIæ–‡æ¡£
- **Knife4j** - APIæ–‡æ¡£å¢å¼º

### å·¥å…·åº“
- **Hutool** - Javaå·¥å…·åº“
- **Fastjson** - JSONå¤„ç†
- **MapStruct** - å¯¹è±¡æ˜ å°„
- **Guava** - Googleå·¥å…·åº“

### ç›‘æ§è¿ç»´
- **Spring Boot Actuator** - åº”ç”¨ç›‘æ§
- **Micrometer** - æŒ‡æ ‡æ”¶é›†
- **Logback** - æ—¥å¿—æ¡†æ¶

## åŠŸèƒ½ç‰¹æ€§

### ğŸ” å®‰å…¨ç®¡ç†
- **ç”¨æˆ·ç®¡ç†**ï¼šç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€å¯†ç ç­–ç•¥ã€è´¦æˆ·é”å®š
- **è§’è‰²ç®¡ç†**ï¼šè§’è‰²åˆ›å»ºã€æƒé™åˆ†é…ã€è§’è‰²ç»§æ‰¿
- **æƒé™ç®¡ç†**ï¼šæƒé™å®šä¹‰ã€æƒé™æ ‘ã€åŠ¨æ€æƒé™æ£€æŸ¥
- **æ•°æ®æƒé™**ï¼šæ•°æ®çº§æƒé™æ§åˆ¶ã€å­—æ®µæƒé™ã€æ•°æ®è„±æ•

### ğŸ”‘ è®¤è¯æˆæƒ
- **JWTè®¤è¯**ï¼šæ— çŠ¶æ€ä»¤ç‰Œè®¤è¯
- **ä¼šè¯ç®¡ç†**ï¼šä¼šè¯åˆ›å»ºã€è¶…æ—¶ã€å¹¶å‘æ§åˆ¶
- **å•ç‚¹ç™»å½•**ï¼šç»Ÿä¸€è®¤è¯å…¥å£
- **å¤šç«¯æ”¯æŒ**ï¼šWebã€ç§»åŠ¨ç«¯ã€API

### ğŸ“Š å®¡è®¡ç›‘æ§
- **ç™»å½•æ—¥å¿—**ï¼šç™»å½•æˆåŠŸ/å¤±è´¥è®°å½•ã€IPè¿½è¸ª
- **æ“ä½œæ—¥å¿—**ï¼šç”¨æˆ·æ“ä½œå®¡è®¡ã€æ•°æ®å˜æ›´è®°å½•
- **å®‰å…¨ç»Ÿè®¡**ï¼šç™»å½•è¶‹åŠ¿ã€é£é™©åˆ†æã€å¼‚å¸¸æ£€æµ‹
- **ç³»ç»Ÿç›‘æ§**ï¼šæ€§èƒ½æŒ‡æ ‡ã€å¥åº·æ£€æŸ¥ã€å‘Šè­¦é€šçŸ¥

### âš¡ æ€§èƒ½ä¼˜åŒ–
- **å¤šçº§ç¼“å­˜**ï¼šæœ¬åœ°ç¼“å­˜ + åˆ†å¸ƒå¼ç¼“å­˜
- **å¼‚æ­¥å¤„ç†**ï¼šå¼‚æ­¥ä»»åŠ¡ã€äº‹ä»¶é©±åŠ¨
- **è¿æ¥æ± **ï¼šæ•°æ®åº“è¿æ¥æ± ä¼˜åŒ–
- **æ‰¹é‡æ“ä½œ**ï¼šæ‰¹é‡æ’å…¥ã€æ›´æ–°ä¼˜åŒ–

### ğŸ›  è¿ç»´æ”¯æŒ
- **å®šæ—¶ä»»åŠ¡**ï¼šæ•°æ®æ¸…ç†ã€ç»Ÿè®¡æ›´æ–°ã€å¥åº·æ£€æŸ¥
- **é…ç½®ç®¡ç†**ï¼šå¤šç¯å¢ƒé…ç½®ã€åŠ¨æ€é…ç½®
- **æ—¥å¿—ç®¡ç†**ï¼šç»“æ„åŒ–æ—¥å¿—ã€æ—¥å¿—è½®è½¬
- **é”™è¯¯å¤„ç†**ï¼šå…¨å±€å¼‚å¸¸å¤„ç†ã€å‹å¥½é”™è¯¯æç¤º

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- **JDK 8+**
- **Maven 3.6+**
- **MySQL 8.0+**
- **Redis 6.0+**ï¼ˆå¯é€‰ï¼‰

### å®‰è£…æ­¥éª¤

1. **å…‹éš†é¡¹ç›®**
```bash
git clone https://github.com/zerocarbon/digital-twin-backend.git
cd digital-twin-backend
```

2. **é…ç½®æ•°æ®åº“**
```sql
-- åˆ›å»ºæ•°æ®åº“
CREATE DATABASE zero_carbon_digital_twin CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- åˆ›å»ºç”¨æˆ·ï¼ˆå¯é€‰ï¼‰
CREATE USER 'zerocarbon'@'localhost' IDENTIFIED BY 'your_password';
GRANT ALL PRIVILEGES ON zero_carbon_digital_twin.* TO 'zerocarbon'@'localhost';
FLUSH PRIVILEGES;
```

3. **ä¿®æ”¹é…ç½®æ–‡ä»¶**
```yaml
# application-dev.yml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/zero_carbon_digital_twin?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai
    username: zerocarbon
    password: your_password
```

4. **ç¼–è¯‘è¿è¡Œ**
```bash
# ç¼–è¯‘é¡¹ç›®
mvn clean compile

# è¿è¡Œé¡¹ç›®
mvn spring-boot:run

# æˆ–è€…æ‰“åŒ…åè¿è¡Œ
mvn clean package
java -jar target/zero-carbon-digital-twin-1.0.0.jar
```

5. **è®¿é—®åº”ç”¨**
- **åº”ç”¨åœ°å€**ï¼šhttp://localhost:8080
- **APIæ–‡æ¡£**ï¼šhttp://localhost:8080/swagger-ui/
- **ç›‘æ§ç«¯ç‚¹**ï¼šhttp://localhost:8080/actuator

### é»˜è®¤è´¦æˆ·

ç³»ç»Ÿå¯åŠ¨åä¼šè‡ªåŠ¨åˆ›å»ºé»˜è®¤ç®¡ç†å‘˜è´¦æˆ·ï¼š

- **ç”¨æˆ·å**ï¼šadmin
- **å¯†ç **ï¼šadmin123
- **è§’è‰²**ï¼šè¶…çº§ç®¡ç†å‘˜

> âš ï¸ **å®‰å…¨æç¤º**ï¼šç”Ÿäº§ç¯å¢ƒè¯·ç«‹å³ä¿®æ”¹é»˜è®¤å¯†ç ï¼

## APIæ–‡æ¡£

### è®¤è¯ç›¸å…³

#### ç”¨æˆ·ç™»å½•
```http
POST /api/auth/login
Content-Type: application/json

{
  "username": "admin",
  "password": "admin123"
}
```

#### åˆ·æ–°ä»¤ç‰Œ
```http
POST /api/auth/refresh
Authorization: Bearer {refresh_token}
```

#### è·å–ç”¨æˆ·ä¿¡æ¯
```http
GET /api/auth/profile
Authorization: Bearer {access_token}
```

### ç”¨æˆ·ç®¡ç†

#### åˆ›å»ºç”¨æˆ·
```http
POST /api/security/users
Authorization: Bearer {access_token}
Content-Type: application/json

{
  "username": "testuser",
  "password": "password123",
  "email": "test@example.com",
  "realName": "æµ‹è¯•ç”¨æˆ·"
}
```

#### æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨
```http
GET /api/security/users?page=0&size=10&sort=createTime,desc
Authorization: Bearer {access_token}
```

æ›´å¤šAPIè¯¦æƒ…è¯·æŸ¥çœ‹ï¼š[Swaggeræ–‡æ¡£](http://localhost:8080/swagger-ui/)

## é…ç½®è¯´æ˜

### åº”ç”¨é…ç½®

```yaml
app:
  system:
    name: é›¶ç¢³å›­åŒºæ•°å­—å­ªç”Ÿç³»ç»Ÿ
    version: 1.0.0
    description: é›¶ç¢³å›­åŒºæ•°å­—å­ªç”Ÿç³»ç»Ÿåç«¯API
  
  security:
    jwt:
      secret: your-jwt-secret-key
      accessTokenExpiration: 3600000    # 1å°æ—¶
      refreshTokenExpiration: 604800000  # 7å¤©
    
    password:
      minLength: 8
      requireUppercase: true
      requireLowercase: true
      requireDigits: true
      requireSpecialChars: true
      expirationDays: 90
    
    account:
      maxLoginAttempts: 5
      lockoutDuration: 1800000  # 30åˆ†é’Ÿ
      autoUnlock: true
    
    session:
      timeout: 7200000           # 2å°æ—¶
      maxConcurrentSessions: 3
      cleanupInterval: 300000    # 5åˆ†é’Ÿ
```

### æ•°æ®åº“é…ç½®

```yaml
spring:
  datasource:
    type: com.zaxxer.hikari.HikariDataSource
    hikari:
      minimum-idle: 5
      maximum-pool-size: 20
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
      leak-detection-threshold: 60000
```

### ç¼“å­˜é…ç½®

```yaml
spring:
  cache:
    type: caffeine
    caffeine:
      spec: maximumSize=1000,expireAfterWrite=30m
```

## éƒ¨ç½²æŒ‡å—

### Dockeréƒ¨ç½²

1. **æ„å»ºé•œåƒ**
```bash
# ä½¿ç”¨Mavenæ’ä»¶æ„å»º
mvn clean package docker:build

# æˆ–ä½¿ç”¨Dockerfile
docker build -t zero-carbon-digital-twin:1.0.0 .
```

2. **è¿è¡Œå®¹å™¨**
```bash
docker run -d \
  --name zero-carbon-backend \
  -p 8080:8080 \
  -e SPRING_PROFILES_ACTIVE=prod \
  -e DB_HOST=mysql-server \
  -e DB_USERNAME=zerocarbon \
  -e DB_PASSWORD=your_password \
  zero-carbon-digital-twin:1.0.0
```

### Docker Composeéƒ¨ç½²

```yaml
version: '3.8'
services:
  app:
    image: zero-carbon-digital-twin:1.0.0
    ports:
      - "8080:8080"
    environment:
      - SPRING_PROFILES_ACTIVE=prod
      - DB_HOST=mysql
      - DB_USERNAME=zerocarbon
      - DB_PASSWORD=your_password
    depends_on:
      - mysql
      - redis
  
  mysql:
    image: mysql:8.0
    environment:
      - MYSQL_ROOT_PASSWORD=root_password
      - MYSQL_DATABASE=zero_carbon_digital_twin
      - MYSQL_USER=zerocarbon
      - MYSQL_PASSWORD=your_password
    volumes:
      - mysql_data:/var/lib/mysql
  
  redis:
    image: redis:6.2-alpine
    volumes:
      - redis_data:/data

volumes:
  mysql_data:
  redis_data:
```

### ç”Ÿäº§ç¯å¢ƒé…ç½®

```yaml
# application-prod.yml
spring:
  datasource:
    url: jdbc:mysql://${DB_HOST:localhost}:${DB_PORT:3306}/${DB_NAME:zero_carbon_digital_twin}?useUnicode=true&characterEncoding=utf8&useSSL=true&serverTimezone=Asia/Shanghai
    username: ${DB_USERNAME:zerocarbon}
    password: ${DB_PASSWORD}
  
  jpa:
    hibernate:
      ddl-auto: validate  # ç”Ÿäº§ç¯å¢ƒä½¿ç”¨validate
    show-sql: false

logging:
  level:
    com.zerocarbon: INFO
    org.springframework.security: WARN
  file:
    name: /var/log/zero-carbon/application.log

app:
  security:
    jwt:
      secret: ${JWT_SECRET}
  audit:
    retentionDays: 365  # ç”Ÿäº§ç¯å¢ƒä¿ç•™1å¹´
```

## ç›‘æ§è¿ç»´

### å¥åº·æ£€æŸ¥

```bash
# åº”ç”¨å¥åº·çŠ¶æ€
curl http://localhost:8080/actuator/health

# è¯¦ç»†å¥åº·ä¿¡æ¯
curl http://localhost:8080/actuator/health/details
```

### æ€§èƒ½æŒ‡æ ‡

```bash
# JVMæŒ‡æ ‡
curl http://localhost:8080/actuator/metrics/jvm.memory.used

# æ•°æ®åº“è¿æ¥æ± æŒ‡æ ‡
curl http://localhost:8080/actuator/metrics/hikaricp.connections.active

# ç¼“å­˜æŒ‡æ ‡
curl http://localhost:8080/actuator/metrics/cache.gets
```

### æ—¥å¿—ç®¡ç†

```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
tail -f /var/log/zero-carbon/application.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
grep "ERROR" /var/log/zero-carbon/application.log

# æŸ¥çœ‹ç™»å½•æ—¥å¿—
grep "LOGIN" /var/log/zero-carbon/application.log
```

## å¼€å‘æŒ‡å—

### é¡¹ç›®ç»“æ„

```
src/main/java/com/zerocarbon/
â”œâ”€â”€ config/              # é…ç½®ç±»
â”‚   â”œâ”€â”€ DatabaseConfig.java
â”‚   â”œâ”€â”€ SecurityConfig.java
â”‚   â”œâ”€â”€ CacheConfig.java
â”‚   â””â”€â”€ SwaggerConfig.java
â”œâ”€â”€ controller/          # æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ AuthController.java
â”‚   â””â”€â”€ SecurityController.java
â”œâ”€â”€ service/            # æœåŠ¡å±‚
â”‚   â”œâ”€â”€ UserService.java
â”‚   â”œâ”€â”€ RoleService.java
â”‚   â””â”€â”€ PermissionService.java
â”œâ”€â”€ entity/             # å®ä½“ç±»
â”œâ”€â”€ repository/         # æ•°æ®è®¿é—®å±‚
â”œâ”€â”€ security/           # å®‰å…¨ç›¸å…³
â”‚   â”œâ”€â”€ JwtAuthenticationFilter.java
â”‚   â””â”€â”€ JwtAuthenticationEntryPoint.java
â”œâ”€â”€ exception/          # å¼‚å¸¸å¤„ç†
â”‚   â”œâ”€â”€ GlobalExceptionHandler.java
â”‚   â””â”€â”€ BusinessException.java
â””â”€â”€ ZeroCarbonDigitalTwinApplication.java
```

### ä»£ç è§„èŒƒ

1. **å‘½åè§„èŒƒ**
   - ç±»åï¼šå¤§é©¼å³°å‘½åæ³•ï¼ˆPascalCaseï¼‰
   - æ–¹æ³•åï¼šå°é©¼å³°å‘½åæ³•ï¼ˆcamelCaseï¼‰
   - å¸¸é‡ï¼šå…¨å¤§å†™ä¸‹åˆ’çº¿åˆ†éš”ï¼ˆUPPER_SNAKE_CASEï¼‰

2. **æ³¨é‡Šè§„èŒƒ**
   - ç±»å’Œæ–¹æ³•å¿…é¡»æœ‰JavaDocæ³¨é‡Š
   - å¤æ‚é€»è¾‘å¿…é¡»æœ‰è¡Œå†…æ³¨é‡Š
   - æ³¨é‡Šå†…å®¹è¦å‡†ç¡®ã€ç®€æ´

3. **å¼‚å¸¸å¤„ç†**
   - ä½¿ç”¨ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†æœºåˆ¶
   - ä¸šåŠ¡å¼‚å¸¸ä½¿ç”¨BusinessException
   - è®°å½•è¯¦ç»†çš„é”™è¯¯æ—¥å¿—

### æµ‹è¯•æŒ‡å—

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
mvn test

# è¿è¡Œç‰¹å®šæµ‹è¯•ç±»
mvn test -Dtest=UserServiceTest

# ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
mvn test jacoco:report
```

## å¸¸è§é—®é¢˜

### Q: å¯åŠ¨æ—¶æ•°æ®åº“è¿æ¥å¤±è´¥ï¼Ÿ
A: è¯·æ£€æŸ¥æ•°æ®åº“é…ç½®å’Œç½‘ç»œè¿æ¥ï¼Œç¡®ä¿MySQLæœåŠ¡æ­£å¸¸è¿è¡Œã€‚

### Q: JWTä»¤ç‰ŒéªŒè¯å¤±è´¥ï¼Ÿ
A: æ£€æŸ¥JWTå¯†é’¥é…ç½®ï¼Œç¡®ä¿å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä½¿ç”¨ç›¸åŒçš„å¯†é’¥ã€‚

### Q: æƒé™éªŒè¯ä¸ç”Ÿæ•ˆï¼Ÿ
A: ç¡®è®¤ç”¨æˆ·è§’è‰²å’Œæƒé™é…ç½®æ­£ç¡®ï¼Œæ£€æŸ¥Spring Securityé…ç½®ã€‚

### Q: ç¼“å­˜ä¸ç”Ÿæ•ˆï¼Ÿ
A: æ£€æŸ¥ç¼“å­˜é…ç½®å’Œæ³¨è§£ä½¿ç”¨ï¼Œç¡®ä¿æ–¹æ³•æ˜¯publicä¸”è¢«Springç®¡ç†ã€‚

### Q: å®šæ—¶ä»»åŠ¡ä¸æ‰§è¡Œï¼Ÿ
A: ç¡®è®¤@EnableSchedulingæ³¨è§£å·²æ·»åŠ ï¼Œæ£€æŸ¥cronè¡¨è¾¾å¼æ ¼å¼ã€‚

## è´¡çŒ®æŒ‡å—

1. Forké¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. åˆ›å»ºPull Request

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## è”ç³»æˆ‘ä»¬

- **é¡¹ç›®ä¸»é¡µ**ï¼šhttps://github.com/zerocarbon/digital-twin-backend
- **æŠ€æœ¯æ”¯æŒ**ï¼šadmin@zerocarbon.com
- **é—®é¢˜åé¦ˆ**ï¼šhttps://github.com/zerocarbon/digital-twin-backend/issues

---

**Zero Carbon Team** Â© 2024