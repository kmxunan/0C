# 质量保证

## 1. 代码质量规范

### 1.1 开发实施规范
- 当npm安装MQTT依赖失败时，可以改用系统包管理器安装MQTT Broker
- 实时数据采集模块需要确保数据采集延迟不超过5秒的要求
- 使用MQTT协议实现实时数据传输时，需要先启动MQTT服务再启动主应用服务
- 在添加安全增强功能前，应确保所有必需的依赖库已经正确安装
- 发现依赖漏洞时，使用`npm audit fix --force`命令强制修复高危漏洞
- 对于特定的安全验证功能（如express-validator），需要单独安装对应的依赖包
- 安全增强功能应包括HTTP安全头设置、API请求速率限制、数据格式验证和错误处理机制改进

## 2. 性能要求

### 2.1 系统性能指标
- 实时数据延迟 ≤1秒
- API响应时间 ≤200ms (95%请求)
- 3D场景渲染 45-60 FPS
- 并发用户支持 ≥100用户
- 内存使用 ≤512MB

### 2.2 模块加载规范
- 系统优化时应优先修复模块加载顺序问题
- 在Node.js项目中应避免ESM和CommonJS混用，建议统一使用CommonJS格式以保持兼容性
- 当遇到模块加载问题时，需要仔细检查模块的导出和导入方式是否正确
- 修复模块导入顺序问题时，应确保先定义再使用的原则
- 处理模块导出问题时，需要确保所有需要的变量和函数都被正确导出
- 在大型项目中添加新功能模块时，应先进行模块依赖分析，确保模块导入位置合理

## 3. 测试规范

### 3.1 单元测试
- 所有新功能必须包含单元测试
- 使用Jest作为测试框架
- 单元测试覆盖率应达到85%以上

### 3.2 集成测试
- 编写API集成测试
- 测试模块间的交互
- 验证数据库操作正确性

### 3.3 压力测试
- 压力测试应包含以下核心指标：总请求数、并发用户数、每秒请求数、平均响应时间、失败请求数
- 测试结果必须记录系统资源使用情况（CPU、内存、连接数）
- 压力测试后必须生成详细的测试报告并提供优化建议

## 4. 安全规范

### 4.1 安全开发规范
- 安全功能开发必须包含用户权限管理模块，实现基于角色的访问控制(RBAC)
- 权限管理模块应定义明确的角色体系(如管理员、能源管理员、查看者等)
- 关键API必须添加权限检查中间件，实现细粒度的权限控制
- 安全功能开发需遵循统一的错误处理机制
- 必须设置CORS策略，明确允许的源
- 示例：`origin: process.env.FRONTEND_URL || 'https://zerocarbonpark.com'`
- 实施速率限制（如15分钟100次请求）
- 添加IP白名单/黑名单机制
- 所有新开发的功能模块必须进行压力测试验证实时性要求