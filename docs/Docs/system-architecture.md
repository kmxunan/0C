# 系统架构设计

## 1. 整体架构

本系统采用分层架构设计，包含以下层级：
- **感知层**：负责能源设备数据采集
- **网络层**：实现数据传输与通信
- **平台层**：提供数据处理与分析服务
- **应用层**：实现业务功能与用户交互

## 2. 技术架构

### 2.1 架构图
```
+---------------------+
|      用户界面层       |
|  (React + Three.js) |
+----------+----------+
           |
+----------v----------+
|     业务逻辑层       |
|   (Node.js Express)  |
+----------+----------+
           |
+----------v----------+
|     数据访问层       |
| SQLite/MongoDB/Redis |
+----------+----------+
           |
+----------v----------+
|    物联网数据层      |
|   MQTT (Mosquitto)   |
+---------------------+
```

## 3. 核心组件交互

### 3.1 组件交互流程
1. 前端通过WebSocket与后端保持实时通信
2. 后端通过MQTT接收传感器数据并转发给前端
3. 数据库负责持久化存储和查询
4. Redis缓存热点数据以提升性能
5. AI模型在客户端或服务器端执行预测任务

## 4. 技术选型

### 4.1 前端技术栈
- React v18+
- Three.js, @react-three/fiber, @react-three/drei
- Zustand
- Material-UI v5
- WebSocket + Socket.io

### 4.2 后端技术栈
- Node.js v16.x
- Express.js
- SQLite, MongoDB
- Knex.js
- MQTT (Mosquitto)
- Redis

## 5. 设计模式

- 微服务架构：模块化服务设计，便于扩展和维护
- 分层架构：清晰划分表现层、业务逻辑层、数据访问层
- 消息队列模式：使用MQTT实现异步通信和解耦
- 单例模式：用于数据库连接和全局配置管理
- 工厂模式：用于创建复杂对象和服务实例
- 观察者模式：用于事件监听和响应机制