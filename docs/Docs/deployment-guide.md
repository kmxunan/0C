# 部署手册

## 1. 环境准备

### 1.1 生产环境配置
- 使用专用的配置文件（如.env.prod）进行配置
- 配置环境变量通过.env文件管理
- 敏感数据应通过secret管理

## 2. Docker部署

### 2.1 部署要求
- 健康检查机制：提供GET /health端点
- 容器间网络：配置自定义网络
- 数据持久化：使用命名卷
- 资源限制：设置内存和CPU限制
- 自动重启策略：配置重启策略
- 日志驱动：配置日志驱动和轮转

### 2.2 部署步骤
```bash
# 使用Docker Compose一键部署
docker-compose up -d

# 或者使用部署脚本
./deploy.sh
```

## 3. 配置要求

### 3.1 Mosquitto配置
- 独立配置目录
- 安全设置

### 3.2 Nginx配置
- 反向代理设置
- SSL配置

## 4. 监控与维护

### 4.1 健康检查
- 提供GET /health端点
- 返回状态：healthy/degraded/unhealthy
- 包含时间戳信息

### 4.2 组件检查
- 数据库连接状态检查
- 内存使用监控（单位MB）
- CPU负载检测
- 网络延迟测试

## 5. 安全加固

### 5.1 安全策略
- 设置CORS策略：`origin: process.env.FRONTEND_URL || 'https://zerocarbonpark.com'`
- 实施速率限制（如15分钟100次请求）
- 添加IP白名单/黑名单机制
- 实现基于JWT的用户认证
- 实施RBAC权限控制系统

## 6. 常见问题排查

### 6.1 典型问题及解决方法
| 问题现象 | 可能原因 | 解决方案 |
|----------|----------|----------|
| 服务启动失败 | 端口冲突 | 检查端口占用情况 |
| 数据采集延迟过高 | 网络问题 | 检查MQTT连接状态 |
| API响应缓慢 | 数据库性能问题 | 优化查询语句 |
| 页面加载缓慢 | 前端资源过大 | 优化前端打包 |
| 登录失败 | JWT过期 | 检查令牌有效期配置 |