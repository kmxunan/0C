虚拟电厂与电力交易模块深化开发需求规格说明书
版本: 1.0
日期: 2025年7月8日
关联文档: 《零碳园区数字孪生系统升级开发需求说明书 V1.0》

# 虚拟电厂与电力交易模块深化开发需求规格说明书

版本: 1.0
日期: 2025年7月8日
关联文档: 《零碳园区数字孪生系统升级开发需求说明书 V1.0》

## 1. 总体目标
本次深化开发旨在将现有的“虚拟电厂运营与交易中心”模块，从概念框架阶段推进至可商业化运营的实操阶段。升级后的模块需具备高度的可配置性和智能化，不仅要满足安宁产业园区的特定需求，还必须能够作为一套标准化的解决方案，灵活适配不同基础设施和市场环境的零碳园区。

核心目标是实现以下三点：

- **资源聚合的标准化**：建立一套灵活的资源接入和管理体系，能快速将不同类型的分布式资源（DERs）聚合成虚拟电厂（VPP）。
- **交易策略的可视化配置**：提供一个用户友好的策略中心，允许非技术人员通过图形化界面配置和管理复杂的电力交易策略。
- **交易决策的智能化**：集成并应用AI算法，实现基于市场预测和风险评估的自动化、最优化报价与调度。

## 2. 功能需求详述

### 2.1 资源聚合与管理中心 (VPP Resource Hub)
此为VPP的基础。目标是实现对园区内所有可调控资源的"即插即用"式管理。

#### 2.1.1 可调控资源模板库

需求描述：系统需预置一个"资源模板库"，包含典型的分布式能源和可调负荷类型。每个模板定义了该类资源的核心技术参数和控制指令。

**预置模板示例**：

| 资源类型       | 核心参数                                                                 | 控制指令接口        |
|----------------|------------------------------------------------------------------------|--------------------|
| 光伏发电       | 额定功率、逆变器效率、功率预测API接口                                  | /api/v1/pv-control |
| 磷酸铁锂储能   | 额定功率/容量、充放电效率、SOC上下限、BMS控制协议                    | /api/v1/ess-control|
| 压缩空气储能   | 技术参数同上，但模型不同                                              | /api/v1/caes-control|
| 可中断工业负荷 | 额定功率、可中断时长、中断响应时间、中断补偿成本                      | /api/v1/load-control|
| 电动汽车充电桩 | 总功率、有序充电调节能力、V2G能力                                     | /api/v1/ev-control |

**关键功能**：允许园区管理员自定义和扩展资源模板，以适应未来出现的新技术或特定设备。

#### 2.1.2 资源实例管理

需求描述：园区管理员可通过选择模板，快速注册和实例化具体的物理资源。例如，从"磷酸铁锂储能"模板创建一个名为"1号厂房用户侧储能"的实例，并填入其具体的IP地址、容量、BMS接口等信息。

**可视化**：在数字孪生3D地图上，将实例化的资源与具体的建筑或位置进行挂接，并实时显示其运行状态（功率、SOC等）。

#### 2.1.3 虚拟电厂（VPP）聚合管理

需求描述：允许管理员通过"拖拽"或"勾选"的方式，将多个资源实例聚合成一个或多个虚拟电厂（VPP）。

**功能特性**：

1. 资源复用机制：一个资源可被多个VPP复用（如储能同时参与调峰和调频VPP）
2. 实时聚合计算：展示每个VPP的总可调功率（上调/下调）、可调容量、响应时间等参数
3. 策略实体化：VPP可作为独立实体用于后续的策略配置和市场交易

### 2.2 电力市场与交易策略中心 (Trading Strategy Hub)
此为VPP的智能中枢。目标是让运营人员可以灵活地"排兵布阵"。

#### 2.2.1 电力市场连接器

需求描述：系统需支持可配置的"市场连接器"，以对接不同区域的电力市场。

**配置参数**：

- 市场类型：现货市场、辅助服务市场等
- 交易周期：日前、日内、实时
- 报价截止时间：市场规则定义
- 结算规则：符合国家电力市场规范
- API接口地址：符合RESTful规范的接口定义

**实施优先级**：

- 优先实现云南省电力市场对接
- 支持共享储能容量租赁和调频辅助服务市场

#### 2.2.2 交易策略编辑器

需求描述：提供可视化策略编辑器，支持两类策略管理：

##### A. 规则驱动策略 (Rule-Based)

- **触发器**：基于时间、市场价格、VPP状态等条件
  - 示例：`电价 > 0.8元/kWh`，`储能SOC < 20%`
- **条件逻辑**：支持"与/或"组合
  - 示例：`(电价 > 0.8) AND (SOC > 90%)`
- **执行动作**：放电、报价、调整功率等操作
- **UI实现**：参考IFTTT的图形化配置界面

##### B. AI驱动策略 (AI-Powered)

**需求描述**：支持AI模型封装注册和策略管理

- **输入接口**：
  - 未来24小时负荷预测曲线
  - 电价预测曲线
  - 天气预测数据
  - 当前VPP资源状态池

- **输出接口**：
  - 储能充放电计划曲线
  - 分时段报价策略（报价、报量）

- **模型管理**：
  - 版本管理
  - 上线/下线控制
  - A/B测试支持

#### 2.2.3 策略回测与仿真

需求描述：在策略正式上线前，必须提供历史数据回测功能。

**核心功能**：

1. 时间范围选择：支持任意历史时间段回测
2. 多维报告输出：
   - 模拟交易盈亏分析
   - 策略执行成功率
   - 与理想最优情况的对比
   - 风险指标评估

### 2.3 交易执行与结算中心 (Execution & Settlement Hub)
此为VPP的执行中枢。目标是确保交易指令的准确执行和事后分析。

#### 2.3.1 自动化交易执行引擎

需求描述：根据策略自动生成报价单并按时提交，支持闭环控制。

**核心功能**：

- 实时指令分解：将市场调度指令分解到各个资源实例
- 执行监控：通过数据接口监测指令执行情况
- 偏差告警：对未执行或执行偏差>5%的情况立即告警

#### 2.3.2 结算与分析

需求描述：对接电力交易中心结算系统，自动获取并核对结算单。

**分析维度**：

| 分析维度     | 分析内容                     | 输出形式       |
|--------------|------------------------------|----------------|
| VPP维度      | 运营损益分析                 | 月度/年度报告  |
| 策略维度    | 收益对比分析                 | 散点图、柱状图 |
| 资源维度    | 资源贡献度分析               | 饼图、热力图   |
| 时间维度     | 收益趋势分析                 | 折线图、面积图 |

## 3. 数据与API扩展需求

### 3.1 新增数据模型

**核心数据库表**：

```
CREATE TABLE vpp_resource_templates ( /* 资源模板表 */
  id VARCHAR(36) PRIMARY KEY,
  type VARCHAR(50),
  parameters JSON
);

CREATE TABLE vpp_resource_instances ( /* 资源实例表 */
  id VARCHAR(36) PRIMARY KEY,
  template_id VARCHAR(36),
  device_ip VARCHAR(15),
  capacity DECIMAL(18,2)
);

CREATE TABLE vpps ( /* 虚拟电厂定义表 */
  id VARCHAR(36) PRIMARY KEY,
  name VARCHAR(100),
  description TEXT
);

CREATE TABLE trading_strategies ( /* 交易策略定义表 */
  id VARCHAR(36) PRIMARY KEY,
  strategy_type ENUM('RULE','AI'),
  config JSON
);
```

### 3.2 API接口扩展

**核心API接口**：

| 接口路径                  | 方法 | 功能描述                   | 请求参数示例                          |
|---------------------------|------|----------------------------|---------------------------------------|
| GET /vpp/resources/templates | GET  | 获取所有资源模板            | -                                     |
| POST /vpp/resources/instances | POST | 注册资源实例              | {"template_id":"uuid","device_ip":"192.168.1.100"} |
| POST /vpps                | POST | 创建虚拟电厂              | {"name":"云南VPP","description":"试点项目"} |
| PUT /vpps/{id}/resources  | PUT  | 修改VPP包含的资源         | {"add":["res1","res2"],"remove":["res3"]} |
| POST /trading/strategies/{id}/backtest | POST | 启动策略回测任务 | {"start_date":"2025-06-01","end_date":"2025-06-30"} |

## 4. 非功能性需求

- **可配置性**：所有园区/市场相关参数必须通过管理界面配置
- **性能要求**：交易执行引擎响应时间≤1秒
- **可靠性**：支持主备切换的高可用架构
- **安全性**：交易API需JWT+RBAC双重认证

## 5. 实施优先级建议

### P0 (第一阶段 - 基础能力)

- 完成2.1资源聚合与管理中心全部功能
- 实现2.2.2A规则驱动策略编辑器
- 构建2.3.1自动化交易执行引擎
- 目标：实现手动的、基于规则的VPP运营

### P1 (第二阶段 - 智能核心)

- 完成2.2.2B AI驱动策略框架
- 开发2.2.3策略回测与仿真
- 集成首个AI交易模型
- 目标：实现AI辅助决策和半自动化交易

### P2 (第三阶段 - 商业闭环)

- 完善2.3.2结算与分析功能
- 优化AI模型实现全自动化交易
- 目标：构建无人干预的商业化运营体系

这份深化需求已充分吸收您提供的所有文档信息，并力求在您现有优秀的技术架构上，构建一个功能强大、灵活配置且面向未来的虚拟电厂及电力交易系统。