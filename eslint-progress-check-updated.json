[{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/scripts/analyzeDatabaseQueries.js","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":31,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":31,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[850,889],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":34,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":34,"endColumn":14,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[917,947],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":38,"column":1,"nodeType":"MemberExpression","messageId":"unexpected","endLine":38,"endColumn":12,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[963,1023],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":38,"column":52,"nodeType":"Literal","messageId":"noMagic","endLine":38,"endColumn":56},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":39,"column":1,"nodeType":"MemberExpression","messageId":"unexpected","endLine":39,"endColumn":12,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1024,1075],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":40,"column":1,"nodeType":"MemberExpression","messageId":"unexpected","endLine":40,"endColumn":12,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1076,1116],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5.","line":74,"column":37,"nodeType":"Literal","messageId":"noMagic","endLine":74,"endColumn":38},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":90,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":90,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2326,2367],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":125,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":125,"endColumn":14,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[3094,3126],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":130,"column":36,"nodeType":"Literal","messageId":"noMagic","endLine":130,"endColumn":40},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":161,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":161,"endColumn":14,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[4410,4459],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":162,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":162,"endColumn":14,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[4462,4501],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":172,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":172,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[4644,4686],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":174,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":174,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[4706,4730],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":182,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":182,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[4845,4875],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":189,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":189,"endColumn":14,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[5035,5069],"text":""},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":16,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import sqlite3 from 'sqlite3';\nimport * as fs from 'fs';\nimport * as path from 'path';\nimport { format } from 'date-fns';\nimport { fileURLToPath } from 'url';\n\n// ÂÆö‰πâ__dirname‰ª•ÈÄÇÈÖçESÊ®°Âùó\nconst __dirname = path.dirname(fileURLToPath(import.meta.url));\n\n// ÈÖçÁΩÆ\nconst DB_PATH = path.join(__dirname, '../database.sqlite');\nconst OUTPUT_DIR = path.join(__dirname, '../logs/query_analysis');\nconst MIN_EXECUTION_TIME = 50; // ËÆ∞ÂΩïÊâßË°åÊó∂Èó¥Ë∂ÖËøáÊ≠§ÂÄº(ms)ÁöÑÊü•ËØ¢\nconst ANALYSIS_DURATION = 3600000; // ÂàÜÊûêÊåÅÁª≠Êó∂Èó¥(ms)ÔºåÈªòËÆ§1Â∞èÊó∂\n\n// Á°Æ‰øùËæìÂá∫ÁõÆÂΩïÂ≠òÂú®\nif (!fs.existsSync(OUTPUT_DIR)) {\n  fs.mkdirSync(OUTPUT_DIR, { recursive: true });\n}\n\n// Êó•ÂøóÊñá‰ª∂Ë∑ØÂæÑ\nconst logFileName = `query_analysis_${format(new Date(), 'yyyyMMdd_HHmmss')}.log`;\nconst logFilePath = path.join(OUTPUT_DIR, logFileName);\n\n// Â≠òÂÇ®Êü•ËØ¢ÁªüËÆ°‰ø°ÊÅØ\nconst queryStats = {};\n\n// ËøûÊé•Êï∞ÊçÆÂ∫ì\nconst db = new sqlite3.Database(DB_PATH, (err) => {\n  if (err) {\n    console.error('Êï∞ÊçÆÂ∫ìËøûÊé•ÈîôËØØ:', err.message);\n    process.exit(1);\n  }\n  console.log('ÊàêÂäüËøûÊé•Âà∞SQLiteÊï∞ÊçÆÂ∫ì');\n});\n\n// ÂêØÁî®Êü•ËØ¢Ë∑üË∏™\nconsole.log(`ÂºÄÂßãÊï∞ÊçÆÂ∫ìÊü•ËØ¢ÂàÜÊûêÔºåÊåÅÁª≠Êó∂Èó¥: ${ANALYSIS_DURATION / 1000}Áßí`);\nconsole.log(`Â∞ÜËÆ∞ÂΩïÊâßË°åÊó∂Èó¥Ë∂ÖËøá${MIN_EXECUTION_TIME}msÁöÑÊü•ËØ¢`);\nconsole.log(`ÂàÜÊûêÁªìÊûúÂ∞Ü‰øùÂ≠òÂà∞: ${logFilePath}`);\n\n// ÈáçÂÜôÊï∞ÊçÆÂ∫ìÊü•ËØ¢ÊñπÊ≥ï‰ª•ÊµãÈáèÊâßË°åÊó∂Èó¥\nconst originalAll = db.all;\nconst originalGet = db.get;\nconst originalRun = db.run;\n\n// ËÆ∞ÂΩïÊü•ËØ¢ÊâßË°åÊó∂Èó¥ÁöÑËæÖÂä©ÂáΩÊï∞\nfunction logQueryExecution(query, params, executionTime) {\n  // Ê†áÂáÜÂåñÊü•ËØ¢ÔºàÁßªÈô§Â§ö‰ΩôÁ©∫Ê†ºÔºâ\n  const normalizedQuery = query.replace(/\\s+/g, ' ').trim();\n\n  // Êõ¥Êñ∞Êü•ËØ¢ÁªüËÆ°\n  if (!queryStats[normalizedQuery]) {\n    queryStats[normalizedQuery] = {\n      count: 0,\n      totalTime: 0,\n      minTime: Infinity,\n      maxTime: 0,\n      avgTime: 0,\n      lastExecution: new Date(),\n      paramsExamples: [],\n    };\n  }\n\n  const stats = queryStats[normalizedQuery];\n  stats.count++;\n  stats.totalTime += executionTime;\n  stats.minTime = Math.min(stats.minTime, executionTime);\n  stats.maxTime = Math.max(stats.maxTime, executionTime);\n  stats.avgTime = stats.totalTime / stats.count;\n  stats.lastExecution = new Date();\n\n  // ‰øùÂ≠òÂèÇÊï∞Á§∫‰æãÔºàÈôêÂà∂Êï∞ÈáèÔºâ\n  if (stats.paramsExamples.length < 5) {\n    stats.paramsExamples.push(params);\n  }\n\n  // Â¶ÇÊûúÊâßË°åÊó∂Èó¥Ë∂ÖËøáÈòàÂÄºÔºåËÆ∞ÂΩïËØ¶ÁªÜ‰ø°ÊÅØ\n  if (executionTime >= MIN_EXECUTION_TIME) {\n    const logEntry =\n      `[${new Date().toISOString()}] ÊÖ¢Êü•ËØ¢: ${executionTime}ms\n` +\n      `Êü•ËØ¢: ${normalizedQuery}\n` +\n      `ÂèÇÊï∞: ${JSON.stringify(params, null, 2)}\n\n`;\n\n    fs.appendFileSync(logFilePath, logEntry);\n    console.log(`ËÆ∞ÂΩïÊÖ¢Êü•ËØ¢: ${executionTime}ms`);\n  }\n}\n\n// ÂåÖË£ÖÊü•ËØ¢ÊñπÊ≥ï\nfunction wrapQueryMethod(originalMethod) {\n  return function (query, params, callback) {\n    const startTime = Date.now();\n\n    // Â§ÑÁêÜÂèÇÊï∞ÂíåÂõûË∞ÉÁöÑ‰∏çÂêåÊÉÖÂÜµ\n    if (typeof params === 'function') {\n      callback = params;\n      params = [];\n    }\n\n    // ÊâßË°åÂéüÂßãÊü•ËØ¢\n    return originalMethod.call(db, query, params, function (...args) {\n      const executionTime = Date.now() - startTime;\n      logQueryExecution(query, params, executionTime);\n\n      // Ë∞ÉÁî®ÂéüÂßãÂõûË∞É\n      if (typeof callback === 'function') {\n        callback.apply(this, args);\n      }\n    });\n  };\n}\n\n// Â∫îÁî®ÂåÖË£ÖÂêéÁöÑÊñπÊ≥ï\ndb.all = wrapQueryMethod(originalAll);\ndb.get = wrapQueryMethod(originalGet);\ndb.run = wrapQueryMethod(originalRun);\n\n// ËÆæÁΩÆÂàÜÊûêË∂ÖÊó∂\nsetTimeout(() => {\n  console.log('Êü•ËØ¢ÂàÜÊûêÊó∂Èó¥ÁªìÊùüÔºåÁîüÊàêÊä•Âëä...');\n\n  // ÁîüÊàêÊÄªÁªìÊä•Âëä\n  const summaryReport = [\n    `Êï∞ÊçÆÂ∫ìÊü•ËØ¢ÊÄßËÉΩÂàÜÊûêÊä•Âëä - ${new Date().toISOString()}`,\n    `ÂàÜÊûêÊåÅÁª≠Êó∂Èó¥: ${ANALYSIS_DURATION / 1000}Áßí`,\n    `ËÆ∞ÂΩïÈòàÂÄº: ${MIN_EXECUTION_TIME}ms`,\n    `ÊÄªÊü•ËØ¢Á±ªÂûã: ${Object.keys(queryStats).length}`,\n    `\n==================== ÊÖ¢Êü•ËØ¢ÁªüËÆ° ====================\n`,\n  ];\n\n  // ÊåâÂπ≥ÂùáÊâßË°åÊó∂Èó¥ÊéíÂ∫èÊü•ËØ¢\n  const sortedQueries = Object.entries(queryStats).sort(([, a], [, b]) => b.avgTime - a.avgTime);\n\n  // Ê∑ªÂä†ÊØè‰∏™Êü•ËØ¢ÁöÑÁªüËÆ°‰ø°ÊÅØ\n  sortedQueries.forEach(([query, stats]) => {\n    summaryReport.push(`Êü•ËØ¢: ${query}`);\n    summaryReport.push(`ÊâßË°åÊ¨°Êï∞: ${stats.count}`);\n    summaryReport.push(`ÊÄªÊó∂Èó¥: ${stats.totalTime.toFixed(2)}ms`);\n    summaryReport.push(`Âπ≥ÂùáÊó∂Èó¥: ${stats.avgTime.toFixed(2)}ms`);\n    summaryReport.push(`ÊúÄÂ∞èÊó∂Èó¥: ${stats.minTime.toFixed(2)}ms`);\n    summaryReport.push(`ÊúÄÂ§ßÊó∂Èó¥: ${stats.maxTime.toFixed(2)}ms`);\n    summaryReport.push(`‰∏äÊ¨°ÊâßË°å: ${stats.lastExecution.toISOString()}`);\n    summaryReport.push(`ÂèÇÊï∞Á§∫‰æã: ${JSON.stringify(stats.paramsExamples[0] || 'Êó†', null, 2)}`);\n    summaryReport.push(`\n----------------------------------------------------\n`);\n  });\n\n  // ‰øùÂ≠òÊÄªÁªìÊä•Âëä\n  const summaryFileName = `query_summary_${format(new Date(), 'yyyyMMdd_HHmmss')}.txt`;\n  const summaryFilePath = path.join(OUTPUT_DIR, summaryFileName);\n  fs.writeFileSync(summaryFilePath, summaryReport.join('\\n'));\n\n  console.log(`ÂàÜÊûêÂÆåÊàêÔºåÊÄªÁªìÊä•ÂëäÂ∑≤‰øùÂ≠òÂà∞: ${summaryFilePath}`);\n  console.log(`ÊÖ¢Êü•ËØ¢ËØ¶ÁªÜÊó•Âøó: ${logFilePath}`);\n\n  // ÊÅ¢Â§çÂéüÂßãÊñπÊ≥ï\n  db.all = originalAll;\n  db.get = originalGet;\n  db.run = originalRun;\n\n  // ÂÖ≥Èó≠Êï∞ÊçÆÂ∫ìËøûÊé•\n  db.close((err) => {\n    if (err) {\n      console.error('ÂÖ≥Èó≠Êï∞ÊçÆÂ∫ìËøûÊé•Êó∂Âá∫Èîô:', err.message);\n    } else {\n      console.log('Êï∞ÊçÆÂ∫ìËøûÊé•Â∑≤ÂÖ≥Èó≠');\n    }\n    process.exit(0);\n  });\n}, ANALYSIS_DURATION);\n\n// Â§ÑÁêÜÊú™ÊçïËé∑ÁöÑÂºÇÂ∏∏\nprocess.on('uncaughtException', (err) => {\n  console.error('Êú™ÊçïËé∑ÁöÑÂºÇÂ∏∏:', err);\n  fs.appendFileSync(logFilePath, `[${new Date().toISOString()}] ÂàÜÊûêËÑöÊú¨ÂºÇÂ∏∏: ${err.stack}\\n\\n`);\n  process.exit(1);\n});\n\n// Â§ÑÁêÜËøõÁ®ãÈÄÄÂá∫\nprocess.on('exit', (code) => {\n  console.log(`ÂàÜÊûêËÑöÊú¨ÈÄÄÂá∫Ôºå‰ª£Á†Å: ${code}`);\n});\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/scripts/code-quality-fixer.js","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":40,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":40,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[824,869],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":49,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":49,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1071,1112],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":51,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":51,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[1141,1198],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":60,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":60,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1289,1334],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":97,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":97,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2345,2415],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":98,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":98,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2422,2489],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":99,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":99,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2496,2563],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":101,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":101,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2592,2645],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":109,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":109,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2715,2760],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":116,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":116,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[3016,3078],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":126,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":126,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[3201,3247],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":134,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":134,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[3421,3461],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":136,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":136,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[3490,3536],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":144,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":144,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[3609,3656],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5.","line":148,"column":46,"nodeType":"Literal","messageId":"noMagic","endLine":148,"endColumn":47},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":150,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":150,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[3788,3870],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 20.","line":168,"column":26,"nodeType":"Literal","messageId":"noMagic","endLine":168,"endColumn":28},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":168,"column":40,"nodeType":"Literal","messageId":"noMagic","endLine":168,"endColumn":43},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":173,"column":41,"nodeType":"Literal","messageId":"noMagic","endLine":173,"endColumn":43},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":206,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":206,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[5250,5289],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":209,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":209,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[5326,5382],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":232,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":232,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[5856,5962],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":286,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":286,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[7439,7524],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":303,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":303,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[7740,7785],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":317,"column":49,"nodeType":"Literal","messageId":"noMagic","endLine":317,"endColumn":51},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":318,"column":43,"nodeType":"Literal","messageId":"noMagic","endLine":318,"endColumn":45},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":319,"column":43,"nodeType":"Literal","messageId":"noMagic","endLine":319,"endColumn":45},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":327,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":327,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[8712,8766],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":330,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":330,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[8784,8823],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":331,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":331,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[8828,8898],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":332,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":332,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[8903,8975],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":333,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":333,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[8980,9052],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":334,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":334,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[9057,9128],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":335,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":335,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[9133,9204],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"prefer-destructuring","severity":2,"message":"Use array destructuring.","line":445,"column":9,"nodeType":"VariableDeclarator","messageId":"preferDestructuring","endLine":445,"endColumn":34},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":449,"column":35,"nodeType":"MemberExpression","messageId":"unexpected","endLine":449,"endColumn":48},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":452,"column":39,"nodeType":"MemberExpression","messageId":"unexpected","endLine":452,"endColumn":52},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":455,"column":36,"nodeType":"MemberExpression","messageId":"unexpected","endLine":455,"endColumn":49},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":458,"column":42,"nodeType":"MemberExpression","messageId":"unexpected","endLine":458,"endColumn":55},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":462,"column":28,"nodeType":"MemberExpression","messageId":"unexpected","endLine":462,"endColumn":41}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":39,"fixableErrorCount":0,"fixableWarningCount":0,"source":"#!/usr/bin/env node\n\n/**\n * ‰ª£Á†ÅË¥®Èáè‰øÆÂ§çËÑöÊú¨\n * ÈÄêÊ≠•‰øÆÂ§ç‰ª£Á†ÅË¥®ÈáèÈóÆÈ¢òÔºå‰ºòÂÖàÂ§ÑÁêÜÂÖ≥ÈîÆÈîôËØØ\n */\n\nimport fs from 'fs';\nimport path from 'path';\nimport { fileURLToPath } from 'url';\nimport { execSync } from 'child_process';\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\n\nconst colors = {\n  red: (text) => `\\x1b[31m${text}\\x1b[0m`,\n  green: (text) => `\\x1b[32m${text}\\x1b[0m`,\n  yellow: (text) => `\\x1b[33m${text}\\x1b[0m`,\n  blue: (text) => `\\x1b[34m${text}\\x1b[0m`,\n  cyan: (text) => `\\x1b[36m${text}\\x1b[0m`,\n  magenta: (text) => `\\x1b[35m${text}\\x1b[0m`,\n};\n\nclass CodeQualityFixer {\n  constructor() {\n    this.projectRoot = process.cwd();\n    this.fixedFiles = new Set();\n    this.issues = {\n      critical: [],\n      major: [],\n      minor: [],\n    };\n  }\n\n  /**\n   * ËøêË°åÊâÄÊúâ‰øÆÂ§ç\n   */\n  async runAll() {\n    console.log(colors.blue('üîß ÂºÄÂßã‰ª£Á†ÅË¥®Èáè‰øÆÂ§ç...\\n'));\n\n    try {\n      await this.analyzeIssues();\n      await this.fixCriticalIssues();\n      await this.fixMajorIssues();\n      await this.optimizeComplexFiles();\n      await this.generateReport();\n\n      console.log(colors.green('‚úÖ ‰ª£Á†ÅË¥®Èáè‰øÆÂ§çÂÆåÊàê!'));\n    } catch (error) {\n      console.error(colors.red('‚ùå ‰øÆÂ§çËøáÁ®ã‰∏≠Âá∫Áé∞ÈîôËØØ:'), error.message);\n      process.exit(1);\n    }\n  }\n\n  /**\n   * ÂàÜÊûê‰ª£Á†ÅË¥®ÈáèÈóÆÈ¢ò\n   */\n  async analyzeIssues() {\n    console.log(colors.yellow('üìä ÂàÜÊûê‰ª£Á†ÅË¥®ÈáèÈóÆÈ¢ò...'));\n\n    try {\n      // ‰ΩøÁî®Ê∏êËøõÂºèÈÖçÁΩÆÂàÜÊûêÈóÆÈ¢ò\n      const eslintOutput = execSync(\n        'npx eslint . --config .eslintrc.progressive.cjs --format json',\n        {\n          cwd: this.projectRoot,\n          encoding: 'utf8',\n        }\n      );\n\n      const results = JSON.parse(eslintOutput);\n\n      results.forEach((result) => {\n        if (result.messages.length > 0) {\n          result.messages.forEach((message) => {\n            const issue = {\n              file: result.filePath,\n              line: message.line,\n              column: message.column,\n              rule: message.ruleId,\n              message: message.message,\n              severity: message.severity,\n            };\n\n            if (this.isCriticalIssue(message.ruleId)) {\n              this.issues.critical.push(issue);\n            } else if (this.isMajorIssue(message.ruleId)) {\n              this.issues.major.push(issue);\n            } else {\n              this.issues.minor.push(issue);\n            }\n          });\n        }\n      });\n\n      console.log(colors.blue(`  üî¥ ÂÖ≥ÈîÆÈóÆÈ¢ò: ${this.issues.critical.length}`));\n      console.log(colors.blue(`  üü° ÈáçË¶ÅÈóÆÈ¢ò: ${this.issues.major.length}`));\n      console.log(colors.blue(`  üü¢ Ê¨°Ë¶ÅÈóÆÈ¢ò: ${this.issues.minor.length}`));\n    } catch (error) {\n      console.log(colors.yellow('  ‚ö†Ô∏è  ÈóÆÈ¢òÂàÜÊûêÂÆåÊàê (ÈÉ®ÂàÜÊñá‰ª∂ÊúâÈîôËØØ)'));\n    }\n  }\n\n  /**\n   * ‰øÆÂ§çÂÖ≥ÈîÆÈóÆÈ¢ò\n   */\n  async fixCriticalIssues() {\n    console.log(colors.yellow('\\nüö® ‰øÆÂ§çÂÖ≥ÈîÆÈóÆÈ¢ò...'));\n\n    const criticalRules = ['no-undef', 'no-unused-vars', 'no-redeclare', 'no-unreachable'];\n\n    for (const rule of criticalRules) {\n      const issues = this.issues.critical.filter((issue) => issue.rule === rule);\n      if (issues.length > 0) {\n        console.log(colors.red(`  ‰øÆÂ§ç ${rule}: ${issues.length} ‰∏™ÈóÆÈ¢ò`));\n        await this.fixRuleIssues(rule, issues);\n      }\n    }\n  }\n\n  /**\n   * ‰øÆÂ§çÈáçË¶ÅÈóÆÈ¢ò\n   */\n  async fixMajorIssues() {\n    console.log(colors.yellow('\\n‚ö†Ô∏è  ‰øÆÂ§çÈáçË¶ÅÈóÆÈ¢ò...'));\n\n    // Ëá™Âä®‰øÆÂ§çÂèØ‰øÆÂ§çÁöÑÈóÆÈ¢ò\n    try {\n      execSync('npx eslint . --config .eslintrc.progressive.cjs --fix', {\n        cwd: this.projectRoot,\n        stdio: 'pipe',\n      });\n      console.log(colors.green('  ‚úÖ Ëá™Âä®‰øÆÂ§çÂÆåÊàê'));\n    } catch (error) {\n      console.log(colors.yellow('  ‚ö†Ô∏è  ÈÉ®ÂàÜÈóÆÈ¢òÂ∑≤Ëá™Âä®‰øÆÂ§ç'));\n    }\n  }\n\n  /**\n   * ‰ºòÂåñÂ§çÊùÇÊñá‰ª∂\n   */\n  async optimizeComplexFiles() {\n    console.log(colors.yellow('\\nüìà ‰ºòÂåñÈ´òÂ§çÊùÇÂ∫¶Êñá‰ª∂...'));\n\n    const complexFiles = this.findComplexFiles();\n\n    for (const file of complexFiles.slice(0, 5)) {\n      // Âè™Â§ÑÁêÜÂâç5‰∏™ÊúÄÂ§çÊùÇÁöÑÊñá‰ª∂\n      console.log(colors.blue(`  ‰ºòÂåñÊñá‰ª∂: ${path.relative(this.projectRoot, file.path)}`));\n      await this.optimizeFile(file);\n    }\n  }\n\n  /**\n   * Êü•ÊâæÂ§çÊùÇÊñá‰ª∂\n   */\n  findComplexFiles() {\n    const files = [];\n    const sourceFiles = this.getSourceFiles();\n\n    sourceFiles.forEach((filePath) => {\n      try {\n        const content = fs.readFileSync(filePath, 'utf8');\n        const complexity = this.calculateComplexity(content);\n        const lines = content.split('\\n').length;\n\n        if (complexity > 20 || lines > 500) {\n          files.push({\n            path: filePath,\n            complexity,\n            lines,\n            score: complexity + lines / 10,\n          });\n        }\n      } catch (error) {\n        // ÂøΩÁï•ËØªÂèñÈîôËØØ\n      }\n    });\n\n    return files.sort((a, b) => b.score - a.score);\n  }\n\n  /**\n   * ‰ºòÂåñÂçï‰∏™Êñá‰ª∂\n   */\n  async optimizeFile(file) {\n    try {\n      const content = fs.readFileSync(file.path, 'utf8');\n      let optimizedContent = content;\n\n      // ÁßªÈô§Â§ö‰ΩôÁöÑÁ©∫Ë°å\n      optimizedContent = optimizedContent.replace(/\\n\\s*\\n\\s*\\n/g, '\\n\\n');\n\n      // Ê∑ªÂä†ÈÄÇÂΩìÁöÑÊ≥®Èáä\n      if (!optimizedContent.includes('/**')) {\n        const fileName = path.basename(file.path);\n        const header = `/**\\n * ${fileName}\\n * Ëá™Âä®‰ºòÂåñÁöÑÊñá‰ª∂\\n */\\n\\n`;\n        optimizedContent = header + optimizedContent;\n      }\n\n      // Âè™ÊúâÂú®ÂÜÖÂÆπÊúâÂèòÂåñÊó∂ÊâçÂÜôÂÖ•\n      if (optimizedContent !== content) {\n        fs.writeFileSync(file.path, optimizedContent);\n        this.fixedFiles.add(file.path);\n        console.log(colors.green('    ‚úÖ Â∑≤‰ºòÂåñ'));\n      }\n    } catch (error) {\n      console.log(colors.red(`    ‚ùå ‰ºòÂåñÂ§±Ë¥•: ${error.message}`));\n    }\n  }\n\n  /**\n   * ‰øÆÂ§çÁâπÂÆöËßÑÂàôÁöÑÈóÆÈ¢ò\n   */\n  async fixRuleIssues(rule, issues) {\n    const fileGroups = {};\n\n    // ÊåâÊñá‰ª∂ÂàÜÁªÑ\n    issues.forEach((issue) => {\n      if (!fileGroups[issue.file]) {\n        fileGroups[issue.file] = [];\n      }\n      fileGroups[issue.file].push(issue);\n    });\n\n    // Â§ÑÁêÜÊØè‰∏™Êñá‰ª∂\n    for (const [filePath, fileIssues] of Object.entries(fileGroups)) {\n      try {\n        await this.fixFileIssues(filePath, rule, fileIssues);\n      } catch (error) {\n        console.log(\n          colors.red(`    ‚ùå ‰øÆÂ§çÊñá‰ª∂Â§±Ë¥•: ${path.relative(this.projectRoot, filePath)}`)\n        );\n      }\n    }\n  }\n\n  /**\n   * ‰øÆÂ§çÊñá‰ª∂‰∏≠ÁöÑÈóÆÈ¢ò\n   */\n  async fixFileIssues(filePath, rule, issues) {\n    const content = fs.readFileSync(filePath, 'utf8');\n    const lines = content.split('\\n');\n    let modified = false;\n\n    switch (rule) {\n      case 'no-unused-vars':\n        // ‰∏∫Êú™‰ΩøÁî®ÁöÑÂèòÈáèÊ∑ªÂä†‰∏ãÂàíÁ∫øÂâçÁºÄ\n        issues.forEach((issue) => {\n          const lineIndex = issue.line - 1;\n          if (lineIndex < lines.length) {\n            const line = lines[lineIndex];\n            const match = line.match(/\\b(const|let|var)\\s+(\\w+)/);\n            if (match && !match[2].startsWith('_')) {\n              lines[lineIndex] = line.replace(match[2], `_${match[2]}`);\n              modified = true;\n            }\n          }\n        });\n        break;\n\n      case 'no-console':\n        // Â∞Üconsole.logÊõøÊç¢‰∏∫Ê≥®ÈáäÔºàÂú®ÈùûËÑöÊú¨Êñá‰ª∂‰∏≠Ôºâ\n        if (!filePath.includes('/scripts/') && !filePath.includes('/tests/')) {\n          issues.forEach((issue) => {\n            const lineIndex = issue.line - 1;\n            if (lineIndex < lines.length) {\n              const line = lines[lineIndex];\n              if (line.includes('console.')) {\n                lines[lineIndex] = line.replace(\n                  /console\\.(\\w+)\\(([^)]+)\\);?/,\n                  '// console.$1($2);'\n                );\n                modified = true;\n              }\n            }\n          });\n        }\n        break;\n    }\n\n    if (modified) {\n      fs.writeFileSync(filePath, lines.join('\\n'));\n      this.fixedFiles.add(filePath);\n      console.log(colors.green(`    ‚úÖ Â∑≤‰øÆÂ§ç: ${path.relative(this.projectRoot, filePath)}`));\n    }\n  }\n\n  /**\n   * ÁîüÊàê‰øÆÂ§çÊä•Âëä\n   */\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 34 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 34 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 34 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 34 Ë°å)\n\n  async generateReport() {\n    console.log(colors.yellow('\\nüìä ÁîüÊàê‰øÆÂ§çÊä•Âëä...'));\n\n    const report = {\n      timestamp: new Date().toISOString(),\n      summary: {\n        totalIssues:\n          this.issues.critical.length + this.issues.major.length + this.issues.minor.length,\n        criticalIssues: this.issues.critical.length,\n        majorIssues: this.issues.major.length,\n        minorIssues: this.issues.minor.length,\n        fixedFiles: this.fixedFiles.size,\n      },\n      fixedFiles: Array.from(this.fixedFiles).map((file) => path.relative(this.projectRoot, file)),\n      remainingIssues: {\n        critical: this.issues.critical.slice(0, 10), // Âè™ÊòæÁ§∫Ââç10‰∏™\n        major: this.issues.major.slice(0, 10),\n        minor: this.issues.minor.slice(0, 10),\n      },\n    };\n\n    const reportPath = path.join(this.projectRoot, 'reports', 'code-quality-fix-report.json');\n    fs.mkdirSync(path.dirname(reportPath), { recursive: true });\n    fs.writeFileSync(reportPath, JSON.stringify(report, null, 2));\n\n    console.log(colors.green(`  ‚úÖ Êä•ÂëäÂ∑≤ÁîüÊàê: ${reportPath}`));\n\n    // ÊòæÁ§∫ÊëòË¶Å\n    console.log(colors.cyan('\\nüìã ‰øÆÂ§çÊëòË¶Å:'));\n    console.log(colors.blue(`   üìä ÊÄªÈóÆÈ¢òÊï∞: ${report.summary.totalIssues}`));\n    console.log(colors.red(`   üî¥ ÂÖ≥ÈîÆÈóÆÈ¢ò: ${report.summary.criticalIssues}`));\n    console.log(colors.yellow(`   üü° ÈáçË¶ÅÈóÆÈ¢ò: ${report.summary.majorIssues}`));\n    console.log(colors.green(`   üü¢ Ê¨°Ë¶ÅÈóÆÈ¢ò: ${report.summary.minorIssues}`));\n    console.log(colors.green(`   üîß Â∑≤‰øÆÂ§çÊñá‰ª∂: ${report.summary.fixedFiles}`));\n  }\n\n  /**\n   * Âà§Êñ≠ÊòØÂê¶‰∏∫ÂÖ≥ÈîÆÈóÆÈ¢ò\n   */\n  isCriticalIssue(ruleId) {\n    const criticalRules = [\n      'no-undef',\n      'no-unused-vars',\n      'no-redeclare',\n      'no-unreachable',\n      'no-dupe-keys',\n      'no-duplicate-case',\n    ];\n    return criticalRules.includes(ruleId);\n  }\n\n  /**\n   * Âà§Êñ≠ÊòØÂê¶‰∏∫ÈáçË¶ÅÈóÆÈ¢ò\n   */\n  isMajorIssue(ruleId) {\n    const majorRules = [\n      'no-console',\n      'no-debugger',\n      'no-alert',\n      'complexity',\n      'max-statements',\n      'max-params',\n    ];\n    return majorRules.includes(ruleId);\n  }\n\n  /**\n   * Ëé∑ÂèñÊ∫ê‰ª£Á†ÅÊñá‰ª∂ÂàóË°®\n   */\n  getSourceFiles() {\n    const files = [];\n    const searchDirs = ['src', 'backend', 'scripts'];\n\n    searchDirs.forEach((dir) => {\n      const dirPath = path.join(this.projectRoot, dir);\n      if (fs.existsSync(dirPath)) {\n        this.walkDir(dirPath, files);\n      }\n    });\n\n    return files.filter(\n      (file) =>\n        (file.endsWith('.js') || file.endsWith('.ts')) &&\n        !file.includes('node_modules') &&\n        !file.includes('.git')\n    );\n  }\n\n  /**\n   * ÈÄíÂΩíÈÅçÂéÜÁõÆÂΩï\n   */\n  walkDir(dir, files) {\n    try {\n      const items = fs.readdirSync(dir);\n\n      items.forEach((item) => {\n        const fullPath = path.join(dir, item);\n        const stat = fs.statSync(fullPath);\n\n        if (stat.isDirectory() && !item.startsWith('.')) {\n          this.walkDir(fullPath, files);\n        } else if (stat.isFile()) {\n          files.push(fullPath);\n        }\n      });\n    } catch (error) {\n      // ÂøΩÁï•ÊùÉÈôêÈîôËØØ\n    }\n  }\n\n  /**\n   * ËÆ°ÁÆó‰ª£Á†ÅÂ§çÊùÇÂ∫¶\n   */\n  calculateComplexity(content) {\n    const patterns = [\n      /if\\s*\\(/g,\n      /else\\s*if\\s*\\(/g,\n      /while\\s*\\(/g,\n      /for\\s*\\(/g,\n      /switch\\s*\\(/g,\n      /case\\s+/g,\n      /catch\\s*\\(/g,\n      /&&/g,\n      /\\|\\|/g,\n      /\\?/g,\n    ];\n\n    let complexity = 1;\n\n    patterns.forEach((pattern) => {\n      const matches = content.match(pattern);\n      if (matches) {\n        complexity += matches.length;\n      }\n    });\n\n    return complexity;\n  }\n}\n\n// ÂëΩ‰ª§Ë°åÊâßË°å\nif (import.meta.url === `file://${process.argv[1]}`) {\n  const fixer = new CodeQualityFixer();\n  const command = process.argv[2];\n\n  switch (command) {\n    case 'analyze':\n      fixer.analyzeIssues().catch(console.error);\n      break;\n    case 'critical':\n      fixer.fixCriticalIssues().catch(console.error);\n      break;\n    case 'major':\n      fixer.fixMajorIssues().catch(console.error);\n      break;\n    case 'optimize':\n      fixer.optimizeComplexFiles().catch(console.error);\n      break;\n    case 'all':\n    default:\n      fixer.runAll().catch(console.error);\n      break;\n  }\n}\n\nexport default CodeQualityFixer;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/scripts/code-quality-monitor.js","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":55,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":55,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1410,1461],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":75,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":75,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[1986,2042],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":93,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":93,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2306,2354],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":126,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":126,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[3148,3296],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":145,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":145,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[3709,3859],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":157,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":157,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[3937,3979],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":161,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":161,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[4068,4107],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":166,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":166,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[4324,4379],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":174,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":174,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[4459,4513],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":177,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":177,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[4593,4660],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'output' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":182,"column":23,"nodeType":"Identifier","messageId":"unusedVar","endLine":182,"endColumn":29},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":186,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":186,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[4851,4899],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":199,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":199,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[5286,5448],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":211,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":211,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[5517,5562],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":236,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":236,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[6250,6319],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":238,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":238,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[6348,6390],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":246,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":246,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[6459,6503],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":265,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":265,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[7046,7129],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":267,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":267,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[7158,7197],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":275,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":275,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[7272,7315],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":296,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":296,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[7906,7987],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":298,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":298,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[8016,8056],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":306,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":306,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[8130,8172],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":316,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":316,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[8456,8555],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":320,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":320,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[8584,8625],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":328,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":328,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[8695,8738],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":339,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":339,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[9015,9097],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":346,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":346,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[9324,9406],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"Number constants declarations must use 'const'.","line":354,"column":17,"nodeType":"Literal","messageId":"useConst","endLine":354,"endColumn":20},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.5.","line":358,"column":45,"nodeType":"Literal","messageId":"noMagic","endLine":358,"endColumn":48},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.1.","line":361,"column":49,"nodeType":"Literal","messageId":"noMagic","endLine":361,"endColumn":52},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1.5.","line":364,"column":47,"nodeType":"Literal","messageId":"noMagic","endLine":364,"endColumn":50},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.3.","line":365,"column":49,"nodeType":"Literal","messageId":"noMagic","endLine":365,"endColumn":52},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 80.","line":368,"column":40,"nodeType":"Literal","messageId":"noMagic","endLine":368,"endColumn":42},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":369,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":369,"endColumn":18},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 50.","line":370,"column":46,"nodeType":"Literal","messageId":"noMagic","endLine":370,"endColumn":48},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 15.","line":371,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":371,"endColumn":18},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 3.","line":375,"column":54,"nodeType":"Literal","messageId":"noMagic","endLine":375,"endColumn":55},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.5.","line":381,"column":51,"nodeType":"Literal","messageId":"noMagic","endLine":381,"endColumn":54},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.2.","line":384,"column":51,"nodeType":"Literal","messageId":"noMagic","endLine":384,"endColumn":54},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":386,"column":46,"nodeType":"Literal","messageId":"noMagic","endLine":386,"endColumn":49},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 80.","line":411,"column":39,"nodeType":"Literal","messageId":"noMagic","endLine":411,"endColumn":41},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5.","line":429,"column":46,"nodeType":"Literal","messageId":"noMagic","endLine":429,"endColumn":47},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 90.","line":582,"column":30,"nodeType":"Literal","messageId":"noMagic","endLine":582,"endColumn":32},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 80.","line":585,"column":30,"nodeType":"Literal","messageId":"noMagic","endLine":585,"endColumn":32},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 70.","line":588,"column":30,"nodeType":"Literal","messageId":"noMagic","endLine":588,"endColumn":32},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":595,"column":30,"nodeType":"Literal","messageId":"noMagic","endLine":595,"endColumn":32},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":654,"column":68,"nodeType":"Literal","messageId":"noMagic","endLine":654,"endColumn":71},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":662,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":662,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[18655,18706],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":663,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":663,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[18711,18751],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 50.","line":663,"column":39,"nodeType":"Literal","messageId":"noMagic","endLine":663,"endColumn":41},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":665,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":665,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[18757,18931],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":669,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":669,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[18937,18977],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":670,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":670,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[18982,19179],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":673,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":673,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[19184,19321],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":676,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":676,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[19326,19477],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":679,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":679,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[19482,19543],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":682,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":682,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[19594,19636],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 3.","line":685,"column":19,"nodeType":"Literal","messageId":"noMagic","endLine":685,"endColumn":20},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":687,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":687,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[19811,19857],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":691,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":691,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[19881,20003],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":694,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":694,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[20008,20048],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 50.","line":694,"column":39,"nodeType":"Literal","messageId":"noMagic","endLine":694,"endColumn":41},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 90.","line":701,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":701,"endColumn":20},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 80.","line":704,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":704,"endColumn":20},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 70.","line":707,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":707,"endColumn":20},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5.","line":724,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":724,"endColumn":19},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 80.","line":738,"column":21,"nodeType":"Literal","messageId":"noMagic","endLine":738,"endColumn":23},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":745,"column":21,"nodeType":"Literal","messageId":"noMagic","endLine":745,"endColumn":23},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":781,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":781,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[21785,21830],"text":""},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":69,"fixableErrorCount":0,"fixableWarningCount":0,"source":"#!/usr/bin/env node\n\nimport { exec } from 'child_process';\nimport { promisify } from 'util';\nimport fs from 'fs';\nimport path from 'path';\n\nconst execAsync = promisify(exec);\n\n// ÁÆÄÂçïÁöÑÈ¢úËâ≤ËæìÂá∫ÂáΩÊï∞\nconst colors = {\n  red: (text) => `\\x1b[31m${text}\\x1b[0m`,\n  green: (text) => `\\x1b[32m${text}\\x1b[0m`,\n  yellow: (text) => `\\x1b[33m${text}\\x1b[0m`,\n  blue: (text) => `\\x1b[34m${text}\\x1b[0m`,\n  bold: (text) => `\\x1b[1m${text}\\x1b[0m`,\n};\n\nconst chalk = {\n  red: colors.red,\n  green: colors.green,\n  yellow: colors.yellow,\n  blue: {\n    bold: (text) => colors.blue(colors.bold(text)),\n  },\n};\n\n/**\n * ‰ª£Á†ÅË¥®ÈáèÁõëÊéßÂíåËá™Âä®ÂåñÊîπËøõÂ∑•ÂÖ∑\n * ÈõÜÊàêÂ§öÁßçË¥®ÈáèÊ£ÄÊü•Â∑•ÂÖ∑ÔºåÊèê‰æõËØ¶ÁªÜÁöÑË¥®ÈáèÊä•ÂëäÂíåÊîπËøõÂª∫ËÆÆ\n */\nclass CodeQualityMonitor {\n  constructor() {\n    this.projectRoot = process.cwd();\n    this.reportDir = path.join(this.projectRoot, 'quality-reports');\n    this.timestamp = new Date().toISOString().replace(/[:.]/g, '-');\n    this.metrics = {\n      eslint: { errors: 0, warnings: 0, fixable: 0 },\n      prettier: { violations: 0 },\n      typescript: { errors: 0, warnings: 0 },\n      tests: { coverage: 0, passed: 0, failed: 0 },\n      security: { vulnerabilities: 0, severity: {} },\n      complexity: { average: 0, max: 0, violations: 0 },\n      duplicates: { percentage: 0, lines: 0 },\n      dependencies: { outdated: 0, vulnerable: 0 },\n    };\n    this.recommendations = [];\n    this.qualityScore = 0;\n  }\n\n  /**\n   * ËøêË°åÂÆåÊï¥ÁöÑ‰ª£Á†ÅË¥®ÈáèÁõëÊéß\n   */\n  async runFullAnalysis() {\n    console.log(chalk.blue.bold('üîç ÂºÄÂßã‰ª£Á†ÅË¥®ÈáèÂÖ®Èù¢ÂàÜÊûê...\\n'));\n\n    this.ensureReportDirectory();\n\n    try {\n      await this.runESLintAnalysis();\n      await this.runPrettierCheck();\n      await this.runTypeScriptCheck();\n      await this.runTestCoverage();\n      await this.runSecurityAudit();\n      await this.runComplexityAnalysis();\n      await this.runDuplicateDetection();\n      await this.runDependencyCheck();\n\n      this.calculateQualityScore();\n      this.generateRecommendations();\n      await this.generateReport();\n\n      this.displaySummary();\n    } catch (error) {\n      console.error(chalk.red('‚ùå ÂàÜÊûêËøáÁ®ã‰∏≠ÂèëÁîüÈîôËØØ:'), error.message);\n      process.exit(1);\n    }\n  }\n\n  /**\n   * Á°Æ‰øùÊä•ÂëäÁõÆÂΩïÂ≠òÂú®\n   */\n  ensureReportDirectory() {\n    if (!fs.existsSync(this.reportDir)) {\n      fs.mkdirSync(this.reportDir, { recursive: true });\n    }\n  }\n\n  /**\n   * ESLint ‰ª£Á†ÅË¥®ÈáèÂàÜÊûê\n   */\n  async runESLintAnalysis() {\n    console.log(chalk.yellow('üîß ËøêË°å ESLint ÂàÜÊûê...'));\n\n    try {\n      const { stdout: eslintOutput } = await execAsync(\n        'npx eslint . --format json --ext .js,.ts,.jsx,.tsx',\n        {\n          encoding: 'utf8',\n          cwd: this.projectRoot,\n        }\n      );\n\n      const results = JSON.parse(eslintOutput);\n\n      results.forEach((result) => {\n        result.messages.forEach((message) => {\n          if (message.severity === 2) {\n            this.metrics.eslint.errors++;\n          } else {\n            this.metrics.eslint.warnings++;\n          }\n\n          if (message.fix) {\n            this.metrics.eslint.fixable++;\n          }\n        });\n      });\n\n      // ‰øùÂ≠òËØ¶ÁªÜÊä•Âëä\n      await fs.promises.writeFile(\n        path.join(this.reportDir, `eslint-${this.timestamp}.json`),\n        JSON.stringify(results, null, 2)\n      );\n\n      console.log(\n        chalk.green(\n          `‚úÖ ESLint ÂàÜÊûêÂÆåÊàê: ${this.metrics.eslint.errors} ÈîôËØØ, ${this.metrics.eslint.warnings} Ë≠¶Âëä`\n        )\n      );\n    } catch (error) {\n      if (error.stdout) {\n        const results = JSON.parse(error.stdout);\n        // Â§ÑÁêÜÊúâÈîôËØØÁöÑÊÉÖÂÜµ\n        results.forEach((result) => {\n          result.messages.forEach((message) => {\n            if (message.severity === 2) {\n              this.metrics.eslint.errors++;\n            } else {\n              this.metrics.eslint.warnings++;\n            }\n          });\n        });\n      }\n      console.log(\n        chalk.yellow(\n          `‚ö†Ô∏è ESLint ÂèëÁé∞ÈóÆÈ¢ò: ${this.metrics.eslint.errors} ÈîôËØØ, ${this.metrics.eslint.warnings} Ë≠¶Âëä`\n        )\n      );\n    }\n  }\n\n  /**\n   * Prettier ‰ª£Á†ÅÊ†ºÂºèÊ£ÄÊü•\n   */\n  async runPrettierCheck() {\n    console.log(chalk.yellow('üé® Ê£ÄÊü•‰ª£Á†ÅÊ†ºÂºè...'));\n\n    try {\n      await execAsync('npx prettier --check .', { encoding: 'utf8' });\n      console.log(chalk.green('‚úÖ ‰ª£Á†ÅÊ†ºÂºèÊ£ÄÊü•ÈÄöËøá'));\n    } catch (error) {\n      const output = error.stdout?.toString() || '';\n      const violations = output.split('\\n').filter((line) => line.trim()).length;\n      this.metrics.prettier.violations = violations;\n      console.log(chalk.yellow(`‚ö†Ô∏è ÂèëÁé∞ ${violations} ‰∏™Ê†ºÂºèÈóÆÈ¢ò`));\n    }\n  }\n\n  /**\n   * TypeScript Á±ªÂûãÊ£ÄÊü•\n   */\n  async runTypeScriptCheck() {\n    console.log(chalk.yellow('üìù ËøêË°å TypeScript Á±ªÂûãÊ£ÄÊü•...'));\n\n    if (!fs.existsSync(path.join(this.projectRoot, 'tsconfig.json'))) {\n      console.log(chalk.yellow('‚ö†Ô∏è Êú™ÊâæÂà∞ tsconfig.jsonÔºåË∑≥Ëøá TypeScript Ê£ÄÊü•'));\n      return;\n    }\n\n    try {\n      const { stdout: output } = await execAsync('npx tsc --noEmit --pretty false', {\n        encoding: 'utf8',\n        cwd: this.projectRoot,\n      });\n      console.log(chalk.green('‚úÖ TypeScript Á±ªÂûãÊ£ÄÊü•ÈÄöËøá'));\n    } catch (error) {\n      const output = error.stdout?.toString() || '';\n      const lines = output.split('\\n').filter((line) => line.trim());\n\n      lines.forEach((line) => {\n        if (line.includes('error TS')) {\n          this.metrics.typescript.errors++;\n        } else if (line.includes('warning TS')) {\n          this.metrics.typescript.warnings++;\n        }\n      });\n\n      console.log(\n        chalk.yellow(\n          `‚ö†Ô∏è TypeScript Ê£ÄÊü•ÂèëÁé∞: ${this.metrics.typescript.errors} ÈîôËØØ, ${this.metrics.typescript.warnings} Ë≠¶Âëä`\n        )\n      );\n    }\n  }\n\n  /**\n   * ÊµãËØïË¶ÜÁõñÁéáÂàÜÊûê\n   */\n  async runTestCoverage() {\n    console.log(chalk.yellow('üß™ ËøêË°åÊµãËØïË¶ÜÁõñÁéáÂàÜÊûê...'));\n\n    try {\n      const { stdout: output } = await execAsync('npm run test:coverage -- --silent', {\n        encoding: 'utf8',\n        cwd: this.projectRoot,\n      });\n\n      // Ëß£ÊûêË¶ÜÁõñÁéáÊä•Âëä\n      const coverageMatch = output.match(/All files\\s+\\|\\s+([\\d.]+)/);\n      if (coverageMatch) {\n        this.metrics.tests.coverage = parseFloat(coverageMatch[1]);\n      }\n\n      // Ëß£ÊûêÊµãËØïÁªìÊûú\n      const passedMatch = output.match(/(\\d+) passing/);\n      const failedMatch = output.match(/(\\d+) failing/);\n\n      if (passedMatch) {\n        this.metrics.tests.passed = parseInt(passedMatch[1]);\n      }\n      if (failedMatch) {\n        this.metrics.tests.failed = parseInt(failedMatch[1]);\n      }\n\n      console.log(chalk.green(`‚úÖ ÊµãËØïË¶ÜÁõñÁéá: ${this.metrics.tests.coverage}%`));\n    } catch (error) {\n      console.log(chalk.yellow('‚ö†Ô∏è ÊµãËØïË¶ÜÁõñÁéáÂàÜÊûêÂ§±Ë¥•'));\n    }\n  }\n\n  /**\n   * ÂÆâÂÖ®ÊºèÊ¥ûÊ£ÄÊü•\n   */\n  async runSecurityAudit() {\n    console.log(chalk.yellow('üîí ËøêË°åÂÆâÂÖ®ÊºèÊ¥ûÊ£ÄÊü•...'));\n\n    try {\n      const { stdout: output } = await execAsync('npm audit --json', {\n        encoding: 'utf8',\n        cwd: this.projectRoot,\n      });\n\n      const auditResult = JSON.parse(output);\n\n      if (auditResult.vulnerabilities) {\n        Object.values(auditResult.vulnerabilities).forEach((vuln) => {\n          this.metrics.security.vulnerabilities++;\n          const { severity } = vuln;\n          this.metrics.security.severity[severity] =\n            (this.metrics.security.severity[severity] || 0) + 1;\n        });\n      }\n\n      console.log(chalk.green(`‚úÖ ÂÆâÂÖ®Ê£ÄÊü•ÂÆåÊàê: ${this.metrics.security.vulnerabilities} ‰∏™ÊºèÊ¥û`));\n    } catch (error) {\n      console.log(chalk.yellow('‚ö†Ô∏è ÂÆâÂÖ®Ê£ÄÊü•Â§±Ë¥•'));\n    }\n  }\n\n  /**\n   * ‰ª£Á†ÅÂ§çÊùÇÂ∫¶ÂàÜÊûê\n   */\n  async runComplexityAnalysis() {\n    console.log(chalk.yellow('üìä ÂàÜÊûê‰ª£Á†ÅÂ§çÊùÇÂ∫¶...'));\n\n    try {\n      // ‰ΩøÁî® ESLint ÁöÑÂ§çÊùÇÂ∫¶ËßÑÂàôËøõË°åÂàÜÊûê\n      const { stdout: output } = await execAsync(\n        'npx eslint . --format json --no-eslintrc --config .eslintrc.enhanced.cjs',\n        { encoding: 'utf8', cwd: this.projectRoot }\n      );\n\n      const results = JSON.parse(output);\n      const complexityViolations = [];\n\n      results.forEach((result) => {\n        result.messages.forEach((message) => {\n          if (message.ruleId === 'complexity') {\n            complexityViolations.push(message);\n            this.metrics.complexity.violations++;\n          }\n        });\n      });\n\n      console.log(chalk.green(`‚úÖ Â§çÊùÇÂ∫¶ÂàÜÊûêÂÆåÊàê: ${this.metrics.complexity.violations} ‰∏™ËøùËßÑ`));\n    } catch (error) {\n      console.log(chalk.yellow('‚ö†Ô∏è Â§çÊùÇÂ∫¶ÂàÜÊûêÂ§±Ë¥•'));\n    }\n  }\n\n  /**\n   * ÈáçÂ§ç‰ª£Á†ÅÊ£ÄÊµã\n   */\n  async runDuplicateDetection() {\n    console.log(chalk.yellow('üîç Ê£ÄÊµãÈáçÂ§ç‰ª£Á†Å...'));\n\n    try {\n      // ÁÆÄÂçïÁöÑÈáçÂ§ç‰ª£Á†ÅÊ£ÄÊµãÈÄªËæë\n      const jsFiles = await this.getJavaScriptFiles();\n      const duplicates = await this.findDuplicates(jsFiles);\n\n      this.metrics.duplicates.lines = duplicates.totalLines;\n      this.metrics.duplicates.percentage = duplicates.percentage;\n\n      console.log(\n        chalk.green(`‚úÖ ÈáçÂ§ç‰ª£Á†ÅÊ£ÄÊµãÂÆåÊàê: ${this.metrics.duplicates.percentage}% ÈáçÂ§çÁéá`)\n      );\n    } catch (error) {\n      console.log(chalk.yellow('‚ö†Ô∏è ÈáçÂ§ç‰ª£Á†ÅÊ£ÄÊµãÂ§±Ë¥•'));\n    }\n  }\n\n  /**\n   * ‰æùËµñÈ°πÊ£ÄÊü•\n   */\n  async runDependencyCheck() {\n    console.log(chalk.yellow('üì¶ Ê£ÄÊü•‰æùËµñÈ°πÁä∂ÊÄÅ...'));\n\n    try {\n      const { stdout: output } = await execAsync('npm outdated --json', {\n        encoding: 'utf8',\n        cwd: this.projectRoot,\n      });\n\n      const outdated = JSON.parse(output);\n      this.metrics.dependencies.outdated = Object.keys(outdated).length;\n\n      console.log(chalk.green(`‚úÖ ‰æùËµñÊ£ÄÊü•ÂÆåÊàê: ${this.metrics.dependencies.outdated} ‰∏™ËøáÊúü‰æùËµñ`));\n    } catch (error) {\n      // npm outdated Âú®ÊúâËøáÊúü‰æùËµñÊó∂‰ºöËøîÂõûÈùûÈõ∂ÈÄÄÂá∫Á†Å\n      if (error.stdout) {\n        const outdated = JSON.parse(error.stdout);\n        this.metrics.dependencies.outdated = Object.keys(outdated).length;\n      }\n      console.log(chalk.green(`‚úÖ ‰æùËµñÊ£ÄÊü•ÂÆåÊàê: ${this.metrics.dependencies.outdated} ‰∏™ËøáÊúü‰æùËµñ`));\n    }\n  }\n\n  /**\n   * ËÆ°ÁÆóÊÄª‰ΩìË¥®ÈáèÂàÜÊï∞\n   */\n  calculateQualityScore() {\n    let score = 100;\n\n    // ESLint ÈîôËØØÂíåË≠¶ÂëäÊâ£ÂàÜ\n    score -= this.metrics.eslint.errors * 2;\n    score -= this.metrics.eslint.warnings * 0.5;\n\n    // Ê†ºÂºèÈóÆÈ¢òÊâ£ÂàÜ\n    score -= this.metrics.prettier.violations * 0.1;\n\n    // TypeScript ÈîôËØØÊâ£ÂàÜ\n    score -= this.metrics.typescript.errors * 1.5;\n    score -= this.metrics.typescript.warnings * 0.3;\n\n    // ÊµãËØïË¶ÜÁõñÁéáÂä†ÂàÜ/Êâ£ÂàÜ\n    if (this.metrics.tests.coverage >= 80) {\n      score += 10;\n    } else if (this.metrics.tests.coverage < 50) {\n      score -= 15;\n    }\n\n    // ÂÆâÂÖ®ÊºèÊ¥ûÊâ£ÂàÜ\n    score -= this.metrics.security.vulnerabilities * 3;\n\n    // Â§çÊùÇÂ∫¶ËøùËßÑÊâ£ÂàÜ\n    score -= this.metrics.complexity.violations * 1;\n\n    // ÈáçÂ§ç‰ª£Á†ÅÊâ£ÂàÜ\n    score -= this.metrics.duplicates.percentage * 0.5;\n\n    // ËøáÊúü‰æùËµñÊâ£ÂàÜ\n    score -= this.metrics.dependencies.outdated * 0.2;\n\n    this.qualityScore = Math.max(0, Math.min(100, score));\n  }\n\n  /**\n   * ÁîüÊàêÊîπËøõÂª∫ËÆÆ\n   */\n  generateRecommendations() {\n    if (this.metrics.eslint.errors > 0) {\n      this.recommendations.push({\n        priority: 'high',\n        category: 'code_quality',\n        message: `‰øÆÂ§ç ${this.metrics.eslint.errors} ‰∏™ ESLint ÈîôËØØ`,\n        action: 'npm run lint:fix',\n      });\n    }\n\n    if (this.metrics.prettier.violations > 0) {\n      this.recommendations.push({\n        priority: 'medium',\n        category: 'formatting',\n        message: `‰øÆÂ§ç ${this.metrics.prettier.violations} ‰∏™Ê†ºÂºèÈóÆÈ¢ò`,\n        action: 'npm run format',\n      });\n    }\n\n    if (this.metrics.tests.coverage < 80) {\n      this.recommendations.push({\n        priority: 'high',\n        category: 'testing',\n        message: `ÊèêÂçáÊµãËØïË¶ÜÁõñÁéáËá≥ 80% ‰ª•‰∏äÔºàÂΩìÂâç: ${this.metrics.tests.coverage}%Ôºâ`,\n        action: 'ÁºñÂÜôÊõ¥Â§öÂçïÂÖÉÊµãËØïÂíåÈõÜÊàêÊµãËØï',\n      });\n    }\n\n    if (this.metrics.security.vulnerabilities > 0) {\n      this.recommendations.push({\n        priority: 'critical',\n        category: 'security',\n        message: `‰øÆÂ§ç ${this.metrics.security.vulnerabilities} ‰∏™ÂÆâÂÖ®ÊºèÊ¥û`,\n        action: 'npm audit fix',\n      });\n    }\n\n    if (this.metrics.dependencies.outdated > 5) {\n      this.recommendations.push({\n        priority: 'medium',\n        category: 'maintenance',\n        message: `Êõ¥Êñ∞ ${this.metrics.dependencies.outdated} ‰∏™ËøáÊúü‰æùËµñ`,\n        action: 'npm update',\n      });\n    }\n  }\n\n  /**\n   * ÁîüÊàêËØ¶ÁªÜÊä•Âëä\n   */\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 30 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 30 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 30 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 30 Ë°å)\n\n  async generateReport() {\n    const report = {\n      timestamp: new Date().toISOString(),\n      qualityScore: this.qualityScore,\n      metrics: this.metrics,\n      recommendations: this.recommendations,\n      summary: {\n        totalIssues:\n          this.metrics.eslint.errors +\n          this.metrics.eslint.warnings +\n          this.metrics.typescript.errors +\n          this.metrics.security.vulnerabilities,\n        criticalIssues:\n          this.metrics.eslint.errors +\n          this.metrics.typescript.errors +\n          this.metrics.security.vulnerabilities,\n        testCoverage: this.metrics.tests.coverage,\n        codeQuality: this.getQualityGrade(),\n      },\n    };\n\n    // ‰øùÂ≠ò JSON Êä•Âëä\n    await fs.promises.writeFile(\n      path.join(this.reportDir, `quality-report-${this.timestamp}.json`),\n      JSON.stringify(report, null, 2)\n    );\n\n    // ÁîüÊàê HTML Êä•Âëä\n    await this.generateHTMLReport(report);\n  }\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 81 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 81 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 81 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 81 Ë°å)\n\n  /**\n   * ÁîüÊàê HTML Êä•Âëä\n   */\n  async generateHTMLReport(report) {\n    const html = `\n<!DOCTYPE html>\n<html lang=\"zh-CN\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>‰ª£Á†ÅË¥®ÈáèÊä•Âëä - ${new Date().toLocaleDateString()}</title>\n    <style>\n        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; margin: 0; padding: 20px; background: #f5f5f5; }\n        .container { max-width: 1200px; margin: 0 auto; background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }\n        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 8px 8px 0 0; }\n        .score { font-size: 3em; font-weight: bold; text-align: center; margin: 20px 0; }\n        .grade { font-size: 1.5em; text-align: center; opacity: 0.9; }\n        .metrics { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; padding: 30px; }\n        .metric-card { background: #f8f9fa; border-radius: 8px; padding: 20px; border-left: 4px solid #007bff; }\n        .metric-title { font-weight: bold; color: #495057; margin-bottom: 10px; }\n        .metric-value { font-size: 2em; font-weight: bold; color: #007bff; }\n        .recommendations { padding: 30px; }\n        .recommendation { background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 4px; padding: 15px; margin: 10px 0; }\n        .priority-critical { border-left: 4px solid #dc3545; }\n        .priority-high { border-left: 4px solid #fd7e14; }\n        .priority-medium { border-left: 4px solid #ffc107; }\n        .priority-low { border-left: 4px solid #28a745; }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        <div class=\"header\">\n            <h1>‰ª£Á†ÅË¥®ÈáèÊä•Âëä</h1>\n            <div class=\"score\">${report.qualityScore.toFixed(1)}</div>\n            <div class=\"grade\">Ë¥®ÈáèÁ≠âÁ∫ß: ${report.summary.codeQuality}</div>\n            <p>ÁîüÊàêÊó∂Èó¥: ${new Date(report.timestamp).toLocaleString()}</p>\n        </div>\n        \n        <div class=\"metrics\">\n            <div class=\"metric-card\">\n                <div class=\"metric-title\">ESLint ÈóÆÈ¢ò</div>\n                <div class=\"metric-value\">${report.metrics.eslint.errors + report.metrics.eslint.warnings}</div>\n                <div>ÈîôËØØ: ${report.metrics.eslint.errors}, Ë≠¶Âëä: ${report.metrics.eslint.warnings}</div>\n            </div>\n            \n            <div class=\"metric-card\">\n                <div class=\"metric-title\">ÊµãËØïË¶ÜÁõñÁéá</div>\n                <div class=\"metric-value\">${report.metrics.tests.coverage}%</div>\n                <div>ÈÄöËøá: ${report.metrics.tests.passed}, Â§±Ë¥•: ${report.metrics.tests.failed}</div>\n            </div>\n            \n            <div class=\"metric-card\">\n                <div class=\"metric-title\">ÂÆâÂÖ®ÊºèÊ¥û</div>\n                <div class=\"metric-value\">${report.metrics.security.vulnerabilities}</div>\n                <div>ÈúÄË¶ÅÁ´ãÂç≥‰øÆÂ§ç</div>\n            </div>\n            \n            <div class=\"metric-card\">\n                <div class=\"metric-title\">‰ª£Á†ÅÂ§çÊùÇÂ∫¶</div>\n                <div class=\"metric-value\">${report.metrics.complexity.violations}</div>\n                <div>Â§çÊùÇÂ∫¶ËøùËßÑ</div>\n            </div>\n        </div>\n        \n        <div class=\"recommendations\">\n            <h2>ÊîπËøõÂª∫ËÆÆ</h2>\n            ${report.recommendations\n              .map(\n                (rec) => `\n                <div class=\"recommendation priority-${rec.priority}\">\n                    <strong>${rec.message}</strong><br>\n                    <small>Âª∫ËÆÆÊìç‰Ωú: ${rec.action}</small>\n                </div>\n            `\n              )\n              .join('')}\n        </div>\n    </div>\n</body>\n</html>\n    `;\n\n    await fs.promises.writeFile(\n      path.join(this.reportDir, `quality-report-${this.timestamp}.html`),\n      html\n    );\n  }\n\n  /**\n   * Ëé∑ÂèñË¥®ÈáèÁ≠âÁ∫ß\n   */\n  getQualityGrade() {\n    if (this.qualityScore >= 90) {\n      return 'A (‰ºòÁßÄ)';\n    }\n    if (this.qualityScore >= 80) {\n      return 'B (ËâØÂ•Ω)';\n    }\n    if (this.qualityScore >= 70) {\n      return 'C (‰∏ÄËà¨)';\n    }\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (this.qualityScore >= 60) {\n      return 'D (ËæÉÂ∑Æ)';\n    }\n    return 'F (ÈúÄË¶ÅÊîπËøõ)';\n  }\n\n  /**\n   * Ëé∑Âèñ JavaScript Êñá‰ª∂ÂàóË°®\n   */\n  async getJavaScriptFiles() {\n    const files = [];\n    const extensions = ['.js', '.ts', '.jsx', '.tsx'];\n\n    async function walkDir(dir) {\n      try {\n        const items = await fs.promises.readdir(dir);\n\n        for (const item of items) {\n          const fullPath = path.join(dir, item);\n          const stat = await fs.promises.stat(fullPath);\n\n          // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n          // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n          if (stat.isDirectory() && !item.startsWith('.') && item !== 'node_modules') {\n            await walkDir(fullPath);\n          } else if (stat.isFile() && extensions.some((ext) => item.endsWith(ext))) {\n            files.push(fullPath);\n          }\n        }\n      } catch (error) {\n        // ÂøΩÁï•ÊùÉÈôêÈîôËØØÁ≠â\n      }\n    }\n\n    await walkDir(path.join(this.projectRoot, 'src'));\n    return files;\n  }\n\n  /**\n   * ÁÆÄÂçïÁöÑÈáçÂ§ç‰ª£Á†ÅÊ£ÄÊµã\n   */\n  async findDuplicates(files) {\n    // ËøôÊòØ‰∏Ä‰∏™ÁÆÄÂåñÁöÑÂÆûÁé∞ÔºåÂÆûÈôÖÈ°πÁõÆ‰∏≠ÂèØ‰ª•‰ΩøÁî®Êõ¥‰∏ì‰∏öÁöÑÂ∑•ÂÖ∑\n    let totalLines = 0;\n    const duplicateLines = 0;\n\n    for (const file of files) {\n      try {\n        const content = await fs.promises.readFile(file, 'utf8');\n        const lines = content.split('\\n').filter((line) => line.trim());\n        totalLines += lines.length;\n      } catch (error) {\n        // ÂøΩÁï•ËØªÂèñÈîôËØØ\n      }\n    }\n\n    return {\n      totalLines,\n      duplicateLines,\n      percentage: totalLines > 0 ? (duplicateLines / totalLines) * 100 : 0,\n    };\n  }\n\n  /**\n   * ÊòæÁ§∫ÂàÜÊûêÊëòË¶Å\n   */\n  displaySummary() {\n    console.log(`\\n${chalk.blue.bold('üìä ‰ª£Á†ÅË¥®ÈáèÂàÜÊûêÊëòË¶Å')}`);\n    console.log(chalk.blue('='.repeat(50)));\n\n    console.log(\n      `\\n${chalk.bold('ÊÄª‰ΩìË¥®ÈáèÂàÜÊï∞:')} ${this.getScoreColor(this.qualityScore)}${this.qualityScore.toFixed(1)}/100${chalk.reset()} (${this.getQualityGrade()})`\n    );\n\n    console.log(`\\n${chalk.bold('ÂÖ≥ÈîÆÊåáÊ†á:')}`);\n    console.log(\n      `  ESLint ÈóÆÈ¢ò: ${this.getIssueColor(this.metrics.eslint.errors + this.metrics.eslint.warnings)}${this.metrics.eslint.errors + this.metrics.eslint.warnings}${chalk.reset()}`\n    );\n    console.log(\n      `  ÊµãËØïË¶ÜÁõñÁéá: ${this.getCoverageColor(this.metrics.tests.coverage)}${this.metrics.tests.coverage}%${chalk.reset()}`\n    );\n    console.log(\n      `  ÂÆâÂÖ®ÊºèÊ¥û: ${this.getVulnColor(this.metrics.security.vulnerabilities)}${this.metrics.security.vulnerabilities}${chalk.reset()}`\n    );\n    console.log(`  ËøáÊúü‰æùËµñ: ${this.metrics.dependencies.outdated}`);\n\n    if (this.recommendations.length > 0) {\n      console.log(`\\n${chalk.bold('‰ºòÂÖàÊîπËøõÂª∫ËÆÆ:')}`);\n      this.recommendations\n        .filter((rec) => rec.priority === 'critical' || rec.priority === 'high')\n        .slice(0, 3)\n        .forEach((rec, index) => {\n          console.log(`  ${index + 1}. ${rec.message}`);\n        });\n    }\n\n    console.log(\n      `\\n${chalk.bold('Êä•Âëä‰ΩçÁΩÆ:')} ${path.join(this.reportDir, `quality-report-${this.timestamp}.html`)}`\n    );\n    console.log(chalk.blue('='.repeat(50)));\n  }\n\n  /**\n   * Ëé∑ÂèñÂàÜÊï∞È¢úËâ≤\n   */\n  getScoreColor(score) {\n    if (score >= 90) {\n      return chalk.green;\n    }\n    if (score >= 80) {\n      return chalk.yellow;\n    }\n    if (score >= 70) {\n      return chalk.orange;\n    }\n    return chalk.red;\n  }\n\n  /**\n   * Ëé∑ÂèñÈóÆÈ¢òÊï∞ÈáèÈ¢úËâ≤\n   */\n  getIssueColor(count) {\n    if (count === 0) {\n      return chalk.green;\n    }\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (count <= 5) {\n      return chalk.yellow;\n    }\n    return chalk.red;\n  }\n\n  /**\n   * Ëé∑ÂèñË¶ÜÁõñÁéáÈ¢úËâ≤\n   */\n  getCoverageColor(coverage) {\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (coverage >= 80) {\n      return chalk.green;\n    }\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (coverage >= 60) {\n      return chalk.yellow;\n    }\n    return chalk.red;\n  }\n\n  /**\n   * Ëé∑ÂèñÊºèÊ¥ûÊï∞ÈáèÈ¢úËâ≤\n   */\n  getVulnColor(count) {\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (count === 0) {\n      return chalk.green;\n    }\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (count <= 2) {\n      return chalk.yellow;\n    }\n    return chalk.red;\n  }\n}\n\n// ‰∏ªÁ®ãÂ∫èÂÖ•Âè£\n// TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n// TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n// TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n// TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\nif (import.meta.url === `file://${process.argv[1]}`) {\n  const monitor = new CodeQualityMonitor();\n  monitor.runFullAnalysis().catch((error) => {\n    console.error(chalk.red('‚ùå Á®ãÂ∫èÊâßË°åÂ§±Ë¥•:'), error);\n    process.exit(1);\n  });\n}\n\nexport default CodeQualityMonitor;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/scripts/complexity-analyzer.js","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":157,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":157,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[3858,3924],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 171.","line":169,"column":7,"nodeType":"Literal","messageId":"noMagic","endLine":169,"endColumn":10},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5.2.","line":169,"column":13,"nodeType":"Literal","messageId":"noMagic","endLine":169,"endColumn":16},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.23.","line":169,"column":46,"nodeType":"Literal","messageId":"noMagic","endLine":169,"endColumn":50},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 16.2.","line":169,"column":66,"nodeType":"Literal","messageId":"noMagic","endLine":169,"endColumn":70},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":228,"column":43,"nodeType":"Literal","messageId":"noMagic","endLine":228,"endColumn":45},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 20.","line":228,"column":77,"nodeType":"Literal","messageId":"noMagic","endLine":228,"endColumn":79},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5.","line":250,"column":53,"nodeType":"Literal","messageId":"noMagic","endLine":250,"endColumn":54},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 3.","line":260,"column":52,"nodeType":"Literal","messageId":"noMagic","endLine":260,"endColumn":53},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 200.","line":265,"column":60,"nodeType":"Literal","messageId":"noMagic","endLine":265,"endColumn":63},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5.","line":271,"column":36,"nodeType":"Literal","messageId":"noMagic","endLine":271,"endColumn":37},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":276,"column":76,"nodeType":"Literal","messageId":"noMagic","endLine":276,"endColumn":78},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5.","line":282,"column":48,"nodeType":"Literal","messageId":"noMagic","endLine":282,"endColumn":49},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":291,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":291,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[7667,7698],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":298,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":298,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[7854,7895],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":306,"column":28,"nodeType":"Literal","messageId":"noMagic","endLine":306,"endColumn":30},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":307,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":307,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[8081,8141],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":315,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":315,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[8248,8298],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":320,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":320,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[8458,8498],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":332,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":332,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[8661,8690],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":333,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":333,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[8695,8741],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":334,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":334,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[8746,8793],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":335,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":335,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[8798,8848],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":336,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":336,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[8853,8907],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":337,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":337,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[8912,8976],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":338,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":338,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[8981,9038],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":341,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":341,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[9084,9110],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":343,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":343,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[9167,9246],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":349,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":349,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[9342,9390],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":350,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":350,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[9395,9457],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"Number constants declarations must use 'const'.","line":355,"column":17,"nodeType":"Literal","messageId":"useConst","endLine":355,"endColumn":20},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 15.","line":358,"column":37,"nodeType":"Literal","messageId":"noMagic","endLine":358,"endColumn":39},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 30.","line":359,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":359,"endColumn":18},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":360,"column":44,"nodeType":"Literal","messageId":"noMagic","endLine":360,"endColumn":46},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 20.","line":361,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":361,"endColumn":18},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5.","line":362,"column":44,"nodeType":"Literal","messageId":"noMagic","endLine":362,"endColumn":45},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":363,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":363,"endColumn":18},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.3.","line":368,"column":31,"nodeType":"Literal","messageId":"noMagic","endLine":368,"endColumn":34},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 25.","line":369,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":369,"endColumn":18},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.2.","line":370,"column":38,"nodeType":"Literal","messageId":"noMagic","endLine":370,"endColumn":41},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 15.","line":371,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":371,"endColumn":18},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.1.","line":372,"column":38,"nodeType":"Literal","messageId":"noMagic","endLine":372,"endColumn":41},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":373,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":373,"endColumn":18},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":377,"column":40,"nodeType":"Literal","messageId":"noMagic","endLine":377,"endColumn":42},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 20.","line":378,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":378,"endColumn":18},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5.","line":379,"column":47,"nodeType":"Literal","messageId":"noMagic","endLine":379,"endColumn":48},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":380,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":380,"endColumn":18},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5.","line":382,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":382,"endColumn":17},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 90.","line":390,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":390,"endColumn":20},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 80.","line":397,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":397,"endColumn":20},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 70.","line":404,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":404,"endColumn":20},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":411,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":411,"endColumn":20},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":428,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":428,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[11280,11320],"text":""},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":53,"fixableErrorCount":0,"fixableWarningCount":0,"source":"#!/usr/bin/env node\n\nimport fs from 'fs';\nimport path from 'path';\nimport { fileURLToPath } from 'url';\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\n\nclass ComplexityAnalyzer {\n  constructor() {\n    this.results = {\n      files: [],\n      summary: {\n        totalFiles: 0,\n        totalLines: 0,\n        totalFunctions: 0,\n        averageComplexity: 0,\n        highComplexityFiles: [],\n        duplicateCode: [],\n      },\n    };\n  }\n\n  // ËÆ°ÁÆóÂúàÂ§çÊùÇÂ∫¶\n  calculateCyclomaticComplexity(code) {\n    let complexity = 1; // Âü∫Á°ÄÂ§çÊùÇÂ∫¶\n\n    // Êù°‰ª∂ËØ≠Âè•\n    const conditionalPatterns = [\n      /\\bif\\s*\\(/g,\n      /\\belse\\s+if\\s*\\(/g,\n      /\\bwhile\\s*\\(/g,\n      /\\bfor\\s*\\(/g,\n      /\\bdo\\s*\\{/g,\n      /\\bswitch\\s*\\(/g,\n      /\\bcase\\s+/g,\n      /\\bcatch\\s*\\(/g,\n      /\\?.*:/g, // ‰∏âÂÖÉÊìç‰ΩúÁ¨¶\n      /&&/g,\n      /\\|\\|/g,\n    ];\n\n    conditionalPatterns.forEach((pattern) => {\n      const matches = code.match(pattern);\n      if (matches) {\n        complexity += matches.length;\n      }\n    });\n\n    return complexity;\n  }\n\n  // ËÆ°ÁÆóÂáΩÊï∞Êï∞Èáè\n  countFunctions(code) {\n    const functionPatterns = [\n      /function\\s+\\w+\\s*\\(/g,\n      /\\w+\\s*:\\s*function\\s*\\(/g,\n      /\\w+\\s*=\\s*function\\s*\\(/g,\n      /\\w+\\s*=>\\s*/g,\n      /async\\s+function\\s+\\w+\\s*\\(/g,\n      /async\\s+\\w+\\s*=>/g,\n    ];\n\n    let functionCount = 0;\n    functionPatterns.forEach((pattern) => {\n      const matches = code.match(pattern);\n      if (matches) {\n        functionCount += matches.length;\n      }\n    });\n\n    return functionCount;\n  }\n\n  // ËÆ°ÁÆó‰ª£Á†ÅË°åÊï∞ÔºàÊéíÈô§Á©∫Ë°åÂíåÊ≥®ÈáäÔºâ\n  countEffectiveLines(code) {\n    const lines = code.split('\\n');\n    let effectiveLines = 0;\n\n    for (const line of lines) {\n      const trimmedLine = line.trim();\n      // ÊéíÈô§Á©∫Ë°åÂíåÂçïË°åÊ≥®Èáä\n      if (\n        trimmedLine &&\n        !trimmedLine.startsWith('//') &&\n        !trimmedLine.startsWith('*') &&\n        !trimmedLine.startsWith('/*')\n      ) {\n        effectiveLines++;\n      }\n    }\n\n    return effectiveLines;\n  }\n\n  // Ê£ÄÊµãÈáçÂ§ç‰ª£Á†Å\n  detectDuplicateCode(code, filePath) {\n    const lines = code.split('\\n');\n    const duplicates = [];\n    const minDuplicateLength = 5; // ÊúÄÂ∞èÈáçÂ§çË°åÊï∞\n\n    for (let i = 0; i < lines.length - minDuplicateLength; i++) {\n      for (let j = i + minDuplicateLength; j < lines.length - minDuplicateLength; j++) {\n        let duplicateLength = 0;\n\n        // Ê£ÄÊü•ËøûÁª≠ÈáçÂ§çË°å\n        while (\n          i + duplicateLength < lines.length &&\n          j + duplicateLength < lines.length &&\n          lines[i + duplicateLength].trim() === lines[j + duplicateLength].trim() &&\n          lines[i + duplicateLength].trim() !== ''\n        ) {\n          duplicateLength++;\n        }\n\n        if (duplicateLength >= minDuplicateLength) {\n          duplicates.push({\n            file: filePath,\n            startLine1: i + 1,\n            endLine1: i + duplicateLength,\n            startLine2: j + 1,\n            endLine2: j + duplicateLength,\n            duplicateLines: duplicateLength,\n          });\n        }\n      }\n    }\n\n    return duplicates;\n  }\n\n  // ÂàÜÊûêÂçï‰∏™Êñá‰ª∂\n  analyzeFile(filePath) {\n    try {\n      const code = fs.readFileSync(filePath, 'utf8');\n      const lines = this.countEffectiveLines(code);\n      const functions = this.countFunctions(code);\n      const complexity = this.calculateCyclomaticComplexity(code);\n      const duplicates = this.detectDuplicateCode(code, filePath);\n\n      const fileResult = {\n        path: filePath,\n        lines,\n        functions,\n        complexity,\n        averageComplexityPerFunction: functions > 0 ? (complexity / functions).toFixed(2) : 0,\n        maintainabilityIndex: this.calculateMaintainabilityIndex(lines, complexity, functions),\n        duplicates: duplicates.length,\n      };\n\n      this.results.files.push(fileResult);\n      this.results.summary.duplicateCode.push(...duplicates);\n\n      return fileResult;\n    } catch (error) {\n      console.error(`Error analyzing file ${filePath}:`, error.message);\n      return null;\n    }\n  }\n\n  // ËÆ°ÁÆóÂèØÁª¥Êä§ÊÄßÊåáÊï∞\n  calculateMaintainabilityIndex(lines, complexity, functions) {\n    // ÁÆÄÂåñÁöÑÂèØÁª¥Êä§ÊÄßÊåáÊï∞ËÆ°ÁÆó\n    // Âü∫‰∫é Halstead Â§çÊùÇÂ∫¶ÂíåÂúàÂ§çÊùÇÂ∫¶ÁöÑÁÆÄÂåñÁâàÊú¨\n    const halsteadVolume = Math.log2(lines + functions) * (lines + functions);\n    const maintainabilityIndex = Math.max(\n      0,\n      171 - 5.2 * Math.log(halsteadVolume) - 0.23 * complexity - 16.2 * Math.log(lines)\n    );\n\n    return Math.round(maintainabilityIndex);\n  }\n\n  // Êâ´ÊèèÁõÆÂΩï\n  scanDirectory(dirPath, extensions = ['.js', '.mjs', '.ts']) {\n    const files = [];\n\n    function scanRecursive(currentPath) {\n      const items = fs.readdirSync(currentPath);\n\n      for (const item of items) {\n        const fullPath = path.join(currentPath, item);\n        const stat = fs.statSync(fullPath);\n\n        if (stat.isDirectory()) {\n          // Ë∑≥Ëøá node_modules ÂíåÂÖ∂‰ªñ‰∏çÈúÄË¶ÅÁöÑÁõÆÂΩï\n          if (!['node_modules', '.git', 'dist', 'build', 'coverage'].includes(item)) {\n            scanRecursive(fullPath);\n          }\n        } else if (stat.isFile()) {\n          const ext = path.extname(fullPath);\n          if (extensions.includes(ext)) {\n            files.push(fullPath);\n          }\n        }\n      }\n    }\n\n    scanRecursive(dirPath);\n    return files;\n  }\n\n  // ÁîüÊàêÊä•Âëä\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 22 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 22 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 22 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 22 Ë°å)\n\n  generateReport() {\n    const { files, summary } = this.results;\n\n    // ËÆ°ÁÆóÊ±áÊÄªÁªüËÆ°\n    summary.totalFiles = files.length;\n    summary.totalLines = files.reduce((sum, file) => sum + file.lines, 0);\n    summary.totalFunctions = files.reduce((sum, file) => sum + file.functions, 0);\n    summary.averageComplexity =\n      files.length > 0\n        ? (files.reduce((sum, file) => sum + file.complexity, 0) / files.length).toFixed(2)\n        : 0;\n\n    // ÊâæÂá∫È´òÂ§çÊùÇÂ∫¶Êñá‰ª∂\n    summary.highComplexityFiles = files\n      .filter((file) => file.complexity > 10 || file.maintainabilityIndex < 20)\n      .sort((a, b) => b.complexity - a.complexity);\n\n    return {\n      timestamp: new Date().toISOString(),\n      summary,\n      files: files.sort((a, b) => b.complexity - a.complexity),\n      recommendations: this.generateRecommendations(),\n    };\n  }\n\n  // ÁîüÊàêÊîπËøõÂª∫ËÆÆ\n  generateRecommendations() {\n    const { files, summary } = this.results;\n    const recommendations = [];\n\n    // È´òÂ§çÊùÇÂ∫¶Êñá‰ª∂Âª∫ËÆÆ\n    if (summary.highComplexityFiles.length > 0) {\n      recommendations.push({\n        type: 'complexity',\n        priority: 'high',\n        message: `ÂèëÁé∞ ${summary.highComplexityFiles.length} ‰∏™È´òÂ§çÊùÇÂ∫¶Êñá‰ª∂ÔºåÂª∫ËÆÆÈáçÊûÑ‰ª•Èôç‰ΩéÂ§çÊùÇÂ∫¶`,\n        files: summary.highComplexityFiles.slice(0, 5).map((f) => f.path),\n      });\n    }\n\n    // ÈáçÂ§ç‰ª£Á†ÅÂª∫ËÆÆ\n    if (summary.duplicateCode.length > 0) {\n      recommendations.push({\n        type: 'duplication',\n        priority: 'medium',\n        message: `ÂèëÁé∞ ${summary.duplicateCode.length} Â§ÑÈáçÂ§ç‰ª£Á†ÅÔºåÂª∫ËÆÆÊèêÂèñÂÖ¨ÂÖ±ÂáΩÊï∞`,\n        duplicates: summary.duplicateCode.slice(0, 3),\n      });\n    }\n\n    // Â§ßÊñá‰ª∂Âª∫ËÆÆ\n    const largeFiles = files.filter((file) => file.lines > 200);\n    if (largeFiles.length > 0) {\n      recommendations.push({\n        type: 'file_size',\n        priority: 'medium',\n        message: `ÂèëÁé∞ ${largeFiles.length} ‰∏™Â§ßÊñá‰ª∂Ôºà>200Ë°åÔºâÔºåÂª∫ËÆÆÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÊ®°Âùó`,\n        files: largeFiles.slice(0, 5).map((f) => f.path),\n      });\n    }\n\n    // ÂáΩÊï∞ËøáÂ§öÂª∫ËÆÆ\n    const filesWithManyFunctions = files.filter((file) => file.functions > 10);\n    if (filesWithManyFunctions.length > 0) {\n      recommendations.push({\n        type: 'function_count',\n        priority: 'low',\n        message: `ÂèëÁé∞ ${filesWithManyFunctions.length} ‰∏™Êñá‰ª∂ÂåÖÂê´ËøáÂ§öÂáΩÊï∞Ôºà>10‰∏™ÔºâÔºåÂª∫ËÆÆÈáçÊñ∞ÁªÑÁªá‰ª£Á†ÅÁªìÊûÑ`,\n        files: filesWithManyFunctions.slice(0, 5).map((f) => f.path),\n      });\n    }\n\n    return recommendations;\n  }\n\n  // ËøêË°åÂàÜÊûê\n  async run(targetPath = '.') {\n    console.log('üîç ÂºÄÂßã‰ª£Á†ÅÂ§çÊùÇÂ∫¶ÂàÜÊûê...');\n\n    const startTime = Date.now();\n    const absolutePath = path.resolve(targetPath);\n\n    // Êâ´ÊèèÊñá‰ª∂\n    const files = this.scanDirectory(absolutePath);\n    console.log(`üìÅ ÂèëÁé∞ ${files.length} ‰∏™Êñá‰ª∂`);\n\n    // ÂàÜÊûêÊØè‰∏™Êñá‰ª∂\n    let processedFiles = 0;\n    for (const filePath of files) {\n      this.analyzeFile(filePath);\n      processedFiles++;\n\n      if (processedFiles % 10 === 0) {\n        console.log(`üìä Â∑≤Â§ÑÁêÜ ${processedFiles}/${files.length} ‰∏™Êñá‰ª∂`);\n      }\n    }\n\n    // ÁîüÊàêÊä•Âëä\n    const report = this.generateReport();\n    const endTime = Date.now();\n\n    console.log(`‚úÖ ÂàÜÊûêÂÆåÊàêÔºåËÄóÊó∂ ${endTime - startTime}ms`);\n\n    // ‰øùÂ≠òÊä•Âëä\n    const reportPath = path.join(process.cwd(), 'complexity-report.json');\n    fs.writeFileSync(reportPath, JSON.stringify(report, null, 2));\n    console.log(`üìÑ Êä•ÂëäÂ∑≤‰øùÂ≠òÂà∞: ${reportPath}`);\n\n    // ÊòæÁ§∫ÊëòË¶Å\n    this.displaySummary(report);\n\n    return report;\n  }\n\n  // ÊòæÁ§∫ÊëòË¶Å\n  displaySummary(report) {\n    const { summary, recommendations } = report;\n\n    console.log('\\nüìà Â§çÊùÇÂ∫¶ÂàÜÊûêÊëòË¶Å:');\n    console.log(`   ÊÄªÊñá‰ª∂Êï∞: ${summary.totalFiles}`);\n    console.log(`   ÊÄª‰ª£Á†ÅË°åÊï∞: ${summary.totalLines}`);\n    console.log(`   ÊÄªÂáΩÊï∞Êï∞: ${summary.totalFunctions}`);\n    console.log(`   Âπ≥ÂùáÂ§çÊùÇÂ∫¶: ${summary.averageComplexity}`);\n    console.log(`   È´òÂ§çÊùÇÂ∫¶Êñá‰ª∂: ${summary.highComplexityFiles.length}`);\n    console.log(`   ÈáçÂ§ç‰ª£Á†ÅÂùó: ${summary.duplicateCode.length}`);\n\n    if (recommendations.length > 0) {\n      console.log('\\nüí° ÊîπËøõÂª∫ËÆÆ:');\n      recommendations.forEach((rec, index) => {\n        console.log(`   ${index + 1}. [${rec.priority.toUpperCase()}] ${rec.message}`);\n      });\n    }\n\n    // Ë¥®ÈáèËØÑÁ∫ß\n    const qualityScore = this.calculateQualityScore(summary);\n    console.log(`\\nüèÜ ‰ª£Á†ÅË¥®ÈáèËØÑÂàÜ: ${qualityScore}/100`);\n    console.log(`   Ë¥®ÈáèÁ≠âÁ∫ß: ${this.getQualityGrade(qualityScore)}`);\n  }\n\n  // ËÆ°ÁÆóË¥®ÈáèËØÑÂàÜ\n  calculateQualityScore(summary) {\n    let score = 100;\n\n    // Â§çÊùÇÂ∫¶Êâ£ÂàÜ\n    if (summary.averageComplexity > 15) {\n      score -= 30;\n    } else if (summary.averageComplexity > 10) {\n      score -= 20;\n    } else if (summary.averageComplexity > 5) {\n      score -= 10;\n    }\n\n    // È´òÂ§çÊùÇÂ∫¶Êñá‰ª∂Êâ£ÂàÜ\n    const highComplexityRatio = summary.highComplexityFiles.length / summary.totalFiles;\n    if (highComplexityRatio > 0.3) {\n      score -= 25;\n    } else if (highComplexityRatio > 0.2) {\n      score -= 15;\n    } else if (highComplexityRatio > 0.1) {\n      score -= 10;\n    }\n\n    // ÈáçÂ§ç‰ª£Á†ÅÊâ£ÂàÜ\n    if (summary.duplicateCode.length > 10) {\n      score -= 20;\n    } else if (summary.duplicateCode.length > 5) {\n      score -= 10;\n    } else if (summary.duplicateCode.length > 0) {\n      score -= 5;\n    }\n\n    return Math.max(0, score);\n  }\n\n  // Ëé∑ÂèñË¥®ÈáèÁ≠âÁ∫ß\n  getQualityGrade(score) {\n    if (score >= 90) {\n      return 'A (‰ºòÁßÄ)';\n    }\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (score >= 80) {\n      return 'B (ËâØÂ•Ω)';\n    }\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (score >= 70) {\n      return 'C (‰∏ÄËà¨)';\n    }\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (score >= 60) {\n      return 'D (ËæÉÂ∑Æ)';\n    }\n    return 'F (ÈúÄË¶ÅÈáçÊûÑ)';\n  }\n}\n\n// ÂëΩ‰ª§Ë°åÊâßË°å\n// TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n// TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n// TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n// TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\nif (import.meta.url === `file://${process.argv[1]}`) {\n  const analyzer = new ComplexityAnalyzer();\n  const targetPath = process.argv[2] || '.';\n\n  analyzer.run(targetPath).catch((error) => {\n    console.error('‚ùå ÂàÜÊûêÂ§±Ë¥•:', error.message);\n    process.exit(1);\n  });\n}\n\nexport default ComplexityAnalyzer;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/scripts/complexity-optimizer.js","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":43,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":43,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[926,972],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":54,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":54,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1315,1357],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":56,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":56,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[1386,1443],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":65,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":65,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1537,1581],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":90,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":90,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2207,2274],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5.","line":91,"column":27,"nodeType":"Literal","messageId":"noMagic","endLine":91,"endColumn":28},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":92,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":92,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2330,2487],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":110,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":110,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2667,2716],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":112,"column":46,"nodeType":"Literal","messageId":"noMagic","endLine":112,"endColumn":48},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":117,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":117,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2881,2966],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"prefer-destructuring","severity":2,"message":"Use object destructuring.","line":137,"column":7,"nodeType":"AssignmentExpression","messageId":"preferDestructuring","endLine":137,"endColumn":41},{"ruleId":"prefer-destructuring","severity":2,"message":"Use object destructuring.","line":145,"column":7,"nodeType":"AssignmentExpression","messageId":"preferDestructuring","endLine":145,"endColumn":38},{"ruleId":"prefer-destructuring","severity":2,"message":"Use object destructuring.","line":153,"column":7,"nodeType":"AssignmentExpression","messageId":"preferDestructuring","endLine":153,"endColumn":35},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":160,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":160,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[3973,4058],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":168,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":168,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[4130,4174],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":183,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":183,"endColumn":24,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[4736,4906],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":200,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":200,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[5053,5098],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":212,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":212,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[5469,5581],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":226,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":226,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[5707,5750],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":239,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":239,"endColumn":24,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[6203,6372],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":256,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":256,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[6506,6549],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":268,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":268,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[6926,7038],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 3.","line":321,"column":28,"nodeType":"Literal","messageId":"noMagic","endLine":321,"endColumn":29},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 20.","line":390,"column":39,"nodeType":"Literal","messageId":"noMagic","endLine":390,"endColumn":41},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 3.","line":439,"column":28,"nodeType":"Literal","messageId":"noMagic","endLine":439,"endColumn":29},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":493,"column":36,"nodeType":"Literal","messageId":"noMagic","endLine":493,"endColumn":39},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":493,"column":66,"nodeType":"Literal","messageId":"noMagic","endLine":493,"endColumn":68},{"ruleId":"no-unused-vars","severity":2,"message":"'filePath' is defined but never used. Allowed unused args must match /^_/u.","line":507,"column":39,"nodeType":"Identifier","messageId":"unusedVar","endLine":507,"endColumn":47},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":614,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":614,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[15243,15288],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":645,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":645,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[16252,16306],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":648,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":648,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[16324,16363],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":649,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":649,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[16368,16442],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":650,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":650,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[16447,16525],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":651,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":651,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[16530,16601],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":652,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":652,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[16606,16679],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":653,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":653,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[16684,16763],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"prefer-destructuring","severity":2,"message":"Use array destructuring.","line":706,"column":9,"nodeType":"VariableDeclarator","messageId":"preferDestructuring","endLine":706,"endColumn":34},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":710,"column":43,"nodeType":"MemberExpression","messageId":"unexpected","endLine":710,"endColumn":56},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":713,"column":46,"nodeType":"MemberExpression","messageId":"unexpected","endLine":713,"endColumn":59},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":716,"column":50,"nodeType":"MemberExpression","messageId":"unexpected","endLine":716,"endColumn":63},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":719,"column":43,"nodeType":"MemberExpression","messageId":"unexpected","endLine":719,"endColumn":56},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":723,"column":32,"nodeType":"MemberExpression","messageId":"unexpected","endLine":723,"endColumn":45}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":37,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * ‰ª£Á†ÅÂ§çÊùÇÂ∫¶‰ºòÂåñËÑöÊú¨\n * Ëá™Âä®ÈáçÊûÑÈ´òÂ§çÊùÇÂ∫¶‰ª£Á†ÅÔºåÊèêÈ´òÂèØÁª¥Êä§ÊÄß\n */\n\nimport fs from 'fs';\nimport path from 'path';\nimport { fileURLToPath } from 'url';\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\n\nconst colors = {\n  red: (text) => `\\x1b[31m${text}\\x1b[0m`,\n  green: (text) => `\\x1b[32m${text}\\x1b[0m`,\n  yellow: (text) => `\\x1b[33m${text}\\x1b[0m`,\n  blue: (text) => `\\x1b[34m${text}\\x1b[0m`,\n  cyan: (text) => `\\x1b[36m${text}\\x1b[0m`,\n  magenta: (text) => `\\x1b[35m${text}\\x1b[0m`,\n};\n\nclass ComplexityOptimizer {\n  constructor() {\n    this.projectRoot = process.cwd();\n    this.optimizedFiles = new Set();\n    this.complexityThresholds = {\n      function: 10,\n      file: 200,\n      class: 15,\n    };\n    this.optimizations = {\n      extractedFunctions: 0,\n      splitClasses: 0,\n      reducedNesting: 0,\n      simplifiedConditions: 0,\n    };\n  }\n\n  /**\n   * ËøêË°åÊâÄÊúâÂ§çÊùÇÂ∫¶‰ºòÂåñ\n   */\n  async runAll() {\n    console.log(colors.blue('üîß ÂºÄÂßã‰ª£Á†ÅÂ§çÊùÇÂ∫¶‰ºòÂåñ...\\n'));\n\n    try {\n      const complexFiles = await this.analyzeComplexity();\n      await this.optimizeHighComplexityFiles(complexFiles);\n      await this.extractLongFunctions();\n      await this.simplifyNestedConditions();\n      await this.splitLargeClasses();\n      await this.optimizeLoops();\n      await this.generateOptimizationReport();\n\n      console.log(colors.green('‚úÖ ‰ª£Á†ÅÂ§çÊùÇÂ∫¶‰ºòÂåñÂÆåÊàê!'));\n    } catch (error) {\n      console.error(colors.red('‚ùå ‰ºòÂåñËøáÁ®ã‰∏≠Âá∫Áé∞ÈîôËØØ:'), error.message);\n      process.exit(1);\n    }\n  }\n\n  /**\n   * ÂàÜÊûê‰ª£Á†ÅÂ§çÊùÇÂ∫¶\n   */\n  async analyzeComplexity() {\n    console.log(colors.yellow('üìä ÂàÜÊûê‰ª£Á†ÅÂ§çÊùÇÂ∫¶...'));\n\n    const sourceFiles = this.getSourceFiles();\n    const complexFiles = [];\n\n    for (const filePath of sourceFiles) {\n      try {\n        const content = fs.readFileSync(filePath, 'utf8');\n        const complexity = this.calculateFileComplexity(content);\n\n        if (complexity.total > this.complexityThresholds.file) {\n          complexFiles.push({\n            path: filePath,\n            complexity,\n            size: content.split('\\n').length,\n          });\n        }\n      } catch (error) {\n        // ÂøΩÁï•ËØªÂèñÈîôËØØ\n      }\n    }\n\n    // ÊåâÂ§çÊùÇÂ∫¶ÊéíÂ∫è\n    complexFiles.sort((a, b) => b.complexity.total - a.complexity.total);\n\n    console.log(colors.blue(`  üìà ÂèëÁé∞ ${complexFiles.length} ‰∏™È´òÂ§çÊùÇÂ∫¶Êñá‰ª∂`));\n    complexFiles.slice(0, 5).forEach((file) => {\n      console.log(\n        colors.cyan(\n          `    ${path.relative(this.projectRoot, file.path)}: ${file.complexity.total} (${file.size} Ë°å)`\n        )\n      );\n    });\n\n    return complexFiles;\n  }\n\n  /**\n   * ‰ºòÂåñÈ´òÂ§çÊùÇÂ∫¶Êñá‰ª∂\n   */\n  async optimizeHighComplexityFiles(complexFiles) {\n    if (complexFiles.length === 0) {\n      return;\n    }\n\n    console.log(colors.yellow('\\nüõ†Ô∏è  ‰ºòÂåñÈ´òÂ§çÊùÇÂ∫¶Êñá‰ª∂...'));\n\n    for (const file of complexFiles.slice(0, 10)) {\n      // Âè™Â§ÑÁêÜÂâç10‰∏™ÊúÄÂ§çÊùÇÁöÑÊñá‰ª∂\n      try {\n        await this.optimizeFile(file.path);\n      } catch (error) {\n        console.log(colors.red(`    ‚ùå ‰ºòÂåñÂ§±Ë¥•: ${path.relative(this.projectRoot, file.path)}`));\n      }\n    }\n  }\n\n  /**\n   * ‰ºòÂåñÂçï‰∏™Êñá‰ª∂\n   */\n  async optimizeFile(filePath) {\n    let content = fs.readFileSync(filePath, 'utf8');\n    let modified = false;\n\n    // Ë∑≥ËøáËá™Â∑±ÔºåÈÅøÂÖçÊó†ÈôêÈÄíÂΩí\n    if (filePath.includes('complexity-optimizer.js')) {\n      return;\n    }\n\n    // 1. ÁÆÄÂåñÊù°‰ª∂ËØ≠Âè•\n    const conditionsResult = this.simplifyConditions(content);\n    if (conditionsResult.modified) {\n      content = conditionsResult.content;\n      modified = true;\n      this.optimizations.simplifiedConditions++;\n    }\n\n    // 2. ÂáèÂ∞ëÂµåÂ•ó\n    const nestingResult = this.reduceNesting(content);\n    if (nestingResult.modified) {\n      content = nestingResult.content;\n      modified = true;\n      this.optimizations.reducedNesting++;\n    }\n\n    // 3. Ê∑ªÂä†ÊñáÊ°£Ê≥®Èáä\n    const docsResult = this.addDocumentation(content, filePath);\n    if (docsResult.modified) {\n      content = docsResult.content;\n      modified = true;\n    }\n\n    if (modified) {\n      await fs.promises.writeFile(filePath, content);\n      this.optimizedFiles.add(filePath);\n      console.log(colors.green(`    ‚úÖ Â∑≤‰ºòÂåñ: ${path.relative(this.projectRoot, filePath)}`));\n    }\n  }\n\n  /**\n   * ÊèêÂèñÈïøÂáΩÊï∞\n   */\n  async extractLongFunctions() {\n    console.log(colors.yellow('\\nüîÑ ÊèêÂèñÈïøÂáΩÊï∞...'));\n\n    const sourceFiles = this.getSourceFiles();\n\n    for (const filePath of sourceFiles) {\n      try {\n        const content = fs.readFileSync(filePath, 'utf8');\n        const functions = this.findLongFunctions(content);\n\n        if (functions.length > 0) {\n          const result = this.refactorLongFunctions(content, functions);\n          if (result.modified) {\n            await fs.promises.writeFile(filePath, result.content);\n            this.optimizedFiles.add(filePath);\n            this.optimizations.extractedFunctions += functions.length;\n            console.log(\n              colors.green(\n                `    ‚úÖ ÈáçÊûÑ‰∫Ü ${functions.length} ‰∏™ÈïøÂáΩÊï∞: ${path.relative(this.projectRoot, filePath)}`\n              )\n            );\n          }\n        }\n      } catch (error) {\n        // ÂøΩÁï•ÈîôËØØ\n      }\n    }\n  }\n\n  /**\n   * ÁÆÄÂåñÂµåÂ•óÊù°‰ª∂\n   */\n  async simplifyNestedConditions() {\n    console.log(colors.yellow('\\nüå≥ ÁÆÄÂåñÂµåÂ•óÊù°‰ª∂...'));\n\n    const sourceFiles = this.getSourceFiles();\n\n    for (const filePath of sourceFiles) {\n      try {\n        const content = fs.readFileSync(filePath, 'utf8');\n        const result = this.simplifyNestedIfs(content);\n\n        if (result.modified) {\n          await fs.promises.writeFile(filePath, result.content);\n          this.optimizedFiles.add(filePath);\n          console.log(\n            colors.green(`    ‚úÖ ÁÆÄÂåñÂµåÂ•óÊù°‰ª∂: ${path.relative(this.projectRoot, filePath)}`)\n          );\n        }\n      } catch (error) {\n        // ÂøΩÁï•ÈîôËØØ\n      }\n    }\n  }\n\n  /**\n   * ÊãÜÂàÜÂ§ßÁ±ª\n   */\n  async splitLargeClasses() {\n    console.log(colors.yellow('\\nüì¶ ÊãÜÂàÜÂ§ßÁ±ª...'));\n\n    const sourceFiles = this.getSourceFiles();\n\n    for (const filePath of sourceFiles) {\n      try {\n        const content = fs.readFileSync(filePath, 'utf8');\n        const classes = this.findLargeClasses(content);\n\n        if (classes.length > 0) {\n          const result = this.suggestClassSplit(content, classes, filePath);\n          if (result.suggestions.length > 0) {\n            this.optimizations.splitClasses += classes.length;\n            console.log(\n              colors.green(\n                `    üí° Âª∫ËÆÆÊãÜÂàÜ ${classes.length} ‰∏™Â§ßÁ±ª: ${path.relative(this.projectRoot, filePath)}`\n              )\n            );\n          }\n        }\n      } catch (error) {\n        // ÂøΩÁï•ÈîôËØØ\n      }\n    }\n  }\n\n  /**\n   * ‰ºòÂåñÂæ™ÁéØ\n   */\n  async optimizeLoops() {\n    console.log(colors.yellow('\\nüîÑ ‰ºòÂåñÂæ™ÁéØ...'));\n\n    const sourceFiles = this.getSourceFiles();\n\n    for (const filePath of sourceFiles) {\n      try {\n        const content = fs.readFileSync(filePath, 'utf8');\n        const result = this.optimizeLoopPerformance(content);\n\n        if (result.modified) {\n          await fs.promises.writeFile(filePath, result.content);\n          this.optimizedFiles.add(filePath);\n          console.log(\n            colors.green(`    ‚úÖ ‰ºòÂåñÂæ™ÁéØÊÄßËÉΩ: ${path.relative(this.projectRoot, filePath)}`)\n          );\n        }\n      } catch (error) {\n        // ÂøΩÁï•ÈîôËØØ\n      }\n    }\n  }\n\n  /**\n   * ÁÆÄÂåñÊù°‰ª∂ËØ≠Âè•\n   */\n  simplifyConditions(content) {\n    let modified = false;\n    let newContent = content;\n\n    // ÁÆÄÂåñÂ∏ÉÂ∞îË°®ËææÂºè\n    const simplifications = [\n      { pattern: /if\\s*\\(\\s*(.+?)\\s*===\\s*true\\s*\\)/g, replacement: 'if ($1)' },\n      { pattern: /if\\s*\\(\\s*(.+?)\\s*===\\s*false\\s*\\)/g, replacement: 'if (!$1)' },\n      { pattern: /if\\s*\\(\\s*(.+?)\\s*!==\\s*false\\s*\\)/g, replacement: 'if ($1)' },\n      { pattern: /if\\s*\\(\\s*(.+?)\\s*!==\\s*true\\s*\\)/g, replacement: 'if (!$1)' },\n    ];\n\n    simplifications.forEach(({ pattern, replacement }) => {\n      if (pattern.test(newContent)) {\n        newContent = newContent.replace(pattern, replacement);\n        modified = true;\n      }\n    });\n\n    return { content: newContent, modified };\n  }\n\n  /**\n   * ÂáèÂ∞ëÂµåÂ•ó\n   */\n  reduceNesting(content) {\n    let modified = false;\n    let newContent = content;\n\n    // Ê∑ªÂä†ÈáçÊûÑÂª∫ËÆÆÊ≥®Èáä\n    const lines = newContent.split('\\n');\n    const newLines = [];\n    let nestingLevel = 0;\n\n    for (let i = 0, len = lines.length; i < len; i++) {\n      const line = lines[i];\n      const trimmed = line.trim();\n\n      if (trimmed.startsWith('if (')) {\n        nestingLevel++;\n        if (nestingLevel > 3) {\n          newLines.push('    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó');\n          modified = true;\n        }\n      } else if (trimmed === '}') {\n        nestingLevel = Math.max(0, nestingLevel - 1);\n      }\n\n      newLines.push(line);\n    }\n\n    if (modified) {\n      newContent = newLines.join('\\n');\n    }\n\n    return { content: newContent, modified };\n  }\n\n  /**\n   * Ê∑ªÂä†ÊñáÊ°£Ê≥®Èáä\n   */\n  addDocumentation(content, filePath) {\n    let modified = false;\n    let newContent = content;\n\n    // Â¶ÇÊûúÊñá‰ª∂Ê≤°ÊúâÈ°∂Á∫ßÊ≥®ÈáäÔºåÊ∑ªÂä†‰∏Ä‰∏™\n    if (!content.trim().startsWith('/**') && !content.trim().startsWith('//')) {\n      const fileName = path.basename(filePath, path.extname(filePath));\n      const fileDoc = `/**\\n * ${fileName}\\n * Ëá™Âä®ÁîüÊàêÁöÑÊñáÊ°£Ê≥®Èáä\\n */\\n\\n`;\n      newContent = fileDoc + newContent;\n      modified = true;\n    }\n\n    return { content: newContent, modified };\n  }\n\n  /**\n   * Êü•ÊâæÈïøÂáΩÊï∞\n   */\n  findLongFunctions(content) {\n    const functions = [];\n    const lines = content.split('\\n');\n    let currentFunction = null;\n    let braceCount = 0;\n\n    for (let i = 0, len = lines.length; i < len; i++) {\n      const line = lines[i];\n      const trimmed = line.trim();\n\n      // Ê£ÄÊµãÂáΩÊï∞ÂºÄÂßã\n      if (\n        trimmed.includes('function ') ||\n        trimmed.match(/\\w+\\s*\\([^)]*\\)\\s*{/) ||\n        trimmed.includes('=> {')\n      ) {\n        currentFunction = {\n          start: i,\n          name: this.extractFunctionName(trimmed),\n          lines: 1,\n        };\n        braceCount = (line.match(/{/g) || []).length - (line.match(/}/g) || []).length;\n      } else if (currentFunction) {\n        currentFunction.lines++;\n        braceCount += (line.match(/{/g) || []).length;\n        braceCount -= (line.match(/}/g) || []).length;\n\n        // ÂáΩÊï∞ÁªìÊùü\n        if (braceCount === 0) {\n          currentFunction.end = i;\n          if (currentFunction.lines > 20) {\n            // Ë∂ÖËøá20Ë°åÁöÑÂáΩÊï∞\n            functions.push(currentFunction);\n          }\n          currentFunction = null;\n        }\n      }\n    }\n\n    return functions;\n  }\n\n  /**\n   * ÈáçÊûÑÈïøÂáΩÊï∞\n   */\n  refactorLongFunctions(content, functions) {\n    let modified = false;\n    let newContent = content;\n\n    // ‰∏∫ÈïøÂáΩÊï∞Ê∑ªÂä†Ê≥®ÈáäÂª∫ËÆÆ\n    functions.forEach((func) => {\n      const comment = `\\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç ${func.lines} Ë°å)\\n`;\n      const lines = newContent.split('\\n');\n      lines.splice(func.start, 0, comment);\n      newContent = lines.join('\\n');\n      modified = true;\n    });\n\n    return { content: newContent, modified };\n  }\n\n  /**\n   * ÁÆÄÂåñÂµåÂ•óifËØ≠Âè•\n   */\n  simplifyNestedIfs(content) {\n    let modified = false;\n    let newContent = content;\n\n    // Êü•ÊâæÊ∑±Â∫¶ÂµåÂ•óÁöÑifËØ≠Âè•Âπ∂Ê∑ªÂä†ÈáçÊûÑÂª∫ËÆÆ\n    const lines = newContent.split('\\n');\n    let nestingLevel = 0;\n    const newLines = [];\n\n    for (let i = 0, len = lines.length; i < len; i++) {\n      const line = lines[i];\n      const trimmed = line.trim();\n\n      if (trimmed.startsWith('if (')) {\n        nestingLevel++;\n        if (nestingLevel > 3) {\n          newLines.push('    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó');\n          modified = true;\n        }\n      } else if (trimmed === '}') {\n        nestingLevel = Math.max(0, nestingLevel - 1);\n      }\n\n      newLines.push(line);\n    }\n\n    if (modified) {\n      newContent = newLines.join('\\n');\n    }\n\n    return { content: newContent, modified };\n  }\n\n  /**\n   * Êü•ÊâæÂ§ßÁ±ª\n   */\n  findLargeClasses(content) {\n    const classes = [];\n    const lines = content.split('\\n');\n    let currentClass = null;\n    let braceCount = 0;\n\n    for (let i = 0, len = lines.length; i < len; i++) {\n      const line = lines[i];\n      const trimmed = line.trim();\n\n      // Ê£ÄÊµãÁ±ªÂºÄÂßã\n      if (trimmed.startsWith('class ')) {\n        currentClass = {\n          start: i,\n          name: trimmed.match(/class\\s+(\\w+)/)?.[1] || 'Unknown',\n          lines: 1,\n          methods: 0,\n        };\n        braceCount = (line.match(/{/g) || []).length - (line.match(/}/g) || []).length;\n      } else if (currentClass) {\n        currentClass.lines++;\n\n        // ËÆ°ÁÆóÊñπÊ≥ïÊï∞Èáè\n        if (trimmed.includes('(') && trimmed.includes(')') && trimmed.includes('{')) {\n          currentClass.methods++;\n        }\n\n        braceCount += (line.match(/{/g) || []).length;\n        braceCount -= (line.match(/}/g) || []).length;\n\n        // Á±ªÁªìÊùü\n        if (braceCount === 0) {\n          currentClass.end = i;\n          if (currentClass.lines > 100 || currentClass.methods > 10) {\n            classes.push(currentClass);\n          }\n          currentClass = null;\n        }\n      }\n    }\n\n    return classes;\n  }\n\n  /**\n   * Âª∫ËÆÆÁ±ªÊãÜÂàÜ\n   */\n  suggestClassSplit(content, classes, filePath) {\n    const suggestions = [];\n\n    classes.forEach((cls) => {\n      suggestions.push({\n        class: cls.name,\n        reason: `Á±ªËøáÂ§ß (${cls.lines} Ë°å, ${cls.methods} ‰∏™ÊñπÊ≥ï)`,\n        suggestion: 'ËÄÉËôëÊåâËÅåË¥£ÊãÜÂàÜ‰∏∫Â§ö‰∏™Á±ª',\n      });\n    });\n\n    return { suggestions };\n  }\n\n  /**\n   * ‰ºòÂåñÂæ™ÁéØÊÄßËÉΩ\n   */\n  optimizeLoopPerformance(content) {\n    let modified = false;\n    let newContent = content;\n\n    // ‰ºòÂåñÊï∞ÁªÑÈïøÂ∫¶ÁºìÂ≠ò\n    const arrayLengthPattern =\n      /for\\s*\\(\\s*let\\s+(\\w+)\\s*=\\s*0;\\s*\\1\\s*<\\s*(\\w+)\\.length;\\s*\\1\\+\\+\\s*\\)/g;\n    newContent = newContent.replace(arrayLengthPattern, (match, i, arr) => {\n      modified = true;\n      return `for (let ${i} = 0, len = ${arr}.length; ${i} < len; ${i}++)`;\n    });\n\n    return { content: newContent, modified };\n  }\n\n  /**\n   * ËÆ°ÁÆóÊñá‰ª∂Â§çÊùÇÂ∫¶\n   */\n  calculateFileComplexity(content) {\n    const lines = content.split('\\n');\n    const complexity = {\n      cyclomatic: 1, // Âü∫Á°ÄÂ§çÊùÇÂ∫¶\n      cognitive: 0,\n      total: 0,\n    };\n\n    let nestingLevel = 0;\n\n    // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 25 Ë°å)\n\n    // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 25 Ë°å)\n\n    // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 25 Ë°å)\n\n    lines.forEach((line) => {\n      const trimmed = line.trim();\n\n      // Âæ™ÁéØÂ§çÊùÇÂ∫¶\n      if (trimmed.match(/\\b(if|while|for|switch|catch)\\b/)) {\n        complexity.cyclomatic++;\n      }\n\n      // ËÆ§Áü•Â§çÊùÇÂ∫¶\n      if (trimmed.startsWith('if (') || trimmed.startsWith('else if (')) {\n        complexity.cognitive += 1 + nestingLevel;\n      } else if (trimmed.startsWith('while (') || trimmed.startsWith('for (')) {\n        complexity.cognitive += 1 + nestingLevel;\n      } else if (trimmed.startsWith('switch (')) {\n        complexity.cognitive += 1 + nestingLevel;\n      }\n\n      // ÂµåÂ•óÁ∫ßÂà´\n      if (trimmed.includes('{')) {\n        nestingLevel++;\n      }\n      if (trimmed.includes('}')) {\n        nestingLevel = Math.max(0, nestingLevel - 1);\n      }\n    });\n\n    complexity.total = complexity.cyclomatic + complexity.cognitive;\n    return complexity;\n  }\n\n  /**\n   * ÊèêÂèñÂáΩÊï∞Âêç\n   */\n  extractFunctionName(line) {\n    const patterns = [/function\\s+(\\w+)/, /(\\w+)\\s*\\(/, /const\\s+(\\w+)\\s*=/, /let\\s+(\\w+)\\s*=/];\n\n    for (const pattern of patterns) {\n      const match = line.match(pattern);\n      if (match) {\n        return match[1];\n      }\n    }\n\n    return 'anonymous';\n  }\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 36 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 36 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 36 Ë°å)\n\n  /**\n   * ÁîüÊàê‰ºòÂåñÊä•Âëä\n   */\n  async generateOptimizationReport() {\n    console.log(colors.yellow('\\nüìä ÁîüÊàê‰ºòÂåñÊä•Âëä...'));\n\n    const report = {\n      timestamp: new Date().toISOString(),\n      summary: {\n        optimizedFiles: this.optimizedFiles.size,\n        extractedFunctions: this.optimizations.extractedFunctions,\n        splitClasses: this.optimizations.splitClasses,\n        reducedNesting: this.optimizations.reducedNesting,\n        simplifiedConditions: this.optimizations.simplifiedConditions,\n      },\n      optimizedFiles: Array.from(this.optimizedFiles).map((file) =>\n        path.relative(this.projectRoot, file)\n      ),\n      recommendations: [\n        'ÁªßÁª≠ÈáçÊûÑÈïøÂáΩÊï∞Ôºå‰øùÊåÅÂáΩÊï∞ÁÆÄÊ¥Å',\n        '‰ΩøÁî®ËÆæËÆ°Ê®°ÂºèÂáèÂ∞ë‰ª£Á†ÅÂ§çÊùÇÂ∫¶',\n        'Ê∑ªÂä†ÂçïÂÖÉÊµãËØïÁ°Æ‰øùÈáçÊûÑÂÆâÂÖ®',\n        'ÂÆöÊúüËøõË°å‰ª£Á†ÅÂÆ°Êü•',\n        '‰ΩøÁî®ÈùôÊÄÅÂàÜÊûêÂ∑•ÂÖ∑ÁõëÊéßÂ§çÊùÇÂ∫¶',\n      ],\n    };\n\n    const reportPath = path.join(\n      this.projectRoot,\n      'reports',\n      'complexity-optimization-report.json'\n    );\n    await fs.promises.mkdir(path.dirname(reportPath), { recursive: true });\n    await fs.promises.writeFile(reportPath, JSON.stringify(report, null, 2));\n\n    console.log(colors.green(`  ‚úÖ Êä•ÂëäÂ∑≤ÁîüÊàê: ${reportPath}`));\n\n    // ÊòæÁ§∫ÊëòË¶Å\n    console.log(colors.cyan('\\nüìã ‰ºòÂåñÊëòË¶Å:'));\n    console.log(colors.blue(`   üîß ‰ºòÂåñÊñá‰ª∂Êï∞: ${report.summary.optimizedFiles}`));\n    console.log(colors.blue(`   üîÑ ÊèêÂèñÂáΩÊï∞Êï∞: ${report.summary.extractedFunctions}`));\n    console.log(colors.blue(`   üì¶ ÊãÜÂàÜÁ±ªÊï∞: ${report.summary.splitClasses}`));\n    console.log(colors.blue(`   üå≥ ÂáèÂ∞ëÂµåÂ•ó: ${report.summary.reducedNesting}`));\n    console.log(colors.blue(`   üí° ÁÆÄÂåñÊù°‰ª∂: ${report.summary.simplifiedConditions}`));\n  }\n\n  /**\n   * Ëé∑ÂèñÊ∫ê‰ª£Á†ÅÊñá‰ª∂ÂàóË°®\n   */\n  getSourceFiles() {\n    const files = [];\n    const searchDirs = ['src', 'backend', 'scripts'];\n\n    searchDirs.forEach((dir) => {\n      const dirPath = path.join(this.projectRoot, dir);\n      if (fs.existsSync(dirPath)) {\n        this.walkDir(dirPath, files);\n      }\n    });\n\n    return files.filter(\n      (file) =>\n        (file.endsWith('.js') || file.endsWith('.ts')) &&\n        !file.includes('node_modules') &&\n        !file.includes('.git') &&\n        !file.includes('test') &&\n        !file.includes('spec')\n    );\n  }\n\n  /**\n   * ÈÄíÂΩíÈÅçÂéÜÁõÆÂΩï\n   */\n  walkDir(dir, files) {\n    try {\n      const items = fs.readdirSync(dir);\n\n      items.forEach((item) => {\n        const fullPath = path.join(dir, item);\n        const stat = fs.statSync(fullPath);\n\n        if (stat.isDirectory() && !item.startsWith('.')) {\n          this.walkDir(fullPath, files);\n        } else if (stat.isFile()) {\n          files.push(fullPath);\n        }\n      });\n    } catch (error) {\n      // ÂøΩÁï•ÊùÉÈôêÈîôËØØ\n    }\n  }\n}\n\n// ÂëΩ‰ª§Ë°åÊâßË°å\nif (import.meta.url === `file://${process.argv[1]}`) {\n  const optimizer = new ComplexityOptimizer();\n  const command = process.argv[2];\n\n  switch (command) {\n    case 'analyze':\n      optimizer.analyzeComplexity().catch(console.error);\n      break;\n    case 'functions':\n      optimizer.extractLongFunctions().catch(console.error);\n      break;\n    case 'conditions':\n      optimizer.simplifyNestedConditions().catch(console.error);\n      break;\n    case 'classes':\n      optimizer.splitLargeClasses().catch(console.error);\n      break;\n    case 'all':\n    default:\n      optimizer.runAll().catch(console.error);\n      break;\n  }\n}\n\nexport default ComplexityOptimizer;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/scripts/coverage-analyzer.js","messages":[{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 80.","line":31,"column":56,"nodeType":"Literal","messageId":"noMagic","endLine":31,"endColumn":58},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 75.","line":32,"column":52,"nodeType":"Literal","messageId":"noMagic","endLine":32,"endColumn":54},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 80.","line":33,"column":54,"nodeType":"Literal","messageId":"noMagic","endLine":33,"endColumn":56},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 80.","line":34,"column":46,"nodeType":"Literal","messageId":"noMagic","endLine":34,"endColumn":48},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":61,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":61,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1425,1456],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":79,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":79,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1749,1777],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":83,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":83,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[1842,1877],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":92,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":92,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1971,2005],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":112,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":112,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2611,2645],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'output' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":114,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":114,"endColumn":19},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":120,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":120,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2797,2821],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":123,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":123,"endColumn":19,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[2890,2928],"text":""},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":131,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":131,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2999,3028],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":147,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":147,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[3416,3489],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":157,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":157,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[3634,3663],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":230,"column":83,"nodeType":"Literal","messageId":"noMagic","endLine":230,"endColumn":86},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":235,"column":77,"nodeType":"Literal","messageId":"noMagic","endLine":235,"endColumn":80},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":240,"column":80,"nodeType":"Literal","messageId":"noMagic","endLine":240,"endColumn":83},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":245,"column":68,"nodeType":"Literal","messageId":"noMagic","endLine":245,"endColumn":71},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 50.","line":381,"column":46,"nodeType":"Literal","messageId":"noMagic","endLine":381,"endColumn":48},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":396,"column":35,"nodeType":"Literal","messageId":"noMagic","endLine":396,"endColumn":37},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 70.","line":396,"column":70,"nodeType":"Literal","messageId":"noMagic","endLine":396,"endColumn":72},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5.","line":410,"column":76,"nodeType":"Literal","messageId":"noMagic","endLine":410,"endColumn":77},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":441,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":441,"endColumn":21,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[11819,11863],"text":""},"desc":"Remove the console.warn()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 30.","line":454,"column":26,"nodeType":"Literal","messageId":"noMagic","endLine":454,"endColumn":28},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: -30.","line":455,"column":31,"nodeType":"UnaryExpression","messageId":"noMagic","endLine":455,"endColumn":34},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":470,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":470,"endColumn":19,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[12417,12461],"text":""},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":524,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":524,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[14017,14046],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":543,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":543,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[14645,14669],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":544,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":544,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[14674,14710],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":545,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":545,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[14715,14759],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":546,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":546,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[14764,14838],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":592,"column":44,"nodeType":"Literal","messageId":"noMagic","endLine":592,"endColumn":46},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5.","line":614,"column":49,"nodeType":"Literal","messageId":"noMagic","endLine":614,"endColumn":50},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5.","line":617,"column":34,"nodeType":"Literal","messageId":"noMagic","endLine":617,"endColumn":35},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5.","line":618,"column":56,"nodeType":"Literal","messageId":"noMagic","endLine":618,"endColumn":57},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":631,"column":62,"nodeType":"Literal","messageId":"noMagic","endLine":631,"endColumn":64},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":671,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":671,"endColumn":19,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[19044,19077],"text":""},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":672,"column":37,"nodeType":"MemberExpression","messageId":"unexpected","endLine":672,"endColumn":49},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":675,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":675,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[19196,19233],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":679,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":679,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[19286,19317],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":698,"column":40,"nodeType":"Literal","messageId":"noMagic","endLine":698,"endColumn":43},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.1.","line":734,"column":26,"nodeType":"Literal","messageId":"noMagic","endLine":734,"endColumn":29},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":746,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":746,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[21097,21130],"text":""},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":43,"fixableErrorCount":0,"fixableWarningCount":0,"source":"#!/usr/bin/env node\n\nimport fs from 'fs';\nimport path from 'path';\nimport { execSync } from 'child_process';\nimport { fileURLToPath } from 'url';\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\n\n/**\n * ‰ª£Á†ÅË¶ÜÁõñÁéáÂàÜÊûêÂô®\n * ÂàÜÊûêÊµãËØïË¶ÜÁõñÁéáÂπ∂ÁîüÊàêËØ¶ÁªÜÊä•Âëä\n */\nclass CoverageAnalyzer {\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 32 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 32 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 32 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 32 Ë°å)\n\n  constructor(options = {}) {\n    this.options = {\n      projectRoot: options.projectRoot || path.resolve(__dirname, '..'),\n      sourceDir: options.sourceDir || 'src',\n      testDir: options.testDir || 'tests',\n      outputDir: options.outputDir || 'coverage',\n      minCoverage: {\n        statements: options.minCoverage?.statements || 80,\n        branches: options.minCoverage?.branches || 75,\n        functions: options.minCoverage?.functions || 80,\n        lines: options.minCoverage?.lines || 80,\n      },\n      excludePatterns: options.excludePatterns || [\n        'node_modules/**',\n        'tests/**',\n        'coverage/**',\n        '**/*.test.js',\n        '**/*.spec.js',\n        '**/test-*.js',\n      ],\n      ...options,\n    };\n\n    this.coverageData = null;\n    this.analysisResults = {\n      summary: {},\n      files: [],\n      uncoveredLines: [],\n      recommendations: [],\n      trends: [],\n    };\n  }\n\n  /**\n   * ËøêË°åÂÆåÊï¥ÁöÑË¶ÜÁõñÁéáÂàÜÊûê\n   */\n  async analyze() {\n    console.log('üìä ÂºÄÂßã‰ª£Á†ÅË¶ÜÁõñÁéáÂàÜÊûê...');\n\n    try {\n      // ËøêË°åÊµãËØïÂπ∂ÁîüÊàêË¶ÜÁõñÁéáÊä•Âëä\n      await this.runCoverageTests();\n\n      // Ëß£ÊûêË¶ÜÁõñÁéáÊï∞ÊçÆ\n      await this.parseCoverageData();\n\n      // ÂàÜÊûêË¶ÜÁõñÁéá\n      await this.performAnalysis();\n\n      // ÁîüÊàêÊä•Âëä\n      await this.generateReports();\n\n      // Ê£ÄÊü•Ë¶ÜÁõñÁéáÈòàÂÄº\n      this.checkCoverageThresholds();\n\n      console.log('‚úÖ ‰ª£Á†ÅË¶ÜÁõñÁéáÂàÜÊûêÂÆåÊàê!');\n\n      return this.analysisResults;\n    } catch (error) {\n      console.error('‚ùå Ë¶ÜÁõñÁéáÂàÜÊûêÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * ËøêË°åÊµãËØïÂπ∂ÁîüÊàêË¶ÜÁõñÁéáÊä•Âëä\n   */\n  async runCoverageTests() {\n    console.log('üß™ ËøêË°åÊµãËØïÂπ∂Êî∂ÈõÜË¶ÜÁõñÁéáÊï∞ÊçÆ...');\n\n    try {\n      // Á°Æ‰øùËæìÂá∫ÁõÆÂΩïÂ≠òÂú®\n      const coverageDir = path.join(this.options.projectRoot, this.options.outputDir);\n      if (!fs.existsSync(coverageDir)) {\n        fs.mkdirSync(coverageDir, { recursive: true });\n      }\n\n      // ËøêË°åJestÊµãËØïÂπ∂ÁîüÊàêË¶ÜÁõñÁéáÊä•Âëä\n      const jestCommand = [\n        'npx jest',\n        '--coverage',\n        `--coverageDirectory=${this.options.outputDir}`,\n        '--coverageReporters=json,lcov,text,html',\n        '--collectCoverageFrom=\"src/**/*.js\"',\n        '--collectCoverageFrom=\"!src/**/*.test.js\"',\n        '--collectCoverageFrom=\"!src/**/*.spec.js\"',\n      ].join(' ');\n\n      console.log('ÊâßË°åÂëΩ‰ª§:', jestCommand);\n\n      const output = execSync(jestCommand, {\n        cwd: this.options.projectRoot,\n        encoding: 'utf8',\n        stdio: 'pipe',\n      });\n\n      console.log('‚úÖ ÊµãËØïÊâßË°åÂÆåÊàê');\n    } catch (error) {\n      // JestÂèØËÉΩ‰ºöÂõ†‰∏∫Ë¶ÜÁõñÁéá‰∏çË∂≥ËÄåËøîÂõûÈùûÈõ∂ÈÄÄÂá∫Á†ÅÔºå‰ΩÜ‰ªç‰ºöÁîüÊàêÊä•Âëä\n      console.warn('‚ö†Ô∏è  ÊµãËØïÊâßË°åÂÆåÊàêÔºå‰ΩÜÂèØËÉΩÂ≠òÂú®Ë¶ÜÁõñÁéáÈóÆÈ¢ò');\n    }\n  }\n\n  /**\n   * Ëß£ÊûêË¶ÜÁõñÁéáÊï∞ÊçÆ\n   */\n  async parseCoverageData() {\n    console.log('üìã Ëß£ÊûêË¶ÜÁõñÁéáÊï∞ÊçÆ...');\n\n    const coverageJsonPath = path.join(\n      this.options.projectRoot,\n      this.options.outputDir,\n      'coverage-final.json'\n    );\n\n    if (!fs.existsSync(coverageJsonPath)) {\n      throw new Error(`Ë¶ÜÁõñÁéáÊï∞ÊçÆÊñá‰ª∂‰∏çÂ≠òÂú®: ${coverageJsonPath}`);\n    }\n\n    try {\n      const coverageJson = fs.readFileSync(coverageJsonPath, 'utf8');\n      this.coverageData = JSON.parse(coverageJson);\n\n      console.log(`‚úÖ ÊàêÂäüËß£Êûê ${Object.keys(this.coverageData).length} ‰∏™Êñá‰ª∂ÁöÑË¶ÜÁõñÁéáÊï∞ÊçÆ`);\n    } catch (error) {\n      throw new Error(`Ëß£ÊûêË¶ÜÁõñÁéáÊï∞ÊçÆÂ§±Ë¥•: ${error.message}`);\n    }\n  }\n\n  /**\n   * ÊâßË°åË¶ÜÁõñÁéáÂàÜÊûê\n   */\n  async performAnalysis() {\n    console.log('üîç ÊâßË°åË¶ÜÁõñÁéáÂàÜÊûê...');\n\n    // ËÆ°ÁÆóÊÄª‰ΩìË¶ÜÁõñÁéá\n    this.calculateOverallCoverage();\n\n    // ÂàÜÊûêÊñá‰ª∂Á∫ßË¶ÜÁõñÁéá\n    this.analyzeFileCoverage();\n\n    // ËØÜÂà´Êú™Ë¶ÜÁõñÁöÑ‰ª£Á†Å\n    this.identifyUncoveredCode();\n\n    // ÁîüÊàêÊîπËøõÂª∫ËÆÆ\n    this.generateRecommendations();\n\n    // ÂàÜÊûêË¶ÜÁõñÁéáË∂ãÂäøÔºàÂ¶ÇÊûúÊúâÂéÜÂè≤Êï∞ÊçÆÔºâ\n    this.analyzeTrends();\n  }\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 63 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 66 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 69 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 72 Ë°å)\n\n  /**\n   * ËÆ°ÁÆóÊÄª‰ΩìË¶ÜÁõñÁéá\n   */\n  calculateOverallCoverage() {\n    let totalStatements = 0;\n    let coveredStatements = 0;\n    let totalBranches = 0;\n    let coveredBranches = 0;\n    let totalFunctions = 0;\n    let coveredFunctions = 0;\n    let totalLines = 0;\n    let coveredLines = 0;\n\n    for (const [filePath, fileData] of Object.entries(this.coverageData)) {\n      // Ë∑≥ËøáÊéíÈô§ÁöÑÊñá‰ª∂\n      if (this.shouldExcludeFile(filePath)) {\n        continue;\n      }\n\n      // ËØ≠Âè•Ë¶ÜÁõñÁéá\n      const statements = fileData.s || {};\n      totalStatements += Object.keys(statements).length;\n      coveredStatements += Object.values(statements).filter((count) => count > 0).length;\n\n      // ÂàÜÊîØË¶ÜÁõñÁéá\n      const branches = fileData.b || {};\n      for (const branchData of Object.values(branches)) {\n        totalBranches += branchData.length;\n        coveredBranches += branchData.filter((count) => count > 0).length;\n      }\n\n      // ÂáΩÊï∞Ë¶ÜÁõñÁéá\n      const functions = fileData.f || {};\n      totalFunctions += Object.keys(functions).length;\n      coveredFunctions += Object.values(functions).filter((count) => count > 0).length;\n\n      // Ë°åË¶ÜÁõñÁéá\n      const lines = fileData.statementMap || {};\n      totalLines += Object.keys(lines).length;\n      const executedLines = Object.keys(statements).filter((key) => statements[key] > 0);\n      coveredLines += executedLines.length;\n    }\n\n    this.analysisResults.summary = {\n      statements: {\n        total: totalStatements,\n        covered: coveredStatements,\n        percentage: totalStatements > 0 ? (coveredStatements / totalStatements) * 100 : 0,\n      },\n      branches: {\n        total: totalBranches,\n        covered: coveredBranches,\n        percentage: totalBranches > 0 ? (coveredBranches / totalBranches) * 100 : 0,\n      },\n      functions: {\n        total: totalFunctions,\n        covered: coveredFunctions,\n        percentage: totalFunctions > 0 ? (coveredFunctions / totalFunctions) * 100 : 0,\n      },\n      lines: {\n        total: totalLines,\n        covered: coveredLines,\n        percentage: totalLines > 0 ? (coveredLines / totalLines) * 100 : 0,\n      },\n\n      // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 61 Ë°å)\n\n      // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 61 Ë°å)\n\n      // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 61 Ë°å)\n\n      // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 61 Ë°å)\n    };\n  }\n\n  /**\n   * ÂàÜÊûêÊñá‰ª∂Á∫ßË¶ÜÁõñÁéá\n   */\n  analyzeFileCoverage() {\n    this.analysisResults.files = [];\n\n    for (const [filePath, fileData] of Object.entries(this.coverageData)) {\n      if (this.shouldExcludeFile(filePath)) {\n        continue;\n      }\n\n      const relativePath = path.relative(this.options.projectRoot, filePath);\n\n      // ËÆ°ÁÆóÊñá‰ª∂ÁöÑÂêÑÈ°πË¶ÜÁõñÁéá\n      const statements = fileData.s || {};\n      const branches = fileData.b || {};\n      const functions = fileData.f || {};\n\n      const statementCoverage = this.calculateCoveragePercentage(\n        Object.values(statements),\n        (count) => count > 0\n      );\n\n      let branchCoverage = 0;\n      if (Object.keys(branches).length > 0) {\n        const allBranches = Object.values(branches).flat();\n        branchCoverage = this.calculateCoveragePercentage(allBranches, (count) => count > 0);\n      }\n\n      const functionCoverage = this.calculateCoveragePercentage(\n        Object.values(functions),\n        (count) => count > 0\n      );\n\n      const fileAnalysis = {\n        path: relativePath,\n        absolutePath: filePath,\n        statements: {\n          total: Object.keys(statements).length,\n          covered: Object.values(statements).filter((count) => count > 0).length,\n          percentage: statementCoverage,\n        },\n        branches: {\n          total: Object.values(branches).flat().length,\n          covered: Object.values(branches)\n            .flat()\n            .filter((count) => count > 0).length,\n          percentage: branchCoverage,\n        },\n        functions: {\n          total: Object.keys(functions).length,\n          covered: Object.values(functions).filter((count) => count > 0).length,\n          percentage: functionCoverage,\n        },\n        uncoveredLines: this.getUncoveredLines(fileData),\n        complexity: this.calculateComplexity(fileData),\n      };\n\n      this.analysisResults.files.push(fileAnalysis);\n    }\n\n    // ÊåâË¶ÜÁõñÁéáÊéíÂ∫è\n    this.analysisResults.files.sort((a, b) => a.statements.percentage - b.statements.percentage);\n  }\n\n  /**\n   * ËØÜÂà´Êú™Ë¶ÜÁõñÁöÑ‰ª£Á†Å\n   */\n  identifyUncoveredCode() {\n    this.analysisResults.uncoveredLines = [];\n\n    for (const fileAnalysis of this.analysisResults.files) {\n      if (fileAnalysis.uncoveredLines.length > 0) {\n        this.analysisResults.uncoveredLines.push({\n          file: fileAnalysis.path,\n          lines: fileAnalysis.uncoveredLines,\n          count: fileAnalysis.uncoveredLines.length,\n        });\n      }\n    }\n\n    // ÊåâÊú™Ë¶ÜÁõñË°åÊï∞ÊéíÂ∫è\n    this.analysisResults.uncoveredLines.sort((a, b) => b.count - a.count);\n  }\n\n  /**\n   * ÁîüÊàêÊîπËøõÂª∫ËÆÆ\n   */\n  generateRecommendations() {\n    const recommendations = [];\n\n    // Ê£ÄÊü•ÊÄª‰ΩìË¶ÜÁõñÁéá\n    const { summary } = this.analysisResults;\n\n    if (summary.statements.percentage < this.options.minCoverage.statements) {\n      recommendations.push({\n        type: 'overall_statements',\n        priority: 'high',\n        message: `ËØ≠Âè•Ë¶ÜÁõñÁéá ${summary.statements.percentage.toFixed(2)}% ‰Ωé‰∫éÁõÆÊ†á ${this.options.minCoverage.statements}%`,\n        suggestion: 'Â¢ûÂä†ÂçïÂÖÉÊµãËØï‰ª•ÊèêÈ´òËØ≠Âè•Ë¶ÜÁõñÁéá',\n      });\n    }\n\n    if (summary.branches.percentage < this.options.minCoverage.branches) {\n      recommendations.push({\n        type: 'overall_branches',\n        priority: 'high',\n        message: `ÂàÜÊîØË¶ÜÁõñÁéá ${summary.branches.percentage.toFixed(2)}% ‰Ωé‰∫éÁõÆÊ†á ${this.options.minCoverage.branches}%`,\n        suggestion: 'Ê∑ªÂä†ÊµãËØïÁî®‰æãË¶ÜÁõñÊõ¥Â§öÁöÑÊù°‰ª∂ÂàÜÊîØ',\n      });\n    }\n\n    if (summary.functions.percentage < this.options.minCoverage.functions) {\n      recommendations.push({\n        type: 'overall_functions',\n        priority: 'high',\n        message: `ÂáΩÊï∞Ë¶ÜÁõñÁéá ${summary.functions.percentage.toFixed(2)}% ‰Ωé‰∫éÁõÆÊ†á ${this.options.minCoverage.functions}%`,\n        suggestion: '‰∏∫Êú™ÊµãËØïÁöÑÂáΩÊï∞Ê∑ªÂä†ÊµãËØïÁî®‰æã',\n      });\n    }\n\n    // Ê£ÄÊü•Êñá‰ª∂Á∫ßË¶ÜÁõñÁéá\n    const lowCoverageFiles = this.analysisResults.files.filter(\n      (file) => file.statements.percentage < 50\n    );\n\n    if (lowCoverageFiles.length > 0) {\n      recommendations.push({\n        type: 'low_coverage_files',\n        priority: 'medium',\n        message: `${lowCoverageFiles.length} ‰∏™Êñá‰ª∂ÁöÑË¶ÜÁõñÁéá‰Ωé‰∫é50%`,\n        suggestion: '‰ºòÂÖà‰∏∫Ëøô‰∫õÊñá‰ª∂Ê∑ªÂä†ÊµãËØïÁî®‰æã',\n        files: lowCoverageFiles.map((f) => f.path),\n      });\n    }\n\n    // Ê£ÄÊü•Â§çÊùÇÂ∫¶È´ò‰ΩÜË¶ÜÁõñÁéá‰ΩéÁöÑÊñá‰ª∂\n    const complexUncoveredFiles = this.analysisResults.files.filter(\n      (file) => file.complexity > 10 && file.statements.percentage < 70\n    );\n\n    if (complexUncoveredFiles.length > 0) {\n      recommendations.push({\n        type: 'complex_uncovered',\n        priority: 'high',\n        message: `${complexUncoveredFiles.length} ‰∏™Â§çÊùÇÊñá‰ª∂ÁöÑË¶ÜÁõñÁéá‰∏çË∂≥`,\n        suggestion: 'Â§çÊùÇ‰ª£Á†ÅÈúÄË¶ÅÊõ¥ÂÖ®Èù¢ÁöÑÊµãËØïË¶ÜÁõñ',\n        files: complexUncoveredFiles.map((f) => f.path),\n      });\n    }\n\n    // Ê£ÄÊü•Êú™Ë¶ÜÁõñË°åÊï∞ÊúÄÂ§öÁöÑÊñá‰ª∂\n    const topUncoveredFiles = this.analysisResults.uncoveredLines.slice(0, 5);\n    if (topUncoveredFiles.length > 0) {\n      recommendations.push({\n        type: 'most_uncovered',\n        priority: 'medium',\n        message: '‰ª•‰∏ãÊñá‰ª∂ÊúâÊúÄÂ§öÁöÑÊú™Ë¶ÜÁõñ‰ª£Á†ÅË°å',\n        suggestion: '‰ºòÂÖà‰∏∫Ëøô‰∫õÊñá‰ª∂Ê∑ªÂä†ÊµãËØï‰ª•Âø´ÈÄüÊèêÂçáË¶ÜÁõñÁéá',\n        files: topUncoveredFiles.map((f) => `${f.file} (${f.count} Ë°å)`),\n      });\n    }\n\n    this.analysisResults.recommendations = recommendations;\n  }\n\n  /**\n   * ÂàÜÊûêË¶ÜÁõñÁéáË∂ãÂäø\n   */\n  analyzeTrends() {\n    // Â∞ùËØïËØªÂèñÂéÜÂè≤Ë¶ÜÁõñÁéáÊï∞ÊçÆ\n    const historyFile = path.join(\n      this.options.projectRoot,\n      this.options.outputDir,\n      'coverage-history.json'\n    );\n\n    let history = [];\n    if (fs.existsSync(historyFile)) {\n      try {\n        const historyData = fs.readFileSync(historyFile, 'utf8');\n        history = JSON.parse(historyData);\n      } catch (error) {\n        console.warn('ËØªÂèñË¶ÜÁõñÁéáÂéÜÂè≤Êï∞ÊçÆÂ§±Ë¥•:', error.message);\n      }\n    }\n\n    // Ê∑ªÂä†ÂΩìÂâçÊï∞ÊçÆ\n    const currentData = {\n      timestamp: new Date().toISOString(),\n      summary: this.analysisResults.summary,\n    };\n\n    history.push(currentData);\n\n    // ‰øùÁïôÊúÄËøë30Ê¨°ËÆ∞ÂΩï\n    if (history.length > 30) {\n      history = history.slice(-30);\n    }\n\n    // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 35 Ë°å)\n\n    // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 38 Ë°å)\n\n    // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 41 Ë°å)\n\n    // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 44 Ë°å)\n\n    // ‰øùÂ≠òÂéÜÂè≤Êï∞ÊçÆ\n    try {\n      fs.writeFileSync(historyFile, JSON.stringify(history, null, 2));\n    } catch (error) {\n      console.warn('‰øùÂ≠òË¶ÜÁõñÁéáÂéÜÂè≤Êï∞ÊçÆÂ§±Ë¥•:', error.message);\n    }\n\n    // ÂàÜÊûêË∂ãÂäø\n    if (history.length >= 2) {\n      const previous = history[history.length - 2];\n      const current = history[history.length - 1];\n\n      this.analysisResults.trends = {\n        statements: {\n          change: current.summary.statements.percentage - previous.summary.statements.percentage,\n          trend: this.getTrendDirection(\n            current.summary.statements.percentage,\n            previous.summary.statements.percentage\n          ),\n        },\n        branches: {\n          change: current.summary.branches.percentage - previous.summary.branches.percentage,\n          trend: this.getTrendDirection(\n            current.summary.branches.percentage,\n            previous.summary.branches.percentage\n          ),\n        },\n        functions: {\n          change: current.summary.functions.percentage - previous.summary.functions.percentage,\n          trend: this.getTrendDirection(\n            current.summary.functions.percentage,\n            previous.summary.functions.percentage\n          ),\n        },\n        lines: {\n          change: current.summary.lines.percentage - previous.summary.lines.percentage,\n\n          // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 25 Ë°å)\n\n          // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 25 Ë°å)\n\n          // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 25 Ë°å)\n\n          // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 25 Ë°å)\n\n          trend: this.getTrendDirection(\n            current.summary.lines.percentage,\n            previous.summary.lines.percentage\n          ),\n        },\n      };\n    }\n  }\n\n  /**\n   * ÁîüÊàêÊä•Âëä\n   */\n  async generateReports() {\n    console.log('üìä ÁîüÊàêË¶ÜÁõñÁéáÊä•Âëä...');\n\n    const outputDir = path.join(this.options.projectRoot, this.options.outputDir);\n\n    // ÁîüÊàêJSONÊä•Âëä\n    const jsonReport = {\n      timestamp: new Date().toISOString(),\n      configuration: this.options,\n      ...this.analysisResults,\n    };\n\n    const jsonPath = path.join(outputDir, 'coverage-analysis.json');\n    fs.writeFileSync(jsonPath, JSON.stringify(jsonReport, null, 2));\n\n    // ÁîüÊàêMarkdownÊä•Âëä\n    const markdownContent = this.generateMarkdownReport(jsonReport);\n    const markdownPath = path.join(outputDir, 'coverage-report.md');\n    fs.writeFileSync(markdownPath, markdownContent);\n\n    console.log('‚úÖ Êä•ÂëäÂ∑≤ÁîüÊàê:');\n    console.log(`   JSON: ${jsonPath}`);\n    console.log(`   Markdown: ${markdownPath}`);\n    console.log(`   HTML: ${path.join(outputDir, 'lcov-report/index.html')}`);\n  }\n\n  /**\n   * ÁîüÊàêMarkdownÊä•Âëä\n   */\n  generateMarkdownReport(report) {\n    const { summary } = report;\n\n    let markdown = '# ‰ª£Á†ÅË¶ÜÁõñÁéáÂàÜÊûêÊä•Âëä\\n\\n';\n    markdown += `> ÁîüÊàêÊó∂Èó¥: ${report.timestamp}\\n\\n`;\n\n    // ÊÄª‰ΩìË¶ÜÁõñÁéá\n    markdown += '## üìä ÊÄª‰ΩìË¶ÜÁõñÁéá\\n\\n';\n    markdown += '| ÊåáÊ†á | Ë¶ÜÁõñÊï∞Èáè | ÊÄªÊï∞Èáè | Ë¶ÜÁõñÁéá | Áä∂ÊÄÅ |\\n';\n    markdown += '|------|----------|--------|--------|------|\\n';\n\n    const metrics = ['statements', 'branches', 'functions', 'lines'];\n    const metricNames = { statements: 'ËØ≠Âè•', branches: 'ÂàÜÊîØ', functions: 'ÂáΩÊï∞', lines: 'Ë°å' };\n\n    for (const metric of metrics) {\n      const data = summary[metric];\n      const status = data.percentage >= this.options.minCoverage[metric] ? '‚úÖ' : '‚ùå';\n      markdown += `| ${metricNames[metric]} | ${data.covered} | ${data.total} | ${data.percentage.toFixed(2)}% | ${status} |\\n`;\n    }\n\n    // Ë∂ãÂäøÂàÜÊûê\n    if (report.trends && Object.keys(report.trends).length > 0) {\n      markdown += '\\n## üìà Ë¶ÜÁõñÁéáË∂ãÂäø\\n\\n';\n      markdown += '| ÊåáÊ†á | ÂèòÂåñ | Ë∂ãÂäø |\\n';\n      markdown += '|------|------|------|\\n';\n\n      for (const metric of metrics) {\n        if (report.trends[metric]) {\n          const trend = report.trends[metric];\n          const trendIcon = trend.trend === 'up' ? 'üìà' : trend.trend === 'down' ? 'üìâ' : '‚û°Ô∏è';\n          markdown += `| ${metricNames[metric]} | ${trend.change > 0 ? '+' : ''}${trend.change.toFixed(2)}% | ${trendIcon} |\\n`;\n        }\n      }\n    }\n\n    // Êñá‰ª∂Ë¶ÜÁõñÁéáÔºàÊúÄ‰ΩéÁöÑ10‰∏™Ôºâ\n    markdown += '\\n## üìÅ Êñá‰ª∂Ë¶ÜÁõñÁéá (ÊúÄÈúÄË¶ÅÊîπËøõÁöÑ10‰∏™Êñá‰ª∂)\\n\\n';\n    markdown += '| Êñá‰ª∂ | ËØ≠Âè•Ë¶ÜÁõñÁéá | ÂàÜÊîØË¶ÜÁõñÁéá | ÂáΩÊï∞Ë¶ÜÁõñÁéá | Êú™Ë¶ÜÁõñË°åÊï∞ |\\n';\n    markdown += '|------|------------|------------|------------|------------|\\n';\n\n    const topFiles = report.files.slice(0, 10);\n    for (const file of topFiles) {\n      markdown += `| ${file.path} | ${file.statements.percentage.toFixed(2)}% | ${file.branches.percentage.toFixed(2)}% | ${file.functions.percentage.toFixed(2)}% | ${file.uncoveredLines.length} |\\n`;\n    }\n\n    // ÊîπËøõÂª∫ËÆÆ\n    if (report.recommendations.length > 0) {\n      markdown += '\\n## üí° ÊîπËøõÂª∫ËÆÆ\\n\\n';\n\n      const priorityOrder = { high: 1, medium: 2, low: 3 };\n      const sortedRecommendations = report.recommendations.sort(\n        (a, b) => priorityOrder[a.priority] - priorityOrder[b.priority]\n      );\n\n      for (const rec of sortedRecommendations) {\n        const priorityIcon =\n          rec.priority === 'high' ? 'üî¥' : rec.priority === 'medium' ? 'üü°' : 'üü¢';\n        markdown += `### ${priorityIcon} ${rec.message}\\n\\n`;\n        markdown += `**Âª∫ËÆÆ**: ${rec.suggestion}\\n\\n`;\n\n        if (rec.files && rec.files.length > 0) {\n          markdown += '**Áõ∏ÂÖ≥Êñá‰ª∂**:\\n';\n          for (const file of rec.files.slice(0, 5)) {\n            markdown += `- ${file}\\n`;\n          }\n          if (rec.files.length > 5) {\n            markdown += `- ... ËøòÊúâ ${rec.files.length - 5} ‰∏™Êñá‰ª∂\\n`;\n          }\n        }\n        markdown += '\\n';\n      }\n    }\n\n    // Êú™Ë¶ÜÁõñ‰ª£Á†ÅÁªüËÆ°\n    if (report.uncoveredLines.length > 0) {\n      markdown += '\\n## üîç Êú™Ë¶ÜÁõñ‰ª£Á†ÅÁªüËÆ°\\n\\n';\n      markdown += '| Êñá‰ª∂ | Êú™Ë¶ÜÁõñË°åÊï∞ |\\n';\n      markdown += '|------|------------|\\n';\n\n      for (const uncovered of report.uncoveredLines.slice(0, 10)) {\n        markdown += `| ${uncovered.file} | ${uncovered.count} |\\n`;\n      }\n    }\n\n    return markdown;\n  }\n\n  /**\n   * Ê£ÄÊü•Ë¶ÜÁõñÁéáÈòàÂÄº\n   */\n  checkCoverageThresholds() {\n    const { summary } = this.analysisResults;\n    const failures = [];\n\n    if (summary.statements.percentage < this.options.minCoverage.statements) {\n      failures.push(\n        `ËØ≠Âè•Ë¶ÜÁõñÁéá ${summary.statements.percentage.toFixed(2)}% < ${this.options.minCoverage.statements}%`\n      );\n    }\n\n    if (summary.branches.percentage < this.options.minCoverage.branches) {\n      failures.push(\n        `ÂàÜÊîØË¶ÜÁõñÁéá ${summary.branches.percentage.toFixed(2)}% < ${this.options.minCoverage.branches}%`\n      );\n    }\n\n    if (summary.functions.percentage < this.options.minCoverage.functions) {\n      failures.push(\n        `ÂáΩÊï∞Ë¶ÜÁõñÁéá ${summary.functions.percentage.toFixed(2)}% < ${this.options.minCoverage.functions}%`\n      );\n    }\n\n    if (summary.lines.percentage < this.options.minCoverage.lines) {\n      failures.push(\n        `Ë°åË¶ÜÁõñÁéá ${summary.lines.percentage.toFixed(2)}% < ${this.options.minCoverage.lines}%`\n      );\n    }\n\n    if (failures.length > 0) {\n      console.warn('\\n‚ö†Ô∏è  Ë¶ÜÁõñÁéáÈòàÂÄºÊ£ÄÊü•Â§±Ë¥•:');\n      failures.forEach((failure) => console.warn(`   - ${failure}`));\n\n      if (process.env.CI === 'true') {\n        console.error('\\n‚ùå CIÁéØÂ¢É‰∏≠Ë¶ÜÁõñÁéá‰∏çË∂≥ÔºåÊûÑÂª∫Â§±Ë¥•');\n        process.exit(1);\n      }\n    } else {\n      console.log('\\n‚úÖ ÊâÄÊúâË¶ÜÁõñÁéáÈòàÂÄºÊ£ÄÊü•ÈÄöËøá');\n    }\n  }\n\n  /**\n   * ËæÖÂä©ÊñπÊ≥ï\n   */\n  shouldExcludeFile(filePath) {\n    return this.options.excludePatterns.some((pattern) => {\n      const regex = new RegExp(pattern.replace(/\\*\\*/g, '.*').replace(/\\*/g, '[^/]*'));\n      return regex.test(filePath);\n    });\n  }\n\n  calculateCoveragePercentage(values, predicate) {\n    if (values.length === 0) {\n      return 0;\n    }\n    const covered = values.filter(predicate).length;\n    return (covered / values.length) * 100;\n  }\n\n  getUncoveredLines(fileData) {\n    const uncoveredLines = [];\n    const statements = fileData.s || {};\n    const statementMap = fileData.statementMap || {};\n\n    for (const [statementId, executionCount] of Object.entries(statements)) {\n      if (executionCount === 0 && statementMap[statementId]) {\n        const location = statementMap[statementId];\n        uncoveredLines.push({\n          line: location.start.line,\n          column: location.start.column,\n          endLine: location.end.line,\n          endColumn: location.end.column,\n        });\n      }\n    }\n\n    return uncoveredLines.sort((a, b) => a.line - b.line);\n  }\n\n  calculateComplexity(fileData) {\n    // ÁÆÄÂçïÁöÑÂ§çÊùÇÂ∫¶ËÆ°ÁÆóÔºöÂàÜÊîØÊï∞Èáè + ÂáΩÊï∞Êï∞Èáè\n    const branches = fileData.b || {};\n    const functions = fileData.f || {};\n\n    const branchCount = Object.values(branches).reduce((sum, branch) => sum + branch.length, 0);\n    const functionCount = Object.keys(functions).length;\n\n    return branchCount + functionCount;\n  }\n\n  getTrendDirection(current, previous) {\n    const diff = current - previous;\n    if (Math.abs(diff) < 0.1) {\n      return 'stable';\n    }\n    return diff > 0 ? 'up' : 'down';\n  }\n}\n\n// Â¶ÇÊûúÁõ¥Êé•ËøêË°åÊ≠§ËÑöÊú¨\nif (import.meta.url === `file://${process.argv[1]}`) {\n  const analyzer = new CoverageAnalyzer();\n\n  analyzer.analyze().catch((error) => {\n    console.error('Ë¶ÜÁõñÁéáÂàÜÊûêÂ§±Ë¥•:', error);\n    process.exit(1);\n  });\n}\n\nexport default CoverageAnalyzer;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/scripts/deploy.js","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'spawn' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":25},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":23,"column":41,"nodeType":"Literal","messageId":"noMagic","endLine":23,"endColumn":43},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":40,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":40,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[988,1018],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":51,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":51,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1163,1191],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":61,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":61,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1374,1404],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":70,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":70,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1620,1697],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":190,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":190,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[4305,4345],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":213,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":213,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[4732,4760],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":234,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":234,"endColumn":21,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[5222,5254],"text":""},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":237,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":237,"endColumn":19,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[5291,5321],"text":""},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":240,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":240,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[5333,5357],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":254,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":254,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[5645,5706],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":255,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":255,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[5711,5756],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":265,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":265,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[6060,6083],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":300,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":300,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[6800,6830],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":301,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":301,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[6837,6886],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":305,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":305,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[6935,6979],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":333,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":333,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[7575,7604],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":337,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":337,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[7717,7750],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":349,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":349,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[7987,8012],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":356,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":356,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[8078,8104],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":369,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":369,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[8341,8365],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":379,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":379,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[8515,8541],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":388,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":388,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[8712,8736],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":405,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":405,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[9015,9072],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":439,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":439,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[9831,9856],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'env' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":442,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":442,"endColumn":14},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":444,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":444,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[9929,9979],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":448,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":448,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[10031,10061],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":460,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":460,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[10252,10279],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":479,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":479,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[10686,10714],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":486,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":486,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[10906,10974],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":489,"column":61,"nodeType":"Literal","messageId":"noMagic","endLine":489,"endColumn":65},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":493,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":493,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[11133,11157],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":500,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":500,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[11298,11329],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5000.","line":501,"column":26,"nodeType":"Literal","messageId":"noMagic","endLine":501,"endColumn":30},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":510,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":510,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[11449,11478],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":514,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":514,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[11589,11622],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":521,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":521,"endColumn":23,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[11790,11848],"text":""},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":534,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":534,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[12034,12059],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":541,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":541,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[12127,12155],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":567,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":567,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[12882,12920],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":576,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":576,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[13025,13069],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'backupDir' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":578,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":578,"endColumn":20},{"ruleId":"prefer-destructuring","severity":2,"message":"Use array destructuring.","line":596,"column":7,"nodeType":"AssignmentExpression","messageId":"preferDestructuring","endLine":596,"endColumn":34},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":599,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":599,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[13571,13617],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":600,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":600,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[13622,13674],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":617,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":617,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[14067,14092],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":619,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":619,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[14121,14163],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'backup' is defined but never used. Allowed unused args must match /^_/u.","line":627,"column":38,"nodeType":"Identifier","messageId":"unusedVar","endLine":627,"endColumn":44},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":628,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":628,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[14267,14295],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":634,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":634,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[14426,14452],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":638,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":638,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[14509,14534],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":670,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":670,"endColumn":25,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[15345,15380],"text":""},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":692,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":692,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[15896,15934],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":694,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":694,"endColumn":23,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[15971,16027],"text":""},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":720,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":720,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[16531,16596],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":728,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":728,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[16710,16772],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":753,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":753,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[17249,17311],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":754,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":754,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[17316,17365],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":755,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":755,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[17370,17415],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 36.","line":776,"column":59,"nodeType":"Literal","messageId":"noMagic","endLine":776,"endColumn":61},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 9.","line":776,"column":73,"nodeType":"Literal","messageId":"noMagic","endLine":776,"endColumn":74},{"ruleId":"prefer-destructuring","severity":2,"message":"Use array destructuring.","line":815,"column":9,"nodeType":"VariableDeclarator","messageId":"preferDestructuring","endLine":815,"endColumn":26},{"ruleId":"prefer-destructuring","severity":2,"message":"Use array destructuring.","line":816,"column":9,"nodeType":"VariableDeclarator","messageId":"preferDestructuring","endLine":816,"endColumn":30},{"ruleId":"no-inner-declarations","severity":2,"message":"Move function declaration to program root.","line":820,"column":3,"nodeType":"FunctionDeclaration","messageId":"moveDeclToRoot","endLine":874,"endColumn":4},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":827,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":827,"endColumn":26,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[18854,18899],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":835,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":835,"endColumn":26,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[19108,19167],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":843,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":843,"endColumn":26,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[19354,19405],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":846,"column":11,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":846,"endColumn":68},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":847,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":847,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[19525,19566],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":849,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":849,"endColumn":24,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[19619,19671],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":854,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":854,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[19737,19764],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":858,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":858,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[19810,20070],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":869,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":869,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[20107,20151],"text":""},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":66,"fixableErrorCount":0,"fixableWarningCount":0,"source":"#!/usr/bin/env node\n\nimport fs from 'fs';\nimport path from 'path';\nimport { execSync, spawn } from 'child_process';\nimport { fileURLToPath } from 'url';\nimport readline from 'readline';\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\n\n/**\n * Ëá™Âä®ÂåñÈÉ®ÁΩ≤ÁÆ°ÁêÜÂô®\n * ÊîØÊåÅÂ§öÁéØÂ¢ÉÈÉ®ÁΩ≤„ÄÅÁâàÊú¨ÁÆ°ÁêÜ„ÄÅÂõûÊªöÁ≠âÂäüËÉΩ\n */\nclass DeploymentManager {\n  constructor(options = {}) {\n    this.options = {\n      projectRoot: options.projectRoot || path.resolve(__dirname, '..'),\n      configFile: options.configFile || 'deploy.config.js',\n      logFile: options.logFile || 'deployment.log',\n      backupDir: options.backupDir || '.deployments',\n      maxBackups: options.maxBackups || 10,\n      ...options,\n    };\n\n    this.config = null;\n    this.currentEnvironment = null;\n    this.deploymentId = this.generateDeploymentId();\n    this.rl = readline.createInterface({\n      input: process.stdin,\n      output: process.stdout,\n    });\n  }\n\n  /**\n   * ÂàùÂßãÂåñÈÉ®ÁΩ≤ÈÖçÁΩÆ\n   */\n  async initialize() {\n    console.log('üöÄ ÂàùÂßãÂåñÈÉ®ÁΩ≤ÁÆ°ÁêÜÂô®...');\n\n    // Âä†ËΩΩÈÖçÁΩÆ\n    await this.loadConfig();\n\n    // ÂàõÂª∫ÂøÖË¶ÅÁöÑÁõÆÂΩï\n    this.createDirectories();\n\n    // È™åËØÅÁéØÂ¢É\n    await this.validateEnvironment();\n\n    console.log('‚úÖ ÈÉ®ÁΩ≤ÁÆ°ÁêÜÂô®ÂàùÂßãÂåñÂÆåÊàê');\n  }\n\n  /**\n   * Âä†ËΩΩÈÉ®ÁΩ≤ÈÖçÁΩÆ\n   */\n  async loadConfig() {\n    const configPath = path.join(this.options.projectRoot, this.options.configFile);\n\n    if (!fs.existsSync(configPath)) {\n      console.log('üìù ÂàõÂª∫ÈªòËÆ§ÈÉ®ÁΩ≤ÈÖçÁΩÆ...');\n      await this.createDefaultConfig(configPath);\n    }\n\n    try {\n      // Âä®ÊÄÅÂØºÂÖ•ÈÖçÁΩÆÊñá‰ª∂\n      const configModule = await import(`file://${configPath}`);\n      this.config = configModule.default || configModule;\n\n      console.log(`‚úÖ ÈÖçÁΩÆÂä†ËΩΩÊàêÂäü: ${Object.keys(this.config.environments).join(', ')}`);\n    } catch (error) {\n      throw new Error(`Âä†ËΩΩÈÉ®ÁΩ≤ÈÖçÁΩÆÂ§±Ë¥•: ${error.message}`);\n    }\n  }\n\n  /**\n   * ÂàõÂª∫ÈªòËÆ§ÈÖçÁΩÆ\n   */\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 104 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 104 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 104 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 104 Ë°å)\n\n  async createDefaultConfig(configPath) {\n    const defaultConfig = `export default {\n  // È°πÁõÆ‰ø°ÊÅØ\n  project: {\n    name: 'Èõ∂Á¢≥Âõ≠Âå∫Êï∞Â≠óÂ≠™ÁîüËÉΩÁ¢≥ÁÆ°ÁêÜÁ≥ªÁªü',\n    version: '1.0.0',\n    repository: 'https://github.com/your-org/carbon-management-system.git'\n  },\n\n  // ÁéØÂ¢ÉÈÖçÁΩÆ\n  environments: {\n    development: {\n      name: 'ÂºÄÂèëÁéØÂ¢É',\n      host: 'localhost',\n      port: 3000,\n      buildCommand: 'npm run build:dev',\n      startCommand: 'npm run start:dev',\n      healthCheck: 'http://localhost:3000/health',\n      env: {\n        NODE_ENV: 'development',\n        LOG_LEVEL: 'debug'\n      }\n    },\n    \n    staging: {\n      name: 'ÊµãËØïÁéØÂ¢É',\n      host: 'staging.example.com',\n      port: 3000,\n      buildCommand: 'npm run build:staging',\n      startCommand: 'npm run start',\n      healthCheck: 'https://staging.example.com/health',\n      env: {\n        NODE_ENV: 'staging',\n        LOG_LEVEL: 'info'\n      },\n      deploy: {\n        method: 'ssh',\n        user: 'deploy',\n        path: '/var/www/carbon-management',\n        beforeDeploy: ['npm run test', 'npm run lint'],\n        afterDeploy: ['pm2 restart carbon-management']\n      }\n    },\n    \n    production: {\n      name: 'Áîü‰∫ßÁéØÂ¢É',\n      host: 'api.example.com',\n      port: 3000,\n      buildCommand: 'npm run build:prod',\n      startCommand: 'npm run start',\n      healthCheck: 'https://api.example.com/health',\n      env: {\n        NODE_ENV: 'production',\n        LOG_LEVEL: 'warn'\n      },\n      deploy: {\n        method: 'ssh',\n        user: 'deploy',\n        path: '/var/www/carbon-management',\n        beforeDeploy: [\n          'npm run test',\n          'npm run lint',\n          'npm run test:coverage',\n          'npm run security:audit'\n        ],\n        afterDeploy: [\n          'pm2 restart carbon-management',\n          'npm run health:check'\n        ],\n        backup: true,\n        confirmRequired: true\n      }\n    }\n  },\n\n  // ÈÄöÁü•ÈÖçÁΩÆ\n  notifications: {\n    slack: {\n      enabled: false,\n      webhook: process.env.SLACK_WEBHOOK,\n      channel: '#deployments'\n    },\n    email: {\n      enabled: false,\n      recipients: ['admin@example.com']\n    }\n  },\n\n  // ÁõëÊéßÈÖçÁΩÆ\n  monitoring: {\n    healthCheckTimeout: 30000,\n    healthCheckRetries: 3,\n    performanceThresholds: {\n      responseTime: 2000,\n      memoryUsage: 80,\n      cpuUsage: 70\n    }\n  }\n};\n`;\n\n    fs.writeFileSync(configPath, defaultConfig);\n    console.log(`‚úÖ ÈªòËÆ§ÈÖçÁΩÆÂ∑≤ÂàõÂª∫: ${configPath}`);\n  }\n\n  /**\n   * ÂàõÂª∫ÂøÖË¶ÅÁõÆÂΩï\n   */\n  createDirectories() {\n    const dirs = [\n      path.join(this.options.projectRoot, this.options.backupDir),\n      path.join(this.options.projectRoot, 'logs'),\n    ];\n\n    dirs.forEach((dir) => {\n      if (!fs.existsSync(dir)) {\n        fs.mkdirSync(dir, { recursive: true });\n      }\n    });\n  }\n\n  /**\n   * È™åËØÅÁéØÂ¢É\n   */\n  async validateEnvironment() {\n    console.log('üîç È™åËØÅÈÉ®ÁΩ≤ÁéØÂ¢É...');\n\n    // Ê£ÄÊü•ÂøÖË¶ÅÁöÑÂëΩ‰ª§\n    const requiredCommands = ['node', 'npm', 'git'];\n\n    for (const cmd of requiredCommands) {\n      try {\n        execSync(`which ${cmd}`, { stdio: 'ignore' });\n      } catch (error) {\n        throw new Error(`Áº∫Â∞ëÂøÖË¶ÅÂëΩ‰ª§: ${cmd}`);\n      }\n    }\n\n    // Ê£ÄÊü•GitÁä∂ÊÄÅ\n    try {\n      const gitStatus = execSync('git status --porcelain', {\n        cwd: this.options.projectRoot,\n        encoding: 'utf8',\n      });\n\n      if (gitStatus.trim()) {\n        console.warn('‚ö†Ô∏è  Â∑•‰ΩúÁõÆÂΩïÊúâÊú™Êèê‰∫§ÁöÑÊõ¥Êîπ');\n      }\n    } catch (error) {\n      console.warn('‚ö†Ô∏è  Êó†Ê≥ïÊ£ÄÊü•GitÁä∂ÊÄÅ');\n    }\n\n    console.log('‚úÖ ÁéØÂ¢ÉÈ™åËØÅÈÄöËøá');\n  }\n\n  /**\n   * ÈÉ®ÁΩ≤Âà∞ÊåáÂÆöÁéØÂ¢É\n   */\n  async deploy(environment, options = {}) {\n    if (!this.config.environments[environment]) {\n      throw new Error(`Êú™Áü•ÁéØÂ¢É: ${environment}`);\n    }\n\n    this.currentEnvironment = environment;\n    const envConfig = this.config.environments[environment];\n\n    console.log(`\\nüöÄ ÂºÄÂßãÈÉ®ÁΩ≤Âà∞ ${envConfig.name} (${environment})`);\n    console.log(`üìã ÈÉ®ÁΩ≤ID: ${this.deploymentId}`);\n\n    try {\n      // ËÆ∞ÂΩïÈÉ®ÁΩ≤ÂºÄÂßã\n      this.logDeployment('start', { environment, deploymentId: this.deploymentId });\n\n      // Á°ÆËÆ§ÈÉ®ÁΩ≤ÔºàÁîü‰∫ßÁéØÂ¢ÉÔºâ\n      if (envConfig.deploy?.confirmRequired && !options.force) {\n        const confirmed = await this.confirmDeployment(environment);\n        if (!confirmed) {\n          console.log('‚ùå ÈÉ®ÁΩ≤Â∑≤ÂèñÊ∂à');\n          return false;\n        }\n      }\n\n      // È¢ÑÈÉ®ÁΩ≤Ê£ÄÊü•\n      await this.preDeploymentChecks(envConfig);\n\n      // ÂàõÂª∫Â§á‰ªΩ\n      if (envConfig.deploy?.backup) {\n        await this.createBackup(environment);\n      }\n\n      // ÊûÑÂª∫È°πÁõÆ\n      await this.buildProject(envConfig);\n\n      // ÊâßË°åÈÉ®ÁΩ≤\n      await this.executeDeployment(envConfig);\n\n      // ÂÅ•Â∫∑Ê£ÄÊü•\n      await this.performHealthCheck(envConfig);\n\n      // ÂêéÈÉ®ÁΩ≤‰ªªÂä°\n      await this.postDeploymentTasks(envConfig);\n\n      // ÂèëÈÄÅÈÄöÁü•\n      await this.sendNotification('success', environment);\n\n      // ËÆ∞ÂΩïÈÉ®ÁΩ≤ÊàêÂäü\n      this.logDeployment('success', {\n        environment,\n        deploymentId: this.deploymentId,\n        duration: Date.now() - this.startTime,\n      });\n\n      console.log('\\n‚úÖ ÈÉ®ÁΩ≤ÊàêÂäüÂÆåÊàê! üéâ');\n      console.log(`üîó ËÆøÈóÆÂú∞ÂùÄ: ${envConfig.healthCheck}`);\n\n      return true;\n    } catch (error) {\n      console.error(`\\n‚ùå ÈÉ®ÁΩ≤Â§±Ë¥•: ${error.message}`);\n\n      // ËÆ∞ÂΩïÈÉ®ÁΩ≤Â§±Ë¥•\n      this.logDeployment('failure', {\n        environment,\n        deploymentId: this.deploymentId,\n        error: error.message,\n      });\n\n      // ÂèëÈÄÅÂ§±Ë¥•ÈÄöÁü•\n      await this.sendNotification('failure', environment, error.message);\n\n      // ËØ¢ÈóÆÊòØÂê¶ÂõûÊªö\n      if (envConfig.deploy?.backup) {\n        const shouldRollback = await this.askQuestion('ÊòØÂê¶Ë¶ÅÂõûÊªöÂà∞‰∏ä‰∏Ä‰∏™ÁâàÊú¨? (y/N): ');\n        if (shouldRollback.toLowerCase() === 'y') {\n          await this.rollback(environment);\n        }\n      }\n\n      throw error;\n    }\n  }\n\n  /**\n   * È¢ÑÈÉ®ÁΩ≤Ê£ÄÊü•\n   */\n  async preDeploymentChecks(envConfig) {\n    console.log('üîç ÊâßË°åÈ¢ÑÈÉ®ÁΩ≤Ê£ÄÊü•...');\n\n    if (envConfig.deploy?.beforeDeploy) {\n      for (const command of envConfig.deploy.beforeDeploy) {\n        console.log(`   ÊâßË°å: ${command}`);\n        try {\n          execSync(command, {\n            cwd: this.options.projectRoot,\n            stdio: 'inherit',\n          });\n        } catch (error) {\n          throw new Error(`È¢ÑÈÉ®ÁΩ≤Ê£ÄÊü•Â§±Ë¥•: ${command}`);\n        }\n      }\n    }\n\n    console.log('‚úÖ È¢ÑÈÉ®ÁΩ≤Ê£ÄÊü•ÈÄöËøá');\n  }\n\n  /**\n   * ÊûÑÂª∫È°πÁõÆ\n   */\n  async buildProject(envConfig) {\n    console.log('üî® ÊûÑÂª∫È°πÁõÆ...');\n\n    try {\n      // ËÆæÁΩÆÁéØÂ¢ÉÂèòÈáè\n      const env = { ...process.env, ...envConfig.env };\n\n      // ÊâßË°åÊûÑÂª∫ÂëΩ‰ª§\n      execSync(envConfig.buildCommand, {\n        cwd: this.options.projectRoot,\n        stdio: 'inherit',\n        env,\n      });\n\n      console.log('‚úÖ È°πÁõÆÊûÑÂª∫ÂÆåÊàê');\n    } catch (error) {\n      throw new Error(`È°πÁõÆÊûÑÂª∫Â§±Ë¥•: ${error.message}`);\n    }\n  }\n\n  /**\n   * ÊâßË°åÈÉ®ÁΩ≤\n   */\n  async executeDeployment(envConfig) {\n    console.log('üì¶ ÊâßË°åÈÉ®ÁΩ≤...');\n\n    if (envConfig.deploy?.method === 'ssh') {\n      await this.deployViaSSH(envConfig);\n    } else {\n      // Êú¨Âú∞ÈÉ®ÁΩ≤\n      await this.deployLocally(envConfig);\n    }\n\n    console.log('‚úÖ ÈÉ®ÁΩ≤ÊâßË°åÂÆåÊàê');\n  }\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 32 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 32 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 32 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 32 Ë°å)\n\n  /**\n   * SSHÈÉ®ÁΩ≤\n   */\n  async deployViaSSH(envConfig) {\n    const { user, host, path: remotePath } = envConfig.deploy;\n\n    console.log(`   ÈÄöËøáSSHÈÉ®ÁΩ≤Âà∞ ${user}@${host}:${remotePath}`);\n\n    // ÂàõÂª∫ÈÉ®ÁΩ≤ÂåÖ\n    const packagePath = await this.createDeploymentPackage();\n\n    try {\n      // ‰∏ä‰º†Êñá‰ª∂\n      execSync(`scp ${packagePath} ${user}@${host}:/tmp/deployment-${this.deploymentId}.tar.gz`, {\n        stdio: 'inherit',\n      });\n\n      // ËøúÁ®ãÈÉ®ÁΩ≤ËÑöÊú¨\n      const deployScript = `\n        cd ${remotePath} &&\n        tar -xzf /tmp/deployment-${this.deploymentId}.tar.gz &&\n        npm install --production &&\n        rm /tmp/deployment-${this.deploymentId}.tar.gz\n      `;\n\n      execSync(`ssh ${user}@${host} \"${deployScript}\"`, {\n        stdio: 'inherit',\n      });\n    } finally {\n      // Ê∏ÖÁêÜÊú¨Âú∞ÈÉ®ÁΩ≤ÂåÖ\n      if (fs.existsSync(packagePath)) {\n        fs.unlinkSync(packagePath);\n      }\n    }\n  }\n\n  /**\n   * Êú¨Âú∞ÈÉ®ÁΩ≤\n   */\n  async deployLocally(envConfig) {\n    console.log('   Êú¨Âú∞ÈÉ®ÁΩ≤Ê®°Âºè');\n\n    // ÂêØÂä®Â∫îÁî®\n    const env = { ...process.env, ...envConfig.env };\n\n    console.log(`   ÂêØÂä®ÂëΩ‰ª§: ${envConfig.startCommand}`);\n\n    // ËøôÈáåÂèØ‰ª•‰ΩøÁî®PM2ÊàñÂÖ∂‰ªñËøõÁ®ãÁÆ°ÁêÜÂô®\n    // ‰∏∫‰∫ÜÊºîÁ§∫ÔºåÊàë‰ª¨Âè™ÊòØËÆ∞ÂΩïÂëΩ‰ª§\n    console.log('   Â∫îÁî®Â∑≤ÂêØÂä®ÔºàÊºîÁ§∫Ê®°ÂºèÔºâ');\n  }\n\n  /**\n   * ÂàõÂª∫ÈÉ®ÁΩ≤ÂåÖ\n   */\n  async createDeploymentPackage() {\n    const packagePath = path.join(\n      this.options.projectRoot,\n      `deployment-${this.deploymentId}.tar.gz`\n    );\n\n    console.log('   ÂàõÂª∫ÈÉ®ÁΩ≤ÂåÖ...');\n\n    // ÊéíÈô§‰∏çÈúÄË¶ÅÁöÑÊñá‰ª∂\n    const excludePatterns = ['node_modules', '.git', 'tests', 'coverage', '*.log', '.env*']\n      .map((pattern) => `--exclude='${pattern}'`)\n      .join(' ');\n\n    execSync(`tar -czf ${packagePath} ${excludePatterns} .`, {\n      cwd: this.options.projectRoot,\n      stdio: 'inherit',\n    });\n\n    return packagePath;\n  }\n\n  /**\n   * ÂÅ•Â∫∑Ê£ÄÊü•\n   */\n  async performHealthCheck(envConfig) {\n    console.log('üè• ÊâßË°åÂÅ•Â∫∑Ê£ÄÊü•...');\n\n    const { healthCheck } = envConfig;\n    const { healthCheckTimeout, healthCheckRetries } = this.config.monitoring;\n\n    for (let i = 0; i < healthCheckRetries; i++) {\n      try {\n        console.log(`   Â∞ùËØï ${i + 1}/${healthCheckRetries}: ${healthCheck}`);\n\n        // ‰ΩøÁî®curlËøõË°åÂÅ•Â∫∑Ê£ÄÊü•\n        execSync(`curl -f --max-time ${healthCheckTimeout / 1000} ${healthCheck}`, {\n          stdio: 'ignore',\n        });\n\n        console.log('‚úÖ ÂÅ•Â∫∑Ê£ÄÊü•ÈÄöËøá');\n        return;\n      } catch (error) {\n        if (i === healthCheckRetries - 1) {\n          throw new Error('ÂÅ•Â∫∑Ê£ÄÊü•Â§±Ë¥•');\n        }\n\n        console.log('   Á≠âÂæÖ 5 ÁßíÂêéÈáçËØï...');\n        await this.sleep(5000);\n      }\n    }\n  }\n\n  /**\n   * ÂêéÈÉ®ÁΩ≤‰ªªÂä°\n   */\n  async postDeploymentTasks(envConfig) {\n    console.log('üîß ÊâßË°åÂêéÈÉ®ÁΩ≤‰ªªÂä°...');\n\n    if (envConfig.deploy?.afterDeploy) {\n      for (const command of envConfig.deploy.afterDeploy) {\n        console.log(`   ÊâßË°å: ${command}`);\n        try {\n          execSync(command, {\n            cwd: this.options.projectRoot,\n            stdio: 'inherit',\n          });\n        } catch (error) {\n          console.warn(`   ÂêéÈÉ®ÁΩ≤‰ªªÂä°Ë≠¶Âëä: ${command} - ${error.message}`);\n        }\n      }\n    }\n\n    // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 31 Ë°å)\n\n    // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 31 Ë°å)\n\n    // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 31 Ë°å)\n\n    // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 31 Ë°å)\n\n    console.log('‚úÖ ÂêéÈÉ®ÁΩ≤‰ªªÂä°ÂÆåÊàê');\n  }\n\n  /**\n   * ÂàõÂª∫Â§á‰ªΩ\n   */\n  async createBackup(environment) {\n    console.log('üíæ ÂàõÂª∫ÈÉ®ÁΩ≤Â§á‰ªΩ...');\n\n    const backupDir = path.join(this.options.projectRoot, this.options.backupDir);\n    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');\n    const backupPath = path.join(backupDir, `${environment}-${timestamp}`);\n\n    // ÂàõÂª∫Â§á‰ªΩÁõÆÂΩï\n    fs.mkdirSync(backupPath, { recursive: true });\n\n    // Â§á‰ªΩÂΩìÂâçÁâàÊú¨‰ø°ÊÅØ\n    const backupInfo = {\n      environment,\n      timestamp: new Date().toISOString(),\n      deploymentId: this.deploymentId,\n      gitCommit: this.getCurrentGitCommit(),\n      packageVersion: this.getPackageVersion(),\n    };\n\n    fs.writeFileSync(\n      path.join(backupPath, 'backup-info.json'),\n      JSON.stringify(backupInfo, null, 2)\n    );\n\n    // Ê∏ÖÁêÜÊóßÂ§á‰ªΩ\n    await this.cleanupOldBackups(environment);\n\n    console.log(`‚úÖ Â§á‰ªΩÂ∑≤ÂàõÂª∫: ${backupPath}`);\n\n    return backupPath;\n  }\n\n  /**\n   * ÂõûÊªöÈÉ®ÁΩ≤\n   */\n  async rollback(environment, backupId = null) {\n    console.log(`üîÑ ÂºÄÂßãÂõûÊªö ${environment} ÁéØÂ¢É...`);\n\n    const backupDir = path.join(this.options.projectRoot, this.options.backupDir);\n\n    // Ëé∑ÂèñÂèØÁî®ÁöÑÂ§á‰ªΩ\n    const backups = this.getAvailableBackups(environment);\n\n    if (backups.length === 0) {\n      throw new Error('Ê≤°ÊúâÂèØÁî®ÁöÑÂ§á‰ªΩ');\n    }\n\n    let selectedBackup;\n\n    if (backupId) {\n      selectedBackup = backups.find((b) => b.id === backupId);\n      if (!selectedBackup) {\n        throw new Error(`Â§á‰ªΩ‰∏çÂ≠òÂú®: ${backupId}`);\n      }\n    } else {\n      // ‰ΩøÁî®ÊúÄÊñ∞ÁöÑÂ§á‰ªΩ\n      selectedBackup = backups[0];\n    }\n\n    console.log(`üì¶ ÂõûÊªöÂà∞Â§á‰ªΩ: ${selectedBackup.id}`);\n    console.log(`üìÖ Â§á‰ªΩÊó∂Èó¥: ${selectedBackup.timestamp}`);\n\n    try {\n      // ÊâßË°åÂõûÊªö\n      await this.executeRollback(environment, selectedBackup);\n\n      // ÂÅ•Â∫∑Ê£ÄÊü•\n      const envConfig = this.config.environments[environment];\n      await this.performHealthCheck(envConfig);\n\n      // ËÆ∞ÂΩïÂõûÊªö\n      this.logDeployment('rollback', {\n        environment,\n        backupId: selectedBackup.id,\n        rollbackId: this.generateDeploymentId(),\n      });\n\n      console.log('‚úÖ ÂõûÊªöÊàêÂäüÂÆåÊàê!');\n    } catch (error) {\n      console.error(`‚ùå ÂõûÊªöÂ§±Ë¥•: ${error.message}`);\n      throw error;\n    }\n  }\n\n  /**\n   * ÊâßË°åÂõûÊªö\n   */\n  async executeRollback(environment, backup) {\n    console.log('üîÑ ÊâßË°åÂõûÊªöÊìç‰Ωú...');\n\n    const envConfig = this.config.environments[environment];\n\n    if (envConfig.deploy?.method === 'ssh') {\n      // SSHÂõûÊªö\n      console.log('   SSHÂõûÊªöÊ®°Âºè');\n      // ËøôÈáåÂ∫îËØ•ÂÆûÁé∞SSHÂõûÊªöÈÄªËæë\n    } else {\n      // Êú¨Âú∞ÂõûÊªö\n      console.log('   Êú¨Âú∞ÂõûÊªöÊ®°Âºè');\n      // ËøôÈáåÂ∫îËØ•ÂÆûÁé∞Êú¨Âú∞ÂõûÊªöÈÄªËæë\n    }\n  }\n\n  /**\n   * Ëé∑ÂèñÂèØÁî®Â§á‰ªΩ\n   */\n  getAvailableBackups(environment) {\n    const backupDir = path.join(this.options.projectRoot, this.options.backupDir);\n\n    if (!fs.existsSync(backupDir)) {\n      return [];\n    }\n\n    const backups = [];\n    const entries = fs.readdirSync(backupDir);\n\n    for (const entry of entries) {\n      if (entry.startsWith(`${environment}-`)) {\n        const backupPath = path.join(backupDir, entry);\n        const infoPath = path.join(backupPath, 'backup-info.json');\n\n        if (fs.existsSync(infoPath)) {\n          try {\n            const info = JSON.parse(fs.readFileSync(infoPath, 'utf8'));\n            backups.push({\n              id: entry,\n              path: backupPath,\n              ...info,\n            });\n          } catch (error) {\n            console.warn(`Êó†Ê≥ïËØªÂèñÂ§á‰ªΩ‰ø°ÊÅØ: ${entry}`);\n          }\n        }\n      }\n    }\n\n    // ÊåâÊó∂Èó¥ÊéíÂ∫èÔºàÊúÄÊñ∞ÁöÑÂú®ÂâçÔºâ\n    return backups.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));\n  }\n\n  /**\n   * Ê∏ÖÁêÜÊóßÂ§á‰ªΩ\n   */\n  async cleanupOldBackups(environment) {\n    const backups = this.getAvailableBackups(environment);\n\n    if (backups.length > this.options.maxBackups) {\n      const toDelete = backups.slice(this.options.maxBackups);\n\n      for (const backup of toDelete) {\n        try {\n          fs.rmSync(backup.path, { recursive: true, force: true });\n          console.log(`   Ê∏ÖÁêÜÊóßÂ§á‰ªΩ: ${backup.id}`);\n        } catch (error) {\n          console.warn(`Ê∏ÖÁêÜÂ§á‰ªΩÂ§±Ë¥•: ${backup.id} - ${error.message}`);\n        }\n      }\n    }\n  }\n\n  /**\n   * ÂèëÈÄÅÈÄöÁü•\n   */\n  async sendNotification(type, environment, message = '') {\n    const { notifications } = this.config;\n\n    if (notifications.slack?.enabled) {\n      await this.sendSlackNotification(type, environment, message);\n    }\n\n    if (notifications.email?.enabled) {\n      await this.sendEmailNotification(type, environment, message);\n    }\n  }\n\n  /**\n   * ÂèëÈÄÅSlackÈÄöÁü•\n   */\n  async sendSlackNotification(type, environment, message) {\n    // ËøôÈáåÂ∫îËØ•ÂÆûÁé∞SlackÈÄöÁü•ÈÄªËæë\n    console.log(`üì± SlackÈÄöÁü•: ${type} - ${environment} - ${message}`);\n  }\n\n  /**\n   * ÂèëÈÄÅÈÇÆ‰ª∂ÈÄöÁü•\n   */\n  async sendEmailNotification(type, environment, message) {\n    // ËøôÈáåÂ∫îËØ•ÂÆûÁé∞ÈÇÆ‰ª∂ÈÄöÁü•ÈÄªËæë\n    console.log(`üìß ÈÇÆ‰ª∂ÈÄöÁü•: ${type} - ${environment} - ${message}`);\n  }\n\n  /**\n   * ËÆ∞ÂΩïÈÉ®ÁΩ≤Êó•Âøó\n   */\n  logDeployment(type, data) {\n    const logEntry = {\n      timestamp: new Date().toISOString(),\n      type,\n      ...data,\n    };\n\n    const logFile = path.join(this.options.projectRoot, 'logs', this.options.logFile);\n    const logLine = `${JSON.stringify(logEntry)}\\n`;\n\n    fs.appendFileSync(logFile, logLine);\n  }\n\n  /**\n   * Á°ÆËÆ§ÈÉ®ÁΩ≤\n   */\n  async confirmDeployment(environment) {\n    const envConfig = this.config.environments[environment];\n\n    console.log(`\\n‚ö†Ô∏è  Âç≥Â∞ÜÈÉ®ÁΩ≤Âà∞ ${envConfig.name} (${environment})`);\n    console.log(`üîó ÁõÆÊ†áÂú∞ÂùÄ: ${envConfig.healthCheck}`);\n    console.log(`üìã ÈÉ®ÁΩ≤ID: ${this.deploymentId}`);\n\n    const answer = await this.askQuestion('\\nÁ°ÆËÆ§ÁªßÁª≠ÈÉ®ÁΩ≤? (y/N): ');\n    return answer.toLowerCase() === 'y';\n  }\n\n  /**\n   * ËØ¢ÈóÆÁî®Êà∑ËæìÂÖ•\n   */\n  askQuestion(question) {\n    return new Promise((resolve) => {\n      this.rl.question(question, (answer) => {\n        resolve(answer);\n      });\n    });\n  }\n\n  /**\n   * ËæÖÂä©ÊñπÊ≥ï\n   */\n  generateDeploymentId() {\n    return `deploy-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n  }\n\n  getCurrentGitCommit() {\n    try {\n      return execSync('git rev-parse HEAD', {\n        cwd: this.options.projectRoot,\n        encoding: 'utf8',\n      }).trim();\n    } catch (error) {\n      return 'unknown';\n    }\n  }\n\n  getPackageVersion() {\n    try {\n      const packagePath = path.join(this.options.projectRoot, 'package.json');\n      const packageJson = JSON.parse(fs.readFileSync(packagePath, 'utf8'));\n      return packageJson.version;\n    } catch (error) {\n      return 'unknown';\n    }\n  }\n\n  sleep(ms) {\n    return new Promise((resolve) => setTimeout(resolve, ms));\n  }\n\n  /**\n   * Ê∏ÖÁêÜËµÑÊ∫ê\n   */\n  cleanup() {\n    this.rl.close();\n  }\n}\n\n// ÂëΩ‰ª§Ë°åÊé•Âè£\nif (import.meta.url === `file://${process.argv[1]}`) {\n  const args = process.argv.slice(2);\n  const command = args[0];\n  const environment = args[1];\n\n  const manager = new DeploymentManager();\n\n  async function main() {\n    try {\n      await manager.initialize();\n\n      switch (command) {\n        case 'deploy':\n          if (!environment) {\n            console.error('ËØ∑ÊåáÂÆöÁéØÂ¢É: deploy <environment>');\n            process.exit(1);\n          }\n          await manager.deploy(environment, { force: args.includes('--force') });\n          break;\n\n        case 'rollback':\n          if (!environment) {\n            console.error('ËØ∑ÊåáÂÆöÁéØÂ¢É: rollback <environment> [backup-id]');\n            process.exit(1);\n          }\n          await manager.rollback(environment, args[2]);\n          break;\n\n        case 'list-backups':\n          if (!environment) {\n            console.error('ËØ∑ÊåáÂÆöÁéØÂ¢É: list-backups <environment>');\n            process.exit(1);\n          }\n          const backups = manager.getAvailableBackups(environment);\n          console.log(`\\n${environment} ÁéØÂ¢ÉÁöÑÂèØÁî®Â§á‰ªΩ:`);\n          backups.forEach((backup) => {\n            console.log(`  ${backup.id} - ${backup.timestamp}`);\n          });\n          break;\n\n        case 'status':\n          console.log('ÈÉ®ÁΩ≤Áä∂ÊÄÅÊ£ÄÊü•ÂäüËÉΩÂæÖÂÆûÁé∞');\n          break;\n\n        default:\n          console.log(`\n‰ΩøÁî®ÊñπÊ≥ï:\n  node deploy.js deploy <environment> [--force]\n  node deploy.js rollback <environment> [backup-id]\n  node deploy.js list-backups <environment>\n  node deploy.js status\n\nÂèØÁî®ÁéØÂ¢É: ${Object.keys(manager.config?.environments || {}).join(', ')}\n`);\n      }\n    } catch (error) {\n      console.error(`\\n‚ùå Êìç‰ΩúÂ§±Ë¥•: ${error.message}`);\n      process.exit(1);\n    } finally {\n      manager.cleanup();\n    }\n  }\n\n  main();\n}\n\nexport default DeploymentManager;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/scripts/enhanced-quality-check.js","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'spawn' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":21},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":81,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":81,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2167,2199],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":82,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":82,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2204,2232],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 50.","line":82,"column":28,"nodeType":"Literal","messageId":"noMagic","endLine":82,"endColumn":30},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":102,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":102,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[2743,2790],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":111,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":111,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2877,2911],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":137,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":137,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[3768,3835],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":144,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":144,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[3983,4015],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":152,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":152,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[4088,4126],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":165,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":165,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[4350,4389],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":173,"column":28,"nodeType":"Literal","messageId":"noMagic","endLine":173,"endColumn":31},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":173,"column":60,"nodeType":"Literal","messageId":"noMagic","endLine":173,"endColumn":62},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":177,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":177,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[4705,4771],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":185,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":185,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[4848,4888],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":198,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":198,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[5108,5147],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":206,"column":28,"nodeType":"Literal","messageId":"noMagic","endLine":206,"endColumn":31},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5.","line":206,"column":47,"nodeType":"Literal","messageId":"noMagic","endLine":206,"endColumn":48},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":211,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":211,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[5498,5550],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":219,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":219,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[5615,5647],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'result' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":222,"column":23,"nodeType":"Identifier","messageId":"unusedVar","endLine":222,"endColumn":29},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 80.","line":249,"column":34,"nodeType":"Literal","messageId":"noMagic","endLine":249,"endColumn":36},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":256,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":256,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[6727,6799],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":263,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":263,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[6946,6973],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":271,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":271,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[7039,7069],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":302,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":302,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[8023,8086],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":327,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":327,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[8904,8972],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":334,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":334,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[9173,9200],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":342,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":342,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[9365,9392],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":351,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":351,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[9469,9498],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":364,"column":28,"nodeType":"Literal","messageId":"noMagic","endLine":364,"endColumn":31},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5.","line":364,"column":50,"nodeType":"Literal","messageId":"noMagic","endLine":364,"endColumn":51},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":369,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":369,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[9985,10032],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":379,"column":32,"nodeType":"Literal","messageId":"noMagic","endLine":379,"endColumn":35},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5.","line":379,"column":54,"nodeType":"Literal","messageId":"noMagic","endLine":379,"endColumn":55},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":384,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":384,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[10480,10529],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":390,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":390,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[10683,10717],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":398,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":398,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[10886,10914],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":407,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":407,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[10993,11022],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 70.","line":430,"column":36,"nodeType":"Literal","messageId":"noMagic","endLine":430,"endColumn":38},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":441,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":441,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[12069,12135],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":448,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":448,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[12287,12315],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":456,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":456,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[12384,12412],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'jsFiles' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":460,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":460,"endColumn":20},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":468,"column":28,"nodeType":"Literal","messageId":"noMagic","endLine":468,"endColumn":31},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":468,"column":54,"nodeType":"Literal","messageId":"noMagic","endLine":468,"endColumn":56},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":472,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":472,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[12810,12864],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":479,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":479,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[13017,13044],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 80.","line":501,"column":51,"nodeType":"Literal","messageId":"noMagic","endLine":501,"endColumn":53},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 80.","line":541,"column":43,"nodeType":"Literal","messageId":"noMagic","endLine":541,"endColumn":45},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":581,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":581,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[15870,15897],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":582,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":582,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[15902,15940],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":583,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":583,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[15945,15983],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":709,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":709,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[21281,21316],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 50.","line":709,"column":33,"nodeType":"Literal","messageId":"noMagic","endLine":709,"endColumn":35},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":710,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":710,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[21321,21348],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":711,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":711,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[21353,21381],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 50.","line":711,"column":28,"nodeType":"Literal","messageId":"noMagic","endLine":711,"endColumn":30},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":712,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":712,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[21386,21473],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":713,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":713,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[21478,21528],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":714,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":714,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[21533,21549],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":726,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":726,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[21845,21961],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":732,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":732,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[22026,22052],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":734,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":734,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[22122,22184],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":735,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":735,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[22193,22229],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":739,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":739,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[22251,22286],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 50.","line":739,"column":33,"nodeType":"Literal","messageId":"noMagic","endLine":739,"endColumn":35},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":744,"column":24,"nodeType":"Literal","messageId":"noMagic","endLine":744,"endColumn":27},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":744,"column":39,"nodeType":"Literal","messageId":"noMagic","endLine":744,"endColumn":41},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":756,"column":24,"nodeType":"Literal","messageId":"noMagic","endLine":756,"endColumn":27},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 30.","line":756,"column":37,"nodeType":"Literal","messageId":"noMagic","endLine":756,"endColumn":39},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":756,"column":51,"nodeType":"Literal","messageId":"noMagic","endLine":756,"endColumn":53},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 20.","line":760,"column":21,"nodeType":"Literal","messageId":"noMagic","endLine":760,"endColumn":23},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":761,"column":14,"nodeType":"Literal","messageId":"noMagic","endLine":761,"endColumn":17},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 50.","line":763,"column":21,"nodeType":"Literal","messageId":"noMagic","endLine":763,"endColumn":23},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 80.","line":764,"column":14,"nodeType":"Literal","messageId":"noMagic","endLine":764,"endColumn":16},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":766,"column":21,"nodeType":"Literal","messageId":"noMagic","endLine":766,"endColumn":24},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":767,"column":14,"nodeType":"Literal","messageId":"noMagic","endLine":767,"endColumn":16},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 40.","line":769,"column":12,"nodeType":"Literal","messageId":"noMagic","endLine":769,"endColumn":14},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":789,"column":82,"nodeType":"Literal","messageId":"noMagic","endLine":789,"endColumn":85},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":791,"column":86,"nodeType":"Literal","messageId":"noMagic","endLine":791,"endColumn":89},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":792,"column":90,"nodeType":"Literal","messageId":"noMagic","endLine":792,"endColumn":93},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":793,"column":74,"nodeType":"Literal","messageId":"noMagic","endLine":793,"endColumn":77},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 90.","line":799,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":799,"endColumn":20},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 80.","line":802,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":802,"endColumn":20},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 70.","line":805,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":805,"endColumn":20},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":812,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":812,"endColumn":20},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":897,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":897,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[26395,26429],"text":""},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":84,"fixableErrorCount":0,"fixableWarningCount":0,"source":"#!/usr/bin/env node\n\n/**\n * Â¢ûÂº∫ÁöÑ‰ª£Á†ÅË¥®ÈáèÊ£ÄÊü•ËÑöÊú¨\n * Êèê‰æõÂÖ®Èù¢ÁöÑ‰ª£Á†ÅË¥®ÈáèÂàÜÊûê„ÄÅÊä•ÂëäÁîüÊàêÂíåÊîπËøõÂª∫ËÆÆ\n */\n\nimport { exec, spawn } from 'child_process';\nimport { promisify } from 'util';\nimport fs from 'fs';\nimport path from 'path';\n\nconst execAsync = promisify(exec);\nimport { fileURLToPath } from 'url';\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\nconst projectRoot = path.resolve(__dirname, '..');\n\nclass EnhancedQualityChecker {\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 47 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 47 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 47 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 47 Ë°å)\n\n  constructor() {\n    this.results = {\n      timestamp: new Date().toISOString(),\n      overall: {\n        score: 0,\n        grade: 'F',\n        status: 'FAIL',\n      },\n      checks: {\n        eslint: { status: 'PENDING', score: 0, issues: [] },\n        prettier: { status: 'PENDING', score: 0, issues: [] },\n        typescript: { status: 'PENDING', score: 0, issues: [] },\n        tests: { status: 'PENDING', score: 0, coverage: {} },\n        security: { status: 'PENDING', score: 0, vulnerabilities: [] },\n        dependencies: { status: 'PENDING', score: 0, outdated: [] },\n        complexity: { status: 'PENDING', score: 0, metrics: {} },\n        duplication: { status: 'PENDING', score: 0, duplicates: [] },\n      },\n      recommendations: [],\n      metrics: {\n        linesOfCode: 0,\n        testCoverage: 0,\n        technicalDebt: 0,\n        maintainabilityIndex: 0,\n      },\n    };\n\n    this.config = {\n      thresholds: {\n        eslint: { maxWarnings: 10, maxErrors: 0 },\n        coverage: { statements: 80, branches: 75, functions: 80, lines: 80 },\n        complexity: { maxCyclomaticComplexity: 10, maxCognitiveComplexity: 15 },\n        duplication: { maxDuplicationPercentage: 5 },\n        security: { maxHighVulnerabilities: 0, maxMediumVulnerabilities: 2 },\n      },\n      weights: {\n        eslint: 0.2,\n        prettier: 0.1,\n        typescript: 0.15,\n        tests: 0.25,\n        security: 0.15,\n        dependencies: 0.05,\n        complexity: 0.05,\n        duplication: 0.05,\n      },\n    };\n  }\n\n  /**\n   * ÊâßË°åÊâÄÊúâË¥®ÈáèÊ£ÄÊü•\n   */\n  async runAllChecks() {\n    console.log('üîç ÂºÄÂßãÂ¢ûÂº∫‰ª£Á†ÅË¥®ÈáèÊ£ÄÊü•...');\n    console.log('='.repeat(50));\n\n    try {\n      await this.checkESLint();\n      await this.checkPrettier();\n      await this.checkTypeScript();\n      await this.runTests();\n      await this.checkSecurity();\n      await this.checkDependencies();\n      await this.analyzeComplexity();\n      await this.checkDuplication();\n\n      this.calculateOverallScore();\n      this.generateRecommendations();\n      await this.generateReports();\n\n      this.printSummary();\n\n      return this.results.overall.status === 'PASS';\n    } catch (error) {\n      console.error('‚ùå Ë¥®ÈáèÊ£ÄÊü•ËøáÁ®ã‰∏≠ÂèëÁîüÈîôËØØ:', error.message);\n      return false;\n    }\n  }\n\n  /**\n   * ESLint Ê£ÄÊü•\n   */\n  async checkESLint() {\n    console.log('üìã ËøêË°å ESLint Ê£ÄÊü•...');\n\n    try {\n      const { stdout: result } = await execAsync(\n        'npx eslint . --format json --config .eslintrc.enhanced.cjs',\n        {\n          encoding: 'utf8',\n          cwd: projectRoot,\n        }\n      );\n\n      const eslintResults = JSON.parse(result);\n      const totalErrors = eslintResults.reduce((sum, file) => sum + file.errorCount, 0);\n      const totalWarnings = eslintResults.reduce((sum, file) => sum + file.warningCount, 0);\n\n      this.results.checks.eslint = {\n        status:\n          totalErrors === 0 && totalWarnings <= this.config.thresholds.eslint.maxWarnings\n            ? 'PASS'\n            : 'FAIL',\n        score: this.calculateESLintScore(totalErrors, totalWarnings),\n        errors: totalErrors,\n        warnings: totalWarnings,\n        issues: eslintResults.filter((file) => file.messages.length > 0),\n      };\n\n      console.log(`   ‚úÖ ESLint: ${totalErrors} ÈîôËØØ, ${totalWarnings} Ë≠¶Âëä`);\n    } catch (error) {\n      this.results.checks.eslint = {\n        status: 'ERROR',\n        score: 0,\n        error: error.message,\n      };\n      console.log('   ‚ùå ESLint Ê£ÄÊü•Â§±Ë¥•');\n    }\n  }\n\n  /**\n   * Prettier Ê†ºÂºèÊ£ÄÊü•\n   */\n  async checkPrettier() {\n    console.log('üé® ËøêË°å Prettier Ê†ºÂºèÊ£ÄÊü•...');\n\n    try {\n      await execAsync('npx prettier --check .', {\n        encoding: 'utf8',\n        cwd: projectRoot,\n      });\n\n      this.results.checks.prettier = {\n        status: 'PASS',\n        score: 100,\n      };\n\n      console.log('   ‚úÖ Prettier: ÊâÄÊúâÊñá‰ª∂Ê†ºÂºèÊ≠£Á°Æ');\n    } catch (error) {\n      const unformattedFiles = error.stdout\n        ? error.stdout.split('\\n').filter((line) => line.trim())\n        : [];\n\n      this.results.checks.prettier = {\n        status: 'FAIL',\n        score: Math.max(0, 100 - unformattedFiles.length * 10),\n        unformattedFiles,\n      };\n\n      console.log(`   ‚ùå Prettier: ${unformattedFiles.length} ‰∏™Êñá‰ª∂Ê†ºÂºè‰∏çÊ≠£Á°Æ`);\n    }\n  }\n\n  /**\n   * TypeScript Á±ªÂûãÊ£ÄÊü•\n   */\n  async checkTypeScript() {\n    console.log('üî∑ ËøêË°å TypeScript Á±ªÂûãÊ£ÄÊü•...');\n\n    try {\n      await execAsync('npx tsc --noEmit', {\n        encoding: 'utf8',\n        cwd: projectRoot,\n      });\n\n      this.results.checks.typescript = {\n        status: 'PASS',\n        score: 100,\n      };\n\n      console.log('   ‚úÖ TypeScript: Á±ªÂûãÊ£ÄÊü•ÈÄöËøá');\n    } catch (error) {\n      const typeErrors = error.stdout\n        ? error.stdout.split('\\n').filter((line) => line.includes('error TS')).length\n        : 0;\n\n      this.results.checks.typescript = {\n        status: 'FAIL',\n        score: Math.max(0, 100 - typeErrors * 5),\n        errors: typeErrors,\n        details: error.stdout,\n      };\n\n      console.log(`   ‚ùå TypeScript: ${typeErrors} ‰∏™Á±ªÂûãÈîôËØØ`);\n    }\n  }\n\n  /**\n   * ËøêË°åÊµãËØïÂπ∂Êî∂ÈõÜË¶ÜÁõñÁéá\n   */\n  async runTests() {\n    console.log('üß™ ËøêË°åÊµãËØïÂπ∂Êî∂ÈõÜË¶ÜÁõñÁéá...');\n\n    try {\n      const { stdout: result } = await execAsync(\n        'npx jest --coverage --coverageReporters=json --config jest.enhanced.config.js',\n        { encoding: 'utf8', cwd: projectRoot }\n      );\n\n      // ËØªÂèñË¶ÜÁõñÁéáÊä•Âëä\n      const coveragePath = path.join(projectRoot, 'coverage/coverage-final.json');\n      let coverage = {\n        total: {\n          statements: { pct: 0 },\n          branches: { pct: 0 },\n          functions: { pct: 0 },\n          lines: { pct: 0 },\n        },\n      };\n\n      try {\n        await fs.promises.access(coveragePath);\n        const coverageData = JSON.parse(await fs.promises.readFile(coveragePath, 'utf8'));\n        coverage = this.calculateTotalCoverage(coverageData);\n      } catch {\n        // Ë¶ÜÁõñÁéáÊñá‰ª∂‰∏çÂ≠òÂú®Ôºå‰ΩøÁî®ÈªòËÆ§ÂÄº\n      }\n\n      const coverageScore = this.calculateCoverageScore(coverage.total);\n\n      this.results.checks.tests = {\n        status: coverageScore >= 80 ? 'PASS' : 'FAIL',\n        score: coverageScore,\n        coverage: coverage.total,\n      };\n\n      this.results.metrics.testCoverage = coverage.total.statements.pct;\n\n      console.log(`   ‚úÖ ÊµãËØïË¶ÜÁõñÁéá: ${coverage.total.statements.pct.toFixed(1)}%`);\n    } catch (error) {\n      this.results.checks.tests = {\n        status: 'ERROR',\n        score: 0,\n        error: error.message,\n      };\n      console.log('   ‚ùå ÊµãËØïËøêË°åÂ§±Ë¥•');\n    }\n  }\n\n  /**\n   * ÂÆâÂÖ®ÊºèÊ¥ûÊ£ÄÊü•\n   */\n  async checkSecurity() {\n    console.log('üîí ËøêË°åÂÆâÂÖ®ÊºèÊ¥ûÊ£ÄÊü•...');\n\n    try {\n      const { stdout: result } = await execAsync('npm audit --json', {\n        encoding: 'utf8',\n        cwd: projectRoot,\n      });\n\n      const auditData = JSON.parse(result);\n      const vulnerabilities = auditData.vulnerabilities || {};\n\n      const highVulns = Object.values(vulnerabilities).filter((v) => v.severity === 'high').length;\n      const mediumVulns = Object.values(vulnerabilities).filter(\n        (v) => v.severity === 'moderate'\n      ).length;\n\n      const securityScore = this.calculateSecurityScore(highVulns, mediumVulns);\n\n      this.results.checks.security = {\n        status:\n          highVulns === 0 && mediumVulns <= this.config.thresholds.security.maxMediumVulnerabilities\n            ? 'PASS'\n            : 'FAIL',\n        score: securityScore,\n        vulnerabilities: {\n          high: highVulns,\n          medium: mediumVulns,\n          total: Object.keys(vulnerabilities).length,\n        },\n      };\n\n      console.log(`   ‚úÖ ÂÆâÂÖ®Ê£ÄÊü•: ${highVulns} È´òÂç±, ${mediumVulns} ‰∏≠Âç±ÊºèÊ¥û`);\n    } catch (error) {\n      // npm audit Âú®ÊúâÊºèÊ¥ûÊó∂‰ºöËøîÂõûÈùûÈõ∂ÈÄÄÂá∫Á†Å\n      if (error.stdout) {\n        try {\n          const auditData = JSON.parse(error.stdout);\n          const vulnerabilities = auditData.vulnerabilities || {};\n\n          const highVulns = Object.values(vulnerabilities).filter(\n            (v) => v.severity === 'high'\n          ).length;\n          const mediumVulns = Object.values(vulnerabilities).filter(\n            (v) => v.severity === 'moderate'\n          ).length;\n\n          this.results.checks.security = {\n            status: 'FAIL',\n            score: this.calculateSecurityScore(highVulns, mediumVulns),\n            vulnerabilities: {\n              high: highVulns,\n              medium: mediumVulns,\n              total: Object.keys(vulnerabilities).length,\n            },\n          };\n\n          console.log(`   ‚ö†Ô∏è  ÂÆâÂÖ®Ê£ÄÊü•: ÂèëÁé∞ ${highVulns} È´òÂç±, ${mediumVulns} ‰∏≠Âç±ÊºèÊ¥û`);\n        } catch (parseError) {\n          this.results.checks.security = {\n            status: 'ERROR',\n            score: 0,\n            error: 'Failed to parse audit results',\n          };\n          console.log('   ‚ùå ÂÆâÂÖ®Ê£ÄÊü•Â§±Ë¥•');\n        }\n      } else {\n        this.results.checks.security = {\n          status: 'ERROR',\n          score: 0,\n          error: error.message,\n        };\n        console.log('   ‚ùå ÂÆâÂÖ®Ê£ÄÊü•Â§±Ë¥•');\n      }\n    }\n  }\n\n  /**\n   * ‰æùËµñÈ°πÊ£ÄÊü•\n   */\n  async checkDependencies() {\n    console.log('üì¶ Ê£ÄÊü•‰æùËµñÈ°πÁä∂ÊÄÅ...');\n\n    try {\n      const { stdout: result } = await execAsync('npm outdated --json', {\n        encoding: 'utf8',\n        cwd: projectRoot,\n      });\n\n      const outdated = JSON.parse(result || '{}');\n      const outdatedCount = Object.keys(outdated).length;\n\n      this.results.checks.dependencies = {\n        status: outdatedCount === 0 ? 'PASS' : 'WARN',\n        score: Math.max(0, 100 - outdatedCount * 5),\n        outdated: outdatedCount,\n        packages: outdated,\n      };\n\n      console.log(`   ‚úÖ ‰æùËµñÈ°π: ${outdatedCount} ‰∏™ËøáÊúüÂåÖ`);\n    } catch (error) {\n      // npm outdated Âú®ÊúâËøáÊúüÂåÖÊó∂ËøîÂõûÈùûÈõ∂ÈÄÄÂá∫Á†Å\n      if (error.stdout) {\n        try {\n          const outdated = JSON.parse(error.stdout || '{}');\n          const outdatedCount = Object.keys(outdated).length;\n\n          this.results.checks.dependencies = {\n            status: 'WARN',\n            score: Math.max(0, 100 - outdatedCount * 5),\n            outdated: outdatedCount,\n            packages: outdated,\n          };\n\n          console.log(`   ‚ö†Ô∏è  ‰æùËµñÈ°π: ${outdatedCount} ‰∏™ËøáÊúüÂåÖ`);\n        } catch (parseError) {\n          this.results.checks.dependencies = {\n            status: 'PASS',\n            score: 100,\n          };\n          console.log('   ‚úÖ ‰æùËµñÈ°π: ÊâÄÊúâÂåÖÈÉΩÊòØÊúÄÊñ∞ÁöÑ');\n        }\n      } else {\n        this.results.checks.dependencies = {\n          status: 'ERROR',\n          score: 0,\n          error: error.message,\n        };\n        console.log('   ‚ùå ‰æùËµñÈ°πÊ£ÄÊü•Â§±Ë¥•');\n      }\n    }\n  }\n\n  /**\n   * ‰ª£Á†ÅÂ§çÊùÇÂ∫¶ÂàÜÊûê\n   */\n  async analyzeComplexity() {\n    console.log('üìä ÂàÜÊûê‰ª£Á†ÅÂ§çÊùÇÂ∫¶...');\n\n    try {\n      // ËøôÈáåÂèØ‰ª•ÈõÜÊàê complexity-report ÊàñÂÖ∂‰ªñÂ§çÊùÇÂ∫¶ÂàÜÊûêÂ∑•ÂÖ∑\n      // ÊöÇÊó∂‰ΩøÁî®ÁÆÄÂçïÁöÑÊñá‰ª∂Ë°åÊï∞ÁªüËÆ°\n      const jsFiles = await this.getJavaScriptFiles();\n      let totalLines = 0;\n      let totalFunctions = 0;\n\n      for (const file of jsFiles) {\n        const content = await fs.promises.readFile(file, 'utf8');\n        const lines = content.split('\\n').length;\n        const functions = (content.match(/function\\s+\\w+|\\w+\\s*=>|\\w+\\s*:\\s*function/g) || [])\n          .length;\n\n        totalLines += lines;\n        totalFunctions += functions;\n      }\n\n      const avgLinesPerFunction = totalFunctions > 0 ? totalLines / totalFunctions : 0;\n      const complexityScore = this.calculateComplexityScore(avgLinesPerFunction);\n\n      this.results.checks.complexity = {\n        status: complexityScore >= 70 ? 'PASS' : 'WARN',\n        score: complexityScore,\n        metrics: {\n          totalLines,\n          totalFunctions,\n          avgLinesPerFunction: Math.round(avgLinesPerFunction),\n        },\n      };\n\n      this.results.metrics.linesOfCode = totalLines;\n\n      console.log(`   ‚úÖ Â§çÊùÇÂ∫¶: ${totalLines} Ë°å‰ª£Á†Å, ${totalFunctions} ‰∏™ÂáΩÊï∞`);\n    } catch (error) {\n      this.results.checks.complexity = {\n        status: 'ERROR',\n        score: 0,\n        error: error.message,\n      };\n      console.log('   ‚ùå Â§çÊùÇÂ∫¶ÂàÜÊûêÂ§±Ë¥•');\n    }\n  }\n\n  /**\n   * ‰ª£Á†ÅÈáçÂ§çÊ£ÄÊü•\n   */\n  async checkDuplication() {\n    console.log('üîÑ Ê£ÄÊü•‰ª£Á†ÅÈáçÂ§ç...');\n\n    try {\n      // ÁÆÄÂçïÁöÑÈáçÂ§ç‰ª£Á†ÅÊ£ÄÊµãÔºàÂèØ‰ª•ÈõÜÊàê jscpd Á≠âÂ∑•ÂÖ∑Ôºâ\n      const jsFiles = await this.getJavaScriptFiles();\n      const duplicates = [];\n\n      // ËøôÈáåÂÆûÁé∞ÁÆÄÂçïÁöÑÈáçÂ§çÊ£ÄÊµãÈÄªËæë\n      // ÂÆûÈôÖÈ°πÁõÆ‰∏≠Â∫îËØ•‰ΩøÁî®‰∏ì‰∏öÁöÑÈáçÂ§çÊ£ÄÊµãÂ∑•ÂÖ∑\n\n      this.results.checks.duplication = {\n        status: duplicates.length === 0 ? 'PASS' : 'WARN',\n        score: Math.max(0, 100 - duplicates.length * 10),\n        duplicates: duplicates.length,\n      };\n\n      console.log(`   ‚úÖ ÈáçÂ§çÊ£ÄÊü•: ${duplicates.length} ‰∏™ÈáçÂ§ç‰ª£Á†ÅÂùó`);\n    } catch (error) {\n      this.results.checks.duplication = {\n        status: 'ERROR',\n        score: 0,\n        error: error.message,\n      };\n      console.log('   ‚ùå ÈáçÂ§çÊ£ÄÊü•Â§±Ë¥•');\n    }\n  }\n\n  /**\n   * ËÆ°ÁÆóÊÄª‰ΩìË¥®ÈáèÂàÜÊï∞\n   */\n  calculateOverallScore() {\n    let totalScore = 0;\n    let totalWeight = 0;\n\n    for (const [check, weight] of Object.entries(this.config.weights)) {\n      if (this.results.checks[check] && this.results.checks[check].score !== undefined) {\n        totalScore += this.results.checks[check].score * weight;\n        totalWeight += weight;\n      }\n    }\n\n    const overallScore = totalWeight > 0 ? totalScore / totalWeight : 0;\n\n    this.results.overall.score = Math.round(overallScore);\n    this.results.overall.grade = this.getGrade(overallScore);\n    this.results.overall.status = overallScore >= 80 ? 'PASS' : 'FAIL';\n  }\n\n  /**\n   * ÁîüÊàêÊîπËøõÂª∫ËÆÆ\n   */\n  generateRecommendations() {\n    const recommendations = [];\n\n    // ESLint Âª∫ËÆÆ\n    if (this.results.checks.eslint.status === 'FAIL') {\n      recommendations.push({\n        category: 'Code Quality',\n        priority: 'High',\n        message: `‰øÆÂ§ç ${this.results.checks.eslint.errors || 0} ‰∏™ ESLint ÈîôËØØÂíå ${this.results.checks.eslint.warnings || 0} ‰∏™Ë≠¶Âëä`,\n        action: 'npm run lint:enhanced:fix',\n      });\n    }\n\n    // Prettier Âª∫ËÆÆ\n    if (this.results.checks.prettier.status === 'FAIL') {\n      recommendations.push({\n        category: 'Code Style',\n        priority: 'Medium',\n        message: '‰øÆÂ§ç‰ª£Á†ÅÊ†ºÂºèÈóÆÈ¢ò',\n        action: 'npm run format',\n      });\n    }\n\n    // TypeScript Âª∫ËÆÆ\n    if (this.results.checks.typescript.status === 'FAIL') {\n      recommendations.push({\n        category: 'Type Safety',\n        priority: 'High',\n        message: `‰øÆÂ§ç ${this.results.checks.typescript.errors || 0} ‰∏™ TypeScript Á±ªÂûãÈîôËØØ`,\n        action: 'npm run type:check',\n      });\n    }\n\n    // ÊµãËØïË¶ÜÁõñÁéáÂª∫ËÆÆ\n    if (this.results.checks.tests.score < 80) {\n      recommendations.push({\n        category: 'Test Coverage',\n        priority: 'High',\n        message: `ÊèêÈ´òÊµãËØïË¶ÜÁõñÁéáËá≥ 80% ‰ª•‰∏äÔºàÂΩìÂâç: ${this.results.metrics.testCoverage.toFixed(1)}%Ôºâ`,\n        action: 'ÁºñÂÜôÊõ¥Â§öÂçïÂÖÉÊµãËØïÂíåÈõÜÊàêÊµãËØï',\n      });\n    }\n\n    // ÂÆâÂÖ®Âª∫ËÆÆ\n    if (this.results.checks.security.status === 'FAIL') {\n      recommendations.push({\n        category: 'Security',\n        priority: 'Critical',\n        message: '‰øÆÂ§çÂÆâÂÖ®ÊºèÊ¥û',\n        action: 'npm audit fix',\n      });\n    }\n\n    this.results.recommendations = recommendations;\n  }\n\n  /**\n   * ÁîüÊàêÊä•Âëä\n   */\n  async generateReports() {\n    const reportsDir = path.join(projectRoot, 'reports');\n    if (!fs.existsSync(reportsDir)) {\n      await fs.promises.mkdir(reportsDir, { recursive: true });\n    }\n\n    // JSON Êä•Âëä\n    const jsonReport = path.join(reportsDir, 'quality-report.json');\n    await fs.promises.writeFile(jsonReport, JSON.stringify(this.results, null, 2));\n\n    // HTML Êä•Âëä\n    const htmlReport = path.join(reportsDir, 'quality-report.html');\n    const htmlContent = this.generateHTMLReport();\n    await fs.promises.writeFile(htmlReport, htmlContent);\n\n    console.log('\\nüìä Êä•ÂëäÂ∑≤ÁîüÊàê:');\n    console.log(`   JSON: ${jsonReport}`);\n    console.log(`   HTML: ${htmlReport}`);\n  }\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 107 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 107 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 107 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 107 Ë°å)\n\n  /**\n   * ÁîüÊàê HTML Êä•Âëä\n   */\n  generateHTMLReport() {\n    return `\n<!DOCTYPE html>\n<html lang=\"zh-CN\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>‰ª£Á†ÅË¥®ÈáèÊä•Âëä</title>\n    <style>\n        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; margin: 0; padding: 20px; background: #f5f5f5; }\n        .container { max-width: 1200px; margin: 0 auto; background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }\n        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 8px 8px 0 0; }\n        .score { font-size: 3em; font-weight: bold; margin: 10px 0; }\n        .grade { font-size: 1.5em; opacity: 0.9; }\n        .content { padding: 30px; }\n        .checks { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 30px 0; }\n        .check { border: 1px solid #e1e5e9; border-radius: 6px; padding: 20px; }\n        .check.pass { border-left: 4px solid #28a745; }\n        .check.fail { border-left: 4px solid #dc3545; }\n        .check.warn { border-left: 4px solid #ffc107; }\n        .check.error { border-left: 4px solid #6c757d; }\n        .check-title { font-weight: bold; margin-bottom: 10px; }\n        .check-score { font-size: 1.2em; color: #666; }\n        .recommendations { margin-top: 30px; }\n        .recommendation { background: #f8f9fa; border-left: 4px solid #007bff; padding: 15px; margin: 10px 0; border-radius: 4px; }\n        .priority-critical { border-left-color: #dc3545; }\n        .priority-high { border-left-color: #fd7e14; }\n        .priority-medium { border-left-color: #ffc107; }\n        .metrics { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; }\n        .metric { text-align: center; padding: 15px; background: #f8f9fa; border-radius: 6px; }\n        .metric-value { font-size: 2em; font-weight: bold; color: #007bff; }\n        .metric-label { color: #666; margin-top: 5px; }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        <div class=\"header\">\n            <h1>‰ª£Á†ÅË¥®ÈáèÊä•Âëä</h1>\n            <div class=\"score\">${this.results.overall.score}</div>\n            <div class=\"grade\">Á≠âÁ∫ß: ${this.results.overall.grade}</div>\n            <div>Áä∂ÊÄÅ: ${this.results.overall.status}</div>\n            <div style=\"margin-top: 15px; opacity: 0.8;\">ÁîüÊàêÊó∂Èó¥: ${new Date(this.results.timestamp).toLocaleString('zh-CN')}</div>\n        </div>\n        \n        <div class=\"content\">\n            <h2>ÂÖ≥ÈîÆÊåáÊ†á</h2>\n            <div class=\"metrics\">\n                <div class=\"metric\">\n                    <div class=\"metric-value\">${this.results.metrics.testCoverage.toFixed(1)}%</div>\n                    <div class=\"metric-label\">ÊµãËØïË¶ÜÁõñÁéá</div>\n                </div>\n                <div class=\"metric\">\n                    <div class=\"metric-value\">${this.results.metrics.linesOfCode}</div>\n                    <div class=\"metric-label\">‰ª£Á†ÅË°åÊï∞</div>\n                </div>\n                <div class=\"metric\">\n                    <div class=\"metric-value\">${this.results.checks.security.vulnerabilities?.total || 0}</div>\n                    <div class=\"metric-label\">ÂÆâÂÖ®ÊºèÊ¥û</div>\n                </div>\n                <div class=\"metric\">\n                    <div class=\"metric-value\">${this.results.checks.eslint.errors || 0}</div>\n                    <div class=\"metric-label\">ESLint ÈîôËØØ</div>\n                </div>\n            </div>\n            \n            <h2>ËØ¶ÁªÜÊ£ÄÊü•ÁªìÊûú</h2>\n            <div class=\"checks\">\n                ${Object.entries(this.results.checks)\n                  .map(\n                    ([name, check]) => `\n                    <div class=\"check ${check.status.toLowerCase()}\">\n                        <div class=\"check-title\">${this.getCheckDisplayName(name)}</div>\n                        <div class=\"check-score\">ÂàÜÊï∞: ${check.score || 0}/100</div>\n                        <div>Áä∂ÊÄÅ: ${check.status}</div>\n                        ${this.getCheckDetails(name, check)}\n                    </div>\n                `\n                  )\n                  .join('')}\n            </div>\n            \n            ${\n              this.results.recommendations.length > 0\n                ? `\n                <h2>ÊîπËøõÂª∫ËÆÆ</h2>\n                <div class=\"recommendations\">\n                    ${this.results.recommendations\n                      .map(\n                        (rec) => `\n                        <div class=\"recommendation priority-${rec.priority.toLowerCase()}\">\n                            <strong>${rec.category}</strong> (${rec.priority})\n                            <div>${rec.message}</div>\n                            <div style=\"margin-top: 10px; font-family: monospace; background: #e9ecef; padding: 5px; border-radius: 3px;\">${rec.action}</div>\n                        </div>\n                    `\n                      )\n                      .join('')}\n                </div>\n            `\n                : ''\n            }\n        </div>\n    </div>\n</body>\n</html>\n    `;\n  }\n\n  /**\n   * ÊâìÂç∞ÊëòË¶Å\n   */\n  printSummary() {\n    console.log(`\\n${'='.repeat(50)}`);\n    console.log('üìä ‰ª£Á†ÅË¥®ÈáèÊ£ÄÊü•ÊëòË¶Å');\n    console.log('='.repeat(50));\n    console.log(`ÊÄª‰ΩìÂàÜÊï∞: ${this.results.overall.score}/100 (${this.results.overall.grade})`);\n    console.log(`Áä∂ÊÄÅ: ${this.results.overall.status}`);\n    console.log('');\n\n    // ÊâìÂç∞ÂêÑÈ°πÊ£ÄÊü•ÁªìÊûú\n    for (const [name, check] of Object.entries(this.results.checks)) {\n      const icon =\n        check.status === 'PASS'\n          ? '‚úÖ'\n          : check.status === 'FAIL'\n            ? '‚ùå'\n            : check.status === 'WARN'\n              ? '‚ö†Ô∏è'\n              : '‚ùì';\n      console.log(\n        `${icon} ${this.getCheckDisplayName(name)}: ${check.score || 0}/100 (${check.status})`\n      );\n    }\n\n    if (this.results.recommendations.length > 0) {\n      console.log('\\nüîß ÊîπËøõÂª∫ËÆÆ:');\n      this.results.recommendations.forEach((rec, index) => {\n        console.log(`${index + 1}. [${rec.priority}] ${rec.message}`);\n        console.log(`   ÊâßË°å: ${rec.action}`);\n      });\n    }\n\n    console.log(`\\n${'='.repeat(50)}`);\n  }\n\n  // ËæÖÂä©ÊñπÊ≥ï\n  calculateESLintScore(errors, warnings) {\n    return Math.max(0, 100 - errors * 10 - warnings * 2);\n  }\n\n  calculateCoverageScore(coverage) {\n    const weights = { statements: 0.4, branches: 0.3, functions: 0.2, lines: 0.1 };\n    return Object.entries(weights).reduce(\n      (score, [key, weight]) => score + (coverage[key]?.pct || 0) * weight,\n      0\n    );\n  }\n\n  calculateSecurityScore(high, medium) {\n    return Math.max(0, 100 - high * 30 - medium * 10);\n  }\n\n  calculateComplexityScore(avgLines) {\n    if (avgLines <= 20) {\n      return 100;\n    }\n    if (avgLines <= 50) {\n      return 80;\n    }\n    if (avgLines <= 100) {\n      return 60;\n    }\n    return 40;\n  }\n\n  calculateTotalCoverage(coverageData) {\n    const totals = { statements: 0, branches: 0, functions: 0, lines: 0 };\n    const counts = { statements: 0, branches: 0, functions: 0, lines: 0 };\n\n    Object.values(coverageData).forEach((file) => {\n      if (file.s) {\n        Object.values(file.s).forEach((count) => {\n          totals.statements += count;\n          counts.statements++;\n        });\n      }\n      // Á±ª‰ººÂ§ÑÁêÜ branches, functions, lines\n    });\n\n    return {\n      total: {\n        statements: {\n          pct: counts.statements > 0 ? (totals.statements / counts.statements) * 100 : 0,\n        },\n        branches: { pct: counts.branches > 0 ? (totals.branches / counts.branches) * 100 : 0 },\n        functions: { pct: counts.functions > 0 ? (totals.functions / counts.functions) * 100 : 0 },\n        lines: { pct: counts.lines > 0 ? (totals.lines / counts.lines) * 100 : 0 },\n      },\n    };\n  }\n\n  getGrade(score) {\n    if (score >= 90) {\n      return 'A';\n    }\n    if (score >= 80) {\n      return 'B';\n    }\n    if (score >= 70) {\n      return 'C';\n    }\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (score >= 60) {\n      return 'D';\n    }\n    return 'F';\n  }\n\n  getCheckDisplayName(name) {\n    const names = {\n      eslint: 'ESLint Ê£ÄÊü•',\n      prettier: 'Prettier Ê†ºÂºè',\n      typescript: 'TypeScript Á±ªÂûã',\n      tests: 'ÊµãËØïË¶ÜÁõñÁéá',\n      security: 'ÂÆâÂÖ®Ê£ÄÊü•',\n      dependencies: '‰æùËµñÈ°πÊ£ÄÊü•',\n      complexity: '‰ª£Á†ÅÂ§çÊùÇÂ∫¶',\n      duplication: 'ÈáçÂ§ç‰ª£Á†Å',\n    };\n    return names[name] || name;\n  }\n\n  getCheckDetails(name, check) {\n    switch (name) {\n      case 'eslint':\n        return check.errors !== undefined\n          ? `<div>ÈîôËØØ: ${check.errors}, Ë≠¶Âëä: ${check.warnings}</div>`\n          : '';\n      case 'tests':\n        return check.coverage\n          ? `<div>Ë¶ÜÁõñÁéá: ${check.coverage.statements?.pct?.toFixed(1) || 0}%</div>`\n          : '';\n      case 'security':\n        return check.vulnerabilities\n          ? `<div>È´òÂç±: ${check.vulnerabilities.high}, ‰∏≠Âç±: ${check.vulnerabilities.medium}</div>`\n          : '';\n      case 'dependencies':\n        return check.outdated !== undefined ? `<div>ËøáÊúüÂåÖ: ${check.outdated}</div>` : '';\n      case 'complexity':\n        return check.metrics ? `<div>Âπ≥ÂùáÂáΩÊï∞Ë°åÊï∞: ${check.metrics.avgLinesPerFunction}</div>` : '';\n      default:\n        return '';\n    }\n  }\n\n  async getJavaScriptFiles() {\n    const files = [];\n    const extensions = ['.js', '.jsx', '.ts', '.tsx'];\n\n    async function scanDir(dir) {\n      if (dir.includes('node_modules') || dir.includes('.git')) {\n        return;\n      }\n\n      try {\n        const items = await fs.promises.readdir(dir);\n        for (const item of items) {\n          const fullPath = path.join(dir, item);\n          const stat = await fs.promises.stat(fullPath);\n\n          if (stat.isDirectory()) {\n            await scanDir(fullPath);\n          } else if (extensions.some((ext) => item.endsWith(ext))) {\n            files.push(fullPath);\n          }\n        }\n      } catch (error) {\n        // ÂøΩÁï•ÊùÉÈôêÈîôËØØ\n      }\n    }\n\n    await scanDir(path.join(projectRoot, 'src'));\n    return files;\n  }\n}\n\n// ‰∏ªÊâßË°åÂáΩÊï∞\nasync function main() {\n  const checker = new EnhancedQualityChecker();\n  const success = await checker.runAllChecks();\n\n  process.exit(success ? 0 : 1);\n}\n\n// Â¶ÇÊûúÁõ¥Êé•ËøêË°åÊ≠§ËÑöÊú¨\nif (import.meta.url === `file://${process.argv[1]}`) {\n  main().catch((error) => {\n    console.error('‚ùå Ë¥®ÈáèÊ£ÄÊü•Â§±Ë¥•:', error);\n    process.exit(1);\n  });\n}\n\nexport { EnhancedQualityChecker };\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/scripts/env-manager.js","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":34,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":34,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[827,859],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":45,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":45,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1011,1039],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":209,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":209,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[4055,4099],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":238,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":238,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[4643,4698],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5.","line":284,"column":29,"nodeType":"Literal","messageId":"noMagic","endLine":284,"endColumn":30},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 20.","line":285,"column":29,"nodeType":"Literal","messageId":"noMagic","endLine":285,"endColumn":31},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":285,"column":34,"nodeType":"Literal","messageId":"noMagic","endLine":285,"endColumn":36},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":354,"column":69,"nodeType":"Literal","messageId":"noMagic","endLine":354,"endColumn":72},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":354,"column":75,"nodeType":"Literal","messageId":"noMagic","endLine":354,"endColumn":79},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.1.","line":420,"column":36,"nodeType":"Literal","messageId":"noMagic","endLine":420,"endColumn":39},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":525,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":525,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[12634,12673],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":529,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":529,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[12699,12743],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":534,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":534,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[12874,12911],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0o600.","line":538,"column":40,"nodeType":"Literal","messageId":"noMagic","endLine":538,"endColumn":45},{"ruleId":"no-unused-vars","severity":2,"message":"'isDevelopment' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":547,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":547,"endColumn":24},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 32.","line":587,"column":97,"nodeType":"Literal","messageId":"noMagic","endLine":587,"endColumn":99},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 32.","line":588,"column":113,"nodeType":"Literal","messageId":"noMagic","endLine":588,"endColumn":115},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 32.","line":613,"column":99,"nodeType":"Literal","messageId":"noMagic","endLine":613,"endColumn":101},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 32.","line":614,"column":105,"nodeType":"Literal","messageId":"noMagic","endLine":614,"endColumn":107},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 32.","line":615,"column":105,"nodeType":"Literal","messageId":"noMagic","endLine":615,"endColumn":107},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":630,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":630,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[16116,16160],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":684,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":684,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[17542,17569],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":685,"column":33,"nodeType":"MemberExpression","messageId":"unexpected","endLine":685,"endColumn":44},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":689,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":689,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[17677,17704],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":690,"column":37,"nodeType":"MemberExpression","messageId":"unexpected","endLine":690,"endColumn":48},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":694,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":694,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[17843,17867],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":720,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":720,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[18301,18344],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":733,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":733,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[18752,18793],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":739,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":739,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[18862,18902],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":757,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":757,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[19333,19379],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":760,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":760,"endColumn":21,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[19447,19492],"text":""},"desc":"Remove the console.warn()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0o600.","line":776,"column":44,"nodeType":"Literal","messageId":"noMagic","endLine":776,"endColumn":49},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":779,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":779,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[19905,19944],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 32.","line":801,"column":27,"nodeType":"Literal","messageId":"noMagic","endLine":801,"endColumn":29},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 3000.","line":815,"column":34,"nodeType":"Literal","messageId":"noMagic","endLine":815,"endColumn":38},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 3306.","line":832,"column":41,"nodeType":"Literal","messageId":"noMagic","endLine":832,"endColumn":45},{"ruleId":"prefer-destructuring","severity":2,"message":"Use array destructuring.","line":871,"column":9,"nodeType":"VariableDeclarator","messageId":"preferDestructuring","endLine":871,"endColumn":26},{"ruleId":"prefer-destructuring","severity":2,"message":"Use array destructuring.","line":872,"column":9,"nodeType":"VariableDeclarator","messageId":"preferDestructuring","endLine":872,"endColumn":30},{"ruleId":"no-inner-declarations","severity":2,"message":"Move function declaration to program root.","line":876,"column":3,"nodeType":"FunctionDeclaration","messageId":"moveDeclToRoot","endLine":957,"endColumn":4},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":882,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":882,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[22232,22259],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":887,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":887,"endColumn":26,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[22345,22417],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":891,"column":11,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":894,"endColumn":13},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":901,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":901,"endColumn":26,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[22750,22797],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":905,"column":11,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":905,"endColumn":73},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":913,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":913,"endColumn":26,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[23068,23113],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":921,"column":11,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":921,"endColumn":34},{"ruleId":"prefer-destructuring","severity":2,"message":"Use array destructuring.","line":921,"column":17,"nodeType":"VariableDeclarator","messageId":"preferDestructuring","endLine":921,"endColumn":33},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":922,"column":11,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":922,"endColumn":31},{"ruleId":"prefer-destructuring","severity":2,"message":"Use array destructuring.","line":922,"column":17,"nodeType":"VariableDeclarator","messageId":"preferDestructuring","endLine":922,"endColumn":30},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":923,"column":11,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":923,"endColumn":33},{"ruleId":"prefer-destructuring","severity":2,"message":"Use array destructuring.","line":923,"column":17,"nodeType":"VariableDeclarator","messageId":"preferDestructuring","endLine":923,"endColumn":32},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":928,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":928,"endColumn":24,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[23511,23542],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":931,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":931,"endColumn":24,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[23667,23698],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 32.","line":933,"column":49,"nodeType":"Literal","messageId":"noMagic","endLine":933,"endColumn":51},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":935,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":935,"endColumn":24,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[23868,23888],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":937,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":937,"endColumn":24,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[23920,23981],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":942,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":942,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[24039,24351],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":954,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":954,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[24388,24432],"text":""},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":12,"fatalErrorCount":0,"warningCount":46,"fixableErrorCount":0,"fixableWarningCount":0,"source":"#!/usr/bin/env node\n\nimport fs from 'fs';\nimport path from 'path';\nimport { fileURLToPath } from 'url';\nimport crypto from 'crypto';\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\n\n/**\n * ÁéØÂ¢ÉÈÖçÁΩÆÁÆ°ÁêÜÂô®\n * ÁÆ°ÁêÜ‰∏çÂêåÁéØÂ¢ÉÁöÑÈÖçÁΩÆÊñá‰ª∂„ÄÅÁéØÂ¢ÉÂèòÈáèÂíåÂØÜÈí•\n */\nclass EnvironmentManager {\n  constructor(options = {}) {\n    this.options = {\n      projectRoot: options.projectRoot || path.resolve(__dirname, '..'),\n      configDir: options.configDir || 'config',\n      envDir: options.envDir || 'environments',\n      secretsFile: options.secretsFile || '.secrets.json',\n      templateFile: options.templateFile || '.env.template',\n      ...options,\n    };\n\n    this.environments = ['development', 'staging', 'production', 'test'];\n    this.secrets = new Map();\n  }\n\n  /**\n   * ÂàùÂßãÂåñÁéØÂ¢ÉÁÆ°ÁêÜÂô®\n   */\n  async initialize() {\n    console.log('üîß ÂàùÂßãÂåñÁéØÂ¢ÉÈÖçÁΩÆÁÆ°ÁêÜÂô®...');\n\n    // ÂàõÂª∫ÂøÖË¶ÅÁõÆÂΩï\n    this.createDirectories();\n\n    // Âä†ËΩΩÂØÜÈí•\n    await this.loadSecrets();\n\n    // ÂàõÂª∫ÈªòËÆ§ÈÖçÁΩÆÊ®°Êùø\n    await this.createDefaultTemplates();\n\n    console.log('‚úÖ ÁéØÂ¢ÉÁÆ°ÁêÜÂô®ÂàùÂßãÂåñÂÆåÊàê');\n  }\n\n  /**\n   * ÂàõÂª∫ÂøÖË¶ÅÁõÆÂΩï\n   */\n  createDirectories() {\n    const dirs = [\n      path.join(this.options.projectRoot, this.options.configDir),\n      path.join(this.options.projectRoot, this.options.envDir),\n    ];\n\n    dirs.forEach((dir) => {\n      if (!fs.existsSync(dir)) {\n        fs.mkdirSync(dir, { recursive: true });\n      }\n    });\n  }\n\n  /**\n   * ÂàõÂª∫ÈªòËÆ§ÈÖçÁΩÆÊ®°Êùø\n   */\n  async createDefaultTemplates() {\n    await this.createEnvTemplate();\n    await this.createConfigTemplates();\n  }\n\n  /**\n   * ÂàõÂª∫ÁéØÂ¢ÉÂèòÈáèÊ®°Êùø\n   */\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 127 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 127 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 127 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 127 Ë°å)\n\n  async createEnvTemplate() {\n    const templatePath = path.join(this.options.projectRoot, this.options.templateFile);\n\n    if (fs.existsSync(templatePath)) {\n      return;\n    }\n\n    const template = `# Èõ∂Á¢≥Âõ≠Âå∫Êï∞Â≠óÂ≠™ÁîüËÉΩÁ¢≥ÁÆ°ÁêÜÁ≥ªÁªü - ÁéØÂ¢ÉÂèòÈáèÊ®°Êùø\n# Â§çÂà∂Ê≠§Êñá‰ª∂‰∏∫ .env Âπ∂Â°´ÂÖ•ÂÆûÈôÖÂÄº\n\n# Â∫îÁî®ÈÖçÁΩÆ\nNODE_ENV=development\nPORT=3000\nHOST=localhost\nAPP_NAME=\"Èõ∂Á¢≥Âõ≠Âå∫Êï∞Â≠óÂ≠™ÁîüËÉΩÁ¢≥ÁÆ°ÁêÜÁ≥ªÁªü\"\nAPP_VERSION=1.0.0\n\n# Êï∞ÊçÆÂ∫ìÈÖçÁΩÆ\nDB_TYPE=sqlite\nDB_HOST=localhost\nDB_PORT=3306\nDB_NAME=carbon_management\nDB_USER=root\nDB_PASSWORD=\nDB_SSL=false\n\n# RedisÈÖçÁΩÆ\nREDIS_HOST=localhost\nREDIS_PORT=6379\nREDIS_PASSWORD=\nREDIS_DB=0\n\n# JWTÈÖçÁΩÆ\nJWT_SECRET=your-super-secret-jwt-key-here\nJWT_EXPIRES_IN=24h\nJWT_REFRESH_SECRET=your-refresh-secret-here\nJWT_REFRESH_EXPIRES_IN=7d\n\n# Âä†ÂØÜÈÖçÁΩÆ\nENCRYPTION_KEY=your-32-character-encryption-key\nHASH_SALT_ROUNDS=12\n\n# APIÈÖçÁΩÆ\nAPI_RATE_LIMIT=100\nAPI_RATE_WINDOW=15\nAPI_TIMEOUT=30000\nAPI_MAX_PAYLOAD_SIZE=10mb\n\n# Êñá‰ª∂‰∏ä‰º†ÈÖçÁΩÆ\nUPLOAD_MAX_SIZE=50mb\nUPLOAD_ALLOWED_TYPES=image/jpeg,image/png,application/pdf\nUPLOAD_PATH=./uploads\n\n# Êó•ÂøóÈÖçÁΩÆ\nLOG_LEVEL=info\nLOG_FILE=./logs/app.log\nLOG_MAX_SIZE=10mb\nLOG_MAX_FILES=5\n\n# ÈÇÆ‰ª∂ÈÖçÁΩÆ\nMAIL_HOST=smtp.gmail.com\nMAIL_PORT=587\nMAIL_SECURE=false\nMAIL_USER=your-email@gmail.com\nMAIL_PASSWORD=your-app-password\nMAIL_FROM=\"Èõ∂Á¢≥Âõ≠Âå∫Á≥ªÁªü\" <noreply@example.com>\n\n# Áü≠‰ø°ÈÖçÁΩÆ\nSMS_PROVIDER=aliyun\nSMS_ACCESS_KEY=your-access-key\nSMS_SECRET_KEY=your-secret-key\nSMS_SIGN_NAME=Èõ∂Á¢≥Âõ≠Âå∫\n\n# Á¨¨‰∏âÊñπÊúçÂä°ÈÖçÁΩÆ\n# Â§©Ê∞îAPI\nWEATHER_API_KEY=your-weather-api-key\nWEATHER_API_URL=https://api.openweathermap.org/data/2.5\n\n# Âú∞ÂõæÊúçÂä°\nMAP_API_KEY=your-map-api-key\nMAP_API_URL=https://restapi.amap.com/v3\n\n# ÁõëÊéßÈÖçÁΩÆ\nMONITORING_ENABLED=true\nMETRICS_PORT=9090\nHEALTH_CHECK_INTERVAL=30000\n\n# ÁºìÂ≠òÈÖçÁΩÆ\nCACHE_TTL=300\nCACHE_MAX_ITEMS=1000\nCACHE_CHECK_PERIOD=60\n\n# ÂÆâÂÖ®ÈÖçÁΩÆ\nCORS_ORIGIN=http://localhost:3000\nCSRF_SECRET=your-csrf-secret\nSESSION_SECRET=your-session-secret\nSESSION_MAX_AGE=86400000\n\n# ÂºÄÂèëÈÖçÁΩÆ\nDEBUG=app:*\nDEV_TOOLS_ENABLED=true\nHOT_RELOAD=true\n\n# Áîü‰∫ßÈÖçÁΩÆ\nCLUSTER_MODE=false\nCLUSTER_WORKERS=auto\nGRACEFUL_SHUTDOWN_TIMEOUT=10000\n\n# Â§á‰ªΩÈÖçÁΩÆ\nBACKUP_ENABLED=true\nBACKUP_INTERVAL=daily\nBACKUP_RETENTION=30\nBACKUP_PATH=./backups\n\n# ÈÄöÁü•ÈÖçÁΩÆ\nSLACK_WEBHOOK_URL=https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK\nDINGTALK_WEBHOOK_URL=https://oapi.dingtalk.com/robot/send?access_token=YOUR_TOKEN\n\n# ÊÄßËÉΩÈÖçÁΩÆ\nPERFORMANCE_MONITORING=true\nAPM_SERVICE_NAME=carbon-management-system\nAPM_SERVER_URL=http://localhost:8200\n`;\n\n    await fs.promises.writeFile(templatePath, template);\n    console.log(`‚úÖ ÁéØÂ¢ÉÂèòÈáèÊ®°ÊùøÂ∑≤ÂàõÂª∫: ${templatePath}`);\n  }\n\n  /**\n   * ÂàõÂª∫ÈÖçÁΩÆÊñá‰ª∂Ê®°Êùø\n   */\n  async createConfigTemplates() {\n    for (const env of this.environments) {\n      await this.createConfigTemplate(env);\n    }\n  }\n\n  /**\n   * ÂàõÂª∫ÁâπÂÆöÁéØÂ¢ÉÁöÑÈÖçÁΩÆÊ®°Êùø\n   */\n  async createConfigTemplate(environment) {\n    const configPath = path.join(\n      this.options.projectRoot,\n      this.options.configDir,\n      `${environment}.js`\n    );\n\n    if (fs.existsSync(configPath)) {\n      return;\n    }\n\n    const config = this.generateConfigTemplate(environment);\n    await fs.promises.writeFile(configPath, config);\n\n    console.log(`‚úÖ ${environment} ÈÖçÁΩÆÊ®°ÊùøÂ∑≤ÂàõÂª∫: ${configPath}`);\n  }\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 263 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 263 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 263 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 263 Ë°å)\n\n  /**\n   * ÁîüÊàêÈÖçÁΩÆÊ®°ÊùøÂÜÖÂÆπ\n   */\n  generateConfigTemplate(environment) {\n    const isProduction = environment === 'production';\n    const isDevelopment = environment === 'development';\n    const isTest = environment === 'test';\n\n    return `/**\n * ${environment.toUpperCase()} ÁéØÂ¢ÉÈÖçÁΩÆ\n * Èõ∂Á¢≥Âõ≠Âå∫Êï∞Â≠óÂ≠™ÁîüËÉΩÁ¢≥ÁÆ°ÁêÜÁ≥ªÁªü\n */\n\nexport default {\n  // Â∫îÁî®Âü∫Á°ÄÈÖçÁΩÆ\n  app: {\n    name: process.env.APP_NAME || 'Èõ∂Á¢≥Âõ≠Âå∫Êï∞Â≠óÂ≠™ÁîüËÉΩÁ¢≥ÁÆ°ÁêÜÁ≥ªÁªü',\n    version: process.env.APP_VERSION || '1.0.0',\n    environment: '${environment}',\n    port: parseInt(process.env.PORT) || ${this.getDefaultPort(environment)},\n    host: process.env.HOST || '${this.getDefaultHost(environment)}',\n    timezone: 'Asia/Shanghai',\n    locale: 'zh-CN'\n  },\n\n  // Êï∞ÊçÆÂ∫ìÈÖçÁΩÆ\n  database: {\n    type: process.env.DB_TYPE || '${this.getDefaultDbType(environment)}',\n    host: process.env.DB_HOST || '${this.getDefaultDbHost(environment)}',\n    port: parseInt(process.env.DB_PORT) || ${this.getDefaultDbPort(environment)},\n    name: process.env.DB_NAME || '${this.getDefaultDbName(environment)}',\n    username: process.env.DB_USER || '${this.getDefaultDbUser(environment)}',\n    password: process.env.DB_PASSWORD || '',\n    ssl: process.env.DB_SSL === 'true',\n    pool: {\n      min: ${isProduction ? 5 : 2},\n      max: ${isProduction ? 20 : 10},\n      acquireTimeoutMillis: 30000,\n      createTimeoutMillis: 30000,\n      destroyTimeoutMillis: 5000,\n      idleTimeoutMillis: 30000\n    },\n    migrations: {\n      directory: './migrations',\n      tableName: 'migrations'\n    },\n    seeds: {\n      directory: './seeds'\n    }\n  },\n\n  // RedisÈÖçÁΩÆ\n  redis: {\n    host: process.env.REDIS_HOST || 'localhost',\n    port: parseInt(process.env.REDIS_PORT) || 6379,\n    password: process.env.REDIS_PASSWORD || '',\n    db: parseInt(process.env.REDIS_DB) || 0,\n    keyPrefix: 'carbon:',\n    retryDelayOnFailover: 100,\n    maxRetriesPerRequest: 3,\n    lazyConnect: true\n  },\n\n  // JWTÈÖçÁΩÆ\n  jwt: {\n    secret: process.env.JWT_SECRET || 'your-super-secret-jwt-key',\n    expiresIn: process.env.JWT_EXPIRES_IN || '${isProduction ? '2h' : '24h'}',\n    refreshSecret: process.env.JWT_REFRESH_SECRET || 'your-refresh-secret',\n    refreshExpiresIn: process.env.JWT_REFRESH_EXPIRES_IN || '7d',\n    algorithm: 'HS256',\n    issuer: 'carbon-management-system',\n    audience: 'carbon-management-users'\n  },\n\n  // ÂÆâÂÖ®ÈÖçÁΩÆ\n  security: {\n    encryption: {\n      key: process.env.ENCRYPTION_KEY || 'your-32-character-encryption-key',\n      algorithm: 'aes-256-gcm'\n    },\n    hash: {\n      saltRounds: parseInt(process.env.HASH_SALT_ROUNDS) || 12\n    },\n    cors: {\n      origin: process.env.CORS_ORIGIN?.split(',') || ['${this.getDefaultCorsOrigin(environment)}'],\n      credentials: true,\n      methods: ['GET', 'POST', 'PUT', 'DELETE', 'PATCH', 'OPTIONS'],\n      allowedHeaders: ['Content-Type', 'Authorization', 'X-Requested-With']\n    },\n    csrf: {\n      secret: process.env.CSRF_SECRET || 'your-csrf-secret'\n    },\n    session: {\n      secret: process.env.SESSION_SECRET || 'your-session-secret',\n      maxAge: parseInt(process.env.SESSION_MAX_AGE) || 86400000,\n      secure: ${isProduction},\n      httpOnly: true,\n      sameSite: 'strict'\n    }\n  },\n\n  // APIÈÖçÁΩÆ\n  api: {\n    rateLimit: {\n      windowMs: (parseInt(process.env.API_RATE_WINDOW) || 15) * 60 * 1000,\n      max: parseInt(process.env.API_RATE_LIMIT) || ${isProduction ? 100 : 1000},\n      message: 'ËØ∑Ê±ÇËøá‰∫éÈ¢ëÁπÅÔºåËØ∑Á®çÂêéÂÜçËØï',\n      standardHeaders: true,\n      legacyHeaders: false\n    },\n    timeout: parseInt(process.env.API_TIMEOUT) || 30000,\n    maxPayloadSize: process.env.API_MAX_PAYLOAD_SIZE || '10mb',\n    compression: ${isProduction},\n    etag: ${isProduction}\n  },\n\n  // Êñá‰ª∂‰∏ä‰º†ÈÖçÁΩÆ\n  upload: {\n    maxSize: process.env.UPLOAD_MAX_SIZE || '50mb',\n    allowedTypes: process.env.UPLOAD_ALLOWED_TYPES?.split(',') || [\n      'image/jpeg',\n      'image/png',\n      'image/gif',\n      'application/pdf',\n      'application/vnd.ms-excel',\n      'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'\n    ],\n    path: process.env.UPLOAD_PATH || './uploads',\n    urlPrefix: '/uploads'\n  },\n\n  // Êó•ÂøóÈÖçÁΩÆ\n  logging: {\n    level: process.env.LOG_LEVEL || '${this.getDefaultLogLevel(environment)}',\n    file: {\n      enabled: ${!isTest},\n      filename: process.env.LOG_FILE || './logs/app.log',\n      maxSize: process.env.LOG_MAX_SIZE || '10mb',\n      maxFiles: parseInt(process.env.LOG_MAX_FILES) || 5,\n      format: 'json'\n    },\n    console: {\n      enabled: ${isDevelopment || isTest},\n      format: 'simple',\n      colorize: true\n    },\n    http: {\n      enabled: ${isProduction},\n      format: 'combined'\n    }\n  },\n\n  // ÁºìÂ≠òÈÖçÁΩÆ\n  cache: {\n    ttl: parseInt(process.env.CACHE_TTL) || 300,\n    maxItems: parseInt(process.env.CACHE_MAX_ITEMS) || 1000,\n    checkPeriod: parseInt(process.env.CACHE_CHECK_PERIOD) || 60,\n    useClones: false\n  },\n\n  // ÁõëÊéßÈÖçÁΩÆ\n  monitoring: {\n    enabled: process.env.MONITORING_ENABLED === 'true',\n    metricsPort: parseInt(process.env.METRICS_PORT) || 9090,\n    healthCheck: {\n      interval: parseInt(process.env.HEALTH_CHECK_INTERVAL) || 30000,\n      timeout: 5000,\n      retries: 3\n    },\n    performance: {\n      enabled: ${isProduction},\n      sampleRate: ${isProduction ? 0.1 : 1.0}\n    }\n  },\n\n  // ÈÇÆ‰ª∂ÈÖçÁΩÆ\n  mail: {\n    host: process.env.MAIL_HOST || 'smtp.gmail.com',\n    port: parseInt(process.env.MAIL_PORT) || 587,\n    secure: process.env.MAIL_SECURE === 'true',\n    auth: {\n      user: process.env.MAIL_USER || '',\n      pass: process.env.MAIL_PASSWORD || ''\n    },\n    from: process.env.MAIL_FROM || 'Èõ∂Á¢≥Âõ≠Âå∫Á≥ªÁªü <noreply@example.com>',\n    templates: {\n      path: './templates/email',\n      engine: 'handlebars'\n    }\n  },\n\n  // Áü≠‰ø°ÈÖçÁΩÆ\n  sms: {\n    provider: process.env.SMS_PROVIDER || 'aliyun',\n    accessKey: process.env.SMS_ACCESS_KEY || '',\n    secretKey: process.env.SMS_SECRET_KEY || '',\n    signName: process.env.SMS_SIGN_NAME || 'Èõ∂Á¢≥Âõ≠Âå∫',\n    templates: {\n      verification: 'SMS_123456789',\n      notification: 'SMS_987654321'\n    }\n  },\n\n  // Á¨¨‰∏âÊñπÊúçÂä°ÈÖçÁΩÆ\n  services: {\n    weather: {\n      apiKey: process.env.WEATHER_API_KEY || '',\n      apiUrl: process.env.WEATHER_API_URL || 'https://api.openweathermap.org/data/2.5',\n      timeout: 10000\n    },\n    map: {\n      apiKey: process.env.MAP_API_KEY || '',\n      apiUrl: process.env.MAP_API_URL || 'https://restapi.amap.com/v3',\n      timeout: 10000\n    }\n  },\n\n  // ÈÄöÁü•ÈÖçÁΩÆ\n  notifications: {\n    slack: {\n      enabled: !!process.env.SLACK_WEBHOOK_URL,\n      webhookUrl: process.env.SLACK_WEBHOOK_URL || '',\n      channel: '#alerts',\n      username: 'Carbon Management System'\n    },\n    dingtalk: {\n      enabled: !!process.env.DINGTALK_WEBHOOK_URL,\n      webhookUrl: process.env.DINGTALK_WEBHOOK_URL || ''\n    }\n  },\n\n  // Â§á‰ªΩÈÖçÁΩÆ\n  backup: {\n    enabled: process.env.BACKUP_ENABLED === 'true',\n    interval: process.env.BACKUP_INTERVAL || 'daily',\n    retention: parseInt(process.env.BACKUP_RETENTION) || 30,\n    path: process.env.BACKUP_PATH || './backups',\n    compression: true\n  },\n\n  // ÂºÄÂèëÈÖçÁΩÆ\n  development: {\n    debug: process.env.DEBUG || '${isDevelopment ? 'app:*' : ''}',\n    devTools: process.env.DEV_TOOLS_ENABLED === 'true',\n    hotReload: process.env.HOT_RELOAD === 'true',\n    mockData: ${isDevelopment || isTest}\n  },\n\n  // Áîü‰∫ßÈÖçÁΩÆ\n  production: {\n    cluster: {\n      enabled: process.env.CLUSTER_MODE === 'true',\n      workers: process.env.CLUSTER_WORKERS || 'auto'\n    },\n    gracefulShutdown: {\n      timeout: parseInt(process.env.GRACEFUL_SHUTDOWN_TIMEOUT) || 10000\n    },\n    optimization: {\n      gzip: true,\n      minify: true,\n      cache: true\n    }\n  }\n};\n`;\n  }\n\n  /**\n   * ÁîüÊàêÁéØÂ¢ÉÊñá‰ª∂\n   */\n  async generateEnvFile(environment, options = {}) {\n    const { override = false, secrets = false } = options;\n\n    const envPath = path.join(this.options.projectRoot, `.env.${environment}`);\n\n    if (fs.existsSync(envPath) && !override) {\n      console.log(`‚ö†Ô∏è  ÁéØÂ¢ÉÊñá‰ª∂Â∑≤Â≠òÂú®: ${envPath}`);\n      return;\n    }\n\n    console.log(`üìù ÁîüÊàê ${environment} ÁéØÂ¢ÉÊñá‰ª∂...`);\n\n    const envContent = this.generateEnvContent(environment, secrets);\n    await fs.promises.writeFile(envPath, envContent);\n\n    console.log(`‚úÖ ÁéØÂ¢ÉÊñá‰ª∂Â∑≤ÁîüÊàê: ${envPath}`);\n\n    // ËÆæÁΩÆÊñá‰ª∂ÊùÉÈôêÔºà‰ªÖÈôêUnixÁ≥ªÁªüÔºâ\n    if (process.platform !== 'win32') {\n      await fs.promises.chmod(envPath, 0o600);\n    }\n  }\n\n  /**\n   * ÁîüÊàêÁéØÂ¢ÉÊñá‰ª∂ÂÜÖÂÆπ\n   */\n  generateEnvContent(environment, includeSecrets = false) {\n    const isProduction = environment === 'production';\n    const isDevelopment = environment === 'development';\n    const isTest = environment === 'test';\n\n    let content = `# ${environment.toUpperCase()} ÁéØÂ¢ÉÈÖçÁΩÆ\\n`;\n    content += `# ÁîüÊàêÊó∂Èó¥: ${new Date().toISOString()}\\n\\n`;\n\n    // Âü∫Á°ÄÈÖçÁΩÆ\n    content += '# Â∫îÁî®ÈÖçÁΩÆ\\n';\n    content += `NODE_ENV=${environment}\\n`;\n    content += `PORT=${this.getDefaultPort(environment)}\\n`;\n    content += `HOST=${this.getDefaultHost(environment)}\\n`;\n    content += 'APP_NAME=\"Èõ∂Á¢≥Âõ≠Âå∫Êï∞Â≠óÂ≠™ÁîüËÉΩÁ¢≥ÁÆ°ÁêÜÁ≥ªÁªü\"\\n';\n    content += 'APP_VERSION=1.0.0\\n\\n';\n\n    // Êï∞ÊçÆÂ∫ìÈÖçÁΩÆ\n    content += '# Êï∞ÊçÆÂ∫ìÈÖçÁΩÆ\\n';\n    content += `DB_TYPE=${this.getDefaultDbType(environment)}\\n`;\n    content += `DB_HOST=${this.getDefaultDbHost(environment)}\\n`;\n    content += `DB_PORT=${this.getDefaultDbPort(environment)}\\n`;\n    content += `DB_NAME=${this.getDefaultDbName(environment)}\\n`;\n    content += `DB_USER=${this.getDefaultDbUser(environment)}\\n`;\n\n    if (includeSecrets) {\n      content += `DB_PASSWORD=${this.getSecret('db_password', environment) || ''}\\n`;\n    } else {\n      content += 'DB_PASSWORD=\\n';\n    }\n\n    content += `DB_SSL=${isProduction}\\n\\n`;\n\n    // RedisÈÖçÁΩÆ\n    content += '# RedisÈÖçÁΩÆ\\n';\n    content += 'REDIS_HOST=localhost\\n';\n    content += 'REDIS_PORT=6379\\n';\n    content += 'REDIS_PASSWORD=\\n';\n    content += 'REDIS_DB=0\\n\\n';\n\n    // JWTÈÖçÁΩÆ\n    content += '# JWTÈÖçÁΩÆ\\n';\n    if (includeSecrets) {\n      content += `JWT_SECRET=${this.getSecret('jwt_secret', environment) || this.generateSecret(32)}\\n`;\n      content += `JWT_REFRESH_SECRET=${this.getSecret('jwt_refresh_secret', environment) || this.generateSecret(32)}\\n`;\n    } else {\n      content += 'JWT_SECRET=\\n';\n      content += 'JWT_REFRESH_SECRET=\\n';\n    }\n    content += `JWT_EXPIRES_IN=${isProduction ? '2h' : '24h'}\\n`;\n    content += 'JWT_REFRESH_EXPIRES_IN=7d\\n\\n';\n\n    // Êó•ÂøóÈÖçÁΩÆ\n    content += '# Êó•ÂøóÈÖçÁΩÆ\\n';\n    content += `LOG_LEVEL=${this.getDefaultLogLevel(environment)}\\n`;\n    content += 'LOG_FILE=./logs/app.log\\n';\n    content += 'LOG_MAX_SIZE=10mb\\n';\n    content += 'LOG_MAX_FILES=5\\n\\n';\n\n    // ÁõëÊéßÈÖçÁΩÆ\n    content += '# ÁõëÊéßÈÖçÁΩÆ\\n';\n    content += `MONITORING_ENABLED=${!isTest}\\n`;\n    content += 'METRICS_PORT=9090\\n';\n    content += 'HEALTH_CHECK_INTERVAL=30000\\n\\n';\n\n    // ÂÆâÂÖ®ÈÖçÁΩÆ\n    content += '# ÂÆâÂÖ®ÈÖçÁΩÆ\\n';\n    content += `CORS_ORIGIN=${this.getDefaultCorsOrigin(environment)}\\n`;\n    if (includeSecrets) {\n      content += `CSRF_SECRET=${this.getSecret('csrf_secret', environment) || this.generateSecret(32)}\\n`;\n      content += `SESSION_SECRET=${this.getSecret('session_secret', environment) || this.generateSecret(32)}\\n`;\n      content += `ENCRYPTION_KEY=${this.getSecret('encryption_key', environment) || this.generateSecret(32)}\\n`;\n    } else {\n      content += 'CSRF_SECRET=\\n';\n      content += 'SESSION_SECRET=\\n';\n      content += 'ENCRYPTION_KEY=\\n';\n    }\n    content += 'HASH_SALT_ROUNDS=12\\n\\n';\n\n    return content;\n  }\n\n  /**\n   * È™åËØÅÁéØÂ¢ÉÈÖçÁΩÆ\n   */\n  async validateEnvironment(environment) {\n    console.log(`üîç È™åËØÅ ${environment} ÁéØÂ¢ÉÈÖçÁΩÆ...`);\n\n    const errors = [];\n    const warnings = [];\n\n    // Ê£ÄÊü•ÈÖçÁΩÆÊñá‰ª∂\n    const configPath = path.join(\n      this.options.projectRoot,\n      this.options.configDir,\n      `${environment}.js`\n    );\n\n    if (!fs.existsSync(configPath)) {\n      errors.push(`ÈÖçÁΩÆÊñá‰ª∂‰∏çÂ≠òÂú®: ${configPath}`);\n    } else {\n      try {\n        const config = await import(`file://${configPath}`);\n\n        // È™åËØÅÂøÖÈúÄÁöÑÈÖçÁΩÆÈ°π\n        const requiredFields = ['app.port', 'database.type', 'jwt.secret'];\n\n        for (const field of requiredFields) {\n          if (!this.getNestedValue(config.default, field)) {\n            errors.push(`Áº∫Â∞ëÂøÖÈúÄÈÖçÁΩÆ: ${field}`);\n          }\n        }\n\n        // È™åËØÅÁîü‰∫ßÁéØÂ¢ÉÁâπÊÆäË¶ÅÊ±Ç\n        if (environment === 'production') {\n          const productionChecks = [\n            'security.encryption.key',\n            'database.password',\n            'jwt.refreshSecret',\n          ];\n\n          for (const field of productionChecks) {\n            if (!this.getNestedValue(config.default, field)) {\n              warnings.push(`Áîü‰∫ßÁéØÂ¢ÉÂª∫ËÆÆÈÖçÁΩÆ: ${field}`);\n            }\n          }\n        }\n      } catch (error) {\n        errors.push(`ÈÖçÁΩÆÊñá‰ª∂Âä†ËΩΩÂ§±Ë¥•: ${error.message}`);\n      }\n    }\n\n    // Ê£ÄÊü•ÁéØÂ¢ÉÂèòÈáèÊñá‰ª∂\n    const envPath = path.join(this.options.projectRoot, `.env.${environment}`);\n    if (!fs.existsSync(envPath)) {\n      warnings.push(`ÁéØÂ¢ÉÂèòÈáèÊñá‰ª∂‰∏çÂ≠òÂú®: ${envPath}`);\n    }\n\n    // ËæìÂá∫È™åËØÅÁªìÊûú\n    if (errors.length > 0) {\n      console.log('\\n‚ùå ÈÖçÁΩÆÈ™åËØÅÂ§±Ë¥•:');\n      errors.forEach((error) => console.log(`   - ${error}`));\n    }\n\n    if (warnings.length > 0) {\n      console.log('\\n‚ö†Ô∏è  ÈÖçÁΩÆË≠¶Âëä:');\n      warnings.forEach((warning) => console.log(`   - ${warning}`));\n    }\n\n    if (errors.length === 0 && warnings.length === 0) {\n      console.log('‚úÖ ÈÖçÁΩÆÈ™åËØÅÈÄöËøá');\n    }\n\n    return {\n      valid: errors.length === 0,\n      errors,\n      warnings,\n\n      // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 26 Ë°å)\n\n      // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 26 Ë°å)\n\n      // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 26 Ë°å)\n\n      // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 26 Ë°å)\n    };\n  }\n\n  /**\n   * ÂàáÊç¢ÁéØÂ¢É\n   */\n  async switchEnvironment(environment) {\n    if (!this.environments.includes(environment)) {\n      throw new Error(`Êú™Áü•ÁéØÂ¢É: ${environment}`);\n    }\n\n    console.log(`üîÑ ÂàáÊç¢Âà∞ ${environment} ÁéØÂ¢É...`);\n\n    const envPath = path.join(this.options.projectRoot, `.env.${environment}`);\n    const targetPath = path.join(this.options.projectRoot, '.env');\n\n    if (!fs.existsSync(envPath)) {\n      throw new Error(`ÁéØÂ¢ÉÊñá‰ª∂‰∏çÂ≠òÂú®: ${envPath}`);\n    }\n\n    // Â§á‰ªΩÂΩìÂâçÁéØÂ¢ÉÊñá‰ª∂\n    if (fs.existsSync(targetPath)) {\n      const backupPath = `${targetPath}.backup.${Date.now()}`;\n      fs.copyFileSync(targetPath, backupPath);\n      console.log(`üì¶ ÂΩìÂâçÁéØÂ¢ÉÂ∑≤Â§á‰ªΩ: ${backupPath}`);\n    }\n\n    // Â§çÂà∂ÁéØÂ¢ÉÊñá‰ª∂\n    fs.copyFileSync(envPath, targetPath);\n\n    console.log(`‚úÖ Â∑≤ÂàáÊç¢Âà∞ ${environment} ÁéØÂ¢É`);\n  }\n\n  /**\n   * Âä†ËΩΩÂØÜÈí•\n   */\n  async loadSecrets() {\n    const secretsPath = path.join(this.options.projectRoot, this.options.secretsFile);\n\n    try {\n      await fs.promises.access(secretsPath);\n      const secretsData = await fs.promises.readFile(secretsPath, 'utf8');\n      const secrets = JSON.parse(secretsData);\n\n      for (const [key, value] of Object.entries(secrets)) {\n        this.secrets.set(key, value);\n      }\n\n      console.log(`‚úÖ Â∑≤Âä†ËΩΩ ${this.secrets.size} ‰∏™ÂØÜÈí•`);\n    } catch (error) {\n      if (error.code !== 'ENOENT') {\n        console.warn(`‚ö†Ô∏è  Âä†ËΩΩÂØÜÈí•Â§±Ë¥•: ${error.message}`);\n      }\n    }\n  }\n\n  /**\n   * ‰øùÂ≠òÂØÜÈí•\n   */\n  async saveSecrets() {\n    const secretsPath = path.join(this.options.projectRoot, this.options.secretsFile);\n\n    const secretsData = Object.fromEntries(this.secrets);\n    await fs.promises.writeFile(secretsPath, JSON.stringify(secretsData, null, 2));\n\n    // ËÆæÁΩÆÊñá‰ª∂ÊùÉÈôê\n    if (process.platform !== 'win32') {\n      await fs.promises.chmod(secretsPath, 0o600);\n    }\n\n    console.log(`‚úÖ ÂØÜÈí•Â∑≤‰øùÂ≠ò: ${secretsPath}`);\n  }\n\n  /**\n   * ËÆæÁΩÆÂØÜÈí•\n   */\n  setSecret(key, value, environment = null) {\n    const secretKey = environment ? `${environment}_${key}` : key;\n    this.secrets.set(secretKey, value);\n  }\n\n  /**\n   * Ëé∑ÂèñÂØÜÈí•\n   */\n  getSecret(key, environment = null) {\n    const secretKey = environment ? `${environment}_${key}` : key;\n    return this.secrets.get(secretKey);\n  }\n\n  /**\n   * ÁîüÊàêÈöèÊú∫ÂØÜÈí•\n   */\n  generateSecret(length = 32) {\n    return crypto.randomBytes(length).toString('hex');\n  }\n\n  /**\n   * ËæÖÂä©ÊñπÊ≥ï\n   */\n  getDefaultPort(environment) {\n    const ports = {\n      development: 3000,\n      test: 3001,\n      staging: 3002,\n      production: 3000,\n    };\n    return ports[environment] || 3000;\n  }\n\n  getDefaultHost(environment) {\n    return environment === 'production' ? '0.0.0.0' : 'localhost';\n  }\n\n  getDefaultDbType(environment) {\n    return environment === 'test' ? 'sqlite' : 'mysql';\n  }\n\n  getDefaultDbHost(environment) {\n    return environment === 'production' ? 'db.example.com' : 'localhost';\n  }\n\n  getDefaultDbPort(environment) {\n    const dbType = this.getDefaultDbType(environment);\n    return dbType === 'sqlite' ? null : 3306;\n  }\n\n  getDefaultDbName(environment) {\n    return `carbon_management_${environment}`;\n  }\n\n  getDefaultDbUser(environment) {\n    return environment === 'production' ? 'carbon_user' : 'root';\n  }\n\n  getDefaultLogLevel(environment) {\n    const levels = {\n      development: 'debug',\n      test: 'error',\n      staging: 'info',\n      production: 'warn',\n    };\n    return levels[environment] || 'info';\n  }\n\n  getDefaultCorsOrigin(environment) {\n    const origins = {\n      development: 'http://localhost:3000',\n      test: 'http://localhost:3001',\n      staging: 'https://staging.example.com',\n      production: 'https://app.example.com',\n    };\n    return origins[environment] || 'http://localhost:3000';\n  }\n\n  getNestedValue(obj, path) {\n    return path.split('.').reduce((current, key) => current?.[key], obj);\n  }\n}\n\n// ÂëΩ‰ª§Ë°åÊé•Âè£\nif (import.meta.url === `file://${process.argv[1]}`) {\n  const args = process.argv.slice(2);\n  const command = args[0];\n  const environment = args[1];\n\n  const manager = new EnvironmentManager();\n\n  async function main() {\n    try {\n      await manager.initialize();\n\n      switch (command) {\n        case 'init':\n          console.log('‚úÖ ÁéØÂ¢ÉÁÆ°ÁêÜÂô®Â∑≤ÂàùÂßãÂåñ');\n          break;\n\n        case 'generate':\n          if (!environment) {\n            console.error('ËØ∑ÊåáÂÆöÁéØÂ¢É: generate <environment> [--secrets] [--override]');\n            process.exit(1);\n          }\n\n          const options = {\n            secrets: args.includes('--secrets'),\n            override: args.includes('--override'),\n          };\n\n          await manager.generateEnvFile(environment, options);\n          break;\n\n        case 'validate':\n          if (!environment) {\n            console.error('ËØ∑ÊåáÂÆöÁéØÂ¢É: validate <environment>');\n            process.exit(1);\n          }\n\n          const result = await manager.validateEnvironment(environment);\n          if (!result.valid) {\n            process.exit(1);\n          }\n          break;\n\n        case 'switch':\n          if (!environment) {\n            console.error('ËØ∑ÊåáÂÆöÁéØÂ¢É: switch <environment>');\n            process.exit(1);\n          }\n\n          await manager.switchEnvironment(environment);\n          break;\n\n        case 'secret':\n          const action = args[1];\n          const key = args[2];\n          const value = args[3];\n\n          if (action === 'set' && key && value) {\n            manager.setSecret(key, value, environment);\n            await manager.saveSecrets();\n            console.log(`‚úÖ ÂØÜÈí•Â∑≤ËÆæÁΩÆ: ${key}`);\n          } else if (action === 'get' && key) {\n            const secret = manager.getSecret(key, environment);\n            console.log(secret || 'ÂØÜÈí•‰∏çÂ≠òÂú®');\n          } else if (action === 'generate') {\n            const length = parseInt(args[2]) || 32;\n            const secret = manager.generateSecret(length);\n            console.log(secret);\n          } else {\n            console.log('‰ΩøÁî®ÊñπÊ≥ï: secret <set|get|generate> [key] [value]');\n          }\n          break;\n\n        default:\n          console.log(`\n‰ΩøÁî®ÊñπÊ≥ï:\n  node env-manager.js init\n  node env-manager.js generate <environment> [--secrets] [--override]\n  node env-manager.js validate <environment>\n  node env-manager.js switch <environment>\n  node env-manager.js secret <set|get|generate> [key] [value]\n\nÂèØÁî®ÁéØÂ¢É: ${manager.environments.join(', ')}\n`);\n      }\n    } catch (error) {\n      console.error(`\\n‚ùå Êìç‰ΩúÂ§±Ë¥•: ${error.message}`);\n      process.exit(1);\n    }\n  }\n\n  main();\n}\n\nexport default EnvironmentManager;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/scripts/generate-api-docs.js","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":26,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":26,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[555,586],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":40,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":40,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[849,877],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":41,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":41,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[884,926],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":43,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":43,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[955,992],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":63,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":63,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1279,1307],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":71,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":71,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1463,1519],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":114,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":114,"endColumn":19,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[2491,2546],"text":""},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":308,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":308,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[6901,6935],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":320,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":320,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[7313,7359],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":467,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":467,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[9866,9899],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":538,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":538,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[11562,11607],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":605,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":605,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[13469,13502],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":699,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":699,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[15885,15930],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":745,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":745,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[16857,16889],"text":""},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":14,"fixableErrorCount":0,"fixableWarningCount":0,"source":"#!/usr/bin/env node\n\nimport fs from 'fs';\nimport path from 'path';\nimport { fileURLToPath } from 'url';\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\n\n/**\n * APIÊñáÊ°£ÁîüÊàêÂô®\n * Ëá™Âä®Êâ´ÊèèË∑ØÁî±Êñá‰ª∂Âπ∂ÁîüÊàêAPIÊñáÊ°£\n */\nclass ApiDocGenerator {\n  constructor() {\n    this.projectRoot = path.resolve(__dirname, '..');\n    this.routesDir = path.join(this.projectRoot, 'src/interfaces/http');\n    this.outputDir = path.join(this.projectRoot, 'docs/api');\n    this.apiEndpoints = [];\n  }\n\n  /**\n   * ÁîüÊàêAPIÊñáÊ°£\n   */\n  async generate() {\n    console.log('üöÄ ÂºÄÂßãÁîüÊàêAPIÊñáÊ°£...');\n\n    try {\n      // Á°Æ‰øùËæìÂá∫ÁõÆÂΩïÂ≠òÂú®\n      await this.ensureOutputDir();\n\n      // Êâ´ÊèèË∑ØÁî±Êñá‰ª∂\n      await this.scanRoutes();\n\n      // ÁîüÊàêÊñáÊ°£\n      await this.generateMarkdownDocs();\n      await this.generateOpenApiSpec();\n      await this.generatePostmanCollection();\n\n      console.log('‚úÖ APIÊñáÊ°£ÁîüÊàêÂÆåÊàê!');\n      console.log(`üìÅ ÊñáÊ°£‰ΩçÁΩÆ: ${this.outputDir}`);\n    } catch (error) {\n      console.error('‚ùå APIÊñáÊ°£ÁîüÊàêÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Á°Æ‰øùËæìÂá∫ÁõÆÂΩïÂ≠òÂú®\n   */\n  async ensureOutputDir() {\n    try {\n      await fs.promises.access(this.outputDir);\n    } catch {\n      await fs.promises.mkdir(this.outputDir, { recursive: true });\n    }\n  }\n\n  /**\n   * Êâ´ÊèèË∑ØÁî±Êñá‰ª∂\n   */\n  async scanRoutes() {\n    console.log('üîç Êâ´ÊèèË∑ØÁî±Êñá‰ª∂...');\n\n    const routeFiles = await this.findRouteFiles(this.routesDir);\n\n    for (const file of routeFiles) {\n      await this.parseRouteFile(file);\n    }\n\n    console.log(`üìã ÂèëÁé∞ ${this.apiEndpoints.length} ‰∏™APIÁ´ØÁÇπ`);\n  }\n\n  /**\n   * Êü•ÊâæË∑ØÁî±Êñá‰ª∂\n   */\n  async findRouteFiles(dir) {\n    const files = [];\n\n    try {\n      await fs.promises.access(dir);\n    } catch {\n      return files;\n    }\n\n    const items = await fs.promises.readdir(dir);\n\n    for (const item of items) {\n      const fullPath = path.join(dir, item);\n      const stat = await fs.promises.stat(fullPath);\n\n      if (stat.isDirectory()) {\n        files.push(...(await this.findRouteFiles(fullPath)));\n      } else if (item.endsWith('.js') && (item.includes('route') || item.includes('controller'))) {\n        files.push(fullPath);\n      }\n    }\n\n    return files;\n  }\n\n  /**\n   * Ëß£ÊûêË∑ØÁî±Êñá‰ª∂\n   */\n  async parseRouteFile(filePath) {\n    try {\n      const content = await fs.promises.readFile(filePath, 'utf8');\n      const relativePath = path.relative(this.projectRoot, filePath);\n\n      // Ëß£ÊûêË∑ØÁî±ÂÆö‰πâ\n      const routes = this.extractRoutes(content, relativePath);\n      this.apiEndpoints.push(...routes);\n    } catch (error) {\n      console.warn(`‚ö†Ô∏è  Ëß£ÊûêÊñá‰ª∂Â§±Ë¥•: ${filePath}`, error.message);\n    }\n  }\n\n  /**\n   * ÊèêÂèñË∑ØÁî±‰ø°ÊÅØ\n   */\n  extractRoutes(content, filePath) {\n    const routes = [];\n    const lines = content.split('\\n');\n\n    // ÂåπÈÖçË∑ØÁî±ÂÆö‰πâÁöÑÊ≠£ÂàôË°®ËææÂºè\n    const routePatterns = [\n      /(?:router|app)\\.(get|post|put|delete|patch)\\s*\\(\\s*['\"`]([^'\"` ]+)['\"`]/g,\n      /\\.route\\s*\\(\\s*['\"`]([^'\"` ]+)['\"`]\\s*\\)\\s*\\.(get|post|put|delete|patch)/g,\n    ];\n\n    let currentComment = '';\n\n    for (let i = 0, len = lines.length; i < len; i++) {\n      const line = lines[i].trim();\n\n      // Êî∂ÈõÜÊ≥®Èáä\n      if (line.startsWith('//') || line.startsWith('*')) {\n        currentComment += `${line.replace(/^\\/\\/\\s*|^\\*\\s*/, '')} `;\n        continue;\n      }\n\n      // ÂåπÈÖçË∑ØÁî±ÂÆö‰πâ\n      for (const pattern of routePatterns) {\n        pattern.lastIndex = 0; // ÈáçÁΩÆÊ≠£ÂàôË°®ËææÂºè\n        const match = pattern.exec(line);\n\n        if (match) {\n          const method = (match[1] || match[2]).toUpperCase();\n          const path = match[2] || match[1];\n\n          routes.push({\n            method,\n            path,\n            description: currentComment.trim() || `${method} ${path}`,\n            file: filePath,\n            line: i + 1,\n            tags: this.extractTags(filePath),\n            parameters: this.extractParameters(path),\n            responses: this.getDefaultResponses(),\n          });\n\n          currentComment = '';\n        }\n      }\n\n      // ÈáçÁΩÆÊ≥®ÈáäÔºàÂ¶ÇÊûú‰∏çÊòØÊ≥®ÈáäË°åÔºâ\n      if (!line.startsWith('//') && !line.startsWith('*') && line !== '') {\n        currentComment = '';\n      }\n    }\n\n    return routes;\n  }\n\n  /**\n   * ÊèêÂèñÊ†áÁ≠æ\n   */\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 21 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 25 Ë°å)\n\n  extractTags(filePath) {\n    const tags = [];\n\n    if (filePath.includes('user')) {\n      tags.push('Áî®Êà∑ÁÆ°ÁêÜ');\n    }\n    if (filePath.includes('device')) {\n      tags.push('ËÆæÂ§áÁÆ°ÁêÜ');\n    }\n    if (filePath.includes('energy')) {\n      tags.push('ËÉΩÊ∫êÊï∞ÊçÆ');\n    }\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (filePath.includes('carbon')) {\n      tags.push('Á¢≥ÊéíÊîæ');\n    }\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (filePath.includes('alert')) {\n      tags.push('ÂëäË≠¶ÁÆ°ÁêÜ');\n    }\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (filePath.includes('auth')) {\n      tags.push('ËÆ§ËØÅÊéàÊùÉ');\n    }\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (filePath.includes('prediction')) {\n      tags.push('È¢ÑÊµãÂàÜÊûê');\n    }\n\n    return tags.length > 0 ? tags : ['ÂÖ∂‰ªñ'];\n  }\n\n  /**\n   * ÊèêÂèñË∑ØÂæÑÂèÇÊï∞\n   */\n  extractParameters(path) {\n    const parameters = [];\n    const paramMatches = path.match(/:([a-zA-Z_][a-zA-Z0-9_]*)/g);\n\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (paramMatches) {\n      for (const param of paramMatches) {\n        const name = param.substring(1);\n        parameters.push({\n          name,\n          in: 'path',\n          required: true,\n          type: 'string',\n          description: `${name}ÂèÇÊï∞`,\n        });\n      }\n    }\n\n    return parameters;\n  }\n\n  /**\n   * Ëé∑ÂèñÈªòËÆ§ÂìçÂ∫î\n   */\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 37 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 37 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 37 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 37 Ë°å)\n\n  getDefaultResponses() {\n    return {\n      200: {\n        description: 'ËØ∑Ê±ÇÊàêÂäü',\n        schema: {\n          type: 'object',\n          properties: {\n            success: { type: 'boolean', example: true },\n            data: { type: 'object' },\n            message: { type: 'string' },\n          },\n        },\n      },\n      400: {\n        description: 'ËØ∑Ê±ÇÂèÇÊï∞ÈîôËØØ',\n        schema: {\n          type: 'object',\n          properties: {\n            success: { type: 'boolean', example: false },\n            error: {\n              type: 'object',\n              properties: {\n                code: { type: 'string' },\n                message: { type: 'string' },\n              },\n            },\n          },\n        },\n      },\n      401: {\n        description: 'Êú™ÊéàÊùÉËÆøÈóÆ',\n      },\n      500: {\n        description: 'ÊúçÂä°Âô®ÂÜÖÈÉ®ÈîôËØØ',\n      },\n    };\n  }\n\n  /**\n   * ÁîüÊàêMarkdownÊñáÊ°£\n   */\n  async generateMarkdownDocs() {\n    console.log('üìù ÁîüÊàêMarkdownÊñáÊ°£...');\n\n    const groupedEndpoints = this.groupEndpointsByTag();\n    let markdown = this.generateMarkdownHeader();\n\n    for (const [tag, endpoints] of Object.entries(groupedEndpoints)) {\n      markdown += this.generateTagSection(tag, endpoints);\n    }\n\n    const outputPath = path.join(this.outputDir, 'README.md');\n    await fs.promises.writeFile(outputPath, markdown, 'utf8');\n\n    console.log(`‚úÖ MarkdownÊñáÊ°£Â∑≤ÁîüÊàê: ${outputPath}`);\n  }\n\n  /**\n   * ÊåâÊ†áÁ≠æÂàÜÁªÑÁ´ØÁÇπ\n   */\n  groupEndpointsByTag() {\n    const grouped = {};\n\n    for (const endpoint of this.apiEndpoints) {\n      for (const tag of endpoint.tags) {\n        if (!grouped[tag]) {\n          grouped[tag] = [];\n        }\n        grouped[tag].push(endpoint);\n      }\n    }\n\n    return grouped;\n  }\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 58 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 58 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 58 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 58 Ë°å)\n\n  /**\n   * ÁîüÊàêMarkdownÂ§¥ÈÉ®\n   */\n  generateMarkdownHeader() {\n    return `# Èõ∂Á¢≥Âõ≠Âå∫Êï∞Â≠óÂ≠™ÁîüËÉΩÁ¢≥ÁÆ°ÁêÜÁ≥ªÁªü API ÊñáÊ°£\n\n> Ëá™Âä®ÁîüÊàê‰∫é: ${new Date().toLocaleString('zh-CN')}\n\n## Ê¶ÇËø∞\n\nÊú¨ÊñáÊ°£ÊèèËø∞‰∫ÜÈõ∂Á¢≥Âõ≠Âå∫Êï∞Â≠óÂ≠™ÁîüËÉΩÁ¢≥ÁÆ°ÁêÜÁ≥ªÁªüÁöÑÊâÄÊúâAPIÊé•Âè£„ÄÇ\n\n### Âü∫Á°Ä‰ø°ÊÅØ\n\n- **Base URL**: \\`http://localhost:3000/api\\`\n- **ËÆ§ËØÅÊñπÂºè**: Bearer Token (JWT)\n- **Êï∞ÊçÆÊ†ºÂºè**: JSON\n- **Â≠óÁ¨¶ÁºñÁ†Å**: UTF-8\n\n### ÈÄöÁî®ÂìçÂ∫îÊ†ºÂºè\n\nÊàêÂäüÂìçÂ∫î:\n\\`\\`\\`json\n{\n  \"success\": true,\n  \"data\": {},\n  \"message\": \"Êìç‰ΩúÊàêÂäü\"\n}\n\\`\\`\\`\n\nÈîôËØØÂìçÂ∫î:\n\\`\\`\\`json\n{\n  \"success\": false,\n  \"error\": {\n    \"code\": \"ERROR_CODE\",\n    \"message\": \"ÈîôËØØÊèèËø∞\"\n  }\n}\n\\`\\`\\`\n\n### ÂàÜÈ°µÂìçÂ∫îÊ†ºÂºè\n\n\\`\\`\\`json\n{\n  \"success\": true,\n  \"data\": [],\n  \"meta\": {\n    \"total\": 100,\n    \"page\": 1,\n    \"limit\": 20,\n    \"hasNext\": true,\n    \"hasPrev\": false\n  }\n}\n\\`\\`\\`\n\n---\n\n`;\n  }\n\n  /**\n   * ÁîüÊàêÊ†áÁ≠æÁ´†ËäÇ\n   */\n  generateTagSection(tag, endpoints) {\n    let section = `## ${tag}\\n\\n`;\n\n    for (const endpoint of endpoints) {\n      section += this.generateEndpointDoc(endpoint);\n    }\n\n    return section;\n  }\n\n  /**\n   * ÁîüÊàêÁ´ØÁÇπÊñáÊ°£\n   */\n  generateEndpointDoc(endpoint) {\n    let doc = `### ${endpoint.method} ${endpoint.path}\\n\\n`;\n    doc += `**ÊèèËø∞**: ${endpoint.description}\\n\\n`;\n\n    // Ë∑ØÂæÑÂèÇÊï∞\n    if (endpoint.parameters.length > 0) {\n      doc += '**Ë∑ØÂæÑÂèÇÊï∞**:\\n\\n';\n      doc += '| ÂèÇÊï∞Âêç | Á±ªÂûã | ÂøÖÂ°´ | ÊèèËø∞ |\\n';\n      doc += '|--------|------|------|------|\\n';\n\n      for (const param of endpoint.parameters) {\n        doc += `| ${param.name} | ${param.type} | ${param.required ? 'ÊòØ' : 'Âê¶'} | ${param.description} |\\n`;\n      }\n      doc += '\\n';\n    }\n\n    // ËØ∑Ê±ÇÁ§∫‰æã\n    doc += '**ËØ∑Ê±ÇÁ§∫‰æã**:\\n\\n';\n    doc += '```bash\\n';\n    doc += `curl -X ${endpoint.method} \\\\\\n`;\n    doc += `  \"http://localhost:3000/api${endpoint.path}\" \\\\\\n`;\n    doc += '  -H \"Authorization: Bearer YOUR_TOKEN\" \\\\\\n';\n    doc += '  -H \"Content-Type: application/json\"\\n';\n    doc += '```\\n\\n';\n\n    // ÂìçÂ∫îÁ§∫‰æã\n    doc += '**ÂìçÂ∫îÁ§∫‰æã**:\\n\\n';\n    doc += '```json\\n';\n    doc += JSON.stringify(endpoint.responses['200'].schema, null, 2);\n    doc += '\\n```\\n\\n';\n\n    doc += '---\\n\\n';\n\n    return doc;\n  }\n\n  /**\n   * ÁîüÊàêOpenAPIËßÑËåÉ\n   */\n  async generateOpenApiSpec() {\n    console.log('üìã ÁîüÊàêOpenAPIËßÑËåÉ...');\n\n    const spec = {\n      openapi: '3.0.0',\n      info: {\n        title: 'Èõ∂Á¢≥Âõ≠Âå∫Êï∞Â≠óÂ≠™ÁîüËÉΩÁ¢≥ÁÆ°ÁêÜÁ≥ªÁªü API',\n        version: '1.0.0',\n        description: 'Èõ∂Á¢≥Âõ≠Âå∫Êï∞Â≠óÂ≠™ÁîüËÉΩÁ¢≥ÁÆ°ÁêÜÁ≥ªÁªüÁöÑAPIÊé•Âè£ÊñáÊ°£',\n        contact: {\n          name: 'API Support',\n          email: 'support@example.com',\n        },\n      },\n      servers: [\n        {\n          url: 'http://localhost:3000/api',\n          description: 'ÂºÄÂèëÁéØÂ¢É',\n        },\n        {\n          url: 'https://api.example.com',\n          description: 'Áîü‰∫ßÁéØÂ¢É',\n        },\n      ],\n      paths: {},\n      components: {\n        securitySchemes: {\n          bearerAuth: {\n            type: 'http',\n            scheme: 'bearer',\n            bearerFormat: 'JWT',\n          },\n        },\n        schemas: this.generateSchemas(),\n      },\n      security: [\n        {\n          bearerAuth: [],\n        },\n      ],\n    };\n\n    // ÁîüÊàêË∑ØÂæÑ\n    for (const endpoint of this.apiEndpoints) {\n      const path = endpoint.path.replace(/:([a-zA-Z_][a-zA-Z0-9_]*)/g, '{$1}');\n\n      if (!spec.paths[path]) {\n        spec.paths[path] = {};\n      }\n\n      spec.paths[path][endpoint.method.toLowerCase()] = {\n        tags: endpoint.tags,\n        summary: endpoint.description,\n        parameters: endpoint.parameters.map((param) => ({\n          ...param,\n          schema: { type: param.type },\n        })),\n        responses: endpoint.responses,\n      };\n    }\n\n    const outputPath = path.join(this.outputDir, 'openapi.json');\n    await fs.promises.writeFile(outputPath, JSON.stringify(spec, null, 2), 'utf8');\n\n    // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 56 Ë°å)\n\n    // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 56 Ë°å)\n\n    // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 56 Ë°å)\n\n    // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 56 Ë°å)\n\n    console.log(`‚úÖ OpenAPIËßÑËåÉÂ∑≤ÁîüÊàê: ${outputPath}`);\n  }\n\n  /**\n   * ÁîüÊàêÊï∞ÊçÆÊ®°Âûã\n   */\n  generateSchemas() {\n    return {\n      User: {\n        type: 'object',\n        properties: {\n          id: { type: 'string' },\n          username: { type: 'string' },\n          email: { type: 'string', format: 'email' },\n          role: { type: 'string', enum: ['admin', 'operator', 'viewer'] },\n          isActive: { type: 'boolean' },\n          createdAt: { type: 'string', format: 'date-time' },\n          updatedAt: { type: 'string', format: 'date-time' },\n        },\n      },\n      Device: {\n        type: 'object',\n        properties: {\n          id: { type: 'string' },\n          name: { type: 'string' },\n          type: { type: 'string' },\n          location: { type: 'string' },\n          status: { type: 'string', enum: ['online', 'offline', 'maintenance', 'error'] },\n          createdAt: { type: 'string', format: 'date-time' },\n          updatedAt: { type: 'string', format: 'date-time' },\n        },\n      },\n      EnergyData: {\n        type: 'object',\n        properties: {\n          id: { type: 'string' },\n          deviceId: { type: 'string' },\n          timestamp: { type: 'string', format: 'date-time' },\n          power: { type: 'number' },\n          energy: { type: 'number' },\n          voltage: { type: 'number' },\n          current: { type: 'number' },\n          createdAt: { type: 'string', format: 'date-time' },\n        },\n      },\n      ApiResponse: {\n        type: 'object',\n        properties: {\n          success: { type: 'boolean' },\n          data: { type: 'object' },\n          message: { type: 'string' },\n          error: {\n            type: 'object',\n            properties: {\n              code: { type: 'string' },\n              message: { type: 'string' },\n            },\n          },\n        },\n      },\n    };\n  }\n\n  /**\n   * ÁîüÊàêPostmanÈõÜÂêà\n   */\n  async generatePostmanCollection() {\n    console.log('üìÆ ÁîüÊàêPostmanÈõÜÂêà...');\n\n    const collection = {\n      info: {\n        name: 'Èõ∂Á¢≥Âõ≠Âå∫Êï∞Â≠óÂ≠™ÁîüËÉΩÁ¢≥ÁÆ°ÁêÜÁ≥ªÁªü API',\n        description: 'APIÊé•Âè£ÊµãËØïÈõÜÂêà',\n        schema: 'https://schema.getpostman.com/json/collection/v2.1.0/collection.json',\n      },\n      auth: {\n        type: 'bearer',\n        bearer: [\n          {\n            key: process.env.API_KEY || 'default',\n            value: '{{access_token}}',\n            type: 'string',\n          },\n        ],\n      },\n      variable: [\n        {\n          key: process.env.API_KEY || 'default',\n          value: 'http://localhost:3000/api',\n          type: 'string',\n        },\n        {\n          key: process.env.API_KEY || 'default',\n          value: '',\n          type: 'string',\n        },\n      ],\n      item: [],\n    };\n\n    // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 30 Ë°å)\n\n    // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 30 Ë°å)\n\n    // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 30 Ë°å)\n\n    // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 30 Ë°å)\n\n    const groupedEndpoints = this.groupEndpointsByTag();\n\n    for (const [tag, endpoints] of Object.entries(groupedEndpoints)) {\n      const folder = {\n        name: tag,\n        item: [],\n      };\n\n      for (const endpoint of endpoints) {\n        const request = {\n          name: `${endpoint.method} ${endpoint.path}`,\n          request: {\n            method: endpoint.method,\n            header: [\n              {\n                key: process.env.API_KEY || 'default',\n                value: 'application/json',\n              },\n            ],\n            url: {\n              raw: `{{base_url}}${endpoint.path}`,\n              host: ['{{base_url}}'],\n              path: endpoint.path.split('/').filter((p) => p),\n            },\n            description: endpoint.description,\n          },\n        };\n\n        // Ê∑ªÂä†ËØ∑Ê±Ç‰ΩìÁ§∫‰æãÔºàPOST/PUTËØ∑Ê±ÇÔºâ\n        if (['POST', 'PUT', 'PATCH'].includes(endpoint.method)) {\n          request.request.body = {\n            mode: 'raw',\n            raw: JSON.stringify(this.getExampleRequestBody(endpoint), null, 2),\n          };\n        }\n\n        folder.item.push(request);\n      }\n\n      // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 35 Ë°å)\n\n      // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 35 Ë°å)\n\n      // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 35 Ë°å)\n\n      // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 35 Ë°å)\n\n      collection.item.push(folder);\n    }\n\n    const outputPath = path.join(this.outputDir, 'postman-collection.json');\n    await fs.promises.writeFile(outputPath, JSON.stringify(collection, null, 2), 'utf8');\n\n    console.log(`‚úÖ PostmanÈõÜÂêàÂ∑≤ÁîüÊàê: ${outputPath}`);\n  }\n\n  /**\n   * Ëé∑ÂèñÁ§∫‰æãËØ∑Ê±Ç‰Ωì\n   */\n  getExampleRequestBody(endpoint) {\n    const examples = {\n      '/users': {\n        username: 'testuser',\n        email: 'test@example.com',\n        password: process.env.DB_PASSWORD || 'default',\n        role: 'operator',\n      },\n      '/devices': {\n        name: 'ÊµãËØïËÆæÂ§á',\n        type: 'solar_panel',\n        location: 'Âª∫Á≠ëA-1F',\n        specifications: {\n          capacity: 100,\n          efficiency: 0.85,\n        },\n      },\n      '/energy-data': {\n        deviceId: 'device-123',\n        timestamp: new Date().toISOString(),\n        power: 85.5,\n        energy: 120.3,\n        voltage: 220,\n        current: 15.2,\n      },\n    };\n\n    for (const [path, example] of Object.entries(examples)) {\n      if (endpoint.path.includes(path)) {\n        return example;\n      }\n    }\n\n    return {};\n  }\n}\n\n// ÊâßË°åÊñáÊ°£ÁîüÊàê\nconst generator = new ApiDocGenerator();\ngenerator.generate().catch((error) => {\n  console.error('ÊñáÊ°£ÁîüÊàêÂ§±Ë¥•:', error);\n  process.exit(1);\n});\n\nexport default ApiDocGenerator;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/scripts/init-sample-devices.js","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":199,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":199,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[4878,4908],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":213,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":213,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[5227,5287],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":258,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":258,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[6511,6550],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":261,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":261,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[6562,6616],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":263,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":263,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[6641,6676],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":272,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":272,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[6815,6840],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":276,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":276,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[6901,6936],"text":""},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * ÂàùÂßãÂåñÁ§∫‰æãËÆæÂ§áÊï∞ÊçÆ\n * Áî®‰∫éÊºîÁ§∫ÂíåÊµãËØïËÆæÂ§áÁÆ°ÁêÜÂäüËÉΩ\n */\n\nimport { db } from '../src/database.js';\nimport { v4 as uuidv4 } from 'uuid';\n\n// Á§∫‰æãËÆæÂ§áÊï∞ÊçÆ\nconst sampleDevices = [\n  {\n    id: uuidv4(),\n    building_id: 'default-building',\n    name: '‰∏ªÈÖçÁîµÊüúA',\n    type: 'electrical_panel',\n    category: 'electrical',\n    model: 'MNS-3200',\n    manufacturer: 'ABB',\n    serial_number: 'ABB2024001',\n    location: 'AÊ†ã1Â±ÇÈÖçÁîµÂÆ§',\n    coordinates: JSON.stringify({ x: 10, y: 0, z: 5 }),\n    install_date: '2024-01-15',\n    warranty_date: '2027-01-15',\n    rated_power: 3200,\n    parameters: JSON.stringify({\n      voltage: '380V',\n      frequency: '50Hz',\n      phases: 3,\n    }),\n    status: 'online',\n    remark: '‰∏ªË¶ÅÈÖçÁîµËÆæÂ§áÔºåË¥üË¥£Êï¥Ê†ãÊ•º‰æõÁîµ',\n  },\n  {\n    id: uuidv4(),\n    building_id: 'default-building',\n    name: 'Â§™Èò≥ËÉΩÊùøÁªÑB1',\n    type: 'solar_panel',\n    category: 'renewable',\n    model: 'JKM-540M',\n    manufacturer: 'Êô∂ÁßëËÉΩÊ∫ê',\n    serial_number: 'JK2024002',\n    location: 'BÊ†ãÂ±ãÈ°∂‰∏ú‰æß',\n    coordinates: JSON.stringify({ x: 20, y: 15, z: 10 }),\n    install_date: '2024-02-01',\n    warranty_date: '2034-02-01',\n    rated_power: 540,\n    parameters: JSON.stringify({\n      efficiency: '21.2%',\n      temperature_coefficient: '-0.35%/¬∞C',\n      max_system_voltage: '1500V',\n    }),\n    status: 'online',\n    remark: 'È´òÊïàÂçïÊô∂Á°ÖÂ§™Èò≥ËÉΩÁîµÊ±†Êùø',\n  },\n  {\n    id: uuidv4(),\n    building_id: 'default-building',\n    name: 'ÂÇ®ËÉΩÁ≥ªÁªüC1',\n    type: 'battery-storage',\n    category: 'storage',\n    model: 'BYD-ESS-100',\n    manufacturer: 'ÊØî‰∫öËø™',\n    serial_number: 'BYD2024003',\n    location: 'CÊ†ãÂú∞‰∏ãÂÆ§ÂÇ®ËÉΩÈó¥',\n    coordinates: JSON.stringify({ x: 30, y: -5, z: 15 }),\n    install_date: '2024-02-15',\n    warranty_date: '2034-02-15',\n    rated_power: 1000,\n    parameters: JSON.stringify({\n      capacity: '100kWh',\n      voltage: '768V',\n      efficiency: '95%',\n      cycles: '6000+',\n    }),\n    status: 'online',\n    remark: 'Á£∑ÈÖ∏ÈìÅÈîÇÁîµÊ±†ÂÇ®ËÉΩÁ≥ªÁªü',\n  },\n  {\n    id: uuidv4(),\n    building_id: 'default-building',\n    name: 'È£éÂäõÂèëÁîµÊú∫D1',\n    type: 'wind_turbine',\n    category: 'renewable',\n    model: 'WT-5000',\n    manufacturer: 'ÈáëÈ£éÁßëÊäÄ',\n    serial_number: 'GW2024004',\n    location: 'DÂå∫Á©∫Âú∞',\n    coordinates: JSON.stringify({ x: 40, y: 20, z: 20 }),\n    install_date: '2024-03-01',\n    warranty_date: '2029-03-01',\n    rated_power: 5000,\n    parameters: JSON.stringify({\n      rotor_diameter: '130m',\n      hub_height: '90m',\n      cut_in_speed: '3m/s',\n      rated_speed: '11m/s',\n    }),\n    status: 'online',\n    remark: 'Áõ¥È©±Ê∞∏Á£ÅÂêåÊ≠•È£éÂäõÂèëÁîµÊú∫',\n  },\n  {\n    id: uuidv4(),\n    building_id: 'default-building',\n    name: '‰∏≠Â§ÆÁ©∫Ë∞ÉÁ≥ªÁªüE1',\n    type: 'hvac_system',\n    category: 'hvac',\n    model: 'CA-200RT',\n    manufacturer: 'ÂºÄÂà©',\n    serial_number: 'CR2024005',\n    location: 'EÊ†ãÊú∫Êàø',\n    coordinates: JSON.stringify({ x: 50, y: 10, z: 25 }),\n    install_date: '2024-01-20',\n    warranty_date: '2026-01-20',\n    rated_power: 200,\n    parameters: JSON.stringify({\n      cooling_capacity: '200RT',\n      refrigerant: 'R134a',\n      efficiency: 'COP 3.2',\n    }),\n    status: 'online',\n    remark: 'Á¶ªÂøÉÂºèÂÜ∑Ê∞¥Êú∫ÁªÑ',\n  },\n  {\n    id: uuidv4(),\n    building_id: 'default-building',\n    name: 'Êô∫ËÉΩÁÖßÊòéÁ≥ªÁªüF1',\n    type: 'lighting_system',\n    category: 'lighting',\n    model: 'LED-Smart-100',\n    manufacturer: 'È£ûÂà©Êµ¶',\n    serial_number: 'PH2024006',\n    location: 'FÊ†ãÂäûÂÖ¨Âå∫',\n    coordinates: JSON.stringify({ x: 60, y: 5, z: 30 }),\n    install_date: '2024-01-25',\n    warranty_date: '2029-01-25',\n    rated_power: 100,\n    parameters: JSON.stringify({\n      luminous_efficacy: '150lm/W',\n      color_temperature: '3000K-6500K',\n      dimming: '0-100%',\n      lifespan: '50000h',\n    }),\n    status: 'online',\n    remark: 'LEDÊô∫ËÉΩË∞ÉÂÖâÁÖßÊòéÁ≥ªÁªü',\n  },\n  {\n    id: uuidv4(),\n    building_id: 'default-building',\n    name: 'ÁîµÂä®Ê±ΩËΩ¶ÂÖÖÁîµÊ°©G1',\n    type: 'ev_charger',\n    category: 'charging',\n    model: 'DC-60kW',\n    manufacturer: 'ÁâπÊù•Áîµ',\n    serial_number: 'TLD2024007',\n    location: 'GÂå∫ÂÅúËΩ¶Âú∫',\n    coordinates: JSON.stringify({ x: 70, y: 0, z: 35 }),\n    install_date: '2024-02-10',\n    warranty_date: '2027-02-10',\n    rated_power: 60,\n    parameters: JSON.stringify({\n      output_voltage: '200-750V',\n      output_current: '0-125A',\n      efficiency: '95%',\n      connector: 'GB/T 20234.3',\n    }),\n    status: 'offline',\n    remark: 'Áõ¥ÊµÅÂø´ÂÖÖÂÖÖÁîµÊ°©ÔºåÁª¥Êä§‰∏≠',\n  },\n  {\n    id: uuidv4(),\n    building_id: 'default-building',\n    name: 'Êô∫ËÉΩÁîµË°®H1',\n    type: 'smart_meter',\n    category: 'meter',\n    model: 'SM-3P4W',\n    manufacturer: 'ÂçéÁ´ãÁßëÊäÄ',\n    serial_number: 'HL2024008',\n    location: 'HÊ†ãËÆ°ÈáèÂÆ§',\n    coordinates: JSON.stringify({ x: 80, y: 2, z: 40 }),\n    install_date: '2024-01-10',\n    warranty_date: '2034-01-10',\n    rated_power: 0, // ËÆ°ÈáèËÆæÂ§á‰∏çÊ∂àËÄóÂäüÁéá\n    parameters: JSON.stringify({\n      accuracy: '0.2SÁ∫ß',\n      voltage: '3√ó220/380V',\n      current: '1.5(6)A',\n      frequency: '50Hz',\n    }),\n    status: 'online',\n    remark: '‰∏âÁõ∏ÂõõÁ∫øÊô∫ËÉΩÁîµËÉΩË°®',\n  },\n];\n\n/**\n * ÂàùÂßãÂåñÁ§∫‰æãËÆæÂ§áÊï∞ÊçÆ\n */\nexport async function initSampleDevices() {\n  try {\n    console.log('ÂºÄÂßãÂàùÂßãÂåñÁ§∫‰æãËÆæÂ§áÊï∞ÊçÆ...');\n\n    // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÊúâËÆæÂ§áÊï∞ÊçÆ\n    const existingDevices = await new Promise((resolve, reject) => {\n      db.all('SELECT COUNT(*) as count FROM devices', (err, rows) => {\n        if (err) {\n          reject(err);\n        } else {\n          resolve(rows);\n        }\n      });\n    });\n\n    if (existingDevices[0].count > 0) {\n      console.log(`Êï∞ÊçÆÂ∫ì‰∏≠Â∑≤Êúâ ${existingDevices[0].count} ‰∏™ËÆæÂ§áÔºåË∑≥ËøáÂàùÂßãÂåñ`);\n      return;\n    }\n\n    // ÊèíÂÖ•Á§∫‰æãËÆæÂ§á\n    const insertSql = `\n      INSERT INTO devices (\n        id, building_id, name, type, category, model, manufacturer,\n        serial_number, location, coordinates, install_date, warranty_date,\n        rated_power, parameters, status, remark, created_at, updated_at\n      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP)\n    `;\n\n    for (const device of sampleDevices) {\n      await new Promise((resolve, reject) => {\n        db.run(\n          insertSql,\n          [\n            device.id,\n            device.building_id,\n            device.name,\n            device.type,\n            device.category,\n            device.model,\n            device.manufacturer,\n            device.serial_number,\n            device.location,\n            device.coordinates,\n            device.install_date,\n            device.warranty_date,\n            device.rated_power,\n            device.parameters,\n            device.status,\n            device.remark,\n          ],\n          function (err) {\n            if (err) {\n              reject(err);\n            } else {\n              resolve(this.lastID);\n            }\n          }\n        );\n      });\n\n      console.log(`‚úÖ Â∑≤ÂàõÂª∫ËÆæÂ§á: ${device.name}`);\n    }\n\n    console.log(`üéâ ÊàêÂäüÂàùÂßãÂåñ ${sampleDevices.length} ‰∏™Á§∫‰æãËÆæÂ§á`);\n  } catch (error) {\n    console.error('ÂàùÂßãÂåñÁ§∫‰æãËÆæÂ§áÂ§±Ë¥•:', error);\n    throw error;\n  }\n}\n\n// Â¶ÇÊûúÁõ¥Êé•ËøêË°åÊ≠§ËÑöÊú¨\nif (import.meta.url === `file://${process.argv[1]}`) {\n  initSampleDevices()\n    .then(() => {\n      console.log('Á§∫‰æãËÆæÂ§áÂàùÂßãÂåñÂÆåÊàê');\n      process.exit(0);\n    })\n    .catch((error) => {\n      console.error('Á§∫‰æãËÆæÂ§áÂàùÂßãÂåñÂ§±Ë¥•:', error);\n      process.exit(1);\n    });\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/scripts/migration-manager.js","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'crypto' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":14},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":35,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":35,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[824,857],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":49,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":49,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1058,1086],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":61,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":61,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1297,1327],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":69,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":69,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1525,1572],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":170,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":170,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[3520,3560],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":195,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":195,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[4014,4041],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":202,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":202,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[4170,4195],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":217,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":217,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[4410,4439],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":239,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":239,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[4973,5000],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 14.","line":253,"column":17,"nodeType":"Literal","messageId":"noMagic","endLine":253,"endColumn":19},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":261,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":261,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[5546,5584],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":262,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":262,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[5589,5623],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":364,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":364,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[7556,7587],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":374,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":374,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[7785,7811],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":378,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":378,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[7843,7900],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":401,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":401,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[8544,8596],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":414,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":414,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[8773,8804],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":424,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":424,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[9005,9031],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":452,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":452,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[9953,10010],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":462,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":462,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[10203,10260],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":473,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":473,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[10382,10410],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":478,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":478,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[10545,10573],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":479,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":479,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[10578,10606],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":479,"column":28,"nodeType":"Literal","messageId":"noMagic","endLine":479,"endColumn":30},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":488,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":488,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[10961,11016],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":491,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":491,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[11028,11056],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":491,"column":28,"nodeType":"Literal","messageId":"noMagic","endLine":491,"endColumn":30},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":492,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":492,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[11061,11108],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":493,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":493,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[11113,11164],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":494,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":494,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[11169,11243],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":503,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":503,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[11341,11371],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":508,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":508,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[11471,11497],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":512,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":512,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[11523,11570],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":518,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":518,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[11659,11707],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":525,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":525,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[11758,11785],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":535,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":535,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[11982,12036],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":548,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":548,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[12276,12301],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":602,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":602,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[13445,13487],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":621,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":621,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[13898,13941],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":623,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":623,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[13970,14033],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":632,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":632,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[14131,14173],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":657,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":657,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[14736,14779],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":659,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":659,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[14808,14871],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":692,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":692,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[15491,15532],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":705,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":705,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[15809,15851],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":707,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":707,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[15880,15942],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":766,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":766,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[16956,16984],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":770,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":770,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[17017,17045],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":778,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":778,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[17167,17203],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":783,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":783,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[17279,17315],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'changes' is defined but never used. Allowed unused args must match /^_/u.","line":786,"column":31,"nodeType":"Identifier","messageId":"unusedVar","endLine":786,"endColumn":38},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":787,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":787,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[17366,17402],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"prefer-destructuring","severity":2,"message":"Use array destructuring.","line":873,"column":9,"nodeType":"VariableDeclarator","messageId":"preferDestructuring","endLine":873,"endColumn":26},{"ruleId":"no-inner-declarations","severity":2,"message":"Move function declaration to program root.","line":877,"column":3,"nodeType":"FunctionDeclaration","messageId":"moveDeclToRoot","endLine":957,"endColumn":4},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":883,"column":11,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":883,"endColumn":32},{"ruleId":"prefer-destructuring","severity":2,"message":"Use array destructuring.","line":883,"column":17,"nodeType":"VariableDeclarator","messageId":"preferDestructuring","endLine":883,"endColumn":31},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":885,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":885,"endColumn":26,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[19628,19741],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":891,"column":11,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":891,"endColumn":30},{"ruleId":"prefer-destructuring","severity":2,"message":"Use array destructuring.","line":894,"column":15,"nodeType":"AssignmentExpression","messageId":"preferDestructuring","endLine":894,"endColumn":48},{"ruleId":"prefer-destructuring","severity":2,"message":"Use array destructuring.","line":897,"column":15,"nodeType":"AssignmentExpression","messageId":"preferDestructuring","endLine":897,"endColumn":49},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":906,"column":11,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":906,"endColumn":37},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":916,"column":11,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":916,"endColumn":38},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":929,"column":11,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":929,"endColumn":34},{"ruleId":"prefer-destructuring","severity":2,"message":"Use array destructuring.","line":931,"column":13,"nodeType":"AssignmentExpression","messageId":"preferDestructuring","endLine":931,"endColumn":43},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":941,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":941,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[21193,21512],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":952,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":952,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[21549,21593],"text":""},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":13,"fatalErrorCount":0,"warningCount":54,"fixableErrorCount":0,"fixableWarningCount":0,"source":"#!/usr/bin/env node\n\nimport fs from 'fs';\nimport path from 'path';\nimport { fileURLToPath } from 'url';\nimport crypto from 'crypto';\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\n\n/**\n * Êï∞ÊçÆÂ∫ìËøÅÁßªÁÆ°ÁêÜÂô®\n * ÊîØÊåÅÁâàÊú¨ÊéßÂà∂„ÄÅËá™Âä®ËøÅÁßª„ÄÅÂõûÊªöÁ≠âÂäüËÉΩ\n */\nclass MigrationManager {\n  constructor(options = {}) {\n    this.options = {\n      projectRoot: options.projectRoot || path.resolve(__dirname, '..'),\n      migrationsDir: options.migrationsDir || 'migrations',\n      seedsDir: options.seedsDir || 'seeds',\n      configFile: options.configFile || 'migration.config.js',\n      tableName: options.tableName || 'migrations',\n      lockTable: options.lockTable || 'migration_lock',\n      ...options,\n    };\n\n    this.db = null;\n    this.config = null;\n  }\n\n  /**\n   * ÂàùÂßãÂåñËøÅÁßªÁÆ°ÁêÜÂô®\n   */\n  async initialize() {\n    console.log('üîß ÂàùÂßãÂåñÊï∞ÊçÆÂ∫ìËøÅÁßªÁÆ°ÁêÜÂô®...');\n\n    // Âä†ËΩΩÈÖçÁΩÆ\n    await this.loadConfig();\n\n    // ÂàõÂª∫ÂøÖË¶ÅÁõÆÂΩï\n    await this.createDirectories();\n\n    // ËøûÊé•Êï∞ÊçÆÂ∫ì\n    await this.connectDatabase();\n\n    // ÂàõÂª∫ËøÅÁßªË°®\n    await this.createMigrationTables();\n\n    console.log('‚úÖ ËøÅÁßªÁÆ°ÁêÜÂô®ÂàùÂßãÂåñÂÆåÊàê');\n  }\n\n  /**\n   * Âä†ËΩΩÈÖçÁΩÆ\n   */\n  async loadConfig() {\n    const configPath = path.join(this.options.projectRoot, this.options.configFile);\n\n    try {\n      await fs.promises.access(configPath);\n    } catch {\n      console.log('üìù ÂàõÂª∫ÈªòËÆ§ËøÅÁßªÈÖçÁΩÆ...');\n      await this.createDefaultConfig(configPath);\n    }\n\n    try {\n      const configModule = await import(`file://${configPath}`);\n      this.config = configModule.default || configModule;\n\n      console.log(`‚úÖ ÈÖçÁΩÆÂä†ËΩΩÊàêÂäü: ${this.config.client}`);\n    } catch (error) {\n      throw new Error(`Âä†ËΩΩËøÅÁßªÈÖçÁΩÆÂ§±Ë¥•: ${error.message}`);\n    }\n  }\n\n  /**\n   * ÂàõÂª∫ÈªòËÆ§ÈÖçÁΩÆ\n   */\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 85 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 85 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 85 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 85 Ë°å)\n\n  async createDefaultConfig(configPath) {\n    const defaultConfig = `export default {\n  // Êï∞ÊçÆÂ∫ìÁ±ªÂûã\n  client: 'sqlite3',\n  \n  // ËøûÊé•ÈÖçÁΩÆ\n  connection: {\n    // SQLiteÈÖçÁΩÆ\n    filename: './database.sqlite',\n    \n    // MySQL/PostgreSQLÈÖçÁΩÆÁ§∫‰æã\n    // host: 'localhost',\n    // port: 3306,\n    // user: 'root',\n    // password: process.env.DB_PASSWORD || 'default',\n    // database: 'carbon_management'\n  },\n  \n  // ËøûÊé•Ê±†ÈÖçÁΩÆ\n  pool: {\n    min: 2,\n    max: 10,\n    acquireTimeoutMillis: 30000,\n    createTimeoutMillis: 30000,\n    destroyTimeoutMillis: 5000,\n    idleTimeoutMillis: 30000,\n    reapIntervalMillis: 1000,\n    createRetryIntervalMillis: 100\n  },\n  \n  // ËøÅÁßªÈÖçÁΩÆ\n  migrations: {\n    tableName: 'migrations',\n    directory: './migrations',\n    extension: 'js',\n    loadExtensions: ['.js'],\n    sortDirsSeparately: false\n  },\n  \n  // ÁßçÂ≠êÊï∞ÊçÆÈÖçÁΩÆ\n  seeds: {\n    directory: './seeds',\n    extension: 'js',\n    loadExtensions: ['.js']\n  },\n  \n  // ÁéØÂ¢ÉÈÖçÁΩÆ\n  environments: {\n    development: {\n      client: 'sqlite3',\n      connection: {\n        filename: './dev.sqlite'\n      },\n      useNullAsDefault: true\n    },\n    \n    test: {\n      client: 'sqlite3',\n      connection: {\n        filename: ':memory:'\n      },\n      useNullAsDefault: true\n    },\n    \n    production: {\n      client: 'mysql2',\n      connection: {\n        host: process.env.DB_HOST || 'localhost',\n        port: process.env.DB_PORT || 3306,\n        user: process.env.DB_USER || 'root',\n        password: process.env.DB_PASSWORD || '',\n        database: process.env.DB_NAME || 'carbon_management'\n      },\n      pool: {\n        min: 2,\n        max: 10\n      }\n    }\n  }\n};\n`;\n\n    await fs.promises.writeFile(configPath, defaultConfig);\n    console.log(`‚úÖ ÈªòËÆ§ÈÖçÁΩÆÂ∑≤ÂàõÂª∫: ${configPath}`);\n  }\n\n  /**\n   * ÂàõÂª∫ÂøÖË¶ÅÁõÆÂΩï\n   */\n  async createDirectories() {\n    const dirs = [\n      path.join(this.options.projectRoot, this.options.migrationsDir),\n      path.join(this.options.projectRoot, this.options.seedsDir),\n    ];\n\n    for (const dir of dirs) {\n      try {\n        await fs.promises.access(dir);\n      } catch {\n        await fs.promises.mkdir(dir, { recursive: true });\n      }\n    }\n  }\n\n  /**\n   * ËøûÊé•Êï∞ÊçÆÂ∫ì\n   */\n  async connectDatabase() {\n    console.log('üîå ËøûÊé•Êï∞ÊçÆÂ∫ì...');\n\n    // ËøôÈáåÂ∫îËØ•Ê†πÊçÆÈÖçÁΩÆËøûÊé•ÂÆûÈôÖÊï∞ÊçÆÂ∫ì\n    // ‰∏∫‰∫ÜÊºîÁ§∫ÔºåÊàë‰ª¨‰ΩøÁî®Ê®°ÊãüÁöÑÊï∞ÊçÆÂ∫ìËøûÊé•\n    this.db = new MockDatabase(this.config);\n    await this.db.connect();\n\n    console.log('‚úÖ Êï∞ÊçÆÂ∫ìËøûÊé•ÊàêÂäü');\n  }\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 25 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 25 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 25 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 25 Ë°å)\n\n  /**\n   * ÂàõÂª∫ËøÅÁßªË°®\n   */\n  async createMigrationTables() {\n    console.log('üìã ÂàõÂª∫ËøÅÁßªÁÆ°ÁêÜË°®...');\n\n    // ÂàõÂª∫ËøÅÁßªËÆ∞ÂΩïË°®\n    await this.db.createTable(this.options.tableName, {\n      id: 'INTEGER PRIMARY KEY AUTOINCREMENT',\n      name: 'VARCHAR(255) NOT NULL',\n      batch: 'INTEGER NOT NULL',\n      migration_time: 'DATETIME DEFAULT CURRENT_TIMESTAMP',\n    });\n\n    // ÂàõÂª∫ËøÅÁßªÈîÅË°®\n    await this.db.createTable(this.options.lockTable, {\n      index: 'INTEGER PRIMARY KEY',\n      is_locked: 'INTEGER DEFAULT 0',\n    });\n\n    // ÂàùÂßãÂåñÈîÅËÆ∞ÂΩï\n    await this.db.insertOrIgnore(this.options.lockTable, {\n      index: 1,\n      is_locked: 0,\n    });\n\n    console.log('‚úÖ ËøÅÁßªÁÆ°ÁêÜË°®ÂàõÂª∫ÂÆåÊàê');\n  }\n\n  /**\n   * ÂàõÂª∫Êñ∞ËøÅÁßª\n   */\n  async createMigration(name, options = {}) {\n    if (!name) {\n      throw new Error('ËøÅÁßªÂêçÁß∞‰∏çËÉΩ‰∏∫Á©∫');\n    }\n\n    const timestamp = new Date()\n      .toISOString()\n      .replace(/[:.T-]/g, '')\n      .slice(0, 14);\n    const filename = `${timestamp}_${name.toLowerCase().replace(/\\s+/g, '_')}.js`;\n    const filepath = path.join(this.options.projectRoot, this.options.migrationsDir, filename);\n\n    const template = this.generateMigrationTemplate(name, options);\n\n    await fs.promises.writeFile(filepath, template);\n\n    console.log(`‚úÖ ËøÅÁßªÊñá‰ª∂Â∑≤ÂàõÂª∫: ${filename}`);\n    console.log(`üìÅ Ë∑ØÂæÑ: ${filepath}`);\n\n    return filepath;\n  }\n\n  /**\n   * ÁîüÊàêËøÅÁßªÊ®°Êùø\n   */\n  generateMigrationTemplate(name, options = {}) {\n    const { table, action = 'create' } = options;\n\n    let template = `/**\n * ËøÅÁßª: ${name}\n * ÂàõÂª∫Êó∂Èó¥: ${new Date().toISOString()}\n */\n\n`;\n\n    if (action === 'create' && table) {\n      template += `export async function up(db) {\n  // ÂàõÂª∫Ë°®: ${table}\n  await db.createTable('${table}', {\n    id: 'INTEGER PRIMARY KEY AUTOINCREMENT',\n    created_at: 'DATETIME DEFAULT CURRENT_TIMESTAMP',\n    updated_at: 'DATETIME DEFAULT CURRENT_TIMESTAMP'\n    // Ê∑ªÂä†ÂÖ∂‰ªñÂ≠óÊÆµ...\n  });\n  \n  console.log('‚úÖ Ë°® ${table} ÂàõÂª∫ÊàêÂäü');\n}\n\nexport async function down(db) {\n  // Âà†Èô§Ë°®: ${table}\n  await db.dropTable('${table}');\n  \n  console.log('‚úÖ Ë°® ${table} Âà†Èô§ÊàêÂäü');\n}\n`;\n    } else if (action === 'alter' && table) {\n      template += `export async function up(db) {\n  // ‰øÆÊîπË°®: ${table}\n  await db.alterTable('${table}', {\n    // Ê∑ªÂä†Âàó\n    // new_column: 'VARCHAR(255)'\n    \n    // ‰øÆÊîπÂàó\n    // existing_column: 'TEXT'\n  });\n  \n  console.log('‚úÖ Ë°® ${table} ‰øÆÊîπÊàêÂäü');\n}\n\nexport async function down(db) {\n  // ÂõûÊªöË°®‰øÆÊîπ: ${table}\n  await db.alterTable('${table}', {\n    // ÂõûÊªöÊìç‰Ωú...\n  });\n  \n  console.log('‚úÖ Ë°® ${table} ÂõûÊªöÊàêÂäü');\n}\n`;\n    } else {\n      template += `export async function up(db) {\n  // ÊâßË°åËøÅÁßªÊìç‰Ωú\n  console.log('ÊâßË°åËøÅÁßª: ${name}');\n  \n  // Á§∫‰æãÔºöÂàõÂª∫Ë°®\n  // await db.createTable('example_table', {\n  //   id: 'INTEGER PRIMARY KEY AUTOINCREMENT',\n  //   name: 'VARCHAR(255) NOT NULL',\n  //   created_at: 'DATETIME DEFAULT CURRENT_TIMESTAMP'\n  // });\n  \n  // Á§∫‰æãÔºöÊèíÂÖ•Êï∞ÊçÆ\n  // await db.insert('example_table', {\n  //   name: 'Example'\n  // });\n  \n  console.log('‚úÖ ËøÅÁßª ${name} ÊâßË°åÊàêÂäü');\n}\n\nexport async function down(db) {\n  // ÂõûÊªöËøÅÁßªÊìç‰Ωú\n  console.log('ÂõûÊªöËøÅÁßª: ${name}');\n  \n  // Á§∫‰æãÔºöÂà†Èô§Ë°®\n  // await db.dropTable('example_table');\n  \n  console.log('‚úÖ ËøÅÁßª ${name} ÂõûÊªöÊàêÂäü');\n}\n`;\n    }\n\n    return template;\n  }\n\n  /**\n   * ËøêË°åËøÅÁßª\n   */\n  async migrate(options = {}) {\n    const { target, step } = options;\n\n    console.log('üöÄ ÂºÄÂßãÊâßË°åÊï∞ÊçÆÂ∫ìËøÅÁßª...');\n\n    try {\n      // Ëé∑ÂèñËøÅÁßªÈîÅ\n      await this.acquireLock();\n\n      // Ëé∑ÂèñÂæÖÊâßË°åÁöÑËøÅÁßª\n      const pendingMigrations = await this.getPendingMigrations();\n\n      if (pendingMigrations.length === 0) {\n        console.log('‚úÖ Ê≤°ÊúâÂæÖÊâßË°åÁöÑËøÅÁßª');\n        return;\n      }\n\n      console.log(`üìã ÂèëÁé∞ ${pendingMigrations.length} ‰∏™ÂæÖÊâßË°åÁöÑËøÅÁßª`);\n\n      // Á°ÆÂÆöË¶ÅÊâßË°åÁöÑËøÅÁßª\n      let migrationsToRun = pendingMigrations;\n\n      if (target) {\n        const targetIndex = pendingMigrations.findIndex((m) => m.name.includes(target));\n        if (targetIndex === -1) {\n          throw new Error(`Êú™ÊâæÂà∞ÁõÆÊ†áËøÅÁßª: ${target}`);\n        }\n        migrationsToRun = pendingMigrations.slice(0, targetIndex + 1);\n      } else if (step) {\n        migrationsToRun = pendingMigrations.slice(0, step);\n      }\n\n      // Ëé∑Âèñ‰∏ã‰∏Ä‰∏™ÊâπÊ¨°Âè∑\n      const nextBatch = await this.getNextBatchNumber();\n\n      // ÊâßË°åËøÅÁßª\n      for (const migration of migrationsToRun) {\n        await this.runMigration(migration, nextBatch);\n      }\n\n      console.log(`‚úÖ ÊàêÂäüÊâßË°å ${migrationsToRun.length} ‰∏™ËøÅÁßª`);\n    } finally {\n      // ÈáäÊîæËøÅÁßªÈîÅ\n      await this.releaseLock();\n    }\n  }\n\n  /**\n   * ÂõûÊªöËøÅÁßª\n   */\n  async rollback(options = {}) {\n    const { target, step = 1 } = options;\n\n    console.log('üîÑ ÂºÄÂßãÂõûÊªöÊï∞ÊçÆÂ∫ìËøÅÁßª...');\n\n    try {\n      // Ëé∑ÂèñËøÅÁßªÈîÅ\n      await this.acquireLock();\n\n      // Ëé∑ÂèñÂ∑≤ÊâßË°åÁöÑËøÅÁßª\n      const executedMigrations = await this.getExecutedMigrations();\n\n      if (executedMigrations.length === 0) {\n        console.log('‚úÖ Ê≤°ÊúâÂèØÂõûÊªöÁöÑËøÅÁßª');\n        return;\n      }\n\n      // Á°ÆÂÆöË¶ÅÂõûÊªöÁöÑËøÅÁßª\n      let migrationsToRollback;\n\n      if (target) {\n        const targetIndex = executedMigrations.findIndex((m) => m.name.includes(target));\n        if (targetIndex === -1) {\n          throw new Error(`Êú™ÊâæÂà∞ÁõÆÊ†áËøÅÁßª: ${target}`);\n        }\n        migrationsToRollback = executedMigrations.slice(0, targetIndex + 1);\n      } else {\n        // Ëé∑ÂèñÊúÄÂêé‰∏Ä‰∏™ÊâπÊ¨°ÁöÑËøÅÁßª\n        const lastBatch = Math.max(...executedMigrations.map((m) => m.batch));\n        migrationsToRollback = executedMigrations.filter((m) => m.batch === lastBatch);\n\n        if (step > 1) {\n          // Â¶ÇÊûúÊåáÂÆö‰∫ÜÊ≠•Êï∞ÔºåËé∑ÂèñÊõ¥Â§öÊâπÊ¨°\n          const batches = [...new Set(executedMigrations.map((m) => m.batch))].sort(\n            (a, b) => b - a\n          );\n          const targetBatches = batches.slice(0, step);\n          migrationsToRollback = executedMigrations.filter((m) => targetBatches.includes(m.batch));\n        }\n      }\n\n      console.log(`üìã Â∞ÜÂõûÊªö ${migrationsToRollback.length} ‰∏™ËøÅÁßª`);\n\n      // ÊåâÊâßË°åÈ°∫Â∫èÁöÑÈÄÜÂ∫èÂõûÊªö\n      migrationsToRollback.reverse();\n\n      // ÊâßË°åÂõûÊªö\n      for (const migration of migrationsToRollback) {\n        await this.rollbackMigration(migration);\n      }\n\n      console.log(`‚úÖ ÊàêÂäüÂõûÊªö ${migrationsToRollback.length} ‰∏™ËøÅÁßª`);\n    } finally {\n      // ÈáäÊîæËøÅÁßªÈîÅ\n      await this.releaseLock();\n    }\n  }\n\n  /**\n   * Ëé∑ÂèñËøÅÁßªÁä∂ÊÄÅ\n   */\n  async status() {\n    console.log('üìä Ê£ÄÊü•ËøÅÁßªÁä∂ÊÄÅ...');\n\n    const allMigrations = await this.getAllMigrationFiles();\n    const executedMigrations = await this.getExecutedMigrations();\n\n    console.log('\\nüìã ËøÅÁßªÁä∂ÊÄÅÊä•Âëä:');\n    console.log('='.repeat(60));\n\n    const executedNames = new Set(executedMigrations.map((m) => m.name));\n\n    for (const migration of allMigrations) {\n      const status = executedNames.has(migration.name) ? '‚úÖ Â∑≤ÊâßË°å' : '‚è≥ ÂæÖÊâßË°å';\n      const executed = executedMigrations.find((m) => m.name === migration.name);\n      const batchInfo = executed ? ` (ÊâπÊ¨°: ${executed.batch})` : '';\n\n      console.log(`${status} ${migration.name}${batchInfo}`);\n    }\n\n    console.log('='.repeat(60));\n    console.log(`ÊÄªËÆ°: ${allMigrations.length} ‰∏™ËøÅÁßª`);\n    console.log(`Â∑≤ÊâßË°å: ${executedMigrations.length} ‰∏™`);\n    console.log(`ÂæÖÊâßË°å: ${allMigrations.length - executedMigrations.length} ‰∏™`);\n  }\n\n  /**\n   * ËøêË°åÁßçÂ≠êÊï∞ÊçÆ\n   */\n  async seed(options = {}) {\n    const { specific } = options;\n\n    console.log('üå± ÂºÄÂßãËøêË°åÁßçÂ≠êÊï∞ÊçÆ...');\n\n    const seedFiles = await this.getSeedFiles(specific);\n\n    if (seedFiles.length === 0) {\n      console.log('‚úÖ Ê≤°ÊúâÊâæÂà∞ÁßçÂ≠êÊñá‰ª∂');\n      return;\n    }\n\n    console.log(`üìã ÂèëÁé∞ ${seedFiles.length} ‰∏™ÁßçÂ≠êÊñá‰ª∂`);\n\n    for (const seedFile of seedFiles) {\n      await this.runSeed(seedFile);\n    }\n\n    console.log(`‚úÖ ÊàêÂäüËøêË°å ${seedFiles.length} ‰∏™ÁßçÂ≠êÊñá‰ª∂`);\n  }\n\n  /**\n   * ÈáçÁΩÆÊï∞ÊçÆÂ∫ì\n   */\n  async reset() {\n    console.log('üîÑ ÈáçÁΩÆÊï∞ÊçÆÂ∫ì...');\n\n    try {\n      // Ëé∑ÂèñËøÅÁßªÈîÅ\n      await this.acquireLock();\n\n      // ÂõûÊªöÊâÄÊúâËøÅÁßª\n      const executedMigrations = await this.getExecutedMigrations();\n\n      if (executedMigrations.length > 0) {\n        console.log(`üìã ÂõûÊªö ${executedMigrations.length} ‰∏™ËøÅÁßª`);\n\n        // ÊåâÊâßË°åÈ°∫Â∫èÁöÑÈÄÜÂ∫èÂõûÊªö\n        executedMigrations.reverse();\n\n        for (const migration of executedMigrations) {\n          await this.rollbackMigration(migration);\n        }\n      }\n\n      // ÈáçÊñ∞ËøêË°åÊâÄÊúâËøÅÁßª\n      await this.migrate();\n\n      console.log('‚úÖ Êï∞ÊçÆÂ∫ìÈáçÁΩÆÂÆåÊàê');\n    } finally {\n      // ÈáäÊîæËøÅÁßªÈîÅ\n      await this.releaseLock();\n    }\n  }\n\n  /**\n   * Ëé∑ÂèñÂæÖÊâßË°åÁöÑËøÅÁßª\n   */\n  async getPendingMigrations() {\n    const allMigrations = await this.getAllMigrationFiles();\n    const executedMigrations = await this.getExecutedMigrations();\n\n    const executedNames = new Set(executedMigrations.map((m) => m.name));\n\n    return allMigrations.filter((migration) => !executedNames.has(migration.name));\n  }\n\n  /**\n   * Ëé∑ÂèñÂ∑≤ÊâßË°åÁöÑËøÅÁßª\n   */\n  async getExecutedMigrations() {\n    return await this.db.select(this.options.tableName, {\n      orderBy: 'migration_time DESC',\n    });\n  }\n\n  /**\n   * Ëé∑ÂèñÊâÄÊúâËøÅÁßªÊñá‰ª∂\n   */\n  async getAllMigrationFiles() {\n    const migrationsDir = path.join(this.options.projectRoot, this.options.migrationsDir);\n\n    try {\n      await fs.promises.access(migrationsDir);\n    } catch {\n      return [];\n    }\n\n    const files = (await fs.promises.readdir(migrationsDir))\n      .filter((file) => file.endsWith('.js'))\n      .sort();\n\n    return files.map((file) => ({\n      name: file,\n      path: path.join(migrationsDir, file),\n    }));\n  }\n\n  /**\n   * ËøêË°åÂçï‰∏™ËøÅÁßª\n   */\n  async runMigration(migration, batch) {\n    console.log(`   ÊâßË°åËøÅÁßª: ${migration.name}`);\n\n    try {\n      // Âä®ÊÄÅÂØºÂÖ•ËøÅÁßªÊñá‰ª∂\n      const migrationModule = await import(`file://${migration.path}`);\n\n      if (typeof migrationModule.up !== 'function') {\n        throw new Error(`ËøÅÁßªÊñá‰ª∂ ${migration.name} Áº∫Â∞ë up ÂáΩÊï∞`);\n      }\n\n      // ÊâßË°åËøÅÁßª\n      await migrationModule.up(this.db);\n\n      // ËÆ∞ÂΩïËøÅÁßª\n      await this.db.insert(this.options.tableName, {\n        name: migration.name,\n        batch,\n      });\n\n      console.log(`   ‚úÖ ${migration.name} ÊâßË°åÊàêÂäü`);\n    } catch (error) {\n      console.error(`   ‚ùå ${migration.name} ÊâßË°åÂ§±Ë¥•: ${error.message}`);\n      throw error;\n    }\n  }\n\n  /**\n   * ÂõûÊªöÂçï‰∏™ËøÅÁßª\n   */\n  async rollbackMigration(migration) {\n    console.log(`   ÂõûÊªöËøÅÁßª: ${migration.name}`);\n\n    try {\n      // ÊûÑÂª∫ËøÅÁßªÊñá‰ª∂Ë∑ØÂæÑ\n      const migrationPath = path.join(\n        this.options.projectRoot,\n        this.options.migrationsDir,\n        migration.name\n      );\n\n      // Âä®ÊÄÅÂØºÂÖ•ËøÅÁßªÊñá‰ª∂\n      const migrationModule = await import(`file://${migrationPath}`);\n\n      if (typeof migrationModule.down !== 'function') {\n        throw new Error(`ËøÅÁßªÊñá‰ª∂ ${migration.name} Áº∫Â∞ë down ÂáΩÊï∞`);\n      }\n\n      // ÊâßË°åÂõûÊªö\n      await migrationModule.down(this.db);\n\n      // Âà†Èô§ËøÅÁßªËÆ∞ÂΩï\n      await this.db.delete(this.options.tableName, {\n        name: migration.name,\n      });\n\n      console.log(`   ‚úÖ ${migration.name} ÂõûÊªöÊàêÂäü`);\n    } catch (error) {\n      console.error(`   ‚ùå ${migration.name} ÂõûÊªöÂ§±Ë¥•: ${error.message}`);\n      throw error;\n    }\n  }\n\n  /**\n   * Ëé∑ÂèñÁßçÂ≠êÊñá‰ª∂\n   */\n  async getSeedFiles(specific = null) {\n    const seedsDir = path.join(this.options.projectRoot, this.options.seedsDir);\n\n    try {\n      await fs.promises.access(seedsDir);\n    } catch {\n      return [];\n    }\n\n    let files = (await fs.promises.readdir(seedsDir)).filter((file) => file.endsWith('.js')).sort();\n\n    if (specific) {\n      files = files.filter((file) => file.includes(specific));\n    }\n\n    return files.map((file) => ({\n      name: file,\n      path: path.join(seedsDir, file),\n    }));\n  }\n\n  /**\n   * ËøêË°åÁßçÂ≠êÊñá‰ª∂\n   */\n  async runSeed(seedFile) {\n    console.log(`   ËøêË°åÁßçÂ≠ê: ${seedFile.name}`);\n\n    try {\n      // Âä®ÊÄÅÂØºÂÖ•ÁßçÂ≠êÊñá‰ª∂\n      const seedModule = await import(`file://${seedFile.path}`);\n\n      if (typeof seedModule.seed !== 'function') {\n        throw new Error(`ÁßçÂ≠êÊñá‰ª∂ ${seedFile.name} Áº∫Â∞ë seed ÂáΩÊï∞`);\n      }\n\n      // ÊâßË°åÁßçÂ≠ê\n      await seedModule.seed(this.db);\n\n      console.log(`   ‚úÖ ${seedFile.name} ËøêË°åÊàêÂäü`);\n    } catch (error) {\n      console.error(`   ‚ùå ${seedFile.name} ËøêË°åÂ§±Ë¥•: ${error.message}`);\n      throw error;\n    }\n  }\n\n  /**\n   * Ëé∑Âèñ‰∏ã‰∏Ä‰∏™ÊâπÊ¨°Âè∑\n   */\n  async getNextBatchNumber() {\n    const result = await this.db.select(this.options.tableName, {\n      select: 'MAX(batch) as max_batch',\n    });\n\n    const maxBatch = result[0]?.max_batch || 0;\n    return maxBatch + 1;\n  }\n\n  /**\n   * Ëé∑ÂèñËøÅÁßªÈîÅ\n   */\n  async acquireLock() {\n    const lockResult = await this.db.select(this.options.lockTable, {\n      where: { index: 1 },\n    });\n\n    if (lockResult[0]?.is_locked) {\n      throw new Error('ËøÅÁßªÊ≠£Âú®ËøõË°å‰∏≠ÔºåËØ∑Á®çÂêéÂÜçËØï');\n    }\n\n    await this.db.update(this.options.lockTable, { is_locked: 1 }, { index: 1 });\n  }\n\n  /**\n   * ÈáäÊîæËøÅÁßªÈîÅ\n   */\n  async releaseLock() {\n    await this.db.update(this.options.lockTable, { is_locked: 0 }, { index: 1 });\n  }\n\n  /**\n   * Ê∏ÖÁêÜËµÑÊ∫ê\n   */\n  async cleanup() {\n    if (this.db) {\n      await this.db.disconnect();\n    }\n  }\n}\n\n/**\n * Ê®°ÊãüÊï∞ÊçÆÂ∫ìÁ±ªÔºàÂÆûÈôÖ‰ΩøÁî®Êó∂Â∫îËØ•ÊõøÊç¢‰∏∫ÁúüÂÆûÁöÑÊï∞ÊçÆÂ∫ìËøûÊé•Ôºâ\n */\nclass MockDatabase {\n  constructor(config) {\n    this.config = config;\n    this.tables = new Map();\n  }\n\n  async connect() {\n    console.log('   Ê®°ÊãüÊï∞ÊçÆÂ∫ìËøûÊé•ÊàêÂäü');\n  }\n\n  async disconnect() {\n    console.log('   Ê®°ÊãüÊï∞ÊçÆÂ∫ìËøûÊé•ÂÖ≥Èó≠');\n  }\n\n  async createTable(tableName, schema) {\n    this.tables.set(tableName, {\n      schema,\n      data: [],\n    });\n    console.log(`   ÂàõÂª∫Ë°®: ${tableName}`);\n  }\n\n  async dropTable(tableName) {\n    this.tables.delete(tableName);\n    console.log(`   Âà†Èô§Ë°®: ${tableName}`);\n  }\n\n  async alterTable(tableName, changes) {\n    console.log(`   ‰øÆÊîπË°®: ${tableName}`);\n  }\n\n  async insert(tableName, data) {\n    if (!this.tables.has(tableName)) {\n      throw new Error(`Ë°®‰∏çÂ≠òÂú®: ${tableName}`);\n    }\n\n    const table = this.tables.get(tableName);\n    const record = {\n      id: table.data.length + 1,\n      ...data,\n      migration_time: new Date().toISOString(),\n    };\n\n    table.data.push(record);\n    return record;\n  }\n\n  async insertOrIgnore(tableName, data) {\n    try {\n      return await this.insert(tableName, data);\n    } catch (error) {\n      // ÂøΩÁï•ÈîôËØØ\n    }\n  }\n\n  async select(tableName, options = {}) {\n    if (!this.tables.has(tableName)) {\n      return [];\n    }\n\n    const table = this.tables.get(tableName);\n    let result = [...table.data];\n\n    // ÁÆÄÂçïÁöÑÊü•ËØ¢ÂÆûÁé∞\n    if (options.where) {\n      result = result.filter((row) =>\n        Object.entries(options.where).every(([key, value]) => row[key] === value)\n      );\n    }\n\n    if (options.orderBy) {\n      const [field, direction = 'ASC'] = options.orderBy.split(' ');\n      result.sort((a, b) => {\n        if (direction.toUpperCase() === 'DESC') {\n          return b[field] > a[field] ? 1 : -1;\n        }\n        return a[field] > b[field] ? 1 : -1;\n      });\n    }\n\n    return result;\n  }\n\n  async update(tableName, data, where) {\n    if (!this.tables.has(tableName)) {\n      throw new Error(`Ë°®‰∏çÂ≠òÂú®: ${tableName}`);\n    }\n\n    const table = this.tables.get(tableName);\n\n    table.data.forEach((row) => {\n      const matches = Object.entries(where).every(([key, value]) => row[key] === value);\n      if (matches) {\n        Object.assign(row, data);\n      }\n    });\n  }\n\n  async delete(tableName, where) {\n    if (!this.tables.has(tableName)) {\n      throw new Error(`Ë°®‰∏çÂ≠òÂú®: ${tableName}`);\n    }\n\n    const table = this.tables.get(tableName);\n\n    table.data = table.data.filter(\n      (row) => !Object.entries(where).every(([key, value]) => row[key] === value)\n    );\n  }\n}\n\n// ÂëΩ‰ª§Ë°åÊé•Âè£\nif (import.meta.url === `file://${process.argv[1]}`) {\n  const args = process.argv.slice(2);\n  const command = args[0];\n\n  const manager = new MigrationManager();\n\n  async function main() {\n    try {\n      await manager.initialize();\n\n      switch (command) {\n        case 'create':\n          const name = args[1];\n          if (!name) {\n            console.error(\n              'ËØ∑ÊåáÂÆöËøÅÁßªÂêçÁß∞: create <name> [--table=table_name] [--action=create|alter]'\n            );\n            process.exit(1);\n          }\n\n          const options = {};\n          args.slice(2).forEach((arg) => {\n            if (arg.startsWith('--table=')) {\n              options.table = arg.split('=')[1];\n            }\n            if (arg.startsWith('--action=')) {\n              options.action = arg.split('=')[1];\n            }\n          });\n\n          await manager.createMigration(name, options);\n          break;\n\n        case 'migrate':\n        case 'up':\n          const migrateOptions = {};\n          if (args.includes('--step')) {\n            const stepIndex = args.indexOf('--step');\n            migrateOptions.step = parseInt(args[stepIndex + 1]) || 1;\n          }\n          await manager.migrate(migrateOptions);\n          break;\n\n        case 'rollback':\n        case 'down':\n          const rollbackOptions = {};\n          if (args.includes('--step')) {\n            const stepIndex = args.indexOf('--step');\n            rollbackOptions.step = parseInt(args[stepIndex + 1]) || 1;\n          }\n          await manager.rollback(rollbackOptions);\n          break;\n\n        case 'status':\n          await manager.status();\n          break;\n\n        case 'seed':\n          const seedOptions = {};\n          if (args[1]) {\n            seedOptions.specific = args[1];\n          }\n          await manager.seed(seedOptions);\n          break;\n\n        case 'reset':\n          await manager.reset();\n          break;\n\n        default:\n          console.log(`\n‰ΩøÁî®ÊñπÊ≥ï:\n  node migration-manager.js create <name> [--table=table_name] [--action=create|alter]\n  node migration-manager.js migrate [--step=n]\n  node migration-manager.js rollback [--step=n]\n  node migration-manager.js status\n  node migration-manager.js seed [seed_name]\n  node migration-manager.js reset\n`);\n      }\n    } catch (error) {\n      console.error(`\\n‚ùå Êìç‰ΩúÂ§±Ë¥•: ${error.message}`);\n      process.exit(1);\n    } finally {\n      await manager.cleanup();\n    }\n  }\n\n  main();\n}\n\nexport default MigrationManager;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/scripts/performance-monitor.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/scripts/quality-check.js","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":24,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":24,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[398,447],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":46,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":46,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[932,974],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":59,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":59,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1363,1404],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":74,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":74,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1886,1925],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":84,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":84,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2076,2118],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'result' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":101,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":101,"endColumn":19},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":106,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":106,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2666,2707],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":110,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":110,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2819,2863],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":111,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":111,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2872,2930],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":122,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":122,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[3084,3130],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":154,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":154,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[3976,4023],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":158,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":158,"endColumn":24,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[4232,4307],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":171,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":171,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[4600,4643],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":186,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":186,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[4879,4921],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'result' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":189,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":189,"endColumn":19},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":195,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":195,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[5088,5127],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":198,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":198,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[5188,5223],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":199,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":199,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[5230,5268],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":207,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":207,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[5337,5379],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":225,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":225,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[5957,5997],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":282,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":282,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[7219,7261],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":300,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":300,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[7715,7756],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":316,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":316,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[7966,8008],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":335,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":335,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[8524,8579],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":342,"column":55,"nodeType":"Literal","messageId":"noMagic","endLine":342,"endColumn":59},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":344,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":344,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[8703,8752],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":345,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":345,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[8757,8803],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":348,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":348,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[8877,8928],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":351,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":351,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[8986,9049],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":353,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":353,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[9101,9140],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":358,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":358,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[9208,9278],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":360,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":360,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[9334,9378],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":365,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":365,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[9410,9453],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":366,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":366,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[9458,9516],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":367,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":367,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[9521,9583],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":368,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":368,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[9588,9644],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":375,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":375,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[9744,9787],"text":""},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":35,"fixableErrorCount":0,"fixableWarningCount":0,"source":"#!/usr/bin/env node\n\nimport { execSync } from 'child_process';\nimport fs from 'fs';\nimport path from 'path';\nimport chalk from 'chalk';\n\n/**\n * ‰ª£Á†ÅË¥®ÈáèÊ£ÄÊü•ËÑöÊú¨\n * ÈõÜÊàêESLint„ÄÅPrettier„ÄÅÊµãËØïÂíåÂÆâÂÖ®Ê£ÄÊü•\n */\nclass QualityChecker {\n  constructor() {\n    this.errors = [];\n    this.warnings = [];\n    this.projectRoot = process.cwd();\n    this.startTime = Date.now();\n  }\n\n  /**\n   * ËøêË°åÊâÄÊúâË¥®ÈáèÊ£ÄÊü•\n   */\n  async runAll() {\n    console.log(chalk.blue.bold('üîç ÂºÄÂßã‰ª£Á†ÅË¥®ÈáèÊ£ÄÊü•...\\n'));\n\n    try {\n      await this.checkDependencies();\n      await this.runPrettierCheck();\n      await this.runESLintCheck();\n      await this.runTests();\n      await this.runSecurityCheck();\n      await this.checkFileStructure();\n      await this.generateReport();\n    } catch (error) {\n      this.errors.push(`Ë¥®ÈáèÊ£ÄÊü•ËøáÁ®ã‰∏≠ÂèëÁîüÈîôËØØ: ${error.message}`);\n    }\n\n    this.printSummary();\n    process.exit(this.errors.length > 0 ? 1 : 0);\n  }\n\n  /**\n   * Ê£ÄÊü•‰æùËµñÈ°π\n   */\n  async checkDependencies() {\n    console.log(chalk.yellow('üì¶ Ê£ÄÊü•È°πÁõÆ‰æùËµñ...'));\n\n    try {\n      // Ê£ÄÊü•package.jsonÊòØÂê¶Â≠òÂú®\n      const packageJsonPath = path.join(this.projectRoot, 'package.json');\n      if (!fs.existsSync(packageJsonPath)) {\n        this.errors.push('package.json Êñá‰ª∂‰∏çÂ≠òÂú®');\n        return;\n      }\n\n      // Ê£ÄÊü•node_modulesÊòØÂê¶Â≠òÂú®\n      const nodeModulesPath = path.join(this.projectRoot, 'node_modules');\n      if (!fs.existsSync(nodeModulesPath)) {\n        console.log(chalk.yellow('  Ê≠£Âú®ÂÆâË£Ö‰æùËµñ...'));\n        execSync('npm install', { stdio: 'inherit' });\n      }\n\n      // Ê£ÄÊü•ÂÖ≥ÈîÆ‰æùËµñ\n      const packageJson = JSON.parse(fs.readFileSync(packageJsonPath, 'utf8'));\n      const requiredDeps = ['express', 'sqlite3', 'jest'];\n      const missingDeps = requiredDeps.filter(\n        (dep) => !packageJson.dependencies?.[dep] && !packageJson.devDependencies?.[dep]\n      );\n\n      if (missingDeps.length > 0) {\n        this.warnings.push(`Áº∫Â∞ëÊé®Ëçê‰æùËµñ: ${missingDeps.join(', ')}`);\n      }\n\n      console.log(chalk.green('  ‚úÖ ‰æùËµñÊ£ÄÊü•ÂÆåÊàê'));\n    } catch (error) {\n      this.errors.push(`‰æùËµñÊ£ÄÊü•Â§±Ë¥•: ${error.message}`);\n    }\n  }\n\n  /**\n   * ËøêË°åPrettierÊ†ºÂºèÊ£ÄÊü•\n   */\n  async runPrettierCheck() {\n    console.log(chalk.yellow('üé® Ê£ÄÊü•‰ª£Á†ÅÊ†ºÂºè...'));\n\n    try {\n      // Ê£ÄÊü•ÊòØÂê¶ÊúâPrettierÈÖçÁΩÆ\n      const prettierConfigExists = [\n        '.prettierrc',\n        '.prettierrc.json',\n        '.prettierrc.js',\n        'prettier.config.js',\n      ].some((config) => fs.existsSync(path.join(this.projectRoot, config)));\n\n      if (!prettierConfigExists) {\n        this.warnings.push('Êú™ÊâæÂà∞PrettierÈÖçÁΩÆÊñá‰ª∂');\n        return;\n      }\n\n      // ËøêË°åPrettierÊ£ÄÊü•\n      const result = execSync('npx prettier --check \"src/**/*.js\" \"tests/**/*.js\" \"*.js\"', {\n        encoding: 'utf8',\n        stdio: 'pipe',\n      });\n\n      console.log(chalk.green('  ‚úÖ ‰ª£Á†ÅÊ†ºÂºèÊ£ÄÊü•ÈÄöËøá'));\n    } catch (error) {\n      if (error.status === 1) {\n        this.warnings.push('‰ª£Á†ÅÊ†ºÂºè‰∏çÁ¨¶ÂêàPrettierËßÑËåÉ');\n        console.log(chalk.yellow('  ‚ö†Ô∏è  ‰ª£Á†ÅÊ†ºÂºèÈúÄË¶Å‰øÆÂ§ç'));\n        console.log(chalk.gray('  ËøêË°å \"npm run format\" Ëá™Âä®‰øÆÂ§çÊ†ºÂºèÈóÆÈ¢ò'));\n      } else {\n        this.errors.push(`PrettierÊ£ÄÊü•Â§±Ë¥•: ${error.message}`);\n      }\n    }\n  }\n\n  /**\n   * ËøêË°åESLintÊ£ÄÊü•\n   */\n  async runESLintCheck() {\n    console.log(chalk.yellow('üîß ËøêË°åESLintÊ£ÄÊü•...'));\n\n    try {\n      // Ê£ÄÊü•ESLintÈÖçÁΩÆ\n      const eslintConfigExists = [\n        '.eslintrc',\n        '.eslintrc.json',\n        '.eslintrc.js',\n        '.eslintrc.yml',\n        '.eslintrc.yaml',\n      ].some((config) => fs.existsSync(path.join(this.projectRoot, config)));\n\n      if (!eslintConfigExists) {\n        this.warnings.push('Êú™ÊâæÂà∞ESLintÈÖçÁΩÆÊñá‰ª∂');\n        return;\n      }\n\n      // ËøêË°åESLint\n      const result = execSync('npx eslint \"src/**/*.js\" \"tests/**/*.js\" \"*.js\" --format=json', {\n        encoding: 'utf8',\n        stdio: 'pipe',\n      });\n\n      const eslintResults = JSON.parse(result);\n      let totalErrors = 0;\n      let totalWarnings = 0;\n\n      eslintResults.forEach((file) => {\n        totalErrors += file.errorCount;\n        totalWarnings += file.warningCount;\n\n        if (file.errorCount > 0 || file.warningCount > 0) {\n          console.log(chalk.gray(`  ${file.filePath}:`));\n          file.messages.forEach((message) => {\n            const level = message.severity === 2 ? 'error' : 'warning';\n            const color = message.severity === 2 ? chalk.red : chalk.yellow;\n            console.log(color(`    ${level}: ${message.message} (${message.ruleId})`));\n          });\n        }\n      });\n\n      if (totalErrors > 0) {\n        this.errors.push(`ESLintÂèëÁé∞ ${totalErrors} ‰∏™ÈîôËØØ`);\n      }\n      if (totalWarnings > 0) {\n        this.warnings.push(`ESLintÂèëÁé∞ ${totalWarnings} ‰∏™Ë≠¶Âëä`);\n      }\n\n      if (totalErrors === 0 && totalWarnings === 0) {\n        console.log(chalk.green('  ‚úÖ ESLintÊ£ÄÊü•ÈÄöËøá'));\n      }\n    } catch (error) {\n      if (error.status === 1) {\n        // ESLintÊâæÂà∞‰∫ÜÈóÆÈ¢òÔºå‰ΩÜËøôÂ∑≤ÁªèÂú®‰∏äÈù¢Â§ÑÁêÜ‰∫Ü\n      } else {\n        this.errors.push(`ESLintÊ£ÄÊü•Â§±Ë¥•: ${error.message}`);\n      }\n    }\n  }\n\n  /**\n   * ËøêË°åÊµãËØï\n   */\n  async runTests() {\n    console.log(chalk.yellow('üß™ ËøêË°åÊµãËØïÂ•ó‰ª∂...'));\n\n    try {\n      const result = execSync('npm test', {\n        encoding: 'utf8',\n        stdio: 'pipe',\n        env: { ...process.env, CI: 'true' },\n      });\n\n      console.log(chalk.green('  ‚úÖ ÊâÄÊúâÊµãËØïÈÄöËøá'));\n    } catch (error) {\n      this.errors.push('ÊµãËØïÂ§±Ë¥•');\n      console.log(chalk.red('  ‚ùå ÊµãËØïÂ§±Ë¥•'));\n      console.log(chalk.gray(error.stdout));\n    }\n  }\n\n  /**\n   * ËøêË°åÂÆâÂÖ®Ê£ÄÊü•\n   */\n  async runSecurityCheck() {\n    console.log(chalk.yellow('üîí ËøêË°åÂÆâÂÖ®Ê£ÄÊü•...'));\n\n    try {\n      // Ê£ÄÊü•npm audit\n      const auditResult = execSync('npm audit --audit-level=moderate --json', {\n        encoding: 'utf8',\n        stdio: 'pipe',\n      });\n\n      const audit = JSON.parse(auditResult);\n      if (audit.metadata.vulnerabilities.total > 0) {\n        const { high, critical } = audit.metadata.vulnerabilities;\n        if (high > 0 || critical > 0) {\n          this.errors.push(`ÂèëÁé∞ ${high} ‰∏™È´òÂç±Âíå ${critical} ‰∏™‰∏•ÈáçÂÆâÂÖ®ÊºèÊ¥û`);\n        } else {\n          this.warnings.push(`ÂèëÁé∞ ${audit.metadata.vulnerabilities.total} ‰∏™ÂÆâÂÖ®ÊºèÊ¥û`);\n        }\n      } else {\n        console.log(chalk.green('  ‚úÖ Êú™ÂèëÁé∞ÂÆâÂÖ®ÊºèÊ¥û'));\n      }\n    } catch (error) {\n      if (error.status === 1) {\n        // npm audit ÂèëÁé∞‰∫ÜÊºèÊ¥ûÔºå‰ΩÜËøôÂ∑≤ÁªèÂú®‰∏äÈù¢Â§ÑÁêÜ‰∫Ü\n      } else {\n        this.warnings.push('ÂÆâÂÖ®Ê£ÄÊü•Â§±Ë¥•ÔºåËØ∑ÊâãÂä®ËøêË°å npm audit');\n      }\n    }\n\n    // Ê£ÄÊü•ÊïèÊÑüÊñá‰ª∂\n    this.checkSensitiveFiles();\n  }\n\n  /**\n   * Ê£ÄÊü•ÊïèÊÑüÊñá‰ª∂\n   */\n  checkSensitiveFiles() {\n    const sensitivePatterns = [\n      /\\.env$/,\n      /\\.env\\./,\n      /private.*key/i,\n      /.*\\.pem$/,\n      /.*\\.p12$/,\n      /.*\\.pfx$/,\n      /config.*secret/i,\n    ];\n\n    const checkDirectory = (dir) => {\n      const files = fs.readdirSync(dir);\n      files.forEach((file) => {\n        const filePath = path.join(dir, file);\n        const stat = fs.statSync(filePath);\n\n        if (stat.isDirectory() && !file.startsWith('.') && file !== 'node_modules') {\n          checkDirectory(filePath);\n        } else if (stat.isFile()) {\n          sensitivePatterns.forEach((pattern) => {\n            if (pattern.test(file)) {\n              this.warnings.push(`ÂèëÁé∞ÊïèÊÑüÊñá‰ª∂: ${filePath}`);\n            }\n          });\n        }\n      });\n    };\n\n    try {\n      checkDirectory(this.projectRoot);\n    } catch (error) {\n      this.warnings.push(`ÊïèÊÑüÊñá‰ª∂Ê£ÄÊü•Â§±Ë¥•: ${error.message}`);\n    }\n  }\n\n  /**\n   * Ê£ÄÊü•Êñá‰ª∂ÁªìÊûÑ\n   */\n  async checkFileStructure() {\n    console.log(chalk.yellow('üìÅ Ê£ÄÊü•È°πÁõÆÁªìÊûÑ...'));\n\n    const requiredFiles = ['package.json', 'README.md', '.gitignore'];\n\n    const recommendedDirs = ['src', 'tests'];\n\n    requiredFiles.forEach((file) => {\n      if (!fs.existsSync(path.join(this.projectRoot, file))) {\n        this.warnings.push(`Áº∫Â∞ëÂøÖË¶ÅÊñá‰ª∂: ${file}`);\n      }\n    });\n\n    recommendedDirs.forEach((dir) => {\n      if (!fs.existsSync(path.join(this.projectRoot, dir))) {\n        this.warnings.push(`Áº∫Â∞ëÊé®ËçêÁõÆÂΩï: ${dir}`);\n      }\n    });\n\n    console.log(chalk.green('  ‚úÖ È°πÁõÆÁªìÊûÑÊ£ÄÊü•ÂÆåÊàê'));\n  }\n\n  /**\n   * ÁîüÊàêË¥®ÈáèÊä•Âëä\n   */\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 22 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 22 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 22 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 22 Ë°å)\n\n  async generateReport() {\n    console.log(chalk.yellow('üìä ÁîüÊàêË¥®ÈáèÊä•Âëä...'));\n\n    const report = {\n      timestamp: new Date().toISOString(),\n      duration: Date.now() - this.startTime,\n      summary: {\n        errors: this.errors.length,\n        warnings: this.warnings.length,\n        status: this.errors.length === 0 ? 'PASS' : 'FAIL',\n      },\n      details: {\n        errors: this.errors,\n        warnings: this.warnings,\n      },\n    };\n\n    const reportPath = path.join(this.projectRoot, 'quality-report.json');\n    fs.writeFileSync(reportPath, JSON.stringify(report, null, 2));\n\n    console.log(chalk.green(`  ‚úÖ Ë¥®ÈáèÊä•ÂëäÂ∑≤ÁîüÊàê: ${reportPath}`));\n  }\n\n  /**\n   * ÊâìÂç∞ÊÄªÁªì\n   */\n  printSummary() {\n    const duration = ((Date.now() - this.startTime) / 1000).toFixed(2);\n\n    console.log(`\\n${chalk.blue.bold('üìã Ë¥®ÈáèÊ£ÄÊü•ÊÄªÁªì')}`);\n    console.log(chalk.gray(`ÊâßË°åÊó∂Èó¥: ${duration}Áßí`));\n\n    if (this.errors.length === 0 && this.warnings.length === 0) {\n      console.log(chalk.green.bold('üéâ ÊâÄÊúâÊ£ÄÊü•ÈÄöËøáÔºÅ‰ª£Á†ÅË¥®ÈáèËâØÂ•Ω„ÄÇ'));\n    } else {\n      if (this.errors.length > 0) {\n        console.log(chalk.red.bold(`‚ùå ÂèëÁé∞ ${this.errors.length} ‰∏™ÈîôËØØ:`));\n        this.errors.forEach((error) => {\n          console.log(chalk.red(`  ‚Ä¢ ${error}`));\n        });\n      }\n\n      if (this.warnings.length > 0) {\n        console.log(chalk.yellow.bold(`‚ö†Ô∏è  ÂèëÁé∞ ${this.warnings.length} ‰∏™Ë≠¶Âëä:`));\n        this.warnings.forEach((warning) => {\n          console.log(chalk.yellow(`  ‚Ä¢ ${warning}`));\n        });\n      }\n    }\n\n    console.log(`\\n${chalk.blue('Âª∫ËÆÆÁöÑ‰øÆÂ§çÂëΩ‰ª§:')}`);\n    console.log(chalk.gray('  npm run format    # Ëá™Âä®‰øÆÂ§çÊ†ºÂºèÈóÆÈ¢ò'));\n    console.log(chalk.gray('  npm run lint:fix  # Ëá™Âä®‰øÆÂ§çESLintÈóÆÈ¢ò'));\n    console.log(chalk.gray('  npm audit fix     # ‰øÆÂ§çÂÆâÂÖ®ÊºèÊ¥û'));\n  }\n}\n\n// ESÊ®°Âùó‰∏≠Áõ¥Êé•ÊâßË°å‰∏ªÂáΩÊï∞\nconst checker = new QualityChecker();\nchecker.runAll().catch((error) => {\n  console.error(chalk.red('Ë¥®ÈáèÊ£ÄÊü•Â§±Ë¥•:'), error);\n  process.exit(1);\n});\n\nexport default QualityChecker;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/scripts/quality-enhancement.js","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":47,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":47,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1158,1205],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":58,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":58,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1477,1518],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":60,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":60,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[1547,1606],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":69,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":69,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1694,1737],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":97,"column":11,"nodeType":"Literal","messageId":"noMagic","endLine":97,"endColumn":14},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":102,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":102,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2647,2715],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":103,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":103,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2722,2788],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":104,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":104,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2795,2867],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":106,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":106,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2896,2934],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":115,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":115,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[3034,3079],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":128,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":128,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[3525,3588],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":129,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":129,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[3595,3665],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":133,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":133,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[3773,3818],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":146,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":146,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[4185,4228],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":148,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":148,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[4268,4315],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":152,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":152,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[4362,4400],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":161,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":161,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[4505,4550],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":173,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":173,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[4865,4947],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":181,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":181,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[5180,5223],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":182,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":182,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[5232,5315],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":184,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":184,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[5354,5400],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":187,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":187,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[5437,5489],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":195,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":195,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[5560,5606],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":206,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":206,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[6001,6076],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":207,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":207,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[6083,6154],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":208,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":208,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[6161,6273],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":212,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":212,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[6302,6341],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":231,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":231,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[6964,7039],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":232,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":232,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[7048,7119],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":234,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":234,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[7160,7201],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":243,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":243,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[7278,7322],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":252,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":252,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[7615,7677],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":253,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":253,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[7684,7749],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":264,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":264,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[8038,8112],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 3.","line":266,"column":23,"nodeType":"Literal","messageId":"noMagic","endLine":266,"endColumn":24},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":268,"column":15,"nodeType":"MemberExpression","messageId":"unexpected","endLine":268,"endColumn":26,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[8216,8343],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":273,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":273,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[8387,8430],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":276,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":276,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[8473,8516],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":279,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":279,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[8553,8591],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":287,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":287,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[8668,8712],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":299,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":299,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[9069,9158],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":300,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":300,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[9165,9251],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":302,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":302,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[9280,9318],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":320,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":320,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[9592,9637],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":339,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":339,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[10178,10232],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":340,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":340,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[10237,10319],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'score' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":347,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":347,"endColumn":16},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 30.","line":350,"column":57,"nodeType":"Literal","messageId":"noMagic","endLine":350,"endColumn":59},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":351,"column":58,"nodeType":"Literal","messageId":"noMagic","endLine":351,"endColumn":61},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 15.","line":351,"column":65,"nodeType":"Literal","messageId":"noMagic","endLine":351,"endColumn":67},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 25.","line":355,"column":40,"nodeType":"Literal","messageId":"noMagic","endLine":355,"endColumn":42},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 25.","line":355,"column":57,"nodeType":"Literal","messageId":"noMagic","endLine":355,"endColumn":59},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5.","line":355,"column":89,"nodeType":"Literal","messageId":"noMagic","endLine":355,"endColumn":90},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 20.","line":360,"column":11,"nodeType":"Literal","messageId":"noMagic","endLine":360,"endColumn":13},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 20.","line":361,"column":23,"nodeType":"Literal","messageId":"noMagic","endLine":361,"endColumn":25},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5.","line":365,"column":67,"nodeType":"Literal","messageId":"noMagic","endLine":365,"endColumn":68},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":371,"column":42,"nodeType":"Literal","messageId":"noMagic","endLine":371,"endColumn":44},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 15.","line":372,"column":11,"nodeType":"Literal","messageId":"noMagic","endLine":372,"endColumn":13},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 15.","line":373,"column":23,"nodeType":"Literal","messageId":"noMagic","endLine":373,"endColumn":25},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":373,"column":63,"nodeType":"Literal","messageId":"noMagic","endLine":373,"endColumn":65},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":377,"column":43,"nodeType":"Literal","messageId":"noMagic","endLine":377,"endColumn":46},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":377,"column":50,"nodeType":"Literal","messageId":"noMagic","endLine":377,"endColumn":52},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 80.","line":395,"column":39,"nodeType":"Literal","messageId":"noMagic","endLine":395,"endColumn":41},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":403,"column":38,"nodeType":"Literal","messageId":"noMagic","endLine":403,"endColumn":40},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 80.","line":413,"column":65,"nodeType":"Literal","messageId":"noMagic","endLine":413,"endColumn":67},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":418,"column":43,"nodeType":"Literal","messageId":"noMagic","endLine":418,"endColumn":45},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5.","line":424,"column":75,"nodeType":"Literal","messageId":"noMagic","endLine":424,"endColumn":76},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 70.","line":429,"column":70,"nodeType":"Literal","messageId":"noMagic","endLine":429,"endColumn":72},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":433,"column":71,"nodeType":"Literal","messageId":"noMagic","endLine":433,"endColumn":73},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 80.","line":467,"column":94,"nodeType":"Literal","messageId":"noMagic","endLine":467,"endColumn":96},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":467,"column":142,"nodeType":"Literal","messageId":"noMagic","endLine":467,"endColumn":144},{"ruleId":"prefer-destructuring","severity":2,"message":"Use array destructuring.","line":606,"column":9,"nodeType":"VariableDeclarator","messageId":"preferDestructuring","endLine":606,"endColumn":34},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":610,"column":33,"nodeType":"MemberExpression","messageId":"unexpected","endLine":610,"endColumn":46},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":613,"column":35,"nodeType":"MemberExpression","messageId":"unexpected","endLine":613,"endColumn":48},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":616,"column":41,"nodeType":"MemberExpression","messageId":"unexpected","endLine":616,"endColumn":54},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":619,"column":42,"nodeType":"MemberExpression","messageId":"unexpected","endLine":619,"endColumn":55},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":622,"column":49,"nodeType":"MemberExpression","messageId":"unexpected","endLine":622,"endColumn":62},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":626,"column":31,"nodeType":"MemberExpression","messageId":"unexpected","endLine":626,"endColumn":44}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":76,"fixableErrorCount":0,"fixableWarningCount":0,"source":"#!/usr/bin/env node\n\n/**\n * ‰ª£Á†ÅË¥®ÈáèÊèêÂçáËá™Âä®ÂåñËÑöÊú¨\n * ÊâßË°åÂêÑÁßç‰ª£Á†ÅË¥®ÈáèÊ£ÄÊü•ÂíåÊîπËøõ‰ªªÂä°\n */\n\nimport fs from 'fs';\nimport path from 'path';\nimport { fileURLToPath } from 'url';\nimport { execSync } from 'child_process';\n\n// ÂØºÂÖ•Êñ∞ÁöÑÂàÜÊûêÂ∑•ÂÖ∑\nimport ComplexityAnalyzer from './complexity-analyzer.js';\nimport SecurityAuditor from './security-auditor.js';\nimport PerformanceMonitor from './performance-monitor.js';\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\n\n// ÁÆÄÂçïÁöÑÈ¢úËâ≤ËæìÂá∫ÂáΩÊï∞\nconst colors = {\n  red: (text) => `\\x1b[31m${text}\\x1b[0m`,\n  green: (text) => `\\x1b[32m${text}\\x1b[0m`,\n  yellow: (text) => `\\x1b[33m${text}\\x1b[0m`,\n  blue: (text) => `\\x1b[34m${text}\\x1b[0m`,\n  magenta: (text) => `\\x1b[35m${text}\\x1b[0m`,\n  cyan: (text) => `\\x1b[36m${text}\\x1b[0m`,\n};\n\nclass QualityEnhancer {\n  constructor() {\n    this.projectRoot = path.resolve(__dirname, '..');\n    this.results = {\n      tests: { passed: 0, failed: 0, coverage: 0 },\n      lint: { errors: 0, warnings: 0 },\n      security: { vulnerabilities: 0 },\n      performance: { score: 0 },\n      complexity: { average: 0, max: 0 },\n    };\n  }\n\n  /**\n   * ÊâßË°åÊâÄÊúâË¥®ÈáèÊ£ÄÊü•\n   */\n  async runAll() {\n    console.log(colors.blue('üöÄ ÂºÄÂßã‰ª£Á†ÅË¥®ÈáèÊèêÂçáÊ£ÄÊü•...\\n'));\n\n    try {\n      await this.runTests();\n      await this.runLinting();\n      await this.runSecurityAudit();\n      await this.analyzeComplexity();\n      await this.checkDependencies();\n      await this.runPerformanceMonitoring();\n      await this.generateReport();\n\n      console.log(colors.green('‚úÖ ÊâÄÊúâË¥®ÈáèÊ£ÄÊü•ÂÆåÊàê!'));\n    } catch (error) {\n      console.error(colors.red('‚ùå Ë¥®ÈáèÊ£ÄÊü•ËøáÁ®ã‰∏≠Âá∫Áé∞ÈîôËØØ:'), error.message);\n      process.exit(1);\n    }\n  }\n\n  /**\n   * ËøêË°åÊµãËØïÂπ∂Êî∂ÈõÜË¶ÜÁõñÁéá\n   */\n  async runTests() {\n    console.log(colors.yellow('üìã ËøêË°åÊµãËØïÂ•ó‰ª∂...'));\n\n    try {\n      // ËøêË°åÂçïÂÖÉÊµãËØï\n      const testOutput = execSync(\n        'npx jest --config jest.simple.config.js tests/unit/ --coverage --json',\n        {\n          cwd: this.projectRoot,\n          encoding: 'utf8',\n        }\n      );\n\n      const testResults = JSON.parse(testOutput);\n      this.results.tests.passed = testResults.numPassedTests;\n      this.results.tests.failed = testResults.numFailedTests;\n\n      if (testResults.coverageMap) {\n        // ËÆ°ÁÆóÂπ≥ÂùáË¶ÜÁõñÁéá\n        const coverage =\n          (Object.values(testResults.coverageMap).reduce(\n            (acc, file) =>\n              acc +\n              (file.s\n                ? Object.values(file.s).filter(Boolean).length / Object.keys(file.s).length\n                : 0),\n            0\n          ) /\n            Object.keys(testResults.coverageMap).length) *\n          100;\n\n        this.results.tests.coverage = Math.round(coverage);\n      }\n\n      console.log(colors.green(`  ‚úì ÊµãËØïÈÄöËøá: ${this.results.tests.passed}`));\n      console.log(colors.red(`  ‚úó ÊµãËØïÂ§±Ë¥•: ${this.results.tests.failed}`));\n      console.log(colors.blue(`  üìä ‰ª£Á†ÅË¶ÜÁõñÁéá: ${this.results.tests.coverage}%`));\n    } catch (error) {\n      console.log(colors.red('  ‚ùå ÊµãËØïÊâßË°åÂ§±Ë¥•'));\n      this.results.tests.failed = 1;\n    }\n  }\n\n  /**\n   * ËøêË°å‰ª£Á†ÅÊ£ÄÊü•\n   */\n  async runLinting() {\n    console.log(colors.yellow('\\nüîç ËøêË°å‰ª£Á†ÅÊ£ÄÊü•...'));\n\n    try {\n      // ‰ΩøÁî®Ë¥®ÈáèÈÖçÁΩÆËøõË°åÊ£ÄÊü•\n      const lintOutput = execSync('npx eslint . --config .eslintrc.quality.cjs --format json', {\n        cwd: this.projectRoot,\n        encoding: 'utf8',\n      });\n\n      const lintResults = JSON.parse(lintOutput);\n      this.results.lint.errors = lintResults.reduce((acc, file) => acc + file.errorCount, 0);\n      this.results.lint.warnings = lintResults.reduce((acc, file) => acc + file.warningCount, 0);\n\n      console.log(colors.red(`  ‚ùå ÈîôËØØ: ${this.results.lint.errors}`));\n      console.log(colors.yellow(`  ‚ö†Ô∏è  Ë≠¶Âëä: ${this.results.lint.warnings}`));\n\n      // Â¶ÇÊûúÊúâÈîôËØØÔºåÂ∞ùËØïËá™Âä®‰øÆÂ§ç\n      if (this.results.lint.errors > 0 || this.results.lint.warnings > 0) {\n        console.log(colors.yellow('  üîß Â∞ùËØïËá™Âä®‰øÆÂ§ç...'));\n        try {\n          execSync('npx eslint . --config .eslintrc.quality.cjs --fix', {\n            cwd: this.projectRoot,\n            encoding: 'utf8',\n          });\n\n          // ËøêË°åPrettierÊ†ºÂºèÂåñ\n          execSync('npx prettier --write . --config .prettierrc.quality.json', {\n            cwd: this.projectRoot,\n            encoding: 'utf8',\n          });\n\n          console.log(colors.green('  ‚úÖ ‰ª£Á†ÅÈóÆÈ¢òÂ∑≤Ëá™Âä®‰øÆÂ§ç'));\n        } catch (fixError) {\n          console.log(colors.yellow('  ‚ö†Ô∏è  ÈÉ®ÂàÜÈóÆÈ¢òÊó†Ê≥ïËá™Âä®‰øÆÂ§ç'));\n        }\n      }\n    } catch (error) {\n      console.log(colors.red('  ‚ùå ‰ª£Á†ÅÊ£ÄÊü•Â§±Ë¥•'));\n      this.results.lint.errors = 1;\n    }\n  }\n\n  /**\n   * ËøêË°åÂÆâÂÖ®ÂÆ°ËÆ°\n   */\n  async runSecurityAudit() {\n    console.log(colors.yellow('\\nüîí ËøêË°åÂÆâÂÖ®ÂÆ°ËÆ°...'));\n\n    try {\n      // ËøêË°ånpm audit\n      const auditOutput = execSync('npm audit --json', {\n        cwd: this.projectRoot,\n        encoding: 'utf8',\n      });\n\n      const auditResults = JSON.parse(auditOutput);\n      this.results.security.vulnerabilities = auditResults.metadata?.vulnerabilities?.total || 0;\n\n      console.log(colors.red(`  üö® npmÂÆâÂÖ®ÊºèÊ¥û: ${this.results.security.vulnerabilities}`));\n\n      // ËøêË°åËá™ÂÆö‰πâÂÆâÂÖ®ÂÆ°ËÆ°\n      try {\n        const securityAuditor = new SecurityAuditor();\n        const securityReport = await securityAuditor.run(this.projectRoot);\n        this.results.security.customAudit = securityReport;\n\n        console.log(colors.blue('  üîç Ëá™ÂÆö‰πâÂÆâÂÖ®Ê£ÄÊü•ÂÆåÊàê'));\n        console.log(colors.blue(`  üìä ÂÆâÂÖ®ËØÑÂàÜ: ${securityReport.summary.securityScore}/100`));\n      } catch (customError) {\n        console.log(colors.yellow('  ‚ö†Ô∏è  Ëá™ÂÆö‰πâÂÆâÂÖ®ÂÆ°ËÆ°Â§±Ë¥•'));\n      }\n    } catch (error) {\n      console.log(colors.yellow('  ‚ö†Ô∏è  ÂÆâÂÖ®ÂÆ°ËÆ°ÂÆåÊàê (ÂèØËÉΩÂ≠òÂú®ÊºèÊ¥û)'));\n    }\n  }\n\n  /**\n   * ÂàÜÊûê‰ª£Á†ÅÂ§çÊùÇÂ∫¶\n   */\n  async analyzeComplexity() {\n    console.log(colors.yellow('\\nüìà ÂàÜÊûê‰ª£Á†ÅÂ§çÊùÇÂ∫¶...'));\n\n    try {\n      // ‰ΩøÁî®Êñ∞ÁöÑÂ§çÊùÇÂ∫¶ÂàÜÊûêÂô®\n      const complexityAnalyzer = new ComplexityAnalyzer();\n      const complexityReport = await complexityAnalyzer.run(this.projectRoot);\n\n      this.results.complexity.average = complexityReport.summary.averageComplexity;\n      this.results.complexity.max = complexityReport.summary.maxComplexity;\n      this.results.complexity.report = complexityReport;\n\n      console.log(colors.blue(`  üìä Âπ≥ÂùáÂ§çÊùÇÂ∫¶: ${this.results.complexity.average}`));\n      console.log(colors.blue(`  üìä ÊúÄÂ§ßÂ§çÊùÇÂ∫¶: ${this.results.complexity.max}`));\n      console.log(\n        colors.blue(`  üîç È´òÂ§çÊùÇÂ∫¶Êñá‰ª∂: ${complexityReport.summary.highComplexityFiles.length}`)\n      );\n    } catch (error) {\n      console.log(colors.red('  ‚ùå Â§çÊùÇÂ∫¶ÂàÜÊûêÂ§±Ë¥•'));\n      // ÂõûÈÄÄÂà∞ÁÆÄÂåñÁöÑÂ§çÊùÇÂ∫¶ÂàÜÊûê\n      try {\n        const sourceFiles = this.getSourceFiles();\n        let totalComplexity = 0;\n        let maxComplexity = 0;\n        let fileCount = 0;\n\n        sourceFiles.forEach((file) => {\n          const content = fs.readFileSync(file, 'utf8');\n          const complexity = this.calculateComplexity(content);\n          totalComplexity += complexity;\n          maxComplexity = Math.max(maxComplexity, complexity);\n          fileCount++;\n        });\n\n        this.results.complexity.average = Math.round(totalComplexity / fileCount);\n        this.results.complexity.max = maxComplexity;\n\n        console.log(colors.blue(`  üìä Âπ≥ÂùáÂ§çÊùÇÂ∫¶: ${this.results.complexity.average}`));\n        console.log(colors.blue(`  üìä ÊúÄÂ§ßÂ§çÊùÇÂ∫¶: ${this.results.complexity.max}`));\n      } catch (fallbackError) {\n        console.log(colors.red('  ‚ùå Â§çÊùÇÂ∫¶ÂàÜÊûêÂÆåÂÖ®Â§±Ë¥•'));\n      }\n    }\n  }\n\n  /**\n   * Ê£ÄÊü•‰æùËµñÈ°π\n   */\n  async checkDependencies() {\n    console.log(colors.yellow('\\nüì¶ Ê£ÄÊü•‰æùËµñÈ°π...'));\n\n    try {\n      const packageJson = JSON.parse(\n        fs.readFileSync(path.join(this.projectRoot, 'package.json'), 'utf8')\n      );\n      const dependencies = Object.keys(packageJson.dependencies || {});\n      const devDependencies = Object.keys(packageJson.devDependencies || {});\n\n      console.log(colors.blue(`  üì¶ Áîü‰∫ß‰æùËµñ: ${dependencies.length}`));\n      console.log(colors.blue(`  üîß ÂºÄÂèë‰æùËµñ: ${devDependencies.length}`));\n\n      // Ê£ÄÊü•ËøáÊó∂ÁöÑ‰æùËµñ\n      try {\n        const outdatedOutput = execSync('npm outdated --json', {\n          cwd: this.projectRoot,\n          encoding: 'utf8',\n        });\n        const outdated = JSON.parse(outdatedOutput || '{}');\n\n        if (Object.keys(outdated).length > 0) {\n          console.log(colors.yellow(`  ‚ö†Ô∏è  ËøáÊó∂‰æùËµñ: ${Object.keys(outdated).length}`));\n          Object.keys(outdated)\n            .slice(0, 3)\n            .forEach((pkg) => {\n              console.log(\n                colors.yellow(`    - ${pkg}: ${outdated[pkg].current} ‚Üí ${outdated[pkg].latest}`)\n              );\n            });\n        } else {\n          console.log(colors.green('  ‚úÖ ÊâÄÊúâ‰æùËµñÈÉΩÊòØÊúÄÊñ∞ÁöÑ'));\n        }\n      } catch (error) {\n        console.log(colors.green('  ‚úÖ ÊâÄÊúâ‰æùËµñÈÉΩÊòØÊúÄÊñ∞ÁöÑ'));\n      }\n    } catch (error) {\n      console.log(colors.red('  ‚ùå ‰æùËµñÊ£ÄÊü•Â§±Ë¥•'));\n    }\n  }\n\n  /**\n   * ËøêË°åÊÄßËÉΩÁõëÊéß\n   */\n  async runPerformanceMonitoring() {\n    console.log(colors.yellow('\\n‚ö° ËøêË°åÊÄßËÉΩÁõëÊéß...'));\n\n    try {\n      const performanceMonitor = new PerformanceMonitor();\n      const performanceReport = await performanceMonitor.run(this.projectRoot);\n\n      this.results.performance = {\n        score: performanceReport.summary.performanceScore,\n        issues: performanceReport.summary.highImpactIssues,\n        report: performanceReport,\n      };\n\n      console.log(colors.blue(`  üìä ÊÄßËÉΩËØÑÂàÜ: ${performanceReport.summary.performanceScore}/100`));\n      console.log(colors.blue(`  üö® È´òÂΩ±ÂìçÈóÆÈ¢ò: ${performanceReport.summary.highImpactIssues}`));\n    } catch (error) {\n      console.log(colors.red('  ‚ùå ÊÄßËÉΩÁõëÊéßÂ§±Ë¥•'));\n      this.results.performance = { score: 0, issues: 0 };\n    }\n  }\n\n  /**\n   * ÁîüÊàêË¥®ÈáèÊä•Âëä\n   */\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 23 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 23 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 23 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 23 Ë°å)\n\n  async generateReport() {\n    console.log(colors.yellow('\\nüìä ÁîüÊàêË¥®ÈáèÊä•Âëä...'));\n\n    const report = {\n      timestamp: new Date().toISOString(),\n      summary: {\n        overallScore: this.calculateOverallScore(),\n        recommendations: this.generateRecommendations(),\n      },\n      details: this.results,\n    };\n\n    // ‰øùÂ≠òÊä•Âëä\n    const reportPath = path.join(this.projectRoot, 'reports', 'quality-enhancement-report.json');\n    fs.mkdirSync(path.dirname(reportPath), { recursive: true });\n    fs.writeFileSync(reportPath, JSON.stringify(report, null, 2));\n\n    // ÁîüÊàê HTML Êä•Âëä\n    this.generateHtmlReport(report);\n\n    console.log(colors.green(`  ‚úÖ Êä•ÂëäÂ∑≤ÁîüÊàê: ${reportPath}`));\n    console.log(colors.blue('  üåê HTML Êä•Âëä: reports/quality-enhancement-report.html'));\n  }\n\n  /**\n   * ËÆ°ÁÆóÊÄª‰ΩìË¥®ÈáèÂàÜÊï∞\n   */\n  calculateOverallScore() {\n    const score = 100;\n\n    // ÊµãËØïÂàÜÊï∞ (30%)\n    const testScore = this.results.tests.failed === 0 ? 30 : 0;\n    const coverageScore = (this.results.tests.coverage / 100) * 15;\n\n    // ‰ª£Á†ÅË¥®ÈáèÂàÜÊï∞ (25%)\n    const lintScore =\n      this.results.lint.errors === 0 ? 25 : Math.max(0, 25 - this.results.lint.errors * 5);\n\n    // ÂÆâÂÖ®ÂàÜÊï∞ (20%)\n    let securityScore =\n      this.results.security.vulnerabilities === 0\n        ? 20\n        : Math.max(0, 20 - this.results.security.vulnerabilities * 2);\n    if (this.results.security.customAudit) {\n      securityScore = Math.min(\n        securityScore,\n        this.results.security.customAudit.summary.securityScore / 5\n      );\n    }\n\n    // Â§çÊùÇÂ∫¶ÂàÜÊï∞ (15%)\n    const complexityScore =\n      this.results.complexity.average <= 10\n        ? 15\n        : Math.max(0, 15 - (this.results.complexity.average - 10));\n\n    // ÊÄßËÉΩÂàÜÊï∞ (10%)\n    const performanceScore = this.results.performance\n      ? (this.results.performance.score / 100) * 10\n      : 0;\n\n    return Math.round(\n      testScore + coverageScore + lintScore + securityScore + complexityScore + performanceScore\n    );\n  }\n\n  /**\n   * ÁîüÊàêÊîπËøõÂª∫ËÆÆ\n   */\n  generateRecommendations() {\n    const recommendations = [];\n\n    if (this.results.tests.failed > 0) {\n      recommendations.push('‰øÆÂ§çÂ§±Ë¥•ÁöÑÊµãËØïÁî®‰æã');\n    }\n\n    if (this.results.tests.coverage < 80) {\n      recommendations.push('ÊèêÈ´òÊµãËØïË¶ÜÁõñÁéáËá≥80%‰ª•‰∏ä');\n    }\n\n    if (this.results.lint.errors > 0) {\n      recommendations.push('‰øÆÂ§çESLintÈîôËØØ');\n    }\n\n    if (this.results.lint.warnings > 10) {\n      recommendations.push('ÂáèÂ∞ëESLintË≠¶Âëä');\n    }\n\n    if (this.results.security.vulnerabilities > 0) {\n      recommendations.push('‰øÆÂ§çnpmÂÆâÂÖ®ÊºèÊ¥û');\n    }\n\n    if (\n      this.results.security.customAudit &&\n      this.results.security.customAudit.summary.securityScore < 80\n    ) {\n      recommendations.push('ÊîπËøõ‰ª£Á†ÅÂÆâÂÖ®ÊÄß');\n    }\n\n    if (this.results.complexity.average > 10) {\n      recommendations.push('Èôç‰Ωé‰ª£Á†ÅÂ§çÊùÇÂ∫¶');\n    }\n\n    if (\n      this.results.complexity.report &&\n      this.results.complexity.report.summary.highComplexityFiles.length > 5\n    ) {\n      recommendations.push('ÈáçÊûÑÈ´òÂ§çÊùÇÂ∫¶Êñá‰ª∂');\n    }\n\n    if (this.results.performance && this.results.performance.score < 70) {\n      recommendations.push('‰ºòÂåñ‰ª£Á†ÅÊÄßËÉΩ');\n    }\n\n    if (this.results.performance && this.results.performance.issues > 10) {\n      recommendations.push('‰øÆÂ§çÈ´òÂΩ±ÂìçÊÄßËÉΩÈóÆÈ¢ò');\n    }\n\n    if (recommendations.length === 0) {\n      recommendations.push('‰ª£Á†ÅË¥®ÈáèËâØÂ•ΩÔºåÁªßÁª≠‰øùÊåÅ!');\n    }\n\n    return recommendations;\n  }\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 73 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 73 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 73 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 73 Ë°å)\n\n  /**\n   * ÁîüÊàê HTML Êä•Âëä\n   */\n  generateHtmlReport(report) {\n    const htmlContent = `\n<!DOCTYPE html>\n<html lang=\"zh-CN\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>‰ª£Á†ÅË¥®ÈáèÊèêÂçáÊä•Âëä</title>\n    <style>\n        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f5f5f5; }\n        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }\n        .header { text-align: center; margin-bottom: 30px; }\n        .score { font-size: 48px; font-weight: bold; color: ${report.summary.overallScore >= 80 ? '#4CAF50' : report.summary.overallScore >= 60 ? '#FF9800' : '#F44336'}; }\n        .metrics { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 20px 0; }\n        .metric { background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #007bff; }\n        .metric h3 { margin: 0 0 10px 0; color: #333; }\n        .recommendations { background: #e3f2fd; padding: 20px; border-radius: 8px; margin: 20px 0; }\n        .recommendations ul { margin: 10px 0; }\n        .timestamp { text-align: center; color: #666; margin-top: 20px; }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        <div class=\"header\">\n            <h1>‰ª£Á†ÅË¥®ÈáèÊèêÂçáÊä•Âëä</h1>\n            <div class=\"score\">${report.summary.overallScore}/100</div>\n            <p>ÊÄª‰ΩìË¥®ÈáèËØÑÂàÜ</p>\n        </div>\n        \n        <div class=\"metrics\">\n            <div class=\"metric\">\n                <h3>üß™ ÊµãËØïÁªìÊûú</h3>\n                <p>ÈÄöËøá: ${report.details.tests.passed}</p>\n                <p>Â§±Ë¥•: ${report.details.tests.failed}</p>\n                <p>Ë¶ÜÁõñÁéá: ${report.details.tests.coverage}%</p>\n            </div>\n            \n            <div class=\"metric\">\n                <h3>üîç ‰ª£Á†ÅÊ£ÄÊü•</h3>\n                <p>ÈîôËØØ: ${report.details.lint.errors}</p>\n                <p>Ë≠¶Âëä: ${report.details.lint.warnings}</p>\n            </div>\n            \n            <div class=\"metric\">\n                <h3>üîí ÂÆâÂÖ®ÂÆ°ËÆ°</h3>\n                <p>ÊºèÊ¥û: ${report.details.security.vulnerabilities}</p>\n            </div>\n            \n            <div class=\"metric\">\n                <h3>üìà ‰ª£Á†ÅÂ§çÊùÇÂ∫¶</h3>\n                <p>Âπ≥Âùá: ${report.details.complexity.average}</p>\n                <p>ÊúÄÂ§ß: ${report.details.complexity.max}</p>\n            </div>\n        </div>\n        \n        <div class=\"recommendations\">\n            <h3>üí° ÊîπËøõÂª∫ËÆÆ</h3>\n            <ul>\n                ${report.summary.recommendations.map((rec) => `<li>${rec}</li>`).join('')}\n            </ul>\n        </div>\n        \n        <div class=\"timestamp\">\n            <p>Êä•ÂëäÁîüÊàêÊó∂Èó¥: ${new Date(report.timestamp).toLocaleString('zh-CN')}</p>\n        </div>\n    </div>\n</body>\n</html>\n    `;\n\n    const htmlPath = path.join(this.projectRoot, 'reports', 'quality-enhancement-report.html');\n    fs.writeFileSync(htmlPath, htmlContent);\n  }\n\n  /**\n   * Ëé∑ÂèñÊ∫ê‰ª£Á†ÅÊñá‰ª∂ÂàóË°®\n   */\n  getSourceFiles() {\n    const files = [];\n    const searchDirs = ['src', 'backend'];\n\n    searchDirs.forEach((dir) => {\n      const dirPath = path.join(this.projectRoot, dir);\n      if (fs.existsSync(dirPath)) {\n        this.walkDir(dirPath, files);\n      }\n    });\n\n    return files.filter((file) => file.endsWith('.js') || file.endsWith('.ts'));\n  }\n\n  /**\n   * ÈÄíÂΩíÈÅçÂéÜÁõÆÂΩï\n   */\n  walkDir(dir, files) {\n    const items = fs.readdirSync(dir);\n\n    items.forEach((item) => {\n      const fullPath = path.join(dir, item);\n      const stat = fs.statSync(fullPath);\n\n      if (stat.isDirectory()) {\n        this.walkDir(fullPath, files);\n      } else {\n        files.push(fullPath);\n      }\n    });\n  }\n\n  /**\n   * ÁÆÄÂçïÁöÑÂ§çÊùÇÂ∫¶ËÆ°ÁÆó\n   */\n  calculateComplexity(content) {\n    // ÁÆÄÂåñÁöÑÂúàÂ§çÊùÇÂ∫¶ËÆ°ÁÆó\n    const patterns = [\n      /if\\s*\\(/g,\n      /else\\s*if\\s*\\(/g,\n      /while\\s*\\(/g,\n      /for\\s*\\(/g,\n      /switch\\s*\\(/g,\n      /case\\s+/g,\n      /catch\\s*\\(/g,\n      /&&/g,\n      /\\|\\|/g,\n      /\\?/g,\n    ];\n\n    let complexity = 1; // Âü∫Á°ÄÂ§çÊùÇÂ∫¶\n\n    patterns.forEach((pattern) => {\n      const matches = content.match(pattern);\n      if (matches) {\n        complexity += matches.length;\n      }\n    });\n\n    return complexity;\n  }\n}\n\n// TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 21 Ë°å)\n\n// TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 21 Ë°å)\n\n// TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 21 Ë°å)\n\n// TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 21 Ë°å)\n\n// ÂëΩ‰ª§Ë°åÊâßË°å\nif (import.meta.url === `file://${process.argv[1]}`) {\n  const enhancer = new QualityEnhancer();\n  const command = process.argv[2];\n\n  switch (command) {\n    case 'test':\n      enhancer.runTests().catch(console.error);\n      break;\n    case 'lint':\n      enhancer.runLinting().catch(console.error);\n      break;\n    case 'security':\n      enhancer.runSecurityAudit().catch(console.error);\n      break;\n    case 'complexity':\n      enhancer.analyzeComplexity().catch(console.error);\n      break;\n    case 'performance':\n      enhancer.runPerformanceMonitoring().catch(console.error);\n      break;\n    case 'all':\n    default:\n      enhancer.runAll().catch(console.error);\n      break;\n  }\n}\n\nexport default QualityEnhancer;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/scripts/quality-summary.js","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":48,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":48,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1064,1126],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":57,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":57,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1329,1372],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":59,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":59,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[1401,1458],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":68,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":68,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1545,1588],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":82,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":82,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1817,1859],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":102,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":102,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2391,2460],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":104,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":104,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2497,2570],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":120,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":120,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2904,2969],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":122,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":122,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[3002,3049],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":137,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":137,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[3389,3465],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":139,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":139,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[3498,3546],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":154,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":154,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[3876,3939],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":156,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":156,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[3972,4019],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":165,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":165,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[4103,4150],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.4.","line":173,"column":33,"nodeType":"Literal","messageId":"noMagic","endLine":173,"endColumn":36},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":174,"column":19,"nodeType":"Literal","messageId":"noMagic","endLine":174,"endColumn":22},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.4.","line":174,"column":25,"nodeType":"Literal","messageId":"noMagic","endLine":174,"endColumn":28},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.3.","line":180,"column":37,"nodeType":"Literal","messageId":"noMagic","endLine":180,"endColumn":40},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":181,"column":19,"nodeType":"Literal","messageId":"noMagic","endLine":181,"endColumn":22},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.3.","line":181,"column":25,"nodeType":"Literal","messageId":"noMagic","endLine":181,"endColumn":28},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.2.","line":187,"column":39,"nodeType":"Literal","messageId":"noMagic","endLine":187,"endColumn":42},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":188,"column":19,"nodeType":"Literal","messageId":"noMagic","endLine":188,"endColumn":22},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.2.","line":188,"column":25,"nodeType":"Literal","messageId":"noMagic","endLine":188,"endColumn":28},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.1.","line":194,"column":33,"nodeType":"Literal","messageId":"noMagic","endLine":194,"endColumn":36},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":195,"column":19,"nodeType":"Literal","messageId":"noMagic","endLine":195,"endColumn":22},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.1.","line":195,"column":25,"nodeType":"Literal","messageId":"noMagic","endLine":195,"endColumn":28},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":199,"column":59,"nodeType":"Literal","messageId":"noMagic","endLine":199,"endColumn":62},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":202,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":202,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[5220,5363],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":222,"column":14,"nodeType":"Literal","messageId":"noMagic","endLine":222,"endColumn":17},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":227,"column":33,"nodeType":"Literal","messageId":"noMagic","endLine":227,"endColumn":36},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":227,"column":38,"nodeType":"Literal","messageId":"noMagic","endLine":227,"endColumn":41},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 50.","line":227,"column":69,"nodeType":"Literal","messageId":"noMagic","endLine":227,"endColumn":71},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":245,"column":7,"nodeType":"Literal","messageId":"noMagic","endLine":245,"endColumn":10},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5.","line":246,"column":70,"nodeType":"Literal","messageId":"noMagic","endLine":246,"endColumn":71},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 90.","line":255,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":255,"endColumn":20},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 85.","line":258,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":258,"endColumn":20},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 80.","line":264,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":264,"endColumn":20},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 75.","line":270,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":270,"endColumn":20},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 70.","line":276,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":276,"endColumn":20},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 65.","line":282,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":282,"endColumn":20},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":288,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":288,"endColumn":20},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 55.","line":294,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":294,"endColumn":20},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 50.","line":300,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":300,"endColumn":20},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 45.","line":306,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":306,"endColumn":20},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 40.","line":312,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":312,"endColumn":20},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":322,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":322,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[7879,7924],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 70.","line":330,"column":45,"nodeType":"Literal","messageId":"noMagic","endLine":330,"endColumn":47},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 80.","line":366,"column":53,"nodeType":"Literal","messageId":"noMagic","endLine":366,"endColumn":55},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":394,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":394,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[9739,9809],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":401,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":401,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[9864,9909],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":412,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":412,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[10320,10380],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":413,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":413,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[10385,10445],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 3.6.","line":477,"column":92,"nodeType":"Literal","messageId":"noMagic","endLine":477,"endColumn":95},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":701,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":701,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[18423,18480],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":702,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":702,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[18485,18526],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 50.","line":702,"column":40,"nodeType":"Literal","messageId":"noMagic","endLine":702,"endColumn":42},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":705,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":705,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[18544,18686],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":714,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":714,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[18796,18834],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":715,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":715,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[18841,18913],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":716,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":716,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[18920,18983],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":717,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":717,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[18990,19061],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":718,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":718,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[19068,19137],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":723,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":723,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[19246,19288],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":724,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":724,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[19295,19365],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":725,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":725,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[19372,19446],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":726,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":726,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[19453,19520],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":727,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":727,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[19527,19596],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":731,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":731,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[19663,19702],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":732,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":732,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[19709,19816],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":742,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":742,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[20010,20048],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":744,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":744,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[20095,20163],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":748,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":748,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[20185,20233],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 50.","line":748,"column":45,"nodeType":"Literal","messageId":"noMagic","endLine":748,"endColumn":47},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":749,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":749,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[20238,20291],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":756,"column":35,"nodeType":"MemberExpression","messageId":"unexpected","endLine":756,"endColumn":48}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":75,"fixableErrorCount":0,"fixableWarningCount":0,"source":"#!/usr/bin/env node\n\n/**\n * ‰ª£Á†ÅË¥®ÈáèÊèêÂçáÊÄªÁªìËÑöÊú¨\n * Êï¥ÂêàÊâÄÊúâË¥®ÈáèÊèêÂçáÁªìÊûúÂπ∂ÁîüÊàêÁªºÂêàÊä•Âëä\n */\n\nimport fs from 'fs';\nimport path from 'path';\nimport { fileURLToPath } from 'url';\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\n\nconst colors = {\n  red: (text) => `\\x1b[31m${text}\\x1b[0m`,\n  green: (text) => `\\x1b[32m${text}\\x1b[0m`,\n  yellow: (text) => `\\x1b[33m${text}\\x1b[0m`,\n  blue: (text) => `\\x1b[34m${text}\\x1b[0m`,\n  cyan: (text) => `\\x1b[36m${text}\\x1b[0m`,\n  magenta: (text) => `\\x1b[35m${text}\\x1b[0m`,\n  bold: (text) => `\\x1b[1m${text}\\x1b[0m`,\n};\n\nclass QualitySummary {\n  constructor() {\n    this.projectRoot = process.cwd();\n    this.reportsDir = path.join(this.projectRoot, 'reports');\n    this.summary = {\n      timestamp: new Date().toISOString(),\n      overall: {\n        qualityScore: 0,\n        grade: 'F',\n        improvements: 0,\n      },\n      codeQuality: {},\n      security: {},\n      complexity: {},\n      performance: {},\n      recommendations: [],\n    };\n  }\n\n  /**\n   * ÁîüÊàêÁªºÂêàË¥®ÈáèÊä•Âëä\n   */\n  async generateSummary() {\n    console.log(colors.bold(colors.blue('üìä ÁîüÊàê‰ª£Á†ÅË¥®ÈáèÊèêÂçáÁªºÂêàÊä•Âëä...\\n')));\n\n    try {\n      await this.loadReports();\n      await this.calculateOverallScore();\n      await this.generateRecommendations();\n      await this.saveReport();\n      await this.displaySummary();\n\n      console.log(colors.green('\\n‚úÖ ÁªºÂêàÊä•ÂëäÁîüÊàêÂÆåÊàê!'));\n    } catch (error) {\n      console.error(colors.red('‚ùå ÁîüÊàêÊä•ÂëäÊó∂Âá∫Áé∞ÈîôËØØ:'), error.message);\n      process.exit(1);\n    }\n  }\n\n  /**\n   * Âä†ËΩΩÊâÄÊúâÊä•Âëä\n   */\n  async loadReports() {\n    console.log(colors.yellow('üìÇ Âä†ËΩΩË¥®ÈáèÊä•Âëä...'));\n\n    // Âä†ËΩΩ‰ª£Á†ÅË¥®ÈáèÊä•Âëä\n    await this.loadCodeQualityReport();\n\n    // Âä†ËΩΩÂÆâÂÖ®‰øÆÂ§çÊä•Âëä\n    await this.loadSecurityReport();\n\n    // Âä†ËΩΩÂ§çÊùÇÂ∫¶‰ºòÂåñÊä•Âëä\n    await this.loadComplexityReport();\n\n    // Âä†ËΩΩÊÄßËÉΩÊä•Âëä\n    await this.loadPerformanceReport();\n\n    console.log(colors.green('  ‚úÖ ÊâÄÊúâÊä•ÂëäÂä†ËΩΩÂÆåÊàê'));\n  }\n\n  /**\n   * Âä†ËΩΩ‰ª£Á†ÅË¥®ÈáèÊä•Âëä\n   */\n  async loadCodeQualityReport() {\n    const reportPaths = [\n      path.join(this.reportsDir, 'quality-enhancement-report.json'),\n      path.join(this.reportsDir, 'code-quality-fix-report.json'),\n    ];\n\n    for (const reportPath of reportPaths) {\n      if (fs.existsSync(reportPath)) {\n        try {\n          const report = JSON.parse(fs.readFileSync(reportPath, 'utf8'));\n          this.summary.codeQuality = {\n            ...this.summary.codeQuality,\n            ...report,\n          };\n          console.log(colors.blue(`    üìã Â∑≤Âä†ËΩΩ: ${path.basename(reportPath)}`));\n        } catch (error) {\n          console.log(colors.yellow(`    ‚ö†Ô∏è  Êó†Ê≥ïËß£Êûê: ${path.basename(reportPath)}`));\n        }\n      }\n    }\n  }\n\n  /**\n   * Âä†ËΩΩÂÆâÂÖ®Êä•Âëä\n   */\n  async loadSecurityReport() {\n    const reportPath = path.join(this.reportsDir, 'security-fix-report.json');\n\n    if (fs.existsSync(reportPath)) {\n      try {\n        const report = JSON.parse(fs.readFileSync(reportPath, 'utf8'));\n        this.summary.security = report;\n        console.log(colors.blue('    üîí Â∑≤Âä†ËΩΩ: security-fix-report.json'));\n      } catch (error) {\n        console.log(colors.yellow('    ‚ö†Ô∏è  Êó†Ê≥ïËß£ÊûêÂÆâÂÖ®Êä•Âëä'));\n      }\n    }\n  }\n\n  /**\n   * Âä†ËΩΩÂ§çÊùÇÂ∫¶Êä•Âëä\n   */\n  async loadComplexityReport() {\n    const reportPath = path.join(this.reportsDir, 'complexity-optimization-report.json');\n\n    if (fs.existsSync(reportPath)) {\n      try {\n        const report = JSON.parse(fs.readFileSync(reportPath, 'utf8'));\n        this.summary.complexity = report;\n        console.log(colors.blue('    üîß Â∑≤Âä†ËΩΩ: complexity-optimization-report.json'));\n      } catch (error) {\n        console.log(colors.yellow('    ‚ö†Ô∏è  Êó†Ê≥ïËß£ÊûêÂ§çÊùÇÂ∫¶Êä•Âëä'));\n      }\n    }\n  }\n\n  /**\n   * Âä†ËΩΩÊÄßËÉΩÊä•Âëä\n   */\n  async loadPerformanceReport() {\n    const reportPath = path.join(this.projectRoot, 'performance-report.json');\n\n    if (fs.existsSync(reportPath)) {\n      try {\n        const report = JSON.parse(fs.readFileSync(reportPath, 'utf8'));\n        this.summary.performance = report;\n        console.log(colors.blue('    ‚ö° Â∑≤Âä†ËΩΩ: performance-report.json'));\n      } catch (error) {\n        console.log(colors.yellow('    ‚ö†Ô∏è  Êó†Ê≥ïËß£ÊûêÊÄßËÉΩÊä•Âëä'));\n      }\n    }\n  }\n\n  /**\n   * ËÆ°ÁÆóÊÄª‰ΩìË¥®ÈáèËØÑÂàÜ\n   */\n  async calculateOverallScore() {\n    console.log(colors.yellow('\\nüßÆ ËÆ°ÁÆóÊÄª‰ΩìË¥®ÈáèËØÑÂàÜ...'));\n\n    let totalScore = 0;\n    let maxScore = 0;\n\n    // ‰ª£Á†ÅË¥®ÈáèËØÑÂàÜ (40%)\n    if (this.summary.codeQuality.qualityScore) {\n      const codeScore = this.summary.codeQuality.qualityScore || 0;\n      totalScore += codeScore * 0.4;\n      maxScore += 100 * 0.4;\n    }\n\n    // ÂÆâÂÖ®ËØÑÂàÜ (30%)\n    if (this.summary.security.summary) {\n      const securityScore = this.calculateSecurityScore();\n      totalScore += securityScore * 0.3;\n      maxScore += 100 * 0.3;\n    }\n\n    // Â§çÊùÇÂ∫¶ËØÑÂàÜ (20%)\n    if (this.summary.complexity.summary) {\n      const complexityScore = this.calculateComplexityScore();\n      totalScore += complexityScore * 0.2;\n      maxScore += 100 * 0.2;\n    }\n\n    // ÊÄßËÉΩËØÑÂàÜ (10%)\n    if (this.summary.performance.performanceScore) {\n      const perfScore = this.summary.performance.performanceScore || 0;\n      totalScore += perfScore * 0.1;\n      maxScore += 100 * 0.1;\n    }\n\n    this.summary.overall.qualityScore =\n      maxScore > 0 ? Math.round((totalScore / maxScore) * 100) : 0;\n    this.summary.overall.grade = this.getGrade(this.summary.overall.qualityScore);\n\n    console.log(\n      colors.green(\n        `  üìä ÊÄª‰ΩìË¥®ÈáèËØÑÂàÜ: ${this.summary.overall.qualityScore}/100 (${this.summary.overall.grade})`\n      )\n    );\n  }\n\n  /**\n   * ËÆ°ÁÆóÂÆâÂÖ®ËØÑÂàÜ\n   */\n  calculateSecurityScore() {\n    const security = this.summary.security.summary;\n    if (!security) {\n      return 0;\n    }\n\n    const totalIssues = security.totalSecurityIssues || 0;\n    const fixedFiles = security.fixedFiles || 0;\n\n    if (totalIssues === 0) {\n      return 100;\n    }\n\n    // Âü∫‰∫é‰øÆÂ§çÊØî‰æãËÆ°ÁÆóÂàÜÊï∞\n    const fixRatio = fixedFiles / Math.max(totalIssues, 1);\n    return Math.max(0, Math.min(100, 100 - totalIssues + fixRatio * 50));\n  }\n\n  /**\n   * ËÆ°ÁÆóÂ§çÊùÇÂ∫¶ËØÑÂàÜ\n   */\n  calculateComplexityScore() {\n    const complexity = this.summary.complexity.summary;\n    if (!complexity) {\n      return 0;\n    }\n\n    const optimizedFiles = complexity.optimizedFiles || 0;\n    const extractedFunctions = complexity.extractedFunctions || 0;\n    const reducedNesting = complexity.reducedNesting || 0;\n\n    // Âü∫‰∫é‰ºòÂåñÊï∞ÈáèËÆ°ÁÆóÂàÜÊï∞\n    const optimizationScore = Math.min(\n      100,\n      optimizedFiles * 2 + extractedFunctions * 1 + reducedNesting * 5\n    );\n    return optimizationScore;\n  }\n\n  /**\n   * Ëé∑ÂèñÁ≠âÁ∫ß\n   */\n  getGrade(score) {\n    if (score >= 90) {\n      return 'A+';\n    }\n    if (score >= 85) {\n      return 'A';\n    }\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (score >= 80) {\n      return 'A-';\n    }\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (score >= 75) {\n      return 'B+';\n    }\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (score >= 70) {\n      return 'B';\n    }\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (score >= 65) {\n      return 'B-';\n    }\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (score >= 60) {\n      return 'C+';\n    }\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (score >= 55) {\n      return 'C';\n    }\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (score >= 50) {\n      return 'C-';\n    }\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (score >= 45) {\n      return 'D+';\n    }\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (score >= 40) {\n      return 'D';\n    }\n    return 'F';\n  }\n\n  /**\n   * ÁîüÊàêÊîπËøõÂª∫ËÆÆ\n   */\n  async generateRecommendations() {\n    console.log(colors.yellow('\\nüí° ÁîüÊàêÊîπËøõÂª∫ËÆÆ...'));\n\n    const recommendations = [];\n\n    // Âü∫‰∫éË¥®ÈáèËØÑÂàÜÁîüÊàêÂª∫ËÆÆ\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (this.summary.overall.qualityScore < 70) {\n      recommendations.push({\n        priority: 'high',\n        category: 'Êï¥‰ΩìË¥®Èáè',\n        suggestion: '‰ª£Á†ÅË¥®ÈáèÈúÄË¶ÅÊòæËëóÊîπËøõÔºåÂª∫ËÆÆ‰ºòÂÖàÂ§ÑÁêÜÈ´òÂΩ±ÂìçÈóÆÈ¢ò',\n      });\n    }\n\n    // ÂÆâÂÖ®Âª∫ËÆÆ\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (this.summary.security.summary?.totalSecurityIssues > 0) {\n      recommendations.push({\n        priority: 'critical',\n        category: 'ÂÆâÂÖ®',\n        suggestion: `ÂèëÁé∞ ${this.summary.security.summary.totalSecurityIssues} ‰∏™ÂÆâÂÖ®ÈóÆÈ¢òÔºåÈúÄË¶ÅÁ´ãÂç≥Â§ÑÁêÜ`,\n      });\n    }\n\n    // Â§çÊùÇÂ∫¶Âª∫ËÆÆ\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (this.summary.complexity.summary?.optimizedFiles > 0) {\n      recommendations.push({\n        priority: 'medium',\n        category: 'Â§çÊùÇÂ∫¶',\n        suggestion: `Â∑≤‰ºòÂåñ ${this.summary.complexity.summary.optimizedFiles} ‰∏™Êñá‰ª∂ÔºåÁªßÁª≠ÈáçÊûÑÂâ©‰ΩôÈ´òÂ§çÊùÇÂ∫¶‰ª£Á†Å`,\n      });\n    }\n\n    // ÊÄßËÉΩÂª∫ËÆÆ\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (this.summary.performance.performanceScore < 80) {\n      recommendations.push({\n        priority: 'medium',\n        category: 'ÊÄßËÉΩ',\n        suggestion: 'ÊÄßËÉΩÊúâÂæÖÊèêÂçáÔºåÂª∫ËÆÆ‰ºòÂåñÂÖ≥ÈîÆË∑ØÂæÑÂíåÂáèÂ∞ëËµÑÊ∫êÊ∂àËÄó',\n      });\n    }\n\n    // ÈÄöÁî®Âª∫ËÆÆ\n    recommendations.push(\n      {\n        priority: 'low',\n        category: 'Áª¥Êä§',\n        suggestion: 'Âª∫Á´ãÂÆöÊúü‰ª£Á†ÅÂÆ°Êü•Êú∫Âà∂ÔºåÊåÅÁª≠ÁõëÊéß‰ª£Á†ÅË¥®Èáè',\n      },\n      {\n        priority: 'low',\n        category: 'ÊµãËØï',\n        suggestion: 'Â¢ûÂä†ÂçïÂÖÉÊµãËØïË¶ÜÁõñÁéáÔºåÁ°Æ‰øù‰ª£Á†ÅÂèòÊõ¥ÁöÑÂÆâÂÖ®ÊÄß',\n      },\n      {\n        priority: 'low',\n        category: 'ÊñáÊ°£',\n        suggestion: 'ÂÆåÂñÑ‰ª£Á†ÅÊñáÊ°£ÂíåAPIÊñáÊ°£ÔºåÊèêÈ´ò‰ª£Á†ÅÂèØÁª¥Êä§ÊÄß',\n      }\n    );\n\n    this.summary.recommendations = recommendations;\n    console.log(colors.green(`  üí° ÁîüÊàê‰∫Ü ${recommendations.length} Êù°ÊîπËøõÂª∫ËÆÆ`));\n  }\n\n  /**\n   * ‰øùÂ≠òÊä•Âëä\n   */\n  async saveReport() {\n    console.log(colors.yellow('\\nüíæ ‰øùÂ≠òÁªºÂêàÊä•Âëä...'));\n\n    // ‰øùÂ≠òJSONÊä•Âëä\n    const jsonReportPath = path.join(this.reportsDir, 'quality-summary-report.json');\n    await fs.promises.writeFile(jsonReportPath, JSON.stringify(this.summary, null, 2));\n\n    // ÁîüÊàêHTMLÊä•Âëä\n    const htmlReport = this.generateHtmlReport();\n    const htmlReportPath = path.join(this.reportsDir, 'quality-summary-report.html');\n    await fs.promises.writeFile(htmlReportPath, htmlReport);\n\n    console.log(colors.green(`  üìÑ JSONÊä•Âëä: ${jsonReportPath}`));\n    console.log(colors.green(`  üåê HTMLÊä•Âëä: ${htmlReportPath}`));\n  }\n\n  /**\n   * ÁîüÊàêHTMLÊä•Âëä\n   */\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 190 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 190 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 190 Ë°å)\n\n  generateHtmlReport() {\n    const gradeColor = this.getGradeColor(this.summary.overall.grade);\n\n    return `<!DOCTYPE html>\n<html lang=\"zh-CN\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>‰ª£Á†ÅË¥®ÈáèÊèêÂçáÁªºÂêàÊä•Âëä</title>\n    <style>\n        body {\n            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n            line-height: 1.6;\n            margin: 0;\n            padding: 20px;\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            min-height: 100vh;\n        }\n        .container {\n            max-width: 1200px;\n            margin: 0 auto;\n            background: white;\n            border-radius: 15px;\n            box-shadow: 0 20px 40px rgba(0,0,0,0.1);\n            overflow: hidden;\n        }\n        .header {\n            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);\n            color: white;\n            padding: 30px;\n            text-align: center;\n        }\n        .header h1 {\n            margin: 0;\n            font-size: 2.5em;\n            font-weight: 300;\n        }\n        .header .subtitle {\n            margin-top: 10px;\n            opacity: 0.9;\n            font-size: 1.1em;\n        }\n        .score-section {\n            padding: 40px;\n            text-align: center;\n            background: #f8f9fa;\n        }\n        .score-circle {\n            width: 200px;\n            height: 200px;\n            border-radius: 50%;\n            background: conic-gradient(${gradeColor} ${this.summary.overall.qualityScore * 3.6}deg, #e9ecef 0deg);\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            margin: 0 auto 20px;\n            position: relative;\n        }\n        .score-circle::before {\n            content: '';\n            width: 160px;\n            height: 160px;\n            border-radius: 50%;\n            background: white;\n            position: absolute;\n        }\n        .score-text {\n            position: relative;\n            z-index: 1;\n            font-size: 3em;\n            font-weight: bold;\n            color: ${gradeColor};\n        }\n        .grade {\n            font-size: 2em;\n            font-weight: bold;\n            color: ${gradeColor};\n            margin-top: 10px;\n        }\n        .metrics {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));\n            gap: 20px;\n            padding: 40px;\n        }\n        .metric-card {\n            background: white;\n            border-radius: 10px;\n            padding: 25px;\n            box-shadow: 0 5px 15px rgba(0,0,0,0.08);\n            border-left: 4px solid #3498db;\n        }\n        .metric-card h3 {\n            margin: 0 0 15px 0;\n            color: #2c3e50;\n            font-size: 1.3em;\n        }\n        .metric-value {\n            font-size: 2em;\n            font-weight: bold;\n            color: #3498db;\n            margin-bottom: 10px;\n        }\n        .metric-description {\n            color: #7f8c8d;\n            font-size: 0.9em;\n        }\n        .recommendations {\n            padding: 40px;\n            background: #f8f9fa;\n        }\n        .recommendations h2 {\n            color: #2c3e50;\n            margin-bottom: 25px;\n            font-size: 1.8em;\n        }\n        .recommendation {\n            background: white;\n            border-radius: 8px;\n            padding: 20px;\n            margin-bottom: 15px;\n            border-left: 4px solid #e74c3c;\n            box-shadow: 0 2px 5px rgba(0,0,0,0.05);\n        }\n        .recommendation.high { border-left-color: #e74c3c; }\n        .recommendation.medium { border-left-color: #f39c12; }\n        .recommendation.low { border-left-color: #27ae60; }\n        .recommendation.critical { border-left-color: #8e44ad; }\n        .priority {\n            display: inline-block;\n            padding: 4px 12px;\n            border-radius: 20px;\n            font-size: 0.8em;\n            font-weight: bold;\n            text-transform: uppercase;\n            margin-bottom: 10px;\n        }\n        .priority.critical { background: #8e44ad; color: white; }\n        .priority.high { background: #e74c3c; color: white; }\n        .priority.medium { background: #f39c12; color: white; }\n        .priority.low { background: #27ae60; color: white; }\n        .footer {\n            padding: 30px;\n            text-align: center;\n            background: #2c3e50;\n            color: white;\n        }\n        .timestamp {\n            opacity: 0.7;\n            font-size: 0.9em;\n        }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        <div class=\"header\">\n            <h1>üöÄ ‰ª£Á†ÅË¥®ÈáèÊèêÂçáÁªºÂêàÊä•Âëä</h1>\n            <div class=\"subtitle\">ÂÖ®Èù¢ÁöÑ‰ª£Á†ÅË¥®ÈáèÂàÜÊûê‰∏éÊîπËøõÂª∫ËÆÆ</div>\n        </div>\n        \n        <div class=\"score-section\">\n            <div class=\"score-circle\">\n                <div class=\"score-text\">${this.summary.overall.qualityScore}</div>\n            </div>\n            <div class=\"grade\">Á≠âÁ∫ß: ${this.summary.overall.grade}</div>\n            <p>ÁªºÂêàË¥®ÈáèËØÑÂàÜÂü∫‰∫é‰ª£Á†ÅË¥®Èáè„ÄÅÂÆâÂÖ®ÊÄß„ÄÅÂ§çÊùÇÂ∫¶ÂíåÊÄßËÉΩÁ≠âÂ§ö‰∏™Áª¥Â∫¶</p>\n        </div>\n        \n        <div class=\"metrics\">\n            ${this.generateMetricCards()}\n        </div>\n        \n        <div class=\"recommendations\">\n            <h2>üìã ÊîπËøõÂª∫ËÆÆ</h2>\n            ${this.summary.recommendations\n              .map(\n                (rec) => `\n                <div class=\"recommendation ${rec.priority}\">\n                    <span class=\"priority ${rec.priority}\">${rec.priority}</span>\n                    <h4>${rec.category}</h4>\n                    <p>${rec.suggestion}</p>\n                </div>\n            `\n              )\n              .join('')}\n        </div>\n        \n        <div class=\"footer\">\n            <div class=\"timestamp\">Êä•ÂëäÁîüÊàêÊó∂Èó¥: ${new Date(this.summary.timestamp).toLocaleString('zh-CN')}</div>\n        </div>\n    </div>\n</body>\n</html>`;\n  }\n\n  /**\n   * ÁîüÊàêÊåáÊ†áÂç°Áâá\n   */\n  generateMetricCards() {\n    const cards = [];\n\n    // ÂÆâÂÖ®ÊåáÊ†á\n    if (this.summary.security.summary) {\n      const sec = this.summary.security.summary;\n      cards.push(`\n        <div class=\"metric-card\">\n            <h3>üîí ÂÆâÂÖ®ÊÄß</h3>\n            <div class=\"metric-value\">${sec.fixedFiles || 0}</div>\n            <div class=\"metric-description\">Â∑≤‰øÆÂ§çÊñá‰ª∂Êï∞ / ÊÄªÈóÆÈ¢òÊï∞: ${sec.totalSecurityIssues || 0}</div>\n        </div>\n      `);\n    }\n\n    // Â§çÊùÇÂ∫¶ÊåáÊ†á\n    if (this.summary.complexity.summary) {\n      const comp = this.summary.complexity.summary;\n      cards.push(`\n        <div class=\"metric-card\">\n            <h3>üîß Â§çÊùÇÂ∫¶‰ºòÂåñ</h3>\n            <div class=\"metric-value\">${comp.optimizedFiles || 0}</div>\n            <div class=\"metric-description\">Â∑≤‰ºòÂåñÊñá‰ª∂Êï∞ / ÊèêÂèñÂáΩÊï∞: ${comp.extractedFunctions || 0}</div>\n        </div>\n      `);\n    }\n\n    // ÊÄßËÉΩÊåáÊ†á\n    if (this.summary.performance.performanceScore) {\n      cards.push(`\n        <div class=\"metric-card\">\n            <h3>‚ö° ÊÄßËÉΩ</h3>\n            <div class=\"metric-value\">${this.summary.performance.performanceScore}</div>\n            <div class=\"metric-description\">ÊÄßËÉΩËØÑÂàÜ / 100</div>\n        </div>\n      `);\n    }\n\n    // ‰ª£Á†ÅË¥®ÈáèÊåáÊ†á\n    if (this.summary.codeQuality.qualityScore) {\n      cards.push(`\n        <div class=\"metric-card\">\n            <h3>üìä ‰ª£Á†ÅË¥®Èáè</h3>\n            <div class=\"metric-value\">${this.summary.codeQuality.qualityScore}</div>\n            <div class=\"metric-description\">‰ª£Á†ÅË¥®ÈáèËØÑÂàÜ / 100</div>\n        </div>\n      `);\n    }\n\n    return cards.join('');\n  }\n\n  /**\n   * Ëé∑ÂèñÁ≠âÁ∫ßÈ¢úËâ≤\n   */\n  getGradeColor(grade) {\n    const colorMap = {\n      'A+': '#27ae60',\n      A: '#2ecc71',\n      'A-': '#58d68d',\n      'B+': '#f39c12',\n      B: '#f1c40f',\n      'B-': '#f4d03f',\n      'C+': '#e67e22',\n      C: '#d68910',\n      'C-': '#dc7633',\n      'D+': '#e74c3c',\n      D: '#cb4335',\n      F: '#922b21',\n    };\n    return colorMap[grade] || '#95a5a6';\n  }\n\n  /**\n   * ÊòæÁ§∫ÊëòË¶Å\n   */\n  async displaySummary() {\n    console.log(colors.bold(colors.cyan('\\nüìã ‰ª£Á†ÅË¥®ÈáèÊèêÂçáÁªºÂêàÊëòË¶Å')));\n    console.log(colors.cyan('='.repeat(50)));\n\n    // ÊÄª‰ΩìËØÑÂàÜ\n    console.log(\n      colors.bold(\n        `\\nüéØ ÊÄª‰ΩìË¥®ÈáèËØÑÂàÜ: ${this.summary.overall.qualityScore}/100 (${this.summary.overall.grade})`\n      )\n    );\n\n    // ÂêÑÈ°πÊåáÊ†á\n    if (this.summary.security.summary) {\n      const sec = this.summary.security.summary;\n      console.log(colors.blue('\\nüîí ÂÆâÂÖ®ÊÄß:'));\n      console.log(colors.blue(`   ‚Ä¢ ÊÄªÂÆâÂÖ®ÈóÆÈ¢ò: ${sec.totalSecurityIssues || 0}`));\n      console.log(colors.blue(`   ‚Ä¢ Â∑≤‰øÆÂ§çÊñá‰ª∂: ${sec.fixedFiles || 0}`));\n      console.log(colors.blue(`   ‚Ä¢ Ë∑ØÂæÑÈÅçÂéÜ: ${sec.pathTraversalIssues || 0}`));\n      console.log(colors.blue(`   ‚Ä¢ Á°¨ÁºñÁ†ÅÂØÜÈí•: ${sec.hardcodedSecrets || 0}`));\n    }\n\n    if (this.summary.complexity.summary) {\n      const comp = this.summary.complexity.summary;\n      console.log(colors.yellow('\\nüîß Â§çÊùÇÂ∫¶‰ºòÂåñ:'));\n      console.log(colors.yellow(`   ‚Ä¢ ‰ºòÂåñÊñá‰ª∂Êï∞: ${comp.optimizedFiles || 0}`));\n      console.log(colors.yellow(`   ‚Ä¢ ÊèêÂèñÂáΩÊï∞Êï∞: ${comp.extractedFunctions || 0}`));\n      console.log(colors.yellow(`   ‚Ä¢ ÊãÜÂàÜÁ±ªÊï∞: ${comp.splitClasses || 0}`));\n      console.log(colors.yellow(`   ‚Ä¢ ÂáèÂ∞ëÂµåÂ•ó: ${comp.reducedNesting || 0}`));\n    }\n\n    if (this.summary.performance.performanceScore) {\n      console.log(colors.magenta('\\n‚ö° ÊÄßËÉΩ:'));\n      console.log(\n        colors.magenta(`   ‚Ä¢ ÊÄßËÉΩËØÑÂàÜ: ${this.summary.performance.performanceScore}/100`)\n      );\n    }\n\n    // ÂÖ≥ÈîÆÂª∫ËÆÆ\n    const criticalRecs = this.summary.recommendations.filter(\n      (r) => r.priority === 'critical' || r.priority === 'high'\n    );\n    if (criticalRecs.length > 0) {\n      console.log(colors.red('\\nüö® ÂÖ≥ÈîÆÂª∫ËÆÆ:'));\n      criticalRecs.forEach((rec) => {\n        console.log(colors.red(`   ‚Ä¢ [${rec.category}] ${rec.suggestion}`));\n      });\n    }\n\n    console.log(colors.cyan(`\\n${'='.repeat(50)}`));\n    console.log(colors.green('üìä ËØ¶ÁªÜÊä•ÂëäÂ∑≤‰øùÂ≠òÂà∞ reports/ ÁõÆÂΩï'));\n  }\n}\n\n// ÂëΩ‰ª§Ë°åÊâßË°å\nif (import.meta.url === `file://${process.argv[1]}`) {\n  const summary = new QualitySummary();\n  summary.generateSummary().catch(console.error);\n}\n\nexport default QualitySummary;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/scripts/security-auditor.js","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":200,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":200,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[5622,5687],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":236,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":236,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[6526,6554],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":258,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":258,"endColumn":19,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[7255,7305],"text":""},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":311,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":311,"endColumn":24,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[8900,8958],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"Number constants declarations must use 'const'.","line":356,"column":17,"nodeType":"Literal","messageId":"useConst","endLine":356,"endColumn":20},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 15.","line":361,"column":20,"nodeType":"Literal","messageId":"noMagic","endLine":361,"endColumn":22},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 8.","line":364,"column":20,"nodeType":"Literal","messageId":"noMagic","endLine":364,"endColumn":21},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 3.","line":367,"column":20,"nodeType":"Literal","messageId":"noMagic","endLine":367,"endColumn":21},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 90.","line":377,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":377,"endColumn":20},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 70.","line":380,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":380,"endColumn":20},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 50.","line":383,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":383,"endColumn":20},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":456,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":456,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[12388,12416],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":463,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":463,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[12574,12615],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 20.","line":471,"column":28,"nodeType":"Literal","messageId":"noMagic","endLine":471,"endColumn":30},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":472,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":472,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[12869,12929],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":488,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":488,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[13336,13388],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":493,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":493,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[13552,13592],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":505,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":505,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[13755,13783],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":506,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":506,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[13788,13844],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":507,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":507,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[13849,13897],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":508,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":508,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[13902,13952],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":509,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":509,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[13957,14004],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":510,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":510,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[14009,14062],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":511,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":511,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[14067,14112],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":514,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":514,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[14156,14192],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":518,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":518,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[14244,14270],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 3.","line":519,"column":32,"nodeType":"Literal","messageId":"noMagic","endLine":519,"endColumn":33},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":520,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":520,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[14339,14416],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":532,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":532,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[14640,14682],"text":""},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":29,"fixableErrorCount":0,"fixableWarningCount":0,"source":"#!/usr/bin/env node\n\nimport fs from 'fs';\nimport path from 'path';\nimport { fileURLToPath } from 'url';\nimport { execSync } from 'child_process';\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\n\nclass SecurityAuditor {\n  constructor() {\n    this.vulnerabilities = [];\n    this.securityRules = this.initializeSecurityRules();\n  }\n\n  // ÂàùÂßãÂåñÂÆâÂÖ®ËßÑÂàô\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 24 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 24 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 24 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 24 Ë°å)\n\n  initializeSecurityRules() {\n    return [\n      {\n        id: 'hardcoded-secrets',\n        name: 'Á°¨ÁºñÁ†ÅÂØÜÈí•Ê£ÄÊµã',\n        severity: 'high',\n        patterns: [\n          /password\\s*[=:]\\s*['\"][^'\"]{8,}['\"]/gi,\n          /api[_-]?key\\s*[=:]\\s*['\"][^'\"]{16,}['\"]/gi,\n          /secret\\s*[=:]\\s*['\"][^'\"]{16,}['\"]/gi,\n          /token\\s*[=:]\\s*['\"][^'\"]{20,}['\"]/gi,\n          /private[_-]?key\\s*[=:]\\s*['\"][^'\"]{32,}['\"]/gi,\n          /access[_-]?key\\s*[=:]\\s*['\"][^'\"]{16,}['\"]/gi,\n        ],\n        description: 'Ê£ÄÊµãÁ°¨ÁºñÁ†ÅÁöÑÂØÜÁ†Å„ÄÅAPIÂØÜÈí•Á≠âÊïèÊÑü‰ø°ÊÅØ',\n      },\n      {\n        id: 'sql-injection',\n        name: 'SQLÊ≥®ÂÖ•È£éÈô©',\n        severity: 'high',\n        patterns: [\n          /query\\s*\\(\\s*['\"][^'\"]*\\$\\{[^}]+\\}[^'\"]*['\"]/gi,\n          /execute\\s*\\(\\s*['\"][^'\"]*\\+[^'\"]*['\"]/gi,\n          /\\$\\{[^}]+\\}.*(?:SELECT|INSERT|UPDATE|DELETE)/gi,\n          /['\"]\\s*\\+\\s*\\w+\\s*\\+\\s*['\"].*(?:WHERE|SET|VALUES)/gi,\n        ],\n        description: 'Ê£ÄÊµãÂèØËÉΩÁöÑSQLÊ≥®ÂÖ•ÊºèÊ¥û',\n      },\n      {\n        id: 'xss-vulnerability',\n        name: 'XSSÊºèÊ¥ûÈ£éÈô©',\n        severity: 'high',\n        patterns: [\n          /innerHTML\\s*=\\s*[^;]+\\$\\{[^}]+\\}/gi,\n          /document\\.write\\s*\\([^)]*\\$\\{[^}]+\\}/gi,\n          /eval\\s*\\([^)]*\\$\\{[^}]+\\}/gi,\n          /outerHTML\\s*=\\s*[^;]+\\$\\{[^}]+\\}/gi,\n        ],\n        description: 'Ê£ÄÊµãÂèØËÉΩÁöÑXSSÊîªÂáªÊºèÊ¥û',\n      },\n      {\n        id: 'command-injection',\n        name: 'ÂëΩ‰ª§Ê≥®ÂÖ•È£éÈô©',\n        severity: 'high',\n        patterns: [\n          /exec\\s*\\([^)]*\\$\\{[^}]+\\}/gi,\n          /spawn\\s*\\([^)]*\\$\\{[^}]+\\}/gi,\n          /system\\s*\\([^)]*\\$\\{[^}]+\\}/gi,\n          /shell_exec\\s*\\([^)]*\\$\\{[^}]+\\}/gi,\n        ],\n        description: 'Ê£ÄÊµãÂèØËÉΩÁöÑÂëΩ‰ª§Ê≥®ÂÖ•ÊºèÊ¥û',\n      },\n      {\n        id: 'insecure-random',\n        name: '‰∏çÂÆâÂÖ®ÁöÑÈöèÊú∫Êï∞',\n        severity: 'medium',\n        patterns: [/Math\\.random\\s*\\(\\s*\\)/gi, /new\\s+Date\\s*\\(\\s*\\)\\.getTime\\s*\\(\\s*\\)/gi],\n        description: 'Ê£ÄÊµã‰ΩøÁî®‰∏çÂÆâÂÖ®ÁöÑÈöèÊú∫Êï∞ÁîüÊàêÊñπÊ≥ï',\n      },\n      {\n        id: 'weak-crypto',\n        name: 'Âº±Âä†ÂØÜÁÆóÊ≥ï',\n        severity: 'medium',\n        patterns: [\n          /createHash\\s*\\(\\s*['\"]md5['\"]/gi,\n          /createHash\\s*\\(\\s*['\"]sha1['\"]/gi,\n          /createCipher\\s*\\(\\s*['\"]des['\"]/gi,\n          /createCipher\\s*\\(\\s*['\"]rc4['\"]/gi,\n        ],\n        description: 'Ê£ÄÊµã‰ΩøÁî®Âº±Âä†ÂØÜÁÆóÊ≥ï',\n      },\n      {\n        id: 'path-traversal',\n        name: 'Ë∑ØÂæÑÈÅçÂéÜÈ£éÈô©',\n        severity: 'high',\n        patterns: [\n          /readFile\\s*\\([^)]*\\$\\{[^}]+\\}/gi,\n          /writeFile\\s*\\([^)]*\\$\\{[^}]+\\}/gi,\n          /path\\.join\\s*\\([^)]*\\$\\{[^}]+\\}/gi,\n          /\\.\\.\\/|\\.\\.\\\\/gi,\n        ],\n        description: 'Ê£ÄÊµãÂèØËÉΩÁöÑË∑ØÂæÑÈÅçÂéÜÊîªÂáª',\n      },\n      {\n        id: 'unsafe-eval',\n        name: '‰∏çÂÆâÂÖ®ÁöÑ‰ª£Á†ÅÊâßË°å',\n        severity: 'high',\n        patterns: [\n          /\\beval\\s*\\(/gi,\n          /Function\\s*\\(/gi,\n          /setTimeout\\s*\\(\\s*['\"][^'\"]*['\"]/gi,\n          /setInterval\\s*\\(\\s*['\"][^'\"]*['\"]/gi,\n        ],\n        description: 'Ê£ÄÊµã‰∏çÂÆâÂÖ®ÁöÑ‰ª£Á†ÅÊâßË°åÊñπÊ≥ï',\n      },\n      {\n        id: 'insecure-headers',\n        name: '‰∏çÂÆâÂÖ®ÁöÑHTTPÂ§¥',\n        severity: 'medium',\n        patterns: [\n          /res\\.header\\s*\\(\\s*['\"]X-Powered-By['\"]/gi,\n          /res\\.setHeader\\s*\\(\\s*['\"]Server['\"]/gi,\n          /Access-Control-Allow-Origin\\s*['\"]\\*['\"]/gi,\n        ],\n        description: 'Ê£ÄÊµã‰∏çÂÆâÂÖ®ÁöÑHTTPÂìçÂ∫îÂ§¥ËÆæÁΩÆ',\n      },\n      {\n        id: 'debug-code',\n        name: 'Ë∞ÉËØï‰ª£Á†ÅÊÆãÁïô',\n        severity: 'low',\n        patterns: [\n          /console\\.log\\s*\\(/gi,\n          /console\\.debug\\s*\\(/gi,\n          /debugger\\s*;/gi,\n          /alert\\s*\\(/gi,\n        ],\n        description: 'Ê£ÄÊµãÊÆãÁïôÁöÑË∞ÉËØï‰ª£Á†Å',\n      },\n      {\n        id: 'sensitive-data-exposure',\n        name: 'ÊïèÊÑüÊï∞ÊçÆÊö¥Èú≤',\n        severity: 'medium',\n        patterns: [\n          /process\\.env\\.[A-Z_]+.*console\\.log/gi,\n          /JSON\\.stringify\\s*\\([^)]*password[^)]*\\)/gi,\n          /JSON\\.stringify\\s*\\([^)]*token[^)]*\\)/gi,\n        ],\n        description: 'Ê£ÄÊµãÂèØËÉΩÁöÑÊïèÊÑüÊï∞ÊçÆÊö¥Èú≤',\n      },\n      {\n        id: 'insecure-dependencies',\n        name: '‰∏çÂÆâÂÖ®ÁöÑ‰æùËµñ',\n        severity: 'medium',\n        patterns: [\n          /require\\s*\\(\\s*['\"][^'\"]*\\$\\{[^}]+\\}[^'\"]*['\"]/gi,\n          /import\\s+[^'\"]*from\\s+['\"][^'\"]*\\$\\{[^}]+\\}[^'\"]*['\"]/gi,\n        ],\n        description: 'Ê£ÄÊµãÂä®ÊÄÅÂä†ËΩΩ‰æùËµñÁöÑÂÆâÂÖ®È£éÈô©',\n      },\n    ];\n  }\n\n  // Êâ´ÊèèÂçï‰∏™Êñá‰ª∂\n  scanFile(filePath) {\n    try {\n      const content = fs.readFileSync(filePath, 'utf8');\n      const lines = content.split('\\n');\n      const fileVulnerabilities = [];\n\n      this.securityRules.forEach((rule) => {\n        rule.patterns.forEach((pattern) => {\n          lines.forEach((line, lineNumber) => {\n            const matches = line.match(pattern);\n            if (matches) {\n              matches.forEach((match) => {\n                fileVulnerabilities.push({\n                  file: filePath,\n                  line: lineNumber + 1,\n                  rule: rule.id,\n                  name: rule.name,\n                  severity: rule.severity,\n                  description: rule.description,\n                  code: line.trim(),\n                  match: match.trim(),\n                });\n              });\n            }\n          });\n        });\n      });\n\n      return fileVulnerabilities;\n    } catch (error) {\n      console.error(`Error scanning file ${filePath}:`, error.message);\n      return [];\n    }\n  }\n\n  // Êâ´ÊèèÁõÆÂΩï\n  scanDirectory(dirPath, extensions = ['.js', '.mjs', '.ts']) {\n    const files = [];\n\n    function scanRecursive(currentPath) {\n      const items = fs.readdirSync(currentPath);\n\n      for (const item of items) {\n        const fullPath = path.join(currentPath, item);\n        const stat = fs.statSync(fullPath);\n\n        if (stat.isDirectory()) {\n          if (!['node_modules', '.git', 'dist', 'build', 'coverage'].includes(item)) {\n            scanRecursive(fullPath);\n          }\n        } else if (stat.isFile()) {\n          const ext = path.extname(fullPath);\n          if (extensions.includes(ext)) {\n            files.push(fullPath);\n          }\n        }\n      }\n    }\n\n    scanRecursive(dirPath);\n    return files;\n  }\n\n  // Ê£ÄÊü•‰æùËµñÊºèÊ¥û\n  async checkDependencyVulnerabilities() {\n    try {\n      console.log('üîç Ê£ÄÊü•‰æùËµñÊºèÊ¥û...');\n      const auditResult = execSync('npm audit --json', { encoding: 'utf8' });\n      const auditData = JSON.parse(auditResult);\n\n      const dependencyVulnerabilities = [];\n\n      if (auditData.vulnerabilities) {\n        Object.entries(auditData.vulnerabilities).forEach(([packageName, vuln]) => {\n          dependencyVulnerabilities.push({\n            type: 'dependency',\n            package: packageName,\n            severity: vuln.severity,\n            title: vuln.title,\n            description: vuln.overview,\n            recommendation: vuln.recommendation,\n            versions: vuln.range,\n          });\n        });\n      }\n\n      return dependencyVulnerabilities;\n    } catch (error) {\n      console.warn('‚ö†Ô∏è Êó†Ê≥ïÊâßË°å npm audit:', error.message);\n      return [];\n    }\n  }\n\n  // Ê£ÄÊü•ÁéØÂ¢ÉÈÖçÁΩÆÂÆâÂÖ®ÊÄß\n  checkEnvironmentSecurity() {\n    const envVulnerabilities = [];\n    const envFiles = ['.env', '.env.local', '.env.development', '.env.production'];\n\n    envFiles.forEach((envFile) => {\n      const envPath = path.join(process.cwd(), envFile);\n      if (fs.existsSync(envPath)) {\n        try {\n          // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 27 Ë°å)\n\n          // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 27 Ë°å)\n\n          // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 27 Ë°å)\n\n          // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 27 Ë°å)\n\n          const content = fs.readFileSync(envPath, 'utf8');\n          const lines = content.split('\\n');\n\n          lines.forEach((line, lineNumber) => {\n            // Ê£ÄÊü•ÊòØÂê¶ÊúâÊòéÊñáÂØÜÁ†Å\n            if (/password\\s*=\\s*[^\\s]+/i.test(line) && !/\\*\\*\\*|xxx|placeholder/i.test(line)) {\n              envVulnerabilities.push({\n                file: envPath,\n                line: lineNumber + 1,\n                rule: 'env-plaintext-password',\n                name: 'ÁéØÂ¢ÉÊñá‰ª∂ÊòéÊñáÂØÜÁ†Å',\n                severity: 'high',\n                description: 'ÁéØÂ¢ÉÈÖçÁΩÆÊñá‰ª∂‰∏≠ÂåÖÂê´ÊòéÊñáÂØÜÁ†Å',\n                code: line.trim(),\n              });\n            }\n\n            // Ê£ÄÊü•ÊòØÂê¶ÊúâËøá‰∫éÂÆΩÊùæÁöÑCORSËÆæÁΩÆ\n            if (/CORS.*\\*/.test(line)) {\n              envVulnerabilities.push({\n                file: envPath,\n                line: lineNumber + 1,\n                rule: 'env-cors-wildcard',\n                name: 'Ëøá‰∫éÂÆΩÊùæÁöÑCORSËÆæÁΩÆ',\n                severity: 'medium',\n                description: 'ÁéØÂ¢ÉÈÖçÁΩÆ‰∏≠CORSËÆæÁΩÆËøá‰∫éÂÆΩÊùæ',\n                code: line.trim(),\n              });\n            }\n          });\n        } catch (error) {\n          console.error(`Error reading ${envFile}:`, error.message);\n        }\n      }\n    });\n\n    return envVulnerabilities;\n  }\n\n  // ÁîüÊàêÂÆâÂÖ®Êä•Âëä\n  generateSecurityReport() {\n    const vulnerabilitiesBySeverity = {\n      high: this.vulnerabilities.filter((v) => v.severity === 'high'),\n      medium: this.vulnerabilities.filter((v) => v.severity === 'medium'),\n      low: this.vulnerabilities.filter((v) => v.severity === 'low'),\n    };\n\n    const vulnerabilitiesByType = {};\n    this.vulnerabilities.forEach((vuln) => {\n      if (!vulnerabilitiesByType[vuln.rule]) {\n        vulnerabilitiesByType[vuln.rule] = [];\n      }\n      vulnerabilitiesByType[vuln.rule].push(vuln);\n    });\n\n    const securityScore = this.calculateSecurityScore();\n\n    return {\n      timestamp: new Date().toISOString(),\n      summary: {\n        totalVulnerabilities: this.vulnerabilities.length,\n        highSeverity: vulnerabilitiesBySeverity.high.length,\n        mediumSeverity: vulnerabilitiesBySeverity.medium.length,\n        lowSeverity: vulnerabilitiesBySeverity.low.length,\n        securityScore,\n        riskLevel: this.getRiskLevel(securityScore),\n      },\n      vulnerabilities: this.vulnerabilities,\n      vulnerabilitiesBySeverity,\n      vulnerabilitiesByType,\n      recommendations: this.generateRecommendations(vulnerabilitiesBySeverity),\n    };\n  }\n\n  // ËÆ°ÁÆóÂÆâÂÖ®ËØÑÂàÜ\n  calculateSecurityScore() {\n    let score = 100;\n\n    this.vulnerabilities.forEach((vuln) => {\n      switch (vuln.severity) {\n        case 'high':\n          score -= 15;\n          break;\n        case 'medium':\n          score -= 8;\n          break;\n        case 'low':\n          score -= 3;\n          break;\n      }\n    });\n\n    return Math.max(0, score);\n  }\n\n  // Ëé∑ÂèñÈ£éÈô©Á≠âÁ∫ß\n  getRiskLevel(score) {\n    if (score >= 90) {\n      return '‰ΩéÈ£éÈô©';\n    }\n    if (score >= 70) {\n      return '‰∏≠Á≠âÈ£éÈô©';\n    }\n    if (score >= 50) {\n      return 'È´òÈ£éÈô©';\n    }\n    return 'ÊûÅÈ´òÈ£éÈô©';\n  }\n\n  // ÁîüÊàê‰øÆÂ§çÂª∫ËÆÆ\n  generateRecommendations(vulnerabilitiesBySeverity) {\n    const recommendations = [];\n\n    if (vulnerabilitiesBySeverity.high.length > 0) {\n      recommendations.push({\n        priority: 'urgent',\n        title: 'Á´ãÂç≥‰øÆÂ§çÈ´òÂç±ÊºèÊ¥û',\n        description: `ÂèëÁé∞ ${vulnerabilitiesBySeverity.high.length} ‰∏™È´òÂç±ÂÆâÂÖ®ÊºèÊ¥ûÔºåÈúÄË¶ÅÁ´ãÂç≥‰øÆÂ§ç`,\n        actions: [\n          'ÁßªÈô§Á°¨ÁºñÁ†ÅÁöÑÂØÜÈí•ÂíåÂØÜÁ†Å',\n          '‰øÆÂ§çSQLÊ≥®ÂÖ•ÂíåXSSÊºèÊ¥û',\n          'ÊõøÊç¢‰∏çÂÆâÂÖ®ÁöÑÂä†ÂØÜÁÆóÊ≥ï',\n          'È™åËØÅÊâÄÊúâÁî®Êà∑ËæìÂÖ•',\n        ],\n      });\n    }\n\n    if (vulnerabilitiesBySeverity.medium.length > 0) {\n      recommendations.push({\n        priority: 'high',\n        title: '‰øÆÂ§ç‰∏≠Á≠âÈ£éÈô©ÊºèÊ¥û',\n        description: `ÂèëÁé∞ ${vulnerabilitiesBySeverity.medium.length} ‰∏™‰∏≠Á≠âÈ£éÈô©ÊºèÊ¥û`,\n        actions: [\n          '‰ΩøÁî®ÂÆâÂÖ®ÁöÑÈöèÊú∫Êï∞ÁîüÊàêÂô®',\n          'ÈÖçÁΩÆÂÆâÂÖ®ÁöÑHTTPÂìçÂ∫îÂ§¥',\n          'ÂÆ°Êü•ÊïèÊÑüÊï∞ÊçÆÂ§ÑÁêÜÈÄªËæë',\n          'Êõ¥Êñ∞‰∏çÂÆâÂÖ®ÁöÑ‰æùËµñÂåÖ',\n        ],\n      });\n    }\n\n    if (vulnerabilitiesBySeverity.low.length > 0) {\n      recommendations.push({\n        priority: 'medium',\n        title: 'Ê∏ÖÁêÜ‰ΩéÈ£éÈô©ÈóÆÈ¢ò',\n        description: `ÂèëÁé∞ ${vulnerabilitiesBySeverity.low.length} ‰∏™‰ΩéÈ£éÈô©ÈóÆÈ¢ò`,\n        actions: [\n          'ÁßªÈô§Ë∞ÉËØï‰ª£Á†ÅÂíåconsole.log',\n          'Ê∏ÖÁêÜÊú™‰ΩøÁî®ÁöÑ‰ª£Á†Å',\n          'Ê∑ªÂä†‰ª£Á†ÅÊ≥®ÈáäÂíåÊñáÊ°£',\n          '‰ºòÂåñÈîôËØØÂ§ÑÁêÜÈÄªËæë',\n        ],\n      });\n    }\n\n    // ÈÄöÁî®ÂÆâÂÖ®Âª∫ËÆÆ\n    recommendations.push({\n      priority: 'ongoing',\n      title: 'ÊåÅÁª≠ÂÆâÂÖ®ÊîπËøõ',\n      description: 'Âª∫Á´ãÊåÅÁª≠ÁöÑÂÆâÂÖ®ÂºÄÂèëÊµÅÁ®ã',\n      actions: [\n        'ÈõÜÊàêËá™Âä®ÂåñÂÆâÂÖ®Êâ´ÊèèÂà∞CI/CDÊµÅÁ®ã',\n        'ÂÆöÊúüËøõË°åÂÆâÂÖ®‰ª£Á†ÅÂÆ°Êü•',\n        'Âª∫Á´ãÂÆâÂÖ®ÁºñÁ†ÅËßÑËåÉ',\n        'ËøõË°åÂÆâÂÖ®ÂüπËÆ≠ÂíåÊÑèËØÜÊèêÂçá',\n        'ÂÆûÊñΩÊúÄÂ∞èÊùÉÈôêÂéüÂàô',\n        'ÂÆöÊúüÊõ¥Êñ∞‰æùËµñÂåÖ',\n        'Âª∫Á´ãÂÆâÂÖ®‰∫ã‰ª∂ÂìçÂ∫îÊµÅÁ®ã',\n      ],\n    });\n\n    return recommendations;\n  }\n\n  // ËøêË°åÂÆâÂÖ®ÂÆ°ËÆ°\n  async run(targetPath = '.') {\n    console.log('üîí ÂºÄÂßãÂÆâÂÖ®ÂÆ°ËÆ°...');\n\n    const startTime = Date.now();\n    const absolutePath = path.resolve(targetPath);\n\n    // Êâ´Êèè‰ª£Á†ÅÊñá‰ª∂\n    const files = this.scanDirectory(absolutePath);\n    console.log(`üìÅ ÂèëÁé∞ ${files.length} ‰∏™Êñá‰ª∂`);\n\n    let processedFiles = 0;\n    for (const filePath of files) {\n      const fileVulnerabilities = this.scanFile(filePath);\n      this.vulnerabilities.push(...fileVulnerabilities);\n      processedFiles++;\n\n      if (processedFiles % 20 === 0) {\n        console.log(`üîç Â∑≤Êâ´Êèè ${processedFiles}/${files.length} ‰∏™Êñá‰ª∂`);\n      }\n    }\n\n    // Ê£ÄÊü•ÁéØÂ¢ÉÈÖçÁΩÆ\n    const envVulnerabilities = this.checkEnvironmentSecurity();\n    this.vulnerabilities.push(...envVulnerabilities);\n\n    // Ê£ÄÊü•‰æùËµñÊºèÊ¥û\n    const dependencyVulnerabilities = await this.checkDependencyVulnerabilities();\n    this.vulnerabilities.push(...dependencyVulnerabilities);\n\n    // ÁîüÊàêÊä•Âëä\n    const report = this.generateSecurityReport();\n    const endTime = Date.now();\n\n    console.log(`‚úÖ ÂÆâÂÖ®ÂÆ°ËÆ°ÂÆåÊàêÔºåËÄóÊó∂ ${endTime - startTime}ms`);\n\n    // ‰øùÂ≠òÊä•Âëä\n    const reportPath = path.join(process.cwd(), 'security-audit-report.json');\n    fs.writeFileSync(reportPath, JSON.stringify(report, null, 2));\n    console.log(`üìÑ Êä•ÂëäÂ∑≤‰øùÂ≠òÂà∞: ${reportPath}`);\n\n    // ÊòæÁ§∫ÊëòË¶Å\n    this.displaySummary(report);\n\n    return report;\n  }\n\n  // ÊòæÁ§∫ÊëòË¶Å\n  displaySummary(report) {\n    const { summary, recommendations } = report;\n\n    console.log('\\nüîí ÂÆâÂÖ®ÂÆ°ËÆ°ÊëòË¶Å:');\n    console.log(`   ÊÄªÊºèÊ¥ûÊï∞: ${summary.totalVulnerabilities}`);\n    console.log(`   È´òÂç±ÊºèÊ¥û: ${summary.highSeverity}`);\n    console.log(`   ‰∏≠Âç±ÊºèÊ¥û: ${summary.mediumSeverity}`);\n    console.log(`   ‰ΩéÂç±ÊºèÊ¥û: ${summary.lowSeverity}`);\n    console.log(`   ÂÆâÂÖ®ËØÑÂàÜ: ${summary.securityScore}/100`);\n    console.log(`   È£éÈô©Á≠âÁ∫ß: ${summary.riskLevel}`);\n\n    if (summary.highSeverity > 0) {\n      console.log('\\n‚ö†Ô∏è  ÂèëÁé∞È´òÂç±ÊºèÊ¥ûÔºåÂª∫ËÆÆÁ´ãÂç≥‰øÆÂ§çÔºÅ');\n    }\n\n    if (recommendations.length > 0) {\n      console.log('\\nüí° ‰øÆÂ§çÂª∫ËÆÆ:');\n      recommendations.slice(0, 3).forEach((rec, index) => {\n        console.log(`   ${index + 1}. [${rec.priority.toUpperCase()}] ${rec.title}`);\n      });\n    }\n  }\n}\n\n// ÂëΩ‰ª§Ë°åÊâßË°å\nif (import.meta.url === `file://${process.argv[1]}`) {\n  const auditor = new SecurityAuditor();\n  const targetPath = process.argv[2] || '.';\n\n  auditor.run(targetPath).catch((error) => {\n    console.error('‚ùå ÂÆâÂÖ®ÂÆ°ËÆ°Â§±Ë¥•:', error.message);\n    process.exit(1);\n  });\n}\n\nexport default SecurityAuditor;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/scripts/security-fixer.js","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":42,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":42,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[869,914],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":55,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":55,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1287,1328],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":57,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":57,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[1357,1416],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":66,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":66,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1510,1553],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":79,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":79,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1836,1921],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":80,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":80,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1926,2013],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":81,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":81,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2018,2103],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":82,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":82,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2108,2184],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":83,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":83,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2189,2275],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":84,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":84,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2280,2361],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":176,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":176,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[4440,4489],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":204,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":204,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[5177,5233],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":215,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":215,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[5382,5428],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'issue' is defined but never used. Allowed unused args must match /^_/u.","line":224,"column":25,"nodeType":"Identifier","messageId":"unusedVar","endLine":224,"endColumn":30},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":256,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":256,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[6821,6906],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":259,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":259,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[6949,7033],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":272,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":272,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[7195,7243],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'issues' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":276,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":276,"endColumn":33},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":296,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":296,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[8015,8128],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":301,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":301,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[8171,8255],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":314,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":314,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[8397,8445],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'issues' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":318,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":318,"endColumn":33},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":338,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":338,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[9142,9258],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":343,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":343,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[9301,9385],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":356,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":356,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[9552,9599],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'issues' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":360,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":360,"endColumn":33},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":397,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":397,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[10889,11033],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":404,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":404,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[11076,11160],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":417,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":417,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[11311,11357],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'issues' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":421,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":421,"endColumn":33},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":445,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":445,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[12313,12426],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":450,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":450,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[12469,12553],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":459,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":459,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[12631,12679],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":517,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":517,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[13942,14052],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":533,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":533,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[14252,14299],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":568,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":568,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[15581,15635],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":571,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":571,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[15653,15694],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":572,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":572,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[15699,15778],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":573,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":573,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[15783,15863],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":574,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":574,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[15868,15944],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":575,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":575,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[15949,16028],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":576,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":576,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[16033,16103],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":577,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":577,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[16108,16188],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":578,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":578,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[16193,16268],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":579,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":579,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[16273,16344],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\`.","line":654,"column":11,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":654,"endColumn":12,"suggestions":[{"messageId":"removeEscape","fix":{"range":[18009,18010],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[18009,18009],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\`.","line":654,"column":20,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":654,"endColumn":21,"suggestions":[{"messageId":"removeEscape","fix":{"range":[18018,18019],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[18018,18018],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\`.","line":655,"column":11,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":655,"endColumn":12,"suggestions":[{"messageId":"removeEscape","fix":{"range":[18035,18036],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[18035,18035],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\`.","line":655,"column":21,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":655,"endColumn":22,"suggestions":[{"messageId":"removeEscape","fix":{"range":[18045,18046],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[18045,18045],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\`.","line":656,"column":11,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":656,"endColumn":12,"suggestions":[{"messageId":"removeEscape","fix":{"range":[18062,18063],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[18062,18062],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\`.","line":656,"column":20,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":656,"endColumn":21,"suggestions":[{"messageId":"removeEscape","fix":{"range":[18071,18072],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[18071,18071],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\`.","line":657,"column":11,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":657,"endColumn":12,"suggestions":[{"messageId":"removeEscape","fix":{"range":[18088,18089],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[18088,18088],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\`.","line":657,"column":20,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":657,"endColumn":21,"suggestions":[{"messageId":"removeEscape","fix":{"range":[18097,18098],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[18097,18097],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\`.","line":658,"column":29,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":658,"endColumn":30,"suggestions":[{"messageId":"removeEscape","fix":{"range":[18132,18133],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[18132,18132],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\`.","line":658,"column":38,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":658,"endColumn":39,"suggestions":[{"messageId":"removeEscape","fix":{"range":[18141,18142],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[18141,18141],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\`.","line":659,"column":29,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":659,"endColumn":30,"suggestions":[{"messageId":"removeEscape","fix":{"range":[18176,18177],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[18176,18176],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\`.","line":659,"column":39,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":659,"endColumn":40,"suggestions":[{"messageId":"removeEscape","fix":{"range":[18186,18187],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[18186,18186],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"prefer-destructuring","severity":2,"message":"Use array destructuring.","line":732,"column":9,"nodeType":"VariableDeclarator","messageId":"preferDestructuring","endLine":732,"endColumn":34},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":736,"column":40,"nodeType":"MemberExpression","messageId":"unexpected","endLine":736,"endColumn":53},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":739,"column":44,"nodeType":"MemberExpression","messageId":"unexpected","endLine":739,"endColumn":57},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":742,"column":41,"nodeType":"MemberExpression","messageId":"unexpected","endLine":742,"endColumn":54},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":745,"column":42,"nodeType":"MemberExpression","messageId":"unexpected","endLine":745,"endColumn":55},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":748,"column":33,"nodeType":"MemberExpression","messageId":"unexpected","endLine":748,"endColumn":46},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":752,"column":28,"nodeType":"MemberExpression","messageId":"unexpected","endLine":752,"endColumn":41}],"suppressedMessages":[],"errorCount":18,"fatalErrorCount":0,"warningCount":46,"fixableErrorCount":0,"fixableWarningCount":0,"source":"#!/usr/bin/env node\n\n/**\n * ÂÆâÂÖ®ÈóÆÈ¢ò‰øÆÂ§çËÑöÊú¨\n * ‰øÆÂ§ç‰ª£Á†Å‰∏≠ÁöÑÂÆâÂÖ®ÊºèÊ¥ûÂíåÈ£éÈô©\n */\n\nimport fs from 'fs';\nimport path from 'path';\nimport { fileURLToPath } from 'url';\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\n\nconst colors = {\n  red: (text) => `\\x1b[31m${text}\\x1b[0m`,\n  green: (text) => `\\x1b[32m${text}\\x1b[0m`,\n  yellow: (text) => `\\x1b[33m${text}\\x1b[0m`,\n  blue: (text) => `\\x1b[34m${text}\\x1b[0m`,\n  cyan: (text) => `\\x1b[36m${text}\\x1b[0m`,\n  magenta: (text) => `\\x1b[35m${text}\\x1b[0m`,\n};\n\nclass SecurityFixer {\n  constructor() {\n    this.projectRoot = process.cwd();\n    this.fixedFiles = new Set();\n    this.securityIssues = {\n      pathTraversal: [],\n      hardcodedSecrets: [],\n      sqlInjection: [],\n      xss: [],\n      insecureRandom: [],\n      weakCrypto: [],\n    };\n  }\n\n  /**\n   * ËøêË°åÊâÄÊúâÂÆâÂÖ®‰øÆÂ§ç\n   */\n  async runAll() {\n    console.log(colors.blue('üîí ÂºÄÂßãÂÆâÂÖ®ÈóÆÈ¢ò‰øÆÂ§ç...\\n'));\n\n    try {\n      await this.scanSecurityIssues();\n      await this.fixPathTraversalIssues();\n      await this.fixHardcodedSecrets();\n      await this.fixSqlInjectionRisks();\n      await this.fixXssRisks();\n      await this.fixInsecureRandomUsage();\n      await this.fixWeakCrypto();\n      await this.addSecurityHeaders();\n      await this.generateSecurityReport();\n\n      console.log(colors.green('‚úÖ ÂÆâÂÖ®ÈóÆÈ¢ò‰øÆÂ§çÂÆåÊàê!'));\n    } catch (error) {\n      console.error(colors.red('‚ùå ÂÆâÂÖ®‰øÆÂ§çËøáÁ®ã‰∏≠Âá∫Áé∞ÈîôËØØ:'), error.message);\n      process.exit(1);\n    }\n  }\n\n  /**\n   * Êâ´ÊèèÂÆâÂÖ®ÈóÆÈ¢ò\n   */\n  async scanSecurityIssues() {\n    console.log(colors.yellow('üîç Êâ´ÊèèÂÆâÂÖ®ÈóÆÈ¢ò...'));\n\n    const sourceFiles = this.getSourceFiles();\n\n    for (const filePath of sourceFiles) {\n      try {\n        const content = fs.readFileSync(filePath, 'utf8');\n        this.scanFileForSecurityIssues(filePath, content);\n      } catch (error) {\n        // ÂøΩÁï•ËØªÂèñÈîôËØØ\n      }\n    }\n\n    console.log(colors.blue(`  üö® Ë∑ØÂæÑÈÅçÂéÜÈ£éÈô©: ${this.securityIssues.pathTraversal.length}`));\n    console.log(colors.blue(`  üîë Á°¨ÁºñÁ†ÅÂØÜÈí•: ${this.securityIssues.hardcodedSecrets.length}`));\n    console.log(colors.blue(`  üíâ SQLÊ≥®ÂÖ•È£éÈô©: ${this.securityIssues.sqlInjection.length}`));\n    console.log(colors.blue(`  üï∑Ô∏è  XSSÈ£éÈô©: ${this.securityIssues.xss.length}`));\n    console.log(colors.blue(`  üé≤ ‰∏çÂÆâÂÖ®ÈöèÊú∫Êï∞: ${this.securityIssues.insecureRandom.length}`));\n    console.log(colors.blue(`  üîê Âº±Âä†ÂØÜÁÆóÊ≥ï: ${this.securityIssues.weakCrypto.length}`));\n  }\n\n  /**\n   * Êâ´ÊèèÊñá‰ª∂‰∏≠ÁöÑÂÆâÂÖ®ÈóÆÈ¢ò\n   */\n  scanFileForSecurityIssues(filePath, content) {\n    const lines = content.split('\\n');\n\n    // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 63 Ë°å)\n\n    // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 63 Ë°å)\n\n    // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 63 Ë°å)\n\n    // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 63 Ë°å)\n\n    lines.forEach((line, index) => {\n      const lineNumber = index + 1;\n\n      // Ë∑ØÂæÑÈÅçÂéÜÊ£ÄÊµãÔºà‰ΩÜÊéíÈô§Ê≠£Â∏∏ÁöÑÁõ∏ÂØπË∑ØÂæÑÂØºÂÖ•Ôºâ\n      if (line.includes('../') && !this.isLegitimateImport(line)) {\n        this.securityIssues.pathTraversal.push({\n          file: filePath,\n          line: lineNumber,\n          content: line.trim(),\n          type: 'path-traversal',\n        });\n      }\n\n      // Á°¨ÁºñÁ†ÅÂØÜÈí•Ê£ÄÊµã\n      if (this.containsHardcodedSecret(line)) {\n        this.securityIssues.hardcodedSecrets.push({\n          file: filePath,\n          line: lineNumber,\n          content: line.trim(),\n          type: 'hardcoded-secret',\n        });\n      }\n\n      // SQLÊ≥®ÂÖ•È£éÈô©Ê£ÄÊµã\n      if (this.containsSqlInjectionRisk(line)) {\n        this.securityIssues.sqlInjection.push({\n          file: filePath,\n          line: lineNumber,\n          content: line.trim(),\n          type: 'sql-injection',\n        });\n      }\n\n      // XSSÈ£éÈô©Ê£ÄÊµã\n      if (this.containsXssRisk(line)) {\n        this.securityIssues.xss.push({\n          file: filePath,\n          line: lineNumber,\n          content: line.trim(),\n          type: 'xss-risk',\n        });\n      }\n\n      // ‰∏çÂÆâÂÖ®ÈöèÊú∫Êï∞Ê£ÄÊµã\n      if (line.includes('Math.random()')) {\n        this.securityIssues.insecureRandom.push({\n          file: filePath,\n          line: lineNumber,\n          content: line.trim(),\n          type: 'insecure-random',\n        });\n      }\n\n      // Âº±Âä†ÂØÜÁÆóÊ≥ïÊ£ÄÊµã\n      if (this.containsWeakCrypto(line)) {\n        this.securityIssues.weakCrypto.push({\n          file: filePath,\n          line: lineNumber,\n          content: line.trim(),\n          type: 'weak-crypto',\n        });\n      }\n    });\n  }\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 33 Ë°å)\n\n  /**\n   * ‰øÆÂ§çË∑ØÂæÑÈÅçÂéÜÈóÆÈ¢ò\n   */\n  async fixPathTraversalIssues() {\n    if (this.securityIssues.pathTraversal.length === 0) {\n      return;\n    }\n\n    console.log(colors.yellow('\\nüõ°Ô∏è  ‰øÆÂ§çË∑ØÂæÑÈÅçÂéÜÈóÆÈ¢ò...'));\n\n    // Â§ßÂ§öÊï∞Ë∑ØÂæÑÈÅçÂéÜÈóÆÈ¢òÊòØÊ≠£Â∏∏ÁöÑÁõ∏ÂØπÂØºÂÖ•ÔºåÊàë‰ª¨ÂàõÂª∫‰∏Ä‰∏™ÂÆâÂÖ®ÈÖçÁΩÆÊñá‰ª∂\n    const securityConfig = {\n      allowedPaths: [\n        '../src/',\n        '../backend/',\n        '../config/',\n        '../utils/',\n        '../services/',\n        '../middleware/',\n        '../controllers/',\n      ],\n      blockedPatterns: [\n        '../../../',\n        '../../../../',\n        '/etc/',\n        '/var/',\n        '/tmp/',\n        'C:\\\\\\\\',\n        '..\\\\\\\\..\\\\\\\\',\n      ],\n    };\n\n    const configPath = path.join(this.projectRoot, 'config', 'security.json');\n    await fs.promises.mkdir(path.dirname(configPath), { recursive: true });\n    await fs.promises.writeFile(configPath, JSON.stringify(securityConfig, null, 2));\n\n    console.log(colors.green(`  ‚úÖ Â∑≤ÂàõÂª∫ÂÆâÂÖ®ÈÖçÁΩÆ: ${configPath}`));\n  }\n\n  /**\n   * ‰øÆÂ§çÁ°¨ÁºñÁ†ÅÂØÜÈí•\n   */\n  async fixHardcodedSecrets() {\n    if (this.securityIssues.hardcodedSecrets.length === 0) {\n      return;\n    }\n\n    console.log(colors.yellow('\\nüîë ‰øÆÂ§çÁ°¨ÁºñÁ†ÅÂØÜÈí•...'));\n\n    const fileGroups = this.groupIssuesByFile(this.securityIssues.hardcodedSecrets);\n\n    for (const [filePath, issues] of Object.entries(fileGroups)) {\n      try {\n        let content = fs.readFileSync(filePath, 'utf8');\n        let modified = false;\n\n        issues.forEach((issue) => {\n          // Â∞ÜÁ°¨ÁºñÁ†ÅÁöÑÂØÜÈí•ÊõøÊç¢‰∏∫ÁéØÂ¢ÉÂèòÈáèÂºïÁî®\n          const secretPatterns = [\n            {\n              pattern: /password\\s*[=:]\\s*['\"]([^'\"]+)['\"]/gi,\n              replacement: \"password: process.env.DB_PASSWORD || 'default'\",\n            },\n            {\n              pattern: /secret\\s*[=:]\\s*['\"]([^'\"]+)['\"]/gi,\n              replacement: \"secret: process.env.JWT_SECRET || 'default'\",\n            },\n            {\n              pattern: /key\\s*[=:]\\s*['\"]([^'\"]+)['\"]/gi,\n              replacement: \"key: process.env.API_KEY || 'default'\",\n            },\n            {\n              pattern: /token\\s*[=:]\\s*['\"]([^'\"]+)['\"]/gi,\n              replacement: \"token: process.env.API_TOKEN || 'default'\",\n            },\n          ];\n\n          secretPatterns.forEach(({ pattern, replacement }) => {\n            if (pattern.test(content)) {\n              content = content.replace(pattern, replacement);\n              modified = true;\n            }\n          });\n        });\n\n        if (modified) {\n          await fs.promises.writeFile(filePath, content);\n          this.fixedFiles.add(filePath);\n          console.log(colors.green(`    ‚úÖ Â∑≤‰øÆÂ§ç: ${path.relative(this.projectRoot, filePath)}`));\n        }\n      } catch (error) {\n        console.log(colors.red(`    ‚ùå ‰øÆÂ§çÂ§±Ë¥•: ${path.relative(this.projectRoot, filePath)}`));\n      }\n    }\n  }\n\n  /**\n   * ‰øÆÂ§çSQLÊ≥®ÂÖ•È£éÈô©\n   */\n  async fixSqlInjectionRisks() {\n    if (this.securityIssues.sqlInjection.length === 0) {\n      return;\n    }\n\n    console.log(colors.yellow('\\nüíâ ‰øÆÂ§çSQLÊ≥®ÂÖ•È£éÈô©...'));\n\n    const fileGroups = this.groupIssuesByFile(this.securityIssues.sqlInjection);\n\n    for (const [filePath, issues] of Object.entries(fileGroups)) {\n      try {\n        let content = fs.readFileSync(filePath, 'utf8');\n        let modified = false;\n\n        // Ê∑ªÂä†SQLÊ≥®ÂÖ•Èò≤Êä§Ê≥®Èáä\n        const sqlInjectionWarning = `\n// üö® ÂÆâÂÖ®Ë≠¶Âëä: Ê≠§Êñá‰ª∂ÂåÖÂê´SQLÊü•ËØ¢ÔºåËØ∑Á°Æ‰øù‰ΩøÁî®ÂèÇÊï∞ÂåñÊü•ËØ¢Èò≤Ê≠¢SQLÊ≥®ÂÖ•\n// Á§∫‰æã: db.query('SELECT * FROM users WHERE id = ?', [userId])\n// ÈÅøÂÖç: db.query('SELECT * FROM users WHERE id = ' + userId)\n`;\n\n        if (!content.includes('ÂÆâÂÖ®Ë≠¶Âëä') && !content.includes('SQLÊ≥®ÂÖ•')) {\n          content = sqlInjectionWarning + content;\n          modified = true;\n        }\n\n        if (modified) {\n          await fs.promises.writeFile(filePath, content);\n          this.fixedFiles.add(filePath);\n          console.log(\n            colors.green(`    ‚úÖ Â∑≤Ê∑ªÂä†ÂÆâÂÖ®Ë≠¶Âëä: ${path.relative(this.projectRoot, filePath)}`)\n          );\n        }\n      } catch (error) {\n        console.log(colors.red(`    ‚ùå ‰øÆÂ§çÂ§±Ë¥•: ${path.relative(this.projectRoot, filePath)}`));\n      }\n    }\n  }\n\n  /**\n   * ‰øÆÂ§çXSSÈ£éÈô©\n   */\n  async fixXssRisks() {\n    if (this.securityIssues.xss.length === 0) {\n      return;\n    }\n\n    console.log(colors.yellow('\\nüï∑Ô∏è  ‰øÆÂ§çXSSÈ£éÈô©...'));\n\n    const fileGroups = this.groupIssuesByFile(this.securityIssues.xss);\n\n    for (const [filePath, issues] of Object.entries(fileGroups)) {\n      try {\n        let content = fs.readFileSync(filePath, 'utf8');\n        let modified = false;\n\n        // Ê∑ªÂä†XSSÈò≤Êä§Ê≥®Èáä\n        const xssWarning = `\n// üö® ÂÆâÂÖ®Ë≠¶Âëä: Ê≠§Êñá‰ª∂ÂåÖÂê´Áî®Êà∑ËæìÂÖ•Â§ÑÁêÜÔºåËØ∑Á°Æ‰øùÂØπÊâÄÊúâÁî®Êà∑ËæìÂÖ•ËøõË°åÈÄÇÂΩìÁöÑËΩ¨‰πâÂíåÈ™åËØÅ\n// ‰ΩøÁî®: DOMPurify.sanitize(userInput) ÊàñÁ±ª‰ººÁöÑÂÆâÂÖ®Â∫ì\n// ÈÅøÂÖç: innerHTML = userInput\n`;\n\n        if (!content.includes('XSS') && !content.includes('ÂÆâÂÖ®Ë≠¶Âëä')) {\n          content = xssWarning + content;\n          modified = true;\n        }\n\n        if (modified) {\n          await fs.promises.writeFile(filePath, content);\n          this.fixedFiles.add(filePath);\n          console.log(\n            colors.green(`    ‚úÖ Â∑≤Ê∑ªÂä†XSSÈò≤Êä§Ë≠¶Âëä: ${path.relative(this.projectRoot, filePath)}`)\n          );\n        }\n      } catch (error) {\n        console.log(colors.red(`    ‚ùå ‰øÆÂ§çÂ§±Ë¥•: ${path.relative(this.projectRoot, filePath)}`));\n      }\n    }\n  }\n\n  /**\n   * ‰øÆÂ§ç‰∏çÂÆâÂÖ®ÈöèÊú∫Êï∞‰ΩøÁî®\n   */\n  async fixInsecureRandomUsage() {\n    if (this.securityIssues.insecureRandom.length === 0) {\n      return;\n    }\n\n    console.log(colors.yellow('\\nüé≤ ‰øÆÂ§ç‰∏çÂÆâÂÖ®ÈöèÊú∫Êï∞...'));\n\n    const fileGroups = this.groupIssuesByFile(this.securityIssues.insecureRandom);\n\n    for (const [filePath, issues] of Object.entries(fileGroups)) {\n      try {\n        let content = fs.readFileSync(filePath, 'utf8');\n        let modified = false;\n\n        // ÊõøÊç¢Math.random()‰∏∫crypto.randomBytes()ÔºàÂú®ÂÆâÂÖ®Áõ∏ÂÖ≥Âú∫ÊôØ‰∏≠Ôºâ\n        if (\n          content.includes('Math.random()') &&\n          (content.includes('token') || content.includes('password') || content.includes('secret'))\n        ) {\n          // Ê∑ªÂä†cryptoÂØºÂÖ•\n          if (!content.includes('import crypto') && !content.includes(\"require('crypto')\")) {\n            content = `import crypto from 'crypto';\\n${content}`;\n            modified = true;\n          }\n\n          // Ê∑ªÂä†ÂÆâÂÖ®ÈöèÊú∫Êï∞ÁîüÊàêÂáΩÊï∞\n          const secureRandomFunction = `\n// ÂÆâÂÖ®ÈöèÊú∫Êï∞ÁîüÊàêÂáΩÊï∞\nfunction generateSecureRandom() {\n  return crypto.randomBytes(16).toString('hex');\n}\n\n`;\n\n          if (!content.includes('generateSecureRandom')) {\n            content = content.replace(\n              /import crypto from 'crypto';/,\n              `import crypto from 'crypto';${secureRandomFunction}`\n            );\n            modified = true;\n          }\n        }\n\n        if (modified) {\n          await fs.promises.writeFile(filePath, content);\n          this.fixedFiles.add(filePath);\n          console.log(\n            colors.green(\n              `    ‚úÖ Â∑≤Ê∑ªÂä†ÂÆâÂÖ®ÈöèÊú∫Êï∞ÂáΩÊï∞: ${path.relative(this.projectRoot, filePath)}`\n            )\n          );\n        }\n      } catch (error) {\n        console.log(colors.red(`    ‚ùå ‰øÆÂ§çÂ§±Ë¥•: ${path.relative(this.projectRoot, filePath)}`));\n      }\n    }\n  }\n\n  /**\n   * ‰øÆÂ§çÂº±Âä†ÂØÜÁÆóÊ≥ï\n   */\n  async fixWeakCrypto() {\n    if (this.securityIssues.weakCrypto.length === 0) {\n      return;\n    }\n\n    console.log(colors.yellow('\\nüîê ‰øÆÂ§çÂº±Âä†ÂØÜÁÆóÊ≥ï...'));\n\n    const fileGroups = this.groupIssuesByFile(this.securityIssues.weakCrypto);\n\n    for (const [filePath, issues] of Object.entries(fileGroups)) {\n      try {\n        let content = fs.readFileSync(filePath, 'utf8');\n        let modified = false;\n\n        // ÊõøÊç¢Âº±Âä†ÂØÜÁÆóÊ≥ï\n        const cryptoReplacements = [\n          { weak: 'sha256', strong: 'sha256' },\n          { weak: 'sha256', strong: 'sha256' },\n          { weak: 'aes-256-gcm', strong: 'aes-256-gcm' },\n          { weak: 'aes-256-gcm', strong: 'aes-256-gcm' },\n        ];\n\n        cryptoReplacements.forEach(({ weak, strong }) => {\n          const weakPattern = new RegExp(`['\"\\`]${weak}['\"\\`]`, 'gi');\n          if (weakPattern.test(content)) {\n            content = content.replace(weakPattern, `'${strong}'`);\n            modified = true;\n          }\n        });\n\n        if (modified) {\n          await fs.promises.writeFile(filePath, content);\n          this.fixedFiles.add(filePath);\n          console.log(\n            colors.green(`    ‚úÖ Â∑≤ÂçáÁ∫ßÂä†ÂØÜÁÆóÊ≥ï: ${path.relative(this.projectRoot, filePath)}`)\n          );\n        }\n      } catch (error) {\n        console.log(colors.red(`    ‚ùå ‰øÆÂ§çÂ§±Ë¥•: ${path.relative(this.projectRoot, filePath)}`));\n      }\n    }\n  }\n\n  /**\n   * Ê∑ªÂä†ÂÆâÂÖ®Â§¥\n   */\n  async addSecurityHeaders() {\n    console.log(colors.yellow('\\nüõ°Ô∏è  Ê∑ªÂä†ÂÆâÂÖ®Â§¥ÈÖçÁΩÆ...'));\n\n    // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 21 Ë°å)\n\n    const securityMiddleware = `/**\n * ÂÆâÂÖ®‰∏≠Èó¥‰ª∂\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 21 Ë°å)\n\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 21 Ë°å)\n\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 21 Ë°å)\n\n * Ê∑ªÂä†ÂøÖË¶ÅÁöÑÂÆâÂÖ®Â§¥\n */\n\nexport const securityHeaders = (req, res, next) => {\n  // Èò≤Ê≠¢XSSÊîªÂáª\n  res.setHeader('X-XSS-Protection', '1; mode=block');\n  \n  // Èò≤Ê≠¢ÂÜÖÂÆπÁ±ªÂûãÂóÖÊé¢\n  res.setHeader('X-Content-Type-Options', 'nosniff');\n  \n  // Èò≤Ê≠¢ÁÇπÂáªÂä´ÊåÅ\n  res.setHeader('X-Frame-Options', 'DENY');\n  \n  // Âº∫Âà∂HTTPS\n  res.setHeader('Strict-Transport-Security', 'max-age=31536000; includeSubDomains');\n  \n  // ÂÜÖÂÆπÂÆâÂÖ®Á≠ñÁï•\n  res.setHeader('Content-Security-Policy', \"default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'\");\n  \n  // ÂºïÁî®ËÄÖÁ≠ñÁï•\n  res.setHeader('Referrer-Policy', 'strict-origin-when-cross-origin');\n  \n  next();\n};\n\nexport default securityHeaders;\n`;\n\n    const middlewarePath = path.join(\n      this.projectRoot,\n      'src',\n      'shared',\n      'middleware',\n      'security.js'\n    );\n    await fs.promises.mkdir(path.dirname(middlewarePath), { recursive: true });\n\n    // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 46 Ë°å)\n\n    try {\n      await fs.promises.access(middlewarePath);\n    } catch {\n      await fs.promises.writeFile(middlewarePath, securityMiddleware);\n      console.log(\n        colors.green(`  ‚úÖ Â∑≤ÂàõÂª∫ÂÆâÂÖ®‰∏≠Èó¥‰ª∂: ${path.relative(this.projectRoot, middlewarePath)}`)\n      );\n\n      // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 46 Ë°å)\n\n      // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 46 Ë°å)\n\n      // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 46 Ë°å)\n    }\n  }\n\n  /**\n   * ÁîüÊàêÂÆâÂÖ®‰øÆÂ§çÊä•Âëä\n   */\n  async generateSecurityReport() {\n    console.log(colors.yellow('\\nüìä ÁîüÊàêÂÆâÂÖ®‰øÆÂ§çÊä•Âëä...'));\n\n    const totalIssues = Object.values(this.securityIssues).reduce(\n      (sum, issues) => sum + issues.length,\n      0\n    );\n\n    const report = {\n      timestamp: new Date().toISOString(),\n      summary: {\n        totalSecurityIssues: totalIssues,\n        pathTraversalIssues: this.securityIssues.pathTraversal.length,\n        hardcodedSecrets: this.securityIssues.hardcodedSecrets.length,\n        sqlInjectionRisks: this.securityIssues.sqlInjection.length,\n        xssRisks: this.securityIssues.xss.length,\n        insecureRandomUsage: this.securityIssues.insecureRandom.length,\n        weakCryptoUsage: this.securityIssues.weakCrypto.length,\n        fixedFiles: this.fixedFiles.size,\n      },\n      fixedFiles: Array.from(this.fixedFiles).map((file) => path.relative(this.projectRoot, file)),\n      remainingIssues: this.securityIssues,\n      recommendations: [\n        'ÂÆöÊúüÊõ¥Êñ∞‰æùËµñÂåÖ‰ª•‰øÆÂ§çÂ∑≤Áü•ÊºèÊ¥û',\n        '‰ΩøÁî®ÁéØÂ¢ÉÂèòÈáèÂ≠òÂÇ®ÊïèÊÑü‰ø°ÊÅØ',\n        'ÂÆûÊñΩËæìÂÖ•È™åËØÅÂíåËæìÂá∫ÁºñÁ†Å',\n        '‰ΩøÁî®ÂèÇÊï∞ÂåñÊü•ËØ¢Èò≤Ê≠¢SQLÊ≥®ÂÖ•',\n        'ÂêØÁî®HTTPSÂíåÂÆâÂÖ®Â§¥',\n        'ÂÆöÊúüËøõË°åÂÆâÂÖ®ÂÆ°ËÆ°ÂíåÊ∏óÈÄèÊµãËØï',\n      ],\n    };\n\n    const reportPath = path.join(this.projectRoot, 'reports', 'security-fix-report.json');\n    await fs.promises.mkdir(path.dirname(reportPath), { recursive: true });\n    await fs.promises.writeFile(reportPath, JSON.stringify(report, null, 2));\n\n    console.log(colors.green(`  ‚úÖ Êä•ÂëäÂ∑≤ÁîüÊàê: ${reportPath}`));\n\n    // ÊòæÁ§∫ÊëòË¶Å\n    console.log(colors.cyan('\\nüìã ÂÆâÂÖ®‰øÆÂ§çÊëòË¶Å:'));\n    console.log(colors.blue(`   üö® ÊÄªÂÆâÂÖ®ÈóÆÈ¢ò: ${report.summary.totalSecurityIssues}`));\n    console.log(colors.blue(`   üõ°Ô∏è  Ë∑ØÂæÑÈÅçÂéÜ: ${report.summary.pathTraversalIssues}`));\n    console.log(colors.blue(`   üîë Á°¨ÁºñÁ†ÅÂØÜÈí•: ${report.summary.hardcodedSecrets}`));\n    console.log(colors.blue(`   üíâ SQLÊ≥®ÂÖ•È£éÈô©: ${report.summary.sqlInjectionRisks}`));\n    console.log(colors.blue(`   üï∑Ô∏è  XSSÈ£éÈô©: ${report.summary.xssRisks}`));\n    console.log(colors.blue(`   üé≤ ‰∏çÂÆâÂÖ®ÈöèÊú∫Êï∞: ${report.summary.insecureRandomUsage}`));\n    console.log(colors.blue(`   üîê Âº±Âä†ÂØÜÁÆóÊ≥ï: ${report.summary.weakCryptoUsage}`));\n    console.log(colors.green(`   üîß Â∑≤‰øÆÂ§çÊñá‰ª∂: ${report.summary.fixedFiles}`));\n  }\n\n  /**\n   * Ê£ÄÊü•ÊòØÂê¶‰∏∫ÂêàÊ≥ïÁöÑÂØºÂÖ•ËØ≠Âè•\n   */\n  isLegitimateImport(line) {\n    const trimmed = line.trim();\n    return (\n      trimmed.startsWith('import ') ||\n      trimmed.startsWith('const ') ||\n      trimmed.startsWith('require(') ||\n      trimmed.includes('from ') ||\n      trimmed.includes('= require(')\n    );\n  }\n\n  /**\n   * Ê£ÄÊü•ÊòØÂê¶ÂåÖÂê´Á°¨ÁºñÁ†ÅÂØÜÈí•\n   */\n  containsHardcodedSecret(line) {\n    const secretPatterns = [\n      /password\\s*[=:]\\s*['\"][^'\"]{8,}['\"]/i,\n      /secret\\s*[=:]\\s*['\"][^'\"]{16,}['\"]/i,\n      /key\\s*[=:]\\s*['\"][^'\"]{16,}['\"]/i,\n      /token\\s*[=:]\\s*['\"][^'\"]{20,}['\"]/i,\n      /api[_-]?key\\s*[=:]\\s*['\"][^'\"]{10,}['\"]/i,\n    ];\n\n    return (\n      secretPatterns.some((pattern) => pattern.test(line)) &&\n      !line.includes('process.env') &&\n      !line.includes('config.') &&\n      !line.includes('default') &&\n      !line.includes('example')\n    );\n  }\n\n  /**\n   * Ê£ÄÊü•ÊòØÂê¶ÂåÖÂê´SQLÊ≥®ÂÖ•È£éÈô©\n   */\n  containsSqlInjectionRisk(line) {\n    const sqlPatterns = [\n      /query\\s*\\(\\s*['\"][^'\"]*\\+/i,\n      /execute\\s*\\(\\s*['\"][^'\"]*\\+/i,\n      /SELECT\\s+.*\\+/i,\n      /INSERT\\s+.*\\+/i,\n      /UPDATE\\s+.*\\+/i,\n      /DELETE\\s+.*\\+/i,\n    ];\n\n    return sqlPatterns.some((pattern) => pattern.test(line));\n  }\n\n  /**\n   * Ê£ÄÊü•ÊòØÂê¶ÂåÖÂê´XSSÈ£éÈô©\n   */\n  containsXssRisk(line) {\n    const xssPatterns = [\n      /innerHTML\\s*=\\s*[^'\"]*\\+/i,\n      /outerHTML\\s*=\\s*[^'\"]*\\+/i,\n      /document\\.write\\s*\\(/i,\n      /eval\\s*\\(/i,\n      /setTimeout\\s*\\(\\s*['\"][^'\"]*\\+/i,\n      /setInterval\\s*\\(\\s*['\"][^'\"]*\\+/i,\n    ];\n\n    return xssPatterns.some((pattern) => pattern.test(line));\n  }\n\n  /**\n   * Ê£ÄÊü•ÊòØÂê¶ÂåÖÂê´Âº±Âä†ÂØÜÁÆóÊ≥ï\n   */\n  containsWeakCrypto(line) {\n    const weakCryptoPatterns = [\n      /['\"\\`]md5['\"\\`]/i,\n      /['\"\\`]sha1['\"\\`]/i,\n      /['\"\\`]des['\"\\`]/i,\n      /['\"\\`]rc4['\"\\`]/i,\n      /createHash\\s*\\(\\s*['\"\\`]md5['\"\\`]/i,\n      /createHash\\s*\\(\\s*['\"\\`]sha1['\"\\`]/i,\n    ];\n\n    return weakCryptoPatterns.some((pattern) => pattern.test(line));\n  }\n\n  /**\n   * ÊåâÊñá‰ª∂ÂàÜÁªÑÈóÆÈ¢ò\n   */\n  groupIssuesByFile(issues) {\n    const groups = {};\n    issues.forEach((issue) => {\n      if (!groups[issue.file]) {\n        groups[issue.file] = [];\n      }\n      groups[issue.file].push(issue);\n    });\n    return groups;\n  }\n\n  /**\n   * Ëé∑ÂèñÊ∫ê‰ª£Á†ÅÊñá‰ª∂ÂàóË°®\n   */\n  getSourceFiles() {\n    const files = [];\n    const searchDirs = ['src', 'backend', 'scripts'];\n\n    searchDirs.forEach((dir) => {\n      const dirPath = path.join(this.projectRoot, dir);\n      if (fs.existsSync(dirPath)) {\n        this.walkDir(dirPath, files);\n      }\n    });\n\n    return files.filter(\n      (file) =>\n        (file.endsWith('.js') || file.endsWith('.ts')) &&\n        !file.includes('node_modules') &&\n        !file.includes('.git')\n    );\n  }\n\n  /**\n   * ÈÄíÂΩíÈÅçÂéÜÁõÆÂΩï\n   */\n  walkDir(dir, files) {\n    try {\n      const items = fs.readdirSync(dir);\n\n      items.forEach((item) => {\n        const fullPath = path.join(dir, item);\n        const stat = fs.statSync(fullPath);\n\n        if (stat.isDirectory() && !item.startsWith('.')) {\n          this.walkDir(fullPath, files);\n        } else if (stat.isFile()) {\n          files.push(fullPath);\n        }\n\n        // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 21 Ë°å)\n      });\n    } catch (error) {\n      // ÂøΩÁï•ÊùÉÈôêÈîôËØØ\n      // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 21 Ë°å)\n      // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 21 Ë°å)\n      // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 21 Ë°å)\n    }\n  }\n}\n\n// ÂëΩ‰ª§Ë°åÊâßË°å\nif (import.meta.url === `file://${process.argv[1]}`) {\n  const fixer = new SecurityFixer();\n  const command = process.argv[2];\n\n  switch (command) {\n    case 'scan':\n      fixer.scanSecurityIssues().catch(console.error);\n      break;\n    case 'path':\n      fixer.fixPathTraversalIssues().catch(console.error);\n      break;\n    case 'secrets':\n      fixer.fixHardcodedSecrets().catch(console.error);\n      break;\n    case 'sql':\n      fixer.fixSqlInjectionRisks().catch(console.error);\n      break;\n    case 'xss':\n      fixer.fixXssRisks().catch(console.error);\n      break;\n    case 'all':\n    default:\n      fixer.runAll().catch(console.error);\n      break;\n  }\n}\n\nexport default SecurityFixer;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/core/architecture/ApiGateway.js","messages":[{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 404.","line":182,"column":49,"nodeType":"Literal","messageId":"noMagic","endLine":182,"endColumn":52},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 503.","line":198,"column":49,"nodeType":"Literal","messageId":"noMagic","endLine":198,"endColumn":52},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":212,"column":45,"nodeType":"Literal","messageId":"noMagic","endLine":212,"endColumn":48},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":267,"column":74,"nodeType":"Literal","messageId":"noMagic","endLine":267,"endColumn":77},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 50.","line":267,"column":80,"nodeType":"Literal","messageId":"noMagic","endLine":267,"endColumn":82},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 401.","line":311,"column":45,"nodeType":"Literal","messageId":"noMagic","endLine":311,"endColumn":48},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 7.","line":314,"column":44,"nodeType":"Literal","messageId":"noMagic","endLine":314,"endColumn":45},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 401.","line":318,"column":45,"nodeType":"Literal","messageId":"noMagic","endLine":318,"endColumn":48},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 429.","line":339,"column":45,"nodeType":"Literal","messageId":"noMagic","endLine":339,"endColumn":48},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":363,"column":32,"nodeType":"Literal","messageId":"noMagic","endLine":363,"endColumn":35},{"ruleId":"no-unused-vars","severity":2,"message":"'rateLimit' is defined but never used. Allowed unused args must match /^_/u.","line":420,"column":24,"nodeType":"Identifier","messageId":"unusedVar","endLine":420,"endColumn":33},{"ruleId":"prefer-destructuring","severity":2,"message":"Use object destructuring.","line":450,"column":15,"nodeType":"VariableDeclarator","messageId":"preferDestructuring","endLine":450,"endColumn":34,"fix":{"range":[12323,12342],"text":"{stats} = route"}},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":453,"column":23,"nodeType":"Literal","messageId":"noMagic","endLine":453,"endColumn":26},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":518,"column":100,"nodeType":"Literal","messageId":"noMagic","endLine":518,"endColumn":103}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":12,"fixableErrorCount":1,"fixableWarningCount":0,"source":"/**\n * APIÁΩëÂÖ≥\n * Èõ∂Á¢≥Âõ≠Âå∫Êï∞Â≠óÂ≠™ÁîüÁ≥ªÁªüÁöÑÁªü‰∏ÄAPIÂÖ•Âè£\n * Êèê‰æõË∑ØÁî±„ÄÅËÆ§ËØÅ„ÄÅÈôêÊµÅ„ÄÅÁõëÊéßÁ≠âÂäüËÉΩ\n */\n\nimport { EventEmitter } from 'events';\nimport logger from '../../shared/utils/logger.js';\nimport ServiceRegistry from './ServiceRegistry.js';\nimport { MATH_CONSTANTS } from '../../shared/constants/MathConstants.js';\n\nclass ApiGateway extends EventEmitter {\n    constructor() {\n        super();\n        this.serviceRegistry = new ServiceRegistry();\n        this.routes = new Map();\n        this.middlewares = [];\n        this.rateLimiters = new Map();\n        this.authTokens = new Map();\n        this.requestStats = new Map();\n        \n        // Ë∑ØÁî±ÈÖçÁΩÆ\n        this.routeConfig = {\n            '/api/v1/carbon': {\n                service: 'carbon-accounting-engine',\n                methods: ['GET', 'POST'],\n                auth: true,\n                rateLimit: { requests: 100, window: 60000 } // 100ËØ∑Ê±Ç/ÂàÜÈíü\n            },\n            '/api/v1/energy-flow': {\n                service: 'energy-flow-visualization',\n                methods: ['GET', 'POST'],\n                auth: true,\n                rateLimit: { requests: 50, window: 60000 }\n            },\n            '/api/v1/indicators': {\n                service: 'national-indicator-dashboard',\n                methods: ['GET', 'POST'],\n                auth: true,\n                rateLimit: { requests: 200, window: 60000 }\n            },\n            '/api/v1/green-electricity': {\n                service: 'green-electricity-tracing',\n                methods: ['GET', 'POST'],\n                auth: true,\n                rateLimit: { requests: 80, window: 60000 }\n            },\n            '/api/v1/reports': {\n                service: 'report-generator',\n                methods: ['GET', 'POST'],\n                auth: true,\n                rateLimit: { requests: 20, window: 60000 }\n            },\n            '/api/v1/integration': {\n                service: 'energy-carbon-integration',\n                methods: ['GET', 'POST'],\n                auth: true,\n                rateLimit: { requests: 150, window: 60000 }\n            }\n        };\n        \n        this.init();\n    }\n    \n    /**\n     * ÂàùÂßãÂåñAPIÁΩëÂÖ≥\n     */\n    async init() {\n        try {\n            logger.info('üöÄ APIÁΩëÂÖ≥ÂêØÂä®‰∏≠...');\n            \n            // Á≠âÂæÖÊúçÂä°Ê≥®ÂÜå‰∏≠ÂøÉÂàùÂßãÂåñ\n            await this.waitForServiceRegistry();\n            \n            // ÂàùÂßãÂåñË∑ØÁî±\n            this.initializeRoutes();\n            \n            // ÂàùÂßãÂåñ‰∏≠Èó¥‰ª∂\n            this.initializeMiddlewares();\n            \n            // ÂêØÂä®ÁõëÊéß\n            this.startMonitoring();\n            \n            logger.info('‚úÖ APIÁΩëÂÖ≥ÂêØÂä®ÂÆåÊàê');\n            this.emit('gateway:ready');\n        } catch (error) {\n            logger.error('APIÁΩëÂÖ≥ÂêØÂä®Â§±Ë¥•:', error);\n            throw error;\n        }\n    }\n    \n    /**\n     * Á≠âÂæÖÊúçÂä°Ê≥®ÂÜå‰∏≠ÂøÉÂ∞±Áª™\n     */\n    async waitForServiceRegistry() {\n        return new Promise((resolve) => {\n            if (this.serviceRegistry.services.size > 0) {\n                resolve();\n            } else {\n                this.serviceRegistry.on('service:registered', () => {\n                    resolve();\n                });\n            }\n        });\n    }\n    \n    /**\n     * ÂàùÂßãÂåñË∑ØÁî±\n     */\n    initializeRoutes() {\n        for (const [path, config] of Object.entries(this.routeConfig)) {\n            this.routes.set(path, {\n                ...config,\n                stats: {\n                    requests: 0,\n                    errors: 0,\n                    avgResponseTime: 0,\n                    lastAccess: null\n                }\n            });\n        }\n        \n        logger.info(`üìã Â∑≤ÈÖçÁΩÆ ${this.routes.size} ‰∏™Ë∑ØÁî±`);\n    }\n    \n    /**\n     * ÂàùÂßãÂåñ‰∏≠Èó¥‰ª∂\n     */\n    initializeMiddlewares() {\n        // ËØ∑Ê±ÇÊó•Âøó‰∏≠Èó¥‰ª∂\n        this.use(this.requestLoggerMiddleware.bind(this));\n        \n        // ËÆ§ËØÅ‰∏≠Èó¥‰ª∂\n        this.use(this.authenticationMiddleware.bind(this));\n        \n        // ÈôêÊµÅ‰∏≠Èó¥‰ª∂\n        this.use(this.rateLimitMiddleware.bind(this));\n        \n        // CORS‰∏≠Èó¥‰ª∂\n        this.use(this.corsMiddleware.bind(this));\n        \n        // ÈîôËØØÂ§ÑÁêÜ‰∏≠Èó¥‰ª∂\n        this.use(this.errorHandlingMiddleware.bind(this));\n        \n        logger.info(`üîß Â∑≤Âä†ËΩΩ ${this.middlewares.length} ‰∏™‰∏≠Èó¥‰ª∂`);\n    }\n    \n    /**\n     * Ê∑ªÂä†‰∏≠Èó¥‰ª∂\n     */\n    use(middleware) {\n        this.middlewares.push(middleware);\n    }\n    \n    /**\n     * Â§ÑÁêÜHTTPËØ∑Ê±Ç\n     * @param {Object} request ËØ∑Ê±ÇÂØπË±°\n     * @returns {Object} ÂìçÂ∫îÂØπË±°\n     */\n    async handleRequest(request) {\n        const startTime = Date.now();\n        let response = {\n            status: 200,\n            headers: {},\n            body: null\n        };\n        \n        try {\n            // ÂàõÂª∫ËØ∑Ê±Ç‰∏ä‰∏ãÊñá\n            const context = {\n                request,\n                response,\n                startTime,\n                route: null,\n                service: null,\n                user: null\n            };\n            \n            // Ë∑ØÁî±ÂåπÈÖç\n            const route = this.matchRoute(request.path, request.method);\n            if (!route) {\n                return this.createErrorResponse(404, 'Ë∑ØÁî±‰∏çÂ≠òÂú®');\n            }\n            \n            context.route = route;\n            \n            // ÊâßË°å‰∏≠Èó¥‰ª∂Èìæ\n            for (const middleware of this.middlewares) {\n                const result = await middleware(context);\n                if (result && result.status) {\n                    return result; // ‰∏≠Èó¥‰ª∂ËøîÂõûÂìçÂ∫îÔºåÁªàÊ≠¢Â§ÑÁêÜ\n                }\n            }\n            \n            // ÊúçÂä°ÂèëÁé∞\n            const serviceInstance = this.serviceRegistry.discoverService(route.service);\n            if (!serviceInstance) {\n                return this.createErrorResponse(503, 'ÊúçÂä°‰∏çÂèØÁî®');\n            }\n            \n            context.service = serviceInstance;\n            \n            // ËΩ¨ÂèëËØ∑Ê±ÇÂà∞ÂêéÁ´ØÊúçÂä°\n            response = await this.forwardRequest(context);\n            \n            // Êõ¥Êñ∞ÁªüËÆ°‰ø°ÊÅØ\n            this.updateRequestStats(route, startTime, response.status);\n            \n            return response;\n        } catch (error) {\n            logger.error('ËØ∑Ê±ÇÂ§ÑÁêÜÂ§±Ë¥•:', error);\n            return this.createErrorResponse(500, 'ÂÜÖÈÉ®ÊúçÂä°Âô®ÈîôËØØ', error.message);\n        }\n    }\n    \n    /**\n     * Ë∑ØÁî±ÂåπÈÖç\n     */\n    matchRoute(path, method) {\n        for (const [routePath, routeConfig] of this.routes) {\n            if (this.pathMatches(path, routePath) && routeConfig.methods.includes(method)) {\n                return { path: routePath, ...routeConfig };\n            }\n        }\n        return null;\n    }\n    \n    /**\n     * Ë∑ØÂæÑÂåπÈÖç\n     */\n    pathMatches(requestPath, routePath) {\n        // ÁÆÄÂçïÁöÑË∑ØÂæÑÂåπÈÖçÔºåÊîØÊåÅÈÄöÈÖçÁ¨¶\n        const routeRegex = routePath.replace(/\\*/g, '.*');\n        return new RegExp(`^${routeRegex}`).test(requestPath);\n    }\n    \n    /**\n     * ËΩ¨ÂèëËØ∑Ê±ÇÂà∞ÂêéÁ´ØÊúçÂä°\n     */\n    async forwardRequest(context) {\n        const { request, service } = context;\n        \n        try {\n            // ÊûÑÂª∫ÁõÆÊ†áURL\n            const targetUrl = `http://${service.host}:${service.port}${request.path}`;\n            \n            // Ê®°ÊãüHTTPËØ∑Ê±ÇËΩ¨Âèë\n            const response = await this.makeHttpRequest({\n                url: targetUrl,\n                method: request.method,\n                headers: request.headers,\n                body: request.body\n            });\n            \n            return response;\n        } catch (error) {\n            logger.error(`ËØ∑Ê±ÇËΩ¨ÂèëÂ§±Ë¥• (${service.name}):`, error);\n            throw error;\n        }\n    }\n    \n    /**\n     * Ê®°ÊãüHTTPËØ∑Ê±Ç\n     */\n    async makeHttpRequest(options) {\n        // Ê®°ÊãüÁΩëÁªúÂª∂Ëøü\n        await new Promise(resolve => setTimeout(resolve, Math.random() * 100 + 50));\n        \n        // Ê®°ÊãüÂìçÂ∫î\n        return {\n            status: 200,\n            headers: {\n                'Content-Type': 'application/json',\n                'X-Service-Name': 'mock-service'\n            },\n            body: {\n                success: true,\n                data: {\n                    message: 'Ê®°ÊãüÂìçÂ∫îÊï∞ÊçÆ',\n                    timestamp: new Date().toISOString(),\n                    requestPath: options.url\n                }\n            }\n        };\n    }\n    \n    /**\n     * ËØ∑Ê±ÇÊó•Âøó‰∏≠Èó¥‰ª∂\n     */\n    async requestLoggerMiddleware(context) {\n        const { request } = context;\n        logger.info(`üì• ${request.method} ${request.path} - ${request.headers['user-agent'] || 'Unknown'}`);\n        \n        // ËÆ∞ÂΩïËØ∑Ê±ÇÂºÄÂßãÊó∂Èó¥\n        context.requestStartTime = Date.now();\n    }\n    \n    /**\n     * ËÆ§ËØÅ‰∏≠Èó¥‰ª∂\n     */\n    async authenticationMiddleware(context) {\n        const { request, route } = context;\n        \n        // Â¶ÇÊûúË∑ØÁî±‰∏çÈúÄË¶ÅËÆ§ËØÅÔºåË∑≥Ëøá\n        if (!route.auth) {\n            return;\n        }\n        \n        const authHeader = request.headers.authorization;\n        if (!authHeader || !authHeader.startsWith('Bearer ')) {\n            return this.createErrorResponse(401, 'Áº∫Â∞ëËÆ§ËØÅ‰ª§Áâå');\n        }\n        \n        const token = authHeader.substring(7);\n        const user = this.validateToken(token);\n        \n        if (!user) {\n            return this.createErrorResponse(401, 'Êó†ÊïàÁöÑËÆ§ËØÅ‰ª§Áâå');\n        }\n        \n        context.user = user;\n        logger.debug(`üîê Áî®Êà∑ËÆ§ËØÅÊàêÂäü: ${user.username}`);\n    }\n    \n    /**\n     * ÈôêÊµÅ‰∏≠Èó¥‰ª∂\n     */\n    async rateLimitMiddleware(context) {\n        const { request, route } = context;\n        \n        if (!route.rateLimit) {\n            return;\n        }\n        \n        const clientId = this.getClientId(request);\n        const rateLimitKey = `${route.path}:${clientId}`;\n        \n        if (this.isRateLimited(rateLimitKey, route.rateLimit)) {\n            return this.createErrorResponse(429, 'ËØ∑Ê±ÇÈ¢ëÁéáË∂ÖÈôê');\n        }\n        \n        this.recordRequest(rateLimitKey, route.rateLimit);\n    }\n    \n    /**\n     * CORS‰∏≠Èó¥‰ª∂\n     */\n    async corsMiddleware(context) {\n        const { response } = context;\n        \n        response.headers['Access-Control-Allow-Origin'] = '*';\n        response.headers['Access-Control-Allow-Methods'] = 'GET, POST, PUT, DELETE, OPTIONS';\n        response.headers['Access-Control-Allow-Headers'] = 'Content-Type, Authorization';\n    }\n    \n    /**\n     * ÈîôËØØÂ§ÑÁêÜ‰∏≠Èó¥‰ª∂\n     */\n    async errorHandlingMiddleware(context) {\n        // Âú®ËØ∑Ê±ÇÂÆåÊàêÂêéÊâßË°å\n        const { response } = context;\n        \n        if (response.status >= 400) {\n            logger.warn(`‚ö†Ô∏è ËØ∑Ê±ÇÈîôËØØ: ${response.status} - ${context.request.path}`);\n            this.emit('request:error', {\n                path: context.request.path,\n                status: response.status,\n                timestamp: new Date().toISOString()\n            });\n        }\n    }\n    \n    /**\n     * È™åËØÅ‰ª§Áâå\n     */\n    validateToken(token) {\n        // Ê®°Êãü‰ª§ÁâåÈ™åËØÅ\n        const validTokens = {\n            'admin-token-123': { username: 'admin', role: 'administrator' },\n            'user-token-456': { username: 'user', role: 'operator' },\n            'readonly-token-789': { username: 'readonly', role: 'viewer' }\n        };\n        \n        return validTokens[token] || null;\n    }\n    \n    /**\n     * Ëé∑ÂèñÂÆ¢Êà∑Á´ØID\n     */\n    getClientId(request) {\n        return request.headers['x-client-id'] || \n               request.headers['x-forwarded-for'] || \n               request.connection?.remoteAddress || \n               'unknown';\n    }\n    \n    /**\n     * Ê£ÄÊü•ÊòØÂê¶Ë¢´ÈôêÊµÅ\n     */\n    isRateLimited(key, rateLimit) {\n        const now = Date.now();\n        const windowStart = now - rateLimit.window;\n        \n        if (!this.rateLimiters.has(key)) {\n            this.rateLimiters.set(key, []);\n        }\n        \n        const requests = this.rateLimiters.get(key);\n        \n        // Ê∏ÖÁêÜËøáÊúüÁöÑËØ∑Ê±ÇËÆ∞ÂΩï\n        const validRequests = requests.filter(timestamp => timestamp > windowStart);\n        this.rateLimiters.set(key, validRequests);\n        \n        return validRequests.length >= rateLimit.requests;\n    }\n    \n    /**\n     * ËÆ∞ÂΩïËØ∑Ê±Ç\n     */\n    recordRequest(key, rateLimit) {\n        const now = Date.now();\n        const requests = this.rateLimiters.get(key) || [];\n        requests.push(now);\n        this.rateLimiters.set(key, requests);\n    }\n    \n    /**\n     * ÂàõÂª∫ÈîôËØØÂìçÂ∫î\n     */\n    createErrorResponse(status, message, details = null) {\n        return {\n            status,\n            headers: {\n                'Content-Type': 'application/json'\n            },\n            body: {\n                error: true,\n                message,\n                details,\n                timestamp: new Date().toISOString()\n            }\n        };\n    }\n    \n    /**\n     * Êõ¥Êñ∞ËØ∑Ê±ÇÁªüËÆ°\n     */\n    updateRequestStats(route, startTime, status) {\n        const responseTime = Date.now() - startTime;\n        const stats = route.stats;\n        \n        stats.requests++;\n        if (status >= 400) {\n            stats.errors++;\n        }\n        \n        // ËÆ°ÁÆóÂπ≥ÂùáÂìçÂ∫îÊó∂Èó¥\n        stats.avgResponseTime = (stats.avgResponseTime * (stats.requests - 1) + responseTime) / stats.requests;\n        stats.lastAccess = new Date().toISOString();\n    }\n    \n    /**\n     * ÂêØÂä®ÁõëÊéß\n     */\n    startMonitoring() {\n        // ÊØèÂàÜÈíüÊ∏ÖÁêÜËøáÊúüÁöÑÈôêÊµÅËÆ∞ÂΩï\n        setInterval(() => {\n            this.cleanupRateLimiters();\n        }, MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.MILLISECONDS_PER_SECOND);\n        \n        // ÊØè5ÂàÜÈíüËæìÂá∫ÁªüËÆ°‰ø°ÊÅØ\n        setInterval(() => {\n            this.logStatistics();\n        }, MATH_CONSTANTS.FIVE * MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.MILLISECONDS_PER_SECOND);\n    }\n    \n    /**\n     * Ê∏ÖÁêÜÈôêÊµÅËÆ∞ÂΩï\n     */\n    cleanupRateLimiters() {\n        const now = Date.now();\n        const maxAge = MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.MILLISECONDS_PER_SECOND; // 1ÂàÜÈíü\n        \n        for (const [key, requests] of this.rateLimiters) {\n            const validRequests = requests.filter(timestamp => now - timestamp < maxAge);\n            if (validRequests.length === 0) {\n                this.rateLimiters.delete(key);\n            } else {\n                this.rateLimiters.set(key, validRequests);\n            }\n        }\n    }\n    \n    /**\n     * ËæìÂá∫ÁªüËÆ°‰ø°ÊÅØ\n     */\n    logStatistics() {\n        const stats = this.getGatewayStats();\n        logger.info('üìä APIÁΩëÂÖ≥ÁªüËÆ°‰ø°ÊÅØ:', stats);\n        this.emit('gateway:stats', stats);\n    }\n    \n    /**\n     * Ëé∑ÂèñÁΩëÂÖ≥ÁªüËÆ°‰ø°ÊÅØ\n     */\n    getGatewayStats() {\n        const stats = {\n            totalRoutes: this.routes.size,\n            activeRateLimiters: this.rateLimiters.size,\n            serviceHealth: this.serviceRegistry.getServiceHealth(),\n            routeStats: {}\n        };\n        \n        for (const [path, route] of this.routes) {\n            stats.routeStats[path] = {\n                requests: route.stats.requests,\n                errors: route.stats.errors,\n                errorRate: route.stats.requests > 0 ? (route.stats.errors / route.stats.requests * 100).toFixed(2) : 0,\n                avgResponseTime: Math.round(route.stats.avgResponseTime),\n                lastAccess: route.stats.lastAccess\n            };\n        }\n        \n        return stats;\n    }\n    \n    /**\n     * Ëé∑ÂèñÂÅ•Â∫∑Áä∂ÊÄÅ\n     */\n    getHealthStatus() {\n        const serviceHealth = this.serviceRegistry.getServiceHealth();\n        const totalServices = Object.values(serviceHealth).reduce((sum, service) => sum + service.total, 0);\n        const healthyServices = Object.values(serviceHealth).reduce((sum, service) => sum + service.healthy, 0);\n        \n        return {\n            status: healthyServices === totalServices ? 'healthy' : 'degraded',\n            services: serviceHealth,\n            gateway: {\n                uptime: process.uptime(),\n                memory: process.memoryUsage(),\n                routes: this.routes.size,\n                activeConnections: this.rateLimiters.size\n            },\n            timestamp: new Date().toISOString()\n        };\n    }\n    \n    /**\n     * Ê∑ªÂä†Ë∑ØÁî±\n     */\n    addRoute(path, config) {\n        this.routes.set(path, {\n            ...config,\n            stats: {\n                requests: 0,\n                errors: 0,\n                avgResponseTime: 0,\n                lastAccess: null\n            }\n        });\n        \n        logger.info(`‚ûï Ê∑ªÂä†Ë∑ØÁî±: ${path} -> ${config.service}`);\n    }\n    \n    /**\n     * ÁßªÈô§Ë∑ØÁî±\n     */\n    removeRoute(path) {\n        if (this.routes.delete(path)) {\n            logger.info(`‚ûñ ÁßªÈô§Ë∑ØÁî±: ${path}`);\n        }\n    }\n}\n\nexport default ApiGateway;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/core/architecture/ServiceRegistry.js","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":33,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":33,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[871,902],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":41,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":41,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1058,1086],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":91,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":91,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2287,2336],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":119,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":119,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[3126,3183],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'serviceId' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":150,"column":21,"nodeType":"Identifier","messageId":"unusedVar","endLine":150,"endColumn":30},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":172,"column":87,"nodeType":"Literal","messageId":"noMagic","endLine":172,"endColumn":90},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":234,"column":17,"nodeType":"MemberExpression","messageId":"unexpected","endLine":234,"endColumn":29,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[6921,6987],"text":""},"desc":"Remove the console.warn()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 30000.","line":257,"column":12,"nodeType":"Literal","messageId":"noMagic","endLine":257,"endColumn":17},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":266,"column":32,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":266,"endColumn":41,"fix":{"range":[7727,7736],"text":"{continue;}"}},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":283,"column":17,"nodeType":"MemberExpression","messageId":"unexpected","endLine":283,"endColumn":29,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[8416,8474],"text":""},"desc":"Remove the console.warn()."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'service' is defined but never used. Allowed unused args must match /^_/u.","line":292,"column":30,"nodeType":"Identifier","messageId":"unusedVar","endLine":292,"endColumn":37},{"ruleId":"no-unused-vars","severity":2,"message":"'healthConfig' is defined but never used. Allowed unused args must match /^_/u.","line":292,"column":39,"nodeType":"Identifier","messageId":"unusedVar","endLine":292,"endColumn":51},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.1.","line":297,"column":41,"nodeType":"Literal","messageId":"noMagic","endLine":297,"endColumn":44},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":298,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":298,"endColumn":19},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":364,"column":17,"nodeType":"MemberExpression","messageId":"unexpected","endLine":364,"endColumn":30,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[10710,10754],"text":""},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":11,"fixableErrorCount":1,"fixableWarningCount":0,"source":"/**\n * ÊúçÂä°Ê≥®ÂÜå‰∏éÂèëÁé∞‰∏≠ÂøÉ\n * ÂÆûÁé∞ÂæÆÊúçÂä°Êû∂ÊûÑÁöÑÊ†∏ÂøÉÁªÑ‰ª∂ÔºåË¥üË¥£ÊúçÂä°Ê≥®ÂÜå„ÄÅÂèëÁé∞„ÄÅÂÅ•Â∫∑Ê£ÄÊü•ÂíåË¥üËΩΩÂùáË°°\n * ÊîØÊåÅÈõ∂Á¢≥Âõ≠Âå∫Êï∞Â≠óÂ≠™ÁîüÁ≥ªÁªüÁöÑÂàÜÂ∏ÉÂºèÊû∂ÊûÑ\n */\n\nclass ServiceRegistry {\n    constructor() {\n        this.services = new Map(); // ÊúçÂä°Ê≥®ÂÜåË°®\n        this.healthChecks = new Map(); // ÂÅ•Â∫∑Ê£ÄÊü•ÈÖçÁΩÆ\n        this.loadBalancers = new Map(); // Ë¥üËΩΩÂùáË°°Âô®\n        this.serviceInstances = new Map(); // ÊúçÂä°ÂÆû‰æãÂàóË°®\n        this.eventListeners = new Map(); // ‰∫ã‰ª∂ÁõëÂê¨Âô®\n        \n        // ÊúçÂä°Á±ªÂûãÂÆö‰πâ\n        this.serviceTypes = {\n            CARBON_ACCOUNTING: 'carbon-accounting',\n            ENERGY_FLOW: 'energy-flow',\n            NATIONAL_INDICATOR: 'national-indicator',\n            GREEN_ELECTRICITY: 'green-electricity',\n            REPORT_GENERATOR: 'report-generator',\n            DATA_COLLECTOR: 'data-collector',\n            API_GATEWAY: 'api-gateway'\n        };\n        \n        this.init();\n    }\n    \n    /**\n     * ÂàùÂßãÂåñÊúçÂä°Ê≥®ÂÜå‰∏≠ÂøÉ\n     */\n    async init() {\n        console.log('üöÄ ÊúçÂä°Ê≥®ÂÜå‰∏≠ÂøÉÂêØÂä®‰∏≠...');\n        \n        // ÂêØÂä®ÂÅ•Â∫∑Ê£ÄÊü•ÂÆöÊó∂Âô®\n        this.startHealthCheckTimer();\n        \n        // Ê≥®ÂÜåÊ†∏ÂøÉÊúçÂä°\n        await this.registerCoreServices();\n        \n        console.log('‚úÖ ÊúçÂä°Ê≥®ÂÜå‰∏≠ÂøÉÂêØÂä®ÂÆåÊàê');\n    }\n    \n    /**\n     * Ê≥®ÂÜåÊúçÂä°\n     * @param {Object} serviceConfig ÊúçÂä°ÈÖçÁΩÆ\n     */\n    async registerService(serviceConfig) {\n        const {\n            name,\n            type,\n            version,\n            host,\n            port,\n            healthCheckUrl,\n            metadata = {}\n        } = serviceConfig;\n        \n        const serviceId = `${name}-${Date.now()}`;\n        const serviceInfo = {\n            id: serviceId,\n            name,\n            type,\n            version,\n            host,\n            port,\n            healthCheckUrl,\n            metadata,\n            status: 'healthy',\n            registeredAt: new Date(),\n            lastHealthCheck: new Date()\n        };\n        \n        // Ê≥®ÂÜåÊúçÂä°\n        this.services.set(serviceId, serviceInfo);\n        \n        // Ê∑ªÂä†Âà∞ÊúçÂä°ÂÆû‰æãÂàóË°®\n        if (!this.serviceInstances.has(name)) {\n            this.serviceInstances.set(name, []);\n        }\n        this.serviceInstances.get(name).push(serviceInfo);\n        \n        // ÈÖçÁΩÆÂÅ•Â∫∑Ê£ÄÊü•\n        if (healthCheckUrl) {\n            this.setupHealthCheck(serviceId, healthCheckUrl);\n        }\n        \n        // Ëß¶ÂèëÊúçÂä°Ê≥®ÂÜå‰∫ã‰ª∂\n        this.emitEvent('service:registered', serviceInfo);\n        \n        console.log(`üìã ÊúçÂä°Ê≥®ÂÜåÊàêÂäü: ${name} (${serviceId})`);\n        return serviceId;\n    }\n    \n    /**\n     * Ê≥®ÈîÄÊúçÂä°\n     * @param {string} serviceId ÊúçÂä°ID\n     */\n    async unregisterService(serviceId) {\n        const service = this.services.get(serviceId);\n        if (!service) {\n            throw new Error(`ÊúçÂä°‰∏çÂ≠òÂú®: ${serviceId}`);\n        }\n        \n        // ‰ªéÊúçÂä°Ê≥®ÂÜåË°®ÁßªÈô§\n        this.services.delete(serviceId);\n        \n        // ‰ªéÊúçÂä°ÂÆû‰æãÂàóË°®ÁßªÈô§\n        const instances = this.serviceInstances.get(service.name) || [];\n        const updatedInstances = instances.filter(instance => instance.id !== serviceId);\n        this.serviceInstances.set(service.name, updatedInstances);\n        \n        // ÁßªÈô§ÂÅ•Â∫∑Ê£ÄÊü•\n        this.healthChecks.delete(serviceId);\n        \n        // Ëß¶ÂèëÊúçÂä°Ê≥®ÈîÄ‰∫ã‰ª∂\n        this.emitEvent('service:unregistered', service);\n        \n        console.log(`üì§ ÊúçÂä°Ê≥®ÈîÄÊàêÂäü: ${service.name} (${serviceId})`);\n    }\n    \n    /**\n     * ÂèëÁé∞ÊúçÂä°\n     * @param {string} serviceName ÊúçÂä°ÂêçÁß∞\n     * @param {Object} options ÈÄâÈ°π\n     */\n    discoverService(serviceName, options = {}) {\n        const { loadBalanceStrategy = 'round-robin', healthyOnly = true } = options;\n        \n        const instances = this.serviceInstances.get(serviceName) || [];\n        \n        // ËøáÊª§ÂÅ•Â∫∑ÁöÑÊúçÂä°ÂÆû‰æã\n        const availableInstances = healthyOnly \n            ? instances.filter(instance => instance.status === 'healthy')\n            : instances;\n            \n        if (availableInstances.length === 0) {\n            throw new Error(`Ê≤°ÊúâÂèØÁî®ÁöÑÊúçÂä°ÂÆû‰æã: ${serviceName}`);\n        }\n        \n        // Ë¥üËΩΩÂùáË°°ÈÄâÊã©ÂÆû‰æã\n        return this.selectInstance(serviceName, availableInstances, loadBalanceStrategy);\n    }\n    \n    /**\n     * Ëé∑ÂèñÊâÄÊúâÊúçÂä°\n     */\n    getAllServices() {\n        const serviceList = [];\n        for (const [serviceId, service] of this.services) {\n            serviceList.push({\n                ...service,\n                url: `http://${service.host}:${service.port}`\n            });\n        }\n        return serviceList;\n    }\n    \n    /**\n     * Ëé∑ÂèñÊúçÂä°ÂÅ•Â∫∑Áä∂ÊÄÅ\n     */\n    getServiceHealth() {\n        const healthStatus = {};\n        for (const [serviceName, instances] of this.serviceInstances) {\n            const totalInstances = instances.length;\n            const healthyInstances = instances.filter(instance => instance.status === 'healthy').length;\n            \n            healthStatus[serviceName] = {\n                total: totalInstances,\n                healthy: healthyInstances,\n                unhealthy: totalInstances - healthyInstances,\n                healthRate: totalInstances > 0 ? (healthyInstances / totalInstances * 100).toFixed(2) : 0\n            };\n        }\n        return healthStatus;\n    }\n    \n    /**\n     * Ê≥®ÂÜåÊ†∏ÂøÉÊúçÂä°\n     */\n    async registerCoreServices() {\n        const coreServices = [\n            {\n                name: 'carbon-accounting-engine',\n                type: this.serviceTypes.CARBON_ACCOUNTING,\n                version: '1.0.0',\n                host: 'localhost',\n                port: 3001,\n                healthCheckUrl: '/health',\n                metadata: { description: 'Á¢≥ÊéíÊîæÂÆûÊó∂Ê†∏ÁÆóÂºïÊìé' }\n            },\n            {\n                name: 'energy-flow-visualization',\n                type: this.serviceTypes.ENERGY_FLOW,\n                version: '1.0.0',\n                host: 'localhost',\n                port: 3002,\n                healthCheckUrl: '/health',\n                metadata: { description: 'Âõ≠Âå∫ËÉΩÊµÅÂÖ®ÊôØÂõæÊûÑÂª∫Ê®°Âùó' }\n            },\n            {\n                name: 'national-indicator-dashboard',\n                type: this.serviceTypes.NATIONAL_INDICATOR,\n                version: '1.0.0',\n                host: 'localhost',\n                port: 3003,\n                healthCheckUrl: '/health',\n                metadata: { description: 'ÂõΩÂÆ∂ÊåáÊ†á‰ΩìÁ≥ªÁõëÊµã‰ª™Ë°®Áõò' }\n            },\n            {\n                name: 'green-electricity-tracing',\n                type: this.serviceTypes.GREEN_ELECTRICITY,\n                version: '1.0.0',\n                host: 'localhost',\n                port: 3004,\n                healthCheckUrl: '/health',\n                metadata: { description: 'ÁªøÁîµÊ∫ØÊ∫ê‰∏éËÆ§ËØÅÊ®°Âùó' }\n            },\n            {\n                name: 'report-generator',\n                type: this.serviceTypes.REPORT_GENERATOR,\n                version: '1.0.0',\n                host: 'localhost',\n                port: 3005,\n                healthCheckUrl: '/health',\n                metadata: { description: 'Êô∫ËÉΩÁî≥Êä•È™åÊî∂ÊùêÊñôÁîüÊàêÂô®' }\n            }\n        ];\n        \n        for (const serviceConfig of coreServices) {\n            try {\n                await this.registerService(serviceConfig);\n            } catch (error) {\n                console.warn(`‚ö†Ô∏è Ê†∏ÂøÉÊúçÂä°Ê≥®ÂÜåÂ§±Ë¥•: ${serviceConfig.name}`, error.message);\n            }\n        }\n    }\n    \n    /**\n     * ËÆæÁΩÆÂÅ•Â∫∑Ê£ÄÊü•\n     */\n    setupHealthCheck(serviceId, healthCheckUrl) {\n        this.healthChecks.set(serviceId, {\n            url: healthCheckUrl,\n            interval: 30000, // 30ÁßíÊ£ÄÊü•‰∏ÄÊ¨°\n            timeout: 5000,   // 5ÁßíË∂ÖÊó∂\n            retries: 3       // ÈáçËØï3Ê¨°\n        });\n    }\n    \n    /**\n     * ÂêØÂä®ÂÅ•Â∫∑Ê£ÄÊü•ÂÆöÊó∂Âô®\n     */\n    startHealthCheckTimer() {\n        setInterval(async () => {\n            await this.performHealthChecks();\n        }, 30000); // ÊØè30ÁßíÊâßË°å‰∏ÄÊ¨°ÂÅ•Â∫∑Ê£ÄÊü•\n    }\n    \n    /**\n     * ÊâßË°åÂÅ•Â∫∑Ê£ÄÊü•\n     */\n    async performHealthChecks() {\n        for (const [serviceId, service] of this.services) {\n            const healthConfig = this.healthChecks.get(serviceId);\n            if (!healthConfig) continue;\n            \n            try {\n                const isHealthy = await this.checkServiceHealth(service, healthConfig);\n                const previousStatus = service.status;\n                service.status = isHealthy ? 'healthy' : 'unhealthy';\n                service.lastHealthCheck = new Date();\n                \n                // Áä∂ÊÄÅÂèòÂåñÊó∂Ëß¶Âèë‰∫ã‰ª∂\n                if (previousStatus !== service.status) {\n                    this.emitEvent('service:status-changed', {\n                        service,\n                        previousStatus,\n                        currentStatus: service.status\n                    });\n                }\n            } catch (error) {\n                console.warn(`‚ö†Ô∏è ÂÅ•Â∫∑Ê£ÄÊü•Â§±Ë¥•: ${service.name}`, error.message);\n                service.status = 'unhealthy';\n            }\n        }\n    }\n    \n    /**\n     * Ê£ÄÊü•Âçï‰∏™ÊúçÂä°ÂÅ•Â∫∑Áä∂ÊÄÅ\n     */\n    async checkServiceHealth(service, healthConfig) {\n        // Ê®°ÊãüÂÅ•Â∫∑Ê£ÄÊü•ÔºàÂÆûÈôÖÂ∫îÁî®‰∏≠Â∫îËØ•ÂèëÈÄÅHTTPËØ∑Ê±ÇÔºâ\n        return new Promise((resolve) => {\n            setTimeout(() => {\n                // Ê®°Êãü90%ÁöÑÊàêÂäüÁéá\n                resolve(Math.random() > 0.1);\n            }, 100);\n        });\n    }\n    \n    /**\n     * Ë¥üËΩΩÂùáË°°ÈÄâÊã©ÂÆû‰æã\n     */\n    selectInstance(serviceName, instances, strategy) {\n        switch (strategy) {\n            case 'round-robin':\n                return this.roundRobinSelect(serviceName, instances);\n            case 'random':\n                return instances[Math.floor(Math.random() * instances.length)];\n            case 'least-connections':\n                return this.leastConnectionsSelect(instances);\n            default:\n                return instances[0];\n        }\n    }\n    \n    /**\n     * ËΩÆËØ¢Ë¥üËΩΩÂùáË°°\n     */\n    roundRobinSelect(serviceName, instances) {\n        if (!this.loadBalancers.has(serviceName)) {\n            this.loadBalancers.set(serviceName, { currentIndex: 0 });\n        }\n        \n        const balancer = this.loadBalancers.get(serviceName);\n        const instance = instances[balancer.currentIndex];\n        balancer.currentIndex = (balancer.currentIndex + 1) % instances.length;\n        \n        return instance;\n    }\n    \n    /**\n     * ÊúÄÂ∞ëËøûÊé•Êï∞Ë¥üËΩΩÂùáË°°\n     */\n    leastConnectionsSelect(instances) {\n        // ÁÆÄÂåñÂÆûÁé∞ÔºåÂÆûÈôÖÂ∫îÁî®‰∏≠ÈúÄË¶ÅË∑üË∏™ËøûÊé•Êï∞\n        return instances.reduce((min, current) => {\n            const minConnections = min.metadata.connections || 0;\n            const currentConnections = current.metadata.connections || 0;\n            return currentConnections < minConnections ? current : min;\n        });\n    }\n    \n    /**\n     * ‰∫ã‰ª∂ÁõëÂê¨\n     */\n    on(event, listener) {\n        if (!this.eventListeners.has(event)) {\n            this.eventListeners.set(event, []);\n        }\n        this.eventListeners.get(event).push(listener);\n    }\n    \n    /**\n     * Ëß¶Âèë‰∫ã‰ª∂\n     */\n    emitEvent(event, data) {\n        const listeners = this.eventListeners.get(event) || [];\n        listeners.forEach(listener => {\n            try {\n                listener(data);\n            } catch (error) {\n                console.error(`‰∫ã‰ª∂ÁõëÂê¨Âô®ÈîôËØØ (${event}):`, error);\n            }\n        });\n    }\n    \n    /**\n     * Ëé∑ÂèñÊúçÂä°ÁªüËÆ°‰ø°ÊÅØ\n     */\n    getServiceStats() {\n        const stats = {\n            totalServices: this.services.size,\n            serviceTypes: {},\n            healthyServices: 0,\n            unhealthyServices: 0\n        };\n        \n        for (const service of this.services.values()) {\n            // ÁªüËÆ°ÊúçÂä°Á±ªÂûã\n            stats.serviceTypes[service.type] = (stats.serviceTypes[service.type] || 0) + 1;\n            \n            // ÁªüËÆ°ÂÅ•Â∫∑Áä∂ÊÄÅ\n            if (service.status === 'healthy') {\n                stats.healthyServices++;\n            } else {\n                stats.unhealthyServices++;\n            }\n        }\n        \n        return stats;\n    }\n}\n\nmodule.exports = ServiceRegistry;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/core/controllers/EnergyCarbonIntegrationController.js","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'carbonData' is defined but never used. Allowed unused args must match /^_/u.","line":504,"column":52,"nodeType":"Identifier","messageId":"unusedVar","endLine":504,"endColumn":62},{"ruleId":"no-unused-vars","severity":2,"message":"'parkId' is defined but never used. Allowed unused args must match /^_/u.","line":521,"column":45,"nodeType":"Identifier","messageId":"unusedVar","endLine":521,"endColumn":51},{"ruleId":"no-unused-vars","severity":2,"message":"'carbonData' is defined but never used. Allowed unused args must match /^_/u.","line":521,"column":53,"nodeType":"Identifier","messageId":"unusedVar","endLine":521,"endColumn":63},{"ruleId":"no-unused-vars","severity":2,"message":"'energyFlowData' is defined but never used. Allowed unused args must match /^_/u.","line":521,"column":65,"nodeType":"Identifier","messageId":"unusedVar","endLine":521,"endColumn":79},{"ruleId":"no-unused-vars","severity":2,"message":"'greenElectricityData' is defined but never used. Allowed unused args must match /^_/u.","line":521,"column":81,"nodeType":"Identifier","messageId":"unusedVar","endLine":521,"endColumn":101},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.01.","line":553,"column":58,"nodeType":"Literal","messageId":"noMagic","endLine":553,"endColumn":62},{"ruleId":"object-shorthand","severity":2,"message":"Expected property shorthand.","line":561,"column":11,"nodeType":"Property","messageId":"expectedPropertyShorthand","endLine":561,"endColumn":25,"fix":{"range":[18046,18060],"text":"metric"}},{"ruleId":"object-shorthand","severity":2,"message":"Expected property shorthand.","line":562,"column":11,"nodeType":"Property","messageId":"expectedPropertyShorthand","endLine":562,"endColumn":23,"fix":{"range":[18072,18084],"text":"value"}},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":587,"column":65,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":587,"endColumn":77,"fix":{"range":[18814,18826],"text":"{score += 33;}"}},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 33.","line":587,"column":74,"nodeType":"Literal","messageId":"noMagic","endLine":587,"endColumn":76},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":588,"column":54,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":588,"endColumn":66,"fix":{"range":[18880,18892],"text":"{score += 33;}"}},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 33.","line":588,"column":63,"nodeType":"Literal","messageId":"noMagic","endLine":588,"endColumn":65},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":589,"column":85,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":589,"endColumn":97,"fix":{"range":[18977,18989],"text":"{score += 34;}"}},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 34.","line":589,"column":94,"nodeType":"Literal","messageId":"noMagic","endLine":589,"endColumn":96},{"ruleId":"no-unused-vars","severity":2,"message":"'carbonData' is defined but never used. Allowed unused args must match /^_/u.","line":593,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":593,"endColumn":32},{"ruleId":"no-unused-vars","severity":2,"message":"'energyFlowData' is defined but never used. Allowed unused args must match /^_/u.","line":593,"column":34,"nodeType":"Identifier","messageId":"unusedVar","endLine":593,"endColumn":48},{"ruleId":"no-unused-vars","severity":2,"message":"'greenElectricityData' is defined but never used. Allowed unused args must match /^_/u.","line":593,"column":50,"nodeType":"Identifier","messageId":"unusedVar","endLine":593,"endColumn":70},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 95.","line":595,"column":12,"nodeType":"Literal","messageId":"noMagic","endLine":595,"endColumn":14},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":607,"column":34,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":607,"endColumn":43,"fix":{"range":[19439,19448],"text":"{return 0;}"}},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":615,"column":24,"nodeType":"Literal","messageId":"noMagic","endLine":615,"endColumn":27},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":615,"column":50,"nodeType":"Literal","messageId":"noMagic","endLine":615,"endColumn":53},{"ruleId":"no-unused-vars","severity":2,"message":"'parkId' is defined but never used. Allowed unused args must match /^_/u.","line":623,"column":25,"nodeType":"Identifier","messageId":"unusedVar","endLine":623,"endColumn":31},{"ruleId":"no-unused-vars","severity":2,"message":"'parkId' is defined but never used. Allowed unused args must match /^_/u.","line":627,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":627,"endColumn":32},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":633,"column":37,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":633,"endColumn":46,"fix":{"range":[20082,20091],"text":"{return 0;}"}},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":636,"column":24,"nodeType":"Literal","messageId":"noMagic","endLine":636,"endColumn":27},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":636,"column":126,"nodeType":"Literal","messageId":"noMagic","endLine":636,"endColumn":129},{"ruleId":"no-unused-vars","severity":2,"message":"'parkId' is defined but never used. Allowed unused args must match /^_/u.","line":639,"column":29,"nodeType":"Identifier","messageId":"unusedVar","endLine":639,"endColumn":35},{"ruleId":"no-unused-vars","severity":2,"message":"'data' is defined but never used. Allowed unused args must match /^_/u.","line":656,"column":32,"nodeType":"Identifier","messageId":"unusedVar","endLine":656,"endColumn":36},{"ruleId":"no-unused-vars","severity":2,"message":"'data' is defined but never used. Allowed unused args must match /^_/u.","line":664,"column":35,"nodeType":"Identifier","messageId":"unusedVar","endLine":664,"endColumn":39},{"ruleId":"no-unused-vars","severity":2,"message":"'data' is defined but never used. Allowed unused args must match /^_/u.","line":672,"column":28,"nodeType":"Identifier","messageId":"unusedVar","endLine":672,"endColumn":32},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 85.","line":675,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":675,"endColumn":18},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 78.","line":675,"column":20,"nodeType":"Literal","messageId":"noMagic","endLine":675,"endColumn":22},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 92.","line":675,"column":24,"nodeType":"Literal","messageId":"noMagic","endLine":675,"endColumn":26},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 88.","line":675,"column":28,"nodeType":"Literal","messageId":"noMagic","endLine":675,"endColumn":30},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 95.","line":675,"column":32,"nodeType":"Literal","messageId":"noMagic","endLine":675,"endColumn":34},{"ruleId":"no-unused-vars","severity":2,"message":"'parkId' is defined but never used. Allowed unused args must match /^_/u.","line":679,"column":34,"nodeType":"Identifier","messageId":"unusedVar","endLine":679,"endColumn":40},{"ruleId":"no-unused-vars","severity":2,"message":"'data' is defined but never used. Allowed unused args must match /^_/u.","line":679,"column":42,"nodeType":"Identifier","messageId":"unusedVar","endLine":679,"endColumn":46},{"ruleId":"no-unused-vars","severity":2,"message":"'parkId' is defined but never used. Allowed unused args must match /^_/u.","line":687,"column":33,"nodeType":"Identifier","messageId":"unusedVar","endLine":687,"endColumn":39},{"ruleId":"no-unused-vars","severity":2,"message":"'data' is defined but never used. Allowed unused args must match /^_/u.","line":687,"column":41,"nodeType":"Identifier","messageId":"unusedVar","endLine":687,"endColumn":45},{"ruleId":"no-unused-vars","severity":2,"message":"'parkId' is defined but never used. Allowed unused args must match /^_/u.","line":695,"column":34,"nodeType":"Identifier","messageId":"unusedVar","endLine":695,"endColumn":40},{"ruleId":"no-unused-vars","severity":2,"message":"'data' is defined but never used. Allowed unused args must match /^_/u.","line":695,"column":42,"nodeType":"Identifier","messageId":"unusedVar","endLine":695,"endColumn":46},{"ruleId":"no-unused-vars","severity":2,"message":"'parkId' is defined but never used. Allowed unused args must match /^_/u.","line":712,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":712,"endColumn":24},{"ruleId":"no-unused-vars","severity":2,"message":"'data' is defined but never used. Allowed unused args must match /^_/u.","line":721,"column":23,"nodeType":"Identifier","messageId":"unusedVar","endLine":721,"endColumn":27}],"suppressedMessages":[],"errorCount":29,"fatalErrorCount":0,"warningCount":14,"fixableErrorCount":7,"fixableWarningCount":0,"source":"/**\n * ËÉΩÁ¢≥‰∏Ä‰ΩìÂåñÁõëÊµã‰∏éÊ†∏ÁÆó‰∏≠ÂøÉÊéßÂà∂Âô®\n * Êï¥ÂêàÁ¢≥ÊéíÊîæÊ†∏ÁÆóÂºïÊìé„ÄÅËÉΩÊµÅÂÖ®ÊôØÂõæ„ÄÅÁªøÁîµÊ∫ØÊ∫êÂíåÂõΩÂÆ∂ÊåáÊ†áËÆ°ÁÆó\n * Êèê‰æõÁªü‰∏ÄÁöÑAPIÊé•Âè£ÂíåÊï∞ÊçÆÁÆ°ÁêÜ\n */\n\nimport { EventEmitter } from 'events';\nimport logger from '../../shared/utils/logger.js';\nimport CarbonAccountingEngine from '../services/CarbonAccountingEngine.js';\nimport EnergyFlowVisualization from '../services/EnergyFlowVisualization.js';\nimport GreenElectricityTracing from '../services/GreenElectricityTracing.js';\nimport NationalIndicatorEngine from '../services/NationalIndicatorEngine.js';\nimport { MATH_CONSTANTS } from '../../shared/constants/MathConstants.js';\n\nclass EnergyCarbonIntegrationController extends EventEmitter {\n  constructor() {\n    super();\n    this.isInitialized = false;\n    \n    // ÂàùÂßãÂåñÂêÑ‰∏™Ê†∏ÂøÉÊ®°Âùó\n    this.carbonEngine = new CarbonAccountingEngine();\n    this.energyFlowViz = new EnergyFlowVisualization();\n    this.greenElectricityTracing = new GreenElectricityTracing();\n    this.nationalIndicatorEngine = new NationalIndicatorEngine();\n    \n    // Êï∞ÊçÆÁºìÂ≠ò\n    this.dataCache = new Map();\n    this.realTimeData = new Map();\n    this.alertRules = new Map();\n    \n    // ÁõëÊéßÁä∂ÊÄÅ\n    this.monitoringStatus = {\n      carbon_accounting: false,\n      energy_flow: false,\n      green_electricity: false,\n      national_indicators: false\n    };\n    \n    this.init();\n  }\n\n  async init() {\n    try {\n      logger.info('ÂºÄÂßãÂàùÂßãÂåñËÉΩÁ¢≥‰∏Ä‰ΩìÂåñÁõëÊµã‰∏éÊ†∏ÁÆó‰∏≠ÂøÉ...');\n      \n      // Á≠âÂæÖÊâÄÊúâÊ®°ÂùóÂàùÂßãÂåñÂÆåÊàê\n      await Promise.all([\n        this.waitForModuleInit(this.carbonEngine, 'carbon_accounting'),\n        this.waitForModuleInit(this.energyFlowViz, 'energy_flow'),\n        this.waitForModuleInit(this.greenElectricityTracing, 'green_electricity'),\n        this.waitForModuleInit(this.nationalIndicatorEngine, 'national_indicators')\n      ]);\n      \n      // ËÆæÁΩÆÊ®°ÂùóÈó¥‰∫ã‰ª∂ÁõëÂê¨\n      this.setupModuleEventListeners();\n      \n      // ÂêØÂä®ÂÆûÊó∂ÁõëÊéß\n      await this.startRealTimeMonitoring();\n      \n      this.isInitialized = true;\n      logger.info('ËÉΩÁ¢≥‰∏Ä‰ΩìÂåñÁõëÊµã‰∏éÊ†∏ÁÆó‰∏≠ÂøÉÂàùÂßãÂåñÂÆåÊàê');\n      this.emit('initialized');\n    } catch (error) {\n      logger.error('ËÉΩÁ¢≥‰∏Ä‰ΩìÂåñÁõëÊµã‰∏éÊ†∏ÁÆó‰∏≠ÂøÉÂàùÂßãÂåñÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Á≠âÂæÖÊ®°ÂùóÂàùÂßãÂåñ\n   */\n  async waitForModuleInit(module, moduleName) {\n    return new Promise((resolve, reject) => {\n      if (module.isInitialized) {\n        this.monitoringStatus[moduleName] = true;\n        resolve();\n      } else {\n        module.once('initialized', () => {\n          this.monitoringStatus[moduleName] = true;\n          logger.info(`Ê®°Âùó ${moduleName} ÂàùÂßãÂåñÂÆåÊàê`);\n          resolve();\n        });\n        \n        // ËÆæÁΩÆË∂ÖÊó∂\n        setTimeout(() => {\n          reject(new Error(`Ê®°Âùó ${moduleName} ÂàùÂßãÂåñË∂ÖÊó∂`));\n        }, MATH_CONSTANTS.THIRTY * MATH_CONSTANTS.MILLISECONDS_PER_SECOND);\n      }\n    });\n  }\n\n  /**\n   * ËÆæÁΩÆÊ®°ÂùóÈó¥‰∫ã‰ª∂ÁõëÂê¨\n   */\n  setupModuleEventListeners() {\n    // Á¢≥ÊéíÊîæÊ†∏ÁÆó‰∫ã‰ª∂\n    this.carbonEngine.on('carbon_calculated', (data) => {\n      this.handleCarbonCalculated(data);\n    });\n    \n    this.carbonEngine.on('emission_alert', (alert) => {\n      this.handleEmissionAlert(alert);\n    });\n    \n    // ËÉΩÊµÅÂèØËßÜÂåñ‰∫ã‰ª∂\n    this.energyFlowViz.on('flow_updated', (data) => {\n      this.handleEnergyFlowUpdated(data);\n    });\n    \n    // ÁªøÁîµÊ∫ØÊ∫ê‰∫ã‰ª∂\n    this.greenElectricityTracing.on('green_power_generated', (record) => {\n      this.handleGreenPowerGenerated(record);\n    });\n    \n    this.greenElectricityTracing.on('consumption_traced', (record) => {\n      this.handleConsumptionTraced(record);\n    });\n    \n    // ÂõΩÂÆ∂ÊåáÊ†áËÆ°ÁÆó‰∫ã‰ª∂\n    this.nationalIndicatorEngine.on('indicators_updated', (data) => {\n      this.handleIndicatorsUpdated(data);\n    });\n    \n    this.nationalIndicatorEngine.on('report_generated', (report) => {\n      this.handleReportGenerated(report);\n    });\n  }\n\n  /**\n   * ÂêØÂä®ÂÆûÊó∂ÁõëÊéß\n   */\n  async startRealTimeMonitoring() {\n    // ÊØè5ÂàÜÈíüËøõË°å‰∏ÄÊ¨°ÁªºÂêàÊï∞ÊçÆÊõ¥Êñ∞\n    setInterval(async () => {\n      try {\n        await this.updateIntegratedData();\n        this.emit('integrated_data_updated', {\n          timestamp: new Date().toISOString(),\n          status: this.monitoringStatus\n        });\n      } catch (error) {\n        logger.error('Êõ¥Êñ∞ÁªºÂêàÊï∞ÊçÆÂ§±Ë¥•:', error);\n      }\n    }, MATH_CONSTANTS.FIVE * MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.MILLISECONDS_PER_SECOND);\n  }\n\n  /**\n   * Ëé∑ÂèñÂõ≠Âå∫ËÉΩÁ¢≥‰∏Ä‰ΩìÂåñÁõëÊµãÊï∞ÊçÆ\n   * @param {string} parkId - Âõ≠Âå∫ID\n   * @param {string} timeRange - Êó∂Èó¥ËåÉÂõ¥\n   * @returns {Object} ÁªºÂêàÁõëÊµãÊï∞ÊçÆ\n   */\n  async getIntegratedMonitoringData(parkId, timeRange = '1h') {\n    try {\n      const cacheKey = `integrated_${parkId}_${timeRange}`;\n      const cached = this.dataCache.get(cacheKey);\n      \n      if (cached && this.isCacheValid(cached.timestamp)) {\n        return cached.data;\n      }\n      \n      // Âπ∂Ë°åËé∑ÂèñÂêÑÊ®°ÂùóÊï∞ÊçÆ\n      const [carbonData, energyFlowData, greenElectricityData, nationalIndicators] = await Promise.all([\n        this.carbonEngine.calculateParkCarbonEmissions(parkId, timeRange),\n        this.energyFlowViz.generateEnergyFlowMap(parkId, timeRange),\n        this.greenElectricityTracing.calculateRenewableRatio(parkId, timeRange),\n        this.nationalIndicatorEngine.generateNationalIndicatorReport(parkId, timeRange)\n      ]);\n      \n      // Êï¥ÂêàÊï∞ÊçÆ\n      const integratedData = {\n        park_id: parkId,\n        time_range: timeRange,\n        timestamp: new Date().toISOString(),\n        monitoring_status: this.monitoringStatus,\n        \n        // Á¢≥ÊéíÊîæÊ†∏ÁÆóÊï∞ÊçÆ\n        carbon_accounting: {\n          total_emissions: carbonData.total_emissions,\n          real_time_emissions: carbonData.real_time_emissions,\n          emission_breakdown: carbonData.breakdown,\n          carbon_intensity: carbonData.carbon_intensity,\n          reduction_potential: carbonData.reduction_potential\n        },\n        \n        // ËÉΩÊ∫êÊµÅÂêëÊï∞ÊçÆ\n        energy_flow: {\n          topology: energyFlowData.topology,\n          sankey_data: energyFlowData.sankey_data,\n          statistics: energyFlowData.statistics,\n          real_time_flows: energyFlowData.real_time_flows\n        },\n        \n        // ÁªøÁîµÊ∫ØÊ∫êÊï∞ÊçÆ\n        green_electricity: {\n          renewable_ratio: greenElectricityData.renewable_ratio,\n          green_consumption: greenElectricityData.green_consumption,\n          consumption_breakdown: greenElectricityData.consumption_by_type,\n          carbon_impact: greenElectricityData.carbon_impact,\n          compliance_status: greenElectricityData.compliance_status\n        },\n        \n        // ÂõΩÂÆ∂Ê†∏ÂøÉÊåáÊ†á\n        national_indicators: {\n          unit_energy_carbon: nationalIndicators.core_indicators.unit_energy_carbon,\n          clean_energy_ratio: nationalIndicators.core_indicators.clean_energy_ratio,\n          total_emissions: nationalIndicators.core_indicators.total_emissions,\n          comprehensive_assessment: nationalIndicators.comprehensive_assessment\n        },\n        \n        // ÁªºÂêàÂàÜÊûê\n        integrated_analysis: {\n          energy_carbon_correlation: this.calculateEnergyCarbonCorrelation(carbonData, energyFlowData),\n          green_energy_impact: this.calculateGreenEnergyImpact(greenElectricityData, carbonData),\n          performance_indicators: this.calculatePerformanceIndicators(carbonData, energyFlowData, greenElectricityData),\n          optimization_recommendations: await this.generateOptimizationRecommendations(parkId, carbonData, energyFlowData, greenElectricityData)\n        },\n        \n        // ÂÆûÊó∂ÂëäË≠¶\n        alerts: await this.getActiveAlerts(parkId),\n        \n        // Êï∞ÊçÆË¥®ÈáèËØÑ‰º∞\n        data_quality: {\n          completeness: this.assessDataCompleteness(carbonData, energyFlowData, greenElectricityData),\n          accuracy: this.assessDataAccuracy(carbonData, energyFlowData, greenElectricityData),\n          timeliness: this.assessDataTimeliness(carbonData, energyFlowData, greenElectricityData)\n        }\n      };\n      \n      // ÁºìÂ≠òÁªìÊûú\n      this.dataCache.set(cacheKey, {\n        data: integratedData,\n        timestamp: new Date().toISOString()\n      });\n      \n      return integratedData;\n    } catch (error) {\n      logger.error('Ëé∑ÂèñÂõ≠Âå∫ËÉΩÁ¢≥‰∏Ä‰ΩìÂåñÁõëÊµãÊï∞ÊçÆÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Ëé∑ÂèñÂÆûÊó∂ËÉΩÁ¢≥ÁõëÊµã‰ª™Ë°®ÊùøÊï∞ÊçÆ\n   * @param {string} parkId - Âõ≠Âå∫ID\n   * @returns {Object} ‰ª™Ë°®ÊùøÊï∞ÊçÆ\n   */\n  async getRealTimeDashboard(parkId) {\n    try {\n      const realTimeData = this.realTimeData.get(parkId) || {};\n      \n      const dashboard = {\n        park_id: parkId,\n        timestamp: new Date().toISOString(),\n        \n        // ÂÆûÊó∂ÂÖ≥ÈîÆÊåáÊ†á\n        key_metrics: {\n          current_power: realTimeData.current_power || 0,\n          current_emissions: realTimeData.current_emissions || 0,\n          renewable_ratio: realTimeData.renewable_ratio || 0,\n          energy_efficiency: realTimeData.energy_efficiency || 0\n        },\n        \n        // ‰ªäÊó•Á¥ØËÆ°\n        daily_cumulative: {\n          energy_consumption: realTimeData.daily_energy || 0,\n          carbon_emissions: realTimeData.daily_carbon || 0,\n          green_energy: realTimeData.daily_green || 0,\n          cost_savings: realTimeData.daily_savings || 0\n        },\n        \n        // ËÆæÂ§áÁä∂ÊÄÅ\n        equipment_status: {\n          total_devices: realTimeData.total_devices || 0,\n          online_devices: realTimeData.online_devices || 0,\n          offline_devices: realTimeData.offline_devices || 0,\n          alert_devices: realTimeData.alert_devices || 0\n        },\n        \n        // Ë∂ãÂäøÊï∞ÊçÆÔºàÊúÄËøë24Â∞èÊó∂Ôºâ\n        trends: {\n          power_trend: realTimeData.power_trend || [],\n          emission_trend: realTimeData.emission_trend || [],\n          renewable_trend: realTimeData.renewable_trend || [],\n          efficiency_trend: realTimeData.efficiency_trend || []\n        },\n        \n        // ÂΩìÂâçÂëäË≠¶\n        current_alerts: await this.getCurrentAlerts(parkId),\n        \n        // Á≥ªÁªüÁä∂ÊÄÅ\n        system_status: {\n          monitoring_status: this.monitoringStatus,\n          data_freshness: this.getDataFreshness(parkId),\n          connection_status: await this.getConnectionStatus(parkId)\n        }\n      };\n      \n      return dashboard;\n    } catch (error) {\n      logger.error('Ëé∑ÂèñÂÆûÊó∂‰ª™Ë°®ÊùøÊï∞ÊçÆÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * ÂàõÂª∫ÁªøÁîµÊ∂àË¥πËÆ∞ÂΩï\n   * @param {string} parkId - Âõ≠Âå∫ID\n   * @param {string} consumerId - Ê∂àË¥πËÄÖID\n   * @param {number} amount - Ê∂àË¥πÈáè\n   * @returns {Object} Ê∂àË¥πËÆ∞ÂΩï\n   */\n  async createGreenPowerConsumption(parkId, consumerId, amount) {\n    try {\n      // Ë∞ÉÁî®ÁªøÁîµÊ∫ØÊ∫êÊ®°Âùó\n      const consumptionRecord = await this.greenElectricityTracing.traceGreenPowerConsumption(consumerId, amount);\n      \n      // Êõ¥Êñ∞Á¢≥ÊéíÊîæËÆ°ÁÆó\n      await this.carbonEngine.updateConsumptionEmissions(parkId, consumptionRecord);\n      \n      // Ëß¶ÂèëÊï∞ÊçÆÊõ¥Êñ∞\n      this.emit('green_consumption_created', {\n        park_id: parkId,\n        consumption_record: consumptionRecord,\n        timestamp: new Date().toISOString()\n      });\n      \n      return consumptionRecord;\n    } catch (error) {\n      logger.error('ÂàõÂª∫ÁªøÁîµÊ∂àË¥πËÆ∞ÂΩïÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * ÁîüÊàêËÉΩÁ¢≥‰∏Ä‰ΩìÂåñÊä•Âëä\n   * @param {string} parkId - Âõ≠Âå∫ID\n   * @param {string} reportType - Êä•ÂëäÁ±ªÂûã\n   * @param {string} timeRange - Êó∂Èó¥ËåÉÂõ¥\n   * @returns {Object} ÁªºÂêàÊä•Âëä\n   */\n  async generateIntegratedReport(parkId, reportType = 'comprehensive', timeRange = '1M') {\n    try {\n      const integratedData = await this.getIntegratedMonitoringData(parkId, timeRange);\n      const nationalReport = await this.nationalIndicatorEngine.generateNationalIndicatorReport(parkId, timeRange);\n      \n      const report = {\n        report_id: this.generateReportId(parkId, reportType, timeRange),\n        park_id: parkId,\n        report_type: reportType,\n        time_range: timeRange,\n        generation_time: new Date().toISOString(),\n        \n        // ÊâßË°åÊëòË¶Å\n        executive_summary: {\n          key_findings: this.extractKeyFindings(integratedData),\n          performance_highlights: this.extractPerformanceHighlights(integratedData),\n          improvement_opportunities: this.extractImprovementOpportunities(integratedData),\n          compliance_status: nationalReport.comprehensive_assessment.compliance_level\n        },\n        \n        // ËØ¶ÁªÜÊï∞ÊçÆ\n        detailed_data: integratedData,\n        \n        // ÂõΩÂÆ∂Ê†áÂáÜÂØπÊ†á\n        national_compliance: nationalReport,\n        \n        // ÂèØËßÜÂåñÊï∞ÊçÆ\n        visualizations: {\n          energy_flow_diagram: integratedData.energy_flow.sankey_data,\n          carbon_emission_breakdown: integratedData.carbon_accounting.emission_breakdown,\n          renewable_energy_trends: integratedData.green_electricity.consumption_breakdown,\n          performance_radar: this.generatePerformanceRadar(integratedData)\n        },\n        \n        // Ë°åÂä®Âª∫ËÆÆ\n        recommendations: {\n          immediate_actions: await this.generateImmediateActions(parkId, integratedData),\n          medium_term_plans: await this.generateMediumTermPlans(parkId, integratedData),\n          long_term_strategy: await this.generateLongTermStrategy(parkId, integratedData)\n        },\n        \n        // ÈôÑÂΩï\n        appendix: {\n          calculation_methodology: this.getCalculationMethodology(),\n          data_sources: this.getDataSources(parkId),\n          quality_assurance: this.getQualityAssurance(integratedData)\n        }\n      };\n      \n      logger.info(`ÁîüÊàêËÉΩÁ¢≥‰∏Ä‰ΩìÂåñÊä•ÂëäÂÆåÊàê: ${report.report_id}`);\n      this.emit('integrated_report_generated', report);\n      \n      return report;\n    } catch (error) {\n      logger.error('ÁîüÊàêËÉΩÁ¢≥‰∏Ä‰ΩìÂåñÊä•ÂëäÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * ËÆæÁΩÆÂëäË≠¶ËßÑÂàô\n   * @param {string} parkId - Âõ≠Âå∫ID\n   * @param {Object} alertRule - ÂëäË≠¶ËßÑÂàô\n   * @returns {Object} ËÆæÁΩÆÁªìÊûú\n   */\n  async setAlertRule(parkId, alertRule) {\n    try {\n      const ruleId = this.generateAlertRuleId(parkId, alertRule.type);\n      \n      const rule = {\n        id: ruleId,\n        park_id: parkId,\n        type: alertRule.type,\n        metric: alertRule.metric,\n        threshold: alertRule.threshold,\n        condition: alertRule.condition, // 'greater_than', 'less_than', 'equals'\n        severity: alertRule.severity, // 'low', 'medium', 'high', 'critical'\n        enabled: alertRule.enabled !== false,\n        notification_channels: alertRule.notification_channels || ['email'],\n        created_time: new Date().toISOString(),\n        last_triggered: null\n      };\n      \n      this.alertRules.set(ruleId, rule);\n      \n      logger.info(`ËÆæÁΩÆÂëäË≠¶ËßÑÂàô: ${ruleId}, Á±ªÂûã: ${rule.type}`);\n      return { success: true, rule_id: ruleId };\n    } catch (error) {\n      logger.error('ËÆæÁΩÆÂëäË≠¶ËßÑÂàôÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  // ‰∫ã‰ª∂Â§ÑÁêÜÊñπÊ≥ï\n  handleCarbonCalculated(data) {\n    this.updateRealTimeData(data.park_id, 'carbon', data);\n    this.checkAlerts(data.park_id, 'carbon_emissions', data.total_emissions);\n  }\n\n  handleEnergyFlowUpdated(data) {\n    this.updateRealTimeData(data.park_id, 'energy_flow', data);\n  }\n\n  handleGreenPowerGenerated(record) {\n    this.updateRealTimeData(record.park_id, 'green_generation', record);\n  }\n\n  handleConsumptionTraced(record) {\n    this.updateRealTimeData(record.park_id, 'green_consumption', record);\n    this.checkAlerts(record.park_id, 'renewable_ratio', record.green_ratio);\n  }\n\n  handleIndicatorsUpdated(data) {\n    this.updateRealTimeData(data.park_id, 'indicators', data);\n  }\n\n  handleReportGenerated(report) {\n    this.emit('national_report_ready', report);\n  }\n\n  handleEmissionAlert(alert) {\n    this.emit('emission_alert', alert);\n  }\n\n  // ËæÖÂä©ÊñπÊ≥ï\n  updateRealTimeData(parkId, dataType, data) {\n    if (!this.realTimeData.has(parkId)) {\n      this.realTimeData.set(parkId, {});\n    }\n    \n    const parkData = this.realTimeData.get(parkId);\n    parkData[dataType] = data;\n    parkData.last_update = new Date().toISOString();\n  }\n\n  async updateIntegratedData() {\n    // Êõ¥Êñ∞ÊâÄÊúâÂõ≠Âå∫ÁöÑÁªºÂêàÊï∞ÊçÆ\n    const parks = await this.getAllParks();\n    \n    for (const park of parks) {\n      try {\n        await this.getIntegratedMonitoringData(park.id, '1h');\n      } catch (error) {\n        logger.error(`Êõ¥Êñ∞Âõ≠Âå∫ ${park.id} ÁªºÂêàÊï∞ÊçÆÂ§±Ë¥•:`, error);\n      }\n    }\n  }\n\n  isCacheValid(timestamp) {\n    const cacheAge = Date.now() - new Date(timestamp).getTime();\n    return cacheAge < MATH_CONSTANTS.FIVE * MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.MILLISECONDS_PER_SECOND; // 5ÂàÜÈíüÁºìÂ≠ò\n  }\n\n  calculateEnergyCarbonCorrelation(carbonData, energyFlowData) {\n    // ÁÆÄÂåñÁöÑÁõ∏ÂÖ≥ÊÄßËÆ°ÁÆó\n    return {\n      correlation_coefficient: 0.85,\n      energy_intensity: carbonData.total_emissions / energyFlowData.statistics.total_consumption,\n      carbon_factor: carbonData.total_emissions / energyFlowData.statistics.total_generation\n    };\n  }\n\n  calculateGreenEnergyImpact(greenElectricityData, carbonData) {\n    return {\n      emission_reduction: greenElectricityData.carbon_impact.total_reduction,\n      cost_savings: greenElectricityData.carbon_impact.economic_value,\n      environmental_benefit: greenElectricityData.carbon_impact.equivalent_trees\n    };\n  }\n\n  calculatePerformanceIndicators(carbonData, energyFlowData, greenElectricityData) {\n    return {\n      overall_efficiency: (energyFlowData.statistics.energy_efficiency + greenElectricityData.renewable_ratio) / 2,\n      carbon_intensity: carbonData.carbon_intensity,\n      renewable_penetration: greenElectricityData.renewable_ratio,\n      energy_balance: energyFlowData.statistics.power_balance\n    };\n  }\n\n  async generateOptimizationRecommendations(parkId, carbonData, energyFlowData, greenElectricityData) {\n    return [\n      {\n        category: 'energy_efficiency',\n        priority: 'high',\n        description: '‰ºòÂåñËÉΩÊ∫ê‰ΩøÁî®ÊïàÁéá',\n        potential_savings: '15%'\n      },\n      {\n        category: 'renewable_energy',\n        priority: 'medium',\n        description: 'Â¢ûÂä†ÂèØÂÜçÁîüËÉΩÊ∫êË£ÖÊú∫',\n        potential_impact: 'ÊèêÂçáÁªøÁîµÂç†ÊØî10%'\n      }\n    ];\n  }\n\n  async checkAlerts(parkId, metric, value) {\n    const rules = Array.from(this.alertRules.values())\n      .filter(rule => rule.park_id === parkId && rule.metric === metric && rule.enabled);\n    \n    for (const rule of rules) {\n      let triggered = false;\n      \n      switch (rule.condition) {\n        case 'greater_than':\n          triggered = value > rule.threshold;\n          break;\n        case 'less_than':\n          triggered = value < rule.threshold;\n          break;\n        case 'equals':\n          triggered = Math.abs(value - rule.threshold) < 0.01;\n          break;\n      }\n      \n      if (triggered) {\n        const alert = {\n          rule_id: rule.id,\n          park_id: parkId,\n          metric: metric,\n          value: value,\n          threshold: rule.threshold,\n          severity: rule.severity,\n          timestamp: new Date().toISOString(),\n          message: `${metric} ÂÄº ${value} Ëß¶ÂèëÂëäË≠¶ÈòàÂÄº ${rule.threshold}`\n        };\n        \n        rule.last_triggered = alert.timestamp;\n        this.emit('alert_triggered', alert);\n      }\n    }\n  }\n\n  generateReportId(parkId, reportType, timeRange) {\n    return `ECI_${parkId}_${reportType}_${timeRange}_${Date.now()}`;\n  }\n\n  generateAlertRuleId(parkId, type) {\n    return `ALERT_${parkId}_${type}_${Date.now()}`;\n  }\n\n  // Êï∞ÊçÆË¥®ÈáèËØÑ‰º∞ÊñπÊ≥ï\n  assessDataCompleteness(carbonData, energyFlowData, greenElectricityData) {\n    // ÁÆÄÂåñÁöÑÂÆåÊï¥ÊÄßËØÑ‰º∞\n    let score = 0;\n    if (carbonData && carbonData.total_emissions !== undefined) score += 33;\n    if (energyFlowData && energyFlowData.statistics) score += 33;\n    if (greenElectricityData && greenElectricityData.renewable_ratio !== undefined) score += 34;\n    return score;\n  }\n\n  assessDataAccuracy(carbonData, energyFlowData, greenElectricityData) {\n    // ÁÆÄÂåñÁöÑÂáÜÁ°ÆÊÄßËØÑ‰º∞\n    return 95; // ÂÅáËÆæ95%ÂáÜÁ°ÆÊÄß\n  }\n\n  assessDataTimeliness(carbonData, energyFlowData, greenElectricityData) {\n    // ÁÆÄÂåñÁöÑÊó∂ÊïàÊÄßËØÑ‰º∞\n    const now = new Date();\n    const timestamps = [\n      carbonData?.timestamp,\n      energyFlowData?.timestamp,\n      greenElectricityData?.timestamp\n    ].filter(Boolean);\n    \n    if (timestamps.length === 0) return 0;\n    \n    const avgAge = timestamps.reduce((sum, ts) => {\n      return sum + (now - new Date(ts));\n    }, 0) / timestamps.length;\n    \n    // 5ÂàÜÈíüÂÜÖ‰∏∫100ÂàÜÔºåË∂ÖËøáÂàôÈÄíÂáè\n    const maxAge = MATH_CONSTANTS.FIVE * MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.MILLISECONDS_PER_SECOND;\n    return Math.max(0, 100 - (avgAge / maxAge) * 100);\n  }\n\n  // Ê®°ÊãüÊï∞ÊçÆËé∑ÂèñÊñπÊ≥ï\n  async getAllParks() {\n    return [{ id: 'park_001', name: 'Á§∫‰æãÂõ≠Âå∫' }];\n  }\n\n  async getActiveAlerts(parkId) {\n    return [];\n  }\n\n  async getCurrentAlerts(parkId) {\n    return [];\n  }\n\n  getDataFreshness(parkId) {\n    const data = this.realTimeData.get(parkId);\n    if (!data || !data.last_update) return 0;\n    \n    const age = Date.now() - new Date(data.last_update).getTime();\n    return Math.max(0, 100 - (age / (MATH_CONSTANTS.FIVE * MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.MILLISECONDS_PER_SECOND)) * 100);\n  }\n\n  async getConnectionStatus(parkId) {\n    return {\n      carbon_engine: this.monitoringStatus.carbon_accounting,\n      energy_flow: this.monitoringStatus.energy_flow,\n      green_electricity: this.monitoringStatus.green_electricity,\n      national_indicators: this.monitoringStatus.national_indicators\n    };\n  }\n\n  extractKeyFindings(data) {\n    return [\n      `Âõ≠Âå∫ÊÄªÁ¢≥ÊéíÊîæ: ${data.carbon_accounting.total_emissions} tCO2`,\n      `ÂèØÂÜçÁîüËÉΩÊ∫êÂç†ÊØî: ${data.green_electricity.renewable_ratio}%`,\n      `ËÉΩÊ∫êÊïàÁéá: ${data.energy_flow.statistics.energy_efficiency || 'N/A'}`\n    ];\n  }\n\n  extractPerformanceHighlights(data) {\n    return [\n      'Á¢≥ÊéíÊîæÂº∫Â∫¶‰Ωé‰∫éË°å‰∏öÂπ≥ÂùáÊ∞¥Âπ≥',\n      'ÂèØÂÜçÁîüËÉΩÊ∫ê‰ΩøÁî®ÁéáÊåÅÁª≠ÊèêÂçá',\n      'ËÉΩÊ∫êÁÆ°ÁêÜÁ≥ªÁªüËøêË°åÁ®≥ÂÆö'\n    ];\n  }\n\n  extractImprovementOpportunities(data) {\n    return [\n      'Ëøõ‰∏ÄÊ≠•ÊèêÂçáËÆæÂ§áËÉΩÊïà',\n      'Â¢ûÂä†ÂÇ®ËÉΩÁ≥ªÁªüÈÖçÁΩÆ',\n      '‰ºòÂåñÁî®ËÉΩÁªìÊûÑ'\n    ];\n  }\n\n  generatePerformanceRadar(data) {\n    return {\n      categories: ['ËÉΩÊ∫êÊïàÁéá', 'Á¢≥ÊéíÊîæ', 'ÂèØÂÜçÁîüËÉΩÊ∫ê', 'ÊàêÊú¨ÊéßÂà∂', 'Á≥ªÁªüÁ®≥ÂÆöÊÄß'],\n      values: [85, 78, 92, 88, 95]\n    };\n  }\n\n  async generateImmediateActions(parkId, data) {\n    return [\n      'Ë∞ÉÊï¥È´òËÄóËÉΩËÆæÂ§áËøêË°åÊó∂Èó¥',\n      '‰ºòÂåñÁ©∫Ë∞ÉÁ≥ªÁªüËÆæÂÆöÊ∏©Â∫¶',\n      'Ê£ÄÊü•ËÆæÂ§áËøêË°åÁä∂ÊÄÅ'\n    ];\n  }\n\n  async generateMediumTermPlans(parkId, data) {\n    return [\n      'ÂÆâË£ÖÊõ¥Â§öÂÖâ‰ºèÂèëÁîµËÆæÂ§á',\n      'ÂçáÁ∫ßËÄÅÊóßËÆæÂ§á',\n      'Âª∫ËÆæÂÇ®ËÉΩÁ≥ªÁªü'\n    ];\n  }\n\n  async generateLongTermStrategy(parkId, data) {\n    return [\n      'Âà∂ÂÆöÁ¢≥‰∏≠ÂíåË∑ØÁ∫øÂõæ',\n      'Âª∫ËÆæÊô∫ÊÖßËÉΩÊ∫êÁÆ°ÁêÜÂπ≥Âè∞',\n      'ÂèÇ‰∏éÁªøÁîµ‰∫§ÊòìÂ∏ÇÂú∫'\n    ];\n  }\n\n  getCalculationMethodology() {\n    return {\n      carbon_accounting: 'Âü∫‰∫éÂõΩÂÆ∂ÂèëÊîπÂßîÊéíÊîæÂõ†Â≠ê',\n      energy_flow: 'ÂÆûÊó∂Êï∞ÊçÆÈááÈõÜ‰∏éÂàÜÊûê',\n      green_electricity: 'Âå∫ÂùóÈìæÊ∫ØÊ∫êÊäÄÊúØ',\n      national_indicators: '„ÄäÈÄöÁü•„ÄãÊ†áÂáÜËÆ°ÁÆóÊñπÊ≥ï'\n    };\n  }\n\n  getDataSources(parkId) {\n    return {\n      energy_meters: 'Êô∫ËÉΩÁîµË°®Êï∞ÊçÆ',\n      weather_data: 'Ê∞îË±°Á´ôÊï∞ÊçÆ',\n      equipment_data: 'SCADAÁ≥ªÁªü',\n      market_data: 'ÁîµÂäõ‰∫§ÊòìÂπ≥Âè∞'\n    };\n  }\n\n  getQualityAssurance(data) {\n    return {\n      data_validation: 'Â§öÈáçÊ†°È™åÊú∫Âà∂',\n      accuracy_check: 'ÂÆöÊúüÊ†°ÂáÜ',\n      completeness_check: 'Êï∞ÊçÆÂÆåÊï¥ÊÄßÈ™åËØÅ',\n      timeliness_check: 'ÂÆûÊó∂ÊÄßÁõëÊéß'\n    };\n  }\n}\n\nexport default EnergyCarbonIntegrationController;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/core/data/DataPlatform.js","messages":[{"ruleId":"object-shorthand","severity":2,"message":"Expected property shorthand.","line":596,"column":21,"nodeType":"Property","messageId":"expectedPropertyShorthand","endLine":596,"endColumn":33,"fix":{"range":[18554,18566],"text":"score"}},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.8.","line":607,"column":62,"nodeType":"Literal","messageId":"noMagic","endLine":607,"endColumn":65},{"ruleId":"object-shorthand","severity":2,"message":"Expected property shorthand.","line":639,"column":29,"nodeType":"Property","messageId":"expectedPropertyShorthand","endLine":639,"endColumn":41,"fix":{"range":[20107,20119],"text":"score"}},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":644,"column":53,"nodeType":"Literal","messageId":"noMagic","endLine":644,"endColumn":56},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: -100.","line":645,"column":67,"nodeType":"UnaryExpression","messageId":"noMagic","endLine":645,"endColumn":71},{"ruleId":"object-shorthand","severity":2,"message":"Expected property shorthand.","line":652,"column":33,"nodeType":"Property","messageId":"expectedPropertyShorthand","endLine":652,"endColumn":43,"fix":{"range":[20689,20699],"text":"rule"}},{"ruleId":"object-shorthand","severity":2,"message":"Expected property shorthand.","line":653,"column":33,"nodeType":"Property","messageId":"expectedPropertyShorthand","endLine":653,"endColumn":45,"fix":{"range":[20733,20745],"text":"score"}},{"ruleId":"no-unused-vars","severity":2,"message":"'assetId' is defined but never used. Allowed unused args must match /^_/u.","line":669,"column":29,"nodeType":"Identifier","messageId":"unusedVar","endLine":669,"endColumn":36},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 20.","line":671,"column":32,"nodeType":"Literal","messageId":"noMagic","endLine":671,"endColumn":34},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 80.","line":671,"column":37,"nodeType":"Literal","messageId":"noMagic","endLine":671,"endColumn":39},{"ruleId":"no-unused-vars","severity":2,"message":"'assetId' is defined but never used. Allowed unused args must match /^_/u.","line":674,"column":25,"nodeType":"Identifier","messageId":"unusedVar","endLine":674,"endColumn":32},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":676,"column":32,"nodeType":"Literal","messageId":"noMagic","endLine":676,"endColumn":34},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 90.","line":676,"column":37,"nodeType":"Literal","messageId":"noMagic","endLine":676,"endColumn":39},{"ruleId":"no-unused-vars","severity":2,"message":"'assetId' is defined but never used. Allowed unused args must match /^_/u.","line":679,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":679,"endColumn":34},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 30.","line":681,"column":32,"nodeType":"Literal","messageId":"noMagic","endLine":681,"endColumn":34},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 70.","line":681,"column":37,"nodeType":"Literal","messageId":"noMagic","endLine":681,"endColumn":39},{"ruleId":"no-unused-vars","severity":2,"message":"'assetId' is defined but never used. Allowed unused args must match /^_/u.","line":684,"column":28,"nodeType":"Identifier","messageId":"unusedVar","endLine":684,"endColumn":35},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 15.","line":686,"column":32,"nodeType":"Literal","messageId":"noMagic","endLine":686,"endColumn":34},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 85.","line":686,"column":37,"nodeType":"Literal","messageId":"noMagic","endLine":686,"endColumn":39},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":691,"column":20,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":691,"endColumn":33,"fix":{"range":[21699,21712],"text":"{return false;}"}},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":694,"column":26,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":694,"endColumn":38,"fix":{"range":[21818,21830],"text":"{return true;}"}},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":726,"column":44,"nodeType":"Literal","messageId":"noMagic","endLine":726,"endColumn":47},{"ruleId":"object-shorthand","severity":2,"message":"Expected property shorthand.","line":731,"column":13,"nodeType":"Property","messageId":"expectedPropertyShorthand","endLine":731,"endColumn":25,"fix":{"range":[22966,22978],"text":"query"}},{"ruleId":"no-unused-vars","severity":2,"message":"'assetId' is defined but never used. Allowed unused args must match /^_/u.","line":735,"column":28,"nodeType":"Identifier","messageId":"unusedVar","endLine":735,"endColumn":35},{"ruleId":"no-unused-vars","severity":2,"message":"'data' is defined but never used. Allowed unused args must match /^_/u.","line":735,"column":37,"nodeType":"Identifier","messageId":"unusedVar","endLine":735,"endColumn":41},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 20.","line":737,"column":43,"nodeType":"Literal","messageId":"noMagic","endLine":737,"endColumn":45},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 80.","line":737,"column":48,"nodeType":"Literal","messageId":"noMagic","endLine":737,"endColumn":50},{"ruleId":"object-shorthand","severity":2,"message":"Expected property shorthand.","line":744,"column":13,"nodeType":"Property","messageId":"expectedPropertyShorthand","endLine":744,"endColumn":27,"fix":{"range":[23307,23321],"text":"status"}},{"ruleId":"object-shorthand","severity":2,"message":"Expected property shorthand.","line":745,"column":13,"nodeType":"Property","messageId":"expectedPropertyShorthand","endLine":745,"endColumn":25,"fix":{"range":[23335,23347],"text":"error"}},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":752,"column":38,"nodeType":"Literal","messageId":"noMagic","endLine":752,"endColumn":42},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: -1000.","line":753,"column":53,"nodeType":"UnaryExpression","messageId":"noMagic","endLine":753,"endColumn":58},{"ruleId":"no-unused-vars","severity":2,"message":"'value' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":791,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":791,"endColumn":31},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":809,"column":59,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":809,"endColumn":66,"fix":{"range":[25349,25356],"text":"{return;}"}},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":830,"column":59,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":830,"endColumn":66,"fix":{"range":[26022,26029],"text":"{return;}"}}],"suppressedMessages":[],"errorCount":18,"fatalErrorCount":0,"warningCount":16,"fixableErrorCount":11,"fixableWarningCount":0,"source":"/**\n * Êï∞ÊçÆ‰∏≠Âè∞Ê†∏ÂøÉÂπ≥Âè∞\n * ÂÆûÁé∞Èõ∂Á¢≥Âõ≠Âå∫Êï∞Â≠óÂ≠™ÁîüÁ≥ªÁªüÁöÑÊï∞ÊçÆËµÑ‰∫ßÁªü‰∏ÄÁÆ°ÁêÜÂíåÊúçÂä°ÂåñÂ∞ÅË£Ö\n * Êèê‰æõÊï∞ÊçÆË¥®ÈáèÁõëÊéß„ÄÅÊ≤ªÁêÜ‰ΩìÁ≥ªÂíåÊ†áÂáÜÂåñÊï∞ÊçÆAPI\n */\n\nimport { EventEmitter } from 'events';\nimport logger from '../../shared/utils/logger.js';\nimport { MATH_CONSTANTS } from '../../shared/constants/MathConstants.js';\n\nclass DataPlatform extends EventEmitter {\n    constructor() {\n        super();\n        \n        // Êï∞ÊçÆËµÑ‰∫ßÁõÆÂΩï\n        this.dataAssets = new Map();\n        \n        // Êï∞ÊçÆÊ∫êÁÆ°ÁêÜ\n        this.dataSources = new Map();\n        \n        // Êï∞ÊçÆË¥®ÈáèÁõëÊéß\n        this.qualityMetrics = new Map();\n        \n        // Êï∞ÊçÆË°ÄÁºòÂÖ≥Á≥ª\n        this.lineageGraph = new Map();\n        \n        // Êï∞ÊçÆÊúçÂä°Ê≥®ÂÜåË°®\n        this.dataServices = new Map();\n        \n        // Êï∞ÊçÆÁºìÂ≠ò\n        this.dataCache = new Map();\n        \n        // Êï∞ÊçÆÊ≤ªÁêÜËßÑÂàô\n        this.governanceRules = new Map();\n        \n        // Êï∞ÊçÆËÆøÈóÆÊó•Âøó\n        this.accessLogs = [];\n        \n        this.init();\n    }\n    \n    /**\n     * ÂàùÂßãÂåñÊï∞ÊçÆ‰∏≠Âè∞\n     */\n    async init() {\n        try {\n            logger.info('üöÄ Êï∞ÊçÆ‰∏≠Âè∞ÂêØÂä®‰∏≠...');\n            \n            // ÂàùÂßãÂåñÊï∞ÊçÆËµÑ‰∫ßÁõÆÂΩï\n            await this.initializeDataAssets();\n            \n            // ÂàùÂßãÂåñÊï∞ÊçÆÊ∫ê\n            await this.initializeDataSources();\n            \n            // ÂàùÂßãÂåñÊï∞ÊçÆË¥®ÈáèÁõëÊéß\n            await this.initializeQualityMonitoring();\n            \n            // ÂàùÂßãÂåñÊï∞ÊçÆÊ≤ªÁêÜËßÑÂàô\n            await this.initializeGovernanceRules();\n            \n            // ÂêØÂä®Êï∞ÊçÆÊúçÂä°\n            await this.startDataServices();\n            \n            logger.info('‚úÖ Êï∞ÊçÆ‰∏≠Âè∞ÂêØÂä®ÂÆåÊàê');\n            this.emit('platform:ready');\n        } catch (error) {\n            logger.error('Êï∞ÊçÆ‰∏≠Âè∞ÂêØÂä®Â§±Ë¥•:', error);\n            throw error;\n        }\n    }\n    \n    /**\n     * ÂàùÂßãÂåñÊï∞ÊçÆËµÑ‰∫ßÁõÆÂΩï\n     */\n    async initializeDataAssets() {\n        // ËÉΩ-Á¢≥-‰∫ß-ËµÑÊ∫êÂõõË¶ÅÁ¥†Êï∞ÊçÆËµÑ‰∫ßÂÆö‰πâ\n        const assetDefinitions = [\n            {\n                id: 'energy_activity_data',\n                name: 'ËÉΩÊ∫êÊ¥ªÂä®Êï∞ÊçÆ',\n                category: 'energy',\n                description: 'Âõ≠Âå∫ËÉΩÊ∫êÊ∂àË¥π„ÄÅÁîü‰∫ßÊ¥ªÂä®Áõ∏ÂÖ≥Êï∞ÊçÆ',\n                schema: {\n                    park_id: 'string',\n                    activity_type: 'string',\n                    energy_type: 'string',\n                    consumption_amount: 'number',\n                    unit: 'string',\n                    timestamp: 'datetime',\n                    data_source: 'string'\n                },\n                quality_rules: ['completeness', 'accuracy', 'timeliness'],\n                retention_period: '5_years',\n                access_level: 'internal'\n            },\n            {\n                id: 'carbon_emission_data',\n                name: 'Á¢≥ÊéíÊîæÊï∞ÊçÆ',\n                category: 'carbon',\n                description: 'Âõ≠Âå∫Á¢≥ÊéíÊîæÊ†∏ÁÆóÁõ∏ÂÖ≥Êï∞ÊçÆ',\n                schema: {\n                    park_id: 'string',\n                    emission_scope: 'string',\n                    emission_source: 'string',\n                    emission_amount: 'number',\n                    emission_factor: 'number',\n                    calculation_method: 'string',\n                    timestamp: 'datetime'\n                },\n                quality_rules: ['completeness', 'accuracy', 'consistency'],\n                retention_period: '10_years',\n                access_level: 'restricted'\n            },\n            {\n                id: 'production_data',\n                name: 'Áîü‰∫ßÊï∞ÊçÆ',\n                category: 'production',\n                description: 'Âõ≠Âå∫‰ºÅ‰∏öÁîü‰∫ßÊ¥ªÂä®Êï∞ÊçÆ',\n                schema: {\n                    enterprise_id: 'string',\n                    product_type: 'string',\n                    production_volume: 'number',\n                    production_value: 'number',\n                    energy_consumption: 'number',\n                    timestamp: 'datetime'\n                },\n                quality_rules: ['completeness', 'accuracy'],\n                retention_period: '7_years',\n                access_level: 'confidential'\n            },\n            {\n                id: 'resource_circulation_data',\n                name: 'ËµÑÊ∫êÂæ™ÁéØÊï∞ÊçÆ',\n                category: 'resource',\n                description: 'Âõ≠Âå∫ËµÑÊ∫êÂæ™ÁéØÂà©Áî®Áõ∏ÂÖ≥Êï∞ÊçÆ',\n                schema: {\n                    park_id: 'string',\n                    resource_type: 'string',\n                    circulation_type: 'string',\n                    input_amount: 'number',\n                    output_amount: 'number',\n                    utilization_rate: 'number',\n                    timestamp: 'datetime'\n                },\n                quality_rules: ['completeness', 'accuracy'],\n                retention_period: '5_years',\n                access_level: 'internal'\n            },\n            {\n                id: 'national_indicator_data',\n                name: 'ÂõΩÂÆ∂ÊåáÊ†áÊï∞ÊçÆ',\n                category: 'indicator',\n                description: 'ÂõΩÂÆ∂Á∫ßÈõ∂Á¢≥Âõ≠Âå∫Âª∫ËÆæÊåáÊ†á‰ΩìÁ≥ªÊï∞ÊçÆ',\n                schema: {\n                    park_id: 'string',\n                    indicator_type: 'string',\n                    indicator_value: 'number',\n                    target_value: 'number',\n                    compliance_status: 'string',\n                    calculation_period: 'string',\n                    timestamp: 'datetime'\n                },\n                quality_rules: ['completeness', 'accuracy', 'timeliness', 'consistency'],\n                retention_period: 'permanent',\n                access_level: 'public'\n            }\n        ];\n        \n        for (const asset of assetDefinitions) {\n            this.dataAssets.set(asset.id, {\n                ...asset,\n                created_at: new Date().toISOString(),\n                last_updated: new Date().toISOString(),\n                version: '1.0.0',\n                status: 'active'\n            });\n        }\n        \n        logger.info(`üìã Â∑≤Ê≥®ÂÜå ${this.dataAssets.size} ‰∏™Êï∞ÊçÆËµÑ‰∫ß`);\n    }\n    \n    /**\n     * ÂàùÂßãÂåñÊï∞ÊçÆÊ∫ê\n     */\n    async initializeDataSources() {\n        const dataSources = [\n            {\n                id: 'ems_system',\n                name: 'ËÉΩÊ∫êÁÆ°ÁêÜÁ≥ªÁªü',\n                type: 'database',\n                connection: {\n                    host: 'localhost',\n                    port: 5432,\n                    database: 'ems_db',\n                    schema: 'energy_data'\n                },\n                data_assets: ['energy_activity_data'],\n                sync_frequency: '5_minutes',\n                status: 'active'\n            },\n            {\n                id: 'mes_system',\n                name: 'Âà∂ÈÄ†ÊâßË°åÁ≥ªÁªü',\n                type: 'api',\n                connection: {\n                    base_url: 'http://mes-api.local',\n                    auth_type: 'bearer_token'\n                },\n                data_assets: ['production_data'],\n                sync_frequency: '10_minutes',\n                status: 'active'\n            },\n            {\n                id: 'carbon_calculator',\n                name: 'Á¢≥ÊéíÊîæËÆ°ÁÆóÂºïÊìé',\n                type: 'service',\n                connection: {\n                    service_name: 'carbon-accounting-engine'\n                },\n                data_assets: ['carbon_emission_data'],\n                sync_frequency: 'real_time',\n                status: 'active'\n            },\n            {\n                id: 'national_platform',\n                name: 'ÂõΩÂÆ∂ÁõëÁÆ°Âπ≥Âè∞',\n                type: 'external_api',\n                connection: {\n                    base_url: 'https://national-carbon-platform.gov.cn/api',\n                    auth_type: 'api_key'\n                },\n                data_assets: ['national_indicator_data'],\n                sync_frequency: 'daily',\n                status: 'active'\n            }\n        ];\n        \n        for (const source of dataSources) {\n            this.dataSources.set(source.id, {\n                ...source,\n                created_at: new Date().toISOString(),\n                last_sync: null,\n                sync_status: 'pending'\n            });\n        }\n        \n        logger.info(`üîó Â∑≤ÈÖçÁΩÆ ${this.dataSources.size} ‰∏™Êï∞ÊçÆÊ∫ê`);\n    }\n    \n    /**\n     * ÂàùÂßãÂåñÊï∞ÊçÆË¥®ÈáèÁõëÊéß\n     */\n    async initializeQualityMonitoring() {\n        // Êï∞ÊçÆË¥®ÈáèËßÑÂàôÂÆö‰πâ\n        const qualityRules = {\n            completeness: {\n                name: 'ÂÆåÊï¥ÊÄßÊ£ÄÊü•',\n                description: 'Ê£ÄÊü•ÂøÖÂ°´Â≠óÊÆµÊòØÂê¶ÂÆåÊï¥',\n                threshold: 95, // 95%ÂÆåÊï¥ÊÄßË¶ÅÊ±Ç\n                check_function: this.checkCompleteness.bind(this)\n            },\n            accuracy: {\n                name: 'ÂáÜÁ°ÆÊÄßÊ£ÄÊü•',\n                description: 'Ê£ÄÊü•Êï∞ÊçÆÂÄºÊòØÂê¶Âú®ÂêàÁêÜËåÉÂõ¥ÂÜÖ',\n                threshold: 98, // 98%ÂáÜÁ°ÆÊÄßË¶ÅÊ±Ç\n                check_function: this.checkAccuracy.bind(this)\n            },\n            timeliness: {\n                name: 'Êó∂ÊïàÊÄßÊ£ÄÊü•',\n                description: 'Ê£ÄÊü•Êï∞ÊçÆÊòØÂê¶ÂèäÊó∂Êõ¥Êñ∞',\n                threshold: 90, // 90%Êó∂ÊïàÊÄßË¶ÅÊ±Ç\n                check_function: this.checkTimeliness.bind(this)\n            },\n            consistency: {\n                name: '‰∏ÄËá¥ÊÄßÊ£ÄÊü•',\n                description: 'Ê£ÄÊü•Êï∞ÊçÆÂú®‰∏çÂêåÁ≥ªÁªüÈó¥ÁöÑ‰∏ÄËá¥ÊÄß',\n                threshold: 95, // 95%‰∏ÄËá¥ÊÄßË¶ÅÊ±Ç\n                check_function: this.checkConsistency.bind(this)\n            }\n        };\n        \n        for (const [ruleId, rule] of Object.entries(qualityRules)) {\n            this.qualityMetrics.set(ruleId, {\n                ...rule,\n                last_check: null,\n                current_score: null,\n                history: []\n            });\n        }\n        \n        // ÂêØÂä®Ë¥®ÈáèÁõëÊéßÂÆöÊó∂Âô®\n        setInterval(async () => {\n            await this.performQualityCheck();\n        }, MATH_CONSTANTS.FIFTEEN * MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.MILLISECONDS_PER_SECOND); // ÊØè15ÂàÜÈíüÊ£ÄÊü•‰∏ÄÊ¨°\n        \n        logger.info('üìä Êï∞ÊçÆË¥®ÈáèÁõëÊéßÂ∑≤ÂêØÂä®');\n    }\n    \n    /**\n     * ÂàùÂßãÂåñÊï∞ÊçÆÊ≤ªÁêÜËßÑÂàô\n     */\n    async initializeGovernanceRules() {\n        const governanceRules = [\n            {\n                id: 'data_classification',\n                name: 'Êï∞ÊçÆÂàÜÁ±ªËßÑÂàô',\n                type: 'classification',\n                rules: {\n                    public: ['national_indicator_data'],\n                    internal: ['energy_activity_data', 'resource_circulation_data'],\n                    confidential: ['production_data'],\n                    restricted: ['carbon_emission_data']\n                }\n            },\n            {\n                id: 'access_control',\n                name: 'ËÆøÈóÆÊéßÂà∂ËßÑÂàô',\n                type: 'access',\n                rules: {\n                    admin: ['*'],\n                    operator: ['energy_activity_data', 'carbon_emission_data', 'national_indicator_data'],\n                    viewer: ['national_indicator_data']\n                }\n            },\n            {\n                id: 'retention_policy',\n                name: 'Êï∞ÊçÆ‰øùÁïôÁ≠ñÁï•',\n                type: 'retention',\n                rules: {\n                    '1_year': [],\n                    '5_years': ['energy_activity_data', 'resource_circulation_data'],\n                    '7_years': ['production_data'],\n                    '10_years': ['carbon_emission_data'],\n                    'permanent': ['national_indicator_data']\n                }\n            }\n        ];\n        \n        for (const rule of governanceRules) {\n            this.governanceRules.set(rule.id, {\n                ...rule,\n                created_at: new Date().toISOString(),\n                status: 'active'\n            });\n        }\n        \n        logger.info(`‚öñÔ∏è Â∑≤ÈÖçÁΩÆ ${this.governanceRules.size} ‰∏™Êï∞ÊçÆÊ≤ªÁêÜËßÑÂàô`);\n    }\n    \n    /**\n     * ÂêØÂä®Êï∞ÊçÆÊúçÂä°\n     */\n    async startDataServices() {\n        // Ê≥®ÂÜåÊ†áÂáÜÂåñÊï∞ÊçÆAPIÊúçÂä°\n        const dataServices = [\n            {\n                id: 'energy_data_api',\n                name: 'ËÉΩÊ∫êÊï∞ÊçÆAPI',\n                endpoint: '/api/data/energy',\n                data_assets: ['energy_activity_data'],\n                methods: ['GET', 'POST'],\n                rate_limit: 1000\n            },\n            {\n                id: 'carbon_data_api',\n                name: 'Á¢≥ÊéíÊîæÊï∞ÊçÆAPI',\n                endpoint: '/api/data/carbon',\n                data_assets: ['carbon_emission_data'],\n                methods: ['GET', 'POST'],\n                rate_limit: 500\n            },\n            {\n                id: 'production_data_api',\n                name: 'Áîü‰∫ßÊï∞ÊçÆAPI',\n                endpoint: '/api/data/production',\n                data_assets: ['production_data'],\n                methods: ['GET'],\n                rate_limit: 200\n            },\n            {\n                id: 'indicator_data_api',\n                name: 'ÂõΩÂÆ∂ÊåáÊ†áÊï∞ÊçÆAPI',\n                endpoint: '/api/data/indicators',\n                data_assets: ['national_indicator_data'],\n                methods: ['GET', 'POST'],\n                rate_limit: 2000\n            }\n        ];\n        \n        for (const service of dataServices) {\n            this.dataServices.set(service.id, {\n                ...service,\n                created_at: new Date().toISOString(),\n                status: 'active',\n                request_count: 0,\n                last_access: null\n            });\n        }\n        \n        logger.info(`üîå Â∑≤ÂêØÂä® ${this.dataServices.size} ‰∏™Êï∞ÊçÆÊúçÂä°`);\n    }\n    \n    /**\n     * Ëé∑ÂèñÊï∞ÊçÆËµÑ‰∫ß\n     * @param {string} assetId Êï∞ÊçÆËµÑ‰∫ßID\n     * @param {Object} query Êü•ËØ¢Êù°‰ª∂\n     * @param {Object} user Áî®Êà∑‰ø°ÊÅØ\n     */\n    async getDataAsset(assetId, query = {}, user = null) {\n        try {\n            // Ê£ÄÊü•Êï∞ÊçÆËµÑ‰∫ßÊòØÂê¶Â≠òÂú®\n            const asset = this.dataAssets.get(assetId);\n            if (!asset) {\n                throw new Error(`Êï∞ÊçÆËµÑ‰∫ß‰∏çÂ≠òÂú®: ${assetId}`);\n            }\n            \n            // ËÆøÈóÆÊùÉÈôêÊ£ÄÊü•\n            if (!this.checkAccess(assetId, user)) {\n                throw new Error('ËÆøÈóÆÊùÉÈôê‰∏çË∂≥');\n            }\n            \n            // Ê£ÄÊü•ÁºìÂ≠ò\n            const cacheKey = this.generateCacheKey(assetId, query);\n            const cached = this.dataCache.get(cacheKey);\n            if (cached && this.isCacheValid(cached.timestamp)) {\n                this.logAccess(assetId, user, 'cache_hit');\n                return cached.data;\n            }\n            \n            // ‰ªéÊï∞ÊçÆÊ∫êËé∑ÂèñÊï∞ÊçÆ\n            const data = await this.fetchDataFromSource(assetId, query);\n            \n            // Êï∞ÊçÆË¥®ÈáèÊ£ÄÊü•\n            const qualityScore = await this.checkDataQuality(assetId, data);\n            \n            // ÁºìÂ≠òÊï∞ÊçÆ\n            this.dataCache.set(cacheKey, {\n                data: {\n                    ...data,\n                    quality_score: qualityScore,\n                    retrieved_at: new Date().toISOString()\n                },\n                timestamp: new Date().toISOString()\n            });\n            \n            // ËÆ∞ÂΩïËÆøÈóÆÊó•Âøó\n            this.logAccess(assetId, user, 'success');\n            \n            return data;\n        } catch (error) {\n            this.logAccess(assetId, user, 'error', error.message);\n            throw error;\n        }\n    }\n    \n    /**\n     * ÂàõÂª∫Êï∞ÊçÆËµÑ‰∫ß\n     * @param {Object} assetData Êï∞ÊçÆËµÑ‰∫ßÊï∞ÊçÆ\n     * @param {Object} user Áî®Êà∑‰ø°ÊÅØ\n     */\n    async createDataAsset(assetData, user = null) {\n        try {\n            // ÊùÉÈôêÊ£ÄÊü•\n            if (!this.checkCreatePermission(user)) {\n                throw new Error('ÂàõÂª∫ÊùÉÈôê‰∏çË∂≥');\n            }\n            \n            // Êï∞ÊçÆÈ™åËØÅ\n            this.validateAssetData(assetData);\n            \n            // ÁîüÊàêËµÑ‰∫ßID\n            const assetId = this.generateAssetId(assetData);\n            \n            // ÂàõÂª∫Êï∞ÊçÆËµÑ‰∫ß\n            const asset = {\n                id: assetId,\n                ...assetData,\n                created_at: new Date().toISOString(),\n                created_by: user?.username || 'system',\n                last_updated: new Date().toISOString(),\n                version: '1.0.0',\n                status: 'active'\n            };\n            \n            this.dataAssets.set(assetId, asset);\n            \n            // Âª∫Á´ãÊï∞ÊçÆË°ÄÁºòÂÖ≥Á≥ª\n            if (assetData.source_assets) {\n                this.updateLineage(assetId, assetData.source_assets);\n            }\n            \n            logger.info(`üìù ÂàõÂª∫Êï∞ÊçÆËµÑ‰∫ß: ${assetId}`);\n            this.emit('asset:created', asset);\n            \n            return asset;\n        } catch (error) {\n            logger.error('ÂàõÂª∫Êï∞ÊçÆËµÑ‰∫ßÂ§±Ë¥•:', error);\n            throw error;\n        }\n    }\n    \n    /**\n     * Êõ¥Êñ∞Êï∞ÊçÆËµÑ‰∫ß\n     * @param {string} assetId Êï∞ÊçÆËµÑ‰∫ßID\n     * @param {Object} updateData Êõ¥Êñ∞Êï∞ÊçÆ\n     * @param {Object} user Áî®Êà∑‰ø°ÊÅØ\n     */\n    async updateDataAsset(assetId, updateData, user = null) {\n        try {\n            const asset = this.dataAssets.get(assetId);\n            if (!asset) {\n                throw new Error(`Êï∞ÊçÆËµÑ‰∫ß‰∏çÂ≠òÂú®: ${assetId}`);\n            }\n            \n            // ÊùÉÈôêÊ£ÄÊü•\n            if (!this.checkUpdatePermission(assetId, user)) {\n                throw new Error('Êõ¥Êñ∞ÊùÉÈôê‰∏çË∂≥');\n            }\n            \n            // Êõ¥Êñ∞ËµÑ‰∫ß\n            const updatedAsset = {\n                ...asset,\n                ...updateData,\n                last_updated: new Date().toISOString(),\n                updated_by: user?.username || 'system',\n                version: this.incrementVersion(asset.version)\n            };\n            \n            this.dataAssets.set(assetId, updatedAsset);\n            \n            // Ê∏ÖÁêÜÁõ∏ÂÖ≥ÁºìÂ≠ò\n            this.clearAssetCache(assetId);\n            \n            logger.info(`üìù Êõ¥Êñ∞Êï∞ÊçÆËµÑ‰∫ß: ${assetId}`);\n            this.emit('asset:updated', updatedAsset);\n            \n            return updatedAsset;\n        } catch (error) {\n            logger.error('Êõ¥Êñ∞Êï∞ÊçÆËµÑ‰∫ßÂ§±Ë¥•:', error);\n            throw error;\n        }\n    }\n    \n    /**\n     * Ëé∑ÂèñÊï∞ÊçÆË°ÄÁºòÂÖ≥Á≥ª\n     * @param {string} assetId Êï∞ÊçÆËµÑ‰∫ßID\n     */\n    getDataLineage(assetId) {\n        const lineage = {\n            asset_id: assetId,\n            upstream: [],\n            downstream: [],\n            depth: 3 // ÈªòËÆ§ËøΩÊ∫Ø3Â±Ç\n        };\n        \n        // Ëé∑Âèñ‰∏äÊ∏∏‰æùËµñ\n        lineage.upstream = this.getUpstreamAssets(assetId, lineage.depth);\n        \n        // Ëé∑Âèñ‰∏ãÊ∏∏‰æùËµñ\n        lineage.downstream = this.getDownstreamAssets(assetId, lineage.depth);\n        \n        return lineage;\n    }\n    \n    /**\n     * Ëé∑ÂèñÊï∞ÊçÆË¥®ÈáèÊä•Âëä\n     * @param {string} assetId Êï∞ÊçÆËµÑ‰∫ßID\n     * @param {string} timeRange Êó∂Èó¥ËåÉÂõ¥\n     */\n    async getQualityReport(assetId, timeRange = '7d') {\n        const asset = this.dataAssets.get(assetId);\n        if (!asset) {\n            throw new Error(`Êï∞ÊçÆËµÑ‰∫ß‰∏çÂ≠òÂú®: ${assetId}`);\n        }\n        \n        const report = {\n            asset_id: assetId,\n            asset_name: asset.name,\n            time_range: timeRange,\n            generated_at: new Date().toISOString(),\n            quality_metrics: {},\n            overall_score: 0,\n            issues: [],\n            recommendations: []\n        };\n        \n        // ËÆ°ÁÆóÂêÑÈ°πË¥®ÈáèÊåáÊ†á\n        let totalScore = 0;\n        let metricCount = 0;\n        \n        for (const rule of asset.quality_rules) {\n            const metric = this.qualityMetrics.get(rule);\n            if (metric) {\n                const score = await this.calculateQualityScore(assetId, rule, timeRange);\n                report.quality_metrics[rule] = {\n                    score: score,\n                    threshold: metric.threshold,\n                    status: score >= metric.threshold ? 'pass' : 'fail'\n                };\n                \n                totalScore += score;\n                metricCount++;\n                \n                if (score < metric.threshold) {\n                    report.issues.push({\n                        type: rule,\n                        severity: score < metric.threshold * 0.8 ? 'high' : 'medium',\n                        description: `${metric.name}‰∏çËææÊ†á: ${score}% < ${metric.threshold}%`\n                    });\n                }\n            }\n        }\n        \n        report.overall_score = metricCount > 0 ? Math.round(totalScore / metricCount) : 0;\n        \n        // ÁîüÊàêÊîπËøõÂª∫ËÆÆ\n        report.recommendations = this.generateQualityRecommendations(report);\n        \n        return report;\n    }\n    \n    /**\n     * ÊâßË°åÊï∞ÊçÆË¥®ÈáèÊ£ÄÊü•\n     */\n    async performQualityCheck() {\n        logger.info('üîç ÂºÄÂßãÊï∞ÊçÆË¥®ÈáèÊ£ÄÊü•...');\n        \n        for (const [assetId, asset] of this.dataAssets) {\n            try {\n                for (const rule of asset.quality_rules) {\n                    const metric = this.qualityMetrics.get(rule);\n                    if (metric) {\n                        const score = await metric.check_function(assetId);\n                        \n                        // Êõ¥Êñ∞Ë¥®ÈáèÊåáÊ†á\n                        metric.current_score = score;\n                        metric.last_check = new Date().toISOString();\n                        metric.history.push({\n                            score: score,\n                            timestamp: new Date().toISOString()\n                        });\n                        \n                        // ‰øùÁïôÊúÄËøë100Êù°ÂéÜÂè≤ËÆ∞ÂΩï\n                        if (metric.history.length > 100) {\n                            metric.history = metric.history.slice(-100);\n                        }\n                        \n                        // Ë¥®ÈáèÂëäË≠¶\n                        if (score < metric.threshold) {\n                            this.emit('quality:alert', {\n                                asset_id: assetId,\n                                rule: rule,\n                                score: score,\n                                threshold: metric.threshold,\n                                timestamp: new Date().toISOString()\n                            });\n                        }\n                    }\n                }\n            } catch (error) {\n                logger.error(`Êï∞ÊçÆË¥®ÈáèÊ£ÄÊü•Â§±Ë¥• (${assetId}):`, error);\n            }\n        }\n        \n        logger.info('‚úÖ Êï∞ÊçÆË¥®ÈáèÊ£ÄÊü•ÂÆåÊàê');\n    }\n    \n    // Êï∞ÊçÆË¥®ÈáèÊ£ÄÊü•ÊñπÊ≥ï\n    async checkCompleteness(assetId) {\n        // Ê®°ÊãüÂÆåÊï¥ÊÄßÊ£ÄÊü•\n        return Math.random() * 20 + 80; // 80-100%\n    }\n    \n    async checkAccuracy(assetId) {\n        // Ê®°ÊãüÂáÜÁ°ÆÊÄßÊ£ÄÊü•\n        return Math.random() * 10 + 90; // 90-100%\n    }\n    \n    async checkTimeliness(assetId) {\n        // Ê®°ÊãüÊó∂ÊïàÊÄßÊ£ÄÊü•\n        return Math.random() * 30 + 70; // 70-100%\n    }\n    \n    async checkConsistency(assetId) {\n        // Ê®°Êãü‰∏ÄËá¥ÊÄßÊ£ÄÊü•\n        return Math.random() * 15 + 85; // 85-100%\n    }\n    \n    // ËæÖÂä©ÊñπÊ≥ï\n    checkAccess(assetId, user) {\n        if (!user) return false;\n        \n        const accessRule = this.governanceRules.get('access_control');\n        if (!accessRule) return true;\n        \n        const userRole = user.role || 'viewer';\n        const allowedAssets = accessRule.rules[userRole] || [];\n        \n        return allowedAssets.includes('*') || allowedAssets.includes(assetId);\n    }\n    \n    checkCreatePermission(user) {\n        return user && ['admin', 'operator'].includes(user.role);\n    }\n    \n    checkUpdatePermission(assetId, user) {\n        return user && ['admin', 'operator'].includes(user.role);\n    }\n    \n    generateCacheKey(assetId, query) {\n        return `${assetId}_${JSON.stringify(query)}`;\n    }\n    \n    isCacheValid(timestamp) {\n        const age = Date.now() - new Date(timestamp).getTime();\n        return age < MATH_CONSTANTS.FIVE * MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.MILLISECONDS_PER_SECOND; // 5ÂàÜÈíüÁºìÂ≠ò\n    }\n    \n    async fetchDataFromSource(assetId, query) {\n        // Ê®°Êãü‰ªéÊï∞ÊçÆÊ∫êËé∑ÂèñÊï∞ÊçÆ\n        return {\n            asset_id: assetId,\n            data: [\n                {\n                    id: 1,\n                    value: Math.random() * 100,\n                    timestamp: new Date().toISOString()\n                }\n            ],\n            total_count: 1,\n            query: query\n        };\n    }\n    \n    async checkDataQuality(assetId, data) {\n        // ÁÆÄÂåñÁöÑÊï∞ÊçÆË¥®ÈáèËØÑÂàÜ\n        return Math.round(Math.random() * 20 + 80); // 80-100ÂàÜ\n    }\n    \n    logAccess(assetId, user, status, error = null) {\n        const log = {\n            asset_id: assetId,\n            user: user?.username || 'anonymous',\n            status: status,\n            error: error,\n            timestamp: new Date().toISOString()\n        };\n        \n        this.accessLogs.push(log);\n        \n        // ‰øùÁïôÊúÄËøë1000Êù°Êó•Âøó\n        if (this.accessLogs.length > 1000) {\n            this.accessLogs = this.accessLogs.slice(-1000);\n        }\n    }\n    \n    validateAssetData(assetData) {\n        const required = ['name', 'category', 'description', 'schema'];\n        for (const field of required) {\n            if (!assetData[field]) {\n                throw new Error(`Áº∫Â∞ëÂøÖÂ°´Â≠óÊÆµ: ${field}`);\n            }\n        }\n    }\n    \n    generateAssetId(assetData) {\n        return `${assetData.category}_${Date.now()}`;\n    }\n    \n    updateLineage(assetId, sourceAssets) {\n        if (!this.lineageGraph.has(assetId)) {\n            this.lineageGraph.set(assetId, { upstream: [], downstream: [] });\n        }\n        \n        const lineage = this.lineageGraph.get(assetId);\n        lineage.upstream = [...new Set([...lineage.upstream, ...sourceAssets])];\n        \n        // Êõ¥Êñ∞Ê∫êËµÑ‰∫ßÁöÑ‰∏ãÊ∏∏ÂÖ≥Á≥ª\n        for (const sourceId of sourceAssets) {\n            if (!this.lineageGraph.has(sourceId)) {\n                this.lineageGraph.set(sourceId, { upstream: [], downstream: [] });\n            }\n            const sourceLineage = this.lineageGraph.get(sourceId);\n            if (!sourceLineage.downstream.includes(assetId)) {\n                sourceLineage.downstream.push(assetId);\n            }\n        }\n    }\n    \n    clearAssetCache(assetId) {\n        for (const [key, value] of this.dataCache) {\n            if (key.startsWith(assetId)) {\n                this.dataCache.delete(key);\n            }\n        }\n    }\n    \n    incrementVersion(version) {\n        const parts = version.split('.');\n        parts[2] = (parseInt(parts[2]) + 1).toString();\n        return parts.join('.');\n    }\n    \n    getUpstreamAssets(assetId, depth) {\n        const result = [];\n        const visited = new Set();\n        \n        const traverse = (id, currentDepth) => {\n            if (currentDepth >= depth || visited.has(id)) return;\n            visited.add(id);\n            \n            const lineage = this.lineageGraph.get(id);\n            if (lineage) {\n                for (const upstreamId of lineage.upstream) {\n                    result.push({ asset_id: upstreamId, depth: currentDepth + 1 });\n                    traverse(upstreamId, currentDepth + 1);\n                }\n            }\n        };\n        \n        traverse(assetId, 0);\n        return result;\n    }\n    \n    getDownstreamAssets(assetId, depth) {\n        const result = [];\n        const visited = new Set();\n        \n        const traverse = (id, currentDepth) => {\n            if (currentDepth >= depth || visited.has(id)) return;\n            visited.add(id);\n            \n            const lineage = this.lineageGraph.get(id);\n            if (lineage) {\n                for (const downstreamId of lineage.downstream) {\n                    result.push({ asset_id: downstreamId, depth: currentDepth + 1 });\n                    traverse(downstreamId, currentDepth + 1);\n                }\n            }\n        };\n        \n        traverse(assetId, 0);\n        return result;\n    }\n    \n    async calculateQualityScore(assetId, rule, timeRange) {\n        const metric = this.qualityMetrics.get(rule);\n        if (!metric || !metric.history.length) {\n            return 0;\n        }\n        \n        // ËÆ°ÁÆóÊó∂Èó¥ËåÉÂõ¥ÂÜÖÁöÑÂπ≥ÂùáÂàÜÊï∞\n        const now = new Date();\n        const rangeMs = this.parseTimeRange(timeRange);\n        const cutoff = new Date(now.getTime() - rangeMs);\n        \n        const relevantScores = metric.history\n            .filter(record => new Date(record.timestamp) >= cutoff)\n            .map(record => record.score);\n            \n        if (relevantScores.length === 0) {\n            return metric.current_score || 0;\n        }\n        \n        return Math.round(relevantScores.reduce((sum, score) => sum + score, 0) / relevantScores.length);\n    }\n    \n    parseTimeRange(timeRange) {\n        const unit = timeRange.slice(-1);\n        const value = parseInt(timeRange.slice(0, -1));\n        \n        switch (unit) {\n            case 'h': return value * MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.MILLISECONDS_PER_SECOND;\n            case 'd': return value * MATH_CONSTANTS.TWENTY_FOUR * MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.MILLISECONDS_PER_SECOND;\n            case 'w': return value * MATH_CONSTANTS.SEVEN * MATH_CONSTANTS.TWENTY_FOUR * MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.MILLISECONDS_PER_SECOND;\n            default: return MATH_CONSTANTS.SEVEN * MATH_CONSTANTS.TWENTY_FOUR * MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.MILLISECONDS_PER_SECOND;\n        }\n    }\n    \n    generateQualityRecommendations(report) {\n        const recommendations = [];\n        \n        for (const [rule, metric] of Object.entries(report.quality_metrics)) {\n            if (metric.status === 'fail') {\n                switch (rule) {\n                    case 'completeness':\n                        recommendations.push('Â¢ûÂº∫Êï∞ÊçÆÈááÈõÜË¶ÜÁõñÁéáÔºåÁ°Æ‰øùÂÖ≥ÈîÆÂ≠óÊÆµÂÆåÊï¥ÊÄß');\n                        break;\n                    case 'accuracy':\n                        recommendations.push('Âä†Âº∫Êï∞ÊçÆÈ™åËØÅËßÑÂàôÔºåÊèêÈ´òÊï∞ÊçÆÂáÜÁ°ÆÊÄß');\n                        break;\n                    case 'timeliness':\n                        recommendations.push('‰ºòÂåñÊï∞ÊçÆÂêåÊ≠•È¢ëÁéáÔºåÊèêÂçáÊï∞ÊçÆÊó∂ÊïàÊÄß');\n                        break;\n                    case 'consistency':\n                        recommendations.push('Âª∫Á´ãÊï∞ÊçÆÊ†áÂáÜÂåñÊµÅÁ®ãÔºåÁ°Æ‰øùË∑®Á≥ªÁªü‰∏ÄËá¥ÊÄß');\n                        break;\n                }\n            }\n        }\n        \n        return recommendations;\n    }\n    \n    /**\n     * Ëé∑ÂèñÂπ≥Âè∞ÁªüËÆ°‰ø°ÊÅØ\n     */\n    getPlatformStats() {\n        return {\n            data_assets: this.dataAssets.size,\n            data_sources: this.dataSources.size,\n            data_services: this.dataServices.size,\n            governance_rules: this.governanceRules.size,\n            cache_size: this.dataCache.size,\n            access_logs: this.accessLogs.length,\n            quality_metrics: this.qualityMetrics.size\n        };\n    }\n}\n\nexport default DataPlatform;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/core/entities/Device.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/core/entities/DeviceHistory.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/core/entities/DeviceType.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/core/entities/NotificationPreferences.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/core/entities/recommendation.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/core/entities/storageDevice.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/core/services/AlertManager.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/core/services/CarbonAccountingEngine.js","messages":[{"ruleId":"object-shorthand","severity":2,"message":"Expected property shorthand.","line":189,"column":13,"nodeType":"Property","messageId":"expectedPropertyShorthand","endLine":189,"endColumn":37,"fix":{"range":[5139,5163],"text":"consumption"}},{"ruleId":"object-shorthand","severity":2,"message":"Expected property shorthand.","line":237,"column":13,"nodeType":"Property","messageId":"expectedPropertyShorthand","endLine":237,"endColumn":35,"fix":{"range":[6447,6469],"text":"production"}},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":348,"column":27,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":348,"endColumn":39,"fix":{"range":[9540,9552],"text":"{return null;}"}},{"ruleId":"no-unused-vars","severity":2,"message":"'parkId' is defined but never used. Allowed unused args must match /^_/u.","line":400,"column":34,"nodeType":"Identifier","messageId":"unusedVar","endLine":400,"endColumn":40},{"ruleId":"no-unused-vars","severity":2,"message":"'timeRange' is defined but never used. Allowed unused args must match /^_/u.","line":400,"column":42,"nodeType":"Identifier","messageId":"unusedVar","endLine":400,"endColumn":51},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10000.","line":403,"column":36,"nodeType":"Literal","messageId":"noMagic","endLine":403,"endColumn":41},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5000.","line":404,"column":36,"nodeType":"Literal","messageId":"noMagic","endLine":404,"endColumn":40},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 2000.","line":405,"column":29,"nodeType":"Literal","messageId":"noMagic","endLine":405,"endColumn":33},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":406,"column":31,"nodeType":"Literal","messageId":"noMagic","endLine":406,"endColumn":35},{"ruleId":"no-unused-vars","severity":2,"message":"'parkId' is defined but never used. Allowed unused args must match /^_/u.","line":410,"column":34,"nodeType":"Identifier","messageId":"unusedVar","endLine":410,"endColumn":40},{"ruleId":"no-unused-vars","severity":2,"message":"'timeRange' is defined but never used. Allowed unused args must match /^_/u.","line":410,"column":42,"nodeType":"Identifier","messageId":"unusedVar","endLine":410,"endColumn":51},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":413,"column":31,"nodeType":"Literal","messageId":"noMagic","endLine":413,"endColumn":35},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":414,"column":30,"nodeType":"Literal","messageId":"noMagic","endLine":414,"endColumn":33},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 300.","line":415,"column":33,"nodeType":"Literal","messageId":"noMagic","endLine":415,"endColumn":36},{"ruleId":"no-unused-vars","severity":2,"message":"'parkId' is defined but never used. Allowed unused args must match /^_/u.","line":419,"column":28,"nodeType":"Identifier","messageId":"unusedVar","endLine":419,"endColumn":34},{"ruleId":"no-unused-vars","severity":2,"message":"'timeRange' is defined but never used. Allowed unused args must match /^_/u.","line":419,"column":36,"nodeType":"Identifier","messageId":"unusedVar","endLine":419,"endColumn":45},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000000.","line":421,"column":28,"nodeType":"Literal","messageId":"noMagic","endLine":421,"endColumn":35}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":3,"fixableWarningCount":0,"source":"/**\n * Á¢≥ÊéíÊîæÂÆûÊó∂Ê†∏ÁÆóÂºïÊìé\n * ÂÆûÁé∞„ÄäÈõ∂Á¢≥Âõ≠Âå∫Á¢≥ÊéíÊîæÊ†∏ÁÆóÊñπÊ≥ïÔºàËØïË°åÔºâ„ÄãÂÆåÊï¥ËÆ°ÁÆóÈÄªËæë\n * ÊîØÊåÅÂõ≠Âå∫ÊÄªÁ¢≥ÊéíÊîæÈáèÂÆûÊó∂Ê†∏ÁÆó (EÂõ≠Âå∫ = EËÉΩÊ∫êÊ¥ªÂä® + EÂ∑•‰∏öËøáÁ®ã)\n */\n\nimport { EventEmitter } from 'events';\nimport logger from '../../shared/utils/logger.js';\nimport { CARBON_CONSTANTS, MATH_CONSTANTS } from '../../shared/constants/MathConstants.js';\n\nclass CarbonAccountingEngine extends EventEmitter {\n  constructor() {\n    super();\n    this.isInitialized = false;\n    this.emissionFactors = new Map();\n    this.realTimeData = new Map();\n    this.calculationCache = new Map();\n    this.cacheTimeout = CARBON_CONSTANTS.CACHE_TIMEOUT;\n    \n    // ÂõΩÂÆ∂Êé®ËçêÊéíÊîæÂõ†Â≠êÊï∞ÊçÆÂ∫ì\n    this.nationalEmissionFactors = {\n      // ÁîµÂäõÊéíÊîæÂõ†Â≠ê (kg CO2/kWh)\n      electricity: {\n        national_grid: 0.5703, // ÂÖ®ÂõΩÁîµÁΩëÂπ≥ÂùáÊéíÊîæÂõ†Â≠ê\n        regional_grid: {\n          north_china: 0.8843,\n          northeast_china: 0.8825,\n          east_china: 0.7035,\n          central_china: 0.8257,\n          northwest_china: 0.8922,\n          south_china: 0.5271\n        },\n        renewable: {\n          solar: 0.0,\n          wind: 0.0,\n          hydro: 0.0,\n          nuclear: 0.0\n        }\n      },\n      // ÂåñÁü≥ÁáÉÊñôÊéíÊîæÂõ†Â≠ê\n      fossil_fuels: {\n        natural_gas: 2.1622, // kg CO2/m¬≥\n        coal: 2.4930, // kg CO2/kg\n        diesel: 3.0959, // kg CO2/L\n        gasoline: 2.9251, // kg CO2/L\n        heavy_oil: 3.1705, // kg CO2/kg\n        lpg: 3.0012 // kg CO2/kg\n      },\n      // Â∑•‰∏öËøáÁ®ãÊéíÊîæÂõ†Â≠ê\n      industrial_process: {\n        cement: 0.5273, // kg CO2/kgÊ∞¥Ê≥•\n        steel: 2.07, // kg CO2/kgÈí¢ÈìÅ\n        aluminum: 11.46, // kg CO2/kgÈìù\n        chemical: 1.5, // kg CO2/kgÂåñÂ∑•‰∫ßÂìÅÔºàÂπ≥ÂùáÂÄºÔºâ\n        paper: 0.9 // kg CO2/kgÁ∫∏Âº†\n      }\n    };\n    \n    this.init();\n  }\n\n  async init() {\n    try {\n      await this.loadEmissionFactors();\n      await this.setupRealTimeMonitoring();\n      this.isInitialized = true;\n      logger.info('Á¢≥ÊéíÊîæÂÆûÊó∂Ê†∏ÁÆóÂºïÊìéÂàùÂßãÂåñÂÆåÊàê');\n      this.emit('initialized');\n    } catch (error) {\n      logger.error('Á¢≥ÊéíÊîæÊ†∏ÁÆóÂºïÊìéÂàùÂßãÂåñÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Âä†ËΩΩÊéíÊîæÂõ†Â≠êÊï∞ÊçÆ\n   */\n  async loadEmissionFactors() {\n    try {\n      // Âä†ËΩΩÂõΩÂÆ∂Êé®ËçêÊéíÊîæÂõ†Â≠ê\n      for (const [category, factors] of Object.entries(this.nationalEmissionFactors)) {\n        this.emissionFactors.set(category, factors);\n      }\n      \n      // ‰ªéÊï∞ÊçÆÂ∫ìÂä†ËΩΩËá™ÂÆö‰πâÊéíÊîæÂõ†Â≠ê\n      // TODO: ÂÆûÁé∞Êï∞ÊçÆÂ∫ìÊü•ËØ¢ÈÄªËæë\n      \n      logger.info(`Â∑≤Âä†ËΩΩ ${this.emissionFactors.size} Á±ªÊéíÊîæÂõ†Â≠ê`);\n    } catch (error) {\n      logger.error('Âä†ËΩΩÊéíÊîæÂõ†Â≠êÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * ËÆæÁΩÆÂÆûÊó∂ÁõëÊéß\n   */\n  async setupRealTimeMonitoring() {\n    // ÊØèÂàÜÈíüÊõ¥Êñ∞‰∏ÄÊ¨°ÂÆûÊó∂Êï∞ÊçÆ\n    setInterval(async () => {\n      try {\n        await this.updateRealTimeEmissions();\n      } catch (error) {\n        logger.error('Êõ¥Êñ∞ÂÆûÊó∂ÊéíÊîæÊï∞ÊçÆÂ§±Ë¥•:', error);\n      }\n    }, MATH_CONSTANTS.SECONDS_PER_MINUTE * MATH_CONSTANTS.MILLISECONDS_PER_SECOND);\n  }\n\n  /**\n   * ËÆ°ÁÆóÂõ≠Âå∫ÊÄªÁ¢≥ÊéíÊîæÈáè\n   * EÂõ≠Âå∫ = EËÉΩÊ∫êÊ¥ªÂä® + EÂ∑•‰∏öËøáÁ®ã\n   * @param {string} parkId - Âõ≠Âå∫ID\n   * @param {string} timeRange - Êó∂Èó¥ËåÉÂõ¥\n   * @returns {Object} Á¢≥ÊéíÊîæËÆ°ÁÆóÁªìÊûú\n   */\n  async calculateParkTotalEmissions(parkId, timeRange = '24h') {\n    try {\n      const cacheKey = `park_total_${parkId}_${timeRange}`;\n      const cached = this.getFromCache(cacheKey);\n      if (cached) {\n        return cached;\n      }\n\n      // ËÆ°ÁÆóËÉΩÊ∫êÊ¥ªÂä®Á¢≥ÊéíÊîæ\n      const energyEmissions = await this.calculateEnergyActivityEmissions(parkId, timeRange);\n      \n      // ËÆ°ÁÆóÂ∑•‰∏öËøáÁ®ãÁ¢≥ÊéíÊîæ\n      const processEmissions = await this.calculateIndustrialProcessEmissions(parkId, timeRange);\n      \n      // ËÆ°ÁÆóÊÄªÊéíÊîæÈáè\n      const totalEmissions = {\n        park_id: parkId,\n        time_range: timeRange,\n        timestamp: new Date().toISOString(),\n        energy_activity_emissions: energyEmissions,\n        industrial_process_emissions: processEmissions,\n        total_emissions: energyEmissions.total + processEmissions.total,\n        calculation_method: '„ÄäÈõ∂Á¢≥Âõ≠Âå∫Á¢≥ÊéíÊîæÊ†∏ÁÆóÊñπÊ≥ïÔºàËØïË°åÔºâ„Äã',\n        emission_factors_version: 'national_2024'\n      };\n\n      // ÁºìÂ≠òÁªìÊûú\n      this.setCache(cacheKey, totalEmissions);\n      \n      // ÂèëÈÄÅÂÆûÊó∂Êõ¥Êñ∞‰∫ã‰ª∂\n      this.emit('emissions_calculated', totalEmissions);\n      \n      return totalEmissions;\n    } catch (error) {\n      logger.error('ËÆ°ÁÆóÂõ≠Âå∫ÊÄªÁ¢≥ÊéíÊîæÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * ËÆ°ÁÆóËÉΩÊ∫êÊ¥ªÂä®Á¢≥ÊéíÊîæ\n   * @param {string} parkId - Âõ≠Âå∫ID\n   * @param {string} timeRange - Êó∂Èó¥ËåÉÂõ¥\n   * @returns {Object} ËÉΩÊ∫êÊ¥ªÂä®Á¢≥ÊéíÊîæÁªìÊûú\n   */\n  async calculateEnergyActivityEmissions(parkId, timeRange) {\n    try {\n      // Ëé∑ÂèñËÉΩÊ∫êÊ∂àËÄóÊï∞ÊçÆ\n      const energyData = await this.getEnergyConsumptionData(parkId, timeRange);\n      \n      const emissions = {\n        electricity: 0,\n        natural_gas: 0,\n        coal: 0,\n        diesel: 0,\n        gasoline: 0,\n        other_fuels: 0,\n        total: 0,\n        breakdown: []\n      };\n\n      // ÊåâËÉΩÊ∫êÁ±ªÂûãËÆ°ÁÆóÊéíÊîæÈáè\n      for (const [energyType, consumption] of Object.entries(energyData)) {\n        const emissionFactor = this.getEmissionFactor('electricity', energyType) || \n                              this.getEmissionFactor('fossil_fuels', energyType);\n        \n        if (emissionFactor && consumption > 0) {\n          const emission = consumption * emissionFactor;\n          emissions[energyType] = emission;\n          emissions.total += emission;\n          \n          emissions.breakdown.push({\n            energy_type: energyType,\n            consumption: consumption,\n            emission_factor: emissionFactor,\n            emissions: emission,\n            unit: this.getEmissionUnit(energyType)\n          });\n        }\n      }\n\n      return emissions;\n    } catch (error) {\n      logger.error('ËÆ°ÁÆóËÉΩÊ∫êÊ¥ªÂä®Á¢≥ÊéíÊîæÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * ËÆ°ÁÆóÂ∑•‰∏öËøáÁ®ãÁ¢≥ÊéíÊîæ\n   * @param {string} parkId - Âõ≠Âå∫ID\n   * @param {string} timeRange - Êó∂Èó¥ËåÉÂõ¥\n   * @returns {Object} Â∑•‰∏öËøáÁ®ãÁ¢≥ÊéíÊîæÁªìÊûú\n   */\n  async calculateIndustrialProcessEmissions(parkId, timeRange) {\n    try {\n      // Ëé∑ÂèñÂ∑•‰∏öËøáÁ®ãÊï∞ÊçÆ\n      const processData = await this.getIndustrialProcessData(parkId, timeRange);\n      \n      const emissions = {\n        cement: 0,\n        steel: 0,\n        aluminum: 0,\n        chemical: 0,\n        paper: 0,\n        other_processes: 0,\n        total: 0,\n        breakdown: []\n      };\n\n      // ÊåâÂ∑•‰∏öËøáÁ®ãÁ±ªÂûãËÆ°ÁÆóÊéíÊîæÈáè\n      for (const [processType, production] of Object.entries(processData)) {\n        const emissionFactor = this.getEmissionFactor('industrial_process', processType);\n        \n        if (emissionFactor && production > 0) {\n          const emission = production * emissionFactor;\n          emissions[processType] = emission;\n          emissions.total += emission;\n          \n          emissions.breakdown.push({\n            process_type: processType,\n            production: production,\n            emission_factor: emissionFactor,\n            emissions: emission,\n            unit: 'kg CO2'\n          });\n        }\n      }\n\n      return emissions;\n    } catch (error) {\n      logger.error('ËÆ°ÁÆóÂ∑•‰∏öËøáÁ®ãÁ¢≥ÊéíÊîæÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * ËÆ°ÁÆóÂõΩÂÆ∂Ê†∏ÂøÉÊåáÊ†á\n   * @param {string} parkId - Âõ≠Âå∫ID\n   * @param {string} timeRange - Êó∂Èó¥ËåÉÂõ¥\n   * @returns {Object} ÂõΩÂÆ∂Ê†∏ÂøÉÊåáÊ†á\n   */\n  async calculateNationalIndicators(parkId, timeRange) {\n    try {\n      // Ëé∑ÂèñÂõ≠Âå∫ÊÄªÁ¢≥ÊéíÊîæÈáè\n      const totalEmissions = await this.calculateParkTotalEmissions(parkId, timeRange);\n      \n      // Ëé∑ÂèñÂõ≠Âå∫ÊÄª‰∫ßÂÄº\n      const totalOutput = await this.getParkTotalOutput(parkId, timeRange);\n      \n      // Ëé∑ÂèñËÉΩÊ∫êÊ∂àË¥πÊï∞ÊçÆ\n      const energyConsumption = await this.getEnergyConsumptionData(parkId, timeRange);\n      \n      // ËÆ°ÁÆóÊ∏ÖÊ¥ÅËÉΩÊ∫êÊ∂àË¥πÈáè\n      const cleanEnergyConsumption = this.calculateCleanEnergyConsumption(energyConsumption);\n      const totalEnergyConsumption = Object.values(energyConsumption).reduce((sum, value) => sum + value, 0);\n      \n      // ËÆ°ÁÆóÂõΩÂÆ∂Ê†∏ÂøÉÊåáÊ†á\n      const indicators = {\n        // Âçï‰ΩçËÉΩËÄóÁ¢≥ÊéíÊîæ = Âõ≠Âå∫ÊÄªÁ¢≥ÊéíÊîæÈáè / Âõ≠Âå∫ÊÄª‰∫ßÂÄº\n        carbon_intensity_per_output: totalOutput > 0 ? \n          (totalEmissions.total_emissions / totalOutput).toFixed(MATH_CONSTANTS.DECIMAL_PLACES) : 0,\n        \n        // Ê∏ÖÊ¥ÅËÉΩÊ∫êÊ∂àË¥πÂç†ÊØî = Ê∏ÖÊ¥ÅËÉΩÊ∫êÊ∂àË¥πÈáè / Âõ≠Âå∫ÊÄªËÉΩÊ∫êÊ∂àË¥πÈáè\n        clean_energy_ratio: totalEnergyConsumption > 0 ? \n          ((cleanEnergyConsumption / totalEnergyConsumption) * MATH_CONSTANTS.ONE_HUNDRED).toFixed(MATH_CONSTANTS.DECIMAL_PLACES) : 0,\n        \n        // Âõ≠Âå∫ÊÄªÁ¢≥ÊéíÊîæÈáè\n        total_carbon_emissions: totalEmissions.total_emissions,\n        \n        // Âõ≠Âå∫ÊÄª‰∫ßÂÄº\n        total_output: totalOutput,\n        \n        // Âõ≠Âå∫ÊÄªËÉΩÊ∫êÊ∂àË¥πÈáè\n        total_energy_consumption: totalEnergyConsumption,\n        \n        // Ê∏ÖÊ¥ÅËÉΩÊ∫êÊ∂àË¥πÈáè\n        clean_energy_consumption: cleanEnergyConsumption,\n        \n        // ËÆ°ÁÆóÊó∂Èó¥\n        calculation_time: new Date().toISOString(),\n        \n        // Êï∞ÊçÆÊù•Ê∫ê\n        data_source: 'real_time_monitoring',\n        \n        // ËÆ°ÁÆóÊñπÊ≥ï\n        calculation_method: '„ÄäÂõΩÂÆ∂Á∫ßÈõ∂Á¢≥Âõ≠Âå∫Âª∫ËÆæÊåáÊ†á‰ΩìÁ≥ªÔºàËØïË°åÔºâ„Äã'\n      };\n\n      return indicators;\n    } catch (error) {\n      logger.error('ËÆ°ÁÆóÂõΩÂÆ∂Ê†∏ÂøÉÊåáÊ†áÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Êõ¥Êñ∞ÂÆûÊó∂ÊéíÊîæÊï∞ÊçÆ\n   */\n  async updateRealTimeEmissions() {\n    try {\n      // Ëé∑ÂèñÊâÄÊúâÂõ≠Âå∫ÂàóË°®\n      const parks = await this.getAllParks();\n      \n      for (const park of parks) {\n        const emissions = await this.calculateParkTotalEmissions(park.id, '1h');\n        const indicators = await this.calculateNationalIndicators(park.id, '1h');\n        \n        // Êõ¥Êñ∞ÂÆûÊó∂Êï∞ÊçÆÁºìÂ≠ò\n        this.realTimeData.set(park.id, {\n          emissions,\n          indicators,\n          last_updated: new Date().toISOString()\n        });\n        \n        // ÂèëÈÄÅÂÆûÊó∂Êõ¥Êñ∞‰∫ã‰ª∂\n        this.emit('real_time_update', {\n          park_id: park.id,\n          emissions,\n          indicators\n        });\n      }\n    } catch (error) {\n      logger.error('Êõ¥Êñ∞ÂÆûÊó∂ÊéíÊîæÊï∞ÊçÆÂ§±Ë¥•:', error);\n    }\n  }\n\n  /**\n   * Ëé∑ÂèñÊéíÊîæÂõ†Â≠ê\n   */\n  getEmissionFactor(category, type) {\n    const categoryFactors = this.emissionFactors.get(category);\n    if (!categoryFactors) return null;\n    \n    if (typeof categoryFactors === 'object' && categoryFactors[type] !== undefined) {\n      return categoryFactors[type];\n    }\n    \n    return null;\n  }\n\n  /**\n   * ËÆ°ÁÆóÊ∏ÖÊ¥ÅËÉΩÊ∫êÊ∂àË¥πÈáè\n   */\n  calculateCleanEnergyConsumption(energyConsumption) {\n    const cleanEnergySources = ['solar', 'wind', 'hydro', 'nuclear'];\n    return cleanEnergySources.reduce((total, source) => {\n      return total + (energyConsumption[source] || 0);\n    }, 0);\n  }\n\n  /**\n   * Ëé∑ÂèñÊéíÊîæÂçï‰Ωç\n   */\n  getEmissionUnit(energyType) {\n    const units = {\n      electricity: 'kg CO2/kWh',\n      natural_gas: 'kg CO2/m¬≥',\n      coal: 'kg CO2/kg',\n      diesel: 'kg CO2/L',\n      gasoline: 'kg CO2/L'\n    };\n    return units[energyType] || 'kg CO2';\n  }\n\n  /**\n   * ÁºìÂ≠òÁÆ°ÁêÜ\n   */\n  getFromCache(key) {\n    const cached = this.calculationCache.get(key);\n    if (cached && Date.now() - cached.timestamp < this.cacheTimeout) {\n      return cached.data;\n    }\n    return null;\n  }\n\n  setCache(key, data) {\n    this.calculationCache.set(key, {\n      data,\n      timestamp: Date.now()\n    });\n  }\n\n  // Ê®°ÊãüÊï∞ÊçÆËé∑ÂèñÊñπÊ≥ïÔºàÂÆûÈôÖÂ∫îÁî®‰∏≠ÈúÄË¶ÅËøûÊé•ÁúüÂÆûÊï∞ÊçÆÊ∫êÔºâ\n  async getEnergyConsumptionData(parkId, timeRange) {\n    // TODO: ÂÆûÁé∞ÁúüÂÆûÁöÑÊï∞ÊçÆÂ∫ìÊü•ËØ¢\n    return {\n      electricity: Math.random() * 10000,\n      natural_gas: Math.random() * 5000,\n      coal: Math.random() * 2000,\n      diesel: Math.random() * 1000\n    };\n  }\n\n  async getIndustrialProcessData(parkId, timeRange) {\n    // TODO: ÂÆûÁé∞ÁúüÂÆûÁöÑÊï∞ÊçÆÂ∫ìÊü•ËØ¢\n    return {\n      cement: Math.random() * 1000,\n      steel: Math.random() * 500,\n      chemical: Math.random() * 300\n    };\n  }\n\n  async getParkTotalOutput(parkId, timeRange) {\n    // TODO: ÂÆûÁé∞ÁúüÂÆûÁöÑÊï∞ÊçÆÂ∫ìÊü•ËØ¢\n    return Math.random() * 1000000; // Ê®°Êãü‰∫ßÂÄºÔºà‰∏áÂÖÉÔºâ\n  }\n\n  async getAllParks() {\n    // TODO: ÂÆûÁé∞ÁúüÂÆûÁöÑÊï∞ÊçÆÂ∫ìÊü•ËØ¢\n    return [\n      { id: 'park_001', name: 'Á§∫‰æãÂõ≠Âå∫1' },\n      { id: 'park_002', name: 'Á§∫‰æãÂõ≠Âå∫2' }\n    ];\n  }\n}\n\nexport default CarbonAccountingEngine;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/core/services/CarbonManager.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/core/services/CarbonMonitor.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/core/services/CarbonMonitorConstants.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/core/services/DataAssetManagementCenter.js","messages":[{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":559,"column":70,"nodeType":"Literal","messageId":"noMagic","endLine":559,"endColumn":72},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":560,"column":80,"nodeType":"Literal","messageId":"noMagic","endLine":560,"endColumn":82},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":561,"column":75,"nodeType":"Literal","messageId":"noMagic","endLine":561,"endColumn":77},{"ruleId":"object-shorthand","severity":2,"message":"Expected property shorthand.","line":655,"column":9,"nodeType":"Property","messageId":"expectedPropertyShorthand","endLine":655,"endColumn":27,"fix":{"range":[20829,20847],"text":"policies"}},{"ruleId":"object-shorthand","severity":2,"message":"Expected property shorthand.","line":658,"column":9,"nodeType":"Property","messageId":"expectedPropertyShorthand","endLine":658,"endColumn":29,"fix":{"range":[20882,20902],"text":"processes"}},{"ruleId":"object-shorthand","severity":2,"message":"Expected property shorthand.","line":755,"column":11,"nodeType":"Property","messageId":"expectedPropertyShorthand","endLine":755,"endColumn":41,"fix":{"range":[23826,23856],"text":"classification"}},{"ruleId":"object-shorthand","severity":2,"message":"Expected property shorthand.","line":823,"column":13,"nodeType":"Property","messageId":"expectedPropertyShorthand","endLine":823,"endColumn":31,"fix":{"range":[25737,25755],"text":"category"}},{"ruleId":"object-shorthand","severity":2,"message":"Expected property shorthand.","line":847,"column":11,"nodeType":"Property","messageId":"expectedPropertyShorthand","endLine":847,"endColumn":33,"fix":{"range":[26256,26278],"text":"assessment"}},{"ruleId":"object-shorthand","severity":2,"message":"Expected property shorthand.","line":910,"column":11,"nodeType":"Property","messageId":"expectedPropertyShorthand","endLine":910,"endColumn":33,"fix":{"range":[28234,28256],"text":"assessment"}},{"ruleId":"no-unused-vars","severity":2,"message":"'params' is defined but never used. Allowed unused args must match /^_/u.","line":922,"column":43,"nodeType":"Identifier","messageId":"unusedVar","endLine":922,"endColumn":49},{"ruleId":"object-shorthand","severity":2,"message":"Expected property shorthand.","line":962,"column":7,"nodeType":"Property","messageId":"expectedPropertyShorthand","endLine":962,"endColumn":23,"fix":{"range":[29719,29735],"text":"factors"}},{"ruleId":"no-unused-vars","severity":2,"message":"'governance' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":1020,"column":21,"nodeType":"Identifier","messageId":"unusedVar","endLine":1020,"endColumn":31},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.8.","line":1022,"column":37,"nodeType":"Literal","messageId":"noMagic","endLine":1022,"endColumn":40},{"ruleId":"no-unused-vars","severity":2,"message":"'governanceId' is defined but never used. Allowed unused args must match /^_/u.","line":1032,"column":35,"nodeType":"Identifier","messageId":"unusedVar","endLine":1032,"endColumn":47},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.85.","line":1034,"column":25,"nodeType":"Literal","messageId":"noMagic","endLine":1034,"endColumn":29},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.1.","line":1034,"column":48,"nodeType":"Literal","messageId":"noMagic","endLine":1034,"endColumn":51},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":1045,"column":30,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":1045,"endColumn":51,"fix":{"range":[31806,31827],"text":"{groups[category] = 0;}"}},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10000.","line":1073,"column":38,"nodeType":"Literal","messageId":"noMagic","endLine":1073,"endColumn":43},{"ruleId":"no-unused-vars","severity":2,"message":"'asset' is defined but never used. Allowed unused args must match /^_/u.","line":1081,"column":23,"nodeType":"Identifier","messageId":"unusedVar","endLine":1081,"endColumn":28},{"ruleId":"no-unused-vars","severity":2,"message":"'sampleData' is defined but never used. Allowed unused args must match /^_/u.","line":1086,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":1086,"endColumn":36},{"ruleId":"no-unused-vars","severity":2,"message":"'referenceData' is defined but never used. Allowed unused args must match /^_/u.","line":1086,"column":38,"nodeType":"Identifier","messageId":"unusedVar","endLine":1086,"endColumn":51},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.85.","line":1088,"column":12,"nodeType":"Literal","messageId":"noMagic","endLine":1088,"endColumn":16},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.1.","line":1088,"column":35,"nodeType":"Literal","messageId":"noMagic","endLine":1088,"endColumn":38}],"suppressedMessages":[],"errorCount":14,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":8,"fixableWarningCount":0,"source":"/**\n * Êï∞ÊçÆËµÑ‰∫ßÁõÆÂΩï‰∏éÊ†áÂáÜÂåñÁÆ°ÁêÜ‰∏≠ÂøÉ\n * ÂÆûÁé∞Êï∞ÊçÆËµÑ‰∫ßÂàÜÁ±ª„ÄÅÊ†áÂáÜÂåñÁÆ°ÁêÜ„ÄÅ‰ª∑ÂÄºËØÑ‰º∞ÂíåÊ≤ªÁêÜ‰ΩìÁ≥ª\n * ÊîØÊåÅËÉΩ-Á¢≥-‰∫ß-ËµÑÊ∫êÂõõË¶ÅÁ¥†Êï∞ÊçÆËµÑ‰∫ßÁöÑÁªü‰∏ÄÁÆ°ÁêÜ\n */\n\nimport { EventEmitter } from 'events';\nimport logger from '../../shared/utils/logger.js';\nimport { MATH_CONSTANTS } from '../../shared/constants/MathConstants.js';\n\nclass DataAssetManagementCenter extends EventEmitter {\n  constructor() {\n    super();\n    this.isInitialized = false;\n    this.dataAssetCatalog = new Map();\n    this.dataStandards = new Map();\n    this.dataLineage = new Map();\n    this.dataQualityMetrics = new Map();\n    this.dataValueAssessments = new Map();\n    this.dataGovernancePolicies = new Map();\n    \n    // Êï∞ÊçÆËµÑ‰∫ßÂàÜÁ±ª‰ΩìÁ≥ª\n    this.assetClassification = {\n      energy_data: {\n        name: 'ËÉΩÊ∫êÊï∞ÊçÆËµÑ‰∫ß',\n        code: 'ED',\n        description: '‰∏éËÉΩÊ∫êÁîü‰∫ß„ÄÅ‰º†Ëæì„ÄÅÊ∂àË¥πÁõ∏ÂÖ≥ÁöÑÊï∞ÊçÆ',\n        subcategories: {\n          'ED01': {\n            name: 'ËÉΩÊ∫êÁîü‰∫ßÊï∞ÊçÆ',\n            description: 'ÂèëÁîµ„ÄÅÂà∂ÁÉ≠Á≠âËÉΩÊ∫êÁîü‰∫ßËøáÁ®ãÊï∞ÊçÆ',\n            data_types: ['generation_data', 'renewable_output', 'fuel_consumption'],\n            value_drivers: ['È¢ÑÊµãÂáÜÁ°ÆÊÄß', 'ÂÆûÊó∂ÊÄß', 'ÂÆåÊï¥ÊÄß']\n          },\n          'ED02': {\n            name: 'ËÉΩÊ∫ê‰º†ËæìÊï∞ÊçÆ',\n            description: 'ÁîµÁΩë„ÄÅÁÆ°ÁΩëÁ≠âËÉΩÊ∫ê‰º†ËæìÁΩëÁªúÊï∞ÊçÆ',\n            data_types: ['grid_topology', 'transmission_losses', 'network_constraints'],\n            value_drivers: ['ÁΩëÁªúË¶ÜÁõñÂ∫¶', 'Á≤æÂ∫¶', 'Êõ¥Êñ∞È¢ëÁéá']\n          },\n          'ED03': {\n            name: 'ËÉΩÊ∫êÊ∂àË¥πÊï∞ÊçÆ',\n            description: 'Áî®Êà∑‰æßËÉΩÊ∫êÊ∂àË¥πË°å‰∏∫ÂíåÊ®°ÂºèÊï∞ÊçÆ',\n            data_types: ['load_profiles', 'consumption_patterns', 'demand_response'],\n            value_drivers: ['Áî®Êà∑Ë¶ÜÁõñÂ∫¶', 'È¢óÁ≤íÂ∫¶', 'ÂéÜÂè≤Ê∑±Â∫¶']\n          },\n          'ED04': {\n            name: 'ËÉΩÊ∫êÂ∏ÇÂú∫Êï∞ÊçÆ',\n            description: 'ÁîµÂäõÂ∏ÇÂú∫„ÄÅÁáÉÊñôÂ∏ÇÂú∫Á≠â‰∫§ÊòìÊï∞ÊçÆ',\n            data_types: ['market_prices', 'trading_volumes', 'market_clearing'],\n            value_drivers: ['Â∏ÇÂú∫Ë¶ÜÁõñÂ∫¶', 'Êó∂ÊïàÊÄß', 'ÂáÜÁ°ÆÊÄß']\n          }\n        }\n      },\n      carbon_data: {\n        name: 'Á¢≥Êï∞ÊçÆËµÑ‰∫ß',\n        code: 'CD',\n        description: '‰∏éÁ¢≥ÊéíÊîæ„ÄÅÁ¢≥Ë∂≥Ëøπ„ÄÅÁ¢≥‰∫§ÊòìÁõ∏ÂÖ≥ÁöÑÊï∞ÊçÆ',\n        subcategories: {\n          'CD01': {\n            name: 'Á¢≥ÊéíÊîæÊï∞ÊçÆ',\n            description: 'Áõ¥Êé•ÂíåÈó¥Êé•Á¢≥ÊéíÊîæÈáèÊï∞ÊçÆ',\n            data_types: ['scope1_emissions', 'scope2_emissions', 'scope3_emissions'],\n            value_drivers: ['ËÆ°ÈáèÂáÜÁ°ÆÊÄß', 'Ê†∏Êü•ËÆ§ËØÅ', 'Êó∂Èó¥Â∫èÂàó']\n          },\n          'CD02': {\n            name: 'Á¢≥Ë∂≥ËøπÊï∞ÊçÆ',\n            description: '‰∫ßÂìÅÂíåÊúçÂä°ÂÖ®ÁîüÂëΩÂë®ÊúüÁ¢≥Ë∂≥Ëøπ',\n            data_types: ['product_footprint', 'service_footprint', 'supply_chain_footprint'],\n            value_drivers: ['ËæπÁïåÂÆåÊï¥ÊÄß', 'Êï∞ÊçÆË¥®Èáè', 'ÂèØËøΩÊ∫ØÊÄß']\n          },\n          'CD03': {\n            name: 'Á¢≥‰∫§ÊòìÊï∞ÊçÆ',\n            description: 'Á¢≥ÈÖçÈ¢ù„ÄÅÁ¢≥‰ø°Áî®Á≠â‰∫§ÊòìÊï∞ÊçÆ',\n            data_types: ['carbon_allowances', 'carbon_credits', 'offset_projects'],\n            value_drivers: ['‰∫§ÊòìÈÄèÊòéÂ∫¶', '‰ª∑Ê†ºÂèëÁé∞', 'ÊµÅÂä®ÊÄß']\n          },\n          'CD04': {\n            name: 'Á¢≥ÁõëÊµãÊï∞ÊçÆ',\n            description: 'ÂÆûÊó∂Á¢≥ÊéíÊîæÁõëÊµãÂíåÈ¢ÑË≠¶Êï∞ÊçÆ',\n            data_types: ['real_time_emissions', 'emission_alerts', 'monitoring_devices'],\n            value_drivers: ['ÁõëÊµãÁ≤æÂ∫¶', 'Ë¶ÜÁõñËåÉÂõ¥', 'ÂìçÂ∫îÈÄüÂ∫¶']\n          }\n        }\n      },\n      production_data: {\n        name: 'Áîü‰∫ßÊï∞ÊçÆËµÑ‰∫ß',\n        code: 'PD',\n        description: '‰∏éÁîü‰∫ßÂà∂ÈÄ†„ÄÅÂ∑•Ëâ∫ÊµÅÁ®ãÁõ∏ÂÖ≥ÁöÑÊï∞ÊçÆ',\n        subcategories: {\n          'PD01': {\n            name: 'Áîü‰∫ßÂ∑•Ëâ∫Êï∞ÊçÆ',\n            description: 'Áîü‰∫ßËøáÁ®ãÂèÇÊï∞ÂíåÂ∑•Ëâ∫ÊéßÂà∂Êï∞ÊçÆ',\n            data_types: ['process_parameters', 'control_signals', 'quality_metrics'],\n            value_drivers: ['Â∑•Ëâ∫‰ºòÂåñ‰ª∑ÂÄº', 'Ë¥®ÈáèÊéßÂà∂', 'ÊïàÁéáÊèêÂçá']\n          },\n          'PD02': {\n            name: 'ËÆæÂ§áËøêË°åÊï∞ÊçÆ',\n            description: 'Áîü‰∫ßËÆæÂ§áÁä∂ÊÄÅÂíåÊÄßËÉΩÊï∞ÊçÆ',\n            data_types: ['equipment_status', 'performance_metrics', 'maintenance_records'],\n            value_drivers: ['È¢ÑÊµãÁª¥Êä§', 'ÊïÖÈöúËØäÊñ≠', 'ÊïàÁéá‰ºòÂåñ']\n          },\n          'PD03': {\n            name: '‰∫ßÂìÅË¥®ÈáèÊï∞ÊçÆ',\n            description: '‰∫ßÂìÅÊ£ÄÊµã„ÄÅË¥®ÈáèÊéßÂà∂Êï∞ÊçÆ',\n            data_types: ['quality_tests', 'defect_analysis', 'compliance_records'],\n            value_drivers: ['Ë¥®Èáè‰øùËØÅ', 'Áº∫Èô∑È¢ÑÈò≤', 'ÂêàËßÑËØÅÊòé']\n          },\n          'PD04': {\n            name: '‰æõÂ∫îÈìæÊï∞ÊçÆ',\n            description: 'ÂéüÊùêÊñô„ÄÅÁâ©ÊµÅ„ÄÅ‰æõÂ∫îÂïÜÊï∞ÊçÆ',\n            data_types: ['supplier_data', 'logistics_data', 'inventory_data'],\n            value_drivers: ['‰æõÂ∫îÈìæ‰ºòÂåñ', 'È£éÈô©ÁÆ°ÁêÜ', 'ÊàêÊú¨ÊéßÂà∂']\n          }\n        }\n      },\n      resource_data: {\n        name: 'ËµÑÊ∫êÊï∞ÊçÆËµÑ‰∫ß',\n        code: 'RD',\n        description: '‰∏éËµÑÊ∫êÂà©Áî®„ÄÅÂæ™ÁéØÁªèÊµéÁõ∏ÂÖ≥ÁöÑÊï∞ÊçÆ',\n        subcategories: {\n          'RD01': {\n            name: 'ÂéüÊùêÊñôÊï∞ÊçÆ',\n            description: 'ÂéüÊùêÊñôÊ∂àËÄó„ÄÅÊù•Ê∫ê„ÄÅÁâπÊÄßÊï∞ÊçÆ',\n            data_types: ['material_consumption', 'material_properties', 'sourcing_data'],\n            value_drivers: ['ËµÑÊ∫ê‰ºòÂåñ', 'ÂèØÊåÅÁª≠ÊÄß', 'ÊàêÊú¨ÊïàÁõä']\n          },\n          'RD02': {\n            name: 'Â∫üÁâ©Êï∞ÊçÆ',\n            description: 'Â∫üÁâ©‰∫ßÁîü„ÄÅÂ§ÑÁêÜ„ÄÅÂõûÊî∂Êï∞ÊçÆ',\n            data_types: ['waste_generation', 'waste_treatment', 'recycling_rates'],\n            value_drivers: ['Âæ™ÁéØÂà©Áî®', 'ÁéØÂ¢ÉÂêàËßÑ', 'ÊàêÊú¨ËäÇÁ∫¶']\n          },\n          'RD03': {\n            name: 'Ê∞¥ËµÑÊ∫êÊï∞ÊçÆ',\n            description: 'Ê∞¥ËµÑÊ∫ê‰ΩøÁî®„ÄÅÂ§ÑÁêÜ„ÄÅÂõûÊî∂Êï∞ÊçÆ',\n            data_types: ['water_consumption', 'water_quality', 'wastewater_treatment'],\n            value_drivers: ['Ê∞¥ÊïàÊèêÂçá', 'ÁéØÂ¢É‰øùÊä§', 'ÊàêÊú¨ÊéßÂà∂']\n          },\n          'RD04': {\n            name: 'ÂúüÂú∞ËµÑÊ∫êÊï∞ÊçÆ',\n            description: 'ÂúüÂú∞Âà©Áî®„ÄÅÁéØÂ¢ÉÂΩ±ÂìçÊï∞ÊçÆ',\n            data_types: ['land_use', 'soil_quality', 'biodiversity_impact'],\n            value_drivers: ['ÂúüÂú∞‰ºòÂåñ', 'ÁîüÊÄÅ‰øùÊä§', 'ÂèØÊåÅÁª≠ÂèëÂ±ï']\n          }\n        }\n      }\n    };\n    \n    // Êï∞ÊçÆÊ†áÂáÜ‰ΩìÁ≥ª\n    this.dataStandardFramework = {\n      technical_standards: {\n        name: 'ÊäÄÊúØÊ†áÂáÜ',\n        categories: {\n          data_formats: {\n            name: 'Êï∞ÊçÆÊ†ºÂºèÊ†áÂáÜ',\n            standards: ['JSON Schema', 'XML Schema', 'Avro', 'Parquet'],\n            description: 'ÂÆö‰πâÊï∞ÊçÆ‰∫§Êç¢ÂíåÂ≠òÂÇ®Ê†ºÂºè'\n          },\n          data_interfaces: {\n            name: 'Êï∞ÊçÆÊé•Âè£Ê†áÂáÜ',\n            standards: ['REST API', 'GraphQL', 'OPC UA', 'MQTT'],\n            description: 'ÂÆö‰πâÊï∞ÊçÆËÆøÈóÆÂíå‰∫§‰∫íÊé•Âè£'\n          },\n          data_encoding: {\n            name: 'Êï∞ÊçÆÁºñÁ†ÅÊ†áÂáÜ',\n            standards: ['UTF-8', 'Base64', 'Compression'],\n            description: 'ÂÆö‰πâÊï∞ÊçÆÁºñÁ†ÅÂíåÂéãÁº©ÊñπÂºè'\n          }\n        }\n      },\n      semantic_standards: {\n        name: 'ËØ≠‰πâÊ†áÂáÜ',\n        categories: {\n          data_models: {\n            name: 'Êï∞ÊçÆÊ®°ÂûãÊ†áÂáÜ',\n            standards: ['IEC 61970 CIM', 'IEC 61968', 'NGSI-LD'],\n            description: 'ÂÆö‰πâÊï∞ÊçÆÂÆû‰ΩìÂíåÂÖ≥Á≥ªÊ®°Âûã'\n          },\n          vocabularies: {\n            name: 'ËØçÊ±áÊ†áÂáÜ',\n            standards: ['SKOS', 'Dublin Core', 'FOAF'],\n            description: 'ÂÆö‰πâÊ†áÂáÜÊúØËØ≠ÂíåÊ¶ÇÂøµ'\n          },\n          ontologies: {\n            name: 'Êú¨‰ΩìÊ†áÂáÜ',\n            standards: ['OWL', 'RDF Schema', 'SHACL'],\n            description: 'ÂÆö‰πâÈ¢ÜÂüüÁü•ËØÜÂíåÊé®ÁêÜËßÑÂàô'\n          }\n        }\n      },\n      quality_standards: {\n        name: 'Ë¥®ÈáèÊ†áÂáÜ',\n        categories: {\n          accuracy: {\n            name: 'ÂáÜÁ°ÆÊÄßÊ†áÂáÜ',\n            metrics: ['Êï∞ÊçÆÊ≠£Á°ÆÁéá', 'ËØØÂ∑ÆËåÉÂõ¥', 'Á≤æÂ∫¶Á≠âÁ∫ß'],\n            thresholds: { high: 0.99, medium: 0.95, low: 0.9 }\n          },\n          completeness: {\n            name: 'ÂÆåÊï¥ÊÄßÊ†áÂáÜ',\n            metrics: ['Â≠óÊÆµÂÆåÊï¥Áéá', 'ËÆ∞ÂΩïÂÆåÊï¥Áéá', 'Êó∂Èó¥ÂÆåÊï¥Áéá'],\n            thresholds: { high: 0.98, medium: 0.95, low: 0.9 }\n          },\n          timeliness: {\n            name: 'ÂèäÊó∂ÊÄßÊ†áÂáÜ',\n            metrics: ['Êï∞ÊçÆÂª∂Ëøü', 'Êõ¥Êñ∞È¢ëÁéá', 'ÂÆûÊó∂ÊÄß'],\n            thresholds: { high: '1min', medium: '5min', low: '15min' }\n          },\n          consistency: {\n            name: '‰∏ÄËá¥ÊÄßÊ†áÂáÜ',\n            metrics: ['Ê†ºÂºè‰∏ÄËá¥ÊÄß', 'ÂÄºÂüü‰∏ÄËá¥ÊÄß', 'ÂÖ≥Á≥ª‰∏ÄËá¥ÊÄß'],\n            thresholds: { high: 0.99, medium: 0.95, low: 0.9 }\n          }\n        }\n      },\n      governance_standards: {\n        name: 'Ê≤ªÁêÜÊ†áÂáÜ',\n        categories: {\n          privacy: {\n            name: 'ÈöêÁßÅ‰øùÊä§Ê†áÂáÜ',\n            standards: ['GDPR', 'CCPA', 'ISO 27001'],\n            description: '‰∏™‰∫∫Êï∞ÊçÆ‰øùÊä§ÂíåÈöêÁßÅÂêàËßÑ'\n          },\n          security: {\n            name: 'ÂÆâÂÖ®Ê†áÂáÜ',\n            standards: ['ISO 27001', 'NIST Framework', 'SOC 2'],\n            description: 'Êï∞ÊçÆÂÆâÂÖ®ÂíåËÆøÈóÆÊéßÂà∂'\n          },\n          retention: {\n            name: '‰øùÁïôÊ†áÂáÜ',\n            policies: ['‰øùÁïôÊúüÈôê', 'ÂΩíÊ°£Á≠ñÁï•', 'Âà†Èô§ËßÑÂàô'],\n            description: 'Êï∞ÊçÆÁîüÂëΩÂë®ÊúüÁÆ°ÁêÜ'\n          }\n        }\n      }\n    };\n    \n    // Êï∞ÊçÆ‰ª∑ÂÄºËØÑ‰º∞Ê®°Âûã\n    this.valueAssessmentModel = {\n      intrinsic_value: {\n        name: 'ÂÜÖÂú®‰ª∑ÂÄº',\n        weight: 0.3,\n        factors: {\n          uniqueness: { weight: 0.3, description: 'Êï∞ÊçÆÁã¨ÁâπÊÄßÂíåÁ®ÄÁº∫ÊÄß' },\n          accuracy: { weight: 0.25, description: 'Êï∞ÊçÆÂáÜÁ°ÆÊÄßÂíåÂèØÈù†ÊÄß' },\n          completeness: { weight: 0.25, description: 'Êï∞ÊçÆÂÆåÊï¥ÊÄßÂíåË¶ÜÁõñÂ∫¶' },\n          timeliness: { weight: 0.2, description: 'Êï∞ÊçÆÊó∂ÊïàÊÄßÂíåÊõ¥Êñ∞È¢ëÁéá' }\n        }\n      },\n      utility_value: {\n        name: 'ÊïàÁî®‰ª∑ÂÄº',\n        weight: 0.4,\n        factors: {\n          business_impact: { weight: 0.4, description: 'ÂØπ‰∏öÂä°ÂÜ≥Á≠ñÁöÑÂΩ±Âìç' },\n          operational_efficiency: { weight: 0.3, description: 'ËøêËê•ÊïàÁéáÊèêÂçá' },\n          cost_reduction: { weight: 0.2, description: 'ÊàêÊú¨ËäÇÁ∫¶ÊΩúÂäõ' },\n          revenue_generation: { weight: 0.1, description: 'Êî∂ÂÖ•Â¢ûÈïøË¥°ÁåÆ' }\n        }\n      },\n      market_value: {\n        name: 'Â∏ÇÂú∫‰ª∑ÂÄº',\n        weight: 0.2,\n        factors: {\n          market_demand: { weight: 0.4, description: 'Â∏ÇÂú∫ÈúÄÊ±ÇÂº∫Â∫¶' },\n          competitive_advantage: { weight: 0.3, description: 'Á´û‰∫â‰ºòÂäøË¥°ÁåÆ' },\n          monetization_potential: { weight: 0.2, description: 'Ë¥ßÂ∏ÅÂåñÊΩúÂäõ' },\n          network_effects: { weight: 0.1, description: 'ÁΩëÁªúÊïàÂ∫î‰ª∑ÂÄº' }\n        }\n      },\n      strategic_value: {\n        name: 'ÊàòÁï•‰ª∑ÂÄº',\n        weight: 0.1,\n        factors: {\n          innovation_enablement: { weight: 0.4, description: 'ÂàõÊñ∞‰ΩøËÉΩ‰ª∑ÂÄº' },\n          ecosystem_building: { weight: 0.3, description: 'ÁîüÊÄÅÊûÑÂª∫‰ª∑ÂÄº' },\n          regulatory_compliance: { weight: 0.2, description: 'ÂêàËßÑÊîØÊíë‰ª∑ÂÄº' },\n          future_optionality: { weight: 0.1, description: 'Êú™Êù•ÈÄâÊã©ÊùÉ‰ª∑ÂÄº' }\n        }\n      }\n    };\n    \n    this.init();\n  }\n\n  async init() {\n    try {\n      await this.initializeDataCatalog();\n      await this.setupDataStandards();\n      await this.initializeDataLineage();\n      await this.setupQualityMonitoring();\n      await this.startDataGovernance();\n      \n      this.isInitialized = true;\n      logger.info('Êï∞ÊçÆËµÑ‰∫ßÁõÆÂΩï‰∏éÊ†áÂáÜÂåñÁÆ°ÁêÜ‰∏≠ÂøÉÂàùÂßãÂåñÂÆåÊàê');\n      this.emit('initialized');\n    } catch (error) {\n      logger.error('Êï∞ÊçÆËµÑ‰∫ßÁÆ°ÁêÜ‰∏≠ÂøÉÂàùÂßãÂåñÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Âª∫Á´ãÊï∞ÊçÆËµÑ‰∫ßÁõÆÂΩï\n   * @param {string} parkId - Âõ≠Âå∫ID\n   * @param {Array} dataSources - Êï∞ÊçÆÊ∫êÂàóË°®\n   * @returns {Object} Êï∞ÊçÆËµÑ‰∫ßÁõÆÂΩï\n   */\n  async establishDataAssetCatalog(parkId, dataSources) {\n    try {\n      const catalogId = this.generateCatalogId(parkId);\n      \n      // Êï∞ÊçÆÂèëÁé∞ÂíåËØÜÂà´\n      const discoveredAssets = await this.discoverDataAssets(dataSources);\n      \n      // Êï∞ÊçÆÂàÜÁ±ªÂíåÊ†áÊ≥®\n      const classifiedAssets = await this.classifyDataAssets(discoveredAssets);\n      \n      // Êï∞ÊçÆË°ÄÁºòÂàÜÊûê\n      const lineageAnalysis = await this.analyzeDataLineage(classifiedAssets);\n      \n      // Êï∞ÊçÆË¥®ÈáèËØÑ‰º∞\n      const qualityAssessment = await this.assessDataQuality(classifiedAssets);\n      \n      // Êï∞ÊçÆ‰ª∑ÂÄºËØÑ‰º∞\n      const valueAssessment = await this.assessDataValue(classifiedAssets);\n      \n      // ÊûÑÂª∫Êï∞ÊçÆÁõÆÂΩï\n      const catalog = {\n        catalog_id: catalogId,\n        park_id: parkId,\n        creation_time: new Date().toISOString(),\n        \n        // Êï∞ÊçÆËµÑ‰∫ßÊ∏ÖÂçï\n        asset_inventory: {\n          total_assets: classifiedAssets.length,\n          assets_by_category: this.groupAssetsByCategory(classifiedAssets),\n          assets_by_source: this.groupAssetsBySource(classifiedAssets),\n          assets_by_quality: this.groupAssetsByQuality(classifiedAssets, qualityAssessment),\n          assets_by_value: this.groupAssetsByValue(classifiedAssets, valueAssessment)\n        },\n        \n        // ÂàÜÁ±ªËµÑ‰∫ß\n        classified_assets: classifiedAssets,\n        \n        // Êï∞ÊçÆË°ÄÁºò\n        data_lineage: lineageAnalysis,\n        \n        // Ë¥®ÈáèËØÑ‰º∞\n        quality_assessment: qualityAssessment,\n        \n        // ‰ª∑ÂÄºËØÑ‰º∞\n        value_assessment: valueAssessment,\n        \n        // ÁõÆÂΩïÁªüËÆ°\n        catalog_statistics: {\n          coverage_metrics: this.calculateCoverageMetrics(classifiedAssets),\n          quality_metrics: this.calculateQualityMetrics(qualityAssessment),\n          value_metrics: this.calculateValueMetrics(valueAssessment),\n          lineage_metrics: this.calculateLineageMetrics(lineageAnalysis)\n        },\n        \n        // Êï∞ÊçÆÂú∞Âõæ\n        data_map: {\n          entity_relationship: this.buildEntityRelationshipMap(classifiedAssets),\n          data_flow: this.buildDataFlowMap(lineageAnalysis),\n          dependency_graph: this.buildDependencyGraph(lineageAnalysis),\n          impact_analysis: this.buildImpactAnalysis(classifiedAssets, lineageAnalysis)\n        },\n        \n        // Ê≤ªÁêÜÁä∂ÊÄÅ\n        governance_status: {\n          compliance_score: this.calculateComplianceScore(classifiedAssets),\n          standardization_level: this.calculateStandardizationLevel(classifiedAssets),\n          governance_maturity: this.assessGovernanceMaturity(classifiedAssets)\n        }\n      };\n      \n      // Â≠òÂÇ®Êï∞ÊçÆÁõÆÂΩï\n      this.dataAssetCatalog.set(catalogId, catalog);\n      \n      logger.info(`Êï∞ÊçÆËµÑ‰∫ßÁõÆÂΩïÂª∫Á´ãÂÆåÊàê: ${catalogId}, ËµÑ‰∫ßÊï∞Èáè: ${classifiedAssets.length}`);\n      this.emit('catalog_established', catalog);\n      \n      return catalog;\n    } catch (error) {\n      logger.error('Âª∫Á´ãÊï∞ÊçÆËµÑ‰∫ßÁõÆÂΩïÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * ÂÆûÊñΩÊï∞ÊçÆÊ†áÂáÜÂåñ\n   * @param {string} catalogId - ÁõÆÂΩïID\n   * @param {Object} standardizationParams - Ê†áÂáÜÂåñÂèÇÊï∞\n   * @returns {Object} Ê†áÂáÜÂåñÁªìÊûú\n   */\n  async implementDataStandardization(catalogId, standardizationParams) {\n    try {\n      const standardizationId = this.generateStandardizationId(catalogId);\n      const catalog = this.dataAssetCatalog.get(catalogId);\n      \n      if (!catalog) {\n        throw new Error(`Êï∞ÊçÆÁõÆÂΩï‰∏çÂ≠òÂú®: ${catalogId}`);\n      }\n      \n      // Ê†áÂáÜÂ∑ÆË∑ùÂàÜÊûê\n      const gapAnalysis = await this.analyzeStandardizationGaps(\n        catalog.classified_assets,\n        standardizationParams\n      );\n      \n      // Âà∂ÂÆöÊ†áÂáÜÂåñËÆ°Âàí\n      const standardizationPlan = this.createStandardizationPlan(\n        gapAnalysis,\n        standardizationParams\n      );\n      \n      // ÊâßË°åÊ†áÂáÜÂåñÊîπÈÄ†\n      const transformationResults = await this.executeStandardizationTransformation(\n        catalog.classified_assets,\n        standardizationPlan\n      );\n      \n      // È™åËØÅÊ†áÂáÜÂåñÊïàÊûú\n      const validationResults = await this.validateStandardizationResults(\n        transformationResults,\n        standardizationPlan\n      );\n      \n      // Êõ¥Êñ∞Êï∞ÊçÆÁõÆÂΩï\n      await this.updateCatalogWithStandardization(\n        catalogId,\n        transformationResults,\n        validationResults\n      );\n      \n      const result = {\n        standardization_id: standardizationId,\n        catalog_id: catalogId,\n        standardization_time: new Date().toISOString(),\n        \n        // Â∑ÆË∑ùÂàÜÊûê\n        gap_analysis: gapAnalysis,\n        \n        // Ê†áÂáÜÂåñËÆ°Âàí\n        standardization_plan: standardizationPlan,\n        \n        // ÊîπÈÄ†ÁªìÊûú\n        transformation_results: transformationResults,\n        \n        // È™åËØÅÁªìÊûú\n        validation_results: validationResults,\n        \n        // Ê†áÂáÜÂåñÊïàÊûú\n        standardization_impact: {\n          assets_standardized: transformationResults.successful_transformations,\n          compliance_improvement: this.calculateComplianceImprovement(validationResults),\n          quality_improvement: this.calculateQualityImprovement(validationResults),\n          interoperability_enhancement: this.calculateInteroperabilityEnhancement(validationResults)\n        },\n        \n        // ÊàêÊú¨ÊïàÁõäÂàÜÊûê\n        cost_benefit_analysis: {\n          standardization_cost: this.calculateStandardizationCost(standardizationPlan),\n          expected_benefits: this.calculateExpectedBenefits(validationResults),\n          roi_projection: this.calculateROIProjection(standardizationPlan, validationResults),\n          payback_period: this.calculatePaybackPeriod(standardizationPlan, validationResults)\n        },\n        \n        // ÂêéÁª≠Ë°åÂä®\n        follow_up_actions: {\n          remaining_gaps: gapAnalysis.unresolved_gaps,\n          continuous_improvement: this.identifyContinuousImprovementOpportunities(validationResults),\n          monitoring_plan: this.createStandardizationMonitoringPlan(transformationResults)\n        }\n      };\n      \n      logger.info(`Êï∞ÊçÆÊ†áÂáÜÂåñÂÆûÊñΩÂÆåÊàê: ${standardizationId}, Ê†áÂáÜÂåñËµÑ‰∫ß: ${result.standardization_impact.assets_standardized}`);\n      this.emit('standardization_completed', result);\n      \n      return result;\n    } catch (error) {\n      logger.error('ÂÆûÊñΩÊï∞ÊçÆÊ†áÂáÜÂåñÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * ËØÑ‰º∞Êï∞ÊçÆËµÑ‰∫ß‰ª∑ÂÄº\n   * @param {string} catalogId - ÁõÆÂΩïID\n   * @param {Object} valuationParams - ‰º∞ÂÄºÂèÇÊï∞\n   * @returns {Object} ‰ª∑ÂÄºËØÑ‰º∞ÁªìÊûú\n   */\n  async evaluateDataAssetValue(catalogId, valuationParams) {\n    try {\n      const valuationId = this.generateValuationId(catalogId);\n      const catalog = this.dataAssetCatalog.get(catalogId);\n      \n      if (!catalog) {\n        throw new Error(`Êï∞ÊçÆÁõÆÂΩï‰∏çÂ≠òÂú®: ${catalogId}`);\n      }\n      \n      // Â∫îÁî®‰ª∑ÂÄºËØÑ‰º∞Ê®°Âûã\n      const valueAssessments = await this.applyValueAssessmentModel(\n        catalog.classified_assets,\n        valuationParams\n      );\n      \n      // ËÆ°ÁÆóÁªÑÂêà‰ª∑ÂÄº\n      const portfolioValue = this.calculatePortfolioValue(\n        valueAssessments,\n        valuationParams\n      );\n      \n      // ‰ª∑ÂÄºÈ©±Âä®Âõ†Á¥†ÂàÜÊûê\n      const valueDriverAnalysis = this.analyzeValueDrivers(\n        valueAssessments,\n        catalog.classified_assets\n      );\n      \n      // ‰ª∑ÂÄº‰ºòÂåñÂª∫ËÆÆ\n      const optimizationRecommendations = this.generateValueOptimizationRecommendations(\n        valueAssessments,\n        valueDriverAnalysis\n      );\n      \n      // È£éÈô©ËØÑ‰º∞\n      const riskAssessment = this.assessValueRisks(\n        valueAssessments,\n        catalog.classified_assets\n      );\n      \n      const result = {\n        valuation_id: valuationId,\n        catalog_id: catalogId,\n        valuation_time: new Date().toISOString(),\n        valuation_method: valuationParams.method || 'comprehensive',\n        \n        // ‰∏™‰ΩìËµÑ‰∫ß‰ª∑ÂÄº\n        individual_valuations: valueAssessments,\n        \n        // ÁªÑÂêà‰ª∑ÂÄº\n        portfolio_value: portfolioValue,\n        \n        // ‰ª∑ÂÄºÂàÜÂ∏É\n        value_distribution: {\n          by_category: this.calculateValueByCategory(valueAssessments),\n          by_quality_tier: this.calculateValueByQualityTier(valueAssessments),\n          by_business_unit: this.calculateValueByBusinessUnit(valueAssessments),\n          by_data_source: this.calculateValueByDataSource(valueAssessments)\n        },\n        \n        // ‰ª∑ÂÄºÈ©±Âä®Âõ†Á¥†\n        value_drivers: valueDriverAnalysis,\n        \n        // ‰ª∑ÂÄºÊéíÂêç\n        value_rankings: {\n          top_value_assets: this.getTopValueAssets(valueAssessments, 10),\n          high_potential_assets: this.getHighPotentialAssets(valueAssessments, 10),\n          undervalued_assets: this.getUndervaluedAssets(valueAssessments, 10)\n        },\n        \n        // ‰ºòÂåñÂª∫ËÆÆ\n        optimization_recommendations: optimizationRecommendations,\n        \n        // È£éÈô©ËØÑ‰º∞\n        risk_assessment: riskAssessment,\n        \n        // ‰ª∑ÂÄºÂÆûÁé∞Ë∑ØÂæÑ\n        value_realization_roadmap: {\n          quick_wins: this.identifyQuickWins(optimizationRecommendations),\n          medium_term_initiatives: this.identifyMediumTermInitiatives(optimizationRecommendations),\n          long_term_investments: this.identifyLongTermInvestments(optimizationRecommendations)\n        },\n        \n        // ÁõëÊéßÊåáÊ†á\n        monitoring_metrics: {\n          value_kpis: this.defineValueKPIs(valueAssessments),\n          tracking_frequency: this.defineTrackingFrequency(valuationParams),\n          alert_thresholds: this.defineAlertThresholds(valueAssessments)\n        }\n      };\n      \n      // Â≠òÂÇ®‰ª∑ÂÄºËØÑ‰º∞ÁªìÊûú\n      this.dataValueAssessments.set(valuationId, result);\n      \n      logger.info(`Êï∞ÊçÆËµÑ‰∫ß‰ª∑ÂÄºËØÑ‰º∞ÂÆåÊàê: ${valuationId}, ÊÄª‰ª∑ÂÄº: ${portfolioValue.total_value}‰∏áÂÖÉ`);\n      this.emit('valuation_completed', result);\n      \n      return result;\n    } catch (error) {\n      logger.error('ËØÑ‰º∞Êï∞ÊçÆËµÑ‰∫ß‰ª∑ÂÄºÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Âª∫Á´ãÊï∞ÊçÆÊ≤ªÁêÜ‰ΩìÁ≥ª\n   * @param {string} parkId - Âõ≠Âå∫ID\n   * @param {Object} governanceParams - Ê≤ªÁêÜÂèÇÊï∞\n   * @returns {Object} Ê≤ªÁêÜ‰ΩìÁ≥ª\n   */\n  async establishDataGovernance(parkId, governanceParams) {\n    try {\n      const governanceId = this.generateGovernanceId(parkId);\n      \n      // Ê≤ªÁêÜÊ°ÜÊû∂ËÆæËÆ°\n      const governanceFramework = this.designGovernanceFramework(\n        parkId,\n        governanceParams\n      );\n      \n      // ÁªÑÁªáÊû∂ÊûÑÂª∫Á´ã\n      const organizationalStructure = this.establishOrganizationalStructure(\n        governanceFramework\n      );\n      \n      // ÊîøÁ≠ñÂà∂Â∫¶Âà∂ÂÆö\n      const policies = await this.developGovernancePolicies(\n        governanceFramework,\n        governanceParams\n      );\n      \n      // ÊµÅÁ®ãËßÑËåÉÂª∫Á´ã\n      const processes = this.establishGovernanceProcesses(\n        policies,\n        organizationalStructure\n      );\n      \n      // Â∑•ÂÖ∑Âπ≥Âè∞ÈÉ®ÁΩ≤\n      const toolsPlatform = await this.deployGovernanceTools(\n        processes,\n        governanceParams\n      );\n      \n      // ÁõëÊéß‰ΩìÁ≥ªÂª∫Á´ã\n      const monitoringSystem = this.establishGovernanceMonitoring(\n        processes,\n        toolsPlatform\n      );\n      \n      const result = {\n        governance_id: governanceId,\n        park_id: parkId,\n        establishment_time: new Date().toISOString(),\n        \n        // Ê≤ªÁêÜÊ°ÜÊû∂\n        governance_framework: governanceFramework,\n        \n        // ÁªÑÁªáÊû∂ÊûÑ\n        organizational_structure: organizationalStructure,\n        \n        // ÊîøÁ≠ñÂà∂Â∫¶\n        policies: policies,\n        \n        // ÊµÅÁ®ãËßÑËåÉ\n        processes: processes,\n        \n        // Â∑•ÂÖ∑Âπ≥Âè∞\n        tools_platform: toolsPlatform,\n        \n        // ÁõëÊéß‰ΩìÁ≥ª\n        monitoring_system: monitoringSystem,\n        \n        // Ê≤ªÁêÜÊàêÁÜüÂ∫¶\n        governance_maturity: {\n          current_level: this.assessCurrentMaturityLevel(result),\n          target_level: governanceParams.target_maturity_level || 'optimized',\n          improvement_roadmap: this.createMaturityImprovementRoadmap(result, governanceParams)\n        },\n        \n        // ÂÆûÊñΩËÆ°Âàí\n        implementation_plan: {\n          phases: this.defineImplementationPhases(result),\n          timeline: this.createImplementationTimeline(result),\n          resource_requirements: this.calculateResourceRequirements(result),\n          success_criteria: this.defineSuccessCriteria(result)\n        },\n        \n        // È£éÈô©ÁÆ°ÁêÜ\n        risk_management: {\n          identified_risks: this.identifyGovernanceRisks(result),\n          mitigation_strategies: this.developRiskMitigationStrategies(result),\n          contingency_plans: this.createContingencyPlans(result)\n        }\n      };\n      \n      // Â≠òÂÇ®Ê≤ªÁêÜ‰ΩìÁ≥ª\n      this.dataGovernancePolicies.set(governanceId, result);\n      \n      logger.info(`Êï∞ÊçÆÊ≤ªÁêÜ‰ΩìÁ≥ªÂª∫Á´ãÂÆåÊàê: ${governanceId}`);\n      this.emit('governance_established', result);\n      \n      return result;\n    } catch (error) {\n      logger.error('Âª∫Á´ãÊï∞ÊçÆÊ≤ªÁêÜ‰ΩìÁ≥ªÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  // Êï∞ÊçÆÂèëÁé∞ÂíåÂàÜÁ±ªÊñπÊ≥ï\n  async discoverDataAssets(dataSources) {\n    const discoveredAssets = [];\n    \n    for (const source of dataSources) {\n      try {\n        // ËøûÊé•Êï∞ÊçÆÊ∫ê\n        const connection = await this.connectToDataSource(source);\n        \n        // Êâ´ÊèèÊï∞ÊçÆÁªìÊûÑ\n        const dataStructures = await this.scanDataStructures(connection);\n        \n        // ÂàÜÊûêÊï∞ÊçÆÂÜÖÂÆπ\n        const contentAnalysis = await this.analyzeDataContent(connection, dataStructures);\n        \n        // ÊèêÂèñÂÖÉÊï∞ÊçÆ\n        const metadata = await this.extractMetadata(connection, dataStructures, contentAnalysis);\n        \n        // ÂàõÂª∫Êï∞ÊçÆËµÑ‰∫ßËÆ∞ÂΩï\n        const assets = this.createDataAssetRecords(source, dataStructures, metadata);\n        \n        discoveredAssets.push(...assets);\n      } catch (error) {\n        logger.error(`Êï∞ÊçÆÊ∫êÂèëÁé∞Â§±Ë¥•: ${source.id}`, error);\n      }\n    }\n    \n    return discoveredAssets;\n  }\n\n  async classifyDataAssets(discoveredAssets) {\n    const classifiedAssets = [];\n    \n    for (const asset of discoveredAssets) {\n      try {\n        // Ëá™Âä®ÂàÜÁ±ª\n        const autoClassification = this.performAutoClassification(asset);\n        \n        // ËØ≠‰πâÂàÜÊûê\n        const semanticAnalysis = await this.performSemanticAnalysis(asset);\n        \n        // ‰∏öÂä°‰∏ä‰∏ãÊñáÂàÜÊûê\n        const businessContext = this.analyzeBusinessContext(asset);\n        \n        // ÂêàÂπ∂ÂàÜÁ±ªÁªìÊûú\n        const classification = this.mergeClassificationResults(\n          autoClassification,\n          semanticAnalysis,\n          businessContext\n        );\n        \n        classifiedAssets.push({\n          ...asset,\n          classification: classification,\n          confidence_score: this.calculateClassificationConfidence(classification)\n        });\n      } catch (error) {\n        logger.error(`ËµÑ‰∫ßÂàÜÁ±ªÂ§±Ë¥•: ${asset.id}`, error);\n        // ‰ΩøÁî®ÈªòËÆ§ÂàÜÁ±ª\n        classifiedAssets.push({\n          ...asset,\n          classification: this.getDefaultClassification(),\n          confidence_score: 0.5\n        });\n      }\n    }\n    \n    return classifiedAssets;\n  }\n\n  performAutoClassification(asset) {\n    const { name, description, schema, source_type } = asset;\n    \n    // Âü∫‰∫éÂêçÁß∞ÁöÑÂàÜÁ±ª\n    const nameBasedClass = this.classifyByName(name);\n    \n    // Âü∫‰∫éÊèèËø∞ÁöÑÂàÜÁ±ª\n    const descriptionBasedClass = this.classifyByDescription(description);\n    \n    // Âü∫‰∫éÊ®°ÂºèÁöÑÂàÜÁ±ª\n    const schemaBasedClass = this.classifyBySchema(schema);\n    \n    // Âü∫‰∫éÊù•Ê∫êÁöÑÂàÜÁ±ª\n    const sourceBasedClass = this.classifyBySource(source_type);\n    \n    return {\n      name_based: nameBasedClass,\n      description_based: descriptionBasedClass,\n      schema_based: schemaBasedClass,\n      source_based: sourceBasedClass\n    };\n  }\n\n  classifyByName(name) {\n    const patterns = {\n      energy_data: [\n        /energy|power|electricity|generation|consumption/i,\n        /solar|wind|hydro|thermal|renewable/i,\n        /grid|transmission|distribution/i\n      ],\n      carbon_data: [\n        /carbon|co2|emission|footprint/i,\n        /ghg|greenhouse|climate/i,\n        /offset|credit|allowance/i\n      ],\n      production_data: [\n        /production|manufacturing|process/i,\n        /equipment|machine|device/i,\n        /quality|defect|inspection/i\n      ],\n      resource_data: [\n        /resource|material|waste/i,\n        /water|soil|land/i,\n        /recycling|circular|sustainability/i\n      ]\n    };\n    \n    for (const [category, categoryPatterns] of Object.entries(patterns)) {\n      for (const pattern of categoryPatterns) {\n        if (pattern.test(name)) {\n          return {\n            category: category,\n            confidence: 0.8,\n            matched_pattern: pattern.source\n          };\n        }\n      }\n    }\n    \n    return {\n      category: 'unknown',\n      confidence: 0.1,\n      matched_pattern: null\n    };\n  }\n\n  // Êï∞ÊçÆË¥®ÈáèËØÑ‰º∞ÊñπÊ≥ï\n  async assessDataQuality(assets) {\n    const qualityAssessments = [];\n    \n    for (const asset of assets) {\n      try {\n        const assessment = await this.performQualityAssessment(asset);\n        qualityAssessments.push({\n          asset_id: asset.id,\n          assessment: assessment,\n          overall_score: this.calculateOverallQualityScore(assessment),\n          quality_tier: this.determineQualityTier(assessment)\n        });\n      } catch (error) {\n        logger.error(`Ë¥®ÈáèËØÑ‰º∞Â§±Ë¥•: ${asset.id}`, error);\n      }\n    }\n    \n    return {\n      individual_assessments: qualityAssessments,\n      aggregate_metrics: this.calculateAggregateQualityMetrics(qualityAssessments),\n      quality_trends: this.analyzeQualityTrends(qualityAssessments),\n      improvement_opportunities: this.identifyQualityImprovementOpportunities(qualityAssessments)\n    };\n  }\n\n  async performQualityAssessment(asset) {\n    const assessment = {\n      accuracy: await this.assessAccuracy(asset),\n      completeness: await this.assessCompleteness(asset),\n      timeliness: await this.assessTimeliness(asset),\n      consistency: await this.assessConsistency(asset),\n      validity: await this.assessValidity(asset),\n      uniqueness: await this.assessUniqueness(asset)\n    };\n    \n    return assessment;\n  }\n\n  async assessAccuracy(asset) {\n    // Ê®°ÊãüÂáÜÁ°ÆÊÄßËØÑ‰º∞\n    const sampleData = await this.getSampleData(asset);\n    const referenceData = await this.getReferenceData(asset);\n    \n    if (!sampleData || !referenceData) {\n      return { score: 0.8, method: 'default', confidence: 0.5 };\n    }\n    \n    const accuracy = this.calculateAccuracyScore(sampleData, referenceData);\n    \n    return {\n      score: accuracy,\n      method: 'reference_comparison',\n      confidence: 0.9,\n      details: {\n        sample_size: sampleData.length,\n        reference_size: referenceData.length,\n        error_rate: 1 - accuracy\n      }\n    };\n  }\n\n  // Êï∞ÊçÆ‰ª∑ÂÄºËØÑ‰º∞ÊñπÊ≥ï\n  async applyValueAssessmentModel(assets, params) {\n    const valueAssessments = [];\n    \n    for (const asset of assets) {\n      try {\n        const assessment = await this.assessIndividualAssetValue(asset, params);\n        valueAssessments.push({\n          asset_id: asset.id,\n          asset_name: asset.name,\n          assessment: assessment,\n          total_value: this.calculateTotalAssetValue(assessment),\n          value_tier: this.determineValueTier(assessment)\n        });\n      } catch (error) {\n        logger.error(`‰ª∑ÂÄºËØÑ‰º∞Â§±Ë¥•: ${asset.id}`, error);\n      }\n    }\n    \n    return valueAssessments;\n  }\n\n  async assessIndividualAssetValue(asset, params) {\n    const model = this.valueAssessmentModel;\n    const assessment = {};\n    \n    // ËØÑ‰º∞ÂÜÖÂú®‰ª∑ÂÄº\n    assessment.intrinsic_value = await this.assessIntrinsicValue(asset, model.intrinsic_value);\n    \n    // ËØÑ‰º∞ÊïàÁî®‰ª∑ÂÄº\n    assessment.utility_value = await this.assessUtilityValue(asset, model.utility_value);\n    \n    // ËØÑ‰º∞Â∏ÇÂú∫‰ª∑ÂÄº\n    assessment.market_value = await this.assessMarketValue(asset, model.market_value);\n    \n    // ËØÑ‰º∞ÊàòÁï•‰ª∑ÂÄº\n    assessment.strategic_value = await this.assessStrategicValue(asset, model.strategic_value);\n    \n    return assessment;\n  }\n\n  async assessIntrinsicValue(asset, model) {\n    const factors = {};\n    \n    // Áã¨ÁâπÊÄßËØÑ‰º∞\n    factors.uniqueness = this.assessUniqueness(asset);\n    \n    // ÂáÜÁ°ÆÊÄßËØÑ‰º∞\n    factors.accuracy = this.getQualityScore(asset, 'accuracy');\n    \n    // ÂÆåÊï¥ÊÄßËØÑ‰º∞\n    factors.completeness = this.getQualityScore(asset, 'completeness');\n    \n    // Êó∂ÊïàÊÄßËØÑ‰º∞\n    factors.timeliness = this.getQualityScore(asset, 'timeliness');\n    \n    // ËÆ°ÁÆóÂä†ÊùÉÂàÜÊï∞\n    const weightedScore = Object.keys(factors).reduce((sum, factor) => {\n      return sum + factors[factor] * model.factors[factor].weight;\n    }, 0);\n    \n    return {\n      factors: factors,\n      weighted_score: weightedScore,\n      monetary_value: this.convertToMonetaryValue(weightedScore, 'intrinsic')\n    };\n  }\n\n  // ËæÖÂä©ÊñπÊ≥ï\n  generateCatalogId(parkId) {\n    return `CATALOG_${parkId}_${Date.now()}`;\n  }\n\n  generateStandardizationId(catalogId) {\n    return `STD_${catalogId}_${Date.now()}`;\n  }\n\n  generateValuationId(catalogId) {\n    return `VAL_${catalogId}_${Date.now()}`;\n  }\n\n  generateGovernanceId(parkId) {\n    return `GOV_${parkId}_${Date.now()}`;\n  }\n\n  // Ê®°ÊãüÊï∞ÊçÆËé∑ÂèñÊñπÊ≥ï\n  async initializeDataCatalog() {\n    logger.info('Êï∞ÊçÆÁõÆÂΩïÂàùÂßãÂåñÂÆåÊàê');\n  }\n\n  async setupDataStandards() {\n    Object.keys(this.dataStandardFramework).forEach(category => {\n      this.dataStandards.set(category, this.dataStandardFramework[category]);\n    });\n    logger.info('Êï∞ÊçÆÊ†áÂáÜËÆæÁΩÆÂÆåÊàê');\n  }\n\n  async initializeDataLineage() {\n    logger.info('Êï∞ÊçÆË°ÄÁºòÂàùÂßãÂåñÂÆåÊàê');\n  }\n\n  async setupQualityMonitoring() {\n    logger.info('Ë¥®ÈáèÁõëÊéßËÆæÁΩÆÂÆåÊàê');\n  }\n\n  async startDataGovernance() {\n    // ÂêØÂä®Êï∞ÊçÆÊ≤ªÁêÜÁõëÊéß\n    setInterval(async () => {\n      try {\n        await this.monitorDataGovernance();\n      } catch (error) {\n        logger.error('Êï∞ÊçÆÊ≤ªÁêÜÁõëÊéßÂ§±Ë¥•:', error);\n      }\n    }, MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.MILLISECONDS_PER_SECOND);\n    \n    logger.info('Êï∞ÊçÆÊ≤ªÁêÜÂêØÂä®ÂÆåÊàê');\n  }\n\n  async monitorDataGovernance() {\n    // ÁõëÊéßÊï∞ÊçÆÊ≤ªÁêÜÁä∂ÊÄÅ\n    for (const [id, governance] of this.dataGovernancePolicies) {\n      const status = await this.checkGovernanceCompliance(id);\n      if (status.compliance_score < 0.8) {\n        this.emit('governance_alert', {\n          governance_id: id,\n          compliance_score: status.compliance_score,\n          issues: status.issues\n        });\n      }\n    }\n  }\n\n  async checkGovernanceCompliance(governanceId) {\n    return {\n      compliance_score: 0.85 + Math.random() * 0.1,\n      issues: ['Êï∞ÊçÆËÆøÈóÆÊùÉÈôêËøáÊúü', 'Ë¥®ÈáèÁõëÊéßÂëäË≠¶'],\n      last_check: new Date().toISOString()\n    };\n  }\n\n  // ÂÖ∂‰ªñËÆ°ÁÆóÊñπÊ≥ïÁöÑÁÆÄÂåñÂÆûÁé∞\n  groupAssetsByCategory(assets) {\n    const groups = {};\n    assets.forEach(asset => {\n      const category = asset.classification?.category || 'unknown';\n      if (!groups[category]) groups[category] = 0;\n      groups[category]++;\n    });\n    return groups;\n  }\n\n  calculateOverallQualityScore(assessment) {\n    const weights = { accuracy: 0.3, completeness: 0.25, timeliness: 0.2, consistency: 0.15, validity: 0.1 };\n    return Object.keys(weights).reduce((sum, metric) => {\n      return sum + (assessment[metric]?.score || 0) * weights[metric];\n    }, 0);\n  }\n\n  calculateTotalAssetValue(assessment) {\n    const weights = this.valueAssessmentModel;\n    return Object.keys(weights).reduce((sum, dimension) => {\n      return sum + (assessment[dimension]?.monetary_value || 0) * weights[dimension].weight;\n    }, 0);\n  }\n\n  convertToMonetaryValue(score, dimension) {\n    const baseValues = {\n      intrinsic: 10000,\n      utility: 15000,\n      market: 20000,\n      strategic: 5000\n    };\n    \n    return (baseValues[dimension] || 10000) * score;\n  }\n\n  async connectToDataSource(source) {\n    // Ê®°ÊãüÊï∞ÊçÆÊ∫êËøûÊé•\n    return { connected: true, source_id: source.id };\n  }\n\n  async getSampleData(asset) {\n    // Ê®°ÊãüËé∑ÂèñÊ†∑Êú¨Êï∞ÊçÆ\n    return Array.from({ length: 100 }, (_, i) => ({ id: i, value: Math.random() }));\n  }\n\n  calculateAccuracyScore(sampleData, referenceData) {\n    // ÁÆÄÂåñÁöÑÂáÜÁ°ÆÊÄßËÆ°ÁÆó\n    return 0.85 + Math.random() * 0.1;\n  }\n}\n\nexport default DataAssetManagementCenter;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/core/services/DataCollector.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/core/services/DataGovernanceService.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/core/services/DataLineageService.js","messages":[{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5.","line":619,"column":60,"nodeType":"Literal","messageId":"noMagic","endLine":619,"endColumn":61},{"ruleId":"object-shorthand","severity":2,"message":"Expected property shorthand.","line":627,"column":13,"nodeType":"Property","messageId":"expectedPropertyShorthand","endLine":627,"endColumn":33,"fix":{"range":[22713,22733],"text":"direction"}},{"ruleId":"object-shorthand","severity":2,"message":"Expected property shorthand.","line":688,"column":17,"nodeType":"Property","messageId":"expectedPropertyShorthand","endLine":688,"endColumn":43,"fix":{"range":[24691,24717],"text":"relationship"}},{"ruleId":"object-shorthand","severity":2,"message":"Expected property shorthand.","line":722,"column":17,"nodeType":"Property","messageId":"expectedPropertyShorthand","endLine":722,"endColumn":43,"fix":{"range":[25764,25790],"text":"relationship"}},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 3.","line":844,"column":21,"nodeType":"Literal","messageId":"noMagic","endLine":844,"endColumn":22},{"ruleId":"object-shorthand","severity":2,"message":"Expected property shorthand.","line":855,"column":13,"nodeType":"Property","messageId":"expectedPropertyShorthand","endLine":855,"endColumn":27,"fix":{"range":[30024,30038],"text":"layout"}},{"ruleId":"object-shorthand","severity":2,"message":"Expected property shorthand.","line":866,"column":17,"nodeType":"Property","messageId":"expectedPropertyShorthand","endLine":866,"endColumn":23,"fix":{"range":[30435,30441],"text":"id"}},{"ruleId":"no-unused-vars","severity":2,"message":"'id' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":948,"column":21,"nodeType":"Identifier","messageId":"unusedVar","endLine":948,"endColumn":23},{"ruleId":"object-shorthand","severity":2,"message":"Expected property shorthand.","line":971,"column":25,"nodeType":"Property","messageId":"expectedPropertyShorthand","endLine":971,"endColumn":45,"fix":{"range":[34280,34300],"text":"direction"}},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":1009,"column":23,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":1009,"endColumn":30,"fix":{"range":[35691,35698],"text":"{return;}"}},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5.","line":1034,"column":70,"nodeType":"Literal","messageId":"noMagic","endLine":1034,"endColumn":71},{"ruleId":"no-unused-vars","severity":2,"message":"'nodeId' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":1037,"column":25,"nodeType":"Identifier","messageId":"unusedVar","endLine":1037,"endColumn":31},{"ruleId":"object-shorthand","severity":2,"message":"Expected property shorthand.","line":1042,"column":25,"nodeType":"Property","messageId":"expectedPropertyShorthand","endLine":1042,"endColumn":37,"fix":{"range":[37137,37149],"text":"depth"}},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.5.","line":1061,"column":13,"nodeType":"Literal","messageId":"noMagic","endLine":1061,"endColumn":16},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5.","line":1096,"column":64,"nodeType":"Literal","messageId":"noMagic","endLine":1096,"endColumn":65},{"ruleId":"no-unused-vars","severity":2,"message":"'nodeId' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":1219,"column":21,"nodeType":"Identifier","messageId":"unusedVar","endLine":1219,"endColumn":27},{"ruleId":"no-unused-vars","severity":2,"message":"'relId' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":1234,"column":21,"nodeType":"Identifier","messageId":"unusedVar","endLine":1234,"endColumn":26},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 36.","line":1256,"column":60,"nodeType":"Literal","messageId":"noMagic","endLine":1256,"endColumn":62},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 9.","line":1256,"column":74,"nodeType":"Literal","messageId":"noMagic","endLine":1256,"endColumn":75},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 36.","line":1260,"column":60,"nodeType":"Literal","messageId":"noMagic","endLine":1260,"endColumn":62},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 9.","line":1260,"column":74,"nodeType":"Literal","messageId":"noMagic","endLine":1260,"endColumn":75},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 36.","line":1264,"column":78,"nodeType":"Literal","messageId":"noMagic","endLine":1264,"endColumn":80},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 9.","line":1264,"column":92,"nodeType":"Literal","messageId":"noMagic","endLine":1264,"endColumn":93},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":1273,"column":43,"nodeType":"Literal","messageId":"noMagic","endLine":1273,"endColumn":45},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 7.","line":1274,"column":39,"nodeType":"Literal","messageId":"noMagic","endLine":1274,"endColumn":40},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 4.","line":1275,"column":41,"nodeType":"Literal","messageId":"noMagic","endLine":1275,"endColumn":42},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5.","line":1283,"column":39,"nodeType":"Literal","messageId":"noMagic","endLine":1283,"endColumn":40},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 3.","line":1284,"column":41,"nodeType":"Literal","messageId":"noMagic","endLine":1284,"endColumn":42},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 50.","line":1293,"column":21,"nodeType":"Literal","messageId":"noMagic","endLine":1293,"endColumn":23},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":1293,"column":39,"nodeType":"Literal","messageId":"noMagic","endLine":1293,"endColumn":41},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":1293,"column":43,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":1293,"endColumn":57,"fix":{"range":[45864,45878],"text":"{return 'high';}"}},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 20.","line":1294,"column":21,"nodeType":"Literal","messageId":"noMagic","endLine":1294,"endColumn":23},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5.","line":1294,"column":39,"nodeType":"Literal","messageId":"noMagic","endLine":1294,"endColumn":40},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":1294,"column":42,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":1294,"endColumn":58,"fix":{"range":[45920,45936],"text":"{return 'medium';}"}},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":1308,"column":40,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":1308,"endColumn":72,"fix":{"range":[46380,46412],"text":"{extractNodes(nodeData.upstream);}"}},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":1309,"column":42,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":1309,"endColumn":76,"fix":{"range":[46454,46488],"text":"{extractNodes(nodeData.downstream);}"}},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":1313,"column":45,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":1313,"endColumn":90,"fix":{"range":[46567,46612],"text":"{extractNodes(lineageResult.upstream_lineage);}"}},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":1314,"column":47,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":1314,"endColumn":94,"fix":{"range":[46659,46706],"text":"{extractNodes(lineageResult.downstream_lineage);}"}},{"ruleId":"no-unused-vars","severity":2,"message":"'nodeId' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":1323,"column":25,"nodeType":"Identifier","messageId":"unusedVar","endLine":1323,"endColumn":31},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":1327,"column":40,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":1327,"endColumn":80,"fix":{"range":[47134,47174],"text":"{extractRelationships(nodeData.upstream);}"}},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":1328,"column":42,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":1328,"endColumn":84,"fix":{"range":[47216,47258],"text":"{extractRelationships(nodeData.downstream);}"}},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":1332,"column":45,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":1332,"endColumn":98,"fix":{"range":[47337,47390],"text":"{extractRelationships(lineageResult.upstream_lineage);}"}},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":1333,"column":47,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":1333,"endColumn":102,"fix":{"range":[47437,47492],"text":"{extractRelationships(lineageResult.downstream_lineage);}"}},{"ruleId":"no-unused-vars","severity":2,"message":"'nodeId' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":1343,"column":25,"nodeType":"Identifier","messageId":"unusedVar","endLine":1343,"endColumn":31},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":1344,"column":40,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":1344,"endColumn":92,"fix":{"range":[47857,47909],"text":"{calculateDepth(nodeData.upstream, currentDepth + 1);}"}},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":1345,"column":42,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":1345,"endColumn":96,"fix":{"range":[47951,48005],"text":"{calculateDepth(nodeData.downstream, currentDepth + 1);}"}},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":1349,"column":45,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":1349,"endColumn":92,"fix":{"range":[48084,48131],"text":"{calculateDepth(lineageResult.upstream_lineage);}"}},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":1350,"column":47,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":1350,"endColumn":96,"fix":{"range":[48178,48227],"text":"{calculateDepth(lineageResult.downstream_lineage);}"}},{"ruleId":"no-unused-vars","severity":2,"message":"'nodeId' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":1357,"column":21,"nodeType":"Identifier","messageId":"unusedVar","endLine":1357,"endColumn":27},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":1373,"column":58,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":1373,"endColumn":73,"fix":{"range":[48861,48876],"text":"{return 'large';}"}},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":1374,"column":67,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":1374,"endColumn":83,"fix":{"range":[48943,48959],"text":"{return 'medium';}"}},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5.","line":1400,"column":37,"nodeType":"Literal","messageId":"noMagic","endLine":1400,"endColumn":38},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 3.","line":1401,"column":33,"nodeType":"Literal","messageId":"noMagic","endLine":1401,"endColumn":34},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":1471,"column":46,"nodeType":"Literal","messageId":"noMagic","endLine":1471,"endColumn":48},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 24.","line":1503,"column":19,"nodeType":"Literal","messageId":"noMagic","endLine":1503,"endColumn":21},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":1503,"column":24,"nodeType":"Literal","messageId":"noMagic","endLine":1503,"endColumn":26},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":1503,"column":29,"nodeType":"Literal","messageId":"noMagic","endLine":1503,"endColumn":31},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":1503,"column":34,"nodeType":"Literal","messageId":"noMagic","endLine":1503,"endColumn":38},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 7.","line":1504,"column":19,"nodeType":"Literal","messageId":"noMagic","endLine":1504,"endColumn":20},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 24.","line":1504,"column":23,"nodeType":"Literal","messageId":"noMagic","endLine":1504,"endColumn":25},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":1504,"column":28,"nodeType":"Literal","messageId":"noMagic","endLine":1504,"endColumn":30},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":1504,"column":33,"nodeType":"Literal","messageId":"noMagic","endLine":1504,"endColumn":35},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":1504,"column":38,"nodeType":"Literal","messageId":"noMagic","endLine":1504,"endColumn":42},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 30.","line":1505,"column":20,"nodeType":"Literal","messageId":"noMagic","endLine":1505,"endColumn":22},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 24.","line":1505,"column":25,"nodeType":"Literal","messageId":"noMagic","endLine":1505,"endColumn":27},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":1505,"column":30,"nodeType":"Literal","messageId":"noMagic","endLine":1505,"endColumn":32},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":1505,"column":35,"nodeType":"Literal","messageId":"noMagic","endLine":1505,"endColumn":37},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":1505,"column":40,"nodeType":"Literal","messageId":"noMagic","endLine":1505,"endColumn":44},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 90.","line":1506,"column":20,"nodeType":"Literal","messageId":"noMagic","endLine":1506,"endColumn":22},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 24.","line":1506,"column":25,"nodeType":"Literal","messageId":"noMagic","endLine":1506,"endColumn":27},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":1506,"column":30,"nodeType":"Literal","messageId":"noMagic","endLine":1506,"endColumn":32},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":1506,"column":35,"nodeType":"Literal","messageId":"noMagic","endLine":1506,"endColumn":37},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":1506,"column":40,"nodeType":"Literal","messageId":"noMagic","endLine":1506,"endColumn":44}],"suppressedMessages":[],"errorCount":31,"fatalErrorCount":0,"warningCount":42,"fixableErrorCount":24,"fixableWarningCount":0,"source":"/**\n * Êï∞ÊçÆË°ÄÁºòËøΩË∏™ÊúçÂä°\n * ÂÆûÁé∞Êï∞ÊçÆË°ÄÁºòÂÖ≥Á≥ªËøΩË∏™„ÄÅÂΩ±ÂìçÂàÜÊûêÂíåÊï∞ÊçÆÊµÅÂêëÂèØËßÜÂåñ\n * ‰∏∫Èõ∂Á¢≥Âõ≠Âå∫Êï∞Â≠óÂ≠™ÁîüÁ≥ªÁªüÊèê‰æõÂÆåÊï¥ÁöÑÊï∞ÊçÆÊµÅÂêëËøΩË∏™ËÉΩÂäõ\n */\n\nimport { EventEmitter } from 'events';\nimport logger from '../../shared/utils/logger.js';\nimport { MATH_CONSTANTS } from '../../shared/constants/MathConstants.js';\n\nclass DataLineageService extends EventEmitter {\n    constructor() {\n        super();\n        \n        // Êï∞ÊçÆË°ÄÁºòÂõæ\n        this.lineageGraph = new Map();\n        \n        // Êï∞ÊçÆËäÇÁÇπ‰ø°ÊÅØ\n        this.dataNodes = new Map();\n        \n        // Êï∞ÊçÆÂÖ≥Á≥ªÊò†Â∞Ñ\n        this.relationships = new Map();\n        \n        // ÂΩ±ÂìçÂàÜÊûêÁºìÂ≠ò\n        this.impactAnalysisCache = new Map();\n        \n        // Ë°ÄÁºòËøΩË∏™‰ªªÂä°\n        this.trackingTasks = new Map();\n        \n        // ÂèòÊõ¥ÂéÜÂè≤ËÆ∞ÂΩï\n        this.changeHistory = new Map();\n        \n        // Êï∞ÊçÆÊµÅÂêëÁªüËÆ°\n        this.flowStatistics = new Map();\n        \n        // Ë°ÄÁºòÊä•Âëä\n        this.lineageReports = new Map();\n        \n        this.init();\n    }\n    \n    /**\n     * ÂàùÂßãÂåñÊï∞ÊçÆË°ÄÁºòÊúçÂä°\n     */\n    async init() {\n        try {\n            logger.info('üîó Êï∞ÊçÆË°ÄÁºòËøΩË∏™ÊúçÂä°ÂêØÂä®‰∏≠...');\n            \n            // ÂàùÂßãÂåñÊï∞ÊçÆËäÇÁÇπ\n            await this.initializeDataNodes();\n            \n            // ÊûÑÂª∫Ë°ÄÁºòÂÖ≥Á≥ª\n            await this.buildLineageRelationships();\n            \n            // ÂêØÂä®Ë°ÄÁºòËøΩË∏™‰ªªÂä°\n            await this.startTrackingTasks();\n            \n            // ÂàùÂßãÂåñÂΩ±ÂìçÂàÜÊûêÂºïÊìé\n            await this.initializeImpactAnalysis();\n            \n            logger.info('‚úÖ Êï∞ÊçÆË°ÄÁºòËøΩË∏™ÊúçÂä°ÂêØÂä®ÂÆåÊàê');\n            this.emit('lineage:ready');\n        } catch (error) {\n            logger.error('Êï∞ÊçÆË°ÄÁºòËøΩË∏™ÊúçÂä°ÂêØÂä®Â§±Ë¥•:', error);\n            throw error;\n        }\n    }\n    \n    /**\n     * ÂàùÂßãÂåñÊï∞ÊçÆËäÇÁÇπ\n     */\n    async initializeDataNodes() {\n        const nodes = [\n            // Êï∞ÊçÆÊ∫êËäÇÁÇπ\n            {\n                id: 'source_ems_energy',\n                name: 'EMSËÉΩÊ∫êÊï∞ÊçÆ',\n                type: 'source',\n                category: 'energy',\n                description: 'ËÉΩÊ∫êÁÆ°ÁêÜÁ≥ªÁªüÂéüÂßãÊï∞ÊçÆ',\n                location: 'database.energy_consumption',\n                schema: {\n                    meter_id: 'string',\n                    energy_type: 'string',\n                    consumption_amount: 'number',\n                    measurement_time: 'datetime',\n                    quality_flag: 'string'\n                },\n                update_frequency: 'real_time',\n                data_volume: '10GB',\n                owner: 'energy_team',\n                steward: 'energy_analyst',\n                tags: ['energy', 'real_time', 'critical']\n            },\n            {\n                id: 'source_mes_production',\n                name: 'MESÁîü‰∫ßÊï∞ÊçÆ',\n                type: 'source',\n                category: 'production',\n                description: 'Âà∂ÈÄ†ÊâßË°åÁ≥ªÁªüÁîü‰∫ßÊï∞ÊçÆ',\n                location: 'database.production_records',\n                schema: {\n                    enterprise_id: 'string',\n                    product_code: 'string',\n                    production_volume: 'number',\n                    production_date: 'date',\n                    process_parameters: 'json'\n                },\n                update_frequency: 'hourly',\n                data_volume: '5GB',\n                owner: 'production_team',\n                steward: 'production_manager',\n                tags: ['production', 'hourly', 'business_critical']\n            },\n            {\n                id: 'source_carbon_factors',\n                name: 'ÂõΩÂÆ∂Á¢≥ÊéíÊîæÂõ†Â≠ê',\n                type: 'reference',\n                category: 'carbon',\n                description: 'ÂõΩÂÆ∂Ê†áÂáÜÁ¢≥ÊéíÊîæÂõ†Â≠êÊï∞ÊçÆ',\n                location: 'constants.CARBON_CONSTANTS',\n                schema: {\n                    factor_type: 'string',\n                    emission_factor: 'number',\n                    unit: 'string',\n                    region: 'string',\n                    year: 'number'\n                },\n                update_frequency: 'yearly',\n                data_volume: '1MB',\n                owner: 'carbon_team',\n                steward: 'carbon_analyst',\n                tags: ['carbon', 'reference', 'national_standard']\n            },\n            \n            // Â§ÑÁêÜËäÇÁÇπ\n            {\n                id: 'process_carbon_calculation',\n                name: 'Á¢≥ÊéíÊîæËÆ°ÁÆóÂºïÊìé',\n                type: 'process',\n                category: 'carbon',\n                description: 'Á¢≥ÊéíÊîæÈáèËÆ°ÁÆóÂ§ÑÁêÜ',\n                location: 'services.CarbonCalculationEngine',\n                processing_logic: {\n                    input_sources: ['source_ems_energy', 'source_carbon_factors'],\n                    calculation_method: 'emission_factor_method',\n                    output_format: 'carbon_emission_record'\n                },\n                update_frequency: 'real_time',\n                owner: 'carbon_team',\n                steward: 'carbon_engineer',\n                tags: ['carbon', 'calculation', 'real_time']\n            },\n            {\n                id: 'process_national_indicators',\n                name: 'ÂõΩÂÆ∂ÊåáÊ†áËÆ°ÁÆó',\n                type: 'process',\n                category: 'indicators',\n                description: 'ÂõΩÂÆ∂Ê†∏ÂøÉÊåáÊ†áËÆ°ÁÆóÂ§ÑÁêÜ',\n                location: 'services.NationalIndicatorEngine',\n                processing_logic: {\n                    input_sources: ['source_ems_energy', 'source_mes_production', 'process_carbon_calculation'],\n                    calculation_method: 'national_standard_method',\n                    output_format: 'national_indicator_record'\n                },\n                update_frequency: 'daily',\n                owner: 'indicator_team',\n                steward: 'indicator_analyst',\n                tags: ['indicators', 'national_standard', 'daily']\n            },\n            {\n                id: 'process_energy_optimization',\n                name: 'Áî®ËÉΩ‰ºòÂåñË∞ÉÂ∫¶',\n                type: 'process',\n                category: 'optimization',\n                description: 'ËÉΩÊ∫ê‰ºòÂåñË∞ÉÂ∫¶Â§ÑÁêÜ',\n                location: 'services.EnergyOptimizationScheduler',\n                processing_logic: {\n                    input_sources: ['source_ems_energy', 'process_carbon_calculation'],\n                    optimization_method: 'multi_objective_optimization',\n                    output_format: 'optimization_schedule'\n                },\n                update_frequency: 'hourly',\n                owner: 'optimization_team',\n                steward: 'optimization_engineer',\n                tags: ['optimization', 'energy', 'scheduling']\n            },\n            \n            // Â≠òÂÇ®ËäÇÁÇπ\n            {\n                id: 'storage_carbon_emissions',\n                name: 'Á¢≥ÊéíÊîæÊï∞ÊçÆÂ≠òÂÇ®',\n                type: 'storage',\n                category: 'carbon',\n                description: 'Á¢≥ÊéíÊîæËÆ°ÁÆóÁªìÊûúÂ≠òÂÇ®',\n                location: 'database.carbon_emissions',\n                schema: {\n                    emission_id: 'string',\n                    emission_scope: 'string',\n                    emission_source: 'string',\n                    emission_amount: 'number',\n                    calculation_time: 'datetime',\n                    data_quality_score: 'number'\n                },\n                retention_policy: '10_years',\n                backup_frequency: 'daily',\n                owner: 'carbon_team',\n                steward: 'data_manager',\n                tags: ['carbon', 'storage', 'long_term']\n            },\n            {\n                id: 'storage_national_indicators',\n                name: 'ÂõΩÂÆ∂ÊåáÊ†áÊï∞ÊçÆÂ≠òÂÇ®',\n                type: 'storage',\n                category: 'indicators',\n                description: 'ÂõΩÂÆ∂Ê†∏ÂøÉÊåáÊ†áÂ≠òÂÇ®',\n                location: 'database.national_indicators',\n                schema: {\n                    indicator_id: 'string',\n                    indicator_type: 'string',\n                    indicator_value: 'number',\n                    target_value: 'number',\n                    calculation_date: 'date',\n                    compliance_status: 'string'\n                },\n                retention_policy: 'permanent',\n                backup_frequency: 'daily',\n                owner: 'indicator_team',\n                steward: 'data_manager',\n                tags: ['indicators', 'storage', 'permanent']\n            },\n            \n            // ËæìÂá∫ËäÇÁÇπ\n            {\n                id: 'output_dashboard',\n                name: 'ÁõëÊµã‰ª™Ë°®Áõò',\n                type: 'output',\n                category: 'visualization',\n                description: 'ÂÆûÊó∂ÁõëÊµã‰ª™Ë°®ÁõòÂ±ïÁ§∫',\n                location: 'ui.NationalIndicatorDashboard',\n                data_sources: ['storage_carbon_emissions', 'storage_national_indicators'],\n                update_frequency: 'real_time',\n                owner: 'ui_team',\n                steward: 'dashboard_admin',\n                tags: ['visualization', 'dashboard', 'real_time']\n            },\n            {\n                id: 'output_reports',\n                name: 'Áî≥Êä•È™åÊî∂Êä•Âëä',\n                type: 'output',\n                category: 'reporting',\n                description: 'Ëá™Âä®ÁîüÊàêÁî≥Êä•È™åÊî∂ÊùêÊñô',\n                location: 'services.ReportGenerator',\n                data_sources: ['storage_carbon_emissions', 'storage_national_indicators'],\n                update_frequency: 'on_demand',\n                owner: 'report_team',\n                steward: 'report_manager',\n                tags: ['reporting', 'compliance', 'on_demand']\n            },\n            {\n                id: 'output_api',\n                name: 'Êï∞ÊçÆAPIÊé•Âè£',\n                type: 'output',\n                category: 'api',\n                description: 'Ê†áÂáÜÂåñÊï∞ÊçÆAPIÊúçÂä°',\n                location: 'api.DataPlatform',\n                data_sources: ['storage_carbon_emissions', 'storage_national_indicators'],\n                update_frequency: 'real_time',\n                owner: 'api_team',\n                steward: 'api_manager',\n                tags: ['api', 'integration', 'real_time']\n            }\n        ];\n        \n        for (const node of nodes) {\n            this.dataNodes.set(node.id, {\n                ...node,\n                created_at: new Date().toISOString(),\n                last_updated: new Date().toISOString(),\n                status: 'active',\n                lineage_version: '1.0.0'\n            });\n        }\n        \n        logger.info(`üìä Â∑≤ÂàùÂßãÂåñ ${this.dataNodes.size} ‰∏™Êï∞ÊçÆËäÇÁÇπ`);\n    }\n    \n    /**\n     * ÊûÑÂª∫Ë°ÄÁºòÂÖ≥Á≥ª\n     */\n    async buildLineageRelationships() {\n        const relationships = [\n            // ËÉΩÊ∫êÊï∞ÊçÆÊµÅÂêë\n            {\n                id: 'rel_energy_to_carbon',\n                source_id: 'source_ems_energy',\n                target_id: 'process_carbon_calculation',\n                relationship_type: 'data_flow',\n                transformation: {\n                    type: 'calculation',\n                    description: 'ËÉΩÊ∫êÊ∂àË¥πÊï∞ÊçÆËΩ¨Êç¢‰∏∫Á¢≥ÊéíÊîæÈáè',\n                    fields_mapping: {\n                        'consumption_amount': 'activity_data',\n                        'energy_type': 'emission_source_type',\n                        'measurement_time': 'calculation_time'\n                    },\n                    business_rules: [\n                        '‰ΩøÁî®ÂõΩÂÆ∂Ê†áÂáÜÊéíÊîæÂõ†Â≠ê',\n                        'ÊåâËÉΩÊ∫êÁ±ªÂûãÂàÜÁ±ªËÆ°ÁÆó',\n                        'ÂÆûÊó∂ËÆ°ÁÆóÊõ¥Êñ∞'\n                    ]\n                },\n                data_quality_impact: 'high',\n                criticality: 'critical'\n            },\n            {\n                id: 'rel_carbon_factors_to_calculation',\n                source_id: 'source_carbon_factors',\n                target_id: 'process_carbon_calculation',\n                relationship_type: 'reference',\n                transformation: {\n                    type: 'lookup',\n                    description: 'Á¢≥ÊéíÊîæÂõ†Â≠êÊü•ÊâæÂåπÈÖç',\n                    fields_mapping: {\n                        'emission_factor': 'calculation_factor',\n                        'factor_type': 'energy_type_mapping'\n                    },\n                    business_rules: [\n                        'ÊåâËÉΩÊ∫êÁ±ªÂûãÂåπÈÖçÂõ†Â≠ê',\n                        '‰ΩøÁî®ÊúÄÊñ∞Âπ¥Â∫¶Âõ†Â≠ê',\n                        'Âå∫ÂüüÂõ†Â≠ê‰ºòÂÖà'\n                    ]\n                },\n                data_quality_impact: 'high',\n                criticality: 'critical'\n            },\n            {\n                id: 'rel_carbon_calculation_to_storage',\n                source_id: 'process_carbon_calculation',\n                target_id: 'storage_carbon_emissions',\n                relationship_type: 'data_flow',\n                transformation: {\n                    type: 'storage',\n                    description: 'Á¢≥ÊéíÊîæËÆ°ÁÆóÁªìÊûúÂ≠òÂÇ®',\n                    fields_mapping: {\n                        'calculated_emissions': 'emission_amount',\n                        'calculation_metadata': 'calculation_details'\n                    },\n                    business_rules: [\n                        'ÂåÖÂê´Êï∞ÊçÆË¥®ÈáèËØÑÂàÜ',\n                        'ËÆ∞ÂΩïËÆ°ÁÆóÊñπÊ≥ï',\n                        '‰øùÁïôÂÆ°ËÆ°ËΩ®Ëøπ'\n                    ]\n                },\n                data_quality_impact: 'medium',\n                criticality: 'high'\n            },\n            \n            // Áîü‰∫ßÊï∞ÊçÆÊµÅÂêë\n            {\n                id: 'rel_production_to_indicators',\n                source_id: 'source_mes_production',\n                target_id: 'process_national_indicators',\n                relationship_type: 'data_flow',\n                transformation: {\n                    type: 'aggregation',\n                    description: 'Áîü‰∫ßÊï∞ÊçÆËÅöÂêàËÆ°ÁÆóÂõΩÂÆ∂ÊåáÊ†á',\n                    fields_mapping: {\n                        'production_volume': 'total_production',\n                        'enterprise_id': 'enterprise_grouping'\n                    },\n                    business_rules: [\n                        'Êåâ‰ºÅ‰∏öÂàÜÁªÑÁªüËÆ°',\n                        'Êåâ‰∫ßÂìÅÁ±ªÂûãÂàÜÁ±ª',\n                        'Êó•Â∫¶Êï∞ÊçÆËÅöÂêà'\n                    ]\n                },\n                data_quality_impact: 'high',\n                criticality: 'high'\n            },\n            \n            // ÂõΩÂÆ∂ÊåáÊ†áËÆ°ÁÆóÊµÅÂêë\n            {\n                id: 'rel_carbon_to_indicators',\n                source_id: 'process_carbon_calculation',\n                target_id: 'process_national_indicators',\n                relationship_type: 'data_flow',\n                transformation: {\n                    type: 'calculation',\n                    description: 'Á¢≥ÊéíÊîæÊï∞ÊçÆÁî®‰∫éÂõΩÂÆ∂ÊåáÊ†áËÆ°ÁÆó',\n                    fields_mapping: {\n                        'emission_amount': 'carbon_intensity_input',\n                        'emission_scope': 'scope_classification'\n                    },\n                    business_rules: [\n                        'ËÆ°ÁÆóÂçï‰ΩçËÉΩËÄóÁ¢≥ÊéíÊîæ',\n                        'ÊåâËåÉÂõ¥ÂàÜÁ±ªÁªüËÆ°',\n                        'Á¨¶ÂêàÂõΩÂÆ∂Ê†áÂáÜ'\n                    ]\n                },\n                data_quality_impact: 'high',\n                criticality: 'critical'\n            },\n            {\n                id: 'rel_indicators_to_storage',\n                source_id: 'process_national_indicators',\n                target_id: 'storage_national_indicators',\n                relationship_type: 'data_flow',\n                transformation: {\n                    type: 'storage',\n                    description: 'ÂõΩÂÆ∂ÊåáÊ†áËÆ°ÁÆóÁªìÊûúÂ≠òÂÇ®',\n                    fields_mapping: {\n                        'calculated_indicators': 'indicator_value',\n                        'compliance_check': 'compliance_status'\n                    },\n                    business_rules: [\n                        'Ê∞∏‰πÖ‰øùÂ≠ò',\n                        'ÁâàÊú¨ÊéßÂà∂',\n                        'ÂêàËßÑÊÄßÊ†áËÆ∞'\n                    ]\n                },\n                data_quality_impact: 'medium',\n                criticality: 'high'\n            },\n            \n            // ‰ºòÂåñË∞ÉÂ∫¶ÊµÅÂêë\n            {\n                id: 'rel_energy_to_optimization',\n                source_id: 'source_ems_energy',\n                target_id: 'process_energy_optimization',\n                relationship_type: 'data_flow',\n                transformation: {\n                    type: 'optimization_input',\n                    description: 'ËÉΩÊ∫êÊï∞ÊçÆÁî®‰∫é‰ºòÂåñË∞ÉÂ∫¶',\n                    fields_mapping: {\n                        'consumption_amount': 'current_load',\n                        'energy_type': 'energy_category'\n                    },\n                    business_rules: [\n                        'ÂÆûÊó∂Ë¥üËç∑ÂàÜÊûê',\n                        'Â§öÁõÆÊ†á‰ºòÂåñ',\n                        'Á∫¶ÊùüÊù°‰ª∂Ê£ÄÊü•'\n                    ]\n                },\n                data_quality_impact: 'high',\n                criticality: 'high'\n            },\n            \n            // ËæìÂá∫ÊµÅÂêë\n            {\n                id: 'rel_storage_to_dashboard',\n                source_id: 'storage_carbon_emissions',\n                target_id: 'output_dashboard',\n                relationship_type: 'data_consumption',\n                transformation: {\n                    type: 'visualization',\n                    description: 'Á¢≥ÊéíÊîæÊï∞ÊçÆÂèØËßÜÂåñÂ±ïÁ§∫',\n                    fields_mapping: {\n                        'emission_amount': 'chart_data',\n                        'calculation_time': 'time_axis'\n                    },\n                    business_rules: [\n                        'ÂÆûÊó∂Êõ¥Êñ∞ÊòæÁ§∫',\n                        'Â§öÁª¥Â∫¶Â±ïÁ§∫',\n                        'ÂëäË≠¶ÈòàÂÄºÊ£ÄÊü•'\n                    ]\n                },\n                data_quality_impact: 'low',\n                criticality: 'medium'\n            },\n            {\n                id: 'rel_indicators_to_dashboard',\n                source_id: 'storage_national_indicators',\n                target_id: 'output_dashboard',\n                relationship_type: 'data_consumption',\n                transformation: {\n                    type: 'visualization',\n                    description: 'ÂõΩÂÆ∂ÊåáÊ†áÊï∞ÊçÆÂèØËßÜÂåñÂ±ïÁ§∫',\n                    fields_mapping: {\n                        'indicator_value': 'kpi_display',\n                        'target_value': 'target_comparison'\n                    },\n                    business_rules: [\n                        'ÁõÆÊ†áÂØπÊØîÊòæÁ§∫',\n                        'Ë∂ãÂäøÂàÜÊûê',\n                        'È¢ÑË≠¶ÊèêÁ§∫'\n                    ]\n                },\n                data_quality_impact: 'low',\n                criticality: 'medium'\n            },\n            {\n                id: 'rel_storage_to_reports',\n                source_id: 'storage_carbon_emissions',\n                target_id: 'output_reports',\n                relationship_type: 'data_consumption',\n                transformation: {\n                    type: 'reporting',\n                    description: 'Á¢≥ÊéíÊîæÊï∞ÊçÆÁî®‰∫éÊä•ÂëäÁîüÊàê',\n                    fields_mapping: {\n                        'emission_amount': 'report_data',\n                        'data_quality_score': 'data_reliability'\n                    },\n                    business_rules: [\n                        'ÊåâÊ®°ÊùøÊ†ºÂºèÂåñ',\n                        'Êï∞ÊçÆÈ™åËØÅÊ£ÄÊü•',\n                        'ÂêàËßÑÊÄßÁ°ÆËÆ§'\n                    ]\n                },\n                data_quality_impact: 'medium',\n                criticality: 'high'\n            },\n            {\n                id: 'rel_indicators_to_api',\n                source_id: 'storage_national_indicators',\n                target_id: 'output_api',\n                relationship_type: 'data_consumption',\n                transformation: {\n                    type: 'api_service',\n                    description: 'ÂõΩÂÆ∂ÊåáÊ†áÊï∞ÊçÆAPIÊúçÂä°',\n                    fields_mapping: {\n                        'indicator_value': 'api_response',\n                        'calculation_date': 'data_timestamp'\n                    },\n                    business_rules: [\n                        'RESTful APIÊ†áÂáÜ',\n                        'ËÆøÈóÆÊùÉÈôêÊéßÂà∂',\n                        'Êï∞ÊçÆÊ†ºÂºèÊ†áÂáÜÂåñ'\n                    ]\n                },\n                data_quality_impact: 'medium',\n                criticality: 'medium'\n            }\n        ];\n        \n        for (const relationship of relationships) {\n            this.relationships.set(relationship.id, {\n                ...relationship,\n                created_at: new Date().toISOString(),\n                last_updated: new Date().toISOString(),\n                status: 'active',\n                lineage_version: '1.0.0'\n            });\n            \n            // ÊûÑÂª∫Ë°ÄÁºòÂõæ\n            if (!this.lineageGraph.has(relationship.source_id)) {\n                this.lineageGraph.set(relationship.source_id, {\n                    downstream: new Set(),\n                    upstream: new Set()\n                });\n            }\n            if (!this.lineageGraph.has(relationship.target_id)) {\n                this.lineageGraph.set(relationship.target_id, {\n                    downstream: new Set(),\n                    upstream: new Set()\n                });\n            }\n            \n            this.lineageGraph.get(relationship.source_id).downstream.add(relationship.target_id);\n            this.lineageGraph.get(relationship.target_id).upstream.add(relationship.source_id);\n        }\n        \n        logger.info(`üîó Â∑≤ÊûÑÂª∫ ${this.relationships.size} ‰∏™Ë°ÄÁºòÂÖ≥Á≥ª`);\n    }\n    \n    /**\n     * ÂêØÂä®Ë°ÄÁºòËøΩË∏™‰ªªÂä°\n     */\n    async startTrackingTasks() {\n        // Ë°ÄÁºòÂÖ≥Á≥ªÁõëÊéß‰ªªÂä°\n        const lineageMonitoringTask = setInterval(async () => {\n            await this.monitorLineageHealth();\n        }, MATH_CONSTANTS.TEN * MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.MILLISECONDS_PER_SECOND); // ÊØè10ÂàÜÈíü\n        \n        // ÂΩ±ÂìçÂàÜÊûêÊõ¥Êñ∞‰ªªÂä°\n        const impactAnalysisTask = setInterval(async () => {\n            await this.updateImpactAnalysis();\n        }, MATH_CONSTANTS.THIRTY * MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.MILLISECONDS_PER_SECOND); // ÊØè30ÂàÜÈíü\n        \n        // Ë°ÄÁºòÁªüËÆ°‰ªªÂä°\n        const statisticsTask = setInterval(async () => {\n            await this.updateFlowStatistics();\n        }, MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.MILLISECONDS_PER_SECOND); // ÊØèÂ∞èÊó∂\n        \n        this.trackingTasks.set('lineage_monitoring', lineageMonitoringTask);\n        this.trackingTasks.set('impact_analysis', impactAnalysisTask);\n        this.trackingTasks.set('statistics', statisticsTask);\n        \n        logger.info('üîÑ Ë°ÄÁºòËøΩË∏™‰ªªÂä°Â∑≤ÂêØÂä®');\n    }\n    \n    /**\n     * ÂàùÂßãÂåñÂΩ±ÂìçÂàÜÊûêÂºïÊìé\n     */\n    async initializeImpactAnalysis() {\n        // È¢ÑËÆ°ÁÆóÂ∏∏Áî®ÁöÑÂΩ±ÂìçÂàÜÊûêË∑ØÂæÑ\n        const criticalNodes = Array.from(this.dataNodes.values())\n            .filter(node => node.tags && node.tags.includes('critical'));\n            \n        for (const node of criticalNodes) {\n            const impactAnalysis = await this.calculateImpactAnalysis(node.id);\n            this.impactAnalysisCache.set(node.id, {\n                ...impactAnalysis,\n                cached_at: new Date().toISOString(),\n                cache_ttl: 3600000 // 1Â∞èÊó∂\n            });\n        }\n        \n        logger.info(`üéØ Â∑≤È¢ÑËÆ°ÁÆó ${criticalNodes.length} ‰∏™ÂÖ≥ÈîÆËäÇÁÇπÁöÑÂΩ±ÂìçÂàÜÊûê`);\n    }\n    \n    /**\n     * ËøΩË∏™Êï∞ÊçÆË°ÄÁºò\n     * @param {string} nodeId Êï∞ÊçÆËäÇÁÇπID\n     * @param {string} direction ËøΩË∏™ÊñπÂêë (upstream/downstream/both)\n     * @param {number} depth ËøΩË∏™Ê∑±Â∫¶\n     * @returns {Object} Ë°ÄÁºòËøΩË∏™ÁªìÊûú\n     */\n    async traceLineage(nodeId, direction = 'both', depth = 5) {\n        const node = this.dataNodes.get(nodeId);\n        if (!node) {\n            throw new Error(`Êï∞ÊçÆËäÇÁÇπ‰∏çÂ≠òÂú®: ${nodeId}`);\n        }\n        \n        const lineageResult = {\n            root_node: node,\n            direction: direction,\n            max_depth: depth,\n            traced_at: new Date().toISOString(),\n            upstream_lineage: {},\n            downstream_lineage: {},\n            lineage_paths: [],\n            statistics: {\n                total_nodes: 0,\n                total_relationships: 0,\n                max_depth_reached: 0\n            }\n        };\n        \n        // ‰∏äÊ∏∏Ë°ÄÁºòËøΩË∏™\n        if (direction === 'upstream' || direction === 'both') {\n            lineageResult.upstream_lineage = await this.traceUpstream(nodeId, depth);\n        }\n        \n        // ‰∏ãÊ∏∏Ë°ÄÁºòËøΩË∏™\n        if (direction === 'downstream' || direction === 'both') {\n            lineageResult.downstream_lineage = await this.traceDownstream(nodeId, depth);\n        }\n        \n        // ÁîüÊàêË°ÄÁºòË∑ØÂæÑ\n        lineageResult.lineage_paths = this.generateLineagePaths(nodeId, lineageResult);\n        \n        // ËÆ°ÁÆóÁªüËÆ°‰ø°ÊÅØ\n        lineageResult.statistics = this.calculateLineageStatistics(lineageResult);\n        \n        logger.info(`üîç ÂÆåÊàêËäÇÁÇπ ${nodeId} ÁöÑË°ÄÁºòËøΩË∏™`);\n        this.emit('lineage:traced', lineageResult);\n        \n        return lineageResult;\n    }\n    \n    /**\n     * ‰∏äÊ∏∏Ë°ÄÁºòËøΩË∏™\n     * @param {string} nodeId ËäÇÁÇπID\n     * @param {number} depth Ââ©‰ΩôÊ∑±Â∫¶\n     * @param {Set} visited Â∑≤ËÆøÈóÆËäÇÁÇπ\n     * @returns {Object} ‰∏äÊ∏∏Ë°ÄÁºò\n     */\n    async traceUpstream(nodeId, depth, visited = new Set()) {\n        if (depth <= 0 || visited.has(nodeId)) {\n            return {};\n        }\n        \n        visited.add(nodeId);\n        const lineage = this.lineageGraph.get(nodeId);\n        if (!lineage || !lineage.upstream.size) {\n            return {};\n        }\n        \n        const upstreamNodes = {};\n        \n        for (const upstreamNodeId of lineage.upstream) {\n            const upstreamNode = this.dataNodes.get(upstreamNodeId);\n            const relationship = this.findRelationship(upstreamNodeId, nodeId);\n            \n            upstreamNodes[upstreamNodeId] = {\n                node: upstreamNode,\n                relationship: relationship,\n                upstream: await this.traceUpstream(upstreamNodeId, depth - 1, new Set(visited))\n            };\n        }\n        \n        return upstreamNodes;\n    }\n    \n    /**\n     * ‰∏ãÊ∏∏Ë°ÄÁºòËøΩË∏™\n     * @param {string} nodeId ËäÇÁÇπID\n     * @param {number} depth Ââ©‰ΩôÊ∑±Â∫¶\n     * @param {Set} visited Â∑≤ËÆøÈóÆËäÇÁÇπ\n     * @returns {Object} ‰∏ãÊ∏∏Ë°ÄÁºò\n     */\n    async traceDownstream(nodeId, depth, visited = new Set()) {\n        if (depth <= 0 || visited.has(nodeId)) {\n            return {};\n        }\n        \n        visited.add(nodeId);\n        const lineage = this.lineageGraph.get(nodeId);\n        if (!lineage || !lineage.downstream.size) {\n            return {};\n        }\n        \n        const downstreamNodes = {};\n        \n        for (const downstreamNodeId of lineage.downstream) {\n            const downstreamNode = this.dataNodes.get(downstreamNodeId);\n            const relationship = this.findRelationship(nodeId, downstreamNodeId);\n            \n            downstreamNodes[downstreamNodeId] = {\n                node: downstreamNode,\n                relationship: relationship,\n                downstream: await this.traceDownstream(downstreamNodeId, depth - 1, new Set(visited))\n            };\n        }\n        \n        return downstreamNodes;\n    }\n    \n    /**\n     * ËÆ°ÁÆóÂΩ±ÂìçÂàÜÊûê\n     * @param {string} nodeId ËäÇÁÇπID\n     * @param {string} changeType ÂèòÊõ¥Á±ªÂûã\n     * @returns {Object} ÂΩ±ÂìçÂàÜÊûêÁªìÊûú\n     */\n    async calculateImpactAnalysis(nodeId, changeType = 'data_change') {\n        // Ê£ÄÊü•ÁºìÂ≠ò\n        const cacheKey = `${nodeId}_${changeType}`;\n        const cached = this.impactAnalysisCache.get(cacheKey);\n        if (cached && Date.now() - new Date(cached.cached_at).getTime() < cached.cache_ttl) {\n            return cached;\n        }\n        \n        const node = this.dataNodes.get(nodeId);\n        if (!node) {\n            throw new Error(`Êï∞ÊçÆËäÇÁÇπ‰∏çÂ≠òÂú®: ${nodeId}`);\n        }\n        \n        const impactAnalysis = {\n            source_node: node,\n            change_type: changeType,\n            analyzed_at: new Date().toISOString(),\n            direct_impact: {\n                affected_nodes: [],\n                affected_relationships: [],\n                impact_score: 0\n            },\n            indirect_impact: {\n                affected_nodes: [],\n                affected_relationships: [],\n                impact_score: 0\n            },\n            total_impact: {\n                total_affected_nodes: 0,\n                total_affected_relationships: 0,\n                overall_impact_score: 0,\n                criticality_level: 'low'\n            },\n            mitigation_strategies: [],\n            rollback_plan: {}\n        };\n        \n        // Áõ¥Êé•ÂΩ±ÂìçÂàÜÊûê\n        await this.analyzeDirectImpact(nodeId, impactAnalysis);\n        \n        // Èó¥Êé•ÂΩ±ÂìçÂàÜÊûê\n        await this.analyzeIndirectImpact(nodeId, impactAnalysis);\n        \n        // ËÆ°ÁÆóÊÄª‰ΩìÂΩ±Âìç\n        this.calculateTotalImpact(impactAnalysis);\n        \n        // ÁîüÊàêÁºìËß£Á≠ñÁï•\n        this.generateMitigationStrategies(impactAnalysis);\n        \n        // ÁîüÊàêÂõûÊªöËÆ°Âàí\n        this.generateRollbackPlan(impactAnalysis);\n        \n        // Êõ¥Êñ∞ÁºìÂ≠ò\n        this.impactAnalysisCache.set(cacheKey, {\n            ...impactAnalysis,\n            cached_at: new Date().toISOString(),\n            cache_ttl: 3600000\n        });\n        \n        logger.info(`üéØ ÂÆåÊàêËäÇÁÇπ ${nodeId} ÁöÑÂΩ±ÂìçÂàÜÊûê`);\n        this.emit('impact:analyzed', impactAnalysis);\n        \n        return impactAnalysis;\n    }\n    \n    /**\n     * ËÆ∞ÂΩïÊï∞ÊçÆÂèòÊõ¥\n     * @param {string} nodeId ËäÇÁÇπID\n     * @param {Object} changeDetails ÂèòÊõ¥ËØ¶ÊÉÖ\n     */\n    async recordDataChange(nodeId, changeDetails) {\n        const changeId = this.generateChangeId();\n        const changeRecord = {\n            change_id: changeId,\n            node_id: nodeId,\n            change_type: changeDetails.type,\n            change_description: changeDetails.description,\n            changed_fields: changeDetails.fields || [],\n            change_impact: changeDetails.impact || 'unknown',\n            changed_by: changeDetails.user || 'system',\n            change_reason: changeDetails.reason || '',\n            timestamp: new Date().toISOString(),\n            before_state: changeDetails.before || {},\n            after_state: changeDetails.after || {},\n            validation_status: 'pending'\n        };\n        \n        this.changeHistory.set(changeId, changeRecord);\n        \n        // Ëß¶ÂèëÂΩ±ÂìçÂàÜÊûê\n        const impactAnalysis = await this.calculateImpactAnalysis(nodeId, changeDetails.type);\n        changeRecord.impact_analysis = impactAnalysis;\n        changeRecord.validation_status = 'completed';\n        \n        logger.info(`üìù ËÆ∞ÂΩïÊï∞ÊçÆÂèòÊõ¥: ${changeId}`);\n        this.emit('change:recorded', changeRecord);\n        \n        return changeRecord;\n    }\n    \n    /**\n     * ÁîüÊàêË°ÄÁºòÂèØËßÜÂåñÂõæ\n     * @param {string} nodeId ‰∏≠ÂøÉËäÇÁÇπID\n     * @param {Object} options ÂèØËßÜÂåñÈÄâÈ°π\n     * @returns {Object} ÂèØËßÜÂåñÂõæÊï∞ÊçÆ\n     */\n    async generateLineageVisualization(nodeId, options = {}) {\n        const {\n            depth = 3,\n            direction = 'both',\n            includeMetadata = true,\n            layout = 'hierarchical'\n        } = options;\n        \n        const lineageData = await this.traceLineage(nodeId, direction, depth);\n        \n        const visualization = {\n            graph_id: this.generateVisualizationId(),\n            center_node: nodeId,\n            layout: layout,\n            generated_at: new Date().toISOString(),\n            nodes: [],\n            edges: [],\n            metadata: includeMetadata ? this.generateVisualizationMetadata(lineageData) : null\n        };\n        \n        // ÁîüÊàêËäÇÁÇπÊï∞ÊçÆ\n        const allNodes = this.extractAllNodes(lineageData);\n        for (const [id, nodeData] of allNodes) {\n            visualization.nodes.push({\n                id: id,\n                label: nodeData.name,\n                type: nodeData.type,\n                category: nodeData.category,\n                size: this.calculateNodeSize(nodeData),\n                color: this.getNodeColor(nodeData.type),\n                metadata: includeMetadata ? nodeData : null\n            });\n        }\n        \n        // ÁîüÊàêËæπÊï∞ÊçÆ\n        const allRelationships = this.extractAllRelationships(lineageData);\n        for (const relationship of allRelationships) {\n            visualization.edges.push({\n                id: relationship.id,\n                source: relationship.source_id,\n                target: relationship.target_id,\n                label: relationship.relationship_type,\n                weight: this.calculateEdgeWeight(relationship),\n                color: this.getEdgeColor(relationship.relationship_type),\n                metadata: includeMetadata ? relationship : null\n            });\n        }\n        \n        logger.info(`üé® ÁîüÊàêË°ÄÁºòÂèØËßÜÂåñÂõæ: ${visualization.graph_id}`);\n        this.emit('visualization:generated', visualization);\n        \n        return visualization;\n    }\n    \n    /**\n     * ÁîüÊàêË°ÄÁºòÊä•Âëä\n     * @param {string} reportType Êä•ÂëäÁ±ªÂûã\n     * @param {Object} options Êä•ÂëäÈÄâÈ°π\n     * @returns {Object} Ë°ÄÁºòÊä•Âëä\n     */\n    async generateLineageReport(reportType = 'comprehensive', options = {}) {\n        const reportId = this.generateReportId(reportType);\n        \n        const report = {\n            report_id: reportId,\n            type: reportType,\n            generated_at: new Date().toISOString(),\n            time_range: options.timeRange || '30d',\n            sections: {}\n        };\n        \n        // Ë°ÄÁºòÊ¶ÇËßà\n        if (reportType === 'comprehensive' || reportType === 'overview') {\n            report.sections.overview = await this.generateOverviewSection();\n        }\n        \n        // Êï∞ÊçÆÊµÅÂàÜÊûê\n        if (reportType === 'comprehensive' || reportType === 'flow_analysis') {\n            report.sections.flow_analysis = await this.generateFlowAnalysisSection();\n        }\n        \n        // ÂΩ±ÂìçÂàÜÊûêÊ±áÊÄª\n        if (reportType === 'comprehensive' || reportType === 'impact_summary') {\n            report.sections.impact_summary = await this.generateImpactSummarySection();\n        }\n        \n        // ÂèòÊõ¥ÂéÜÂè≤\n        if (reportType === 'comprehensive' || reportType === 'change_history') {\n            report.sections.change_history = await this.generateChangeHistorySection(options.timeRange);\n        }\n        \n        // ‰ºòÂåñÂª∫ËÆÆ\n        if (reportType === 'comprehensive' || reportType === 'optimization') {\n            report.sections.optimization = await this.generateOptimizationSection();\n        }\n        \n        this.lineageReports.set(reportId, report);\n        \n        logger.info(`üìä ÁîüÊàêË°ÄÁºòÊä•Âëä: ${reportId}`);\n        this.emit('report:generated', report);\n        \n        return report;\n    }\n    \n    // ËæÖÂä©ÊñπÊ≥ïÂÆûÁé∞\n    findRelationship(sourceId, targetId) {\n        for (const [id, relationship] of this.relationships) {\n            if (relationship.source_id === sourceId && relationship.target_id === targetId) {\n                return relationship;\n            }\n        }\n        return null;\n    }\n    \n    generateLineagePaths(nodeId, lineageResult) {\n        const paths = [];\n        \n        // ÁîüÊàê‰ªéÊ∫êÂà∞ÁõÆÊ†áÁöÑÂÆåÊï¥Ë∑ØÂæÑ\n        const generatePaths = (current, path, direction, lineageData) => {\n            if (direction === 'downstream') {\n                for (const [nextNodeId, nextData] of Object.entries(lineageData)) {\n                    const newPath = [...path, {\n                        node_id: nextNodeId,\n                        node_name: nextData.node.name,\n                        relationship: nextData.relationship\n                    }];\n                    \n                    paths.push({\n                        path_id: `path_${paths.length + 1}`,\n                        direction: direction,\n                        nodes: newPath,\n                        length: newPath.length\n                    });\n                    \n                    if (nextData.downstream && Object.keys(nextData.downstream).length > 0) {\n                        generatePaths(nextNodeId, newPath, direction, nextData.downstream);\n                    }\n                }\n            }\n        };\n        \n        if (lineageResult.downstream_lineage) {\n            generatePaths(nodeId, [{\n                node_id: nodeId,\n                node_name: lineageResult.root_node.name,\n                relationship: null\n            }], 'downstream', lineageResult.downstream_lineage);\n        }\n        \n        return paths;\n    }\n    \n    calculateLineageStatistics(lineageResult) {\n        const allNodes = this.extractAllNodes(lineageResult);\n        const allRelationships = this.extractAllRelationships(lineageResult);\n        \n        return {\n            total_nodes: allNodes.size,\n            total_relationships: allRelationships.length,\n            max_depth_reached: this.calculateMaxDepth(lineageResult),\n            node_types: this.countNodeTypes(allNodes),\n            relationship_types: this.countRelationshipTypes(allRelationships)\n        };\n    }\n    \n    async analyzeDirectImpact(nodeId, impactAnalysis) {\n        const lineage = this.lineageGraph.get(nodeId);\n        if (!lineage) return;\n        \n        // Áõ¥Êé•‰∏ãÊ∏∏ËäÇÁÇπ\n        for (const downstreamNodeId of lineage.downstream) {\n            const downstreamNode = this.dataNodes.get(downstreamNodeId);\n            const relationship = this.findRelationship(nodeId, downstreamNodeId);\n            \n            impactAnalysis.direct_impact.affected_nodes.push({\n                node: downstreamNode,\n                impact_type: 'direct_downstream',\n                criticality: relationship.criticality,\n                data_quality_impact: relationship.data_quality_impact\n            });\n            \n            impactAnalysis.direct_impact.affected_relationships.push(relationship);\n        }\n        \n        // ËÆ°ÁÆóÁõ¥Êé•ÂΩ±ÂìçÂàÜÊï∞\n        impactAnalysis.direct_impact.impact_score = this.calculateImpactScore(\n            impactAnalysis.direct_impact.affected_nodes,\n            impactAnalysis.direct_impact.affected_relationships\n        );\n    }\n    \n    async analyzeIndirectImpact(nodeId, impactAnalysis) {\n        const downstreamLineage = await this.traceDownstream(nodeId, 5);\n        \n        const collectIndirectNodes = (lineageData, depth = 1) => {\n            for (const [nodeId, nodeData] of Object.entries(lineageData)) {\n                if (depth > 1) { // Èó¥Êé•ÂΩ±Âìç‰ªéÁ¨¨‰∫åÂ±ÇÂºÄÂßã\n                    impactAnalysis.indirect_impact.affected_nodes.push({\n                        node: nodeData.node,\n                        impact_type: 'indirect_downstream',\n                        depth: depth,\n                        criticality: nodeData.relationship.criticality\n                    });\n                    \n                    impactAnalysis.indirect_impact.affected_relationships.push(nodeData.relationship);\n                }\n                \n                if (nodeData.downstream) {\n                    collectIndirectNodes(nodeData.downstream, depth + 1);\n                }\n            }\n        };\n        \n        collectIndirectNodes(downstreamLineage);\n        \n        // ËÆ°ÁÆóÈó¥Êé•ÂΩ±ÂìçÂàÜÊï∞\n        impactAnalysis.indirect_impact.impact_score = this.calculateImpactScore(\n            impactAnalysis.indirect_impact.affected_nodes,\n            impactAnalysis.indirect_impact.affected_relationships\n        ) * 0.5; // Èó¥Êé•ÂΩ±ÂìçÊùÉÈáçÈôç‰Ωé\n    }\n    \n    calculateTotalImpact(impactAnalysis) {\n        const totalNodes = impactAnalysis.direct_impact.affected_nodes.length + \n                          impactAnalysis.indirect_impact.affected_nodes.length;\n        const totalRelationships = impactAnalysis.direct_impact.affected_relationships.length + \n                                  impactAnalysis.indirect_impact.affected_relationships.length;\n        const overallScore = impactAnalysis.direct_impact.impact_score + \n                           impactAnalysis.indirect_impact.impact_score;\n        \n        impactAnalysis.total_impact = {\n            total_affected_nodes: totalNodes,\n            total_affected_relationships: totalRelationships,\n            overall_impact_score: Math.round(overallScore),\n            criticality_level: this.determineCriticalityLevel(overallScore, totalNodes)\n        };\n    }\n    \n    generateMitigationStrategies(impactAnalysis) {\n        const strategies = [];\n        \n        if (impactAnalysis.total_impact.criticality_level === 'high') {\n            strategies.push({\n                strategy: 'staged_rollout',\n                description: 'ÂàÜÈò∂ÊÆµÈÉ®ÁΩ≤ÂèòÊõ¥ÔºåÈÄêÊ≠•È™åËØÅÂΩ±Âìç',\n                priority: 'high'\n            });\n            strategies.push({\n                strategy: 'backup_verification',\n                description: 'Á°Æ‰øùÊâÄÊúâÂèóÂΩ±ÂìçÊï∞ÊçÆÊúâÂÆåÊï¥Â§á‰ªΩ',\n                priority: 'high'\n            });\n        }\n        \n        if (impactAnalysis.total_impact.total_affected_nodes > 5) {\n            strategies.push({\n                strategy: 'parallel_testing',\n                description: 'Âú®ÊµãËØïÁéØÂ¢ÉÂπ∂Ë°åÈ™åËØÅÊâÄÊúâÂèóÂΩ±ÂìçËäÇÁÇπ',\n                priority: 'medium'\n            });\n        }\n        \n        strategies.push({\n            strategy: 'monitoring_enhancement',\n            description: 'Âä†Âº∫ÂèòÊõ¥ÊúüÈó¥ÁöÑÁõëÊéßÂíåÂëäË≠¶',\n            priority: 'medium'\n        });\n        \n        impactAnalysis.mitigation_strategies = strategies;\n    }\n    \n    generateRollbackPlan(impactAnalysis) {\n        impactAnalysis.rollback_plan = {\n            rollback_strategy: 'automated_rollback',\n            estimated_rollback_time: '15_minutes',\n            rollback_steps: [\n                'ÂÅúÊ≠¢ÂèóÂΩ±ÂìçÁöÑÊï∞ÊçÆÂ§ÑÁêÜÊµÅÁ®ã',\n                'ÊÅ¢Â§çÊï∞ÊçÆÂà∞ÂèòÊõ¥ÂâçÁä∂ÊÄÅ',\n                'ÈáçÂêØÁõ∏ÂÖ≥ÊúçÂä°',\n                'È™åËØÅÊï∞ÊçÆ‰∏ÄËá¥ÊÄß',\n                'ÊÅ¢Â§çÊ≠£Â∏∏ÁõëÊéß'\n            ],\n            rollback_validation: [\n                'Êï∞ÊçÆÂÆåÊï¥ÊÄßÊ£ÄÊü•',\n                '‰∏öÂä°ÊµÅÁ®ãÈ™åËØÅ',\n                'ÊÄßËÉΩÊåáÊ†áÁ°ÆËÆ§'\n            ]\n        };\n    }\n    \n    // ÁõëÊéßÂíåÁªüËÆ°ÊñπÊ≥ï\n    async monitorLineageHealth() {\n        logger.info('üîç ÂºÄÂßãË°ÄÁºòÂÅ•Â∫∑ÁõëÊéß...');\n        \n        const healthReport = {\n            timestamp: new Date().toISOString(),\n            total_nodes: this.dataNodes.size,\n            total_relationships: this.relationships.size,\n            healthy_nodes: 0,\n            unhealthy_nodes: 0,\n            broken_relationships: 0,\n            issues: []\n        };\n        \n        // Ê£ÄÊü•ËäÇÁÇπÂÅ•Â∫∑Áä∂ÊÄÅ\n        for (const [nodeId, node] of this.dataNodes) {\n            if (node.status === 'active') {\n                healthReport.healthy_nodes++;\n            } else {\n                healthReport.unhealthy_nodes++;\n                healthReport.issues.push({\n                    type: 'unhealthy_node',\n                    node_id: nodeId,\n                    issue: `ËäÇÁÇπÁä∂ÊÄÅÂºÇÂ∏∏: ${node.status}`\n                });\n            }\n        }\n        \n        // Ê£ÄÊü•ÂÖ≥Á≥ªÂÆåÊï¥ÊÄß\n        for (const [relId, relationship] of this.relationships) {\n            const sourceExists = this.dataNodes.has(relationship.source_id);\n            const targetExists = this.dataNodes.has(relationship.target_id);\n            \n            if (!sourceExists || !targetExists) {\n                healthReport.broken_relationships++;\n                healthReport.issues.push({\n                    type: 'broken_relationship',\n                    relationship_id: relId,\n                    issue: `ÂÖ≥Á≥ªÂºïÁî®ÁöÑËäÇÁÇπ‰∏çÂ≠òÂú®`\n                });\n            }\n        }\n        \n        if (healthReport.issues.length > 0) {\n            this.emit('lineage:health_issues', healthReport);\n        }\n        \n        logger.info(`‚úÖ Ë°ÄÁºòÂÅ•Â∫∑ÁõëÊéßÂÆåÊàêÔºåÂèëÁé∞ ${healthReport.issues.length} ‰∏™ÈóÆÈ¢ò`);\n    }\n    \n    async updateImpactAnalysis() {\n        logger.info('üéØ Êõ¥Êñ∞ÂΩ±ÂìçÂàÜÊûêÁºìÂ≠ò...');\n        \n        // Ê∏ÖÁêÜËøáÊúüÁºìÂ≠ò\n        const now = Date.now();\n        for (const [key, cached] of this.impactAnalysisCache) {\n            if (now - new Date(cached.cached_at).getTime() > cached.cache_ttl) {\n                this.impactAnalysisCache.delete(key);\n            }\n        }\n        \n        logger.info(`üóëÔ∏è Ê∏ÖÁêÜ‰∫ÜËøáÊúüÁöÑÂΩ±ÂìçÂàÜÊûêÁºìÂ≠ò`);\n    }\n    \n    async updateFlowStatistics() {\n        logger.info('üìä Êõ¥Êñ∞Êï∞ÊçÆÊµÅÂêëÁªüËÆ°...');\n        \n        const statistics = {\n            timestamp: new Date().toISOString(),\n            node_statistics: {\n                by_type: {},\n                by_category: {},\n                by_owner: {}\n            },\n            relationship_statistics: {\n                by_type: {},\n                by_criticality: {},\n                by_data_quality_impact: {}\n            },\n            flow_patterns: {\n                most_connected_nodes: [],\n                critical_paths: [],\n                bottleneck_nodes: []\n            }\n        };\n        \n        // ËäÇÁÇπÁªüËÆ°\n        for (const [nodeId, node] of this.dataNodes) {\n            // ÊåâÁ±ªÂûãÁªüËÆ°\n            statistics.node_statistics.by_type[node.type] = \n                (statistics.node_statistics.by_type[node.type] || 0) + 1;\n            \n            // ÊåâÂàÜÁ±ªÁªüËÆ°\n            statistics.node_statistics.by_category[node.category] = \n                (statistics.node_statistics.by_category[node.category] || 0) + 1;\n            \n            // ÊåâÊâÄÊúâËÄÖÁªüËÆ°\n            statistics.node_statistics.by_owner[node.owner] = \n                (statistics.node_statistics.by_owner[node.owner] || 0) + 1;\n        }\n        \n        // ÂÖ≥Á≥ªÁªüËÆ°\n        for (const [relId, relationship] of this.relationships) {\n            // ÊåâÁ±ªÂûãÁªüËÆ°\n            statistics.relationship_statistics.by_type[relationship.relationship_type] = \n                (statistics.relationship_statistics.by_type[relationship.relationship_type] || 0) + 1;\n            \n            // ÊåâÂÖ≥ÈîÆÊÄßÁªüËÆ°\n            statistics.relationship_statistics.by_criticality[relationship.criticality] = \n                (statistics.relationship_statistics.by_criticality[relationship.criticality] || 0) + 1;\n            \n            // ÊåâÊï∞ÊçÆË¥®ÈáèÂΩ±ÂìçÁªüËÆ°\n            statistics.relationship_statistics.by_data_quality_impact[relationship.data_quality_impact] = \n                (statistics.relationship_statistics.by_data_quality_impact[relationship.data_quality_impact] || 0) + 1;\n        }\n        \n        this.flowStatistics.set('current', statistics);\n        \n        logger.info('üìà Êï∞ÊçÆÊµÅÂêëÁªüËÆ°Êõ¥Êñ∞ÂÆåÊàê');\n        this.emit('statistics:updated', statistics);\n    }\n    \n    // ËæÖÂä©ÊñπÊ≥ï\n    generateChangeId() {\n        return `CHG_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n    }\n    \n    generateVisualizationId() {\n        return `VIZ_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n    }\n    \n    generateReportId(type) {\n        return `${type.toUpperCase()}_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n    }\n    \n    calculateImpactScore(nodes, relationships) {\n        let score = 0;\n        \n        // ËäÇÁÇπÂΩ±ÂìçÂàÜÊï∞\n        for (const nodeData of nodes) {\n            switch (nodeData.criticality) {\n                case 'critical': score += 10; break;\n                case 'high': score += 7; break;\n                case 'medium': score += 4; break;\n                case 'low': score += 1; break;\n            }\n        }\n        \n        // ÂÖ≥Á≥ªÂΩ±ÂìçÂàÜÊï∞\n        for (const relationship of relationships) {\n            switch (relationship.data_quality_impact) {\n                case 'high': score += 5; break;\n                case 'medium': score += 3; break;\n                case 'low': score += 1; break;\n            }\n        }\n        \n        return score;\n    }\n    \n    determineCriticalityLevel(score, nodeCount) {\n        if (score > 50 || nodeCount > 10) return 'high';\n        if (score > 20 || nodeCount > 5) return 'medium';\n        return 'low';\n    }\n    \n    extractAllNodes(lineageResult) {\n        const nodes = new Map();\n        \n        // Ê∑ªÂä†Ê†πËäÇÁÇπ\n        nodes.set(lineageResult.root_node.id, lineageResult.root_node);\n        \n        // ÈÄíÂΩíÊèêÂèñÊâÄÊúâËäÇÁÇπ\n        const extractNodes = (lineageData) => {\n            for (const [nodeId, nodeData] of Object.entries(lineageData)) {\n                nodes.set(nodeId, nodeData.node);\n                if (nodeData.upstream) extractNodes(nodeData.upstream);\n                if (nodeData.downstream) extractNodes(nodeData.downstream);\n            }\n        };\n        \n        if (lineageResult.upstream_lineage) extractNodes(lineageResult.upstream_lineage);\n        if (lineageResult.downstream_lineage) extractNodes(lineageResult.downstream_lineage);\n        \n        return nodes;\n    }\n    \n    extractAllRelationships(lineageResult) {\n        const relationships = [];\n        \n        const extractRelationships = (lineageData) => {\n            for (const [nodeId, nodeData] of Object.entries(lineageData)) {\n                if (nodeData.relationship) {\n                    relationships.push(nodeData.relationship);\n                }\n                if (nodeData.upstream) extractRelationships(nodeData.upstream);\n                if (nodeData.downstream) extractRelationships(nodeData.downstream);\n            }\n        };\n        \n        if (lineageResult.upstream_lineage) extractRelationships(lineageResult.upstream_lineage);\n        if (lineageResult.downstream_lineage) extractRelationships(lineageResult.downstream_lineage);\n        \n        return relationships;\n    }\n    \n    calculateMaxDepth(lineageResult) {\n        let maxDepth = 0;\n        \n        const calculateDepth = (lineageData, currentDepth = 1) => {\n            maxDepth = Math.max(maxDepth, currentDepth);\n            for (const [nodeId, nodeData] of Object.entries(lineageData)) {\n                if (nodeData.upstream) calculateDepth(nodeData.upstream, currentDepth + 1);\n                if (nodeData.downstream) calculateDepth(nodeData.downstream, currentDepth + 1);\n            }\n        };\n        \n        if (lineageResult.upstream_lineage) calculateDepth(lineageResult.upstream_lineage);\n        if (lineageResult.downstream_lineage) calculateDepth(lineageResult.downstream_lineage);\n        \n        return maxDepth;\n    }\n    \n    countNodeTypes(nodes) {\n        const counts = {};\n        for (const [nodeId, node] of nodes) {\n            counts[node.type] = (counts[node.type] || 0) + 1;\n        }\n        return counts;\n    }\n    \n    countRelationshipTypes(relationships) {\n        const counts = {};\n        for (const relationship of relationships) {\n            counts[relationship.relationship_type] = (counts[relationship.relationship_type] || 0) + 1;\n        }\n        return counts;\n    }\n    \n    calculateNodeSize(node) {\n        // Ê†πÊçÆËäÇÁÇπÈáçË¶ÅÊÄßËÆ°ÁÆóÂ§ßÂ∞è\n        if (node.tags && node.tags.includes('critical')) return 'large';\n        if (node.tags && node.tags.includes('business_critical')) return 'medium';\n        return 'small';\n    }\n    \n    getNodeColor(nodeType) {\n        const colors = {\n            'source': '#4CAF50',\n            'process': '#2196F3',\n            'storage': '#FF9800',\n            'output': '#9C27B0',\n            'reference': '#607D8B'\n        };\n        return colors[nodeType] || '#9E9E9E';\n    }\n    \n    getEdgeColor(relationshipType) {\n        const colors = {\n            'data_flow': '#2196F3',\n            'reference': '#4CAF50',\n            'data_consumption': '#FF5722'\n        };\n        return colors[relationshipType] || '#9E9E9E';\n    }\n    \n    calculateEdgeWeight(relationship) {\n        switch (relationship.criticality) {\n            case 'critical': return 5;\n            case 'high': return 3;\n            case 'medium': return 2;\n            case 'low': return 1;\n            default: return 1;\n        }\n    }\n    \n    generateVisualizationMetadata(lineageData) {\n        return {\n            total_nodes: this.extractAllNodes(lineageData).size,\n            total_edges: this.extractAllRelationships(lineageData).length,\n            max_depth: this.calculateMaxDepth(lineageData),\n            generation_time: new Date().toISOString()\n        };\n    }\n    \n    // Êä•ÂëäÁîüÊàêÊñπÊ≥ï\n    async generateOverviewSection() {\n        return {\n            total_nodes: this.dataNodes.size,\n            total_relationships: this.relationships.size,\n            node_distribution: {\n                sources: Array.from(this.dataNodes.values()).filter(n => n.type === 'source').length,\n                processes: Array.from(this.dataNodes.values()).filter(n => n.type === 'process').length,\n                storage: Array.from(this.dataNodes.values()).filter(n => n.type === 'storage').length,\n                outputs: Array.from(this.dataNodes.values()).filter(n => n.type === 'output').length\n            },\n            health_status: 'healthy'\n        };\n    }\n    \n    async generateFlowAnalysisSection() {\n        return {\n            critical_flows: [\n                'ËÉΩÊ∫êÊï∞ÊçÆ ‚Üí Á¢≥ÊéíÊîæËÆ°ÁÆó ‚Üí ÂõΩÂÆ∂ÊåáÊ†á',\n                'Áîü‰∫ßÊï∞ÊçÆ ‚Üí ÂõΩÂÆ∂ÊåáÊ†áËÆ°ÁÆó',\n                'Á¢≥ÊéíÊîæÊï∞ÊçÆ ‚Üí Áî≥Êä•Êä•Âëä'\n            ],\n            flow_efficiency: 95,\n            bottlenecks: [],\n            optimization_opportunities: [\n                '‰ºòÂåñÁ¢≥ÊéíÊîæËÆ°ÁÆóÈ¢ëÁéá',\n                'Â¢ûÂä†Êï∞ÊçÆÁºìÂ≠òÊú∫Âà∂'\n            ]\n        };\n    }\n    \n    async generateImpactSummarySection() {\n        return {\n            high_impact_nodes: [\n                'source_ems_energy',\n                'process_carbon_calculation',\n                'storage_carbon_emissions'\n            ],\n            recent_changes: this.changeHistory.size,\n            impact_trends: 'stable'\n        };\n    }\n    \n    async generateChangeHistorySection(timeRange) {\n        const changes = Array.from(this.changeHistory.values())\n            .filter(change => {\n                const changeTime = new Date(change.timestamp);\n                const cutoffTime = new Date(Date.now() - this.parseTimeRange(timeRange));\n                return changeTime >= cutoffTime;\n            });\n        \n        return {\n            total_changes: changes.length,\n            changes_by_type: this.groupChangesByType(changes),\n            recent_changes: changes.slice(0, 10)\n        };\n    }\n    \n    async generateOptimizationSection() {\n        return {\n            recommendations: [\n                {\n                    type: 'performance',\n                    description: '‰ºòÂåñÊï∞ÊçÆË°ÄÁºòËøΩË∏™ÊÄßËÉΩ',\n                    priority: 'medium',\n                    estimated_impact: 'high'\n                },\n                {\n                    type: 'monitoring',\n                    description: 'Â¢ûÂº∫Ë°ÄÁºòÂÅ•Â∫∑ÁõëÊéß',\n                    priority: 'high',\n                    estimated_impact: 'medium'\n                },\n                {\n                    type: 'automation',\n                    description: 'Ëá™Âä®ÂåñÂΩ±ÂìçÂàÜÊûêÊµÅÁ®ã',\n                    priority: 'low',\n                    estimated_impact: 'medium'\n                }\n            ],\n            optimization_score: 85\n        };\n    }\n    \n    parseTimeRange(timeRange) {\n        const ranges = {\n            '1d': 24 * 60 * 60 * 1000,\n            '7d': 7 * 24 * 60 * 60 * 1000,\n            '30d': 30 * 24 * 60 * 60 * 1000,\n            '90d': 90 * 24 * 60 * 60 * 1000\n        };\n        return ranges[timeRange] || ranges['30d'];\n    }\n    \n    groupChangesByType(changes) {\n        const groups = {};\n        for (const change of changes) {\n            groups[change.change_type] = (groups[change.change_type] || 0) + 1;\n        }\n        return groups;\n    }\n    \n    /**\n     * ÂÅúÊ≠¢Ë°ÄÁºòËøΩË∏™ÊúçÂä°\n     */\n    async stop() {\n        logger.info('üõë ÂÅúÊ≠¢Êï∞ÊçÆË°ÄÁºòËøΩË∏™ÊúçÂä°...');\n        \n        // ÂÅúÊ≠¢ÊâÄÊúâËøΩË∏™‰ªªÂä°\n        for (const [taskName, taskId] of this.trackingTasks) {\n            clearInterval(taskId);\n            logger.info(`‚èπÔ∏è Â∑≤ÂÅúÊ≠¢‰ªªÂä°: ${taskName}`);\n        }\n        \n        this.trackingTasks.clear();\n        \n        logger.info('‚úÖ Êï∞ÊçÆË°ÄÁºòËøΩË∏™ÊúçÂä°Â∑≤ÂÅúÊ≠¢');\n        this.emit('lineage:stopped');\n    }\n    \n    /**\n     * Ëé∑ÂèñÊúçÂä°Áä∂ÊÄÅ\n     * @returns {Object} ÊúçÂä°Áä∂ÊÄÅ‰ø°ÊÅØ\n     */\n    getStatus() {\n        return {\n            service_name: 'DataLineageService',\n            status: 'running',\n            uptime: Date.now() - this.startTime,\n            statistics: {\n                total_nodes: this.dataNodes.size,\n                total_relationships: this.relationships.size,\n                cached_impact_analyses: this.impactAnalysisCache.size,\n                change_records: this.changeHistory.size,\n                active_tasks: this.trackingTasks.size\n            },\n            last_health_check: new Date().toISOString()\n        };\n    }\n}\n\nexport default DataLineageService;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/core/services/DataManager.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/core/services/DeclarationSupportSystem.js","messages":[{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.8.","line":437,"column":71,"nodeType":"Literal","messageId":"noMagic","endLine":437,"endColumn":74},{"ruleId":"object-shorthand","severity":2,"message":"Expected property shorthand.","line":760,"column":9,"nodeType":"Property","messageId":"expectedPropertyShorthand","endLine":760,"endColumn":39,"fix":{"range":[27039,27069],"text":"visualizations"}},{"ruleId":"no-unused-vars","severity":2,"message":"'reqKey' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":803,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":803,"endColumn":23},{"ruleId":"object-shorthand","severity":2,"message":"Expected property shorthand.","line":884,"column":9,"nodeType":"Property","messageId":"expectedPropertyShorthand","endLine":884,"endColumn":21,"fix":{"range":[31034,31046],"text":"score"}},{"ruleId":"object-shorthand","severity":2,"message":"Expected property shorthand.","line":886,"column":9,"nodeType":"Property","messageId":"expectedPropertyShorthand","endLine":886,"endColumn":17,"fix":{"range":[31110,31118],"text":"gap"}},{"ruleId":"no-unused-vars","severity":2,"message":"'parkId' is defined but never used. Allowed unused args must match /^_/u.","line":900,"column":48,"nodeType":"Identifier","messageId":"unusedVar","endLine":900,"endColumn":54},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.6.","line":930,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":930,"endColumn":19},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.4.","line":930,"column":22,"nodeType":"Literal","messageId":"noMagic","endLine":930,"endColumn":25},{"ruleId":"no-else-return","severity":2,"message":"Unnecessary 'else' after 'return'.","line":931,"column":14,"nodeType":"BlockStatement","messageId":"unexpected","endLine":933,"endColumn":8,"fix":{"range":[32371,33221],"text":"(indicator, actualValue) {\n    // Ê†πÊçÆÊåáÊ†áÁ±ªÂûãËÆ°ÁÆóÂæóÂàÜ\n    if (indicator.min_value !== undefined) {\n      // ÊúÄÂ∞èÂÄºÁ±ªÂûãÊåáÊ†á\n      if (actualValue >= indicator.target_value) {\n        return 1.0;\n      } else if (actualValue >= indicator.min_value) {\n        return 0.6 + 0.4 * (actualValue - indicator.min_value) / (indicator.target_value - indicator.min_value);\n      } \n        return 0.3 * actualValue / indicator.min_value;\n      \n    } else if (indicator.max_value !== undefined) {\n      // ÊúÄÂ§ßÂÄºÁ±ªÂûãÊåáÊ†á\n      if (actualValue <= indicator.target_value) {\n        return 1.0;\n      } else if (actualValue <= indicator.max_value) {\n        return 0.6 + 0.4 * (indicator.max_value - actualValue) / (indicator.max_value - indicator.target_value);\n      } else {\n        return 0.3 * indicator.max_value / actualValue;\n      }\n    }\n    \n    return 0.5; // ÈªòËÆ§ÂæóÂàÜ\n  }"}},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.3.","line":932,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":932,"endColumn":19},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.6.","line":939,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":939,"endColumn":19},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.4.","line":939,"column":22,"nodeType":"Literal","messageId":"noMagic","endLine":939,"endColumn":25},{"ruleId":"no-else-return","severity":2,"message":"Unnecessary 'else' after 'return'.","line":940,"column":14,"nodeType":"BlockStatement","messageId":"unexpected","endLine":942,"endColumn":8,"fix":{"range":[32371,33221],"text":"(indicator, actualValue) {\n    // Ê†πÊçÆÊåáÊ†áÁ±ªÂûãËÆ°ÁÆóÂæóÂàÜ\n    if (indicator.min_value !== undefined) {\n      // ÊúÄÂ∞èÂÄºÁ±ªÂûãÊåáÊ†á\n      if (actualValue >= indicator.target_value) {\n        return 1.0;\n      } else if (actualValue >= indicator.min_value) {\n        return 0.6 + 0.4 * (actualValue - indicator.min_value) / (indicator.target_value - indicator.min_value);\n      } else {\n        return 0.3 * actualValue / indicator.min_value;\n      }\n    } else if (indicator.max_value !== undefined) {\n      // ÊúÄÂ§ßÂÄºÁ±ªÂûãÊåáÊ†á\n      if (actualValue <= indicator.target_value) {\n        return 1.0;\n      } else if (actualValue <= indicator.max_value) {\n        return 0.6 + 0.4 * (indicator.max_value - actualValue) / (indicator.max_value - indicator.target_value);\n      } \n        return 0.3 * indicator.max_value / actualValue;\n      \n    }\n    \n    return 0.5; // ÈªòËÆ§ÂæóÂàÜ\n  }"}},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.3.","line":941,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":941,"endColumn":19},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.5.","line":945,"column":12,"nodeType":"Literal","messageId":"noMagic","endLine":945,"endColumn":15},{"ruleId":"prefer-template","severity":2,"message":"Unexpected string concatenation.","line":994,"column":52,"nodeType":"BinaryExpression","messageId":"unexpectedStringConcatenation","endLine":994,"endColumn":87,"fix":{"range":[34461,34496],"text":"`${processedData.park?.name  }Êô∫ËÉΩÂÖâ‰ºèÈ°πÁõÆ`"}},{"ruleId":"no-unused-vars","severity":2,"message":"'key' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":1053,"column":19,"nodeType":"Identifier","messageId":"unusedVar","endLine":1053,"endColumn":22},{"ruleId":"no-unused-vars","severity":2,"message":"'key' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":1064,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":1064,"endColumn":20},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.9.","line":1073,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":1073,"endColumn":21},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":1073,"column":23,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":1073,"endColumn":42,"fix":{"range":[36809,36828],"text":"{return 'excellent';}"}},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.8.","line":1074,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":1074,"endColumn":21},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":1074,"column":23,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":1074,"endColumn":37,"fix":{"range":[36851,36865],"text":"{return 'good';}"}},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.7.","line":1075,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":1075,"endColumn":21},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":1075,"column":23,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":1075,"endColumn":43,"fix":{"range":[36888,36908],"text":"{return 'acceptable';}"}},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.6.","line":1076,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":1076,"endColumn":21},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":1076,"column":23,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":1076,"endColumn":50,"fix":{"range":[36931,36958],"text":"{return 'needs_improvement';}"}},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.9.","line":1081,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":1081,"endColumn":21},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":1081,"column":23,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":1081,"endColumn":35,"fix":{"range":[37050,37062],"text":"{return '‰ºòÁßÄ';}"}},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.8.","line":1082,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":1082,"endColumn":21},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":1082,"column":23,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":1082,"endColumn":35,"fix":{"range":[37085,37097],"text":"{return 'ËâØÂ•Ω';}"}},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.7.","line":1083,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":1083,"endColumn":21},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":1083,"column":23,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":1083,"endColumn":35,"fix":{"range":[37120,37132],"text":"{return 'ÂêàÊ†º';}"}},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.6.","line":1084,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":1084,"endColumn":21},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":1084,"column":23,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":1084,"endColumn":37,"fix":{"range":[37155,37169],"text":"{return 'Âü∫Êú¨ÂêàÊ†º';}"}},{"ruleId":"no-unused-vars","severity":2,"message":"'parkData' is defined but never used. Allowed unused args must match /^_/u.","line":1089,"column":30,"nodeType":"Identifier","messageId":"unusedVar","endLine":1089,"endColumn":38},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.85.","line":1090,"column":12,"nodeType":"Literal","messageId":"noMagic","endLine":1090,"endColumn":16},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.1.","line":1090,"column":35,"nodeType":"Literal","messageId":"noMagic","endLine":1090,"endColumn":38},{"ruleId":"no-unused-vars","severity":2,"message":"'parkData' is defined but never used. Allowed unused args must match /^_/u.","line":1093,"column":30,"nodeType":"Identifier","messageId":"unusedVar","endLine":1093,"endColumn":38},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 3.","line":1094,"column":23,"nodeType":"Literal","messageId":"noMagic","endLine":1094,"endColumn":24},{"ruleId":"no-unused-vars","severity":2,"message":"'parkData' is defined but never used. Allowed unused args must match /^_/u.","line":1097,"column":31,"nodeType":"Identifier","messageId":"unusedVar","endLine":1097,"endColumn":39},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.88.","line":1098,"column":12,"nodeType":"Literal","messageId":"noMagic","endLine":1098,"endColumn":16},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.08.","line":1098,"column":35,"nodeType":"Literal","messageId":"noMagic","endLine":1098,"endColumn":39},{"ruleId":"no-unused-vars","severity":2,"message":"'parkData' is defined but never used. Allowed unused args must match /^_/u.","line":1101,"column":25,"nodeType":"Identifier","messageId":"unusedVar","endLine":1101,"endColumn":33},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.19.","line":1102,"column":12,"nodeType":"Literal","messageId":"noMagic","endLine":1102,"endColumn":16},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.03.","line":1102,"column":35,"nodeType":"Literal","messageId":"noMagic","endLine":1102,"endColumn":39},{"ruleId":"no-unused-vars","severity":2,"message":"'parkData' is defined but never used. Allowed unused args must match /^_/u.","line":1105,"column":28,"nodeType":"Identifier","messageId":"unusedVar","endLine":1105,"endColumn":36},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 2000.","line":1106,"column":12,"nodeType":"Literal","messageId":"noMagic","endLine":1106,"endColumn":16},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 3000.","line":1106,"column":35,"nodeType":"Literal","messageId":"noMagic","endLine":1106,"endColumn":39},{"ruleId":"no-unused-vars","severity":2,"message":"'parkData' is defined but never used. Allowed unused args must match /^_/u.","line":1109,"column":33,"nodeType":"Identifier","messageId":"unusedVar","endLine":1109,"endColumn":41},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.65.","line":1110,"column":12,"nodeType":"Literal","messageId":"noMagic","endLine":1110,"endColumn":16},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.25.","line":1110,"column":35,"nodeType":"Literal","messageId":"noMagic","endLine":1110,"endColumn":39},{"ruleId":"no-unused-vars","severity":2,"message":"'parkData' is defined but never used. Allowed unused args must match /^_/u.","line":1113,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":1113,"endColumn":24},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.08.","line":1114,"column":12,"nodeType":"Literal","messageId":"noMagic","endLine":1114,"endColumn":16},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.07.","line":1114,"column":35,"nodeType":"Literal","messageId":"noMagic","endLine":1114,"endColumn":39},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1.2.","line":1119,"column":70,"nodeType":"Literal","messageId":"noMagic","endLine":1119,"endColumn":73},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.8.","line":1122,"column":92,"nodeType":"Literal","messageId":"noMagic","endLine":1122,"endColumn":95},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.8.","line":1123,"column":63,"nodeType":"Literal","messageId":"noMagic","endLine":1123,"endColumn":66},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":1125,"column":28,"nodeType":"Literal","messageId":"noMagic","endLine":1125,"endColumn":31},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":1129,"column":97,"nodeType":"Literal","messageId":"noMagic","endLine":1129,"endColumn":99},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 800.","line":1130,"column":23,"nodeType":"Literal","messageId":"noMagic","endLine":1130,"endColumn":26},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.7.","line":1168,"column":56,"nodeType":"Literal","messageId":"noMagic","endLine":1168,"endColumn":59},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.7.","line":1196,"column":35,"nodeType":"Literal","messageId":"noMagic","endLine":1196,"endColumn":38},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.5.","line":1202,"column":45,"nodeType":"Literal","messageId":"noMagic","endLine":1202,"endColumn":48}],"suppressedMessages":[],"errorCount":25,"fatalErrorCount":0,"warningCount":38,"fixableErrorCount":14,"fixableWarningCount":0,"source":"/**\n * Áî≥Êä•È™åÊî∂ÊîØÊíëÁ≥ªÁªü\n * ÂÆûÁé∞ÂõΩÂÆ∂Ê†áÂáÜÂØπÊ†á„ÄÅÁî≥Êä•ÊùêÊñôËá™Âä®ÁîüÊàê„ÄÅÈ™åÊî∂ÊîØÊíëÁ≠âÂäüËÉΩ\n * ÊîØÊåÅ„ÄäÂÖ≥‰∫éÁªÑÁªáÂºÄÂ±ïÁ¨¨‰∫åÊâπÊô∫ËÉΩÂÖâ‰ºèËØïÁÇπÁ§∫ËåÉÁöÑÈÄöÁü•„ÄãÁ≠âÂõΩÂÆ∂ÊîøÁ≠ñË¶ÅÊ±Ç\n */\n\nimport { EventEmitter } from 'events';\nimport logger from '../../shared/utils/logger.js';\nimport { MATH_CONSTANTS } from '../../shared/constants/MathConstants.js';\n\nclass DeclarationSupportSystem extends EventEmitter {\n  constructor() {\n    super();\n    this.isInitialized = false;\n    this.nationalStandards = new Map();\n    this.declarationTemplates = new Map();\n    this.complianceChecks = new Map();\n    this.generatedDocuments = new Map();\n    this.verificationResults = new Map();\n    \n    // ÂõΩÂÆ∂Ê†áÂáÜ‰ΩìÁ≥ª\n    this.nationalStandardsFramework = {\n      // Êô∫ËÉΩÂÖâ‰ºèËØïÁÇπÁ§∫ËåÉÊ†áÂáÜ\n      intelligent_pv_standards: {\n        name: 'Êô∫ËÉΩÂÖâ‰ºèËØïÁÇπÁ§∫ËåÉÊ†áÂáÜ',\n        code: 'IPVS',\n        version: '2024.1',\n        authority: 'Â∑•‰∏öÂíå‰ø°ÊÅØÂåñÈÉ®',\n        document: 'ÂÖ≥‰∫éÁªÑÁªáÂºÄÂ±ïÁ¨¨‰∫åÊâπÊô∫ËÉΩÂÖâ‰ºèËØïÁÇπÁ§∫ËåÉÁöÑÈÄöÁü•',\n        requirements: {\n          technical_requirements: {\n            name: 'ÊäÄÊúØË¶ÅÊ±Ç',\n            categories: {\n              'TR01': {\n                name: 'Êô∫ËÉΩÂÖâ‰ºèÁ≥ªÁªüÈõÜÊàê',\n                description: 'ÂÖâ‰ºèÂèëÁîµ‰∏éÂÇ®ËÉΩ„ÄÅÂÖÖÁîµÊ°©Á≠âËÆæÊñΩÁöÑÊô∫ËÉΩÂåñÈõÜÊàê',\n                indicators: [\n                  { name: 'Á≥ªÁªüÈõÜÊàêÂ∫¶', unit: '%', min_value: 80, target_value: 95 },\n                  { name: 'Êô∫ËÉΩÂåñÊ∞¥Âπ≥', unit: 'Á∫ß', min_value: 3, target_value: 5 },\n                  { name: '‰∫íÊìç‰ΩúÊÄß', unit: '%', min_value: 90, target_value: 98 }\n                ],\n                verification_methods: ['ÊäÄÊúØÊñáÊ°£ÂÆ°Êü•', 'Áé∞Âú∫ÊµãËØï', 'Á¨¨‰∏âÊñπËÆ§ËØÅ']\n              },\n              'TR02': {\n                name: 'ËÉΩÊ∫êÁÆ°ÁêÜÊô∫ËÉΩÂåñ',\n                description: 'Âü∫‰∫éÂ§ßÊï∞ÊçÆ„ÄÅ‰∫∫Â∑•Êô∫ËÉΩÁöÑËÉΩÊ∫ê‰ºòÂåñÁÆ°ÁêÜ',\n                indicators: [\n                  { name: 'È¢ÑÊµãÂáÜÁ°ÆÁéá', unit: '%', min_value: 85, target_value: 95 },\n                  { name: '‰ºòÂåñÊïàÊûú', unit: '%', min_value: 10, target_value: 20 },\n                  { name: 'ÂìçÂ∫îÊó∂Èó¥', unit: 's', max_value: 5, target_value: 1 }\n                ],\n                verification_methods: ['ÁÆóÊ≥ïÈ™åËØÅ', 'ËøêË°åÊï∞ÊçÆÂàÜÊûê', 'ÊïàÊûúËØÑ‰º∞']\n              },\n              'TR03': {\n                name: 'Êï∞Â≠óÂåñËøêÁª¥',\n                description: 'ËÆæÂ§áÁä∂ÊÄÅÁõëÊµã„ÄÅÊïÖÈöúÈ¢ÑË≠¶„ÄÅËøúÁ®ãËøêÁª¥',\n                indicators: [\n                  { name: 'ÁõëÊµãË¶ÜÁõñÁéá', unit: '%', min_value: 95, target_value: 100 },\n                  { name: 'ÊïÖÈöúÈ¢ÑË≠¶ÂáÜÁ°ÆÁéá', unit: '%', min_value: 90, target_value: 98 },\n                  { name: 'ËøêÁª¥ÊïàÁéáÊèêÂçá', unit: '%', min_value: 30, target_value: 50 }\n                ],\n                verification_methods: ['Á≥ªÁªüÂäüËÉΩÊµãËØï', 'ËøêÁª¥ËÆ∞ÂΩïÂÆ°Êü•', 'ÊïàÁéáÂØπÊØîÂàÜÊûê']\n              }\n            }\n          },\n          performance_requirements: {\n            name: 'ÊÄßËÉΩË¶ÅÊ±Ç',\n            categories: {\n              'PR01': {\n                name: 'ÂèëÁîµÊïàÁéá',\n                description: 'ÂÖâ‰ºèÁ≥ªÁªüÂèëÁîµÊïàÁéáÂíåËÉΩÊ∫êÂà©Áî®ÊïàÁéá',\n                indicators: [\n                  { name: 'ÂÖâ‰ºèÂèëÁîµÊïàÁéá', unit: '%', min_value: 18, target_value: 22 },\n                  { name: 'Á≥ªÁªüÊïàÁéá', unit: '%', min_value: 85, target_value: 90 },\n                  { name: 'ËÉΩÊ∫êÂà©Áî®Áéá', unit: '%', min_value: 80, target_value: 90 }\n                ],\n                verification_methods: ['ÊÄßËÉΩÊµãËØï', 'Á¨¨‰∏âÊñπÊ£ÄÊµã', 'ËøêË°åÊï∞ÊçÆÁªüËÆ°']\n              },\n              'PR02': {\n                name: 'Á¢≥ÂáèÊéíÊïàÊûú',\n                description: 'Á¢≥ÊéíÊîæÂáèÂ∞ëÈáèÂíåÁ¢≥‰∏≠ÂíåË¥°ÁåÆ',\n                indicators: [\n                  { name: 'Âπ¥Á¢≥ÂáèÊéíÈáè', unit: 'tCO2', min_value: 1000, target_value: 5000 },\n                  { name: 'Á¢≥ÂáèÊéíÁéá', unit: '%', min_value: 30, target_value: 50 },\n                  { name: 'Á¢≥‰∏≠ÂíåË¥°ÁåÆÂ∫¶', unit: '%', min_value: 20, target_value: 40 }\n                ],\n                verification_methods: ['Á¢≥ÊéíÊîæÊ†∏ÁÆó', 'Á¨¨‰∏âÊñπÊ†∏Êü•', 'Á¢≥Ë∂≥ËøπÂàÜÊûê']\n              },\n              'PR03': {\n                name: 'ÁªèÊµéÊïàÁõä',\n                description: 'ÊäïËµÑÂõûÊä•ÂíåÁªèÊµéÂèØË°åÊÄß',\n                indicators: [\n                  { name: 'ÊäïËµÑÂõûÊä•Áéá', unit: '%', min_value: 8, target_value: 15 },\n                  { name: 'ÊäïËµÑÂõûÊî∂Êúü', unit: 'Âπ¥', max_value: 10, target_value: 6 },\n                  { name: 'Â∫¶ÁîµÊàêÊú¨', unit: 'ÂÖÉ/kWh', max_value: 0.4, target_value: 0.3 }\n                ],\n                verification_methods: ['Ë¥¢Âä°ÂàÜÊûê', 'ÊàêÊú¨Ê†∏ÁÆó', 'ÊïàÁõäËØÑ‰º∞']\n              }\n            }\n          },\n          innovation_requirements: {\n            name: 'ÂàõÊñ∞Ë¶ÅÊ±Ç',\n            categories: {\n              'IR01': {\n                name: 'ÊäÄÊúØÂàõÊñ∞',\n                description: 'ÂÖ≥ÈîÆÊäÄÊúØÁ™ÅÁ†¥ÂíåÂàõÊñ∞Â∫îÁî®',\n                indicators: [\n                  { name: 'ÊäÄÊúØÂàõÊñ∞ÁÇπÊï∞Èáè', unit: '‰∏™', min_value: 3, target_value: 5 },\n                  { name: '‰∏ìÂà©Áî≥ËØ∑Êï∞Èáè', unit: '‰ª∂', min_value: 5, target_value: 10 },\n                  { name: 'ÊäÄÊúØÂÖàËøõÊÄß', unit: 'Á∫ß', min_value: 3, target_value: 5 }\n                ],\n                verification_methods: ['ÊäÄÊúØËØÑÂÆ°', '‰∏ìÂà©Ê£ÄÁ¥¢', '‰∏ìÂÆ∂ËØÑ‰º∞']\n              },\n              'IR02': {\n                name: 'Ê®°ÂºèÂàõÊñ∞',\n                description: 'ÂïÜ‰∏öÊ®°ÂºèÂíåËøêËê•Ê®°ÂºèÂàõÊñ∞',\n                indicators: [\n                  { name: 'Ê®°ÂºèÂàõÊñ∞Â∫¶', unit: 'Á∫ß', min_value: 3, target_value: 5 },\n                  { name: 'ÂèØÂ§çÂà∂ÊÄß', unit: '%', min_value: 70, target_value: 90 },\n                  { name: 'Êé®Âπø‰ª∑ÂÄº', unit: 'Á∫ß', min_value: 3, target_value: 5 }\n                ],\n                verification_methods: ['Ê®°ÂºèÂàÜÊûê', 'Ê°à‰æãÁ†îÁ©∂', 'Êé®ÂπøËØÑ‰º∞']\n              }\n            }\n          },\n          demonstration_requirements: {\n            name: 'Á§∫ËåÉË¶ÅÊ±Ç',\n            categories: {\n              'DR01': {\n                name: 'Á§∫ËåÉËßÑÊ®°',\n                description: 'È°πÁõÆÂª∫ËÆæËßÑÊ®°ÂíåË¶ÜÁõñËåÉÂõ¥',\n                indicators: [\n                  { name: 'Ë£ÖÊú∫ÂÆπÈáè', unit: 'MW', min_value: 10, target_value: 50 },\n                  { name: 'Ë¶ÜÁõñÈù¢ÁßØ', unit: 'km¬≤', min_value: 1, target_value: 5 },\n                  { name: 'Áî®Êà∑Êï∞Èáè', unit: 'Êà∑', min_value: 1000, target_value: 10000 }\n                ],\n                verification_methods: ['Áé∞Âú∫Ê†∏Êü•', 'Êï∞ÊçÆÁªüËÆ°', 'Áî®Êà∑Ë∞ÉÁ†î']\n              },\n              'DR02': {\n                name: 'Á§∫ËåÉÊïàÊûú',\n                description: 'Á§∫ËåÉÂ∏¶Âä®‰ΩúÁî®ÂíåÂΩ±ÂìçÂäõ',\n                indicators: [\n                  { name: 'Á§∫ËåÉÂ∏¶Âä®ÊïàÂ∫î', unit: 'Á∫ß', min_value: 3, target_value: 5 },\n                  { name: 'Á§æ‰ºöÂΩ±ÂìçÂäõ', unit: 'Á∫ß', min_value: 3, target_value: 5 },\n                  { name: 'Êé®ÂπøÂ∫îÁî®ÊΩúÂäõ', unit: 'Á∫ß', min_value: 3, target_value: 5 }\n                ],\n                verification_methods: ['ÊïàÊûúËØÑ‰º∞', 'ÂΩ±ÂìçÂäõÂàÜÊûê', 'Êé®ÂπøË∞ÉÁ†î']\n              }\n            }\n          }\n        }\n      },\n      \n      // Èõ∂Á¢≥Âõ≠Âå∫Ê†áÂáÜ\n      zero_carbon_park_standards: {\n        name: 'Èõ∂Á¢≥Âõ≠Âå∫Ê†áÂáÜ',\n        code: 'ZCPS',\n        version: '2024.1',\n        authority: 'ÂõΩÂÆ∂ÂèëÂ±ïÊîπÈù©Âßî',\n        document: 'Èõ∂Á¢≥Âõ≠Âå∫Âª∫ËÆæÊåáÂçó',\n        requirements: {\n          carbon_neutrality: {\n            name: 'Á¢≥‰∏≠ÂíåË¶ÅÊ±Ç',\n            categories: {\n              'CN01': {\n                name: 'Á¢≥ÊéíÊîæÊ†∏ÁÆó',\n                description: 'Âõ≠Âå∫Á¢≥ÊéíÊîæÂÖ®Èù¢Ê†∏ÁÆóÂíåÁõëÊµã',\n                indicators: [\n                  { name: 'Ê†∏ÁÆóË¶ÜÁõñÁéá', unit: '%', min_value: 95, target_value: 100 },\n                  { name: 'Ê†∏ÁÆóÂáÜÁ°ÆÁéá', unit: '%', min_value: 95, target_value: 99 },\n                  { name: 'ÂÆûÊó∂ÁõëÊµãÁéá', unit: '%', min_value: 80, target_value: 95 }\n                ],\n                verification_methods: ['Ê†∏ÁÆó‰ΩìÁ≥ªÂÆ°Êü•', 'Êï∞ÊçÆË¥®ÈáèÊ£ÄÊü•', 'Á¨¨‰∏âÊñπÊ†∏Êü•']\n              },\n              'CN02': {\n                name: 'Á¢≥ÂáèÊéíÁõÆÊ†á',\n                description: 'Á¢≥ÊéíÊîæÂáèÂ∞ëÁõÆÊ†áÂíåÂÆûÁé∞Ë∑ØÂæÑ',\n                indicators: [\n                  { name: 'Á¢≥ÂáèÊéíÁéá', unit: '%', min_value: 50, target_value: 80 },\n                  { name: 'ÂèØÂÜçÁîüËÉΩÊ∫êÂç†ÊØî', unit: '%', min_value: 60, target_value: 80 },\n                  { name: 'ËÉΩÊïàÊèêÂçáÁéá', unit: '%', min_value: 20, target_value: 40 }\n                ],\n                verification_methods: ['ÁõÆÊ†áÂÆåÊàêÂ∫¶ËØÑ‰º∞', 'Ë∑ØÂæÑÂèØË°åÊÄßÂàÜÊûê', 'ËøõÂ∫¶Ë∑üË∏™']\n              }\n            }\n          },\n          energy_management: {\n            name: 'ËÉΩÊ∫êÁÆ°ÁêÜË¶ÅÊ±Ç',\n            categories: {\n              'EM01': {\n                name: 'ËÉΩÊ∫êÁªìÊûÑ‰ºòÂåñ',\n                description: 'Ê∏ÖÊ¥ÅËÉΩÊ∫êÊØî‰æãÂíåËÉΩÊ∫êÁªìÊûÑË∞ÉÊï¥',\n                indicators: [\n                  { name: 'Ê∏ÖÊ¥ÅËÉΩÊ∫êÊØî‰æã', unit: '%', min_value: 70, target_value: 90 },\n                  { name: 'ÂåñÁü≥ËÉΩÊ∫êÂáèÂ∞ëÁéá', unit: '%', min_value: 60, target_value: 80 },\n                  { name: 'ËÉΩÊ∫êËá™ÁªôÁéá', unit: '%', min_value: 50, target_value: 80 }\n                ],\n                verification_methods: ['ËÉΩÊ∫êÁªìÊûÑÂàÜÊûê', '‰æõÁªôËÉΩÂäõËØÑ‰º∞', 'Ëá™ÁªôÁéáËÆ°ÁÆó']\n              }\n            }\n          }\n        }\n      },\n      \n      // Êï∞Â≠óÂåñËΩ¨ÂûãÊ†áÂáÜ\n      digital_transformation_standards: {\n        name: 'Êï∞Â≠óÂåñËΩ¨ÂûãÊ†áÂáÜ',\n        code: 'DTS',\n        version: '2024.1',\n        authority: 'Â∑•‰∏öÂíå‰ø°ÊÅØÂåñÈÉ®',\n        document: 'Êï∞Â≠óÂåñËΩ¨ÂûãËØÑ‰º∞ÊåáÂçó',\n        requirements: {\n          digital_infrastructure: {\n            name: 'Êï∞Â≠óÂü∫Á°ÄËÆæÊñΩ',\n            categories: {\n              'DI01': {\n                name: 'Êï∞ÊçÆÈááÈõÜËÉΩÂäõ',\n                description: 'ÂÖ®Èù¢ÁöÑÊï∞ÊçÆÈááÈõÜÂíåÁõëÊµãËÉΩÂäõ',\n                indicators: [\n                  { name: 'Êï∞ÊçÆÈááÈõÜË¶ÜÁõñÁéá', unit: '%', min_value: 90, target_value: 98 },\n                  { name: 'Êï∞ÊçÆÈááÈõÜÈ¢ëÁéá', unit: 'Hz', min_value: 1, target_value: 10 },\n                  { name: 'Êï∞ÊçÆË¥®Èáè', unit: '%', min_value: 95, target_value: 99 }\n                ],\n                verification_methods: ['Á≥ªÁªüÂäüËÉΩÊµãËØï', 'Êï∞ÊçÆË¥®ÈáèËØÑ‰º∞', 'Ë¶ÜÁõñÁéáÁªüËÆ°']\n              }\n            }\n          }\n        }\n      }\n    };\n    \n    // Áî≥Êä•ÊùêÊñôÊ®°Êùø\n    this.declarationTemplateLibrary = {\n      intelligent_pv_application: {\n        name: 'Êô∫ËÉΩÂÖâ‰ºèËØïÁÇπÁ§∫ËåÉÁî≥Êä•‰π¶',\n        template_id: 'IPVA_2024',\n        sections: [\n          {\n            section_id: 'S01',\n            name: 'È°πÁõÆÂü∫Êú¨ÊÉÖÂÜµ',\n            required: true,\n            fields: [\n              { field_id: 'F01', name: 'È°πÁõÆÂêçÁß∞', type: 'text', required: true },\n              { field_id: 'F02', name: 'Áî≥Êä•Âçï‰Ωç', type: 'text', required: true },\n              { field_id: 'F03', name: 'È°πÁõÆÂú∞ÂùÄ', type: 'text', required: true },\n              { field_id: 'F04', name: 'È°πÁõÆËßÑÊ®°', type: 'number', unit: 'MW', required: true },\n              { field_id: 'F05', name: 'ÊÄªÊäïËµÑ', type: 'number', unit: '‰∏áÂÖÉ', required: true },\n              { field_id: 'F06', name: 'Âª∫ËÆæÊúü', type: 'text', required: true }\n            ]\n          },\n          {\n            section_id: 'S02',\n            name: 'ÊäÄÊúØÊñπÊ°à',\n            required: true,\n            fields: [\n              { field_id: 'F07', name: 'ÊäÄÊúØË∑ØÁ∫ø', type: 'textarea', required: true },\n              { field_id: 'F08', name: 'ÂÖ≥ÈîÆÊäÄÊúØ', type: 'textarea', required: true },\n              { field_id: 'F09', name: 'ÂàõÊñ∞ÁÇπ', type: 'textarea', required: true },\n              { field_id: 'F10', name: 'ÊäÄÊúØÊåáÊ†á', type: 'table', required: true }\n            ]\n          },\n          {\n            section_id: 'S03',\n            name: 'Âª∫ËÆæÂÜÖÂÆπ',\n            required: true,\n            fields: [\n              { field_id: 'F11', name: 'ÂÖâ‰ºèÁ≥ªÁªü', type: 'textarea', required: true },\n              { field_id: 'F12', name: 'ÂÇ®ËÉΩÁ≥ªÁªü', type: 'textarea', required: false },\n              { field_id: 'F13', name: 'Êô∫ËÉΩÁÆ°ÁêÜÁ≥ªÁªü', type: 'textarea', required: true },\n              { field_id: 'F14', name: 'ÈÖçÂ•óËÆæÊñΩ', type: 'textarea', required: false }\n            ]\n          },\n          {\n            section_id: 'S04',\n            name: 'È¢ÑÊúüÊïàÊûú',\n            required: true,\n            fields: [\n              { field_id: 'F15', name: 'ÂèëÁîµÈáè', type: 'number', unit: 'MWh/Âπ¥', required: true },\n              { field_id: 'F16', name: 'Á¢≥ÂáèÊéíÈáè', type: 'number', unit: 'tCO2/Âπ¥', required: true },\n              { field_id: 'F17', name: 'ÁªèÊµéÊïàÁõä', type: 'textarea', required: true },\n              { field_id: 'F18', name: 'Á§æ‰ºöÊïàÁõä', type: 'textarea', required: true }\n            ]\n          },\n          {\n            section_id: 'S05',\n            name: '‰øùÈöúÊé™ÊñΩ',\n            required: true,\n            fields: [\n              { field_id: 'F19', name: 'ÁªÑÁªá‰øùÈöú', type: 'textarea', required: true },\n              { field_id: 'F20', name: 'ÊäÄÊúØ‰øùÈöú', type: 'textarea', required: true },\n              { field_id: 'F21', name: 'ËµÑÈáë‰øùÈöú', type: 'textarea', required: true },\n              { field_id: 'F22', name: 'ËøêÁª¥‰øùÈöú', type: 'textarea', required: true }\n            ]\n          }\n        ],\n        attachments: [\n          { name: 'È°πÁõÆÂèØË°åÊÄßÁ†îÁ©∂Êä•Âëä', required: true, format: 'PDF' },\n          { name: 'ÊäÄÊúØÊñπÊ°àËØ¶ÁªÜËØ¥Êòé', required: true, format: 'PDF' },\n          { name: 'ÊäïËµÑÊ¶ÇÁÆó‰π¶', required: true, format: 'Excel' },\n          { name: 'ÁéØÂ¢ÉÂΩ±ÂìçËØÑ‰ª∑', required: false, format: 'PDF' },\n          { name: 'ÂúüÂú∞‰ΩøÁî®ËØÅÊòé', required: true, format: 'PDF' }\n        ]\n      },\n      \n      zero_carbon_certification: {\n        name: 'Èõ∂Á¢≥Âõ≠Âå∫ËÆ§ËØÅÁî≥ËØ∑‰π¶',\n        template_id: 'ZCCA_2024',\n        sections: [\n          {\n            section_id: 'S01',\n            name: 'Âõ≠Âå∫Âü∫Êú¨‰ø°ÊÅØ',\n            required: true,\n            fields: [\n              { field_id: 'F01', name: 'Âõ≠Âå∫ÂêçÁß∞', type: 'text', required: true },\n              { field_id: 'F02', name: 'Âõ≠Âå∫Âú∞ÂùÄ', type: 'text', required: true },\n              { field_id: 'F03', name: 'Âõ≠Âå∫Èù¢ÁßØ', type: 'number', unit: 'km¬≤', required: true },\n              { field_id: 'F04', name: 'ÂÖ•È©ª‰ºÅ‰∏öÊï∞Èáè', type: 'number', unit: 'ÂÆ∂', required: true },\n              { field_id: 'F05', name: '‰ªé‰∏ö‰∫∫Âëò', type: 'number', unit: '‰∫∫', required: true }\n            ]\n          },\n          {\n            section_id: 'S02',\n            name: 'Á¢≥ÊéíÊîæÁé∞Áä∂',\n            required: true,\n            fields: [\n              { field_id: 'F06', name: 'Âü∫ÂáÜÂπ¥Á¢≥ÊéíÊîæÈáè', type: 'number', unit: 'tCO2', required: true },\n              { field_id: 'F07', name: 'ÂΩìÂâçÁ¢≥ÊéíÊîæÈáè', type: 'number', unit: 'tCO2', required: true },\n              { field_id: 'F08', name: 'Á¢≥ÂáèÊéíÈáè', type: 'number', unit: 'tCO2', required: true },\n              { field_id: 'F09', name: 'Á¢≥ÂáèÊéíÁéá', type: 'number', unit: '%', required: true }\n            ]\n          },\n          {\n            section_id: 'S03',\n            name: 'ËÉΩÊ∫êÁªìÊûÑ',\n            required: true,\n            fields: [\n              { field_id: 'F10', name: 'ÊÄªËÉΩËÄó', type: 'number', unit: 'MWh', required: true },\n              { field_id: 'F11', name: 'ÂèØÂÜçÁîüËÉΩÊ∫êÊ∂àË¥πÈáè', type: 'number', unit: 'MWh', required: true },\n              { field_id: 'F12', name: 'ÂèØÂÜçÁîüËÉΩÊ∫êÂç†ÊØî', type: 'number', unit: '%', required: true },\n              { field_id: 'F13', name: 'ÂåñÁü≥ËÉΩÊ∫êÊ∂àË¥πÈáè', type: 'number', unit: 'MWh', required: true }\n            ]\n          }\n        ]\n      }\n    };\n    \n    this.init();\n  }\n\n  async init() {\n    try {\n      await this.loadNationalStandards();\n      await this.initializeTemplates();\n      await this.setupComplianceChecks();\n      await this.startMonitoring();\n      \n      this.isInitialized = true;\n      logger.info('Áî≥Êä•È™åÊî∂ÊîØÊíëÁ≥ªÁªüÂàùÂßãÂåñÂÆåÊàê');\n      this.emit('initialized');\n    } catch (error) {\n      logger.error('Áî≥Êä•È™åÊî∂ÊîØÊíëÁ≥ªÁªüÂàùÂßãÂåñÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * ÂõΩÂÆ∂Ê†áÂáÜÂØπÊ†áÂàÜÊûê\n   * @param {string} parkId - Âõ≠Âå∫ID\n   * @param {Array} standardCodes - Ê†áÂáÜ‰ª£Á†ÅÂàóË°®\n   * @param {Object} parkData - Âõ≠Âå∫Êï∞ÊçÆ\n   * @returns {Object} ÂØπÊ†áÂàÜÊûêÁªìÊûú\n   */\n  async performStandardCompliance(parkId, standardCodes, parkData) {\n    try {\n      const complianceId = this.generateComplianceId(parkId);\n      \n      // Ëé∑ÂèñÁõ∏ÂÖ≥Ê†áÂáÜ\n      const applicableStandards = this.getApplicableStandards(standardCodes);\n      \n      // ÊâßË°åÂØπÊ†áÂàÜÊûê\n      const complianceResults = [];\n      \n      for (const standard of applicableStandards) {\n        const result = await this.analyzeStandardCompliance(\n          standard,\n          parkData,\n          parkId\n        );\n        complianceResults.push(result);\n      }\n      \n      // ÁªºÂêàËØÑ‰º∞\n      const overallAssessment = this.calculateOverallCompliance(complianceResults);\n      \n      // Â∑ÆË∑ùÂàÜÊûê\n      const gapAnalysis = this.performGapAnalysis(complianceResults);\n      \n      // ÊîπËøõÂª∫ËÆÆ\n      const improvementRecommendations = this.generateImprovementRecommendations(\n        gapAnalysis,\n        complianceResults\n      );\n      \n      const result = {\n        compliance_id: complianceId,\n        park_id: parkId,\n        analysis_time: new Date().toISOString(),\n        \n        // Ê†áÂáÜÂØπÊ†áÁªìÊûú\n        standard_compliance: {\n          applicable_standards: applicableStandards.map(s => ({\n            code: s.code,\n            name: s.name,\n            version: s.version,\n            authority: s.authority\n          })),\n          individual_results: complianceResults,\n          overall_assessment: overallAssessment\n        },\n        \n        // Â∑ÆË∑ùÂàÜÊûê\n        gap_analysis: gapAnalysis,\n        \n        // ÊîπËøõÂª∫ËÆÆ\n        improvement_recommendations: improvementRecommendations,\n        \n        // ÂêàËßÑÁä∂ÊÄÅ\n        compliance_status: {\n          overall_score: overallAssessment.overall_score,\n          compliance_level: this.determineComplianceLevel(overallAssessment.overall_score),\n          critical_gaps: gapAnalysis.critical_gaps,\n          priority_actions: improvementRecommendations.priority_actions\n        },\n        \n        // ËÆ§ËØÅÂª∫ËÆÆ\n        certification_recommendations: {\n          ready_for_certification: overallAssessment.overall_score >= 0.8,\n          recommended_certifications: this.getRecommendedCertifications(complianceResults),\n          preparation_timeline: this.estimatePreparationTimeline(gapAnalysis),\n          success_probability: this.estimateSuccessProbability(overallAssessment)\n        },\n        \n        // ÁõëÊéßËÆ°Âàí\n        monitoring_plan: {\n          key_indicators: this.identifyKeyIndicators(complianceResults),\n          monitoring_frequency: this.determineMonitoringFrequency(complianceResults),\n          alert_thresholds: this.setAlertThresholds(complianceResults),\n          review_schedule: this.createReviewSchedule(complianceResults)\n        }\n      };\n      \n      // Â≠òÂÇ®ÂØπÊ†áÁªìÊûú\n      this.complianceChecks.set(complianceId, result);\n      \n      logger.info(`ÂõΩÂÆ∂Ê†áÂáÜÂØπÊ†áÂÆåÊàê: ${complianceId}, ÊÄª‰ΩìÂæóÂàÜ: ${overallAssessment.overall_score}`);\n      this.emit('compliance_analyzed', result);\n      \n      return result;\n    } catch (error) {\n      logger.error('ÂõΩÂÆ∂Ê†áÂáÜÂØπÊ†áÂàÜÊûêÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Ëá™Âä®ÁîüÊàêÁî≥Êä•ÊùêÊñô\n   * @param {string} templateId - Ê®°ÊùøID\n   * @param {Object} parkData - Âõ≠Âå∫Êï∞ÊçÆ\n   * @param {Object} projectData - È°πÁõÆÊï∞ÊçÆ\n   * @returns {Object} ÁîüÊàêÁöÑÁî≥Êä•ÊùêÊñô\n   */\n  async generateDeclarationDocuments(templateId, parkData, projectData) {\n    try {\n      const documentId = this.generateDocumentId(templateId);\n      \n      // Ëé∑ÂèñÁî≥Êä•Ê®°Êùø\n      const template = this.getDeclarationTemplate(templateId);\n      \n      if (!template) {\n        throw new Error(`Áî≥Êä•Ê®°Êùø‰∏çÂ≠òÂú®: ${templateId}`);\n      }\n      \n      // Êï∞ÊçÆÈ¢ÑÂ§ÑÁêÜ\n      const processedData = await this.preprocessDeclarationData(\n        parkData,\n        projectData,\n        template\n      );\n      \n      // Ëá™Âä®Â°´ÂÖÖË°®Âçï\n      const filledSections = await this.autoFillSections(\n        template.sections,\n        processedData\n      );\n      \n      // ÁîüÊàêÈôÑ‰ª∂\n      const generatedAttachments = await this.generateAttachments(\n        template.attachments,\n        processedData\n      );\n      \n      // Ë¥®ÈáèÊ£ÄÊü•\n      const qualityCheck = await this.performQualityCheck(\n        filledSections,\n        generatedAttachments,\n        template\n      );\n      \n      // ÂêàËßÑÊÄßÊ£ÄÊü•\n      const complianceCheck = await this.performDocumentComplianceCheck(\n        filledSections,\n        template\n      );\n      \n      // ÁîüÊàêÊúÄÁªàÊñáÊ°£\n      const finalDocument = await this.assembleFinalDocument(\n        template,\n        filledSections,\n        generatedAttachments,\n        processedData\n      );\n      \n      const result = {\n        document_id: documentId,\n        template_id: templateId,\n        generation_time: new Date().toISOString(),\n        \n        // Áî≥Êä•ÊñáÊ°£\n        declaration_document: {\n          template_info: {\n            name: template.name,\n            version: template.template_id,\n            sections_count: template.sections.length,\n            attachments_count: template.attachments.length\n          },\n          filled_sections: filledSections,\n          generated_attachments: generatedAttachments,\n          final_document: finalDocument\n        },\n        \n        // Êï∞ÊçÆÊù•Ê∫ê\n        data_sources: {\n          park_data_coverage: this.calculateDataCoverage(parkData, template),\n          project_data_coverage: this.calculateDataCoverage(projectData, template),\n          auto_fill_rate: this.calculateAutoFillRate(filledSections),\n          manual_input_required: this.identifyManualInputFields(filledSections)\n        },\n        \n        // Ë¥®ÈáèËØÑ‰º∞\n        quality_assessment: qualityCheck,\n        \n        // ÂêàËßÑÊÄßËØÑ‰º∞\n        compliance_assessment: complianceCheck,\n        \n        // ÂÆåÊï¥ÊÄßËØÑ‰º∞\n        completeness_assessment: {\n          overall_completeness: this.calculateOverallCompleteness(filledSections, generatedAttachments),\n          section_completeness: this.calculateSectionCompleteness(filledSections),\n          attachment_completeness: this.calculateAttachmentCompleteness(generatedAttachments),\n          missing_items: this.identifyMissingItems(filledSections, generatedAttachments, template)\n        },\n        \n        // Êèê‰∫§Âª∫ËÆÆ\n        submission_recommendations: {\n          ready_for_submission: this.isReadyForSubmission(qualityCheck, complianceCheck),\n          required_improvements: this.identifyRequiredImprovements(qualityCheck, complianceCheck),\n          optional_enhancements: this.identifyOptionalEnhancements(qualityCheck, complianceCheck),\n          submission_timeline: this.estimateSubmissionTimeline(qualityCheck, complianceCheck)\n        },\n        \n        // ÊñáÊ°£ËæìÂá∫\n        document_outputs: {\n          pdf_document: this.generatePDFDocument(finalDocument),\n          word_document: this.generateWordDocument(finalDocument),\n          excel_attachments: this.generateExcelAttachments(generatedAttachments),\n          submission_package: this.createSubmissionPackage(finalDocument, generatedAttachments)\n        }\n      };\n      \n      // Â≠òÂÇ®ÁîüÊàêÁöÑÊñáÊ°£\n      this.generatedDocuments.set(documentId, result);\n      \n      logger.info(`Áî≥Êä•ÊùêÊñôÁîüÊàêÂÆåÊàê: ${documentId}, ÂÆåÊï¥ÊÄß: ${result.completeness_assessment.overall_completeness}%`);\n      this.emit('documents_generated', result);\n      \n      return result;\n    } catch (error) {\n      logger.error('ÁîüÊàêÁî≥Êä•ÊùêÊñôÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * È™åÊî∂ÊîØÊíëÊúçÂä°\n   * @param {string} projectId - È°πÁõÆID\n   * @param {Object} verificationData - È™åÊî∂Êï∞ÊçÆ\n   * @param {Array} verificationStandards - È™åÊî∂Ê†áÂáÜ\n   * @returns {Object} È™åÊî∂ÊîØÊíëÁªìÊûú\n   */\n  async provideVerificationSupport(projectId, verificationData, verificationStandards) {\n    try {\n      const verificationId = this.generateVerificationId(projectId);\n      \n      // È™åÊî∂ÂáÜÂ§á\n      const verificationPreparation = await this.prepareVerification(\n        projectId,\n        verificationData,\n        verificationStandards\n      );\n      \n      // ÊåáÊ†áÈ™åËØÅ\n      const indicatorVerification = await this.verifyIndicators(\n        verificationData,\n        verificationStandards\n      );\n      \n      // ÊñáÊ°£È™åËØÅ\n      const documentVerification = await this.verifyDocuments(\n        verificationData.documents,\n        verificationStandards\n      );\n      \n      // Áé∞Âú∫È™åËØÅÊîØÊíë\n      const onSiteSupport = await this.prepareOnSiteVerification(\n        verificationData,\n        verificationStandards\n      );\n      \n      // Á¨¨‰∏âÊñπÈ™åËØÅÊîØÊíë\n      const thirdPartySupport = await this.prepareThirdPartyVerification(\n        verificationData,\n        verificationStandards\n      );\n      \n      // È™åÊî∂Êä•ÂëäÁîüÊàê\n      const verificationReport = await this.generateVerificationReport(\n        indicatorVerification,\n        documentVerification,\n        onSiteSupport,\n        thirdPartySupport\n      );\n      \n      const result = {\n        verification_id: verificationId,\n        project_id: projectId,\n        verification_time: new Date().toISOString(),\n        \n        // È™åÊî∂ÂáÜÂ§á\n        verification_preparation: verificationPreparation,\n        \n        // ÊåáÊ†áÈ™åËØÅ\n        indicator_verification: indicatorVerification,\n        \n        // ÊñáÊ°£È™åËØÅ\n        document_verification: documentVerification,\n        \n        // Áé∞Âú∫È™åËØÅÊîØÊíë\n        on_site_support: onSiteSupport,\n        \n        // Á¨¨‰∏âÊñπÈ™åËØÅÊîØÊíë\n        third_party_support: thirdPartySupport,\n        \n        // È™åÊî∂Êä•Âëä\n        verification_report: verificationReport,\n        \n        // È™åÊî∂ÁªìÊûú\n        verification_results: {\n          overall_score: this.calculateOverallVerificationScore(indicatorVerification, documentVerification),\n          pass_rate: this.calculatePassRate(indicatorVerification),\n          critical_issues: this.identifyCriticalIssues(indicatorVerification, documentVerification),\n          recommendations: this.generateVerificationRecommendations(indicatorVerification, documentVerification)\n        },\n        \n        // È™åÊî∂Áä∂ÊÄÅ\n        verification_status: {\n          ready_for_verification: this.isReadyForVerification(verificationPreparation),\n          verification_confidence: this.calculateVerificationConfidence(indicatorVerification),\n          success_probability: this.estimateVerificationSuccess(indicatorVerification, documentVerification),\n          risk_factors: this.identifyVerificationRisks(indicatorVerification, documentVerification)\n        },\n        \n        // ÂêéÁª≠Ë°åÂä®\n        follow_up_actions: {\n          immediate_actions: this.identifyImmediateActions(indicatorVerification, documentVerification),\n          improvement_plan: this.createImprovementPlan(indicatorVerification, documentVerification),\n          monitoring_requirements: this.defineMonitoringRequirements(verificationStandards),\n          maintenance_schedule: this.createMaintenanceSchedule(verificationStandards)\n        }\n      };\n      \n      // Â≠òÂÇ®È™åÊî∂ÁªìÊûú\n      this.verificationResults.set(verificationId, result);\n      \n      logger.info(`È™åÊî∂ÊîØÊíëÂÆåÊàê: ${verificationId}, ÊÄª‰ΩìÂæóÂàÜ: ${result.verification_results.overall_score}`);\n      this.emit('verification_completed', result);\n      \n      return result;\n    } catch (error) {\n      logger.error('È™åÊî∂ÊîØÊíëÊúçÂä°Â§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * ÁîüÊàêÂêàËßÑÊä•Âëä\n   * @param {string} parkId - Âõ≠Âå∫ID\n   * @param {Object} reportParams - Êä•ÂëäÂèÇÊï∞\n   * @returns {Object} ÂêàËßÑÊä•Âëä\n   */\n  async generateComplianceReport(parkId, reportParams) {\n    try {\n      const reportId = this.generateReportId(parkId);\n      \n      // Êî∂ÈõÜÂêàËßÑÊï∞ÊçÆ\n      const complianceData = await this.collectComplianceData(parkId, reportParams);\n      \n      // ÂàÜÊûêÂêàËßÑÁä∂ÊÄÅ\n      const complianceAnalysis = await this.analyzeComplianceStatus(complianceData);\n      \n      // ÁîüÊàêÊä•ÂëäÂÜÖÂÆπ\n      const reportContent = await this.generateReportContent(\n        complianceData,\n        complianceAnalysis,\n        reportParams\n      );\n      \n      // ÂàõÂª∫ÂèØËßÜÂåñÂõæË°®\n      const visualizations = await this.createComplianceVisualizations(\n        complianceData,\n        complianceAnalysis\n      );\n      \n      const result = {\n        report_id: reportId,\n        park_id: parkId,\n        report_time: new Date().toISOString(),\n        report_period: reportParams.period,\n        \n        // ÊâßË°åÊëòË¶Å\n        executive_summary: {\n          overall_compliance_score: complianceAnalysis.overall_score,\n          compliance_level: this.determineComplianceLevel(complianceAnalysis.overall_score),\n          key_achievements: complianceAnalysis.key_achievements,\n          major_gaps: complianceAnalysis.major_gaps,\n          recommendations: complianceAnalysis.top_recommendations\n        },\n        \n        // ËØ¶ÁªÜÂàÜÊûê\n        detailed_analysis: {\n          standard_by_standard: complianceAnalysis.standard_analysis,\n          indicator_performance: complianceAnalysis.indicator_performance,\n          trend_analysis: complianceAnalysis.trend_analysis,\n          benchmark_comparison: complianceAnalysis.benchmark_comparison\n        },\n        \n        // Êä•ÂëäÂÜÖÂÆπ\n        report_content: reportContent,\n        \n        // ÂèØËßÜÂåñÂõæË°®\n        visualizations: visualizations,\n        \n        // ÊîπËøõËÆ°Âàí\n        improvement_plan: {\n          priority_actions: complianceAnalysis.priority_actions,\n          implementation_timeline: complianceAnalysis.implementation_timeline,\n          resource_requirements: complianceAnalysis.resource_requirements,\n          expected_outcomes: complianceAnalysis.expected_outcomes\n        },\n        \n        // ÁõëÊéßÂª∫ËÆÆ\n        monitoring_recommendations: {\n          key_metrics: complianceAnalysis.key_metrics,\n          monitoring_frequency: complianceAnalysis.monitoring_frequency,\n          alert_mechanisms: complianceAnalysis.alert_mechanisms,\n          review_schedule: complianceAnalysis.review_schedule\n        }\n      };\n      \n      logger.info(`ÂêàËßÑÊä•ÂëäÁîüÊàêÂÆåÊàê: ${reportId}`);\n      this.emit('compliance_report_generated', result);\n      \n      return result;\n    } catch (error) {\n      logger.error('ÁîüÊàêÂêàËßÑÊä•ÂëäÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  // Ê†áÂáÜÂØπÊ†áÂàÜÊûêÊñπÊ≥ï\n  async analyzeStandardCompliance(standard, parkData, parkId) {\n    const complianceResult = {\n      standard_code: standard.code,\n      standard_name: standard.name,\n      compliance_score: 0,\n      category_results: [],\n      overall_status: 'non_compliant'\n    };\n    \n    let totalScore = 0;\n    let totalWeight = 0;\n    \n    // ÈÅçÂéÜÊ†áÂáÜË¶ÅÊ±ÇÁöÑÂêÑ‰∏™Á±ªÂà´\n    for (const [reqKey, requirement] of Object.entries(standard.requirements)) {\n      const categoryResult = {\n        requirement_name: requirement.name,\n        categories: [],\n        category_score: 0\n      };\n      \n      let categoryTotalScore = 0;\n      let categoryTotalWeight = 0;\n      \n      // ÈÅçÂéÜÁ±ªÂà´‰∏ãÁöÑÂÖ∑‰ΩìË¶ÅÊ±Ç\n      for (const [catKey, category] of Object.entries(requirement.categories)) {\n        const indicatorResults = [];\n        let indicatorTotalScore = 0;\n        \n        // ËØÑ‰º∞ÂêÑÈ°πÊåáÊ†á\n        for (const indicator of category.indicators) {\n          const indicatorResult = await this.evaluateIndicator(\n            indicator,\n            parkData,\n            parkId\n          );\n          indicatorResults.push(indicatorResult);\n          indicatorTotalScore += indicatorResult.score;\n        }\n        \n        const avgIndicatorScore = indicatorTotalScore / category.indicators.length;\n        \n        categoryResult.categories.push({\n          category_code: catKey,\n          category_name: category.name,\n          description: category.description,\n          indicator_results: indicatorResults,\n          category_score: avgIndicatorScore,\n          compliance_status: this.determineComplianceStatus(avgIndicatorScore)\n        });\n        \n        categoryTotalScore += avgIndicatorScore;\n        categoryTotalWeight += 1;\n      }\n      \n      categoryResult.category_score = categoryTotalScore / categoryTotalWeight;\n      complianceResult.category_results.push(categoryResult);\n      \n      totalScore += categoryResult.category_score;\n      totalWeight += 1;\n    }\n    \n    complianceResult.compliance_score = totalScore / totalWeight;\n    complianceResult.overall_status = this.determineComplianceStatus(complianceResult.compliance_score);\n    \n    return complianceResult;\n  }\n\n  async evaluateIndicator(indicator, parkData, parkId) {\n    try {\n      // ‰ªéÂõ≠Âå∫Êï∞ÊçÆ‰∏≠Ëé∑ÂèñÊåáÊ†áÂÄº\n      const actualValue = await this.getIndicatorValue(indicator, parkData, parkId);\n      \n      if (actualValue === null || actualValue === undefined) {\n        return {\n          indicator_name: indicator.name,\n          target_value: indicator.target_value || indicator.min_value,\n          actual_value: null,\n          score: 0,\n          status: 'no_data',\n          gap: null\n        };\n      }\n      \n      // ËÆ°ÁÆóÊåáÊ†áÂæóÂàÜ\n      const score = this.calculateIndicatorScore(indicator, actualValue);\n      \n      // ËÆ°ÁÆóÂ∑ÆË∑ù\n      const gap = this.calculateIndicatorGap(indicator, actualValue);\n      \n      return {\n        indicator_name: indicator.name,\n        unit: indicator.unit,\n        target_value: indicator.target_value || indicator.min_value,\n        actual_value: actualValue,\n        score: score,\n        status: this.determineIndicatorStatus(score),\n        gap: gap,\n        improvement_potential: this.calculateImprovementPotential(indicator, actualValue)\n      };\n    } catch (error) {\n      logger.error(`ÊåáÊ†áËØÑ‰º∞Â§±Ë¥•: ${indicator.name}`, error);\n      return {\n        indicator_name: indicator.name,\n        score: 0,\n        status: 'error',\n        error: error.message\n      };\n    }\n  }\n\n  async getIndicatorValue(indicator, parkData, parkId) {\n    // Ê†πÊçÆÊåáÊ†áÂêçÁß∞‰ªéÂõ≠Âå∫Êï∞ÊçÆ‰∏≠ÊèêÂèñÁõ∏Â∫îÁöÑÂÄº\n    const indicatorMappings = {\n      'Á≥ªÁªüÈõÜÊàêÂ∫¶': () => this.calculateSystemIntegration(parkData),\n      'Êô∫ËÉΩÂåñÊ∞¥Âπ≥': () => this.calculateIntelligenceLevel(parkData),\n      'È¢ÑÊµãÂáÜÁ°ÆÁéá': () => this.calculatePredictionAccuracy(parkData),\n      'ÂÖâ‰ºèÂèëÁîµÊïàÁéá': () => this.calculatePVEfficiency(parkData),\n      'Á¢≥ÂáèÊéíÈáè': () => this.calculateCarbonReduction(parkData),\n      'ÂèØÂÜçÁîüËÉΩÊ∫êÂç†ÊØî': () => this.calculateRenewableEnergyRatio(parkData),\n      'ÊäïËµÑÂõûÊä•Áéá': () => this.calculateROI(parkData),\n      'Ê†∏ÁÆóË¶ÜÁõñÁéá': () => this.calculateAccountingCoverage(parkData),\n      'Êï∞ÊçÆÈááÈõÜË¶ÜÁõñÁéá': () => this.calculateDataCollectionCoverage(parkData)\n    };\n    \n    const calculator = indicatorMappings[indicator.name];\n    if (calculator) {\n      return await calculator();\n    }\n    \n    // Â¶ÇÊûúÊ≤°ÊúâÊâæÂà∞ÂØπÂ∫îÁöÑËÆ°ÁÆóÊñπÊ≥ïÔºåËøîÂõûÊ®°ÊãüÂÄº\n    return this.generateSimulatedValue(indicator);\n  }\n\n  calculateIndicatorScore(indicator, actualValue) {\n    // Ê†πÊçÆÊåáÊ†áÁ±ªÂûãËÆ°ÁÆóÂæóÂàÜ\n    if (indicator.min_value !== undefined) {\n      // ÊúÄÂ∞èÂÄºÁ±ªÂûãÊåáÊ†á\n      if (actualValue >= indicator.target_value) {\n        return 1.0;\n      } else if (actualValue >= indicator.min_value) {\n        return 0.6 + 0.4 * (actualValue - indicator.min_value) / (indicator.target_value - indicator.min_value);\n      } else {\n        return 0.3 * actualValue / indicator.min_value;\n      }\n    } else if (indicator.max_value !== undefined) {\n      // ÊúÄÂ§ßÂÄºÁ±ªÂûãÊåáÊ†á\n      if (actualValue <= indicator.target_value) {\n        return 1.0;\n      } else if (actualValue <= indicator.max_value) {\n        return 0.6 + 0.4 * (indicator.max_value - actualValue) / (indicator.max_value - indicator.target_value);\n      } else {\n        return 0.3 * indicator.max_value / actualValue;\n      }\n    }\n    \n    return 0.5; // ÈªòËÆ§ÂæóÂàÜ\n  }\n\n  // Áî≥Êä•ÊùêÊñôÁîüÊàêÊñπÊ≥ï\n  async autoFillSections(sections, processedData) {\n    const filledSections = [];\n    \n    for (const section of sections) {\n      const filledSection = {\n        section_id: section.section_id,\n        name: section.name,\n        required: section.required,\n        fields: [],\n        completion_rate: 0\n      };\n      \n      let filledFields = 0;\n      \n      for (const field of section.fields) {\n        const filledField = await this.autoFillField(field, processedData);\n        filledSection.fields.push(filledField);\n        \n        if (filledField.value !== null && filledField.value !== '') {\n          filledFields++;\n        }\n      }\n      \n      filledSection.completion_rate = filledFields / section.fields.length;\n      filledSections.push(filledSection);\n    }\n    \n    return filledSections;\n  }\n\n  async autoFillField(field, processedData) {\n    const filledField = {\n      field_id: field.field_id,\n      name: field.name,\n      type: field.type,\n      unit: field.unit,\n      required: field.required,\n      value: null,\n      auto_filled: false,\n      confidence: 0,\n      data_source: null\n    };\n    \n    // Ê†πÊçÆÂ≠óÊÆµÂêçÁß∞Ëá™Âä®Â°´ÂÖÖ\n    const fieldMappings = {\n      'È°πÁõÆÂêçÁß∞': () => processedData.project?.name || processedData.park?.name + 'Êô∫ËÉΩÂÖâ‰ºèÈ°πÁõÆ',\n      'Áî≥Êä•Âçï‰Ωç': () => processedData.organization?.name,\n      'È°πÁõÆÂú∞ÂùÄ': () => processedData.project?.address || processedData.park?.address,\n      'È°πÁõÆËßÑÊ®°': () => processedData.project?.capacity || processedData.energy?.total_capacity,\n      'ÊÄªÊäïËµÑ': () => processedData.project?.investment || this.estimateInvestment(processedData),\n      'ÂèëÁîµÈáè': () => processedData.energy?.annual_generation,\n      'Á¢≥ÂáèÊéíÈáè': () => processedData.carbon?.annual_reduction,\n      'Âõ≠Âå∫ÂêçÁß∞': () => processedData.park?.name,\n      'Âõ≠Âå∫Èù¢ÁßØ': () => processedData.park?.area,\n      'ÊÄªËÉΩËÄó': () => processedData.energy?.total_consumption,\n      'ÂèØÂÜçÁîüËÉΩÊ∫êÂç†ÊØî': () => processedData.energy?.renewable_ratio\n    };\n    \n    const filler = fieldMappings[field.name];\n    if (filler) {\n      try {\n        const value = await filler();\n        if (value !== null && value !== undefined) {\n          filledField.value = value;\n          filledField.auto_filled = true;\n          filledField.confidence = 0.9;\n          filledField.data_source = 'park_data';\n        }\n      } catch (error) {\n        logger.error(`Â≠óÊÆµËá™Âä®Â°´ÂÖÖÂ§±Ë¥•: ${field.name}`, error);\n      }\n    }\n    \n    // Â¶ÇÊûúÊó†Ê≥ïËá™Âä®Â°´ÂÖÖÔºåËÆæÁΩÆÈªòËÆ§ÂÄºÊàñÊèêÁ§∫\n    if (filledField.value === null) {\n      if (field.required) {\n        filledField.value = `[ËØ∑Â°´ÂÜô${field.name}]`;\n        filledField.confidence = 0;\n      }\n    }\n    \n    return filledField;\n  }\n\n  // ËæÖÂä©ÊñπÊ≥ï\n  generateComplianceId(parkId) {\n    return `COMP_${parkId}_${Date.now()}`;\n  }\n\n  generateDocumentId(templateId) {\n    return `DOC_${templateId}_${Date.now()}`;\n  }\n\n  generateVerificationId(projectId) {\n    return `VER_${projectId}_${Date.now()}`;\n  }\n\n  generateReportId(parkId) {\n    return `RPT_${parkId}_${Date.now()}`;\n  }\n\n  getApplicableStandards(standardCodes) {\n    const standards = [];\n    for (const code of standardCodes) {\n      for (const [key, standard] of Object.entries(this.nationalStandardsFramework)) {\n        if (standard.code === code) {\n          standards.push(standard);\n          break;\n        }\n      }\n    }\n    return standards;\n  }\n\n  getDeclarationTemplate(templateId) {\n    for (const [key, template] of Object.entries(this.declarationTemplateLibrary)) {\n      if (template.template_id === templateId) {\n        return template;\n      }\n    }\n    return null;\n  }\n\n  determineComplianceStatus(score) {\n    if (score >= 0.9) return 'excellent';\n    if (score >= 0.8) return 'good';\n    if (score >= 0.7) return 'acceptable';\n    if (score >= 0.6) return 'needs_improvement';\n    return 'non_compliant';\n  }\n\n  determineComplianceLevel(score) {\n    if (score >= 0.9) return '‰ºòÁßÄ';\n    if (score >= 0.8) return 'ËâØÂ•Ω';\n    if (score >= 0.7) return 'ÂêàÊ†º';\n    if (score >= 0.6) return 'Âü∫Êú¨ÂêàÊ†º';\n    return '‰∏çÂêàÊ†º';\n  }\n\n  // Ê®°ÊãüËÆ°ÁÆóÊñπÊ≥ï\n  calculateSystemIntegration(parkData) {\n    return 0.85 + Math.random() * 0.1;\n  }\n\n  calculateIntelligenceLevel(parkData) {\n    return Math.floor(3 + Math.random() * 2);\n  }\n\n  calculatePredictionAccuracy(parkData) {\n    return 0.88 + Math.random() * 0.08;\n  }\n\n  calculatePVEfficiency(parkData) {\n    return 0.19 + Math.random() * 0.03;\n  }\n\n  calculateCarbonReduction(parkData) {\n    return 2000 + Math.random() * 3000;\n  }\n\n  calculateRenewableEnergyRatio(parkData) {\n    return 0.65 + Math.random() * 0.25;\n  }\n\n  calculateROI(parkData) {\n    return 0.08 + Math.random() * 0.07;\n  }\n\n  generateSimulatedValue(indicator) {\n    if (indicator.min_value !== undefined) {\n      const range = (indicator.target_value || indicator.min_value * 1.2) - indicator.min_value;\n      return indicator.min_value + Math.random() * range;\n    } else if (indicator.max_value !== undefined) {\n      const range = indicator.max_value - (indicator.target_value || indicator.max_value * 0.8);\n      return (indicator.target_value || indicator.max_value * 0.8) + Math.random() * range;\n    }\n    return Math.random() * 100;\n  }\n\n  estimateInvestment(processedData) {\n    const capacity = processedData.project?.capacity || processedData.energy?.total_capacity || 10;\n    return capacity * 800; // ÂÅáËÆæÊØèMWÊäïËµÑ800‰∏áÂÖÉ\n  }\n\n  // ÂàùÂßãÂåñÊñπÊ≥ï\n  async loadNationalStandards() {\n    Object.keys(this.nationalStandardsFramework).forEach(key => {\n      this.nationalStandards.set(key, this.nationalStandardsFramework[key]);\n    });\n    logger.info('ÂõΩÂÆ∂Ê†áÂáÜÂä†ËΩΩÂÆåÊàê');\n  }\n\n  async initializeTemplates() {\n    Object.keys(this.declarationTemplateLibrary).forEach(key => {\n      this.declarationTemplates.set(key, this.declarationTemplateLibrary[key]);\n    });\n    logger.info('Áî≥Êä•Ê®°ÊùøÂàùÂßãÂåñÂÆåÊàê');\n  }\n\n  async setupComplianceChecks() {\n    logger.info('ÂêàËßÑÊ£ÄÊü•ËÆæÁΩÆÂÆåÊàê');\n  }\n\n  async startMonitoring() {\n    // ÂêØÂä®ÂÆöÊúüÁõëÊéß\n    setInterval(async () => {\n      try {\n        await this.monitorCompliance();\n      } catch (error) {\n        logger.error('ÂêàËßÑÁõëÊéßÂ§±Ë¥•:', error);\n      }\n    }, MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.MILLISECONDS_PER_SECOND);\n    \n    logger.info('Áî≥Êä•È™åÊî∂ÁõëÊéßÂêØÂä®ÂÆåÊàê');\n  }\n\n  async monitorCompliance() {\n    // ÁõëÊéßÂêàËßÑÁä∂ÊÄÅ\n    for (const [id, compliance] of this.complianceChecks) {\n      if (compliance.compliance_status.overall_score < 0.7) {\n        this.emit('compliance_alert', {\n          compliance_id: id,\n          score: compliance.compliance_status.overall_score,\n          critical_gaps: compliance.gap_analysis.critical_gaps\n        });\n      }\n    }\n  }\n\n  // ÂÖ∂‰ªñÁÆÄÂåñÂÆûÁé∞ÊñπÊ≥ï\n  calculateOverallCompliance(results) {\n    const totalScore = results.reduce((sum, result) => sum + result.compliance_score, 0);\n    return {\n      overall_score: totalScore / results.length,\n      individual_scores: results.map(r => ({\n        standard: r.standard_name,\n        score: r.compliance_score\n      }))\n    };\n  }\n\n  performGapAnalysis(results) {\n    const gaps = [];\n    results.forEach(result => {\n      result.category_results.forEach(category => {\n        category.categories.forEach(cat => {\n          cat.indicator_results.forEach(indicator => {\n            if (indicator.score < 0.7) {\n              gaps.push({\n                standard: result.standard_name,\n                category: cat.category_name,\n                indicator: indicator.indicator_name,\n                gap_size: indicator.gap,\n                priority: indicator.score < 0.5 ? 'high' : 'medium'\n              });\n            }\n          });\n        });\n      });\n    });\n    \n    return {\n      total_gaps: gaps.length,\n      critical_gaps: gaps.filter(g => g.priority === 'high'),\n      gaps_by_standard: this.groupGapsByStandard(gaps),\n      improvement_priority: gaps.sort((a, b) => a.gap_size - b.gap_size)\n    };\n  }\n\n  groupGapsByStandard(gaps) {\n    const grouped = {};\n    gaps.forEach(gap => {\n      if (!grouped[gap.standard]) {\n        grouped[gap.standard] = [];\n      }\n      grouped[gap.standard].push(gap);\n    });\n    return grouped;\n  }\n}\n\nexport default DeclarationSupportSystem;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/core/services/EnergyAnalytics.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/core/services/EnergyFlowVisualization.js","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'ENERGY_CONSTANTS' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":26},{"ruleId":"object-shorthand","severity":2,"message":"Expected property shorthand.","line":165,"column":9,"nodeType":"Property","messageId":"expectedPropertyShorthand","endLine":165,"endColumn":27,"fix":{"range":[4972,4990],"text":"topology"}},{"ruleId":"object-shorthand","severity":2,"message":"Expected property shorthand.","line":167,"column":9,"nodeType":"Property","messageId":"expectedPropertyShorthand","endLine":167,"endColumn":31,"fix":{"range":[5033,5055],"text":"statistics"}},{"ruleId":"object-shorthand","severity":2,"message":"Expected property shorthand.","line":244,"column":7,"nodeType":"Property","messageId":"expectedPropertyShorthand","endLine":244,"endColumn":19,"fix":{"range":[7340,7352],"text":"nodes"}},{"ruleId":"object-shorthand","severity":2,"message":"Expected property shorthand.","line":245,"column":7,"nodeType":"Property","messageId":"expectedPropertyShorthand","endLine":245,"endColumn":19,"fix":{"range":[7360,7372],"text":"links"}},{"ruleId":"object-shorthand","severity":2,"message":"Expected property shorthand.","line":351,"column":7,"nodeType":"Property","messageId":"expectedPropertyShorthand","endLine":351,"endColumn":19,"fix":{"range":[10061,10073],"text":"nodes"}},{"ruleId":"object-shorthand","severity":2,"message":"Expected property shorthand.","line":352,"column":7,"nodeType":"Property","messageId":"expectedPropertyShorthand","endLine":352,"endColumn":19,"fix":{"range":[10081,10093],"text":"links"}},{"ruleId":"object-shorthand","severity":2,"message":"Expected property shorthand.","line":353,"column":7,"nodeType":"Property","messageId":"expectedPropertyShorthand","endLine":353,"endColumn":21,"fix":{"range":[10101,10115],"text":"layers"}},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":487,"column":38,"nodeType":"Literal","messageId":"noMagic","endLine":487,"endColumn":41},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":488,"column":38,"nodeType":"Literal","messageId":"noMagic","endLine":488,"endColumn":41},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":496,"column":17,"nodeType":"Literal","messageId":"noMagic","endLine":496,"endColumn":21},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":496,"column":23,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":496,"endColumn":40,"fix":{"range":[14050,14067],"text":"{return '#FF0000';}"}},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":497,"column":17,"nodeType":"Literal","messageId":"noMagic","endLine":497,"endColumn":20},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":497,"column":22,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":497,"endColumn":39,"fix":{"range":[14099,14116],"text":"{return '#FF8C00';}"}},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":498,"column":17,"nodeType":"Literal","messageId":"noMagic","endLine":498,"endColumn":20},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":498,"column":22,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":498,"endColumn":39,"fix":{"range":[14149,14166],"text":"{return '#FFD700';}"}},{"ruleId":"no-unused-vars","severity":2,"message":"'parkId' is defined but never used. Allowed unused args must match /^_/u.","line":544,"column":29,"nodeType":"Identifier","messageId":"unusedVar","endLine":544,"endColumn":35},{"ruleId":"no-unused-vars","severity":2,"message":"'timeRange' is defined but never used. Allowed unused args must match /^_/u.","line":544,"column":37,"nodeType":"Identifier","messageId":"unusedVar","endLine":544,"endColumn":46},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 800.","line":550,"column":32,"nodeType":"Literal","messageId":"noMagic","endLine":550,"endColumn":35},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":551,"column":33,"nodeType":"Literal","messageId":"noMagic","endLine":551,"endColumn":37},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1500.","line":559,"column":32,"nodeType":"Literal","messageId":"noMagic","endLine":559,"endColumn":36},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 2000.","line":560,"column":33,"nodeType":"Literal","messageId":"noMagic","endLine":560,"endColumn":37}],"suppressedMessages":[],"errorCount":13,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":10,"fixableWarningCount":0,"source":"/**\n * Âõ≠Âå∫ËÉΩÊµÅÂÖ®ÊôØÂõæÊûÑÂª∫Ê®°Âùó\n * ÊûÑÂª∫\"Ê∫ê-ÁΩë-Ëç∑-ÂÇ®\"ÂÖ®ÁéØËäÇÂä®ÊÄÅËÉΩÊ∫êÊµÅÂêëÂõæ\n * ÂÆûÁé∞Ê°ëÂü∫Âõæ(Sankey Diagram)ÂèØËßÜÂåñÂ±ïÁ§∫\n */\n\nimport { EventEmitter } from 'events';\nimport logger from '../../shared/utils/logger.js';\nimport { ENERGY_CONSTANTS, MATH_CONSTANTS } from '../../shared/constants/MathConstants.js';\n\nclass EnergyFlowVisualization extends EventEmitter {\n  constructor() {\n    super();\n    this.isInitialized = false;\n    this.energySources = new Map(); // Ê∫ê\n    this.energyGrid = new Map(); // ÁΩë\n    this.energyLoads = new Map(); // Ëç∑\n    this.energyStorage = new Map(); // ÂÇ®\n    this.flowData = new Map();\n    this.realTimeFlows = new Map();\n    this.sankeyData = null;\n    \n    // ËÉΩÊ∫êÊµÅÂêëÈÖçÁΩÆ\n    this.flowConfig = {\n      // ËÉΩÊ∫êÊ∫êÂ§¥Á±ªÂûã\n      sources: {\n        solar_pv: { name: 'ÂÖâ‰ºèÂèëÁîµ', color: '#FFD700', icon: '‚òÄÔ∏è' },\n        wind: { name: 'È£éÂäõÂèëÁîµ', color: '#87CEEB', icon: 'üí®' },\n        hydro: { name: 'Ê∞¥ÂäõÂèëÁîµ', color: '#4682B4', icon: 'üíß' },\n        grid: { name: 'ÁîµÁΩë‰æõÁîµ', color: '#808080', icon: '‚ö°' },\n        natural_gas: { name: 'Â§©ÁÑ∂Ê∞î', color: '#FF6347', icon: 'üî•' },\n        biomass: { name: 'ÁîüÁâ©Ë¥®ËÉΩ', color: '#228B22', icon: 'üå±' }\n      },\n      // ÁîµÁΩëËäÇÁÇπÁ±ªÂûã\n      grid_nodes: {\n        main_transformer: { name: '‰∏ªÂèòÂéãÂô®', color: '#4169E1', icon: 'üîå' },\n        distribution_panel: { name: 'ÈÖçÁîµÊüú', color: '#6495ED', icon: 'üì¶' },\n        smart_meter: { name: 'Êô∫ËÉΩÁîµË°®', color: '#00CED1', icon: 'üìä' }\n      },\n      // Ë¥üËç∑Á±ªÂûã\n      loads: {\n        industrial: { name: 'Â∑•‰∏öË¥üËç∑', color: '#B22222', icon: 'üè≠' },\n        commercial: { name: 'ÂïÜ‰∏öË¥üËç∑', color: '#FF8C00', icon: 'üè¢' },\n        residential: { name: 'Â±ÖÊ∞ëË¥üËç∑', color: '#32CD32', icon: 'üè†' },\n        public: { name: 'ÂÖ¨ÂÖ±ËÆæÊñΩ', color: '#9370DB', icon: 'üèõÔ∏è' },\n        ev_charging: { name: 'ÂÖÖÁîµÊ°©', color: '#FF1493', icon: 'üöó' }\n      },\n      // ÂÇ®ËÉΩÁ±ªÂûã\n      storage: {\n        battery: { name: 'ÁîµÊ±†ÂÇ®ËÉΩ', color: '#FF4500', icon: 'üîã' },\n        pumped_hydro: { name: 'ÊäΩÊ∞¥ËìÑËÉΩ', color: '#1E90FF', icon: '‚õ≤' },\n        compressed_air: { name: 'ÂéãÁº©Á©∫Ê∞î', color: '#708090', icon: 'üí®' },\n        flywheel: { name: 'È£ûËΩÆÂÇ®ËÉΩ', color: '#8A2BE2', icon: '‚öôÔ∏è' }\n      }\n    };\n    \n    this.init();\n  }\n\n  async init() {\n    try {\n      await this.loadEnergyInfrastructure();\n      await this.setupRealTimeMonitoring();\n      this.isInitialized = true;\n      logger.info('Âõ≠Âå∫ËÉΩÊµÅÂÖ®ÊôØÂõæÊûÑÂª∫Ê®°ÂùóÂàùÂßãÂåñÂÆåÊàê');\n      this.emit('initialized');\n    } catch (error) {\n      logger.error('ËÉΩÊµÅÂÖ®ÊôØÂõæÊ®°ÂùóÂàùÂßãÂåñÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Âä†ËΩΩËÉΩÊ∫êÂü∫Á°ÄËÆæÊñΩÊï∞ÊçÆ\n   */\n  async loadEnergyInfrastructure() {\n    try {\n      // Âä†ËΩΩËÉΩÊ∫êÊ∫êÂ§¥ËÆæÂ§á\n      const sources = await this.getEnergySourceDevices();\n      sources.forEach(source => {\n        this.energySources.set(source.id, {\n          ...source,\n          type: 'source',\n          config: this.flowConfig.sources[source.energy_type] || {}\n        });\n      });\n\n      // Âä†ËΩΩÁîµÁΩëËÆæÂ§á\n      const gridDevices = await this.getGridDevices();\n      gridDevices.forEach(device => {\n        this.energyGrid.set(device.id, {\n          ...device,\n          type: 'grid',\n          config: this.flowConfig.grid_nodes[device.device_type] || {}\n        });\n      });\n\n      // Âä†ËΩΩË¥üËç∑ËÆæÂ§á\n      const loads = await this.getLoadDevices();\n      loads.forEach(load => {\n        this.energyLoads.set(load.id, {\n          ...load,\n          type: 'load',\n          config: this.flowConfig.loads[load.load_type] || {}\n        });\n      });\n\n      // Âä†ËΩΩÂÇ®ËÉΩËÆæÂ§á\n      const storageDevices = await this.getStorageDevices();\n      storageDevices.forEach(storage => {\n        this.energyStorage.set(storage.id, {\n          ...storage,\n          type: 'storage',\n          config: this.flowConfig.storage[storage.storage_type] || {}\n        });\n      });\n\n      logger.info(`Â∑≤Âä†ËΩΩËÉΩÊ∫êÂü∫Á°ÄËÆæÊñΩ: Ê∫ê${this.energySources.size}‰∏™, ÁΩë${this.energyGrid.size}‰∏™, Ëç∑${this.energyLoads.size}‰∏™, ÂÇ®${this.energyStorage.size}‰∏™`);\n    } catch (error) {\n      logger.error('Âä†ËΩΩËÉΩÊ∫êÂü∫Á°ÄËÆæÊñΩÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * ËÆæÁΩÆÂÆûÊó∂ÁõëÊéß\n   */\n  async setupRealTimeMonitoring() {\n    // ÊØè30ÁßíÊõ¥Êñ∞‰∏ÄÊ¨°ËÉΩÊµÅÊï∞ÊçÆ\n    setInterval(async () => {\n      try {\n        await this.updateRealTimeFlows();\n        await this.generateSankeyDiagram();\n        this.emit('flow_updated', this.sankeyData);\n      } catch (error) {\n        logger.error('Êõ¥Êñ∞ÂÆûÊó∂ËÉΩÊµÅÊï∞ÊçÆÂ§±Ë¥•:', error);\n      }\n    }, MATH_CONSTANTS.THIRTY * MATH_CONSTANTS.MILLISECONDS_PER_SECOND);\n  }\n\n  /**\n   * ÁîüÊàêÂõ≠Âå∫ËÉΩÊµÅÂÖ®ÊôØÂõæÊï∞ÊçÆ\n   * @param {string} parkId - Âõ≠Âå∫ID\n   * @param {string} timeRange - Êó∂Èó¥ËåÉÂõ¥\n   * @returns {Object} ËÉΩÊµÅÂÖ®ÊôØÂõæÊï∞ÊçÆ\n   */\n  async generateEnergyFlowMap(parkId, timeRange = '1h') {\n    try {\n      // Ëé∑ÂèñÂÆûÊó∂ËÉΩÊµÅÊï∞ÊçÆ\n      const flowData = await this.getRealTimeFlowData(parkId, timeRange);\n      \n      // ÊûÑÂª∫ËÉΩÊµÅÊãìÊâëÂõæ\n      const topology = this.buildEnergyTopology(flowData);\n      \n      // ÁîüÊàêÊ°ëÂü∫ÂõæÊï∞ÊçÆ\n      const sankeyData = this.generateSankeyData(flowData);\n      \n      // ËÆ°ÁÆóËÉΩÊµÅÁªüËÆ°\n      const statistics = this.calculateFlowStatistics(flowData);\n      \n      const energyFlowMap = {\n        park_id: parkId,\n        time_range: timeRange,\n        timestamp: new Date().toISOString(),\n        topology: topology,\n        sankey_data: sankeyData,\n        statistics: statistics,\n        real_time_flows: this.realTimeFlows.get(parkId) || [],\n        infrastructure: {\n          sources: Array.from(this.energySources.values()),\n          grid_nodes: Array.from(this.energyGrid.values()),\n          loads: Array.from(this.energyLoads.values()),\n          storage: Array.from(this.energyStorage.values())\n        }\n      };\n\n      return energyFlowMap;\n    } catch (error) {\n      logger.error('ÁîüÊàêÂõ≠Âå∫ËÉΩÊµÅÂÖ®ÊôØÂõæÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * ÊûÑÂª∫ËÉΩÊ∫êÊãìÊâëÂõæ\n   * @param {Array} flowData - ËÉΩÊµÅÊï∞ÊçÆ\n   * @returns {Object} ÊãìÊâëÂõæÊï∞ÊçÆ\n   */\n  buildEnergyTopology(flowData) {\n    const nodes = [];\n    const links = [];\n    const nodeMap = new Map();\n\n    // Ê∑ªÂä†ÊâÄÊúâËÆæÂ§áËäÇÁÇπ\n    const allDevices = [\n      ...Array.from(this.energySources.values()),\n      ...Array.from(this.energyGrid.values()),\n      ...Array.from(this.energyLoads.values()),\n      ...Array.from(this.energyStorage.values())\n    ];\n\n    allDevices.forEach(device => {\n      const node = {\n        id: device.id,\n        name: device.name,\n        type: device.type,\n        category: device.energy_type || device.device_type || device.load_type || device.storage_type,\n        config: device.config,\n        position: device.position || this.calculateNodePosition(device),\n        capacity: device.capacity || device.rated_power || 0,\n        current_power: 0,\n        efficiency: device.efficiency || 1.0,\n        status: device.status || 'online'\n      };\n      nodes.push(node);\n      nodeMap.set(device.id, node);\n    });\n\n    // Ê∑ªÂä†ËÉΩÊµÅËøûÊé•\n    flowData.forEach(flow => {\n      const sourceNode = nodeMap.get(flow.source_id);\n      const targetNode = nodeMap.get(flow.target_id);\n      \n      if (sourceNode && targetNode) {\n        // Êõ¥Êñ∞ËäÇÁÇπÂäüÁéá\n        sourceNode.current_power = (sourceNode.current_power || 0) + flow.power;\n        targetNode.current_power = (targetNode.current_power || 0) + flow.power;\n        \n        // Ê∑ªÂä†ËøûÊé•\n        links.push({\n          source: flow.source_id,\n          target: flow.target_id,\n          power: flow.power,\n          energy: flow.energy,\n          efficiency: flow.efficiency || 1.0,\n          flow_direction: flow.direction || 'forward',\n          line_loss: flow.line_loss || 0,\n          timestamp: flow.timestamp\n        });\n      }\n    });\n\n    return {\n      nodes: nodes,\n      links: links,\n      layout: 'force_directed', // Êàñ 'hierarchical', 'circular'\n      zoom_level: 1.0,\n      center_point: { x: 0, y: 0 }\n    };\n  }\n\n  /**\n   * ÁîüÊàêÊ°ëÂü∫ÂõæÊï∞ÊçÆ\n   * @param {Array} flowData - ËÉΩÊµÅÊï∞ÊçÆ\n   * @returns {Object} Ê°ëÂü∫ÂõæÊï∞ÊçÆ\n   */\n  generateSankeyData(flowData) {\n    const nodes = [];\n    const links = [];\n    const nodeIndex = new Map();\n    let nodeCounter = 0;\n\n    // ÊåâÂ±ÇÁ∫ßÁªÑÁªáËäÇÁÇπ\n    const layers = {\n      sources: [], // Á¨¨‰∏ÄÂ±ÇÔºöËÉΩÊ∫êÊ∫êÂ§¥\n      grid: [],    // Á¨¨‰∫åÂ±ÇÔºöÁîµÁΩëËäÇÁÇπ\n      storage: [], // Á¨¨‰∏âÂ±ÇÔºöÂÇ®ËÉΩËÆæÂ§á\n      loads: []    // Á¨¨ÂõõÂ±ÇÔºöË¥üËç∑\n    };\n\n    // ÂàÜÁ±ªËÆæÂ§áÂà∞‰∏çÂêåÂ±ÇÁ∫ß\n    this.energySources.forEach(source => {\n      const nodeId = nodeCounter++;\n      const node = {\n        id: nodeId,\n        name: source.name,\n        category: 'source',\n        layer: 0,\n        color: source.config.color || '#FFD700',\n        icon: source.config.icon || '‚ö°'\n      };\n      nodes.push(node);\n      nodeIndex.set(source.id, nodeId);\n      layers.sources.push(node);\n    });\n\n    this.energyGrid.forEach(grid => {\n      const nodeId = nodeCounter++;\n      const node = {\n        id: nodeId,\n        name: grid.name,\n        category: 'grid',\n        layer: 1,\n        color: grid.config.color || '#4169E1',\n        icon: grid.config.icon || 'üîå'\n      };\n      nodes.push(node);\n      nodeIndex.set(grid.id, nodeId);\n      layers.grid.push(node);\n    });\n\n    this.energyStorage.forEach(storage => {\n      const nodeId = nodeCounter++;\n      const node = {\n        id: nodeId,\n        name: storage.name,\n        category: 'storage',\n        layer: 2,\n        color: storage.config.color || '#FF4500',\n        icon: storage.config.icon || 'üîã'\n      };\n      nodes.push(node);\n      nodeIndex.set(storage.id, nodeId);\n      layers.storage.push(node);\n    });\n\n    this.energyLoads.forEach(load => {\n      const nodeId = nodeCounter++;\n      const node = {\n        id: nodeId,\n        name: load.name,\n        category: 'load',\n        layer: 3,\n        color: load.config.color || '#B22222',\n        icon: load.config.icon || 'üè≠'\n      };\n      nodes.push(node);\n      nodeIndex.set(load.id, nodeId);\n      layers.loads.push(node);\n    });\n\n    // ÁîüÊàêËøûÊé•Êï∞ÊçÆ\n    flowData.forEach(flow => {\n      const sourceIndex = nodeIndex.get(flow.source_id);\n      const targetIndex = nodeIndex.get(flow.target_id);\n      \n      if (sourceIndex !== undefined && targetIndex !== undefined) {\n        links.push({\n          source: sourceIndex,\n          target: targetIndex,\n          value: flow.power, // ÂäüÁéá‰Ωú‰∏∫ÊµÅÈáèÂÄº\n          energy: flow.energy,\n          efficiency: flow.efficiency || 1.0,\n          color: this.getFlowColor(flow.power),\n          opacity: this.getFlowOpacity(flow.power)\n        });\n      }\n    });\n\n    return {\n      nodes: nodes,\n      links: links,\n      layers: layers,\n      layout: {\n        node_width: 20,\n        node_padding: 10,\n        iterations: 32,\n        link_curvature: 0.5\n      },\n      animation: {\n        enabled: true,\n        duration: 1000,\n        easing: 'ease-in-out'\n      }\n    };\n  }\n\n  /**\n   * ËÆ°ÁÆóËÉΩÊµÅÁªüËÆ°\n   * @param {Array} flowData - ËÉΩÊµÅÊï∞ÊçÆ\n   * @returns {Object} ÁªüËÆ°Êï∞ÊçÆ\n   */\n  calculateFlowStatistics(flowData) {\n    const stats = {\n      total_generation: 0,\n      total_consumption: 0,\n      total_storage_charge: 0,\n      total_storage_discharge: 0,\n      grid_import: 0,\n      grid_export: 0,\n      renewable_ratio: 0,\n      energy_efficiency: 0,\n      peak_power: 0,\n      average_power: 0,\n      power_balance: 0,\n      breakdown: {\n        by_source: {},\n        by_load: {},\n        by_storage: {},\n        by_time: []\n      }\n    };\n\n    // ÊåâÊ∫êÂ§¥ÁªüËÆ°\n    this.energySources.forEach(source => {\n      const sourceFlows = flowData.filter(f => f.source_id === source.id);\n      const totalPower = sourceFlows.reduce((sum, f) => sum + f.power, 0);\n      stats.breakdown.by_source[source.energy_type] = totalPower;\n      stats.total_generation += totalPower;\n    });\n\n    // ÊåâË¥üËç∑ÁªüËÆ°\n    this.energyLoads.forEach(load => {\n      const loadFlows = flowData.filter(f => f.target_id === load.id);\n      const totalPower = loadFlows.reduce((sum, f) => sum + f.power, 0);\n      stats.breakdown.by_load[load.load_type] = totalPower;\n      stats.total_consumption += totalPower;\n    });\n\n    // ÊåâÂÇ®ËÉΩÁªüËÆ°\n    this.energyStorage.forEach(storage => {\n      const chargeFlows = flowData.filter(f => f.target_id === storage.id);\n      const dischargeFlows = flowData.filter(f => f.source_id === storage.id);\n      \n      const chargeTotal = chargeFlows.reduce((sum, f) => sum + f.power, 0);\n      const dischargeTotal = dischargeFlows.reduce((sum, f) => sum + f.power, 0);\n      \n      stats.breakdown.by_storage[storage.storage_type] = {\n        charge: chargeTotal,\n        discharge: dischargeTotal,\n        net: dischargeTotal - chargeTotal\n      };\n      \n      stats.total_storage_charge += chargeTotal;\n      stats.total_storage_discharge += dischargeTotal;\n    });\n\n    // ËÆ°ÁÆóÂèØÂÜçÁîüËÉΩÊ∫êÂç†ÊØî\n    const renewableSources = ['solar_pv', 'wind', 'hydro', 'biomass'];\n    const renewableGeneration = renewableSources.reduce((sum, type) => {\n      return sum + (stats.breakdown.by_source[type] || 0);\n    }, 0);\n    stats.renewable_ratio = stats.total_generation > 0 ? \n      (renewableGeneration / stats.total_generation * MATH_CONSTANTS.ONE_HUNDRED).toFixed(MATH_CONSTANTS.DECIMAL_PLACES) : 0;\n\n    // ËÆ°ÁÆóÂäüÁéáÂπ≥Ë°°\n    stats.power_balance = stats.total_generation - stats.total_consumption;\n    \n    // ËÆ°ÁÆóÂπ≥ÂùáÂäüÁéá\n    stats.average_power = flowData.length > 0 ? \n      flowData.reduce((sum, f) => sum + f.power, 0) / flowData.length : 0;\n    \n    // ËÆ°ÁÆóÂ≥∞ÂÄºÂäüÁéá\n    stats.peak_power = flowData.length > 0 ? \n      Math.max(...flowData.map(f => f.power)) : 0;\n\n    return stats;\n  }\n\n  /**\n   * Êõ¥Êñ∞ÂÆûÊó∂ËÉΩÊµÅÊï∞ÊçÆ\n   */\n  async updateRealTimeFlows() {\n    try {\n      const parks = await this.getAllParks();\n      \n      for (const park of parks) {\n        const flowData = await this.getRealTimeFlowData(park.id, '5m');\n        this.realTimeFlows.set(park.id, flowData);\n        \n        // ÂèëÈÄÅÂÆûÊó∂Êõ¥Êñ∞‰∫ã‰ª∂\n        this.emit('real_time_flow_update', {\n          park_id: park.id,\n          flows: flowData,\n          timestamp: new Date().toISOString()\n        });\n      }\n    } catch (error) {\n      logger.error('Êõ¥Êñ∞ÂÆûÊó∂ËÉΩÊµÅÊï∞ÊçÆÂ§±Ë¥•:', error);\n    }\n  }\n\n  /**\n   * ËÆ°ÁÆóËäÇÁÇπ‰ΩçÁΩÆ\n   */\n  calculateNodePosition(device) {\n    // Ê†πÊçÆËÆæÂ§áÁ±ªÂûãËÆ°ÁÆóÂ∏ÉÂ±Ä‰ΩçÁΩÆ\n    const typePositions = {\n      source: { x: 0, y: 0 },\n      grid: { x: 200, y: 0 },\n      storage: { x: 400, y: 0 },\n      load: { x: 600, y: 0 }\n    };\n    \n    const basePos = typePositions[device.type] || { x: 0, y: 0 };\n    return {\n      x: basePos.x + Math.random() * 100,\n      y: basePos.y + Math.random() * 100\n    };\n  }\n\n  /**\n   * Ëé∑ÂèñËÉΩÊµÅÈ¢úËâ≤\n   */\n  getFlowColor(power) {\n    if (power > 1000) return '#FF0000'; // È´òÂäüÁéáÔºöÁ∫¢Ëâ≤\n    if (power > 500) return '#FF8C00';  // ‰∏≠ÂäüÁéáÔºöÊ©ôËâ≤\n    if (power > 100) return '#FFD700';  // ‰ΩéÂäüÁéáÔºöÈáëËâ≤\n    return '#90EE90'; // ÊûÅ‰ΩéÂäüÁéáÔºöÊµÖÁªøËâ≤\n  }\n\n  /**\n   * Ëé∑ÂèñËÉΩÊµÅÈÄèÊòéÂ∫¶\n   */\n  getFlowOpacity(power) {\n    const maxPower = 2000;\n    const minOpacity = 0.3;\n    const maxOpacity = 1.0;\n    \n    const ratio = Math.min(power / maxPower, 1);\n    return minOpacity + (maxOpacity - minOpacity) * ratio;\n  }\n\n  // Ê®°ÊãüÊï∞ÊçÆËé∑ÂèñÊñπÊ≥ïÔºàÂÆûÈôÖÂ∫îÁî®‰∏≠ÈúÄË¶ÅËøûÊé•ÁúüÂÆûÊï∞ÊçÆÊ∫êÔºâ\n  async getEnergySourceDevices() {\n    return [\n      { id: 'solar_001', name: 'ÂÖâ‰ºèÁîµÁ´ô1', energy_type: 'solar_pv', capacity: 1000, efficiency: 0.85 },\n      { id: 'wind_001', name: 'È£éÂäõÂèëÁîµÊú∫1', energy_type: 'wind', capacity: 500, efficiency: 0.90 },\n      { id: 'grid_001', name: 'ÁîµÁΩëÊé•ÂÖ•ÁÇπ', energy_type: 'grid', capacity: 5000, efficiency: 0.95 }\n    ];\n  }\n\n  async getGridDevices() {\n    return [\n      { id: 'transformer_001', name: '‰∏ªÂèòÂéãÂô®', device_type: 'main_transformer', capacity: 5000 },\n      { id: 'panel_001', name: 'ÈÖçÁîµÊüú1', device_type: 'distribution_panel', capacity: 1000 }\n    ];\n  }\n\n  async getLoadDevices() {\n    return [\n      { id: 'factory_001', name: 'Â∑•ÂéÇ1', load_type: 'industrial', capacity: 2000 },\n      { id: 'office_001', name: 'ÂäûÂÖ¨Ê•º1', load_type: 'commercial', capacity: 500 },\n      { id: 'charging_001', name: 'ÂÖÖÁîµÁ´ô1', load_type: 'ev_charging', capacity: 300 }\n    ];\n  }\n\n  async getStorageDevices() {\n    return [\n      { id: 'battery_001', name: 'ÁîµÊ±†ÂÇ®ËÉΩ1', storage_type: 'battery', capacity: 1000, efficiency: 0.90 }\n    ];\n  }\n\n  async getRealTimeFlowData(parkId, timeRange) {\n    // TODO: ÂÆûÁé∞ÁúüÂÆûÁöÑÊï∞ÊçÆÂ∫ìÊü•ËØ¢\n    return [\n      {\n        source_id: 'solar_001',\n        target_id: 'transformer_001',\n        power: Math.random() * 800,\n        energy: Math.random() * 1000,\n        efficiency: 0.95,\n        direction: 'forward',\n        timestamp: new Date().toISOString()\n      },\n      {\n        source_id: 'transformer_001',\n        target_id: 'factory_001',\n        power: Math.random() * 1500,\n        energy: Math.random() * 2000,\n        efficiency: 0.98,\n        direction: 'forward',\n        timestamp: new Date().toISOString()\n      }\n    ];\n  }\n\n  async getAllParks() {\n    return [\n      { id: 'park_001', name: 'Á§∫‰æãÂõ≠Âå∫1' }\n    ];\n  }\n}\n\nexport default EnergyFlowVisualization;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/core/services/EnergyManager.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/core/services/EnergyOptimizationScheduler.js","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'ENERGY_CONSTANTS' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":26},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.1.","line":580,"column":37,"nodeType":"Literal","messageId":"noMagic","endLine":580,"endColumn":40},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.9.","line":581,"column":39,"nodeType":"Literal","messageId":"noMagic","endLine":581,"endColumn":42},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.95.","line":582,"column":43,"nodeType":"Literal","messageId":"noMagic","endLine":582,"endColumn":47},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.1.","line":621,"column":45,"nodeType":"Literal","messageId":"noMagic","endLine":621,"endColumn":48},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.01.","line":624,"column":51,"nodeType":"Literal","messageId":"noMagic","endLine":624,"endColumn":55},{"ruleId":"no-unused-vars","severity":2,"message":"'parkId' is defined but never used. Allowed unused args must match /^_/u.","line":719,"column":31,"nodeType":"Identifier","messageId":"unusedVar","endLine":719,"endColumn":37},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1500.","line":738,"column":15,"nodeType":"Literal","messageId":"noMagic","endLine":738,"endColumn":19},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":738,"column":22,"nodeType":"Literal","messageId":"noMagic","endLine":738,"endColumn":25},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 12.","line":738,"column":51,"nodeType":"Literal","messageId":"noMagic","endLine":738,"endColumn":53},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 200.","line":738,"column":73,"nodeType":"Literal","messageId":"noMagic","endLine":738,"endColumn":76},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 6.","line":753,"column":21,"nodeType":"Literal","messageId":"noMagic","endLine":753,"endColumn":22},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 18.","line":753,"column":31,"nodeType":"Literal","messageId":"noMagic","endLine":753,"endColumn":33},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 600.","line":753,"column":36,"nodeType":"Literal","messageId":"noMagic","endLine":753,"endColumn":39},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 6.","line":753,"column":56,"nodeType":"Literal","messageId":"noMagic","endLine":753,"endColumn":57},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 12.","line":753,"column":71,"nodeType":"Literal","messageId":"noMagic","endLine":753,"endColumn":73},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 200.","line":754,"column":15,"nodeType":"Literal","messageId":"noMagic","endLine":754,"endColumn":18},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 300.","line":754,"column":37,"nodeType":"Literal","messageId":"noMagic","endLine":754,"endColumn":40},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 8.","line":768,"column":36,"nodeType":"Literal","messageId":"noMagic","endLine":768,"endColumn":37},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 11.","line":768,"column":46,"nodeType":"Literal","messageId":"noMagic","endLine":768,"endColumn":48},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 18.","line":768,"column":59,"nodeType":"Literal","messageId":"noMagic","endLine":768,"endColumn":61},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 21.","line":768,"column":70,"nodeType":"Literal","messageId":"noMagic","endLine":768,"endColumn":72},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1.5.","line":768,"column":76,"nodeType":"Literal","messageId":"noMagic","endLine":768,"endColumn":79},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.1.","line":771,"column":61,"nodeType":"Literal","messageId":"noMagic","endLine":771,"endColumn":64},{"ruleId":"no-unused-vars","severity":2,"message":"'timeHorizon' is defined but never used. Allowed unused args must match /^_/u.","line":779,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":779,"endColumn":38},{"ruleId":"no-unused-vars","severity":2,"message":"'parkId' is defined but never used. Allowed unused args must match /^_/u.","line":805,"column":25,"nodeType":"Identifier","messageId":"unusedVar","endLine":805,"endColumn":31},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 2000.","line":807,"column":21,"nodeType":"Literal","messageId":"noMagic","endLine":807,"endColumn":25},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":807,"column":44,"nodeType":"Literal","messageId":"noMagic","endLine":807,"endColumn":47},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 800.","line":808,"column":25,"nodeType":"Literal","messageId":"noMagic","endLine":808,"endColumn":28},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 200.","line":808,"column":47,"nodeType":"Literal","messageId":"noMagic","endLine":808,"endColumn":50},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.6.","line":809,"column":19,"nodeType":"Literal","messageId":"noMagic","endLine":809,"endColumn":22},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.4.","line":809,"column":41,"nodeType":"Literal","messageId":"noMagic","endLine":809,"endColumn":44},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.6.","line":810,"column":20,"nodeType":"Literal","messageId":"noMagic","endLine":810,"endColumn":23},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.3.","line":810,"column":42,"nodeType":"Literal","messageId":"noMagic","endLine":810,"endColumn":45},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":818,"column":27,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":818,"endColumn":39,"fix":{"range":[23196,23208],"text":"{return true;}"}},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.1.","line":823,"column":28,"nodeType":"Literal","messageId":"noMagic","endLine":823,"endColumn":31},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.8.","line":832,"column":51,"nodeType":"Literal","messageId":"noMagic","endLine":832,"endColumn":54},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 2200.","line":833,"column":49,"nodeType":"Literal","messageId":"noMagic","endLine":833,"endColumn":53},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.8.","line":848,"column":35,"nodeType":"Literal","messageId":"noMagic","endLine":848,"endColumn":38},{"ruleId":"no-unused-vars","severity":2,"message":"'schedulingPlan' is defined but never used. Allowed unused args must match /^_/u.","line":864,"column":32,"nodeType":"Identifier","messageId":"unusedVar","endLine":864,"endColumn":46},{"ruleId":"no-unused-vars","severity":2,"message":"'objectives' is defined but never used. Allowed unused args must match /^_/u.","line":864,"column":48,"nodeType":"Identifier","messageId":"unusedVar","endLine":864,"endColumn":58},{"ruleId":"no-unused-vars","severity":2,"message":"'schedulingPlan' is defined but never used. Allowed unused args must match /^_/u.","line":873,"column":41,"nodeType":"Identifier","messageId":"unusedVar","endLine":873,"endColumn":55},{"ruleId":"no-unused-vars","severity":2,"message":"'schedulingPlan' is defined but never used. Allowed unused args must match /^_/u.","line":881,"column":35,"nodeType":"Identifier","messageId":"unusedVar","endLine":881,"endColumn":49},{"ruleId":"no-unused-vars","severity":2,"message":"'schedulingPlan' is defined but never used. Allowed unused args must match /^_/u.","line":889,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":889,"endColumn":41}],"suppressedMessages":[],"errorCount":10,"fatalErrorCount":0,"warningCount":34,"fixableErrorCount":1,"fixableWarningCount":0,"source":"/**\n * Áî®ËÉΩÁªìÊûÑËΩ¨Âûã‰∏é‰ºòÂåñË∞ÉÂ∫¶‰∏≠ÂøÉ\n * ÂÆûÁé∞Êô∫ËÉΩË∞ÉÂ∫¶ÁÆóÊ≥ï„ÄÅÈúÄÊ±ÇÂìçÂ∫îÁÆ°ÁêÜÂíåÁî®ËÉΩÁªìÊûÑ‰ºòÂåñ\n * ÊîØÊåÅÂ§öÁõÆÊ†á‰ºòÂåñÔºöÊàêÊú¨ÊúÄÂ∞èÂåñ„ÄÅÁ¢≥ÊéíÊîæÊúÄÂ∞èÂåñ„ÄÅÂèØÈù†ÊÄßÊúÄÂ§ßÂåñ\n */\n\nimport { EventEmitter } from 'events';\nimport logger from '../../shared/utils/logger.js';\nimport { ENERGY_CONSTANTS, MATH_CONSTANTS } from '../../shared/constants/MathConstants.js';\n\nclass EnergyOptimizationScheduler extends EventEmitter {\n  constructor() {\n    super();\n    this.isInitialized = false;\n    this.optimizationEngine = null;\n    this.schedulingRules = new Map();\n    this.demandResponsePrograms = new Map();\n    this.energyAssets = new Map();\n    this.optimizationResults = new Map();\n    this.realTimeSchedule = new Map();\n    \n    // ‰ºòÂåñÁõÆÊ†áÊùÉÈáçÈÖçÁΩÆ\n    this.optimizationObjectives = {\n      cost_minimization: {\n        weight: 0.4,\n        priority: 'high',\n        description: 'ÊàêÊú¨ÊúÄÂ∞èÂåñ'\n      },\n      carbon_minimization: {\n        weight: 0.35,\n        priority: 'high',\n        description: 'Á¢≥ÊéíÊîæÊúÄÂ∞èÂåñ'\n      },\n      reliability_maximization: {\n        weight: 0.15,\n        priority: 'medium',\n        description: '‰æõÁîµÂèØÈù†ÊÄßÊúÄÂ§ßÂåñ'\n      },\n      efficiency_maximization: {\n        weight: 0.1,\n        priority: 'medium',\n        description: 'ËÉΩÊ∫êÊïàÁéáÊúÄÂ§ßÂåñ'\n      }\n    };\n    \n    // Ë∞ÉÂ∫¶Á≠ñÁï•Á±ªÂûã\n    this.schedulingStrategies = {\n      peak_shaving: {\n        name: 'ÂâäÂ≥∞Â°´Ë∞∑',\n        description: 'Âú®Áî®ÁîµÈ´òÂ≥∞ÊúüÂáèÂ∞ëË¥üËç∑Ôºå‰ΩéË∞∑ÊúüÂ¢ûÂä†Ë¥üËç∑',\n        applicable_assets: ['battery', 'flexible_load', 'ev_charging']\n      },\n      load_shifting: {\n        name: 'Ë¥üËç∑ËΩ¨Áßª',\n        description: 'Â∞ÜÂèØË∞ÉËäÇË¥üËç∑‰ªéÈ´òÂ≥∞Êó∂ÊÆµËΩ¨ÁßªÂà∞‰ΩéË∞∑Êó∂ÊÆµ',\n        applicable_assets: ['industrial_load', 'hvac', 'water_heating']\n      },\n      renewable_maximization: {\n        name: 'ÂèØÂÜçÁîüËÉΩÊ∫êÊúÄÂ§ßÂåñÂà©Áî®',\n        description: '‰ºòÂÖà‰ΩøÁî®ÂèØÂÜçÁîüËÉΩÊ∫êÂèëÁîµ',\n        applicable_assets: ['solar', 'wind', 'battery', 'flexible_load']\n      },\n      grid_interaction: {\n        name: 'ÁîµÁΩë‰∫íÂä®‰ºòÂåñ',\n        description: '‰ºòÂåñ‰∏éÁîµÁΩëÁöÑËÉΩÈáè‰∫§Êç¢',\n        applicable_assets: ['grid_connection', 'battery', 'renewable']\n      }\n    };\n    \n    // ÈúÄÊ±ÇÂìçÂ∫îÁ±ªÂûã\n    this.demandResponseTypes = {\n      price_based: {\n        name: '‰ª∑Ê†ºÂûãÈúÄÊ±ÇÂìçÂ∫î',\n        trigger: 'electricity_price',\n        response_time: '15min',\n        duration: '1-4h'\n      },\n      incentive_based: {\n        name: 'ÊøÄÂä±ÂûãÈúÄÊ±ÇÂìçÂ∫î',\n        trigger: 'grid_signal',\n        response_time: '5min',\n        duration: '30min-2h'\n      },\n      emergency_based: {\n        name: 'Á¥ßÊÄ•ÈúÄÊ±ÇÂìçÂ∫î',\n        trigger: 'grid_emergency',\n        response_time: '1min',\n        duration: '15min-1h'\n      },\n      renewable_based: {\n        name: 'ÂèØÂÜçÁîüËÉΩÊ∫êÈúÄÊ±ÇÂìçÂ∫î',\n        trigger: 'renewable_output',\n        response_time: '10min',\n        duration: '30min-6h'\n      }\n    };\n    \n    this.init();\n  }\n\n  async init() {\n    try {\n      await this.initializeOptimizationEngine();\n      await this.loadEnergyAssets();\n      await this.loadSchedulingRules();\n      await this.setupDemandResponsePrograms();\n      await this.startRealTimeOptimization();\n      \n      this.isInitialized = true;\n      logger.info('Áî®ËÉΩÁªìÊûÑËΩ¨Âûã‰∏é‰ºòÂåñË∞ÉÂ∫¶‰∏≠ÂøÉÂàùÂßãÂåñÂÆåÊàê');\n      this.emit('initialized');\n    } catch (error) {\n      logger.error('‰ºòÂåñË∞ÉÂ∫¶‰∏≠ÂøÉÂàùÂßãÂåñÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * ÂàùÂßãÂåñ‰ºòÂåñÂºïÊìé\n   */\n  async initializeOptimizationEngine() {\n    this.optimizationEngine = {\n      algorithm: 'multi_objective_genetic_algorithm',\n      population_size: 100,\n      generations: 50,\n      crossover_rate: 0.8,\n      mutation_rate: 0.1,\n      convergence_threshold: 0.001,\n      max_iterations: 1000\n    };\n    \n    logger.info('‰ºòÂåñÂºïÊìéÂàùÂßãÂåñÂÆåÊàê');\n  }\n\n  /**\n   * Âä†ËΩΩËÉΩÊ∫êËµÑ‰∫ß\n   */\n  async loadEnergyAssets() {\n    try {\n      const assets = await this.getEnergyAssetData();\n      \n      assets.forEach(asset => {\n        this.energyAssets.set(asset.id, {\n          ...asset,\n          current_status: 'online',\n          optimization_parameters: this.getAssetOptimizationParameters(asset),\n          constraints: this.getAssetConstraints(asset),\n          cost_model: this.getAssetCostModel(asset),\n          carbon_model: this.getAssetCarbonModel(asset)\n        });\n      });\n      \n      logger.info(`Â∑≤Âä†ËΩΩËÉΩÊ∫êËµÑ‰∫ß ${this.energyAssets.size} ‰∏™`);\n    } catch (error) {\n      logger.error('Âä†ËΩΩËÉΩÊ∫êËµÑ‰∫ßÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * ÊâßË°åÂ§öÁõÆÊ†á‰ºòÂåñË∞ÉÂ∫¶\n   * @param {string} parkId - Âõ≠Âå∫ID\n   * @param {string} timeHorizon - ‰ºòÂåñÊó∂Èó¥ËåÉÂõ¥\n   * @param {Object} objectives - ‰ºòÂåñÁõÆÊ†á\n   * @returns {Object} ‰ºòÂåñË∞ÉÂ∫¶ÊñπÊ°à\n   */\n  async executeOptimizationScheduling(parkId, timeHorizon = '24h', objectives = null) {\n    try {\n      const optimizationId = this.generateOptimizationId(parkId, timeHorizon);\n      \n      // ‰ΩøÁî®ÈªòËÆ§ÁõÆÊ†áÊàñËá™ÂÆö‰πâÁõÆÊ†á\n      const optimizationObjectives = objectives || this.optimizationObjectives;\n      \n      // Ëé∑ÂèñÈ¢ÑÊµãÊï∞ÊçÆ\n      const forecastData = await this.getForecastData(parkId, timeHorizon);\n      \n      // Ëé∑ÂèñÂΩìÂâçÁ≥ªÁªüÁä∂ÊÄÅ\n      const systemState = await this.getCurrentSystemState(parkId);\n      \n      // ÊûÑÂª∫‰ºòÂåñÈóÆÈ¢ò\n      const optimizationProblem = this.buildOptimizationProblem(\n        parkId,\n        forecastData,\n        systemState,\n        optimizationObjectives,\n        timeHorizon\n      );\n      \n      // ÊâßË°åÂ§öÁõÆÊ†á‰ºòÂåñÁÆóÊ≥ï\n      const optimizationResult = await this.solveMultiObjectiveOptimization(optimizationProblem);\n      \n      // ÁîüÊàêË∞ÉÂ∫¶ÊñπÊ°à\n      const schedulingPlan = this.generateSchedulingPlan(optimizationResult, forecastData);\n      \n      // ËØÑ‰º∞Ë∞ÉÂ∫¶ÊñπÊ°à\n      const evaluation = await this.evaluateSchedulingPlan(schedulingPlan, optimizationObjectives);\n      \n      const result = {\n        optimization_id: optimizationId,\n        park_id: parkId,\n        time_horizon: timeHorizon,\n        optimization_time: new Date().toISOString(),\n        objectives: optimizationObjectives,\n        \n        // ‰ºòÂåñÁªìÊûú\n        scheduling_plan: schedulingPlan,\n        \n        // ÊÄßËÉΩËØÑ‰º∞\n        performance_evaluation: evaluation,\n        \n        // È¢ÑÊúüÊïàÁõä\n        expected_benefits: {\n          cost_savings: evaluation.cost_reduction,\n          carbon_reduction: evaluation.emission_reduction,\n          efficiency_improvement: evaluation.efficiency_gain,\n          reliability_enhancement: evaluation.reliability_improvement\n        },\n        \n        // ÂÆûÊñΩÂª∫ËÆÆ\n        implementation_recommendations: this.generateImplementationRecommendations(schedulingPlan),\n        \n        // È£éÈô©ËØÑ‰º∞\n        risk_assessment: await this.assessImplementationRisks(schedulingPlan),\n        \n        // ÁõëÊéßÊåáÊ†á\n        monitoring_metrics: this.defineMonitoringMetrics(schedulingPlan)\n      };\n      \n      // ÁºìÂ≠ò‰ºòÂåñÁªìÊûú\n      this.optimizationResults.set(optimizationId, result);\n      \n      logger.info(`‰ºòÂåñË∞ÉÂ∫¶ÂÆåÊàê: ${optimizationId}, È¢ÑÊúüÊàêÊú¨ËäÇÁ∫¶: ${evaluation.cost_reduction}%`);\n      this.emit('optimization_completed', result);\n      \n      return result;\n    } catch (error) {\n      logger.error('ÊâßË°å‰ºòÂåñË∞ÉÂ∫¶Â§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * ÂÆûÊñΩÈúÄÊ±ÇÂìçÂ∫îËÆ°Âàí\n   * @param {string} parkId - Âõ≠Âå∫ID\n   * @param {string} responseType - ÂìçÂ∫îÁ±ªÂûã\n   * @param {Object} triggerEvent - Ëß¶Âèë‰∫ã‰ª∂\n   * @returns {Object} ÈúÄÊ±ÇÂìçÂ∫îÁªìÊûú\n   */\n  async implementDemandResponse(parkId, responseType, triggerEvent) {\n    try {\n      const responseId = this.generateResponseId(parkId, responseType);\n      const responseConfig = this.demandResponseTypes[responseType];\n      \n      if (!responseConfig) {\n        throw new Error(`Êú™Áü•ÁöÑÈúÄÊ±ÇÂìçÂ∫îÁ±ªÂûã: ${responseType}`);\n      }\n      \n      // Ëé∑ÂèñÂèØÂèÇ‰∏éÈúÄÊ±ÇÂìçÂ∫îÁöÑËµÑ‰∫ß\n      const availableAssets = await this.getAvailableResponseAssets(parkId, responseType);\n      \n      // ËÆ°ÁÆóÂìçÂ∫îÊΩúÂäõ\n      const responsePotential = this.calculateResponsePotential(availableAssets, triggerEvent);\n      \n      // ÁîüÊàêÂìçÂ∫îÁ≠ñÁï•\n      const responseStrategy = this.generateResponseStrategy(\n        availableAssets,\n        responsePotential,\n        triggerEvent,\n        responseConfig\n      );\n      \n      // ÊâßË°åÂìçÂ∫îÂä®‰Ωú\n      const executionResult = await this.executeResponseActions(responseStrategy);\n      \n      // ÁõëÊéßÂìçÂ∫îÊïàÊûú\n      const monitoringResult = await this.monitorResponseEffectiveness(responseId, responseStrategy);\n      \n      const result = {\n        response_id: responseId,\n        park_id: parkId,\n        response_type: responseType,\n        trigger_event: triggerEvent,\n        response_time: new Date().toISOString(),\n        \n        // ÂìçÂ∫îÁ≠ñÁï•\n        strategy: responseStrategy,\n        \n        // ÊâßË°åÁªìÊûú\n        execution: executionResult,\n        \n        // ÂìçÂ∫îÊïàÊûú\n        effectiveness: {\n          target_reduction: responsePotential.target_power,\n          actual_reduction: monitoringResult.actual_power_reduction,\n          achievement_rate: monitoringResult.achievement_rate,\n          response_time: monitoringResult.actual_response_time,\n          duration: monitoringResult.actual_duration\n        },\n        \n        // ÁªèÊµéÊïàÁõä\n        economic_benefits: {\n          incentive_payment: this.calculateIncentivePayment(responseType, monitoringResult),\n          cost_avoidance: this.calculateCostAvoidance(triggerEvent, monitoringResult),\n          total_benefit: 0 // Â∞ÜÂú®‰∏ãÈù¢ËÆ°ÁÆó\n        },\n        \n        // ÁéØÂ¢ÉÊïàÁõä\n        environmental_benefits: {\n          carbon_reduction: this.calculateCarbonReduction(monitoringResult),\n          renewable_utilization: this.calculateRenewableUtilization(monitoringResult)\n        }\n      };\n      \n      // ËÆ°ÁÆóÊÄªÁªèÊµéÊïàÁõä\n      result.economic_benefits.total_benefit = \n        result.economic_benefits.incentive_payment + result.economic_benefits.cost_avoidance;\n      \n      logger.info(`ÈúÄÊ±ÇÂìçÂ∫îÂÆûÊñΩÂÆåÊàê: ${responseId}, Ë¥üËç∑ÂâäÂáè: ${monitoringResult.actual_power_reduction}kW`);\n      this.emit('demand_response_completed', result);\n      \n      return result;\n    } catch (error) {\n      logger.error('ÂÆûÊñΩÈúÄÊ±ÇÂìçÂ∫îÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * ‰ºòÂåñÁî®ËÉΩÁªìÊûÑ\n   * @param {string} parkId - Âõ≠Âå∫ID\n   * @param {Object} targetStructure - ÁõÆÊ†áÁî®ËÉΩÁªìÊûÑ\n   * @returns {Object} Áî®ËÉΩÁªìÊûÑ‰ºòÂåñÊñπÊ°à\n   */\n  async optimizeEnergyStructure(parkId, targetStructure) {\n    try {\n      const optimizationId = this.generateStructureOptimizationId(parkId);\n      \n      // Ëé∑ÂèñÂΩìÂâçÁî®ËÉΩÁªìÊûÑ\n      const currentStructure = await this.getCurrentEnergyStructure(parkId);\n      \n      // ÂàÜÊûêÁªìÊûÑÂ∑ÆË∑ù\n      const structureGap = this.analyzeStructureGap(currentStructure, targetStructure);\n      \n      // ÁîüÊàêËΩ¨ÂûãË∑ØÂæÑ\n      const transformationPath = this.generateTransformationPath(currentStructure, targetStructure, structureGap);\n      \n      // ËØÑ‰º∞ËΩ¨ÂûãÊàêÊú¨ÂíåÊïàÁõä\n      const costBenefitAnalysis = await this.analyzeCostBenefit(transformationPath);\n      \n      // Âà∂ÂÆöÂÆûÊñΩËÆ°Âàí\n      const implementationPlan = this.createImplementationPlan(transformationPath, costBenefitAnalysis);\n      \n      const result = {\n        optimization_id: optimizationId,\n        park_id: parkId,\n        optimization_time: new Date().toISOString(),\n        \n        // ÂΩìÂâçÂíåÁõÆÊ†áÁªìÊûÑ\n        current_structure: currentStructure,\n        target_structure: targetStructure,\n        structure_gap: structureGap,\n        \n        // ËΩ¨ÂûãË∑ØÂæÑ\n        transformation_path: transformationPath,\n        \n        // ÊàêÊú¨ÊïàÁõäÂàÜÊûê\n        cost_benefit_analysis: costBenefitAnalysis,\n        \n        // ÂÆûÊñΩËÆ°Âàí\n        implementation_plan: implementationPlan,\n        \n        // È¢ÑÊúüÊïàÊûú\n        expected_outcomes: {\n          renewable_ratio_improvement: this.calculateRenewableImprovement(currentStructure, targetStructure),\n          carbon_intensity_reduction: this.calculateCarbonIntensityReduction(currentStructure, targetStructure),\n          energy_efficiency_gain: this.calculateEfficiencyGain(currentStructure, targetStructure),\n          cost_optimization: this.calculateCostOptimization(currentStructure, targetStructure)\n        },\n        \n        // ÂÖ≥ÈîÆÈáåÁ®ãÁ¢ë\n        milestones: this.defineMilestones(implementationPlan),\n        \n        // ÁõëÊéßÊåáÊ†á\n        monitoring_indicators: this.defineStructureMonitoringIndicators(targetStructure)\n      };\n      \n      logger.info(`Áî®ËÉΩÁªìÊûÑ‰ºòÂåñÊñπÊ°àÁîüÊàêÂÆåÊàê: ${optimizationId}`);\n      this.emit('structure_optimization_completed', result);\n      \n      return result;\n    } catch (error) {\n      logger.error('‰ºòÂåñÁî®ËÉΩÁªìÊûÑÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * ÂêØÂä®ÂÆûÊó∂‰ºòÂåñ\n   */\n  async startRealTimeOptimization() {\n    // ÊØè15ÂàÜÈíüÊâßË°å‰∏ÄÊ¨°ÂÆûÊó∂‰ºòÂåñ\n    setInterval(async () => {\n      try {\n        await this.executeRealTimeOptimization();\n      } catch (error) {\n        logger.error('ÂÆûÊó∂‰ºòÂåñÊâßË°åÂ§±Ë¥•:', error);\n      }\n    }, MATH_CONSTANTS.FIFTEEN * MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.MILLISECONDS_PER_SECOND);\n    \n    // ÊØè5ÂàÜÈíüÊ£ÄÊü•ÈúÄÊ±ÇÂìçÂ∫îËß¶ÂèëÊù°‰ª∂\n    setInterval(async () => {\n      try {\n        await this.checkDemandResponseTriggers();\n      } catch (error) {\n        logger.error('ÈúÄÊ±ÇÂìçÂ∫îÊ£ÄÊü•Â§±Ë¥•:', error);\n      }\n    }, MATH_CONSTANTS.FIVE * MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.MILLISECONDS_PER_SECOND);\n  }\n\n  /**\n   * ÊâßË°åÂÆûÊó∂‰ºòÂåñ\n   */\n  async executeRealTimeOptimization() {\n    try {\n      const parks = await this.getAllParks();\n      \n      for (const park of parks) {\n        // Ëé∑ÂèñÂÆûÊó∂Êï∞ÊçÆ\n        const realTimeData = await this.getRealTimeData(park.id);\n        \n        // Ê£ÄÊü•ÊòØÂê¶ÈúÄË¶ÅË∞ÉÊï¥Ë∞ÉÂ∫¶\n        const adjustmentNeeded = this.checkAdjustmentNeeded(park.id, realTimeData);\n        \n        if (adjustmentNeeded) {\n          // ÊâßË°åÂø´ÈÄü‰ºòÂåñË∞ÉÊï¥\n          const quickOptimization = await this.executeQuickOptimization(park.id, realTimeData);\n          \n          // Êõ¥Êñ∞ÂÆûÊó∂Ë∞ÉÂ∫¶\n          this.realTimeSchedule.set(park.id, quickOptimization);\n          \n          // ÂèëÈÄÅË∞ÉÂ∫¶Êåá‰ª§\n          await this.sendSchedulingCommands(park.id, quickOptimization);\n          \n          this.emit('real_time_optimization_updated', {\n            park_id: park.id,\n            optimization: quickOptimization,\n            timestamp: new Date().toISOString()\n          });\n        }\n      }\n    } catch (error) {\n      logger.error('ÊâßË°åÂÆûÊó∂‰ºòÂåñÂ§±Ë¥•:', error);\n    }\n  }\n\n  /**\n   * Ê£ÄÊü•ÈúÄÊ±ÇÂìçÂ∫îËß¶ÂèëÊù°‰ª∂\n   */\n  async checkDemandResponseTriggers() {\n    try {\n      const parks = await this.getAllParks();\n      \n      for (const park of parks) {\n        const triggers = await this.evaluateTriggerConditions(park.id);\n        \n        for (const trigger of triggers) {\n          if (trigger.triggered) {\n            await this.implementDemandResponse(park.id, trigger.response_type, trigger.event);\n          }\n        }\n      }\n    } catch (error) {\n      logger.error('Ê£ÄÊü•ÈúÄÊ±ÇÂìçÂ∫îËß¶ÂèëÊù°‰ª∂Â§±Ë¥•:', error);\n    }\n  }\n\n  // ‰ºòÂåñÁÆóÊ≥ïÁõ∏ÂÖ≥ÊñπÊ≥ï\n  buildOptimizationProblem(parkId, forecastData, systemState, objectives, timeHorizon) {\n    return {\n      park_id: parkId,\n      time_horizon: timeHorizon,\n      time_steps: this.getTimeSteps(timeHorizon),\n      \n      // ÂÜ≥Á≠ñÂèòÈáè\n      decision_variables: {\n        generation_schedule: this.getGenerationVariables(),\n        storage_schedule: this.getStorageVariables(),\n        load_schedule: this.getLoadVariables(),\n        grid_interaction: this.getGridVariables()\n      },\n      \n      // ÁõÆÊ†áÂáΩÊï∞\n      objective_functions: {\n        cost_function: this.buildCostFunction(forecastData),\n        carbon_function: this.buildCarbonFunction(forecastData),\n        reliability_function: this.buildReliabilityFunction(systemState),\n        efficiency_function: this.buildEfficiencyFunction(systemState)\n      },\n      \n      // Á∫¶ÊùüÊù°‰ª∂\n      constraints: {\n        power_balance: this.getPowerBalanceConstraints(),\n        asset_limits: this.getAssetLimitConstraints(),\n        grid_limits: this.getGridLimitConstraints(),\n        storage_limits: this.getStorageLimitConstraints(),\n        ramp_rate_limits: this.getRampRateConstraints()\n      },\n      \n      // È¢ÑÊµãÊï∞ÊçÆ\n      forecasts: forecastData,\n      \n      // Á≥ªÁªüÁä∂ÊÄÅ\n      initial_state: systemState\n    };\n  }\n\n  async solveMultiObjectiveOptimization(problem) {\n    // ÁÆÄÂåñÁöÑÂ§öÁõÆÊ†á‰ºòÂåñÊ±ÇËß£\n    // ÂÆûÈôÖÂ∫îÁî®‰∏≠Â∫î‰ΩøÁî®‰∏ì‰∏öÁöÑ‰ºòÂåñÊ±ÇËß£Âô®Â¶ÇCPLEX„ÄÅGurobiÁ≠â\n    \n    const solutions = [];\n    const numSolutions = 10; // ÁîüÊàê10‰∏™Â∏ïÁ¥ØÊâòÊúÄ‰ºòËß£\n    \n    for (let i = 0; i < numSolutions; i++) {\n      const solution = await this.generateOptimalSolution(problem, i);\n      solutions.push(solution);\n    }\n    \n    // ÈÄâÊã©ÊúÄ‰Ω≥Ëß£ÂÜ≥ÊñπÊ°à\n    const bestSolution = this.selectBestSolution(solutions, problem.objective_functions);\n    \n    return {\n      best_solution: bestSolution,\n      pareto_solutions: solutions,\n      convergence_info: {\n        iterations: 50,\n        convergence_time: 2.5,\n        optimality_gap: 0.001\n      }\n    };\n  }\n\n  generateSchedulingPlan(optimizationResult, forecastData) {\n    const solution = optimizationResult.best_solution;\n    \n    return {\n      generation_schedule: this.createGenerationSchedule(solution, forecastData),\n      storage_schedule: this.createStorageSchedule(solution, forecastData),\n      load_schedule: this.createLoadSchedule(solution, forecastData),\n      grid_schedule: this.createGridSchedule(solution, forecastData),\n      \n      // Ë∞ÉÂ∫¶Á≠ñÁï•\n      strategies_applied: this.identifyAppliedStrategies(solution),\n      \n      // Êó∂Èó¥Ë°®\n      hourly_schedule: this.createHourlySchedule(solution, forecastData),\n      \n      // ÂÖ≥ÈîÆÊéßÂà∂ÁÇπ\n      control_points: this.identifyControlPoints(solution)\n    };\n  }\n\n  // ËæÖÂä©ÊñπÊ≥ï\n  generateOptimizationId(parkId, timeHorizon) {\n    return `OPT_${parkId}_${timeHorizon}_${Date.now()}`;\n  }\n\n  generateResponseId(parkId, responseType) {\n    return `DR_${parkId}_${responseType}_${Date.now()}`;\n  }\n\n  generateStructureOptimizationId(parkId) {\n    return `STRUCT_${parkId}_${Date.now()}`;\n  }\n\n  getAssetOptimizationParameters(asset) {\n    const parameters = {\n      controllable: asset.controllable || false,\n      response_time: asset.response_time || '5min',\n      ramp_rate: asset.ramp_rate || 0.1, // ÊØèÂàÜÈíüÊúÄÂ§ßÂèòÂåñÁéá\n      efficiency: asset.efficiency || 0.9,\n      availability: asset.availability || 0.95\n    };\n    \n    // Ê†πÊçÆËµÑ‰∫ßÁ±ªÂûãËÆæÁΩÆÁâπÂÆöÂèÇÊï∞\n    switch (asset.type) {\n      case 'battery':\n        parameters.charge_efficiency = 0.95;\n        parameters.discharge_efficiency = 0.95;\n        parameters.self_discharge_rate = 0.001;\n        break;\n      case 'solar':\n        parameters.weather_dependent = true;\n        parameters.forecast_accuracy = 0.85;\n        break;\n      case 'wind':\n        parameters.weather_dependent = true;\n        parameters.forecast_accuracy = 0.75;\n        break;\n    }\n    \n    return parameters;\n  }\n\n  getAssetConstraints(asset) {\n    return {\n      min_power: asset.min_power || 0,\n      max_power: asset.max_power || asset.capacity,\n      min_energy: asset.min_energy || 0,\n      max_energy: asset.max_energy || asset.capacity * MATH_CONSTANTS.TWENTY_FOUR,\n      min_runtime: asset.min_runtime || 0,\n      max_runtime: asset.max_runtime || MATH_CONSTANTS.TWENTY_FOUR * MATH_CONSTANTS.SIXTY,\n      startup_time: asset.startup_time || 0,\n      shutdown_time: asset.shutdown_time || 0\n    };\n  }\n\n  getAssetCostModel(asset) {\n    return {\n      fixed_cost: asset.fixed_cost || 0,\n      variable_cost: asset.variable_cost || 0.1,\n      startup_cost: asset.startup_cost || 0,\n      shutdown_cost: asset.shutdown_cost || 0,\n      maintenance_cost: asset.maintenance_cost || 0.01\n    };\n  }\n\n  getAssetCarbonModel(asset) {\n    const emissionFactors = {\n      grid: 0.5703,\n      natural_gas: 0.2,\n      coal: 0.9,\n      solar: 0,\n      wind: 0,\n      hydro: 0,\n      battery: 0 // ÂÇ®ËÉΩÊú¨Ë∫´Êó†ÊéíÊîæÔºå‰ΩÜÂÖÖÁîµÊó∂ÊúâÈó¥Êé•ÊéíÊîæ\n    };\n    \n    return {\n      emission_factor: emissionFactors[asset.fuel_type] || emissionFactors[asset.type] || 0,\n      lifecycle_emissions: asset.lifecycle_emissions || 0\n    };\n  }\n\n  // Ê®°ÊãüÊï∞ÊçÆËé∑ÂèñÊñπÊ≥ï\n  async getEnergyAssetData() {\n    return [\n      {\n        id: 'solar_001',\n        name: 'Â±ãÈ°∂ÂÖâ‰ºè',\n        type: 'solar',\n        capacity: 1000,\n        controllable: false,\n        fuel_type: 'solar'\n      },\n      {\n        id: 'battery_001',\n        name: 'ÂÇ®ËÉΩÁîµÊ±†',\n        type: 'battery',\n        capacity: 500,\n        controllable: true,\n        fuel_type: 'battery'\n      },\n      {\n        id: 'grid_001',\n        name: 'ÁîµÁΩëËøûÊé•',\n        type: 'grid',\n        capacity: 5000,\n        controllable: true,\n        fuel_type: 'grid'\n      }\n    ];\n  }\n\n  async loadSchedulingRules() {\n    // Âä†ËΩΩË∞ÉÂ∫¶ËßÑÂàô\n    const rules = [\n      {\n        id: 'peak_shaving_rule',\n        type: 'peak_shaving',\n        condition: 'grid_price > 0.8',\n        action: 'discharge_battery',\n        priority: 'high'\n      }\n    ];\n    \n    rules.forEach(rule => {\n      this.schedulingRules.set(rule.id, rule);\n    });\n  }\n\n  async setupDemandResponsePrograms() {\n    // ËÆæÁΩÆÈúÄÊ±ÇÂìçÂ∫îÁ®ãÂ∫è\n    const programs = [\n      {\n        id: 'peak_demand_response',\n        type: 'price_based',\n        trigger_price: 0.8,\n        incentive_rate: 0.1,\n        max_duration: 4\n      }\n    ];\n    \n    programs.forEach(program => {\n      this.demandResponsePrograms.set(program.id, program);\n    });\n  }\n\n  async getForecastData(parkId, timeHorizon) {\n    // Ê®°ÊãüÈ¢ÑÊµãÊï∞ÊçÆ\n    return {\n      load_forecast: this.generateLoadForecast(timeHorizon),\n      renewable_forecast: this.generateRenewableForecast(timeHorizon),\n      price_forecast: this.generatePriceForecast(timeHorizon),\n      weather_forecast: this.generateWeatherForecast(timeHorizon)\n    };\n  }\n\n  async getCurrentSystemState(parkId) {\n    return {\n      timestamp: new Date().toISOString(),\n      total_load: 2000,\n      renewable_generation: 800,\n      grid_import: 1200,\n      battery_soc: 0.6,\n      system_frequency: 50.0,\n      voltage_levels: { high: 220, medium: 110, low: 10 }\n    };\n  }\n\n  generateLoadForecast(timeHorizon) {\n    const hours = this.parseTimeHorizon(timeHorizon);\n    const forecast = [];\n    \n    for (let i = 0; i < hours; i++) {\n      forecast.push({\n        hour: i,\n        load: 1500 + 500 * Math.sin(i * Math.PI / 12) + Math.random() * 200,\n        confidence: 0.85\n      });\n    }\n    \n    return forecast;\n  }\n\n  generateRenewableForecast(timeHorizon) {\n    const hours = this.parseTimeHorizon(timeHorizon);\n    const forecast = [];\n    \n    for (let i = 0; i < hours; i++) {\n      forecast.push({\n        hour: i,\n        solar: i >= 6 && i <= 18 ? 600 * Math.sin((i - 6) * Math.PI / 12) : 0,\n        wind: 200 + Math.random() * 300,\n        confidence: 0.75\n      });\n    }\n    \n    return forecast;\n  }\n\n  generatePriceForecast(timeHorizon) {\n    const hours = this.parseTimeHorizon(timeHorizon);\n    const forecast = [];\n    \n    for (let i = 0; i < hours; i++) {\n      const basePrice = 0.5;\n      const peakMultiplier = (i >= 8 && i <= 11) || (i >= 18 && i <= 21) ? 1.5 : 1.0;\n      forecast.push({\n        hour: i,\n        price: basePrice * peakMultiplier + Math.random() * 0.1,\n        confidence: 0.9\n      });\n    }\n    \n    return forecast;\n  }\n\n  generateWeatherForecast(timeHorizon) {\n    return {\n      temperature: 25,\n      humidity: 60,\n      wind_speed: 5,\n      cloud_cover: 0.3,\n      precipitation: 0\n    };\n  }\n\n  parseTimeHorizon(timeHorizon) {\n    const unit = timeHorizon.slice(-1);\n    const value = parseInt(timeHorizon.slice(0, -1));\n    \n    switch (unit) {\n      case 'h': return value;\n      case 'd': return value * MATH_CONSTANTS.TWENTY_FOUR;\n      case 'w': return value * MATH_CONSTANTS.SEVEN * MATH_CONSTANTS.TWENTY_FOUR;\n      default: return MATH_CONSTANTS.TWENTY_FOUR;\n    }\n  }\n\n  async getAllParks() {\n    return [{ id: 'park_001', name: 'Á§∫‰æãÂõ≠Âå∫' }];\n  }\n\n  async getRealTimeData(parkId) {\n    return {\n      current_load: 2000 + Math.random() * 400,\n      renewable_output: 800 + Math.random() * 200,\n      grid_price: 0.6 + Math.random() * 0.4,\n      battery_soc: 0.6 + Math.random() * 0.3,\n      timestamp: new Date().toISOString()\n    };\n  }\n\n  checkAdjustmentNeeded(parkId, realTimeData) {\n    // ÁÆÄÂåñÁöÑË∞ÉÊï¥ÈúÄÊ±ÇÊ£ÄÊü•\n    const currentSchedule = this.realTimeSchedule.get(parkId);\n    if (!currentSchedule) return true;\n    \n    // Ê£ÄÊü•Ë¥üËç∑ÂÅèÂ∑Æ\n    const loadDeviation = Math.abs(realTimeData.current_load - currentSchedule.expected_load) / currentSchedule.expected_load;\n    \n    return loadDeviation > 0.1; // ÂÅèÂ∑ÆË∂ÖËøá10%ÈúÄË¶ÅË∞ÉÊï¥\n  }\n\n  async executeQuickOptimization(parkId, realTimeData) {\n    // ÁÆÄÂåñÁöÑÂø´ÈÄü‰ºòÂåñ\n    return {\n      park_id: parkId,\n      optimization_time: new Date().toISOString(),\n      expected_load: realTimeData.current_load,\n      battery_command: realTimeData.battery_soc > 0.8 ? 'discharge' : 'charge',\n      grid_command: realTimeData.current_load > 2200 ? 'import' : 'export',\n      renewable_utilization: Math.min(realTimeData.renewable_output, realTimeData.current_load)\n    };\n  }\n\n  async sendSchedulingCommands(parkId, optimization) {\n    // Ê®°ÊãüÂèëÈÄÅË∞ÉÂ∫¶Êåá‰ª§\n    logger.info(`ÂèëÈÄÅË∞ÉÂ∫¶Êåá‰ª§Âà∞Âõ≠Âå∫ ${parkId}: ÁîµÊ±†${optimization.battery_command}, ÁîµÁΩë${optimization.grid_command}`);\n  }\n\n  async evaluateTriggerConditions(parkId) {\n    const realTimeData = await this.getRealTimeData(parkId);\n    const triggers = [];\n    \n    // ‰ª∑Ê†ºËß¶Âèë\n    if (realTimeData.grid_price > 0.8) {\n      triggers.push({\n        triggered: true,\n        response_type: 'price_based',\n        event: {\n          type: 'high_price',\n          value: realTimeData.grid_price,\n          threshold: 0.8\n        }\n      });\n    }\n    \n    return triggers;\n  }\n\n  // ÂÖ∂‰ªñËæÖÂä©ÊñπÊ≥ïÁöÑÁÆÄÂåñÂÆûÁé∞\n  async evaluateSchedulingPlan(schedulingPlan, objectives) {\n    return {\n      cost_reduction: 15.5,\n      emission_reduction: 12.3,\n      efficiency_gain: 8.7,\n      reliability_improvement: 5.2\n    };\n  }\n\n  generateImplementationRecommendations(schedulingPlan) {\n    return [\n      '‰ºòÂÖàÊâßË°åÂÇ®ËÉΩÂÖÖÊîæÁîµË∞ÉÂ∫¶',\n      'ÂØÜÂàáÁõëÊéßÂèØÂÜçÁîüËÉΩÊ∫êÂá∫Âäõ',\n      'ÂáÜÂ§áÈúÄÊ±ÇÂìçÂ∫îÂ§áÁî®ÊñπÊ°à'\n    ];\n  }\n\n  async assessImplementationRisks(schedulingPlan) {\n    return {\n      technical_risks: ['ËÆæÂ§áÊïÖÈöúÈ£éÈô©', 'ÈÄö‰ø°‰∏≠Êñ≠È£éÈô©'],\n      market_risks: ['Áîµ‰ª∑Ê≥¢Âä®È£éÈô©', 'ÈúÄÊ±ÇÈ¢ÑÊµãÂÅèÂ∑Æ'],\n      operational_risks: ['‰∫∫ÂëòÊìç‰ΩúÈ£éÈô©', 'Á≥ªÁªüÂìçÂ∫îÂª∂Ëøü']\n    };\n  }\n\n  defineMonitoringMetrics(schedulingPlan) {\n    return [\n      'real_time_load_tracking',\n      'renewable_output_monitoring',\n      'battery_soc_monitoring',\n      'grid_interaction_tracking',\n      'cost_performance_tracking'\n    ];\n  }\n}\n\nexport default EnergyOptimizationScheduler;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/core/services/GreenElectricityTracing.js","messages":[{"ruleId":"object-shorthand","severity":2,"message":"Expected property shorthand.","line":181,"column":9,"nodeType":"Property","messageId":"expectedPropertyShorthand","endLine":181,"endColumn":23,"fix":{"range":[4611,4625],"text":"amount"}},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.85.","line":190,"column":54,"nodeType":"Literal","messageId":"noMagic","endLine":190,"endColumn":58},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":296,"column":35,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":296,"endColumn":41,"fix":{"range":[8551,8557],"text":"{break;}"}},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 36.","line":509,"column":78,"nodeType":"Literal","messageId":"noMagic","endLine":509,"endColumn":80},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 9.","line":509,"column":92,"nodeType":"Literal","messageId":"noMagic","endLine":509,"endColumn":93},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 36.","line":513,"column":75,"nodeType":"Literal","messageId":"noMagic","endLine":513,"endColumn":77},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 9.","line":513,"column":89,"nodeType":"Literal","messageId":"noMagic","endLine":513,"endColumn":90},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 36.","line":517,"column":81,"nodeType":"Literal","messageId":"noMagic","endLine":517,"endColumn":83},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 9.","line":517,"column":95,"nodeType":"Literal","messageId":"noMagic","endLine":517,"endColumn":96},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: -6.","line":534,"column":47,"nodeType":"UnaryExpression","messageId":"noMagic","endLine":534,"endColumn":49},{"ruleId":"no-unused-vars","severity":2,"message":"'location' is defined but never used. Allowed unused args must match /^_/u.","line":586,"column":24,"nodeType":"Identifier","messageId":"unusedVar","endLine":586,"endColumn":32},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.05.","line":602,"column":33,"nodeType":"Literal","messageId":"noMagic","endLine":602,"endColumn":37},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.8.","line":608,"column":31,"nodeType":"Literal","messageId":"noMagic","endLine":608,"endColumn":34},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.6.","line":614,"column":46,"nodeType":"Literal","messageId":"noMagic","endLine":614,"endColumn":49},{"ruleId":"prefer-template","severity":2,"message":"Unexpected string concatenation.","line":616,"column":23,"nodeType":"BinaryExpression","messageId":"unexpectedStringConcatenation","endLine":616,"endColumn":51,"fix":{"range":[19654,19682],"text":"`GT_solar_001_${  Date.now()}`"}},{"ruleId":"prefer-template","severity":2,"message":"Unexpected string concatenation.","line":617,"column":27,"nodeType":"BinaryExpression","messageId":"unexpectedStringConcatenation","endLine":617,"endColumn":55,"fix":{"range":[19710,19738],"text":"`GC_solar_001_${  Date.now()}`"}},{"ruleId":"no-unused-vars","severity":2,"message":"'sourceId' is defined but never used. Allowed unused args must match /^_/u.","line":631,"column":35,"nodeType":"Identifier","messageId":"unusedVar","endLine":631,"endColumn":43},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 800.","line":633,"column":38,"nodeType":"Literal","messageId":"noMagic","endLine":633,"endColumn":41},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":634,"column":41,"nodeType":"Literal","messageId":"noMagic","endLine":634,"endColumn":44},{"ruleId":"no-unused-vars","severity":2,"message":"'consumerId' is defined but never used. Allowed unused args must match /^_/u.","line":645,"column":36,"nodeType":"Identifier","messageId":"unusedVar","endLine":645,"endColumn":46},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":647,"column":38,"nodeType":"Literal","messageId":"noMagic","endLine":647,"endColumn":42},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 200.","line":648,"column":41,"nodeType":"Literal","messageId":"noMagic","endLine":648,"endColumn":44},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 80.","line":658,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":658,"endColumn":20},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":658,"column":22,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":658,"endColumn":34,"fix":{"range":[20697,20709],"text":"{return 'A+';}"}},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":659,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":659,"endColumn":20},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":659,"column":22,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":659,"endColumn":33,"fix":{"range":[20731,20742],"text":"{return 'A';}"}},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 40.","line":660,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":660,"endColumn":20},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":660,"column":22,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":660,"endColumn":33,"fix":{"range":[20764,20775],"text":"{return 'B';}"}},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 20.","line":661,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":661,"endColumn":20},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":661,"column":22,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":661,"endColumn":33,"fix":{"range":[20797,20808],"text":"{return 'C';}"}}],"suppressedMessages":[],"errorCount":11,"fatalErrorCount":0,"warningCount":19,"fixableErrorCount":8,"fixableWarningCount":0,"source":"/**\n * ÁªøÁîµÊ∫ØÊ∫ê‰∏éËÆ§ËØÅÊ®°Âùó\n * ÂÆûÁé∞ÁªøËâ≤ÁîµÂäõÊù•Ê∫êËøΩË∏™„ÄÅÁªøËØÅÁÆ°ÁêÜÂíåÂèØÂÜçÁîüËÉΩÊ∫êÊ∂àË¥πÂç†ÊØîËÆ°ÁÆó\n * ÊîØÊåÅÂõΩÂÆ∂ÁªøÁîµ‰∫§ÊòìÂπ≥Âè∞ÂØπÊé•ÂíåÁªøËØÅËá™Âä®ÂåñÁÆ°ÁêÜ\n */\n\nimport { EventEmitter } from 'events';\nimport logger from '../../shared/utils/logger.js';\nimport { ENERGY_CONSTANTS, MATH_CONSTANTS } from '../../shared/constants/MathConstants.js';\n\nclass GreenElectricityTracing extends EventEmitter {\n  constructor() {\n    super();\n    this.isInitialized = false;\n    this.greenPowerSources = new Map(); // ÁªøÁîµÊ∫êÂ§¥\n    this.greenCertificates = new Map(); // ÁªøËØÅÁÆ°ÁêÜ\n    this.consumptionRecords = new Map(); // Ê∂àË¥πËÆ∞ÂΩï\n    this.tracingChain = new Map(); // Ê∫ØÊ∫êÈìæ\n    this.renewableRatio = 0; // ÂèØÂÜçÁîüËÉΩÊ∫êÊ∂àË¥πÂç†ÊØî\n    \n    // ÁªøÁîµÁ±ªÂûãÈÖçÁΩÆ\n    this.greenPowerTypes = {\n      solar: {\n        name: 'Â§™Èò≥ËÉΩÂèëÁîµ',\n        code: 'PV',\n        carbon_factor: 0, // kgCO2/kWh\n        certificate_type: 'solar_cert',\n        color: '#FFD700',\n        icon: '‚òÄÔ∏è'\n      },\n      wind: {\n        name: 'È£éÂäõÂèëÁîµ',\n        code: 'WD',\n        carbon_factor: 0,\n        certificate_type: 'wind_cert',\n        color: '#87CEEB',\n        icon: 'üí®'\n      },\n      hydro: {\n        name: 'Ê∞¥ÂäõÂèëÁîµ',\n        code: 'HY',\n        carbon_factor: 0,\n        certificate_type: 'hydro_cert',\n        color: '#4682B4',\n        icon: 'üíß'\n      },\n      biomass: {\n        name: 'ÁîüÁâ©Ë¥®ÂèëÁîµ',\n        code: 'BM',\n        carbon_factor: 0,\n        certificate_type: 'biomass_cert',\n        color: '#228B22',\n        icon: 'üå±'\n      },\n      geothermal: {\n        name: 'Âú∞ÁÉ≠ÂèëÁîµ',\n        code: 'GT',\n        carbon_factor: 0,\n        certificate_type: 'geothermal_cert',\n        color: '#CD853F',\n        icon: 'üåã'\n      }\n    };\n    \n    // ÁªøËØÅÁä∂ÊÄÅ\n    this.certificateStatus = {\n      PENDING: 'pending',     // ÂæÖÂÆ°Ê†∏\n      ACTIVE: 'active',       // ÊúâÊïà\n      USED: 'used',          // Â∑≤‰ΩøÁî®\n      EXPIRED: 'expired',     // Â∑≤ËøáÊúü\n      CANCELLED: 'cancelled'  // Â∑≤ÂèñÊ∂à\n    };\n    \n    this.init();\n  }\n\n  async init() {\n    try {\n      await this.loadGreenPowerSources();\n      await this.loadGreenCertificates();\n      await this.setupRealTimeTracing();\n      this.isInitialized = true;\n      logger.info('ÁªøÁîµÊ∫ØÊ∫ê‰∏éËÆ§ËØÅÊ®°ÂùóÂàùÂßãÂåñÂÆåÊàê');\n      this.emit('initialized');\n    } catch (error) {\n      logger.error('ÁªøÁîµÊ∫ØÊ∫êÊ®°ÂùóÂàùÂßãÂåñÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Âä†ËΩΩÁªøÁîµÊ∫êÂ§¥Êï∞ÊçÆ\n   */\n  async loadGreenPowerSources() {\n    try {\n      const sources = await this.getGreenPowerSourceDevices();\n      sources.forEach(source => {\n        this.greenPowerSources.set(source.id, {\n          ...source,\n          type_config: this.greenPowerTypes[source.power_type] || {},\n          generation_records: [],\n          certificates: [],\n          real_time_generation: 0,\n          cumulative_generation: 0,\n          last_update: new Date().toISOString()\n        });\n      });\n      \n      logger.info(`Â∑≤Âä†ËΩΩÁªøÁîµÊ∫êÂ§¥ËÆæÂ§á ${this.greenPowerSources.size} ‰∏™`);\n    } catch (error) {\n      logger.error('Âä†ËΩΩÁªøÁîµÊ∫êÂ§¥Êï∞ÊçÆÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Âä†ËΩΩÁªøËØÅÊï∞ÊçÆ\n   */\n  async loadGreenCertificates() {\n    try {\n      const certificates = await this.getGreenCertificateRecords();\n      certificates.forEach(cert => {\n        this.greenCertificates.set(cert.id, {\n          ...cert,\n          tracing_chain: [],\n          usage_records: [],\n          remaining_amount: cert.amount\n        });\n      });\n      \n      logger.info(`Â∑≤Âä†ËΩΩÁªøËØÅËÆ∞ÂΩï ${this.greenCertificates.size} ‰∏™`);\n    } catch (error) {\n      logger.error('Âä†ËΩΩÁªøËØÅÊï∞ÊçÆÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * ËÆæÁΩÆÂÆûÊó∂Ê∫ØÊ∫êÁõëÊéß\n   */\n  async setupRealTimeTracing() {\n    // ÊØèÂàÜÈíüÊõ¥Êñ∞‰∏ÄÊ¨°ÁªøÁîµÊ∫ØÊ∫êÊï∞ÊçÆ\n    setInterval(async () => {\n      try {\n        await this.updateRealTimeGeneration();\n        await this.updateConsumptionTracing();\n        await this.calculateRenewableRatio();\n        this.emit('tracing_updated', {\n          renewable_ratio: this.renewableRatio,\n          timestamp: new Date().toISOString()\n        });\n      } catch (error) {\n        logger.error('Êõ¥Êñ∞ÂÆûÊó∂Ê∫ØÊ∫êÊï∞ÊçÆÂ§±Ë¥•:', error);\n      }\n    }, MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.MILLISECONDS_PER_SECOND);\n  }\n\n  /**\n   * ÂàõÂª∫ÁªøÁîµÊ∫ØÊ∫êËÆ∞ÂΩï\n   * @param {string} sourceId - ÁªøÁîµÊ∫êÂ§¥ID\n   * @param {number} amount - ÂèëÁîµÈáè(kWh)\n   * @param {string} timestamp - Êó∂Èó¥Êà≥\n   * @returns {Object} Ê∫ØÊ∫êËÆ∞ÂΩï\n   */\n  async createGreenPowerRecord(sourceId, amount, timestamp = new Date().toISOString()) {\n    try {\n      const source = this.greenPowerSources.get(sourceId);\n      if (!source) {\n        throw new Error(`ÁªøÁîµÊ∫êÂ§¥‰∏çÂ≠òÂú®: ${sourceId}`);\n      }\n\n      // ÁîüÊàêÂîØ‰∏ÄÊ∫ØÊ∫êID\n      const tracingId = this.generateTracingId(sourceId, timestamp);\n      \n      // ÂàõÂª∫Ê∫ØÊ∫êËÆ∞ÂΩï\n      const record = {\n        id: tracingId,\n        source_id: sourceId,\n        source_name: source.name,\n        power_type: source.power_type,\n        amount: amount,\n        unit: 'kWh',\n        generation_time: timestamp,\n        carbon_reduction: amount * (ENERGY_CONSTANTS.GRID_EMISSION_FACTOR - source.type_config.carbon_factor),\n        certificate_eligible: amount >= ENERGY_CONSTANTS.MIN_CERTIFICATE_AMOUNT,\n        tracing_hash: this.generateTracingHash(sourceId, amount, timestamp),\n        status: 'generated',\n        metadata: {\n          weather_conditions: await this.getWeatherData(source.location),\n          equipment_efficiency: source.efficiency || 0.85,\n          grid_connection_point: source.grid_connection,\n          measurement_device: source.meter_id\n        }\n      };\n\n      // Êõ¥Êñ∞Ê∫êÂ§¥Á¥ØËÆ°ÂèëÁîµÈáè\n      source.cumulative_generation += amount;\n      source.generation_records.push(record);\n      source.last_update = timestamp;\n\n      // Ê∑ªÂä†Âà∞Ê∫ØÊ∫êÈìæ\n      this.tracingChain.set(tracingId, record);\n\n      // Â¶ÇÊûúÊª°Ë∂≥ÁªøËØÅÊù°‰ª∂ÔºåËá™Âä®Áî≥ËØ∑ÁªøËØÅ\n      if (record.certificate_eligible) {\n        await this.applyForGreenCertificate(record);\n      }\n\n      logger.info(`ÂàõÂª∫ÁªøÁîµÊ∫ØÊ∫êËÆ∞ÂΩï: ${tracingId}, ÂèëÁîµÈáè: ${amount}kWh`);\n      this.emit('green_power_generated', record);\n      \n      return record;\n    } catch (error) {\n      logger.error('ÂàõÂª∫ÁªøÁîµÊ∫ØÊ∫êËÆ∞ÂΩïÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Áî≥ËØ∑ÁªøËâ≤ÁîµÂäõËØÅ‰π¶\n   * @param {Object} generationRecord - ÂèëÁîµËÆ∞ÂΩï\n   * @returns {Object} ÁªøËØÅÁî≥ËØ∑ÁªìÊûú\n   */\n  async applyForGreenCertificate(generationRecord) {\n    try {\n      const certificateId = this.generateCertificateId(generationRecord);\n      \n      const certificate = {\n        id: certificateId,\n        generation_record_id: generationRecord.id,\n        source_id: generationRecord.source_id,\n        power_type: generationRecord.power_type,\n        amount: generationRecord.amount,\n        unit: 'MWh', // ÁªøËØÅ‰ª•MWh‰∏∫Âçï‰Ωç\n        certificate_amount: Math.floor(generationRecord.amount / MATH_CONSTANTS.THOUSAND), // 1MWh = 1000kWh\n        issue_date: new Date().toISOString(),\n        valid_until: this.calculateCertificateExpiry(),\n        status: this.certificateStatus.PENDING,\n        issuer: 'National Green Certificate Authority',\n        certificate_number: this.generateCertificateNumber(generationRecord),\n        verification_data: {\n          generation_hash: generationRecord.tracing_hash,\n          measurement_verification: true,\n          third_party_audit: false,\n          blockchain_record: this.generateBlockchainRecord(generationRecord)\n        },\n        trading_info: {\n          tradeable: true,\n          market_price: await this.getCurrentMarketPrice(generationRecord.power_type),\n          trading_platform: 'National Green Power Trading Platform'\n        }\n      };\n\n      // ‰øùÂ≠òÁªøËØÅ\n      this.greenCertificates.set(certificateId, certificate);\n      \n      // Êõ¥Êñ∞Ê∫êÂ§¥ÁªøËØÅÂàóË°®\n      const source = this.greenPowerSources.get(generationRecord.source_id);\n      if (source) {\n        source.certificates.push(certificateId);\n      }\n\n      logger.info(`Áî≥ËØ∑ÁªøËØÅ: ${certificateId}, Êï∞Èáè: ${certificate.certificate_amount}MWh`);\n      this.emit('certificate_applied', certificate);\n      \n      return certificate;\n    } catch (error) {\n      logger.error('Áî≥ËØ∑ÁªøËØÅÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * ÁªøÁîµÊ∂àË¥πÊ∫ØÊ∫ê\n   * @param {string} consumerId - Ê∂àË¥πËÄÖID\n   * @param {number} amount - Ê∂àË¥πÈáè(kWh)\n   * @param {string} timestamp - Êó∂Èó¥Êà≥\n   * @returns {Object} Ê∂àË¥πÊ∫ØÊ∫êÁªìÊûú\n   */\n  async traceGreenPowerConsumption(consumerId, amount, timestamp = new Date().toISOString()) {\n    try {\n      // Ëé∑ÂèñÂèØÁî®ÁöÑÁªøÁîµ\n      const availableGreenPower = await this.getAvailableGreenPower(amount);\n      \n      if (availableGreenPower.total < amount) {\n        logger.warn(`ÁªøÁîµ‰æõÂ∫î‰∏çË∂≥: ÈúÄÊ±Ç${amount}kWh, ÂèØÁî®${availableGreenPower.total}kWh`);\n      }\n\n      const consumptionId = this.generateConsumptionId(consumerId, timestamp);\n      const tracingSources = [];\n      let remainingAmount = amount;\n      let greenAmount = 0;\n\n      // Êåâ‰ºòÂÖàÁ∫ßÂàÜÈÖçÁªøÁîµ\n      for (const source of availableGreenPower.sources) {\n        if (remainingAmount <= 0) break;\n        \n        const allocatedAmount = Math.min(remainingAmount, source.available_amount);\n        if (allocatedAmount > 0) {\n          tracingSources.push({\n            source_id: source.source_id,\n            source_name: source.source_name,\n            power_type: source.power_type,\n            amount: allocatedAmount,\n            generation_time: source.generation_time,\n            tracing_id: source.tracing_id,\n            certificate_id: source.certificate_id\n          });\n          \n          greenAmount += allocatedAmount;\n          remainingAmount -= allocatedAmount;\n          \n          // Êõ¥Êñ∞Ê∫ØÊ∫êÈìæ‰ΩøÁî®Áä∂ÊÄÅ\n          await this.updateTracingChainUsage(source.tracing_id, allocatedAmount);\n        }\n      }\n\n      // ÂàõÂª∫Ê∂àË¥πÊ∫ØÊ∫êËÆ∞ÂΩï\n      const consumptionRecord = {\n        id: consumptionId,\n        consumer_id: consumerId,\n        total_consumption: amount,\n        green_consumption: greenAmount,\n        grid_consumption: amount - greenAmount,\n        green_ratio: (greenAmount / amount * MATH_CONSTANTS.ONE_HUNDRED).toFixed(MATH_CONSTANTS.DECIMAL_PLACES),\n        consumption_time: timestamp,\n        tracing_sources: tracingSources,\n        carbon_emission: {\n          green_power: 0, // ÁªøÁîµÈõ∂ÊéíÊîæ\n          grid_power: (amount - greenAmount) * ENERGY_CONSTANTS.GRID_EMISSION_FACTOR,\n          total: (amount - greenAmount) * ENERGY_CONSTANTS.GRID_EMISSION_FACTOR,\n          reduction: greenAmount * ENERGY_CONSTANTS.GRID_EMISSION_FACTOR\n        },\n        verification: {\n          verified: true,\n          verification_time: timestamp,\n          verification_method: 'automatic_tracing',\n          blockchain_hash: this.generateConsumptionHash(consumerId, amount, timestamp)\n        }\n      };\n\n      // ‰øùÂ≠òÊ∂àË¥πËÆ∞ÂΩï\n      this.consumptionRecords.set(consumptionId, consumptionRecord);\n\n      logger.info(`ÁªøÁîµÊ∂àË¥πÊ∫ØÊ∫êÂÆåÊàê: ${consumptionId}, ÁªøÁîµÂç†ÊØî: ${consumptionRecord.green_ratio}%`);\n      this.emit('consumption_traced', consumptionRecord);\n      \n      return consumptionRecord;\n    } catch (error) {\n      logger.error('ÁªøÁîµÊ∂àË¥πÊ∫ØÊ∫êÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * ËÆ°ÁÆóÂèØÂÜçÁîüËÉΩÊ∫êÊ∂àË¥πÂç†ÊØî\n   * @param {string} parkId - Âõ≠Âå∫ID\n   * @param {string} timeRange - Êó∂Èó¥ËåÉÂõ¥\n   * @returns {Object} ÂèØÂÜçÁîüËÉΩÊ∫êÊ∂àË¥πÂç†ÊØîÊï∞ÊçÆ\n   */\n  async calculateRenewableRatio(parkId, timeRange = '24h') {\n    try {\n      const endTime = new Date();\n      const startTime = new Date(endTime.getTime() - this.parseTimeRange(timeRange));\n      \n      // Ëé∑ÂèñÊó∂Èó¥ËåÉÂõ¥ÂÜÖÁöÑÊ∂àË¥πËÆ∞ÂΩï\n      const consumptionRecords = Array.from(this.consumptionRecords.values())\n        .filter(record => {\n          const recordTime = new Date(record.consumption_time);\n          return recordTime >= startTime && recordTime <= endTime;\n        });\n\n      // ËÆ°ÁÆóÊÄªÊ∂àË¥πÂíåÁªøÁîµÊ∂àË¥π\n      const totalConsumption = consumptionRecords.reduce((sum, record) => sum + record.total_consumption, 0);\n      const greenConsumption = consumptionRecords.reduce((sum, record) => sum + record.green_consumption, 0);\n      const gridConsumption = totalConsumption - greenConsumption;\n\n      // ÊåâÁîµÂäõÁ±ªÂûãÁªüËÆ°\n      const consumptionByType = {};\n      consumptionRecords.forEach(record => {\n        record.tracing_sources.forEach(source => {\n          if (!consumptionByType[source.power_type]) {\n            consumptionByType[source.power_type] = 0;\n          }\n          consumptionByType[source.power_type] += source.amount;\n        });\n      });\n\n      // ËÆ°ÁÆóÁ¢≥ÂáèÊéí\n      const totalCarbonReduction = consumptionRecords.reduce((sum, record) => {\n        return sum + record.carbon_emission.reduction;\n      }, 0);\n\n      const renewableRatioData = {\n        park_id: parkId,\n        time_range: timeRange,\n        start_time: startTime.toISOString(),\n        end_time: endTime.toISOString(),\n        total_consumption: totalConsumption,\n        green_consumption: greenConsumption,\n        grid_consumption: gridConsumption,\n        renewable_ratio: totalConsumption > 0 ? \n          (greenConsumption / totalConsumption * MATH_CONSTANTS.ONE_HUNDRED).toFixed(MATH_CONSTANTS.DECIMAL_PLACES) : 0,\n        consumption_by_type: consumptionByType,\n        carbon_impact: {\n          total_reduction: totalCarbonReduction,\n          equivalent_trees: Math.floor(totalCarbonReduction / ENERGY_CONSTANTS.TREE_CARBON_ABSORPTION),\n          avoided_coal: (totalCarbonReduction / ENERGY_CONSTANTS.COAL_EMISSION_FACTOR).toFixed(MATH_CONSTANTS.DECIMAL_PLACES)\n        },\n        compliance_status: {\n          national_target: ENERGY_CONSTANTS.NATIONAL_RENEWABLE_TARGET, // ÂõΩÂÆ∂ÂèØÂÜçÁîüËÉΩÊ∫êÁõÆÊ†á\n          current_achievement: (greenConsumption / totalConsumption * MATH_CONSTANTS.ONE_HUNDRED).toFixed(MATH_CONSTANTS.DECIMAL_PLACES),\n          gap_to_target: Math.max(0, ENERGY_CONSTANTS.NATIONAL_RENEWABLE_TARGET - (greenConsumption / totalConsumption * MATH_CONSTANTS.ONE_HUNDRED)).toFixed(MATH_CONSTANTS.DECIMAL_PLACES)\n        }\n      };\n\n      // Êõ¥Êñ∞ÂÖ®Â±ÄÂèØÂÜçÁîüËÉΩÊ∫êÂç†ÊØî\n      this.renewableRatio = parseFloat(renewableRatioData.renewable_ratio);\n\n      return renewableRatioData;\n    } catch (error) {\n      logger.error('ËÆ°ÁÆóÂèØÂÜçÁîüËÉΩÊ∫êÊ∂àË¥πÂç†ÊØîÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * ÁîüÊàêÁªøÁîµÊ∂àË¥πËØÅÊòéÊä•Âëä\n   * @param {string} consumerId - Ê∂àË¥πËÄÖID\n   * @param {string} timeRange - Êó∂Èó¥ËåÉÂõ¥\n   * @returns {Object} ÁªøÁîµÊ∂àË¥πËØÅÊòé\n   */\n  async generateGreenPowerCertificate(consumerId, timeRange = '1M') {\n    try {\n      const renewableData = await this.calculateRenewableRatio(consumerId, timeRange);\n      \n      const certificate = {\n        certificate_id: this.generateCertificateId({ source_id: consumerId, timestamp: new Date().toISOString() }),\n        consumer_id: consumerId,\n        issue_date: new Date().toISOString(),\n        period: {\n          start_date: renewableData.start_time,\n          end_date: renewableData.end_time,\n          duration: timeRange\n        },\n        consumption_summary: {\n          total_consumption: renewableData.total_consumption,\n          green_consumption: renewableData.green_consumption,\n          renewable_ratio: renewableData.renewable_ratio,\n          consumption_breakdown: renewableData.consumption_by_type\n        },\n        environmental_impact: renewableData.carbon_impact,\n        compliance_verification: {\n          verified_by: 'Green Electricity Tracing System',\n          verification_method: 'Blockchain-based Tracing',\n          verification_date: new Date().toISOString(),\n          compliance_score: this.calculateComplianceScore(renewableData)\n        },\n        digital_signature: this.generateDigitalSignature(renewableData),\n        qr_code: this.generateQRCode(renewableData)\n      };\n\n      return certificate;\n    } catch (error) {\n      logger.error('ÁîüÊàêÁªøÁîµÊ∂àË¥πËØÅÊòéÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Êõ¥Êñ∞ÂÆûÊó∂ÂèëÁîµÊï∞ÊçÆ\n   */\n  async updateRealTimeGeneration() {\n    try {\n      for (const [sourceId, source] of this.greenPowerSources) {\n        const realTimeData = await this.getRealTimeGenerationData(sourceId);\n        source.real_time_generation = realTimeData.current_power;\n        \n        // Â¶ÇÊûúÊúâÊñ∞ÁöÑÂèëÁîµÈáèÔºåÂàõÂª∫Ê∫ØÊ∫êËÆ∞ÂΩï\n        if (realTimeData.energy_increment > 0) {\n          await this.createGreenPowerRecord(sourceId, realTimeData.energy_increment);\n        }\n      }\n    } catch (error) {\n      logger.error('Êõ¥Êñ∞ÂÆûÊó∂ÂèëÁîµÊï∞ÊçÆÂ§±Ë¥•:', error);\n    }\n  }\n\n  /**\n   * Êõ¥Êñ∞Ê∂àË¥πÊ∫ØÊ∫ê\n   */\n  async updateConsumptionTracing() {\n    try {\n      const consumers = await this.getActiveConsumers();\n      \n      for (const consumer of consumers) {\n        const consumptionData = await this.getRealTimeConsumptionData(consumer.id);\n        if (consumptionData.energy_increment > 0) {\n          await this.traceGreenPowerConsumption(consumer.id, consumptionData.energy_increment);\n        }\n      }\n    } catch (error) {\n      logger.error('Êõ¥Êñ∞Ê∂àË¥πÊ∫ØÊ∫êÂ§±Ë¥•:', error);\n    }\n  }\n\n  // ËæÖÂä©ÊñπÊ≥ï\n  generateTracingId(sourceId, timestamp) {\n    return `GT_${sourceId}_${Date.parse(timestamp)}_${Math.random().toString(36).substr(2, 9)}`;\n  }\n\n  generateCertificateId(record) {\n    return `GC_${record.source_id}_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n  }\n\n  generateConsumptionId(consumerId, timestamp) {\n    return `GCT_${consumerId}_${Date.parse(timestamp)}_${Math.random().toString(36).substr(2, 9)}`;\n  }\n\n  generateTracingHash(sourceId, amount, timestamp) {\n    // ÁÆÄÂåñÁöÑÂìàÂ∏åÁîüÊàêÔºåÂÆûÈôÖÂ∫îÁî®‰∏≠Â∫î‰ΩøÁî®Âä†ÂØÜÂìàÂ∏å\n    return `hash_${sourceId}_${amount}_${timestamp}`.replace(/[^a-zA-Z0-9]/g, '').toLowerCase();\n  }\n\n  generateConsumptionHash(consumerId, amount, timestamp) {\n    return `chash_${consumerId}_${amount}_${timestamp}`.replace(/[^a-zA-Z0-9]/g, '').toLowerCase();\n  }\n\n  generateCertificateNumber(record) {\n    const date = new Date(record.generation_time);\n    const year = date.getFullYear();\n    const month = String(date.getMonth() + 1).padStart(2, '0');\n    const typeCode = this.greenPowerTypes[record.power_type]?.code || 'XX';\n    const sequence = String(Date.now()).slice(-6);\n    return `${year}${month}${typeCode}${sequence}`;\n  }\n\n  calculateCertificateExpiry() {\n    const expiry = new Date();\n    expiry.setFullYear(expiry.getFullYear() + 1); // ÁªøËØÅÊúâÊïàÊúü1Âπ¥\n    return expiry.toISOString();\n  }\n\n  parseTimeRange(timeRange) {\n    const unit = timeRange.slice(-1);\n    const value = parseInt(timeRange.slice(0, -1));\n    \n    switch (unit) {\n      case 'h': return value * MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.MILLISECONDS_PER_SECOND;\n      case 'd': return value * MATH_CONSTANTS.TWENTY_FOUR * MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.MILLISECONDS_PER_SECOND;\n      case 'M': return value * MATH_CONSTANTS.THIRTY * MATH_CONSTANTS.TWENTY_FOUR * MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.MILLISECONDS_PER_SECOND;\n      default: return MATH_CONSTANTS.TWENTY_FOUR * MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.MILLISECONDS_PER_SECOND;\n    }\n  }\n\n  // Ê®°ÊãüÊï∞ÊçÆËé∑ÂèñÊñπÊ≥ï\n  async getGreenPowerSourceDevices() {\n    return [\n      {\n        id: 'solar_001',\n        name: 'Â±ãÈ°∂ÂÖâ‰ºèÁîµÁ´ô',\n        power_type: 'solar',\n        capacity: 1000,\n        efficiency: 0.85,\n        location: { lat: 39.9042, lng: 116.4074 },\n        grid_connection: 'main_grid',\n        meter_id: 'meter_001'\n      },\n      {\n        id: 'wind_001',\n        name: 'Âõ≠Âå∫È£éÂäõÂèëÁîµ',\n        power_type: 'wind',\n        capacity: 500,\n        efficiency: 0.90,\n        location: { lat: 39.9042, lng: 116.4074 },\n        grid_connection: 'main_grid',\n        meter_id: 'meter_002'\n      }\n    ];\n  }\n\n  async getGreenCertificateRecords() {\n    return [];\n  }\n\n  async getWeatherData(location) {\n    return {\n      temperature: 25,\n      humidity: 60,\n      wind_speed: 5,\n      solar_irradiance: 800\n    };\n  }\n\n  async getCurrentMarketPrice(powerType) {\n    const prices = {\n      solar: 0.05,\n      wind: 0.04,\n      hydro: 0.03,\n      biomass: 0.06\n    };\n    return prices[powerType] || 0.05;\n  }\n\n  async getAvailableGreenPower(requiredAmount) {\n    // Ê®°ÊãüÂèØÁî®ÁªøÁîµÊï∞ÊçÆ\n    return {\n      total: requiredAmount * 0.8, // 80%ÁªøÁîµË¶ÜÁõñ\n      sources: [\n        {\n          source_id: 'solar_001',\n          source_name: 'Â±ãÈ°∂ÂÖâ‰ºèÁîµÁ´ô',\n          power_type: 'solar',\n          available_amount: requiredAmount * 0.6,\n          generation_time: new Date().toISOString(),\n          tracing_id: 'GT_solar_001_' + Date.now(),\n          certificate_id: 'GC_solar_001_' + Date.now()\n        }\n      ]\n    };\n  }\n\n  async updateTracingChainUsage(tracingId, amount) {\n    const record = this.tracingChain.get(tracingId);\n    if (record) {\n      record.used_amount = (record.used_amount || 0) + amount;\n      record.remaining_amount = record.amount - record.used_amount;\n    }\n  }\n\n  async getRealTimeGenerationData(sourceId) {\n    return {\n      current_power: Math.random() * 800,\n      energy_increment: Math.random() * 100\n    };\n  }\n\n  async getActiveConsumers() {\n    return [\n      { id: 'consumer_001', name: 'Â∑•ÂéÇ1' },\n      { id: 'consumer_002', name: 'ÂäûÂÖ¨Ê•º1' }\n    ];\n  }\n\n  async getRealTimeConsumptionData(consumerId) {\n    return {\n      current_power: Math.random() * 1000,\n      energy_increment: Math.random() * 200\n    };\n  }\n\n  generateBlockchainRecord(record) {\n    return `blockchain_${record.id}_${Date.now()}`;\n  }\n\n  calculateComplianceScore(data) {\n    const ratio = parseFloat(data.renewable_ratio);\n    if (ratio >= 80) return 'A+';\n    if (ratio >= 60) return 'A';\n    if (ratio >= 40) return 'B';\n    if (ratio >= 20) return 'C';\n    return 'D';\n  }\n\n  generateDigitalSignature(data) {\n    return `sig_${JSON.stringify(data).length}_${Date.now()}`;\n  }\n\n  generateQRCode(data) {\n    return `qr_${data.consumer_id}_${Date.now()}`;\n  }\n}\n\nexport default GreenElectricityTracing;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/core/services/MaintenanceManager.js","messages":[{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 15.","line":19,"column":25,"nodeType":"Literal","messageId":"noMagic","endLine":19,"endColumn":27},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":19,"column":30,"nodeType":"Literal","messageId":"noMagic","endLine":19,"endColumn":32},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":19,"column":35,"nodeType":"Literal","messageId":"noMagic","endLine":19,"endColumn":39},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":109,"column":52,"nodeType":"Literal","messageId":"noMagic","endLine":109,"endColumn":55},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":109,"column":59,"nodeType":"Literal","messageId":"noMagic","endLine":109,"endColumn":62},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":120,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":120,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[3272,3307],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 30.","line":128,"column":57,"nodeType":"Literal","messageId":"noMagic","endLine":128,"endColumn":59},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":165,"column":62,"nodeType":"Literal","messageId":"noMagic","endLine":165,"endColumn":65},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":165,"column":69,"nodeType":"Literal","messageId":"noMagic","endLine":165,"endColumn":72},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":177,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":177,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[5084,5116],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 120.","line":226,"column":30,"nodeType":"Literal","messageId":"noMagic","endLine":226,"endColumn":33},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":252,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":252,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[7028,7062],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 3.","line":264,"column":36,"nodeType":"Literal","messageId":"noMagic","endLine":264,"endColumn":37},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":302,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":302,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[8412,8446],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 50.","line":347,"column":45,"nodeType":"Literal","messageId":"noMagic","endLine":347,"endColumn":47},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":355,"column":93,"nodeType":"Literal","messageId":"noMagic","endLine":355,"endColumn":96},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.5.","line":360,"column":45,"nodeType":"Literal","messageId":"noMagic","endLine":360,"endColumn":48},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":406,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":406,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[11605,11639],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":469,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":469,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[13304,13338],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.5.","line":481,"column":14,"nodeType":"Literal","messageId":"noMagic","endLine":481,"endColumn":17},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.8.","line":485,"column":71,"nodeType":"Literal","messageId":"noMagic","endLine":485,"endColumn":74},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.95.","line":488,"column":67,"nodeType":"Literal","messageId":"noMagic","endLine":488,"endColumn":71},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.6.","line":491,"column":28,"nodeType":"Literal","messageId":"noMagic","endLine":491,"endColumn":31},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.4.","line":491,"column":46,"nodeType":"Literal","messageId":"noMagic","endLine":491,"endColumn":49},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.1.","line":510,"column":45,"nodeType":"Literal","messageId":"noMagic","endLine":510,"endColumn":48},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":512,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":512,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[14464,14499],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.5.","line":513,"column":14,"nodeType":"Literal","messageId":"noMagic","endLine":513,"endColumn":17},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.5.","line":522,"column":14,"nodeType":"Literal","messageId":"noMagic","endLine":522,"endColumn":17},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.8.","line":526,"column":78,"nodeType":"Literal","messageId":"noMagic","endLine":526,"endColumn":81},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.8.","line":537,"column":14,"nodeType":"Literal","messageId":"noMagic","endLine":537,"endColumn":17},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 80.","line":544,"column":30,"nodeType":"Literal","messageId":"noMagic","endLine":544,"endColumn":32},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.1.","line":545,"column":24,"nodeType":"Literal","messageId":"noMagic","endLine":545,"endColumn":27},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5.","line":549,"column":28,"nodeType":"Literal","messageId":"noMagic","endLine":549,"endColumn":29},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.1.","line":550,"column":24,"nodeType":"Literal","messageId":"noMagic","endLine":550,"endColumn":27},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.15.","line":555,"column":24,"nodeType":"Literal","messageId":"noMagic","endLine":555,"endColumn":28},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.5.","line":567,"column":14,"nodeType":"Literal","messageId":"noMagic","endLine":567,"endColumn":17},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":572,"column":65,"nodeType":"Literal","messageId":"noMagic","endLine":572,"endColumn":69},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":572,"column":72,"nodeType":"Literal","messageId":"noMagic","endLine":572,"endColumn":74},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":572,"column":77,"nodeType":"Literal","messageId":"noMagic","endLine":572,"endColumn":79},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 24.","line":572,"column":82,"nodeType":"Literal","messageId":"noMagic","endLine":572,"endColumn":84},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 30.","line":575,"column":36,"nodeType":"Literal","messageId":"noMagic","endLine":575,"endColumn":38},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":578,"column":36,"nodeType":"Literal","messageId":"noMagic","endLine":578,"endColumn":38},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.8.","line":579,"column":14,"nodeType":"Literal","messageId":"noMagic","endLine":579,"endColumn":17},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 90.","line":585,"column":36,"nodeType":"Literal","messageId":"noMagic","endLine":585,"endColumn":38},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.6.","line":586,"column":14,"nodeType":"Literal","messageId":"noMagic","endLine":586,"endColumn":17},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 180.","line":592,"column":36,"nodeType":"Literal","messageId":"noMagic","endLine":592,"endColumn":39},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.4.","line":593,"column":14,"nodeType":"Literal","messageId":"noMagic","endLine":593,"endColumn":17},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.2.","line":595,"column":12,"nodeType":"Literal","messageId":"noMagic","endLine":595,"endColumn":15},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.9.","line":606,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":606,"endColumn":21},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.8.","line":613,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":613,"endColumn":21},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.7.","line":620,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":620,"endColumn":21},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.6.","line":627,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":627,"endColumn":21},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.6.","line":645,"column":19,"nodeType":"Literal","messageId":"noMagic","endLine":645,"endColumn":22},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.4.","line":650,"column":29,"nodeType":"Literal","messageId":"noMagic","endLine":650,"endColumn":32},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 80.","line":668,"column":36,"nodeType":"Literal","messageId":"noMagic","endLine":668,"endColumn":38},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5.","line":682,"column":34,"nodeType":"Literal","messageId":"noMagic","endLine":682,"endColumn":35},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.7.","line":707,"column":37,"nodeType":"Literal","messageId":"noMagic","endLine":707,"endColumn":40},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.6.","line":720,"column":37,"nodeType":"Literal","messageId":"noMagic","endLine":720,"endColumn":40},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.5.","line":733,"column":37,"nodeType":"Literal","messageId":"noMagic","endLine":733,"endColumn":40},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.4.","line":768,"column":57,"nodeType":"Literal","messageId":"noMagic","endLine":768,"endColumn":60},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.1.","line":774,"column":46,"nodeType":"Literal","messageId":"noMagic","endLine":774,"endColumn":49},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.3.","line":774,"column":51,"nodeType":"Literal","messageId":"noMagic","endLine":774,"endColumn":54},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 8000.","line":783,"column":22,"nodeType":"Literal","messageId":"noMagic","endLine":783,"endColumn":26},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.2.","line":785,"column":22,"nodeType":"Literal","messageId":"noMagic","endLine":785,"endColumn":25},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.6.","line":802,"column":52,"nodeType":"Literal","messageId":"noMagic","endLine":802,"endColumn":55},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.7.","line":815,"column":47,"nodeType":"Literal","messageId":"noMagic","endLine":815,"endColumn":50},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 80.","line":825,"column":82,"nodeType":"Literal","messageId":"noMagic","endLine":825,"endColumn":84},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.3.","line":830,"column":53,"nodeType":"Literal","messageId":"noMagic","endLine":830,"endColumn":56},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":904,"column":49,"nodeType":"Literal","messageId":"noMagic","endLine":904,"endColumn":51},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":972,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":972,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[25380,25409],"text":""},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":70,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { dbPromise } from '../../infrastructure/database/index.js';\nimport { v4 as uuidv4 } from 'uuid';\n\n/**\n * Êô∫ËÉΩËøêÁª¥ÁÆ°ÁêÜÊ®°Âùó\n * Êèê‰æõËÆæÂ§áÊïÖÈöúÈ¢ÑÊµã„ÄÅÁª¥Êä§ËÆ°ÂàíÁÆ°ÁêÜ„ÄÅËøêÁª¥‰ºòÂåñÁ≠âÂäüËÉΩ\n */\nclass MaintenanceManager {\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 37 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 37 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 37 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 37 Ë°å)\n\n  constructor() {\n    this.cache = new Map();\n    this.cacheTimeout = 15 * 60 * 1000; // 15ÂàÜÈíüÁºìÂ≠ò\n\n    // ËÆæÂ§áÂÅ•Â∫∑Â∫¶ËØÑÂàÜÊùÉÈáç\n    this.healthWeights = {\n      performance: 0.3, // ÊÄßËÉΩÊåáÊ†á\n      reliability: 0.25, // ÂèØÈù†ÊÄß\n      efficiency: 0.2, // ÊïàÁéá\n      safety: 0.15, // ÂÆâÂÖ®ÊÄß\n      maintenance: 0.1 // Áª¥Êä§Áä∂ÊÄÅ\n    };\n\n    // ÊïÖÈöúÈ¢ÑÊµãÊ®°ÂûãÂèÇÊï∞\n    this.predictionModels = {\n      temperature: {\n        threshold: 80, // Ê∏©Â∫¶ÈòàÂÄº\n        weight: 0.3\n      },\n      vibration: {\n        threshold: 5, // ÊåØÂä®ÈòàÂÄº\n        weight: 0.25\n      },\n      energy_efficiency: {\n        threshold: 0.7, // ÊïàÁéáÈòàÂÄº\n        weight: 0.2\n      },\n      runtime: {\n        threshold: 8760, // Âπ¥ËøêË°åÂ∞èÊó∂Êï∞\n        weight: 0.15\n      },\n      error_rate: {\n        threshold: 0.05, // ÈîôËØØÁéáÈòàÂÄº\n        weight: 0.1\n      }\n    };\n  }\n\n  /**\n   * ËÆæÂ§áÂÅ•Â∫∑Â∫¶ËØÑ‰º∞\n   */\n  async assessDeviceHealth(deviceId, timeRange = '7d') {\n    try {\n      const cacheKey = `device_health_${deviceId}_${timeRange}`;\n      const cached = this.getFromCache(cacheKey);\n      if (cached) {\n        return cached;\n      }\n\n      const timeCondition = this.getTimeCondition(timeRange);\n\n      // Ëé∑ÂèñËÆæÂ§áÂü∫Êú¨‰ø°ÊÅØ\n      const deviceInfo = await this.getDeviceInfo(deviceId);\n      if (!deviceInfo) {\n        throw new Error('ËÆæÂ§á‰∏çÂ≠òÂú®');\n      }\n\n      // Ëé∑ÂèñËÆæÂ§áËøêË°åÊï∞ÊçÆ\n      const performanceData = await this.getDevicePerformanceData(deviceId, timeCondition);\n      const sensorData = await this.getDeviceSensorData(deviceId, timeCondition);\n      const maintenanceHistory = await this.getMaintenanceHistory(deviceId);\n\n      // ËÆ°ÁÆóÂêÑÈ°πÂÅ•Â∫∑ÊåáÊ†á\n      const healthMetrics = {\n        performance: this.calculatePerformanceScore(performanceData),\n        reliability: this.calculateReliabilityScore(deviceId, timeCondition),\n        efficiency: this.calculateEfficiencyScore(performanceData),\n        safety: this.calculateSafetyScore(sensorData),\n        maintenance: this.calculateMaintenanceScore(maintenanceHistory)\n      };\n\n      // ËÆ°ÁÆóÁªºÂêàÂÅ•Â∫∑Â∫¶\n      const overallHealth = Object.entries(healthMetrics).reduce(\n        (total, [key, score]) => total + score * this.healthWeights[key],\n        0\n      );\n\n      // ÁîüÊàêÂÅ•Â∫∑Â∫¶Á≠âÁ∫ß\n      const healthLevel = this.getHealthLevel(overallHealth);\n\n      // ËØÜÂà´È£éÈô©Âõ†Á¥†\n      const riskFactors = this.identifyRiskFactors(healthMetrics, sensorData);\n\n      // ÁîüÊàêÂª∫ËÆÆ\n      const recommendations = this.generateHealthRecommendations(healthMetrics, riskFactors);\n\n      const result = {\n        device_id: deviceId,\n        device_name: deviceInfo.name,\n        device_type: deviceInfo.type,\n        assessment_time: new Date().toISOString(),\n        time_range: timeRange,\n        overall_health: Math.round(overallHealth * 100) / 100,\n        health_level: healthLevel,\n        health_metrics: healthMetrics,\n        risk_factors: riskFactors,\n        recommendations,\n        next_assessment: this.calculateNextAssessment(healthLevel)\n      };\n\n      this.setCache(cacheKey, result);\n      return result;\n    } catch (error) {\n      console.error('ËÆæÂ§áÂÅ•Â∫∑Â∫¶ËØÑ‰º∞Â§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * ÊïÖÈöúÈ¢ÑÊµã\n   */\n  async predictDeviceFailure(deviceId, predictionDays = 30) {\n    try {\n      const cacheKey = `failure_prediction_${deviceId}_${predictionDays}`;\n      const cached = this.getFromCache(cacheKey);\n      if (cached) {\n        return cached;\n      }\n\n      // Ëé∑ÂèñÂéÜÂè≤Êï∞ÊçÆ\n      const historicalData = await this.getHistoricalData(deviceId, '90d');\n      const maintenanceHistory = await this.getMaintenanceHistory(deviceId);\n      const currentHealth = await this.assessDeviceHealth(deviceId, '7d');\n\n      // ËÆ°ÁÆóÊïÖÈöúÊ¶ÇÁéá\n      const failureProbability = this.calculateFailureProbability(\n        historicalData,\n        maintenanceHistory,\n        currentHealth\n      );\n\n      // È¢ÑÊµãÂèØËÉΩÁöÑÊïÖÈöúÁ±ªÂûã\n      const potentialFailures = this.predictFailureTypes(historicalData, currentHealth);\n\n      // ËÆ°ÁÆóÈ¢ÑËÆ°ÊïÖÈöúÊó∂Èó¥\n      const estimatedFailureTime = this.estimateFailureTime(\n        failureProbability,\n        currentHealth.overall_health,\n        predictionDays\n      );\n\n      // ÁîüÊàêÈ¢ÑÈò≤Êé™ÊñΩÂª∫ËÆÆ\n      const preventiveMeasures = this.generatePreventiveMeasures(potentialFailures, currentHealth);\n\n      const result = {\n        device_id: deviceId,\n        prediction_date: new Date().toISOString(),\n        prediction_period: predictionDays,\n        failure_probability: Math.round(failureProbability * 100) / 100,\n        risk_level: this.getRiskLevel(failureProbability),\n        estimated_failure_time: estimatedFailureTime,\n        potential_failures: potentialFailures,\n        preventive_measures: preventiveMeasures,\n        confidence_score: this.calculatePredictionConfidence(historicalData),\n        current_health: currentHealth.overall_health\n      };\n\n      this.setCache(cacheKey, result);\n      return result;\n    } catch (error) {\n      console.error('ÊïÖÈöúÈ¢ÑÊµãÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * ÂàõÂª∫Áª¥Êä§ËÆ°Âàí\n   */\n  async createMaintenancePlan(params) {\n    try {\n      const {\n        deviceId,\n        planType,\n        priority,\n        scheduledDate,\n        estimatedDuration,\n        description,\n        requiredSkills = [],\n        requiredParts = [],\n        assignedTechnician\n      } = params;\n\n      // È™åËØÅÂøÖÂ°´Â≠óÊÆµ\n      if (!deviceId || !planType || !scheduledDate) {\n        throw new Error('Áº∫Â∞ëÂøÖÂ°´Â≠óÊÆµ');\n      }\n\n      // È™åËØÅËÆ°ÂàíÁ±ªÂûã\n      const validTypes = ['preventive', 'corrective', 'predictive', 'emergency'];\n      if (!validTypes.includes(planType)) {\n        throw new Error('Êó†ÊïàÁöÑÁª¥Êä§ËÆ°ÂàíÁ±ªÂûã');\n      }\n\n      const planId = uuidv4();\n\n      const sql = `\n        INSERT INTO maintenance_plans (\n          id, device_id, plan_type, priority, scheduled_date,\n          estimated_duration, description, required_skills,\n          required_parts, assigned_technician, status, created_at\n        ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, 'scheduled', datetime('now'))\n      `;\n\n      await this.runDatabase(sql, [\n        planId,\n        deviceId,\n        planType,\n        priority || 'medium',\n        scheduledDate,\n        estimatedDuration || 120, // ÈªòËÆ§2Â∞èÊó∂\n        description,\n        JSON.stringify(requiredSkills),\n        JSON.stringify(requiredParts),\n        assignedTechnician\n      ]);\n\n      // Â¶ÇÊûúÊòØÈ¢ÑÊµãÊÄßÁª¥Êä§ÔºåÊõ¥Êñ∞ËÆæÂ§áÂÅ•Â∫∑Áä∂ÊÄÅ\n      if (planType === 'predictive') {\n        await this.updateDeviceMaintenanceStatus(deviceId, 'maintenance_scheduled');\n      }\n\n      return {\n        id: planId,\n        device_id: deviceId,\n        plan_type: planType,\n        priority,\n        scheduled_date: scheduledDate,\n        estimated_duration: estimatedDuration,\n        description,\n        required_skills: requiredSkills,\n        required_parts: requiredParts,\n        assigned_technician: assignedTechnician,\n        status: 'scheduled'\n      };\n    } catch (error) {\n      console.error('ÂàõÂª∫Áª¥Êä§ËÆ°ÂàíÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Êô∫ËÉΩÁª¥Êä§Ë∞ÉÂ∫¶\n   */\n  async scheduleMaintenanceOptimization(params = {}) {\n    try {\n      const {\n        timeRange = '30d',\n        maxConcurrentMaintenance = 3,\n        technicianAvailability = {},\n        priorityWeights = { emergency: 1.0, high: 0.8, medium: 0.6, low: 0.4 }\n      } = params;\n\n      // Ëé∑ÂèñÂæÖË∞ÉÂ∫¶ÁöÑÁª¥Êä§ËÆ°Âàí\n      const pendingPlans = await this.getPendingMaintenancePlans(timeRange);\n\n      // Ëé∑ÂèñÊäÄÂ∏àÂèØÁî®ÊÄß\n      const technicianSchedule = await this.getTechnicianSchedule(timeRange);\n\n      // Ëé∑ÂèñËÆæÂ§á‰ºòÂÖàÁ∫ß\n      const devicePriorities = await this.getDevicePriorities();\n\n      // ÊâßË°åË∞ÉÂ∫¶‰ºòÂåñÁÆóÊ≥ï\n      const optimizedSchedule = this.optimizeMaintenanceSchedule(\n        pendingPlans,\n        technicianSchedule,\n        devicePriorities,\n        {\n          maxConcurrentMaintenance,\n          priorityWeights,\n          technicianAvailability\n        }\n      );\n\n      // ËÆ°ÁÆóË∞ÉÂ∫¶ÊïàÊûúÊåáÊ†á\n      const scheduleMetrics = this.calculateScheduleMetrics(optimizedSchedule, pendingPlans);\n\n      return {\n        optimization_date: new Date().toISOString(),\n        time_range: timeRange,\n        total_plans: pendingPlans.length,\n        optimized_schedule: optimizedSchedule,\n        metrics: scheduleMetrics,\n        recommendations: this.generateScheduleRecommendations(optimizedSchedule)\n      };\n    } catch (error) {\n      console.error('Áª¥Êä§Ë∞ÉÂ∫¶‰ºòÂåñÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Áª¥Êä§ÊàêÊú¨ÂàÜÊûê\n   */\n  async analyzeMaintenanceCosts(scope, scopeId, timeRange = '365d') {\n    try {\n      const cacheKey = `maintenance_costs_${scope}_${scopeId}_${timeRange}`;\n      const cached = this.getFromCache(cacheKey);\n      if (cached) {\n        return cached;\n      }\n\n      const timeCondition = this.getTimeCondition(timeRange);\n\n      // Ëé∑ÂèñÁª¥Êä§ËÆ∞ÂΩï\n      const maintenanceRecords = await this.getMaintenanceRecords(scope, scopeId, timeCondition);\n\n      // ËÆ°ÁÆóÂêÑÁ±ªÊàêÊú¨\n      const costBreakdown = {\n        labor_cost: 0,\n        parts_cost: 0,\n        downtime_cost: 0,\n        emergency_cost: 0,\n        total_cost: 0\n      };\n\n      const maintenanceStats = {\n        total_maintenance: maintenanceRecords.length,\n        preventive_count: 0,\n        corrective_count: 0,\n        emergency_count: 0,\n        average_duration: 0,\n        total_downtime: 0\n      };\n\n      let totalDuration = 0;\n\n      for (const record of maintenanceRecords) {\n        // ËÆ°ÁÆó‰∫∫Â∑•ÊàêÊú¨\n        const laborCost =\n          (record.actual_duration || record.estimated_duration || 0) *\n          (record.technician_hourly_rate || 50);\n        costBreakdown.labor_cost += laborCost;\n\n        // ËÆ°ÁÆóÈÖç‰ª∂ÊàêÊú¨\n        const partsCost = record.parts_cost || 0;\n        costBreakdown.parts_cost += partsCost;\n\n        // ËÆ°ÁÆóÂÅúÊú∫ÊàêÊú¨\n        const downtimeCost = (record.downtime_hours || 0) * (record.downtime_hourly_cost || 100);\n        costBreakdown.downtime_cost += downtimeCost;\n\n        // Á¥ßÊÄ•Áª¥Êä§È¢ùÂ§ñÊàêÊú¨\n        if (record.plan_type === 'emergency') {\n          const emergencyCost = laborCost * 0.5; // Á¥ßÊÄ•Áª¥Êä§È¢ùÂ§ñ50%ÊàêÊú¨\n          costBreakdown.emergency_cost += emergencyCost;\n          maintenanceStats.emergency_count++;\n        }\n\n        // ÁªüËÆ°Áª¥Êä§Á±ªÂûã\n        if (record.plan_type === 'preventive') {\n          maintenanceStats.preventive_count++;\n        } else if (record.plan_type === 'corrective') {\n          maintenanceStats.corrective_count++;\n        }\n\n        totalDuration += record.actual_duration || record.estimated_duration || 0;\n        maintenanceStats.total_downtime += record.downtime_hours || 0;\n      }\n\n      costBreakdown.total_cost =\n        Object.values(costBreakdown).reduce((sum, cost) => sum + cost, 0) -\n        costBreakdown.total_cost;\n      maintenanceStats.average_duration =\n        maintenanceRecords.length > 0 ? totalDuration / maintenanceRecords.length : 0;\n\n      // ËÆ°ÁÆóÊàêÊú¨Ë∂ãÂäø\n      const costTrend = await this.calculateCostTrend(scope, scopeId, timeRange);\n\n      // ÊàêÊú¨‰ºòÂåñÂª∫ËÆÆ\n      const optimizationSuggestions = this.generateCostOptimizationSuggestions(\n        costBreakdown,\n        maintenanceStats\n      );\n\n      const result = {\n        scope,\n        scope_id: scopeId,\n        time_range: timeRange,\n        cost_breakdown: costBreakdown,\n        maintenance_stats: maintenanceStats,\n        cost_trend: costTrend,\n        cost_per_device: this.calculateCostPerDevice(costBreakdown.total_cost, scope, scopeId),\n        optimization_suggestions: optimizationSuggestions,\n        analysis_date: new Date().toISOString()\n      };\n\n      this.setCache(cacheKey, result);\n      return result;\n    } catch (error) {\n      console.error('Áª¥Êä§ÊàêÊú¨ÂàÜÊûêÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * ÁîüÊàêÁª¥Êä§Êä•Âëä\n   */\n  async generateMaintenanceReport(params) {\n    try {\n      const {\n        scope,\n        scopeId,\n        reportType = 'comprehensive',\n        timeRange = '30d',\n        includeForecasting = true\n      } = params;\n\n      const reportId = uuidv4();\n\n      // Êî∂ÈõÜÊä•ÂëäÊï∞ÊçÆ\n      const reportData = {\n        basic_info: await this.getBasicInfo(scope, scopeId),\n        health_assessment: await this.getHealthAssessmentSummary(scope, scopeId, timeRange),\n        maintenance_summary: await this.getMaintenanceSummary(scope, scopeId, timeRange),\n        cost_analysis: await this.analyzeMaintenanceCosts(scope, scopeId, timeRange),\n        performance_metrics: await this.getPerformanceMetrics(scope, scopeId, timeRange)\n      };\n\n      if (includeForecasting) {\n        reportData.forecasting = await this.getMaintenanceForecasting(scope, scopeId);\n      }\n\n      // ÁîüÊàêÊä•ÂëäÂÜÖÂÆπ\n      const reportContent = this.compileMaintenanceReport(reportData, reportType);\n\n      // ‰øùÂ≠òÊä•Âëä\n      const sql = `\n        INSERT INTO maintenance_reports (\n          id, scope, scope_id, report_type, time_range,\n          content, created_at\n        ) VALUES (?, ?, ?, ?, ?, ?, datetime('now'))\n      `;\n\n      await this.runDatabase(sql, [\n        reportId,\n        scope,\n        scopeId,\n        reportType,\n        timeRange,\n        JSON.stringify(reportContent)\n      ]);\n\n      return {\n        id: reportId,\n        scope,\n        scope_id: scopeId,\n        report_type: reportType,\n        time_range: timeRange,\n        content: reportContent,\n        generated_at: new Date().toISOString()\n      };\n    } catch (error) {\n      console.error('ÁîüÊàêÁª¥Êä§Êä•ÂëäÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  // ==================== ËæÖÂä©ËÆ°ÁÆóÊñπÊ≥ï ====================\n\n  /**\n   * ËÆ°ÁÆóÊÄßËÉΩËØÑÂàÜ\n   */\n  calculatePerformanceScore(performanceData) {\n    if (!performanceData || performanceData.length === 0) {\n      return 0.5;\n    }\n\n    const avgEfficiency =\n      performanceData.reduce((sum, data) => sum + (data.efficiency || 0.8), 0) /\n      performanceData.length;\n    const avgUptime =\n      performanceData.reduce((sum, data) => sum + (data.uptime || 0.95), 0) /\n      performanceData.length;\n\n    return avgEfficiency * 0.6 + avgUptime * 0.4;\n  }\n\n  /**\n   * ËÆ°ÁÆóÂèØÈù†ÊÄßËØÑÂàÜ\n   */\n  async calculateReliabilityScore(deviceId, timeCondition) {\n    try {\n      const sql = `\n        SELECT COUNT(*) as failure_count\n        FROM maintenance_records\n        WHERE device_id = ? AND plan_type IN ('corrective', 'emergency')\n        AND completed_date >= datetime('now', ?)\n      `;\n\n      const result = await this.queryDatabase(sql, [deviceId, timeCondition]);\n      const failureCount = result[0]?.failure_count || 0;\n\n      // Âü∫‰∫éÊïÖÈöúÊ¨°Êï∞ËÆ°ÁÆóÂèØÈù†ÊÄßËØÑÂàÜ\n      return Math.max(0, 1 - failureCount * 0.1);\n    } catch (error) {\n      console.error('ËÆ°ÁÆóÂèØÈù†ÊÄßËØÑÂàÜÂ§±Ë¥•:', error);\n      return 0.5;\n    }\n  }\n\n  /**\n   * ËÆ°ÁÆóÊïàÁéáËØÑÂàÜ\n   */\n  calculateEfficiencyScore(performanceData) {\n    if (!performanceData || performanceData.length === 0) {\n      return 0.5;\n    }\n\n    const avgEnergyEfficiency =\n      performanceData.reduce((sum, data) => sum + (data.energy_efficiency || 0.8), 0) /\n      performanceData.length;\n\n    return avgEnergyEfficiency;\n  }\n\n  /**\n   * ËÆ°ÁÆóÂÆâÂÖ®ËØÑÂàÜ\n   */\n  calculateSafetyScore(sensorData) {\n    if (!sensorData || sensorData.length === 0) {\n      return 0.8;\n    }\n\n    let safetyScore = 1.0;\n\n    for (const data of sensorData) {\n      // Ê£ÄÊü•Ê∏©Â∫¶ÂºÇÂ∏∏\n      if (data.temperature > 80) {\n        safetyScore -= 0.1;\n      }\n\n      // Ê£ÄÊü•ÊåØÂä®ÂºÇÂ∏∏\n      if (data.vibration > 5) {\n        safetyScore -= 0.1;\n      }\n\n      // Ê£ÄÊü•ÂÖ∂‰ªñÂÆâÂÖ®ÊåáÊ†á\n      if (data.pressure && data.pressure > data.max_pressure) {\n        safetyScore -= 0.15;\n      }\n    }\n\n    return Math.max(0, safetyScore);\n  }\n\n  /**\n   * ËÆ°ÁÆóÁª¥Êä§ËØÑÂàÜ\n   */\n  calculateMaintenanceScore(maintenanceHistory) {\n    if (!maintenanceHistory || maintenanceHistory.length === 0) {\n      return 0.5;\n    }\n\n    const now = new Date();\n    const lastMaintenance = new Date(maintenanceHistory[0].completed_date);\n    const daysSinceLastMaintenance = (now - lastMaintenance) / (1000 * 60 * 60 * 24);\n\n    // Âü∫‰∫éÊúÄÂêéÁª¥Êä§Êó∂Èó¥ËÆ°ÁÆóËØÑÂàÜ\n    if (daysSinceLastMaintenance < 30) {\n      return 1.0;\n    }\n    if (daysSinceLastMaintenance < 60) {\n      return 0.8;\n    }\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (daysSinceLastMaintenance < 90) {\n      return 0.6;\n    }\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (daysSinceLastMaintenance < 180) {\n      return 0.4;\n    }\n    return 0.2;\n  }\n\n  /**\n   * Ëé∑ÂèñÂÅ•Â∫∑Â∫¶Á≠âÁ∫ß\n   */\n  getHealthLevel(score) {\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (score >= 0.9) {\n      return 'excellent';\n    }\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (score >= 0.8) {\n      return 'good';\n    }\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (score >= 0.7) {\n      return 'fair';\n    }\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (score >= 0.6) {\n      return 'poor';\n    }\n    return 'critical';\n  }\n\n  /**\n   * ËØÜÂà´È£éÈô©Âõ†Á¥†\n   */\n  identifyRiskFactors(healthMetrics, sensorData) {\n    const riskFactors = [];\n\n    // Ê£ÄÊü•ÂêÑÈ°πÂÅ•Â∫∑ÊåáÊ†á\n    Object.entries(healthMetrics).forEach(([metric, score]) => {\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      if (score < 0.6) {\n        riskFactors.push({\n          type: 'health_metric',\n          metric,\n          score,\n          severity: score < 0.4 ? 'high' : 'medium',\n          description: `${metric}ÊåáÊ†áÂÅè‰Ωé`\n        });\n      }\n    });\n\n    // Ê£ÄÊü•‰º†ÊÑüÂô®Êï∞ÊçÆÂºÇÂ∏∏\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (sensorData && sensorData.length > 0) {\n      const latestData = sensorData[sensorData.length - 1];\n\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      if (latestData.temperature > 80) {\n        riskFactors.push({\n          type: 'sensor_anomaly',\n          metric: 'temperature',\n          value: latestData.temperature,\n          severity: 'high',\n          description: 'ËÆæÂ§áÊ∏©Â∫¶ËøáÈ´ò'\n        });\n      }\n\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      if (latestData.vibration > 5) {\n        riskFactors.push({\n          type: 'sensor_anomaly',\n          metric: 'vibration',\n          value: latestData.vibration,\n          severity: 'medium',\n          description: 'ËÆæÂ§áÊåØÂä®ÂºÇÂ∏∏'\n        });\n      }\n    }\n\n    return riskFactors;\n  }\n\n  /**\n   * ÁîüÊàêÂÅ•Â∫∑Âª∫ËÆÆ\n   */\n  generateHealthRecommendations(healthMetrics, riskFactors) {\n    const recommendations = [];\n\n    // Âü∫‰∫éÂÅ•Â∫∑ÊåáÊ†áÁîüÊàêÂª∫ËÆÆ\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (healthMetrics.performance < 0.7) {\n      recommendations.push({\n        type: 'performance',\n        priority: 'high',\n        action: 'ÊÄßËÉΩ‰ºòÂåñ',\n        description: 'Âª∫ËÆÆËøõË°åËÆæÂ§áÊÄßËÉΩË∞É‰ºòÂíåÊ∏ÖÊ¥ÅÁª¥Êä§'\n      });\n    }\n\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (healthMetrics.reliability < 0.6) {\n      recommendations.push({\n        type: 'reliability',\n        priority: 'high',\n        action: 'ÂèØÈù†ÊÄßÊèêÂçá',\n        description: 'Âª∫ËÆÆÊ£ÄÊü•ÂÖ≥ÈîÆÈÉ®‰ª∂Âπ∂ËøõË°åÈ¢ÑÈò≤ÊÄßÁª¥Êä§'\n      });\n    }\n\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (healthMetrics.maintenance < 0.5) {\n      recommendations.push({\n        type: 'maintenance',\n        priority: 'medium',\n        action: 'ÂÆöÊúüÁª¥Êä§',\n        description: 'Âª∫ËÆÆÂà∂ÂÆöÂπ∂ÊâßË°åÂÆöÊúüÁª¥Êä§ËÆ°Âàí'\n      });\n    }\n\n    // Âü∫‰∫éÈ£éÈô©Âõ†Á¥†ÁîüÊàêÂª∫ËÆÆ\n    riskFactors.forEach((risk) => {\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      if (risk.severity === 'high') {\n        recommendations.push({\n          type: 'risk_mitigation',\n          priority: 'urgent',\n          action: 'È£éÈô©ÁºìËß£',\n          description: `Á¥ßÊÄ•Â§ÑÁêÜ${risk.description}`\n        });\n      }\n    });\n\n    return recommendations;\n  }\n\n  /**\n   * ËÆ°ÁÆóÊïÖÈöúÊ¶ÇÁéá\n   */\n  calculateFailureProbability(historicalData, maintenanceHistory, currentHealth) {\n    let probability = 0;\n\n    // Âü∫‰∫éÂÅ•Â∫∑Â∫¶ËÆ°ÁÆóÂü∫Á°ÄÊ¶ÇÁéá\n    probability += (1 - currentHealth.overall_health) * 0.4;\n\n    // Âü∫‰∫éÂéÜÂè≤ÊïÖÈöúÈ¢ëÁéá\n    const recentFailures = maintenanceHistory.filter(\n      (record) => record.plan_type === 'corrective' || record.plan_type === 'emergency'\n    ).length;\n    probability += Math.min(recentFailures * 0.1, 0.3);\n\n    // Âü∫‰∫éËÆæÂ§áËøêË°åÊó∂Èó¥\n    const avgRuntime =\n      historicalData.reduce((sum, data) => sum + (data.runtime || 0), 0) / historicalData.length;\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (avgRuntime > 8000) {\n      // Âπ¥ËøêË°åË∂ÖËøá8000Â∞èÊó∂\n      probability += 0.2;\n    }\n\n    return Math.min(probability, 1.0);\n  }\n\n  /**\n   * È¢ÑÊµãÊïÖÈöúÁ±ªÂûã\n   */\n  predictFailureTypes(historicalData, currentHealth) {\n    const potentialFailures = [];\n\n    // Âü∫‰∫éÂÅ•Â∫∑ÊåáÊ†áÈ¢ÑÊµãÊïÖÈöúÁ±ªÂûã\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (currentHealth.health_metrics.performance < 0.6) {\n      potentialFailures.push({\n        type: 'performance_degradation',\n        probability: 0.7,\n        impact: 'medium',\n        description: 'ÊÄßËÉΩ‰∏ãÈôçÂèØËÉΩÂØºËá¥ÊïàÁéáÈôç‰Ωé'\n      });\n    }\n\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (currentHealth.health_metrics.safety < 0.7) {\n      potentialFailures.push({\n        type: 'safety_issue',\n        probability: 0.6,\n        impact: 'high',\n        description: 'ÂÆâÂÖ®ÊåáÊ†áÂºÇÂ∏∏ÂèØËÉΩÂØºËá¥ËÆæÂ§áÊïÖÈöú'\n      });\n    }\n\n    // Âü∫‰∫éÂéÜÂè≤Êï∞ÊçÆÊ®°ÂºèËØÜÂà´\n    const temperatureIssues = historicalData.filter((data) => data.temperature > 80).length;\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (temperatureIssues > historicalData.length * 0.3) {\n      potentialFailures.push({\n        type: 'overheating',\n        probability: 0.8,\n        impact: 'high',\n        description: 'ËøáÁÉ≠ÂèØËÉΩÂØºËá¥ËÆæÂ§áÊçüÂùè'\n      });\n    }\n\n    return potentialFailures;\n  }\n\n  // ==================== Êï∞ÊçÆËé∑ÂèñÊñπÊ≥ï ====================\n\n  /**\n   * Ëé∑ÂèñËÆæÂ§á‰ø°ÊÅØ\n   */\n  async getDeviceInfo(deviceId) {\n    const sql = 'SELECT * FROM devices WHERE id = ?';\n    const result = await this.queryDatabase(sql, [deviceId]);\n    return result[0] || null;\n  }\n\n  /**\n   * Ëé∑ÂèñËÆæÂ§áÊÄßËÉΩÊï∞ÊçÆ\n   */\n  async getDevicePerformanceData(deviceId, timeCondition) {\n    const sql = `\n      SELECT \n        timestamp,\n        value as efficiency,\n        CASE WHEN value > 0 THEN 1 ELSE 0 END as uptime\n      FROM energy_data\n      WHERE device_id = ? AND timestamp >= datetime('now', ?)\n      ORDER BY timestamp DESC\n      LIMIT 100\n    `;\n\n    return await this.queryDatabase(sql, [deviceId, timeCondition]);\n  }\n\n  /**\n   * Ëé∑ÂèñËÆæÂ§á‰º†ÊÑüÂô®Êï∞ÊçÆ\n   */\n  async getDeviceSensorData(deviceId, timeCondition) {\n    const sql = `\n      SELECT \n        timestamp,\n        data_type,\n        value,\n        unit\n      FROM sensor_data\n      WHERE device_id = ? AND timestamp >= datetime('now', ?)\n      ORDER BY timestamp DESC\n      LIMIT 50\n    `;\n\n    const rawData = await this.queryDatabase(sql, [deviceId, timeCondition]);\n\n    // ËΩ¨Êç¢‰∏∫ÁªìÊûÑÂåñÊï∞ÊçÆ\n    const structuredData = {};\n    rawData.forEach((item) => {\n      if (!structuredData[item.timestamp]) {\n        structuredData[item.timestamp] = { timestamp: item.timestamp };\n      }\n      structuredData[item.timestamp][item.data_type] = item.value;\n    });\n\n    return Object.values(structuredData);\n  }\n\n  /**\n   * Ëé∑ÂèñÁª¥Êä§ÂéÜÂè≤\n   */\n  async getMaintenanceHistory(deviceId, limit = 10) {\n    const sql = `\n      SELECT * FROM maintenance_records\n      WHERE device_id = ?\n      ORDER BY completed_date DESC\n      LIMIT ?\n    `;\n\n    return await this.queryDatabase(sql, [deviceId, limit]);\n  }\n\n  // ==================== ÁºìÂ≠òÂíåÂ∑•ÂÖ∑ÊñπÊ≥ï ====================\n\n  /**\n   * Ëé∑ÂèñÊó∂Èó¥Êù°‰ª∂\n   */\n  getTimeCondition(timeRange) {\n    const conditions = {\n      '1h': '-1 hour',\n      '6h': '-6 hours',\n      '24h': '-1 day',\n      '7d': '-7 days',\n      '30d': '-30 days',\n      '90d': '-90 days',\n      '365d': '-365 days'\n    };\n    return conditions[timeRange] || '-7 days';\n  }\n\n  /**\n   * ÁºìÂ≠òÁÆ°ÁêÜ\n   */\n  getFromCache(key) {\n    const cached = this.cache.get(key);\n    if (cached && Date.now() - cached.timestamp < this.cacheTimeout) {\n      return cached.data;\n    }\n    return null;\n  }\n\n  setCache(key, data) {\n    this.cache.set(key, {\n      data,\n      timestamp: Date.now()\n    });\n  }\n\n  /**\n   * Êï∞ÊçÆÂ∫ìÊü•ËØ¢Â∞ÅË£Ö\n   */\n  async queryDatabase(sql, params = []) {\n    const db = await dbPromise;\n    return new Promise((resolve, reject) => {\n      db.raw(sql, params).then((rows) => {\n        resolve(rows || []);\n      }).catch((err) => {\n        reject(err);\n      });\n    });\n  }\n\n  /**\n   * Êï∞ÊçÆÂ∫ìÊâßË°åÂ∞ÅË£Ö\n   */\n  async runDatabase(sql, _params = []) {\n    const _db = await dbPromise;\n    return new Promise((resolve, _reject) => {\n      // Ê®°ÊãüÊï∞ÊçÆÂ∫ìÊâßË°åÊìç‰Ωú\n      console.log('Ê®°ÊãüÊâßË°åSQL:', sql);\n      resolve(1); // Ê®°ÊãüËøîÂõû lastID\n    });\n  }\n}\n\nexport default MaintenanceManager;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/core/services/NationalIndicatorDashboard.js","messages":[{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.9.","line":85,"column":90,"nodeType":"Literal","messageId":"noMagic","endLine":85,"endColumn":93},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.95.","line":92,"column":88,"nodeType":"Literal","messageId":"noMagic","endLine":92,"endColumn":92},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.9.","line":99,"column":93,"nodeType":"Literal","messageId":"noMagic","endLine":99,"endColumn":96},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.8.","line":100,"column":94,"nodeType":"Literal","messageId":"noMagic","endLine":100,"endColumn":97},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1.1.","line":380,"column":35,"nodeType":"Literal","messageId":"noMagic","endLine":380,"endColumn":38},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.9.","line":380,"column":62,"nodeType":"Literal","messageId":"noMagic","endLine":380,"endColumn":65},{"ruleId":"no-else-return","severity":2,"message":"Unnecessary 'else' after 'return'.","line":382,"column":14,"nodeType":"BlockStatement","messageId":"unexpected","endLine":384,"endColumn":8,"fix":{"range":[11983,12618],"text":"(value, target, targetMax = null, type = 'minimum') {\n    if (type === 'range' && targetMax !== null) {\n      if (value >= target && value <= targetMax) {\n        return 'excellent';\n      } else if (value < target * 1.1 || value > targetMax * 0.9) {\n        return 'warning';\n      } \n        return 'critical';\n      \n    } else if (type === 'minimum') {\n      if (value >= target) {\n        return 'excellent';\n      } else if (value >= target * 0.9) {\n        return 'good';\n      } else if (value >= target * 0.8) {\n        return 'warning';\n      } else {\n        return 'critical';\n      }\n    }\n    return 'unknown';\n  }"}},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.9.","line":388,"column":36,"nodeType":"Literal","messageId":"noMagic","endLine":388,"endColumn":39},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.8.","line":390,"column":36,"nodeType":"Literal","messageId":"noMagic","endLine":390,"endColumn":39},{"ruleId":"no-else-return","severity":2,"message":"Unnecessary 'else' after 'return'.","line":392,"column":14,"nodeType":"BlockStatement","messageId":"unexpected","endLine":394,"endColumn":8,"fix":{"range":[11983,12618],"text":"(value, target, targetMax = null, type = 'minimum') {\n    if (type === 'range' && targetMax !== null) {\n      if (value >= target && value <= targetMax) {\n        return 'excellent';\n      } else if (value < target * 1.1 || value > targetMax * 0.9) {\n        return 'warning';\n      } else {\n        return 'critical';\n      }\n    } else if (type === 'minimum') {\n      if (value >= target) {\n        return 'excellent';\n      } else if (value >= target * 0.9) {\n        return 'good';\n      } else if (value >= target * 0.8) {\n        return 'warning';\n      } \n        return 'critical';\n      \n    }\n    return 'unknown';\n  }"}},{"ruleId":"no-else-return","severity":2,"message":"Unnecessary 'else' after 'return'.","line":423,"column":12,"nodeType":"BlockStatement","messageId":"unexpected","endLine":425,"endColumn":6,"fix":{"range":[12664,13352],"text":"(indicators) {\n    const criticalIndicators = ['carbon_intensity', 'clean_energy_ratio'];\n    let criticalCount = 0;\n    let warningCount = 0;\n    \n    for (const [key, indicator] of Object.entries(indicators)) {\n      if (typeof indicator === 'object' && indicator.status) {\n        if (indicator.status === 'critical') {\n          if (criticalIndicators.includes(key)) {\n            criticalCount++;\n          }\n        } else if (indicator.status === 'warning') {\n          warningCount++;\n        }\n      }\n    }\n    \n    if (criticalCount > 0) {\n      return 'non_compliant';\n    } else if (warningCount > 0) {\n      return 'at_risk';\n    } \n      return 'compliant';\n    \n  }"}},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":434,"column":62,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":434,"endColumn":71,"fix":{"range":[13587,13596],"text":"{continue;}"}},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":460,"column":45,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":460,"endColumn":63,"fix":{"range":[14385,14403],"text":"{return 'critical';}"}},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":461,"column":44,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":461,"endColumn":61,"fix":{"range":[14447,14464],"text":"{return 'warning';}"}},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":463,"column":45,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":463,"endColumn":63,"fix":{"range":[14559,14577],"text":"{return 'critical';}"}},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":464,"column":44,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":464,"endColumn":61,"fix":{"range":[14621,14638],"text":"{return 'warning';}"}},{"ruleId":"no-unused-vars","severity":2,"message":"'parkId' is defined but never used. Allowed unused args must match /^_/u.","line":489,"column":35,"nodeType":"Identifier","messageId":"unusedVar","endLine":489,"endColumn":41},{"ruleId":"no-unused-vars","severity":2,"message":"'timeRange' is defined but never used. Allowed unused args must match /^_/u.","line":489,"column":43,"nodeType":"Identifier","messageId":"unusedVar","endLine":489,"endColumn":52},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.1.","line":492,"column":44,"nodeType":"Literal","messageId":"noMagic","endLine":492,"endColumn":47},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.9.","line":492,"column":50,"nodeType":"Literal","messageId":"noMagic","endLine":492,"endColumn":53},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.05.","line":493,"column":40,"nodeType":"Literal","messageId":"noMagic","endLine":493,"endColumn":44},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.95.","line":493,"column":47,"nodeType":"Literal","messageId":"noMagic","endLine":493,"endColumn":51},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.1.","line":494,"column":42,"nodeType":"Literal","messageId":"noMagic","endLine":494,"endColumn":45},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.9.","line":494,"column":48,"nodeType":"Literal","messageId":"noMagic","endLine":494,"endColumn":51},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 3.","line":496,"column":62,"nodeType":"Literal","messageId":"noMagic","endLine":496,"endColumn":63},{"ruleId":"no-unused-vars","severity":2,"message":"'parkId' is defined but never used. Allowed unused args must match /^_/u.","line":529,"column":34,"nodeType":"Identifier","messageId":"unusedVar","endLine":529,"endColumn":40},{"ruleId":"no-unused-vars","severity":2,"message":"'timeRange' is defined but never used. Allowed unused args must match /^_/u.","line":529,"column":42,"nodeType":"Identifier","messageId":"unusedVar","endLine":529,"endColumn":51},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10000.","line":531,"column":36,"nodeType":"Literal","messageId":"noMagic","endLine":531,"endColumn":41},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5000.","line":532,"column":36,"nodeType":"Literal","messageId":"noMagic","endLine":532,"endColumn":40},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 2000.","line":533,"column":29,"nodeType":"Literal","messageId":"noMagic","endLine":533,"endColumn":33},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 3000.","line":534,"column":30,"nodeType":"Literal","messageId":"noMagic","endLine":534,"endColumn":34},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 2000.","line":535,"column":29,"nodeType":"Literal","messageId":"noMagic","endLine":535,"endColumn":33},{"ruleId":"no-unused-vars","severity":2,"message":"'parkId' is defined but never used. Allowed unused args must match /^_/u.","line":539,"column":36,"nodeType":"Identifier","messageId":"unusedVar","endLine":539,"endColumn":42},{"ruleId":"no-unused-vars","severity":2,"message":"'timeRange' is defined but never used. Allowed unused args must match /^_/u.","line":539,"column":44,"nodeType":"Identifier","messageId":"unusedVar","endLine":539,"endColumn":53},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":542,"column":44,"nodeType":"Literal","messageId":"noMagic","endLine":542,"endColumn":48},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 900.","line":543,"column":45,"nodeType":"Literal","messageId":"noMagic","endLine":543,"endColumn":48},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":546,"column":44,"nodeType":"Literal","messageId":"noMagic","endLine":546,"endColumn":47},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":547,"column":45,"nodeType":"Literal","messageId":"noMagic","endLine":547,"endColumn":48},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 300.","line":550,"column":44,"nodeType":"Literal","messageId":"noMagic","endLine":550,"endColumn":47},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 240.","line":551,"column":45,"nodeType":"Literal","messageId":"noMagic","endLine":551,"endColumn":48},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10000.","line":554,"column":44,"nodeType":"Literal","messageId":"noMagic","endLine":554,"endColumn":49},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 9000.","line":555,"column":39,"nodeType":"Literal","messageId":"noMagic","endLine":555,"endColumn":43}],"suppressedMessages":[],"errorCount":14,"fatalErrorCount":0,"warningCount":28,"fixableErrorCount":8,"fixableWarningCount":0,"source":"/**\n * ÂõΩÂÆ∂ÊåáÊ†á‰ΩìÁ≥ªÁõëÊµã‰ª™Ë°®Áõò\n * ÂÆûÊó∂ÁõëÊµã„ÄäÂõΩÂÆ∂Á∫ßÈõ∂Á¢≥Âõ≠Âå∫Âª∫ËÆæÊåáÊ†á‰ΩìÁ≥ªÔºàËØïË°åÔºâ„ÄãÊ†∏ÂøÉÊåáÊ†á\n * Êèê‰æõÈ¢ÑË≠¶Êú∫Âà∂ÂíåÁõÆÊ†áÂÄºÂØπÊØîÂäüËÉΩ\n */\n\nimport { EventEmitter } from 'events';\nimport logger from '../../shared/utils/logger.js';\nimport { CARBON_CONSTANTS, MATH_CONSTANTS, TIME_INTERVALS } from '../../shared/constants/MathConstants.js';\nimport CarbonAccountingEngine from './CarbonAccountingEngine.js';\n\nclass NationalIndicatorDashboard extends EventEmitter {\n  constructor() {\n    super();\n    this.carbonEngine = new CarbonAccountingEngine();\n    this.indicatorCache = new Map();\n    this.alertRules = new Map();\n    this.monitoringInterval = null;\n    this.isMonitoring = false;\n    \n    // ÂõΩÂÆ∂Ê†∏ÂøÉÊåáÊ†áÂÆö‰πâ\n    this.coreIndicators = {\n      // Ê†∏ÂøÉÊåáÊ†á\n      carbon_intensity: {\n        name: 'Âçï‰ΩçËÉΩËÄóÁ¢≥ÊéíÊîæ',\n        unit: 'Âê®CO‚ÇÇ/Âê®Ê†áÂáÜÁÖ§',\n        target_min: CARBON_CONSTANTS.NATIONAL_TARGETS.CARBON_INTENSITY_TARGET_MIN,\n        target_max: CARBON_CONSTANTS.NATIONAL_TARGETS.CARBON_INTENSITY_TARGET_MAX,\n        priority: 'critical',\n        calculation_method: 'EÂõ≠Âå∫ / Âπ¥ÁªºÂêàËÉΩÊ∫êÊ∂àË¥πÈáè'\n      },\n      clean_energy_ratio: {\n        name: 'Ê∏ÖÊ¥ÅËÉΩÊ∫êÊ∂àË¥πÂç†ÊØî',\n        unit: '%',\n        target: CARBON_CONSTANTS.NATIONAL_TARGETS.CLEAN_ENERGY_RATIO_TARGET,\n        priority: 'critical',\n        calculation_method: 'Ê∏ÖÊ¥ÅËÉΩÊ∫êÊ∂àË¥πÈáè / Âπ¥ÁªºÂêàËÉΩÊ∫êÊ∂àË¥πÈáè √ó 100%'\n      },\n      \n      // ÂºïÂØºÊÄßÊåáÊ†á\n      solid_waste_utilization: {\n        name: 'Â∑•‰∏öÂõ∫Â∫üÁªºÂêàÂà©Áî®Áéá',\n        unit: '%',\n        target: CARBON_CONSTANTS.NATIONAL_TARGETS.SOLID_WASTE_UTILIZATION_TARGET,\n        priority: 'high',\n        calculation_method: 'Â∑•‰∏öÂõ∫Â∫üÁªºÂêàÂà©Áî®Èáè / Â∑•‰∏öÂõ∫Â∫ü‰∫ßÁîüÈáè √ó 100%'\n      },\n      waste_energy_utilization: {\n        name: '‰ΩôÁÉ≠/‰ΩôÂÜ∑/‰ΩôÂéãÁªºÂêàÂà©Áî®Áéá',\n        unit: '%',\n        target: CARBON_CONSTANTS.NATIONAL_TARGETS.WASTE_ENERGY_UTILIZATION_TARGET,\n        priority: 'high',\n        calculation_method: '‰ΩôËÉΩÂà©Áî®Èáè / ‰ΩôËÉΩ‰∫ßÁîüÈáè √ó 100%'\n      },\n      water_reuse_ratio: {\n        name: 'Â∑•‰∏öÁî®Ê∞¥ÈáçÂ§çÂà©Áî®Áéá',\n        unit: '%',\n        target: CARBON_CONSTANTS.NATIONAL_TARGETS.WATER_REUSE_TARGET,\n        priority: 'medium',\n        calculation_method: '‰∏≠Ê∞¥ÂõûÁî®Èáè / ÊÄªÁî®Ê∞¥Èáè √ó 100%'\n      }\n    };\n    \n    this.init();\n  }\n\n  async init() {\n    try {\n      await this.setupAlertRules();\n      await this.startMonitoring();\n      logger.info('ÂõΩÂÆ∂ÊåáÊ†á‰ΩìÁ≥ªÁõëÊµã‰ª™Ë°®ÁõòÂàùÂßãÂåñÂÆåÊàê');\n      this.emit('dashboard_initialized');\n    } catch (error) {\n      logger.error('ÂõΩÂÆ∂ÊåáÊ†á‰ΩìÁ≥ªÁõëÊµã‰ª™Ë°®ÁõòÂàùÂßãÂåñÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * ËÆæÁΩÆÈ¢ÑË≠¶ËßÑÂàô\n   */\n  async setupAlertRules() {\n    // Âçï‰ΩçËÉΩËÄóÁ¢≥ÊéíÊîæÈ¢ÑË≠¶ËßÑÂàô\n    this.alertRules.set('carbon_intensity', {\n      warning_threshold: CARBON_CONSTANTS.NATIONAL_TARGETS.CARBON_INTENSITY_TARGET_MAX * 0.9,\n      critical_threshold: CARBON_CONSTANTS.NATIONAL_TARGETS.CARBON_INTENSITY_TARGET_MAX,\n      check_type: 'greater_than'\n    });\n    \n    // Ê∏ÖÊ¥ÅËÉΩÊ∫êÊ∂àË¥πÂç†ÊØîÈ¢ÑË≠¶ËßÑÂàô\n    this.alertRules.set('clean_energy_ratio', {\n      warning_threshold: CARBON_CONSTANTS.NATIONAL_TARGETS.CLEAN_ENERGY_RATIO_TARGET * 0.95,\n      critical_threshold: CARBON_CONSTANTS.NATIONAL_TARGETS.CLEAN_ENERGY_RATIO_TARGET,\n      check_type: 'less_than'\n    });\n    \n    // Â∑•‰∏öÂõ∫Â∫üÁªºÂêàÂà©Áî®ÁéáÈ¢ÑË≠¶ËßÑÂàô\n    this.alertRules.set('solid_waste_utilization', {\n      warning_threshold: CARBON_CONSTANTS.NATIONAL_TARGETS.SOLID_WASTE_UTILIZATION_TARGET * 0.9,\n      critical_threshold: CARBON_CONSTANTS.NATIONAL_TARGETS.SOLID_WASTE_UTILIZATION_TARGET * 0.8,\n      check_type: 'less_than'\n    });\n    \n    logger.info('È¢ÑË≠¶ËßÑÂàôËÆæÁΩÆÂÆåÊàê');\n  }\n\n  /**\n   * ÂºÄÂßãÁõëÊµã\n   */\n  async startMonitoring() {\n    if (this.isMonitoring) {\n      logger.warn('ÁõëÊµãÂ∑≤Âú®ËøêË°å‰∏≠');\n      return;\n    }\n    \n    this.isMonitoring = true;\n    \n    // ÊØè5ÂàÜÈíüÊõ¥Êñ∞‰∏ÄÊ¨°ÊåáÊ†á\n    this.monitoringInterval = setInterval(async () => {\n      try {\n        await this.updateAllIndicators();\n      } catch (error) {\n        logger.error('Êõ¥Êñ∞ÊåáÊ†áÂ§±Ë¥•:', error);\n      }\n    }, TIME_INTERVALS.FIVE_MINUTES_MS);\n    \n    // Á´ãÂç≥ÊâßË°å‰∏ÄÊ¨°Êõ¥Êñ∞\n    await this.updateAllIndicators();\n    \n    logger.info('ÂõΩÂÆ∂ÊåáÊ†áÁõëÊµãÂ∑≤ÂêØÂä®');\n  }\n\n  /**\n   * ÂÅúÊ≠¢ÁõëÊµã\n   */\n  stopMonitoring() {\n    if (this.monitoringInterval) {\n      clearInterval(this.monitoringInterval);\n      this.monitoringInterval = null;\n    }\n    this.isMonitoring = false;\n    logger.info('ÂõΩÂÆ∂ÊåáÊ†áÁõëÊµãÂ∑≤ÂÅúÊ≠¢');\n  }\n\n  /**\n   * Êõ¥Êñ∞ÊâÄÊúâÊåáÊ†á\n   */\n  async updateAllIndicators() {\n    try {\n      const parks = await this.getAllParks();\n      \n      for (const park of parks) {\n        const indicators = await this.calculateParkIndicators(park.id);\n        this.indicatorCache.set(park.id, {\n          ...indicators,\n          last_updated: new Date().toISOString()\n        });\n        \n        // Ê£ÄÊü•È¢ÑË≠¶\n        await this.checkAlerts(park.id, indicators);\n        \n        // ÂèëÈÄÅÊõ¥Êñ∞‰∫ã‰ª∂\n        this.emit('indicators_updated', {\n          park_id: park.id,\n          indicators\n        });\n      }\n    } catch (error) {\n      logger.error('Êõ¥Êñ∞ÊâÄÊúâÊåáÊ†áÂ§±Ë¥•:', error);\n    }\n  }\n\n  /**\n   * ËÆ°ÁÆóÂõ≠Âå∫ÊåáÊ†á\n   */\n  async calculateParkIndicators(parkId) {\n    try {\n      const timeRange = '24h';\n      \n      // Ëé∑ÂèñÁ¢≥ÊéíÊîæÊï∞ÊçÆ\n      const carbonData = await this.carbonEngine.calculateParkTotalEmissions(parkId, timeRange);\n      \n      // Ëé∑ÂèñËÉΩÊ∫êÊ∂àË¥πÊï∞ÊçÆ\n      const energyData = await this.getEnergyConsumptionData(parkId, timeRange);\n      \n      // Ëé∑ÂèñËµÑÊ∫êÂæ™ÁéØÊï∞ÊçÆ\n      const resourceData = await this.getResourceCirculationData(parkId, timeRange);\n      \n      // ËÆ°ÁÆóÊ†∏ÂøÉÊåáÊ†á\n      const indicators = {\n        // Âçï‰ΩçËÉΩËÄóÁ¢≥ÊéíÊîæ\n        carbon_intensity: await this.calculateCarbonIntensity(carbonData, energyData),\n        \n        // Ê∏ÖÊ¥ÅËÉΩÊ∫êÊ∂àË¥πÂç†ÊØî\n        clean_energy_ratio: this.calculateCleanEnergyRatio(energyData),\n        \n        // Â∑•‰∏öÂõ∫Â∫üÁªºÂêàÂà©Áî®Áéá\n        solid_waste_utilization: this.calculateSolidWasteUtilization(resourceData),\n        \n        // ‰ΩôÁÉ≠/‰ΩôÂÜ∑/‰ΩôÂéãÁªºÂêàÂà©Áî®Áéá\n        waste_energy_utilization: this.calculateWasteEnergyUtilization(resourceData),\n        \n        // Â∑•‰∏öÁî®Ê∞¥ÈáçÂ§çÂà©Áî®Áéá\n        water_reuse_ratio: this.calculateWaterReuseRatio(resourceData),\n        \n        // ËÆ°ÁÆóÊó∂Èó¥\n        calculation_time: new Date().toISOString(),\n        \n        // Êï∞ÊçÆË¥®ÈáèËØÑÂàÜ\n        data_quality_score: await this.calculateDataQualityScore(parkId, timeRange)\n      };\n      \n      // Ê∑ªÂä†ËææÊ†áÁä∂ÊÄÅ\n      indicators.compliance_status = this.evaluateCompliance(indicators);\n      \n      return indicators;\n    } catch (error) {\n      logger.error(`ËÆ°ÁÆóÂõ≠Âå∫ ${parkId} ÊåáÊ†áÂ§±Ë¥•:`, error);\n      throw error;\n    }\n  }\n\n  /**\n   * ËÆ°ÁÆóÂçï‰ΩçËÉΩËÄóÁ¢≥ÊéíÊîæ\n   */\n  async calculateCarbonIntensity(carbonData, energyData) {\n    try {\n      // ËÆ°ÁÆóÂπ¥ÁªºÂêàËÉΩÊ∫êÊ∂àË¥πÈáèÔºàÊäòÊ†áÁÖ§Ôºâ\n      let totalEnergyConsumption = 0;\n      \n      for (const [energyType, consumption] of Object.entries(energyData)) {\n        const conversionFactor = this.getEnergyConversionFactor(energyType);\n        if (conversionFactor) {\n          totalEnergyConsumption += consumption * conversionFactor;\n        }\n      }\n      \n      // Âçï‰ΩçËÉΩËÄóÁ¢≥ÊéíÊîæ = EÂõ≠Âå∫ / Âπ¥ÁªºÂêàËÉΩÊ∫êÊ∂àË¥πÈáè\n      const carbonIntensity = totalEnergyConsumption > 0 ? \n        carbonData.total_emissions / totalEnergyConsumption : 0;\n      \n      return {\n        value: parseFloat(carbonIntensity.toFixed(CARBON_CONSTANTS.CALCULATION_PRECISION.EMISSION_DECIMAL_PLACES)),\n        unit: 'Âê®CO‚ÇÇ/Âê®Ê†áÂáÜÁÖ§',\n        target_min: CARBON_CONSTANTS.NATIONAL_TARGETS.CARBON_INTENSITY_TARGET_MIN,\n        target_max: CARBON_CONSTANTS.NATIONAL_TARGETS.CARBON_INTENSITY_TARGET_MAX,\n        status: this.getIndicatorStatus(carbonIntensity, \n          CARBON_CONSTANTS.NATIONAL_TARGETS.CARBON_INTENSITY_TARGET_MIN,\n          CARBON_CONSTANTS.NATIONAL_TARGETS.CARBON_INTENSITY_TARGET_MAX,\n          'range'),\n        total_emissions: carbonData.total_emissions,\n        total_energy_consumption: totalEnergyConsumption\n      };\n    } catch (error) {\n      logger.error('ËÆ°ÁÆóÂçï‰ΩçËÉΩËÄóÁ¢≥ÊéíÊîæÂ§±Ë¥•:', error);\n      return { value: 0, status: 'error', error: error.message };\n    }\n  }\n\n  /**\n   * ËÆ°ÁÆóÊ∏ÖÊ¥ÅËÉΩÊ∫êÊ∂àË¥πÂç†ÊØî\n   */\n  calculateCleanEnergyRatio(energyData) {\n    try {\n      const cleanEnergySources = ['solar', 'wind', 'hydro', 'nuclear'];\n      const cleanEnergyConsumption = cleanEnergySources.reduce((total, source) => {\n        return total + (energyData[source] || 0);\n      }, 0);\n      \n      const totalEnergyConsumption = Object.values(energyData).reduce((sum, value) => sum + value, 0);\n      \n      const ratio = totalEnergyConsumption > 0 ? \n        (cleanEnergyConsumption / totalEnergyConsumption) * MATH_CONSTANTS.ONE_HUNDRED : 0;\n      \n      return {\n        value: parseFloat(ratio.toFixed(CARBON_CONSTANTS.CALCULATION_PRECISION.RATIO_DECIMAL_PLACES)),\n        unit: '%',\n        target: CARBON_CONSTANTS.NATIONAL_TARGETS.CLEAN_ENERGY_RATIO_TARGET,\n        status: this.getIndicatorStatus(ratio, CARBON_CONSTANTS.NATIONAL_TARGETS.CLEAN_ENERGY_RATIO_TARGET, null, 'minimum'),\n        clean_energy_consumption: cleanEnergyConsumption,\n        total_energy_consumption: totalEnergyConsumption\n      };\n    } catch (error) {\n      logger.error('ËÆ°ÁÆóÊ∏ÖÊ¥ÅËÉΩÊ∫êÊ∂àË¥πÂç†ÊØîÂ§±Ë¥•:', error);\n      return { value: 0, status: 'error', error: error.message };\n    }\n  }\n\n  /**\n   * ËÆ°ÁÆóÂ∑•‰∏öÂõ∫Â∫üÁªºÂêàÂà©Áî®Áéá\n   */\n  calculateSolidWasteUtilization(resourceData) {\n    try {\n      const solidWasteData = resourceData.solid_waste || {};\n      const totalGeneration = solidWasteData.generation_amount || 0;\n      const totalUtilization = solidWasteData.utilization_amount || 0;\n      \n      const utilizationRate = totalGeneration > 0 ? \n        (totalUtilization / totalGeneration) * MATH_CONSTANTS.ONE_HUNDRED : 0;\n      \n      return {\n        value: parseFloat(utilizationRate.toFixed(CARBON_CONSTANTS.CALCULATION_PRECISION.RATIO_DECIMAL_PLACES)),\n        unit: '%',\n        target: CARBON_CONSTANTS.NATIONAL_TARGETS.SOLID_WASTE_UTILIZATION_TARGET,\n        status: this.getIndicatorStatus(utilizationRate, CARBON_CONSTANTS.NATIONAL_TARGETS.SOLID_WASTE_UTILIZATION_TARGET, null, 'minimum'),\n        total_generation: totalGeneration,\n        total_utilization: totalUtilization\n      };\n    } catch (error) {\n      logger.error('ËÆ°ÁÆóÂ∑•‰∏öÂõ∫Â∫üÁªºÂêàÂà©Áî®ÁéáÂ§±Ë¥•:', error);\n      return { value: 0, status: 'error', error: error.message };\n    }\n  }\n\n  /**\n   * ËÆ°ÁÆó‰ΩôÁÉ≠/‰ΩôÂÜ∑/‰ΩôÂéãÁªºÂêàÂà©Áî®Áéá\n   */\n  calculateWasteEnergyUtilization(resourceData) {\n    try {\n      const wasteEnergyTypes = ['waste_heat', 'waste_pressure'];\n      let totalGeneration = 0;\n      let totalUtilization = 0;\n      \n      wasteEnergyTypes.forEach(type => {\n        const data = resourceData[type] || {};\n        totalGeneration += data.generation_amount || 0;\n        totalUtilization += data.utilization_amount || 0;\n      });\n      \n      const utilizationRate = totalGeneration > 0 ? \n        (totalUtilization / totalGeneration) * MATH_CONSTANTS.ONE_HUNDRED : 0;\n      \n      return {\n        value: parseFloat(utilizationRate.toFixed(CARBON_CONSTANTS.CALCULATION_PRECISION.RATIO_DECIMAL_PLACES)),\n        unit: '%',\n        target: CARBON_CONSTANTS.NATIONAL_TARGETS.WASTE_ENERGY_UTILIZATION_TARGET,\n        status: this.getIndicatorStatus(utilizationRate, CARBON_CONSTANTS.NATIONAL_TARGETS.WASTE_ENERGY_UTILIZATION_TARGET, null, 'minimum'),\n        total_generation: totalGeneration,\n        total_utilization: totalUtilization\n      };\n    } catch (error) {\n      logger.error('ËÆ°ÁÆó‰ΩôÁÉ≠/‰ΩôÂÜ∑/‰ΩôÂéãÁªºÂêàÂà©Áî®ÁéáÂ§±Ë¥•:', error);\n      return { value: 0, status: 'error', error: error.message };\n    }\n  }\n\n  /**\n   * ËÆ°ÁÆóÂ∑•‰∏öÁî®Ê∞¥ÈáçÂ§çÂà©Áî®Áéá\n   */\n  calculateWaterReuseRatio(resourceData) {\n    try {\n      const waterData = resourceData.water || {};\n      const totalWaterUse = waterData.total_consumption || 0;\n      const reuseAmount = waterData.reuse_amount || 0;\n      \n      const reuseRatio = totalWaterUse > 0 ? \n        (reuseAmount / totalWaterUse) * MATH_CONSTANTS.ONE_HUNDRED : 0;\n      \n      return {\n        value: parseFloat(reuseRatio.toFixed(CARBON_CONSTANTS.CALCULATION_PRECISION.RATIO_DECIMAL_PLACES)),\n        unit: '%',\n        target: CARBON_CONSTANTS.NATIONAL_TARGETS.WATER_REUSE_TARGET,\n        status: this.getIndicatorStatus(reuseRatio, CARBON_CONSTANTS.NATIONAL_TARGETS.WATER_REUSE_TARGET, null, 'minimum'),\n        total_water_use: totalWaterUse,\n        reuse_amount: reuseAmount\n      };\n    } catch (error) {\n      logger.error('ËÆ°ÁÆóÂ∑•‰∏öÁî®Ê∞¥ÈáçÂ§çÂà©Áî®ÁéáÂ§±Ë¥•:', error);\n      return { value: 0, status: 'error', error: error.message };\n    }\n  }\n\n  /**\n   * Ëé∑ÂèñÊåáÊ†áÁä∂ÊÄÅ\n   */\n  getIndicatorStatus(value, target, targetMax = null, type = 'minimum') {\n    if (type === 'range' && targetMax !== null) {\n      if (value >= target && value <= targetMax) {\n        return 'excellent';\n      } else if (value < target * 1.1 || value > targetMax * 0.9) {\n        return 'warning';\n      } else {\n        return 'critical';\n      }\n    } else if (type === 'minimum') {\n      if (value >= target) {\n        return 'excellent';\n      } else if (value >= target * 0.9) {\n        return 'good';\n      } else if (value >= target * 0.8) {\n        return 'warning';\n      } else {\n        return 'critical';\n      }\n    }\n    return 'unknown';\n  }\n\n  /**\n   * ËØÑ‰º∞ÂêàËßÑÁä∂ÊÄÅ\n   */\n  evaluateCompliance(indicators) {\n    const criticalIndicators = ['carbon_intensity', 'clean_energy_ratio'];\n    let criticalCount = 0;\n    let warningCount = 0;\n    \n    for (const [key, indicator] of Object.entries(indicators)) {\n      if (typeof indicator === 'object' && indicator.status) {\n        if (indicator.status === 'critical') {\n          if (criticalIndicators.includes(key)) {\n            criticalCount++;\n          }\n        } else if (indicator.status === 'warning') {\n          warningCount++;\n        }\n      }\n    }\n    \n    if (criticalCount > 0) {\n      return 'non_compliant';\n    } else if (warningCount > 0) {\n      return 'at_risk';\n    } else {\n      return 'compliant';\n    }\n  }\n\n  /**\n   * Ê£ÄÊü•È¢ÑË≠¶\n   */\n  async checkAlerts(parkId, indicators) {\n    for (const [indicatorKey, rule] of this.alertRules) {\n      const indicator = indicators[indicatorKey];\n      if (!indicator || typeof indicator.value !== 'number') continue;\n      \n      const alertLevel = this.evaluateAlertLevel(indicator.value, rule);\n      \n      if (alertLevel !== 'normal') {\n        const alert = {\n          park_id: parkId,\n          indicator: indicatorKey,\n          level: alertLevel,\n          value: indicator.value,\n          threshold: alertLevel === 'critical' ? rule.critical_threshold : rule.warning_threshold,\n          message: this.generateAlertMessage(indicatorKey, alertLevel, indicator.value),\n          timestamp: new Date().toISOString()\n        };\n        \n        this.emit('alert_triggered', alert);\n        logger.warn(`È¢ÑË≠¶Ëß¶Âèë: ${alert.message}`);\n      }\n    }\n  }\n\n  /**\n   * ËØÑ‰º∞È¢ÑË≠¶Á∫ßÂà´\n   */\n  evaluateAlertLevel(value, rule) {\n    if (rule.check_type === 'greater_than') {\n      if (value >= rule.critical_threshold) return 'critical';\n      if (value >= rule.warning_threshold) return 'warning';\n    } else if (rule.check_type === 'less_than') {\n      if (value <= rule.critical_threshold) return 'critical';\n      if (value <= rule.warning_threshold) return 'warning';\n    }\n    return 'normal';\n  }\n\n  /**\n   * ÁîüÊàêÈ¢ÑË≠¶Ê∂àÊÅØ\n   */\n  generateAlertMessage(indicatorKey, level, value) {\n    const indicator = this.coreIndicators[indicatorKey];\n    const levelText = level === 'critical' ? '‰∏•Èáç' : 'Ë≠¶Âëä';\n    return `${indicator.name}${levelText}ÔºöÂΩìÂâçÂÄº ${value}${indicator.unit}`;\n  }\n\n  /**\n   * Ëé∑ÂèñËÉΩÊ∫êÊäòÊ†áÁÖ§Á≥ªÊï∞\n   */\n  getEnergyConversionFactor(energyType) {\n    const factors = CARBON_CONSTANTS.ENERGY_CONVERSION_FACTORS;\n    return factors[energyType.toUpperCase()] || factors.ELECTRICITY_EQUIVALENT;\n  }\n\n  /**\n   * ËÆ°ÁÆóÊï∞ÊçÆË¥®ÈáèËØÑÂàÜ\n   */\n  async calculateDataQualityScore(parkId, timeRange) {\n    try {\n      // ÁÆÄÂåñÁöÑÊï∞ÊçÆË¥®ÈáèËØÑÂàÜÁÆóÊ≥ï\n      const completeness = Math.random() * 0.1 + 0.9; // 90-100%\n      const accuracy = Math.random() * 0.05 + 0.95; // 95-100%\n      const timeliness = Math.random() * 0.1 + 0.9; // 90-100%\n      \n      const score = (completeness + accuracy + timeliness) / 3 * MATH_CONSTANTS.ONE_HUNDRED;\n      \n      return {\n        overall_score: parseFloat(score.toFixed(CARBON_CONSTANTS.CALCULATION_PRECISION.RATIO_DECIMAL_PLACES)),\n        completeness: parseFloat((completeness * MATH_CONSTANTS.ONE_HUNDRED).toFixed(CARBON_CONSTANTS.CALCULATION_PRECISION.RATIO_DECIMAL_PLACES)),\n        accuracy: parseFloat((accuracy * MATH_CONSTANTS.ONE_HUNDRED).toFixed(CARBON_CONSTANTS.CALCULATION_PRECISION.RATIO_DECIMAL_PLACES)),\n        timeliness: parseFloat((timeliness * MATH_CONSTANTS.ONE_HUNDRED).toFixed(CARBON_CONSTANTS.CALCULATION_PRECISION.RATIO_DECIMAL_PLACES))\n      };\n    } catch (error) {\n      logger.error('ËÆ°ÁÆóÊï∞ÊçÆË¥®ÈáèËØÑÂàÜÂ§±Ë¥•:', error);\n      return { overall_score: 0, error: error.message };\n    }\n  }\n\n  /**\n   * Ëé∑ÂèñÂõ≠Âå∫ÊåáÊ†á\n   */\n  getParkIndicators(parkId) {\n    return this.indicatorCache.get(parkId) || null;\n  }\n\n  /**\n   * Ëé∑ÂèñÊâÄÊúâÂõ≠Âå∫ÊåáÊ†á\n   */\n  getAllParkIndicators() {\n    const result = {};\n    for (const [parkId, indicators] of this.indicatorCache) {\n      result[parkId] = indicators;\n    }\n    return result;\n  }\n\n  // Ê®°ÊãüÊï∞ÊçÆËé∑ÂèñÊñπÊ≥ïÔºàÂÆûÈôÖÂ∫îÁî®‰∏≠ÈúÄË¶ÅËøûÊé•ÁúüÂÆûÊï∞ÊçÆÊ∫êÔºâ\n  async getEnergyConsumptionData(parkId, timeRange) {\n    return {\n      electricity: Math.random() * 10000,\n      natural_gas: Math.random() * 5000,\n      coal: Math.random() * 2000,\n      solar: Math.random() * 3000,\n      wind: Math.random() * 2000\n    };\n  }\n\n  async getResourceCirculationData(parkId, timeRange) {\n    return {\n      solid_waste: {\n        generation_amount: Math.random() * 1000,\n        utilization_amount: Math.random() * 900\n      },\n      waste_heat: {\n        generation_amount: Math.random() * 500,\n        utilization_amount: Math.random() * 400\n      },\n      waste_pressure: {\n        generation_amount: Math.random() * 300,\n        utilization_amount: Math.random() * 240\n      },\n      water: {\n        total_consumption: Math.random() * 10000,\n        reuse_amount: Math.random() * 9000\n      }\n    };\n  }\n\n  async getAllParks() {\n    return [\n      { id: 'park_001', name: 'Á§∫‰æãÂõ≠Âå∫1' },\n      { id: 'park_002', name: 'Á§∫‰æãÂõ≠Âå∫2' }\n    ];\n  }\n\n  /**\n   * ÈîÄÊØÅÂÆû‰æã\n   */\n  dispose() {\n    this.stopMonitoring();\n    this.indicatorCache.clear();\n    this.alertRules.clear();\n    this.removeAllListeners();\n  }\n}\n\nexport default NationalIndicatorDashboard;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/core/services/NationalIndicatorEngine.js","messages":[{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":489,"column":21,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":489,"endColumn":38,"fix":{"range":[19618,19635],"text":"{return 'unknown';}"}},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":492,"column":41,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":492,"endColumn":60,"fix":{"range":[19770,19789],"text":"{return 'excellent';}"}},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":493,"column":36,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":493,"endColumn":50,"fix":{"range":[19825,19839],"text":"{return 'good';}"}},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":494,"column":39,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":494,"endColumn":56,"fix":{"range":[19878,19895],"text":"{return 'average';}"}},{"ruleId":"no-else-return","severity":2,"message":"Unnecessary 'else' after 'return'.","line":496,"column":12,"nodeType":"BlockStatement","messageId":"unexpected","endLine":501,"endColumn":6,"fix":{"range":[19218,20126],"text":"(value, indicatorType) {\n    // ÁÆÄÂåñÁöÑËØÑÁ∫ßÈÄªËæëÔºåÂÆûÈôÖÂ∫îÊ†πÊçÆË°å‰∏öÂü∫ÂáÜ\n    const thresholds = {\n      unit_energy_carbon: { excellent: 0.5, good: 1.0, average: 1.5, poor: 2.0 },\n      clean_energy_ratio: { excellent: 50, good: 30, average: 20, poor: 10 },\n      total_emissions: { excellent: 1000, good: 5000, average: 10000, poor: 20000 }\n    };\n    \n    const threshold = thresholds[indicatorType];\n    if (!threshold) return 'unknown';\n    \n    if (indicatorType === 'unit_energy_carbon' || indicatorType === 'total_emissions') {\n      if (value <= threshold.excellent) return 'excellent';\n      if (value <= threshold.good) return 'good';\n      if (value <= threshold.average) return 'average';\n      return 'poor';\n    } \n      if (value >= threshold.excellent) return 'excellent';\n      if (value >= threshold.good) return 'good';\n      if (value >= threshold.average) return 'average';\n      return 'poor';\n    \n  }"}},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":497,"column":41,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":497,"endColumn":60,"fix":{"range":[19970,19989],"text":"{return 'excellent';}"}},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":498,"column":36,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":498,"endColumn":50,"fix":{"range":[20025,20039],"text":"{return 'good';}"}},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":499,"column":39,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":499,"endColumn":56,"fix":{"range":[20078,20095],"text":"{return 'average';}"}},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":512,"column":18,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":512,"endColumn":35,"fix":{"range":[20416,20433],"text":"{return 'unknown';}"}},{"ruleId":"no-else-return","severity":2,"message":"Unnecessary 'else' after 'return'.","line":516,"column":12,"nodeType":"BlockStatement","messageId":"unexpected","endLine":518,"endColumn":6,"fix":{"range":[20152,20635],"text":"(value, indicatorType) {\n    const targets = {\n      unit_energy_carbon: 1.0, // Á§∫‰æãÁõÆÊ†áÂÄº\n      clean_energy_ratio: this.nationalTargets.clean_energy_ratio,\n      total_emissions: 10000 // Á§∫‰æãÁõÆÊ†áÂÄº\n    };\n    \n    const target = targets[indicatorType];\n    if (!target) return 'unknown';\n    \n    if (indicatorType === 'clean_energy_ratio') {\n      return value >= target ? 'compliant' : 'non_compliant';\n    } \n      return value <= target ? 'compliant' : 'non_compliant';\n    \n  }"}},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 3.","line":533,"column":52,"nodeType":"Literal","messageId":"noMagic","endLine":533,"endColumn":53},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 3.","line":543,"column":28,"nodeType":"Literal","messageId":"noMagic","endLine":543,"endColumn":29},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":543,"column":31,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":543,"endColumn":56,"fix":{"range":[21498,21523],"text":"{return 'fully_compliant';}"}},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":544,"column":30,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":544,"endColumn":56,"fix":{"range":[21553,21579],"text":"{return 'mostly_compliant';}"}},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":545,"column":30,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":545,"endColumn":59,"fix":{"range":[21609,21638],"text":"{return 'partially_compliant';}"}},{"ruleId":"no-unused-vars","severity":2,"message":"'parkId' is defined but never used. Allowed unused args must match /^_/u.","line":554,"column":42,"nodeType":"Identifier","messageId":"unusedVar","endLine":554,"endColumn":48},{"ruleId":"no-unused-vars","severity":2,"message":"'startTime' is defined but never used. Allowed unused args must match /^_/u.","line":554,"column":50,"nodeType":"Identifier","messageId":"unusedVar","endLine":554,"endColumn":59},{"ruleId":"no-unused-vars","severity":2,"message":"'endTime' is defined but never used. Allowed unused args must match /^_/u.","line":554,"column":61,"nodeType":"Identifier","messageId":"unusedVar","endLine":554,"endColumn":68},{"ruleId":"no-unused-vars","severity":2,"message":"'parkId' is defined but never used. Allowed unused args must match /^_/u.","line":568,"column":45,"nodeType":"Identifier","messageId":"unusedVar","endLine":568,"endColumn":51},{"ruleId":"no-unused-vars","severity":2,"message":"'startTime' is defined but never used. Allowed unused args must match /^_/u.","line":568,"column":53,"nodeType":"Identifier","messageId":"unusedVar","endLine":568,"endColumn":62},{"ruleId":"no-unused-vars","severity":2,"message":"'endTime' is defined but never used. Allowed unused args must match /^_/u.","line":568,"column":64,"nodeType":"Identifier","messageId":"unusedVar","endLine":568,"endColumn":71},{"ruleId":"no-unused-vars","severity":2,"message":"'parkId' is defined but never used. Allowed unused args must match /^_/u.","line":579,"column":33,"nodeType":"Identifier","messageId":"unusedVar","endLine":579,"endColumn":39},{"ruleId":"no-unused-vars","severity":2,"message":"'startTime' is defined but never used. Allowed unused args must match /^_/u.","line":579,"column":41,"nodeType":"Identifier","messageId":"unusedVar","endLine":579,"endColumn":50},{"ruleId":"no-unused-vars","severity":2,"message":"'endTime' is defined but never used. Allowed unused args must match /^_/u.","line":579,"column":52,"nodeType":"Identifier","messageId":"unusedVar","endLine":579,"endColumn":59},{"ruleId":"no-unused-vars","severity":2,"message":"'parkId' is defined but never used. Allowed unused args must match /^_/u.","line":590,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":590,"endColumn":26},{"ruleId":"no-unused-vars","severity":2,"message":"'startTime' is defined but never used. Allowed unused args must match /^_/u.","line":590,"column":28,"nodeType":"Identifier","messageId":"unusedVar","endLine":590,"endColumn":37},{"ruleId":"no-unused-vars","severity":2,"message":"'endTime' is defined but never used. Allowed unused args must match /^_/u.","line":590,"column":39,"nodeType":"Identifier","messageId":"unusedVar","endLine":590,"endColumn":46},{"ruleId":"no-unused-vars","severity":2,"message":"'parkId' is defined but never used. Allowed unused args must match /^_/u.","line":601,"column":35,"nodeType":"Identifier","messageId":"unusedVar","endLine":601,"endColumn":41},{"ruleId":"no-unused-vars","severity":2,"message":"'startTime' is defined but never used. Allowed unused args must match /^_/u.","line":601,"column":43,"nodeType":"Identifier","messageId":"unusedVar","endLine":601,"endColumn":52},{"ruleId":"no-unused-vars","severity":2,"message":"'endTime' is defined but never used. Allowed unused args must match /^_/u.","line":601,"column":54,"nodeType":"Identifier","messageId":"unusedVar","endLine":601,"endColumn":61},{"ruleId":"no-unused-vars","severity":2,"message":"'parkId' is defined but never used. Allowed unused args must match /^_/u.","line":613,"column":35,"nodeType":"Identifier","messageId":"unusedVar","endLine":613,"endColumn":41},{"ruleId":"no-unused-vars","severity":2,"message":"'startTime' is defined but never used. Allowed unused args must match /^_/u.","line":613,"column":43,"nodeType":"Identifier","messageId":"unusedVar","endLine":613,"endColumn":52},{"ruleId":"no-unused-vars","severity":2,"message":"'endTime' is defined but never used. Allowed unused args must match /^_/u.","line":613,"column":54,"nodeType":"Identifier","messageId":"unusedVar","endLine":613,"endColumn":61},{"ruleId":"no-unused-vars","severity":2,"message":"'parkId' is defined but never used. Allowed unused args must match /^_/u.","line":652,"column":32,"nodeType":"Identifier","messageId":"unusedVar","endLine":652,"endColumn":38},{"ruleId":"no-unused-vars","severity":2,"message":"'indicator' is defined but never used. Allowed unused args must match /^_/u.","line":652,"column":40,"nodeType":"Identifier","messageId":"unusedVar","endLine":652,"endColumn":49},{"ruleId":"no-unused-vars","severity":2,"message":"'timeRange' is defined but never used. Allowed unused args must match /^_/u.","line":652,"column":51,"nodeType":"Identifier","messageId":"unusedVar","endLine":652,"endColumn":60},{"ruleId":"no-unused-vars","severity":2,"message":"'parkId' is defined but never used. Allowed unused args must match /^_/u.","line":660,"column":30,"nodeType":"Identifier","messageId":"unusedVar","endLine":660,"endColumn":36},{"ruleId":"no-unused-vars","severity":2,"message":"'startTime' is defined but never used. Allowed unused args must match /^_/u.","line":660,"column":38,"nodeType":"Identifier","messageId":"unusedVar","endLine":660,"endColumn":47},{"ruleId":"no-unused-vars","severity":2,"message":"'endTime' is defined but never used. Allowed unused args must match /^_/u.","line":660,"column":49,"nodeType":"Identifier","messageId":"unusedVar","endLine":660,"endColumn":56},{"ruleId":"no-unused-vars","severity":2,"message":"'parkId' is defined but never used. Allowed unused args must match /^_/u.","line":669,"column":53,"nodeType":"Identifier","messageId":"unusedVar","endLine":669,"endColumn":59},{"ruleId":"no-unused-vars","severity":2,"message":"'startTime' is defined but never used. Allowed unused args must match /^_/u.","line":669,"column":61,"nodeType":"Identifier","messageId":"unusedVar","endLine":669,"endColumn":70},{"ruleId":"no-unused-vars","severity":2,"message":"'endTime' is defined but never used. Allowed unused args must match /^_/u.","line":669,"column":72,"nodeType":"Identifier","messageId":"unusedVar","endLine":669,"endColumn":79},{"ruleId":"no-unused-vars","severity":2,"message":"'parkId' is defined but never used. Allowed unused args must match /^_/u.","line":681,"column":35,"nodeType":"Identifier","messageId":"unusedVar","endLine":681,"endColumn":41},{"ruleId":"no-unused-vars","severity":2,"message":"'emissions' is defined but never used. Allowed unused args must match /^_/u.","line":681,"column":43,"nodeType":"Identifier","messageId":"unusedVar","endLine":681,"endColumn":52},{"ruleId":"no-unused-vars","severity":2,"message":"'parkId' is defined but never used. Allowed unused args must match /^_/u.","line":689,"column":37,"nodeType":"Identifier","messageId":"unusedVar","endLine":689,"endColumn":43},{"ruleId":"no-unused-vars","severity":2,"message":"'emissions' is defined but never used. Allowed unused args must match /^_/u.","line":689,"column":45,"nodeType":"Identifier","messageId":"unusedVar","endLine":689,"endColumn":54},{"ruleId":"no-unused-vars","severity":2,"message":"'parkId' is defined but never used. Allowed unused args must match /^_/u.","line":697,"column":33,"nodeType":"Identifier","messageId":"unusedVar","endLine":697,"endColumn":39},{"ruleId":"no-unused-vars","severity":2,"message":"'unitEnergyCarbon' is defined but never used. Allowed unused args must match /^_/u.","line":697,"column":41,"nodeType":"Identifier","messageId":"unusedVar","endLine":697,"endColumn":57},{"ruleId":"no-unused-vars","severity":2,"message":"'cleanEnergyRatio' is defined but never used. Allowed unused args must match /^_/u.","line":697,"column":59,"nodeType":"Identifier","messageId":"unusedVar","endLine":697,"endColumn":75},{"ruleId":"no-unused-vars","severity":2,"message":"'totalEmissions' is defined but never used. Allowed unused args must match /^_/u.","line":697,"column":77,"nodeType":"Identifier","messageId":"unusedVar","endLine":697,"endColumn":91},{"ruleId":"no-unused-vars","severity":2,"message":"'parkId' is defined but never used. Allowed unused args must match /^_/u.","line":714,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":714,"endColumn":33},{"ruleId":"no-unused-vars","severity":2,"message":"'timeRange' is defined but never used. Allowed unused args must match /^_/u.","line":714,"column":35,"nodeType":"Identifier","messageId":"unusedVar","endLine":714,"endColumn":44},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 95.","line":715,"column":12,"nodeType":"Literal","messageId":"noMagic","endLine":715,"endColumn":14},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":725,"column":48,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":725,"endColumn":66,"fix":{"range":[25579,25597],"text":"{return 'platinum';}"}},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":726,"column":77,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":726,"endColumn":91,"fix":{"range":[25674,25688],"text":"{return 'gold';}"}},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":727,"column":56,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":727,"endColumn":72,"fix":{"range":[25744,25760],"text":"{return 'silver';}"}}],"suppressedMessages":[],"errorCount":53,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":16,"fixableWarningCount":0,"source":"/**\n * ÂõΩÂÆ∂Ê†∏ÂøÉÊåáÊ†áËÆ°ÁÆóÂºïÊìé\n * ÂÆûÁé∞„ÄäÈÄöÁü•„ÄãË¶ÅÊ±ÇÁöÑÊ†∏ÂøÉÊåáÊ†áËÆ°ÁÆóÔºö\n * 1. Âçï‰ΩçËÉΩËÄóÁ¢≥ÊéíÊîæ (tCO2/‰∏áÂÖÉ)\n * 2. Ê∏ÖÊ¥ÅËÉΩÊ∫êÊ∂àË¥πÂç†ÊØî (%)\n * 3. Âõ≠Âå∫ÊÄªÁ¢≥ÊéíÊîæ (tCO2)\n */\n\nimport { EventEmitter } from 'events';\nimport logger from '../../shared/utils/logger.js';\nimport { ENERGY_CONSTANTS, MATH_CONSTANTS } from '../../shared/constants/MathConstants.js';\n\nclass NationalIndicatorEngine extends EventEmitter {\n  constructor() {\n    super();\n    this.isInitialized = false;\n    this.indicatorCache = new Map();\n    this.calculationHistory = new Map();\n    this.benchmarkData = new Map();\n    \n    // ÂõΩÂÆ∂Ê†áÂáÜÊéíÊîæÂõ†Â≠ê (Ê†πÊçÆ„ÄäÈÄöÁü•„ÄãË¶ÅÊ±Ç)\n    this.emissionFactors = {\n      // ÁîµÂäõÊéíÊîæÂõ†Â≠ê (tCO2/MWh)\n      electricity: {\n        grid: 0.5703, // ÂÖ®ÂõΩÁîµÁΩëÂπ≥ÂùáÊéíÊîæÂõ†Â≠ê\n        regional: {\n          north: 0.8843,   // ÂçéÂåóÁîµÁΩë\n          northeast: 0.8825, // ‰∏úÂåóÁîµÁΩë\n          east: 0.7035,    // Âçé‰∏úÁîµÁΩë\n          central: 0.8367,  // Âçé‰∏≠ÁîµÁΩë\n          northwest: 0.8922, // Ë•øÂåóÁîµÁΩë\n          south: 0.8042    // ÂçóÊñπÁîµÁΩë\n        }\n      },\n      // ÂåñÁü≥ÁáÉÊñôÊéíÊîæÂõ†Â≠ê (tCO2/tÊàñtCO2/‰∏ám¬≥)\n      fossil_fuels: {\n        coal: 1.9003,        // ÂéüÁÖ§ tCO2/t\n        coke: 2.8604,        // ÁÑ¶ÁÇ≠ tCO2/t\n        crude_oil: 3.0202,   // ÂéüÊ≤π tCO2/t\n        gasoline: 2.9251,    // Ê±ΩÊ≤π tCO2/t\n        diesel: 3.0959,      // Êü¥Ê≤π tCO2/t\n        fuel_oil: 3.1705,    // ÁáÉÊñôÊ≤π tCO2/t\n        natural_gas: 2.1622, // Â§©ÁÑ∂Ê∞î tCO2/‰∏ám¬≥\n        lpg: 3.0112         // Ê∂≤ÂåñÁü≥Ê≤πÊ∞î tCO2/t\n      },\n      // Â∑•‰∏öËøáÁ®ãÊéíÊîæÂõ†Â≠ê\n      industrial_process: {\n        cement: 0.5383,      // Ê∞¥Ê≥•Áîü‰∫ß tCO2/t\n        steel: 2.07,         // Èí¢ÈìÅÁîü‰∫ß tCO2/t\n        aluminum: 1.69,      // ÁîµËß£Èìù tCO2/t\n        glass: 0.1968,       // Âπ≥ÊùøÁéªÁíÉ tCO2/ÈáçÈáèÁÆ±\n        ammonia: 1.485,      // ÂêàÊàêÊ∞® tCO2/t\n        nitric_acid: 0.3    // Á°ùÈÖ∏ tCO2/t\n      }\n    };\n    \n    // Ê∏ÖÊ¥ÅËÉΩÊ∫êÁ±ªÂûãÂÆö‰πâ\n    this.cleanEnergyTypes = {\n      renewable: ['solar', 'wind', 'hydro', 'biomass', 'geothermal'],\n      nuclear: ['nuclear'],\n      other_clean: ['hydrogen', 'clean_coal'] // ÂÖ∂‰ªñÊ∏ÖÊ¥ÅËÉΩÊ∫ê\n    };\n    \n    // ÂõΩÂÆ∂ÁõÆÊ†áÂü∫ÂáÜÂÄº\n    this.nationalTargets = {\n      carbon_intensity_reduction: 18, // Âçï‰ΩçGDPÁ¢≥Âº∫Â∫¶‰∏ãÈôç18%\n      clean_energy_ratio: 25,         // Ê∏ÖÊ¥ÅËÉΩÊ∫êÊ∂àË¥πÂç†ÊØî25%\n      renewable_ratio: 20,            // ÂèØÂÜçÁîüËÉΩÊ∫êÊ∂àË¥πÂç†ÊØî20%\n      energy_intensity_reduction: 13.5 // Âçï‰ΩçGDPËÉΩËÄó‰∏ãÈôç13.5%\n    };\n    \n    this.init();\n  }\n\n  async init() {\n    try {\n      await this.loadBenchmarkData();\n      await this.setupCalculationScheduler();\n      this.isInitialized = true;\n      logger.info('ÂõΩÂÆ∂Ê†∏ÂøÉÊåáÊ†áËÆ°ÁÆóÂºïÊìéÂàùÂßãÂåñÂÆåÊàê');\n      this.emit('initialized');\n    } catch (error) {\n      logger.error('ÂõΩÂÆ∂ÊåáÊ†áËÆ°ÁÆóÂºïÊìéÂàùÂßãÂåñÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Âä†ËΩΩÂü∫ÂáÜÊï∞ÊçÆ\n   */\n  async loadBenchmarkData() {\n    try {\n      // Âä†ËΩΩË°å‰∏öÂü∫ÂáÜÊï∞ÊçÆ\n      const industryBenchmarks = await this.getIndustryBenchmarks();\n      industryBenchmarks.forEach(benchmark => {\n        this.benchmarkData.set(benchmark.industry_code, benchmark);\n      });\n      \n      logger.info(`Â∑≤Âä†ËΩΩË°å‰∏öÂü∫ÂáÜÊï∞ÊçÆ ${this.benchmarkData.size} ‰∏™`);\n    } catch (error) {\n      logger.error('Âä†ËΩΩÂü∫ÂáÜÊï∞ÊçÆÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * ËÆæÁΩÆËÆ°ÁÆóË∞ÉÂ∫¶Âô®\n   */\n  async setupCalculationScheduler() {\n    // ÊØèÂ∞èÊó∂ËÆ°ÁÆó‰∏ÄÊ¨°Ê†∏ÂøÉÊåáÊ†á\n    setInterval(async () => {\n      try {\n        await this.calculateAllIndicators();\n        this.emit('indicators_updated', {\n          timestamp: new Date().toISOString(),\n          indicators: Array.from(this.indicatorCache.values())\n        });\n      } catch (error) {\n        logger.error('ÂÆöÊó∂ËÆ°ÁÆóÊåáÊ†áÂ§±Ë¥•:', error);\n      }\n    }, MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.MILLISECONDS_PER_SECOND);\n  }\n\n  /**\n   * ËÆ°ÁÆóÂçï‰ΩçËÉΩËÄóÁ¢≥ÊéíÊîæ (tCO2/‰∏áÂÖÉ)\n   * ÂÖ¨Âºè: EÂçï‰ΩçËÉΩËÄó = (EËÉΩÊ∫êÊ¥ªÂä® + EÂ∑•‰∏öËøáÁ®ã) / GDP\n   * @param {string} parkId - Âõ≠Âå∫ID\n   * @param {string} timeRange - Êó∂Èó¥ËåÉÂõ¥\n   * @returns {Object} Âçï‰ΩçËÉΩËÄóÁ¢≥ÊéíÊîæÊï∞ÊçÆ\n   */\n  async calculateUnitEnergyCarbon(parkId, timeRange = '1M') {\n    try {\n      const startTime = this.getStartTime(timeRange);\n      const endTime = new Date();\n      \n      // Ëé∑ÂèñËÉΩÊ∫êÊ¥ªÂä®Á¢≥ÊéíÊîæ\n      const energyEmissions = await this.calculateEnergyActivityEmissions(parkId, startTime, endTime);\n      \n      // Ëé∑ÂèñÂ∑•‰∏öËøáÁ®ãÁ¢≥ÊéíÊîæ\n      const processEmissions = await this.calculateIndustrialProcessEmissions(parkId, startTime, endTime);\n      \n      // Ëé∑ÂèñGDPÊï∞ÊçÆ\n      const gdpData = await this.getGDPData(parkId, startTime, endTime);\n      \n      // ËÆ°ÁÆóÊÄªÁ¢≥ÊéíÊîæ\n      const totalEmissions = energyEmissions.total + processEmissions.total;\n      \n      // ËÆ°ÁÆóÂçï‰ΩçËÉΩËÄóÁ¢≥ÊéíÊîæ (tCO2/‰∏áÂÖÉ)\n      const unitEnergyCarbon = gdpData.total > 0 ? \n        (totalEmissions / (gdpData.total / MATH_CONSTANTS.TEN_THOUSAND)).toFixed(MATH_CONSTANTS.DECIMAL_PLACES) : 0;\n      \n      const result = {\n        park_id: parkId,\n        time_range: timeRange,\n        start_time: startTime.toISOString(),\n        end_time: endTime.toISOString(),\n        calculation_time: new Date().toISOString(),\n        unit_energy_carbon: parseFloat(unitEnergyCarbon),\n        unit: 'tCO2/‰∏áÂÖÉ',\n        components: {\n          energy_activity_emissions: energyEmissions,\n          industrial_process_emissions: processEmissions,\n          total_emissions: totalEmissions,\n          gdp_data: gdpData\n        },\n        breakdown: {\n          by_energy_type: energyEmissions.by_type,\n          by_process_type: processEmissions.by_type,\n          by_sector: await this.getEmissionsBySector(parkId, startTime, endTime)\n        },\n        benchmark_comparison: {\n          industry_average: await this.getIndustryAverage(parkId, 'unit_energy_carbon'),\n          national_target: this.nationalTargets.carbon_intensity_reduction,\n          performance_rating: this.calculatePerformanceRating(unitEnergyCarbon, 'unit_energy_carbon')\n        },\n        trend_analysis: await this.calculateTrendAnalysis(parkId, 'unit_energy_carbon', timeRange),\n        compliance_status: this.assessComplianceStatus(unitEnergyCarbon, 'unit_energy_carbon')\n      };\n      \n      // ÁºìÂ≠òÁªìÊûú\n      this.indicatorCache.set(`unit_energy_carbon_${parkId}_${timeRange}`, result);\n      \n      logger.info(`ËÆ°ÁÆóÂçï‰ΩçËÉΩËÄóÁ¢≥ÊéíÊîæÂÆåÊàê: ${parkId}, ÂÄº: ${unitEnergyCarbon} tCO2/‰∏áÂÖÉ`);\n      return result;\n    } catch (error) {\n      logger.error('ËÆ°ÁÆóÂçï‰ΩçËÉΩËÄóÁ¢≥ÊéíÊîæÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * ËÆ°ÁÆóÊ∏ÖÊ¥ÅËÉΩÊ∫êÊ∂àË¥πÂç†ÊØî (%)\n   * ÂÖ¨Âºè: RÊ∏ÖÊ¥ÅËÉΩÊ∫ê = EÊ∏ÖÊ¥ÅËÉΩÊ∫ê / EÊÄªËÉΩÊ∫êÊ∂àË¥π √ó 100%\n   * @param {string} parkId - Âõ≠Âå∫ID\n   * @param {string} timeRange - Êó∂Èó¥ËåÉÂõ¥\n   * @returns {Object} Ê∏ÖÊ¥ÅËÉΩÊ∫êÊ∂àË¥πÂç†ÊØîÊï∞ÊçÆ\n   */\n  async calculateCleanEnergyRatio(parkId, timeRange = '1M') {\n    try {\n      const startTime = this.getStartTime(timeRange);\n      const endTime = new Date();\n      \n      // Ëé∑ÂèñÊÄªËÉΩÊ∫êÊ∂àË¥πÊï∞ÊçÆ\n      const totalEnergyConsumption = await this.getTotalEnergyConsumption(parkId, startTime, endTime);\n      \n      // Ëé∑ÂèñÊ∏ÖÊ¥ÅËÉΩÊ∫êÊ∂àË¥πÊï∞ÊçÆ\n      const cleanEnergyConsumption = await this.getCleanEnergyConsumption(parkId, startTime, endTime);\n      \n      // ËÆ°ÁÆóÊ∏ÖÊ¥ÅËÉΩÊ∫êÊ∂àË¥πÂç†ÊØî\n      const cleanEnergyRatio = totalEnergyConsumption.total > 0 ? \n        (cleanEnergyConsumption.total / totalEnergyConsumption.total * MATH_CONSTANTS.ONE_HUNDRED).toFixed(MATH_CONSTANTS.DECIMAL_PLACES) : 0;\n      \n      // ÂàÜÁ±ªÁªüËÆ°\n      const renewableRatio = totalEnergyConsumption.total > 0 ? \n        (cleanEnergyConsumption.renewable / totalEnergyConsumption.total * MATH_CONSTANTS.ONE_HUNDRED).toFixed(MATH_CONSTANTS.DECIMAL_PLACES) : 0;\n      \n      const nuclearRatio = totalEnergyConsumption.total > 0 ? \n        (cleanEnergyConsumption.nuclear / totalEnergyConsumption.total * MATH_CONSTANTS.ONE_HUNDRED).toFixed(MATH_CONSTANTS.DECIMAL_PLACES) : 0;\n      \n      const result = {\n        park_id: parkId,\n        time_range: timeRange,\n        start_time: startTime.toISOString(),\n        end_time: endTime.toISOString(),\n        calculation_time: new Date().toISOString(),\n        clean_energy_ratio: parseFloat(cleanEnergyRatio),\n        renewable_ratio: parseFloat(renewableRatio),\n        nuclear_ratio: parseFloat(nuclearRatio),\n        unit: '%',\n        energy_consumption: {\n          total: totalEnergyConsumption,\n          clean: cleanEnergyConsumption,\n          fossil: {\n            total: totalEnergyConsumption.total - cleanEnergyConsumption.total,\n            by_type: totalEnergyConsumption.by_type.fossil || {}\n          }\n        },\n        breakdown: {\n          by_clean_type: {\n            solar: this.calculateTypeRatio(cleanEnergyConsumption.by_type.solar, totalEnergyConsumption.total),\n            wind: this.calculateTypeRatio(cleanEnergyConsumption.by_type.wind, totalEnergyConsumption.total),\n            hydro: this.calculateTypeRatio(cleanEnergyConsumption.by_type.hydro, totalEnergyConsumption.total),\n            biomass: this.calculateTypeRatio(cleanEnergyConsumption.by_type.biomass, totalEnergyConsumption.total),\n            nuclear: this.calculateTypeRatio(cleanEnergyConsumption.by_type.nuclear, totalEnergyConsumption.total),\n            other: this.calculateTypeRatio(cleanEnergyConsumption.by_type.other, totalEnergyConsumption.total)\n          },\n          by_sector: await this.getCleanEnergyBySector(parkId, startTime, endTime),\n          by_time: await this.getCleanEnergyByTime(parkId, startTime, endTime, timeRange)\n        },\n        benchmark_comparison: {\n          national_target: this.nationalTargets.clean_energy_ratio,\n          renewable_target: this.nationalTargets.renewable_ratio,\n          industry_average: await this.getIndustryAverage(parkId, 'clean_energy_ratio'),\n          performance_rating: this.calculatePerformanceRating(cleanEnergyRatio, 'clean_energy_ratio')\n        },\n        trend_analysis: await this.calculateTrendAnalysis(parkId, 'clean_energy_ratio', timeRange),\n        compliance_status: this.assessComplianceStatus(cleanEnergyRatio, 'clean_energy_ratio'),\n        carbon_reduction_impact: {\n          avoided_emissions: this.calculateAvoidedEmissions(cleanEnergyConsumption.total),\n          equivalent_trees: Math.floor(this.calculateAvoidedEmissions(cleanEnergyConsumption.total) / ENERGY_CONSTANTS.TREE_CARBON_ABSORPTION),\n          economic_value: this.calculateCarbonEconomicValue(this.calculateAvoidedEmissions(cleanEnergyConsumption.total))\n        }\n      };\n      \n      // ÁºìÂ≠òÁªìÊûú\n      this.indicatorCache.set(`clean_energy_ratio_${parkId}_${timeRange}`, result);\n      \n      logger.info(`ËÆ°ÁÆóÊ∏ÖÊ¥ÅËÉΩÊ∫êÊ∂àË¥πÂç†ÊØîÂÆåÊàê: ${parkId}, ÂÄº: ${cleanEnergyRatio}%`);\n      return result;\n    } catch (error) {\n      logger.error('ËÆ°ÁÆóÊ∏ÖÊ¥ÅËÉΩÊ∫êÊ∂àË¥πÂç†ÊØîÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * ËÆ°ÁÆóÂõ≠Âå∫ÊÄªÁ¢≥ÊéíÊîæ (tCO2)\n   * ÂÖ¨Âºè: EÂõ≠Âå∫ = EËÉΩÊ∫êÊ¥ªÂä® + EÂ∑•‰∏öËøáÁ®ã + EÂÖ∂‰ªñ\n   * @param {string} parkId - Âõ≠Âå∫ID\n   * @param {string} timeRange - Êó∂Èó¥ËåÉÂõ¥\n   * @returns {Object} Âõ≠Âå∫ÊÄªÁ¢≥ÊéíÊîæÊï∞ÊçÆ\n   */\n  async calculateTotalParkEmissions(parkId, timeRange = '1M') {\n    try {\n      const startTime = this.getStartTime(timeRange);\n      const endTime = new Date();\n      \n      // Ëé∑ÂèñÂêÑÁ±ªÁ¢≥ÊéíÊîæ\n      const energyEmissions = await this.calculateEnergyActivityEmissions(parkId, startTime, endTime);\n      const processEmissions = await this.calculateIndustrialProcessEmissions(parkId, startTime, endTime);\n      const otherEmissions = await this.calculateOtherEmissions(parkId, startTime, endTime);\n      \n      // ËÆ°ÁÆóÊÄªÊéíÊîæ\n      const totalEmissions = energyEmissions.total + processEmissions.total + otherEmissions.total;\n      \n      const result = {\n        park_id: parkId,\n        time_range: timeRange,\n        start_time: startTime.toISOString(),\n        end_time: endTime.toISOString(),\n        calculation_time: new Date().toISOString(),\n        total_emissions: totalEmissions,\n        unit: 'tCO2',\n        components: {\n          energy_activity: energyEmissions,\n          industrial_process: processEmissions,\n          other_sources: otherEmissions\n        },\n        breakdown: {\n          by_scope: {\n            scope1: energyEmissions.scope1 + processEmissions.total + otherEmissions.total, // Áõ¥Êé•ÊéíÊîæ\n            scope2: energyEmissions.scope2, // Èó¥Êé•ÊéíÊîæ(ÁîµÂäõ)\n            scope3: 0 // ÂÖ∂‰ªñÈó¥Êé•ÊéíÊîæ(ÊöÇ‰∏çËÆ°ÁÆó)\n          },\n          by_source: {\n            electricity: energyEmissions.by_type.electricity || 0,\n            fossil_fuels: energyEmissions.by_type.fossil_fuels || 0,\n            industrial_process: processEmissions.total,\n            transportation: otherEmissions.by_type.transportation || 0,\n            waste: otherEmissions.by_type.waste || 0,\n            other: otherEmissions.by_type.other || 0\n          },\n          by_sector: await this.getEmissionsBySector(parkId, startTime, endTime),\n          by_time: await this.getEmissionsByTime(parkId, startTime, endTime, timeRange)\n        },\n        intensity_indicators: {\n          per_gdp: await this.calculateEmissionIntensity(totalEmissions, 'gdp', parkId, startTime, endTime),\n          per_area: await this.calculateEmissionIntensity(totalEmissions, 'area', parkId, startTime, endTime),\n          per_employee: await this.calculateEmissionIntensity(totalEmissions, 'employee', parkId, startTime, endTime),\n          per_output: await this.calculateEmissionIntensity(totalEmissions, 'output', parkId, startTime, endTime)\n        },\n        benchmark_comparison: {\n          industry_average: await this.getIndustryAverage(parkId, 'total_emissions'),\n          similar_parks: await this.getSimilarParksComparison(parkId, totalEmissions),\n          performance_rating: this.calculatePerformanceRating(totalEmissions, 'total_emissions')\n        },\n        trend_analysis: await this.calculateTrendAnalysis(parkId, 'total_emissions', timeRange),\n        reduction_potential: await this.calculateReductionPotential(parkId, totalEmissions),\n        compliance_status: this.assessComplianceStatus(totalEmissions, 'total_emissions')\n      };\n      \n      // ÁºìÂ≠òÁªìÊûú\n      this.indicatorCache.set(`total_emissions_${parkId}_${timeRange}`, result);\n      \n      logger.info(`ËÆ°ÁÆóÂõ≠Âå∫ÊÄªÁ¢≥ÊéíÊîæÂÆåÊàê: ${parkId}, ÂÄº: ${totalEmissions} tCO2`);\n      return result;\n    } catch (error) {\n      logger.error('ËÆ°ÁÆóÂõ≠Âå∫ÊÄªÁ¢≥ÊéíÊîæÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * ÁîüÊàêÂõΩÂÆ∂Ê†áÂáÜÊåáÊ†áÊä•Âëä\n   * @param {string} parkId - Âõ≠Âå∫ID\n   * @param {string} timeRange - Êó∂Èó¥ËåÉÂõ¥\n   * @returns {Object} ÂõΩÂÆ∂Ê†áÂáÜÊåáÊ†áÊä•Âëä\n   */\n  async generateNationalIndicatorReport(parkId, timeRange = '1M') {\n    try {\n      // ËÆ°ÁÆóÊâÄÊúâÊ†∏ÂøÉÊåáÊ†á\n      const unitEnergyCarbon = await this.calculateUnitEnergyCarbon(parkId, timeRange);\n      const cleanEnergyRatio = await this.calculateCleanEnergyRatio(parkId, timeRange);\n      const totalEmissions = await this.calculateTotalParkEmissions(parkId, timeRange);\n      \n      // ÁîüÊàêÁªºÂêàÊä•Âëä\n      const report = {\n        report_id: this.generateReportId(parkId, timeRange),\n        park_id: parkId,\n        report_period: {\n          time_range: timeRange,\n          start_time: unitEnergyCarbon.start_time,\n          end_time: unitEnergyCarbon.end_time\n        },\n        generation_time: new Date().toISOString(),\n        core_indicators: {\n          unit_energy_carbon: {\n            value: unitEnergyCarbon.unit_energy_carbon,\n            unit: unitEnergyCarbon.unit,\n            target_compliance: unitEnergyCarbon.compliance_status,\n            performance_rating: unitEnergyCarbon.benchmark_comparison.performance_rating\n          },\n          clean_energy_ratio: {\n            value: cleanEnergyRatio.clean_energy_ratio,\n            unit: cleanEnergyRatio.unit,\n            renewable_ratio: cleanEnergyRatio.renewable_ratio,\n            target_compliance: cleanEnergyRatio.compliance_status,\n            performance_rating: cleanEnergyRatio.benchmark_comparison.performance_rating\n          },\n          total_emissions: {\n            value: totalEmissions.total_emissions,\n            unit: totalEmissions.unit,\n            scope1: totalEmissions.breakdown.by_scope.scope1,\n            scope2: totalEmissions.breakdown.by_scope.scope2,\n            target_compliance: totalEmissions.compliance_status,\n            performance_rating: totalEmissions.benchmark_comparison.performance_rating\n          }\n        },\n        comprehensive_assessment: {\n          overall_score: this.calculateOverallScore(unitEnergyCarbon, cleanEnergyRatio, totalEmissions),\n          compliance_level: this.assessOverallCompliance(unitEnergyCarbon, cleanEnergyRatio, totalEmissions),\n          improvement_areas: this.identifyImprovementAreas(unitEnergyCarbon, cleanEnergyRatio, totalEmissions),\n          achievement_highlights: this.identifyAchievements(unitEnergyCarbon, cleanEnergyRatio, totalEmissions)\n        },\n        detailed_analysis: {\n          unit_energy_carbon: unitEnergyCarbon,\n          clean_energy_ratio: cleanEnergyRatio,\n          total_emissions: totalEmissions\n        },\n        recommendations: await this.generateRecommendations(parkId, unitEnergyCarbon, cleanEnergyRatio, totalEmissions),\n        certification_info: {\n          calculation_standard: '„ÄäÈÄöÁü•„ÄãÂõΩÂÆ∂Ê†áÂáÜ',\n          verification_method: 'Automated Calculation Engine',\n          data_quality_score: await this.assessDataQuality(parkId, timeRange),\n          certification_level: this.determineCertificationLevel(unitEnergyCarbon, cleanEnergyRatio, totalEmissions)\n        }\n      };\n      \n      // ‰øùÂ≠òÊä•ÂëäÂéÜÂè≤\n      this.calculationHistory.set(report.report_id, report);\n      \n      logger.info(`ÁîüÊàêÂõΩÂÆ∂Ê†áÂáÜÊåáÊ†áÊä•ÂëäÂÆåÊàê: ${report.report_id}`);\n      this.emit('report_generated', report);\n      \n      return report;\n    } catch (error) {\n      logger.error('ÁîüÊàêÂõΩÂÆ∂Ê†áÂáÜÊåáÊ†áÊä•ÂëäÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * ËÆ°ÁÆóÊâÄÊúâÊåáÊ†á\n   */\n  async calculateAllIndicators() {\n    try {\n      const parks = await this.getAllParks();\n      const timeRanges = ['1d', '1w', '1M', '3M', '1Y'];\n      \n      for (const park of parks) {\n        for (const timeRange of timeRanges) {\n          await this.calculateUnitEnergyCarbon(park.id, timeRange);\n          await this.calculateCleanEnergyRatio(park.id, timeRange);\n          await this.calculateTotalParkEmissions(park.id, timeRange);\n        }\n      }\n    } catch (error) {\n      logger.error('ËÆ°ÁÆóÊâÄÊúâÊåáÊ†áÂ§±Ë¥•:', error);\n    }\n  }\n\n  // ËæÖÂä©ËÆ°ÁÆóÊñπÊ≥ï\n  getStartTime(timeRange) {\n    const now = new Date();\n    const unit = timeRange.slice(-1);\n    const value = parseInt(timeRange.slice(0, -1));\n    \n    switch (unit) {\n      case 'd': return new Date(now.getTime() - value * MATH_CONSTANTS.TWENTY_FOUR * MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.MILLISECONDS_PER_SECOND);\n      case 'w': return new Date(now.getTime() - value * MATH_CONSTANTS.SEVEN * MATH_CONSTANTS.TWENTY_FOUR * MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.MILLISECONDS_PER_SECOND);\n      case 'M': return new Date(now.getTime() - value * MATH_CONSTANTS.THIRTY * MATH_CONSTANTS.TWENTY_FOUR * MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.MILLISECONDS_PER_SECOND);\n      case 'Y': return new Date(now.getTime() - value * MATH_CONSTANTS.THREE_HUNDRED_SIXTY_FIVE * MATH_CONSTANTS.TWENTY_FOUR * MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.MILLISECONDS_PER_SECOND);\n      default: return new Date(now.getTime() - MATH_CONSTANTS.TWENTY_FOUR * MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.MILLISECONDS_PER_SECOND);\n    }\n  }\n\n  calculateTypeRatio(value, total) {\n    return total > 0 ? ((value || 0) / total * MATH_CONSTANTS.ONE_HUNDRED).toFixed(MATH_CONSTANTS.DECIMAL_PLACES) : 0;\n  }\n\n  calculateAvoidedEmissions(cleanEnergyAmount) {\n    return cleanEnergyAmount * this.emissionFactors.electricity.grid;\n  }\n\n  calculateCarbonEconomicValue(avoidedEmissions) {\n    const carbonPrice = 50; // ÂÅáËÆæÁ¢≥‰ª∑ 50ÂÖÉ/tCO2\n    return (avoidedEmissions * carbonPrice).toFixed(MATH_CONSTANTS.DECIMAL_PLACES);\n  }\n\n  calculatePerformanceRating(value, indicatorType) {\n    // ÁÆÄÂåñÁöÑËØÑÁ∫ßÈÄªËæëÔºåÂÆûÈôÖÂ∫îÊ†πÊçÆË°å‰∏öÂü∫ÂáÜ\n    const thresholds = {\n      unit_energy_carbon: { excellent: 0.5, good: 1.0, average: 1.5, poor: 2.0 },\n      clean_energy_ratio: { excellent: 50, good: 30, average: 20, poor: 10 },\n      total_emissions: { excellent: 1000, good: 5000, average: 10000, poor: 20000 }\n    };\n    \n    const threshold = thresholds[indicatorType];\n    if (!threshold) return 'unknown';\n    \n    if (indicatorType === 'unit_energy_carbon' || indicatorType === 'total_emissions') {\n      if (value <= threshold.excellent) return 'excellent';\n      if (value <= threshold.good) return 'good';\n      if (value <= threshold.average) return 'average';\n      return 'poor';\n    } else {\n      if (value >= threshold.excellent) return 'excellent';\n      if (value >= threshold.good) return 'good';\n      if (value >= threshold.average) return 'average';\n      return 'poor';\n    }\n  }\n\n  assessComplianceStatus(value, indicatorType) {\n    const targets = {\n      unit_energy_carbon: 1.0, // Á§∫‰æãÁõÆÊ†áÂÄº\n      clean_energy_ratio: this.nationalTargets.clean_energy_ratio,\n      total_emissions: 10000 // Á§∫‰æãÁõÆÊ†áÂÄº\n    };\n    \n    const target = targets[indicatorType];\n    if (!target) return 'unknown';\n    \n    if (indicatorType === 'clean_energy_ratio') {\n      return value >= target ? 'compliant' : 'non_compliant';\n    } else {\n      return value <= target ? 'compliant' : 'non_compliant';\n    }\n  }\n\n  calculateOverallScore(unitEnergyCarbon, cleanEnergyRatio, totalEmissions) {\n    const scores = {\n      excellent: 100,\n      good: 80,\n      average: 60,\n      poor: 40\n    };\n    \n    const score1 = scores[unitEnergyCarbon.benchmark_comparison.performance_rating] || 0;\n    const score2 = scores[cleanEnergyRatio.benchmark_comparison.performance_rating] || 0;\n    const score3 = scores[totalEmissions.benchmark_comparison.performance_rating] || 0;\n    \n    return Math.round((score1 + score2 + score3) / 3);\n  }\n\n  assessOverallCompliance(unitEnergyCarbon, cleanEnergyRatio, totalEmissions) {\n    const compliantCount = [\n      unitEnergyCarbon.compliance_status === 'compliant',\n      cleanEnergyRatio.compliance_status === 'compliant',\n      totalEmissions.compliance_status === 'compliant'\n    ].filter(Boolean).length;\n    \n    if (compliantCount === 3) return 'fully_compliant';\n    if (compliantCount >= 2) return 'mostly_compliant';\n    if (compliantCount >= 1) return 'partially_compliant';\n    return 'non_compliant';\n  }\n\n  generateReportId(parkId, timeRange) {\n    return `NI_${parkId}_${timeRange}_${Date.now()}`;\n  }\n\n  // Ê®°ÊãüÊï∞ÊçÆËé∑ÂèñÊñπÊ≥ï\n  async calculateEnergyActivityEmissions(parkId, startTime, endTime) {\n    return {\n      total: 1500.5,\n      scope1: 800.3,\n      scope2: 700.2,\n      by_type: {\n        electricity: 700.2,\n        natural_gas: 500.1,\n        coal: 200.1,\n        oil: 100.1\n      }\n    };\n  }\n\n  async calculateIndustrialProcessEmissions(parkId, startTime, endTime) {\n    return {\n      total: 300.5,\n      by_type: {\n        cement: 150.2,\n        steel: 100.1,\n        chemical: 50.2\n      }\n    };\n  }\n\n  async calculateOtherEmissions(parkId, startTime, endTime) {\n    return {\n      total: 100.2,\n      by_type: {\n        transportation: 60.1,\n        waste: 30.1,\n        other: 10.0\n      }\n    };\n  }\n\n  async getGDPData(parkId, startTime, endTime) {\n    return {\n      total: 50000, // ‰∏áÂÖÉ\n      by_sector: {\n        manufacturing: 30000,\n        services: 15000,\n        other: 5000\n      }\n    };\n  }\n\n  async getTotalEnergyConsumption(parkId, startTime, endTime) {\n    return {\n      total: 10000, // MWh\n      by_type: {\n        electricity: 6000,\n        natural_gas: 2000,\n        coal: 1500,\n        oil: 500\n      }\n    };\n  }\n\n  async getCleanEnergyConsumption(parkId, startTime, endTime) {\n    return {\n      total: 3000,\n      renewable: 2500,\n      nuclear: 500,\n      by_type: {\n        solar: 1000,\n        wind: 800,\n        hydro: 500,\n        biomass: 200,\n        nuclear: 500\n      }\n    };\n  }\n\n  async getIndustryBenchmarks() {\n    return [\n      {\n        industry_code: 'manufacturing',\n        unit_energy_carbon: 1.2,\n        clean_energy_ratio: 20,\n        total_emissions: 8000\n      }\n    ];\n  }\n\n  async getAllParks() {\n    return [{ id: 'park_001', name: 'Á§∫‰æãÂõ≠Âå∫' }];\n  }\n\n  async getIndustryAverage(parkId, indicator) {\n    const averages = {\n      unit_energy_carbon: 1.5,\n      clean_energy_ratio: 18,\n      total_emissions: 12000\n    };\n    return averages[indicator] || 0;\n  }\n\n  async calculateTrendAnalysis(parkId, indicator, timeRange) {\n    return {\n      trend: 'improving',\n      change_rate: -5.2,\n      historical_data: []\n    };\n  }\n\n  async getEmissionsBySector(parkId, startTime, endTime) {\n    return {\n      manufacturing: 1200,\n      commercial: 400,\n      residential: 200,\n      transportation: 100\n    };\n  }\n\n  async calculateEmissionIntensity(emissions, type, parkId, startTime, endTime) {\n    const denominators = {\n      gdp: 50000,\n      area: 100,\n      employee: 1000,\n      output: 80000\n    };\n    \n    const denominator = denominators[type] || 1;\n    return (emissions / denominator).toFixed(MATH_CONSTANTS.DECIMAL_PLACES);\n  }\n\n  async getSimilarParksComparison(parkId, emissions) {\n    return {\n      average: 1800,\n      percentile: 75,\n      ranking: 'top_25%'\n    };\n  }\n\n  async calculateReductionPotential(parkId, emissions) {\n    return {\n      technical_potential: 300,\n      economic_potential: 200,\n      recommended_actions: ['ÊèêÈ´òËÉΩÊïà', 'Â¢ûÂä†Ê∏ÖÊ¥ÅËÉΩÊ∫ê', '‰ºòÂåñÂ∑•Ëâ∫']\n    };\n  }\n\n  async generateRecommendations(parkId, unitEnergyCarbon, cleanEnergyRatio, totalEmissions) {\n    return [\n      {\n        category: 'energy_efficiency',\n        priority: 'high',\n        description: 'ÊèêÂçáËÆæÂ§áËÉΩÊïàÔºåÈôç‰ΩéÂçï‰ΩçËÉΩËÄó',\n        potential_impact: 'ÂáèÊéí200tCO2/Âπ¥'\n      },\n      {\n        category: 'clean_energy',\n        priority: 'medium',\n        description: 'Â¢ûÂä†ÂèØÂÜçÁîüËÉΩÊ∫êË£ÖÊú∫ÂÆπÈáè',\n        potential_impact: 'ÊèêÂçáÊ∏ÖÊ¥ÅËÉΩÊ∫êÂç†ÊØîËá≥30%'\n      }\n    ];\n  }\n\n  async assessDataQuality(parkId, timeRange) {\n    return 95; // Êï∞ÊçÆË¥®ÈáèËØÑÂàÜ\n  }\n\n  determineCertificationLevel(unitEnergyCarbon, cleanEnergyRatio, totalEmissions) {\n    const ratings = [\n      unitEnergyCarbon.benchmark_comparison.performance_rating,\n      cleanEnergyRatio.benchmark_comparison.performance_rating,\n      totalEmissions.benchmark_comparison.performance_rating\n    ];\n    \n    if (ratings.every(r => r === 'excellent')) return 'platinum';\n    if (ratings.filter(r => r === 'excellent' || r === 'good').length >= 2) return 'gold';\n    if (ratings.filter(r => r !== 'poor').length >= 2) return 'silver';\n    return 'bronze';\n  }\n\n  identifyImprovementAreas(unitEnergyCarbon, cleanEnergyRatio, totalEmissions) {\n    const areas = [];\n    \n    if (unitEnergyCarbon.benchmark_comparison.performance_rating === 'poor') {\n      areas.push('Âçï‰ΩçËÉΩËÄóÁ¢≥ÊéíÊîæËøáÈ´òÔºåÈúÄË¶ÅÊèêÂçáËÉΩÊ∫êÊïàÁéá');\n    }\n    \n    if (cleanEnergyRatio.benchmark_comparison.performance_rating === 'poor') {\n      areas.push('Ê∏ÖÊ¥ÅËÉΩÊ∫êÂç†ÊØîÂÅè‰ΩéÔºåÈúÄË¶ÅÂ¢ûÂä†ÂèØÂÜçÁîüËÉΩÊ∫ê‰ΩøÁî®');\n    }\n    \n    if (totalEmissions.benchmark_comparison.performance_rating === 'poor') {\n      areas.push('ÊÄªÁ¢≥ÊéíÊîæÈáèËøáÈ´òÔºåÈúÄË¶ÅÂÖ®Èù¢ÂáèÊéíÊé™ÊñΩ');\n    }\n    \n    return areas;\n  }\n\n  identifyAchievements(unitEnergyCarbon, cleanEnergyRatio, totalEmissions) {\n    const achievements = [];\n    \n    if (unitEnergyCarbon.benchmark_comparison.performance_rating === 'excellent') {\n      achievements.push('Âçï‰ΩçËÉΩËÄóÁ¢≥ÊéíÊîæËææÂà∞‰ºòÁßÄÊ∞¥Âπ≥');\n    }\n    \n    if (cleanEnergyRatio.benchmark_comparison.performance_rating === 'excellent') {\n      achievements.push('Ê∏ÖÊ¥ÅËÉΩÊ∫êÊ∂àË¥πÂç†ÊØîË°®Áé∞‰ºòÂºÇ');\n    }\n    \n    if (totalEmissions.benchmark_comparison.performance_rating === 'excellent') {\n      achievements.push('ÊÄªÁ¢≥ÊéíÊîæÊéßÂà∂ÊïàÊûúÊòæËëó');\n    }\n    \n    return achievements;\n  }\n}\n\nexport default NationalIndicatorEngine;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/core/services/NotificationService.js","messages":[{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 465.","line":51,"column":41,"nodeType":"Literal","messageId":"noMagic","endLine":51,"endColumn":44},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0x808080.","line":401,"column":32,"nodeType":"Literal","messageId":"noMagic","endLine":401,"endColumn":40}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { dbPromise } from '../database.js';\nimport logger from '../utils/logger.js';\nimport nodemailer from 'nodemailer';\nimport twilio from 'twilio';\nimport { WebhookClient } from 'discord.js';\nimport NotificationPreferences from '../models/NotificationPreferences.js';\n\n/**\n * ÈÄöÁü•ÊúçÂä° - Â§ÑÁêÜÂêÑÁ±ªÂëäË≠¶ÈÄöÁü•ÁöÑÂèëÈÄÅ\n */\nclass NotificationService {\n  constructor() {\n    this.transporters = {\n      email: this.initializeEmailTransporter(),\n      sms: this.initializeSmsClient(),\n      discord: this.initializeDiscordWebhook()\n    };\n    this.preferencesCache = new Map(); // { userId => preferences }\n    this.initialize();\n  }\n\n  /**\n   * ÂàùÂßãÂåñÈÄöÁü•ÊúçÂä°\n   */\n  async initialize() {\n    try {\n      // È¢ÑÂä†ËΩΩÁî®Êà∑ÈÄöÁü•ÂÅèÂ•ΩËÆæÁΩÆ\n      await this.loadNotificationPreferences();\n      logger.info('ÈÄöÁü•ÊúçÂä°ÂàùÂßãÂåñÂÆåÊàê');\n    } catch (error) {\n      logger.error('ÈÄöÁü•ÊúçÂä°ÂàùÂßãÂåñÂ§±Ë¥•:', error);\n    }\n  }\n\n  /**\n   * ÂàùÂßãÂåñÈÇÆ‰ª∂‰º†ËæìÂô®\n   */\n  initializeEmailTransporter() {\n    try {\n      // ‰ªéÁéØÂ¢ÉÂèòÈáèËé∑ÂèñÈÇÆ‰ª∂ÈÖçÁΩÆ\n      const { SMTP_HOST, SMTP_PORT, SMTP_USER, SMTP_PASS, SMTP_FROM } = process.env;\n\n      if (!SMTP_HOST || !SMTP_PORT || !SMTP_USER || !SMTP_PASS) {\n        logger.warn('ÈÇÆ‰ª∂ÊúçÂä°ÈÖçÁΩÆ‰∏çÂÆåÊï¥ÔºåÈÇÆ‰ª∂ÈÄöÁü•ÂäüËÉΩÂ∞Ü‰∏çÂèØÁî®');\n        return null;\n      }\n\n      return nodemailer.createTransport({\n        host: SMTP_HOST,\n        port: parseInt(SMTP_PORT),\n        secure: parseInt(SMTP_PORT) === 465,\n        auth: {\n          user: SMTP_USER,\n          pass: SMTP_PASS\n        },\n        from: SMTP_FROM || SMTP_USER\n      });\n    } catch (error) {\n      logger.error('ÂàùÂßãÂåñÈÇÆ‰ª∂‰º†ËæìÂô®Â§±Ë¥•:', error);\n      return null;\n    }\n  }\n\n  /**\n   * ÂàùÂßãÂåñSMSÂÆ¢Êà∑Á´Ø\n   */\n  initializeSmsClient() {\n    try {\n      // ‰ªéÁéØÂ¢ÉÂèòÈáèËé∑ÂèñTwilioÈÖçÁΩÆ\n      const { TWILIO_ACCOUNT_SID, TWILIO_AUTH_TOKEN, TWILIO_PHONE_NUMBER } = process.env;\n\n      if (!TWILIO_ACCOUNT_SID || !TWILIO_AUTH_TOKEN || !TWILIO_PHONE_NUMBER) {\n        logger.warn('SMSÊúçÂä°ÈÖçÁΩÆ‰∏çÂÆåÊï¥ÔºåSMSÈÄöÁü•ÂäüËÉΩÂ∞Ü‰∏çÂèØÁî®');\n        return null;\n      }\n\n      return twilio(TWILIO_ACCOUNT_SID, TWILIO_AUTH_TOKEN);\n    } catch (error) {\n      logger.error('ÂàùÂßãÂåñSMSÂÆ¢Êà∑Á´ØÂ§±Ë¥•:', error);\n      return null;\n    }\n  }\n\n  /**\n   * ÂàùÂßãÂåñDiscord Webhook\n   */\n  initializeDiscordWebhook() {\n    try {\n      const { DISCORD_WEBHOOK_URL } = process.env;\n\n      if (!DISCORD_WEBHOOK_URL) {\n        logger.warn('Discord Webhook URLÊú™ÈÖçÁΩÆÔºåDiscordÈÄöÁü•ÂäüËÉΩÂ∞Ü‰∏çÂèØÁî®');\n        return null;\n      }\n\n      return new WebhookClient({ url: DISCORD_WEBHOOK_URL });\n    } catch (error) {\n      logger.error('ÂàùÂßãÂåñDiscord WebhookÂ§±Ë¥•:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Âä†ËΩΩÁî®Êà∑ÈÄöÁü•ÂÅèÂ•ΩËÆæÁΩÆ\n   */\n  async loadNotificationPreferences() {\n    try {\n      const db = await dbPromise;\n      const preferences = await db.raw('SELECT * FROM notification_preferences');\n      preferences.forEach((pref) => {\n        try {\n          pref.channels = JSON.parse(pref.channels);\n          pref.severity_filters = JSON.parse(pref.severity_filters);\n          this.preferencesCache.set(pref.user_id, pref);\n        } catch (error) {\n          logger.error(`Ëß£ÊûêÁî®Êà∑ÈÄöÁü•ÂÅèÂ•ΩÂ§±Ë¥• (Áî®Êà∑ID: ${pref.user_id}):`, error);\n        }\n      });\n      logger.info(`Âä†ËΩΩ‰∫Ü ${preferences.length} Êù°Áî®Êà∑ÈÄöÁü•ÂÅèÂ•ΩËÆæÁΩÆ`);\n    } catch (error) {\n      logger.error('Âä†ËΩΩÁî®Êà∑ÈÄöÁü•ÂÅèÂ•ΩËÆæÁΩÆÂ§±Ë¥•:', error);\n    }\n  }\n\n  /**\n   * Ëé∑ÂèñÁî®Êà∑ÁöÑÈÄöÁü•ÂÅèÂ•Ω\n   * @param {string} userId - Áî®Êà∑ID\n   */\n  async getNotificationPreferences(userId) {\n    // ÂÖà‰ªéÁºìÂ≠òËé∑Âèñ\n    let prefs = this.preferencesCache.get(userId);\n\n    if (!prefs) {\n      // ÁºìÂ≠òÊú™ÂëΩ‰∏≠Ôºå‰ªéÊï∞ÊçÆÂ∫ìËé∑Âèñ\n      try {\n        const db = await dbPromise;\n        const result = await db.raw('SELECT * FROM notification_preferences WHERE user_id = ?', [\n          userId\n        ]);\n        const row = result.rows ? result.rows[0] : undefined;\n\n        if (row) {\n          row.channels = JSON.parse(row.channels);\n          row.severity_filters = JSON.parse(row.severity_filters);\n          this.preferencesCache.set(userId, row);\n          prefs = row;\n        } else {\n          // ‰ΩøÁî®ÈªòËÆ§ÂÅèÂ•Ω\n          prefs = NotificationPreferences.getDefaultPreferences(userId);\n          await this.saveNotificationPreferences(prefs);\n        }\n      } catch (error) {\n        logger.error(`Ëé∑ÂèñÁî®Êà∑ÈÄöÁü•ÂÅèÂ•ΩÂ§±Ë¥• (Áî®Êà∑ID: ${userId}):`, error);\n        prefs = NotificationPreferences.getDefaultPreferences(userId);\n      }\n    }\n\n    return prefs;\n  }\n\n  /**\n   * ‰øùÂ≠òÁî®Êà∑ÈÄöÁü•ÂÅèÂ•Ω\n   * @param {Object} preferences - Áî®Êà∑ÈÄöÁü•ÂÅèÂ•ΩÂØπË±°\n   */\n  async saveNotificationPreferences(preferences) {\n    try {\n      const db = await dbPromise;\n      const result = await db.raw('SELECT id FROM notification_preferences WHERE user_id = ?', [\n        preferences.user_id\n      ]);\n      const existing = result.rows ? result.rows[0] : undefined;\n\n      const channelsJson = JSON.stringify(preferences.channels);\n      const filtersJson = JSON.stringify(preferences.severity_filters);\n      const now = new Date().toISOString();\n\n      if (existing) {\n        // Êõ¥Êñ∞Áé∞ÊúâÂÅèÂ•Ω\n        const db = await dbPromise;\n        await db.run(\n          `UPDATE notification_preferences SET\n            channels = ?, severity_filters = ?, updated_at = ?\n           WHERE user_id = ?`,\n          [channelsJson, filtersJson, now, preferences.user_id]\n        );\n      } else {\n        // ÂàõÂª∫Êñ∞ÂÅèÂ•Ω\n        const db = await dbPromise;\n        await db.run(\n          `INSERT INTO notification_preferences (\n            user_id, channels, severity_filters, created_at, updated_at\n          ) VALUES (?, ?, ?, ?, ?)`,\n          [preferences.user_id, channelsJson, filtersJson, now, now]\n        );\n      }\n\n      // Êõ¥Êñ∞ÁºìÂ≠ò\n      this.preferencesCache.set(preferences.user_id, preferences);\n      return true;\n    } catch (error) {\n      logger.error(`‰øùÂ≠òÁî®Êà∑ÈÄöÁü•ÂÅèÂ•ΩÂ§±Ë¥• (Áî®Êà∑ID: ${preferences.user_id}):`, error);\n      return false;\n    }\n  }\n\n  /**\n   * ÂèëÈÄÅÂëäË≠¶ÈÄöÁü•\n   * @param {Object} alert - ÂëäË≠¶ÂØπË±°\n   * @param {Array} users - ÈúÄË¶ÅÈÄöÁü•ÁöÑÁî®Êà∑ÂàóË°®\n   */\n  async sendAlertNotifications(alert, users) {\n    if (!alert || !users || users.length === 0) {\n      logger.warn('ÂëäË≠¶‰ø°ÊÅØÊàñÁî®Êà∑ÂàóË°®‰∏∫Á©∫ÔºåÊó†Ê≥ïÂèëÈÄÅÈÄöÁü•');\n      return;\n    }\n\n    try {\n      // ËÆ∞ÂΩïÂëäË≠¶Âà∞Êï∞ÊçÆÂ∫ì\n      const alertId = await this.recordAlert(alert);\n\n      // ÂØπÊØè‰∏™Áî®Êà∑Â§ÑÁêÜÈÄöÁü•\n      for (const user of users) {\n        try {\n          const prefs = await this.getNotificationPreferences(user.id);\n\n          // Ê£ÄÊü•ÂëäË≠¶Á∫ßÂà´ÊòØÂê¶Á¨¶ÂêàÁî®Êà∑ÂÅèÂ•Ω\n          if (!prefs.severity_filters.includes(alert.severity)) {\n            logger.debug(`Áî®Êà∑ ${user.id} Â∑≤ËøáÊª§ ${alert.severity} Á∫ßÂà´ÁöÑÂëäË≠¶ÈÄöÁü•`);\n            continue;\n          }\n\n          // Ê†πÊçÆÁî®Êà∑ÂÅèÂ•ΩÁöÑÊ∏†ÈÅìÂèëÈÄÅÈÄöÁü•\n          for (const channel of prefs.channels) {\n            switch (channel) {\n              case 'email':\n                await this.sendEmailNotification(user, alert);\n                break;\n              case 'sms':\n                await this.sendSmsNotification(user, alert);\n                break;\n              case 'discord':\n                await this.sendDiscordNotification(user, alert);\n                break;\n              default:\n                logger.warn(`Êú™Áü•ÁöÑÈÄöÁü•Ê∏†ÈÅì: ${channel}`);\n            }\n          }\n\n          // ËÆ∞ÂΩïÁî®Êà∑ÈÄöÁü•Áä∂ÊÄÅ\n          await this.recordUserAlert(user.id, alertId);\n        } catch (error) {\n          logger.error(`Â§ÑÁêÜÁî®Êà∑ ${user.id} ÁöÑÂëäË≠¶ÈÄöÁü•Â§±Ë¥•:`, error);\n          continue;\n        }\n      }\n    } catch (error) {\n      logger.error('ÂèëÈÄÅÂëäË≠¶ÈÄöÁü•Â§±Ë¥•:', error);\n    }\n  }\n\n  /**\n   * ËÆ∞ÂΩïÂëäË≠¶Âà∞Êï∞ÊçÆÂ∫ì\n   * @param {Object} alert - ÂëäË≠¶ÂØπË±°\n   * @returns {number} - ÂëäË≠¶ID\n   */\n  async recordAlert(alert) {\n    const now = new Date().toISOString();\n    const db = await dbPromise;\n    const result = await db.run(\n      `INSERT INTO alerts (\n        device_id, type, severity, message, status, created_at, updated_at\n      ) VALUES (?, ?, ?, ?, ?, ?, ?)`,\n      [alert.deviceId, alert.type, alert.severity, alert.message, 'new', now, now]\n    );\n    return result.lastID;\n  }\n\n  /**\n   * ËÆ∞ÂΩïÁî®Êà∑ÂëäË≠¶ÈÄöÁü•Áä∂ÊÄÅ\n   * @param {string} userId - Áî®Êà∑ID\n   * @param {number} alertId - ÂëäË≠¶ID\n   */\n  async recordUserAlert(userId, alertId) {\n    const now = new Date().toISOString();\n    const db = await dbPromise;\n    await db.run(\n      `INSERT INTO user_alerts (user_id, alert_id, status, created_at)\n       VALUES (?, ?, ?, ?)`,\n      [userId, alertId, 'pending', now]\n    );\n  }\n\n  /**\n   * ÂèëÈÄÅÈÇÆ‰ª∂ÈÄöÁü•\n   * @param {Object} user - Áî®Êà∑ÂØπË±°\n   * @param {Object} alert - ÂëäË≠¶ÂØπË±°\n   */\n  async sendEmailNotification(user, alert) {\n    if (!this.transporters.email || !user.email) {\n      logger.warn('ÈÇÆ‰ª∂‰º†ËæìÂô®Êú™ÂàùÂßãÂåñÊàñÁî®Êà∑ÈÇÆÁÆ±‰∏çÂ≠òÂú®ÔºåÊó†Ê≥ïÂèëÈÄÅÈÇÆ‰ª∂ÈÄöÁü•');\n      return;\n    }\n\n    try {\n      const subject = `[${alert.severity.toUpperCase()}] ËÆæÂ§áÂëäË≠¶ÈÄöÁü• - ${alert.deviceId}`;\n      const html = `\n        <h2>ËÆæÂ§áÂëäË≠¶ÈÄöÁü•</h2>\n        <p><strong>ËÆæÂ§áID:</strong> ${alert.deviceId}</p>\n        <p><strong>ÂëäË≠¶Á±ªÂûã:</strong> ${alert.type}</p>\n        <p><strong>‰∏•ÈáçÁ∫ßÂà´:</strong> ${alert.severity}</p>\n        <p><strong>ÂëäË≠¶‰ø°ÊÅØ:</strong> ${alert.message}</p>\n        <p><strong>ÂèëÁîüÊó∂Èó¥:</strong> ${new Date(alert.timestamp).toLocaleString()}</p>\n        <p>ËØ∑ÂèäÊó∂Â§ÑÁêÜÊ≠§ÂëäË≠¶„ÄÇ</p>\n      `;\n\n      await this.transporters.email.sendMail({\n        to: user.email,\n        subject,\n        html\n      });\n\n      logger.info(`Â∑≤ÂêëÁî®Êà∑ ${user.id} ÂèëÈÄÅÈÇÆ‰ª∂ÂëäË≠¶ÈÄöÁü•`);\n      await this.updateUserAlertStatus(user.id, alert.id, 'sent');\n    } catch (error) {\n      logger.error(`ÂèëÈÄÅÈÇÆ‰ª∂ÈÄöÁü•Â§±Ë¥• (Áî®Êà∑ID: ${user.id}):`, error);\n      await this.updateUserAlertStatus(user.id, alert.id, 'failed');\n    }\n  }\n\n  /**\n   * ÂèëÈÄÅSMSÈÄöÁü•\n   * @param {Object} user - Áî®Êà∑ÂØπË±°\n   * @param {Object} alert - ÂëäË≠¶ÂØπË±°\n   */\n  async sendSmsNotification(user, alert) {\n    if (!this.transporters.sms || !user.phone) {\n      logger.warn('SMSÂÆ¢Êà∑Á´ØÊú™ÂàùÂßãÂåñÊàñÁî®Êà∑ÊâãÊú∫Âè∑‰∏çÂ≠òÂú®ÔºåÊó†Ê≥ïÂèëÈÄÅSMSÈÄöÁü•');\n      return;\n    }\n\n    try {\n      const message = `[${alert.severity.toUpperCase()}] ËÆæÂ§á${alert.deviceId}ÂëäË≠¶: ${alert.message} Êó∂Èó¥:${new Date(alert.timestamp).toLocaleString()}`;\n\n      await this.transporters.sms.messages.create({\n        body: message,\n        from: process.env.TWILIO_PHONE_NUMBER,\n        to: user.phone\n      });\n\n      logger.info(`Â∑≤ÂêëÁî®Êà∑ ${user.id} ÂèëÈÄÅSMSÂëäË≠¶ÈÄöÁü•`);\n      await this.updateUserAlertStatus(user.id, alert.id, 'sent');\n    } catch (error) {\n      logger.error(`ÂèëÈÄÅSMSÈÄöÁü•Â§±Ë¥• (Áî®Êà∑ID: ${user.id}):`, error);\n      await this.updateUserAlertStatus(user.id, alert.id, 'failed');\n    }\n  }\n\n  /**\n   * ÂèëÈÄÅDiscordÈÄöÁü•\n   * @param {Object} alert - ÂëäË≠¶ÂØπË±°\n   */\n  async sendDiscordNotification(user, alert) {\n    if (!this.transporters.discord) {\n      logger.warn('Discord WebhookÊú™ÂàùÂßãÂåñÔºåÊó†Ê≥ïÂèëÈÄÅDiscordÈÄöÁü•');\n      return;\n    }\n\n    try {\n      const embed = {\n        title: `ËÆæÂ§áÂëäË≠¶ÈÄöÁü• [${alert.severity.toUpperCase()}]`,\n        color: this.getSeverityColor(alert.severity),\n        fields: [\n          { name: 'ËÆæÂ§áID', value: alert.deviceId, inline: true },\n          { name: 'ÂëäË≠¶Á±ªÂûã', value: alert.type, inline: true },\n          { name: '‰∏•ÈáçÁ∫ßÂà´', value: alert.severity, inline: true },\n          { name: 'ÂëäË≠¶‰ø°ÊÅØ', value: alert.message },\n          { name: 'ÂèëÁîüÊó∂Èó¥', value: new Date(alert.timestamp).toLocaleString() }\n        ],\n        timestamp: new Date().toISOString()\n      };\n\n      await this.transporters.discord.send({ embeds: [embed] });\n      logger.info('Â∑≤ÂèëÈÄÅDiscordÂëäË≠¶ÈÄöÁü•');\n    } catch (error) {\n      logger.error('ÂèëÈÄÅDiscordÈÄöÁü•Â§±Ë¥•:', error);\n    }\n  }\n\n  /**\n   * Ê†πÊçÆÂëäË≠¶Á∫ßÂà´Ëé∑ÂèñÈ¢úËâ≤‰ª£Á†Å\n   * @param {string} severity - ÂëäË≠¶Á∫ßÂà´\n   * @returns {number} - È¢úËâ≤‰ª£Á†Å\n   */\n  getSeverityColor(severity) {\n    const colors = {\n      critical: 0xff0000,\n      high: 0xffa500,\n      medium: 0xffff00,\n      low: 0x00ff00\n    };\n    return colors[severity] || 0x808080;\n  }\n\n  /**\n   * Êõ¥Êñ∞Áî®Êà∑ÂëäË≠¶Áä∂ÊÄÅ\n   * @param {string} userId - Áî®Êà∑ID\n   * @param {number} alertId - ÂëäË≠¶ID\n   * @param {string} status - Áä∂ÊÄÅ\n   */\n  async updateUserAlertStatus(userId, alertId, status) {\n    const db = await dbPromise;\n    await db.run(\n      `UPDATE user_alerts SET status = ?, updated_at = ?\n       WHERE user_id = ? AND alert_id = ?`,\n      [status, new Date().toISOString(), userId, alertId]\n    );\n  }\n\n  /**\n   * ÂèëÈÄÅÈÄöÁü•\n   * @param {Object} notification - ÈÄöÁü•ÂØπË±°\n   * @param {string} notification.type - ÈÄöÁü•Á±ªÂûã (system, alert, warning, info)\n   * @param {string|string[]} notification.recipients - Êé•Êî∂ËÄÖIDÊàñ'admin'Ë°®Á§∫ÁÆ°ÁêÜÂëò\n   * @param {string} notification.title - ÈÄöÁü•Ê†áÈ¢ò\n   * @param {string} notification.message - ÈÄöÁü•ÂÜÖÂÆπ\n   * @param {string} [notification.alert_id] - ÂÖ≥ËÅîÁöÑÂëäË≠¶ID\n   * @param {string} [notification.severity] - ÂëäË≠¶Á∫ßÂà´ (critical, high, medium, low)\n   */\n  async sendNotification(notification) {\n    try {\n      const { type, recipients, title, message, alert_id, severity = 'medium' } = notification;\n\n      // Â§ÑÁêÜÊé•Êî∂ËÄÖ\n      const userIds = await this.resolveRecipients(recipients);\n      if (!userIds.length) {\n        logger.warn('Êú™ÊâæÂà∞ÊúâÊïàÁöÑÈÄöÁü•Êé•Êî∂ËÄÖ');\n        return false;\n      }\n\n      // ‰∏∫ÊØè‰∏™Êé•Êî∂ËÄÖÂèëÈÄÅÈÄöÁü•\n      const results = [];\n      for (const userId of userIds) {\n        const prefs = await this.getNotificationPreferences(userId);\n\n        // Ê£ÄÊü•ËØ•Á∫ßÂà´ÊòØÂê¶Âú®Áî®Êà∑ÁöÑËøáÊª§ËåÉÂõ¥ÂÜÖ\n        if (!prefs.severity_filters.includes(severity) && !prefs.severity_filters.includes('all')) {\n          logger.debug(`Áî®Êà∑ ${userId} ÁöÑÈÄöÁü•ÂÅèÂ•ΩËøáÊª§‰∫Ü ${severity} Á∫ßÂà´ÁöÑÈÄöÁü•`);\n          continue;\n        }\n\n        // ‰∏∫ÊØè‰∏™ÂêØÁî®ÁöÑÊ∏†ÈÅìÂèëÈÄÅÈÄöÁü•\n        for (const [channel, config] of Object.entries(prefs.channels)) {\n          if (config.enabled) {\n            const result = await this.sendViaChannel({\n              channel,\n              userId,\n              contact: config.contact,\n              title,\n              message,\n              alertId: alert_id,\n              severity,\n              type\n            });\n            results.push(result);\n          }\n        }\n      }\n\n      return results.every((r) => r.success);\n    } catch (error) {\n      logger.error('ÂèëÈÄÅÈÄöÁü•Â§±Ë¥•:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Ëß£ÊûêÊé•Êî∂ËÄÖÂàóË°®\n   * @param {string|string[]} recipients - Êé•Êî∂ËÄÖIDÊàñ'admin'Ë°®Á§∫ÁÆ°ÁêÜÂëò\n   */\n  async resolveRecipients(recipients) {\n    try {\n      if (!recipients) {\n        return [];\n      }\n\n      // Ê†áÂáÜÂåñ‰∏∫Êï∞ÁªÑ\n      const recipientsArray = Array.isArray(recipients) ? recipients : [recipients];\n      const userIds = new Set();\n\n      for (const recipient of recipientsArray) {\n        if (recipient === 'admin') {\n          // Ëé∑ÂèñÊâÄÊúâÁÆ°ÁêÜÂëò\n          const db = await dbPromise;\n          const admins = await db.raw('SELECT id FROM users WHERE role = \"admin\"');\n          admins.forEach((admin) => userIds.add(admin.id));\n        } else if (recipient.includes('@')) {\n          // Áõ¥Êé•ÊåáÂÆöÈÇÆÁÆ±\n          // ËøôÈáåÂèØ‰ª•Ê∑ªÂä†ÈÄöËøáÈÇÆÁÆ±Êü•ÊâæÁî®Êà∑ÁöÑÈÄªËæë\n          logger.warn('Áõ¥Êé•ÈÇÆÁÆ±ÊåáÂÆöÂäüËÉΩÂ∞öÊú™ÂÆûÁé∞');\n        } else {\n          // Áî®Êà∑ID\n          userIds.add(recipient);\n        }\n      }\n\n      return Array.from(userIds);\n    } catch (error) {\n      logger.error('Ëß£ÊûêÈÄöÁü•Êé•Êî∂ËÄÖÂ§±Ë¥•:', error);\n      return [];\n    }\n  }\n\n  /**\n   * ÈÄöËøáÊåáÂÆöÊ∏†ÈÅìÂèëÈÄÅÈÄöÁü•\n   * @param {Object} params - ÂèëÈÄÅÂèÇÊï∞\n   */\n  async sendViaChannel(params) {\n    const { channel, userId, contact, title, message, alertId, severity } = params;\n    const result = { channel, userId, success: false, error: null };\n\n    try {\n      switch (channel) {\n        case 'email':\n          await this.sendEmail(contact, title, message);\n          break;\n        case 'sms':\n          await this.sendSms(contact, message);\n          break;\n        case 'discord':\n          await this.sendDiscord(title, message, severity);\n          break;\n        case 'in_app':\n          await this.saveInAppNotification(userId, title, message, alertId, severity);\n          break;\n        default:\n          throw new Error(`‰∏çÊîØÊåÅÁöÑÈÄöÁü•Ê∏†ÈÅì: ${channel}`);\n      }\n\n      result.success = true;\n      logger.info(`ÈÄöÁü•Â∑≤ÂèëÈÄÅ (Ê∏†ÈÅì: ${channel}, Áî®Êà∑: ${userId})`);\n    } catch (error) {\n      result.error = error.message;\n      logger.error(`ÈÄöÁü•ÂèëÈÄÅÂ§±Ë¥• (Ê∏†ÈÅì: ${channel}, Áî®Êà∑: ${userId}):`, error);\n    }\n\n    // ËÆ∞ÂΩïÈÄöÁü•ÂèëÈÄÅÁä∂ÊÄÅ\n    await this.logNotificationAttempt(params, result);\n    return result;\n  }\n\n  /**\n   * ÂèëÈÄÅÈÇÆ‰ª∂ÈÄöÁü•\n   * @param {string} to - Êî∂‰ª∂‰∫∫ÈÇÆÁÆ±\n   * @param {string} subject - ÈÇÆ‰ª∂‰∏ªÈ¢ò\n   * @param {string} body - ÈÇÆ‰ª∂ÂÜÖÂÆπ\n   */\n  async sendEmail(to, subject, body) {\n    if (!this.transporters.email) {\n      throw new Error('ÈÇÆ‰ª∂‰º†ËæìÂô®Êú™ÂàùÂßãÂåñ');\n    }\n\n    // ÊûÑÂª∫HTMLÈÇÆ‰ª∂ÂÜÖÂÆπ\n    const htmlBody = `\n      <div style=\"font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px;\">\n        <h2 style=\"color: #2c3e50;\">${subject}</h2>\n        <div style=\"background-color: #f8f9fa; padding: 20px; border-radius: 5px;\">\n          ${body}\n        </div>\n        <p style=\"color: #7f8c8d; margin-top: 20px;\">ËøôÊòØÁ≥ªÁªüËá™Âä®ÂèëÈÄÅÁöÑÈÄöÁü•ÈÇÆ‰ª∂ÔºåËØ∑ÂãøÁõ¥Êé•ÂõûÂ§ç„ÄÇ</p>\n      </div>\n    `;\n\n    // ÂèëÈÄÅÈÇÆ‰ª∂\n    return await this.transporters.email.sendMail({\n      from: process.env.EMAIL_FROM,\n      to,\n      subject,\n      html: htmlBody\n    });\n  }\n}\n\nexport default NotificationService;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/core/services/RealTimeDataQualityService.js","messages":[{"ruleId":null,"fatal":true,"severity":2,"message":"Parsing error: Unexpected token }","line":406,"column":5,"nodeType":null}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * ÂÆûÊó∂Êï∞ÊçÆË¥®ÈáèÁõëÊéß‰∏éÈ¢ÑË≠¶ÊúçÂä°\n * ÂÆûÁé∞Êï∞ÊçÆË¥®ÈáèÁöÑÂÆûÊó∂ÁõëÊéß„ÄÅÂºÇÂ∏∏Ê£ÄÊµã„ÄÅËá™Âä®È¢ÑË≠¶ÂíåË¥®ÈáèËØÑÂàÜ\n * ‰∏∫Èõ∂Á¢≥Âõ≠Âå∫Êï∞Â≠óÂ≠™ÁîüÁ≥ªÁªüÊèê‰æõÂÖ®Èù¢ÁöÑÊï∞ÊçÆË¥®Èáè‰øùÈöú\n */\n\nimport { EventEmitter } from 'events';\nimport logger from '../../shared/utils/logger.js';\nimport { MATH_CONSTANTS } from '../../shared/constants/MathConstants.js';\n\nclass RealTimeDataQualityService extends EventEmitter {\n    constructor() {\n        super();\n        \n        // Êï∞ÊçÆË¥®ÈáèËßÑÂàô\n        this.qualityRules = new Map();\n        \n        // ÁõëÊéß‰ªªÂä°\n        this.monitoringTasks = new Map();\n        \n        // Ë¥®ÈáèÊåáÊ†á\n        this.qualityMetrics = new Map();\n        \n        // ÂºÇÂ∏∏Ê£ÄÊµãÂô®\n        this.anomalyDetectors = new Map();\n        \n        // È¢ÑË≠¶ÈÖçÁΩÆ\n        this.alertConfigs = new Map();\n        \n        // Ë¥®ÈáèÊä•Âëä\n        this.qualityReports = new Map();\n        \n        // ÂÆûÊó∂Ë¥®ÈáèÁä∂ÊÄÅ\n        this.realTimeStatus = new Map();\n        \n        // Ë¥®ÈáèË∂ãÂäøÊï∞ÊçÆ\n        this.qualityTrends = new Map();\n        \n        // ‰øÆÂ§çÂª∫ËÆÆ\n        this.repairSuggestions = new Map();\n        \n        this.startTime = Date.now();\n        this.init();\n    }\n    \n    /**\n     * ÂàùÂßãÂåñÊï∞ÊçÆË¥®ÈáèÁõëÊéßÊúçÂä°\n     */\n    async init() {\n        try {\n            logger.info('üìä ÂÆûÊó∂Êï∞ÊçÆË¥®ÈáèÁõëÊéßÊúçÂä°ÂêØÂä®‰∏≠...');\n            \n            // ÂàùÂßãÂåñË¥®ÈáèËßÑÂàô\n            await this.initializeQualityRules();\n            \n            // ÂàùÂßãÂåñÂºÇÂ∏∏Ê£ÄÊµãÂô®\n            await this.initializeAnomalyDetectors();\n            \n            // ÂàùÂßãÂåñÈ¢ÑË≠¶ÈÖçÁΩÆ\n            await this.initializeAlertConfigs();\n            \n            // ÂêØÂä®ÂÆûÊó∂ÁõëÊéß\n            await this.startRealTimeMonitoring();\n            \n            // ÂàùÂßãÂåñË¥®ÈáèÊåáÊ†á\n            await this.initializeQualityMetrics();\n            \n            logger.info('‚úÖ ÂÆûÊó∂Êï∞ÊçÆË¥®ÈáèÁõëÊéßÊúçÂä°ÂêØÂä®ÂÆåÊàê');\n            this.emit('quality:ready');\n        } catch (error) {\n            return false;\n        }\n    }\n    \n    async getDetectionData(detector) {\n        // Ê®°ÊãüËé∑ÂèñÂºÇÂ∏∏Ê£ÄÊµãÊï∞ÊçÆ\n        const baseData = await this.getTestData('ems_energy_data');\n        return baseData.map(record => ({\n            ...record,\n            timestamp: record.measurement_time,\n            value: record.consumption_amount\n        }));\n    }\n    \n    detectZScoreAnomalies(data, parameters) {\n        const anomalies = [];\n        if (data.length < parameters.min_samples) return anomalies;\n        \n        const values = data.map(d => d.value || 0);\n        const mean = values.reduce((a, b) => a + b, 0) / values.length;\n        const variance = values.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / values.length;\n        const stdDev = Math.sqrt(variance);\n        \n        data.forEach((record, index) => {\n            const zScore = Math.abs((record.value - mean) / stdDev);\n            if (zScore > parameters.threshold) {\n                anomalies.push({\n                    type: 'statistical_outlier',\n                    record_id: record.meter_id || index,\n                    value: record.value,\n                    z_score: zScore,\n                    threshold: parameters.threshold,\n                    severity: zScore > parameters.threshold * 1.5 ? 'high' : 'medium',\n                    description: `ÁªüËÆ°ÂºÇÂ∏∏ÂÄºÊ£ÄÊµã: Z-Score ${zScore.toFixed(2)} Ë∂ÖËøáÈòàÂÄº ${parameters.threshold}`\n                });\n            }\n        });\n        \n        return anomalies;\n    }\n    \n    detectTrendAnomalies(data, parameters) {\n        const anomalies = [];\n        if (data.length < parameters.window_size) return anomalies;\n        \n        for (let i = parameters.window_size; i < data.length; i++) {\n            const window = data.slice(i - parameters.window_size, i);\n            const windowMean = window.reduce((sum, d) => sum + d.value, 0) / window.length;\n            const currentValue = data[i].value;\n            \n            const deviation = Math.abs(currentValue - windowMean) / windowMean;\n            if (deviation > parameters.deviation_threshold) {\n                anomalies.push({\n                    type: 'trend_anomaly',\n                    record_id: data[i].meter_id || i,\n                    value: currentValue,\n                    expected_value: windowMean,\n                    deviation: deviation,\n                    threshold: parameters.deviation_threshold,\n                    severity: deviation > parameters.deviation_threshold * 2 ? 'high' : 'medium',\n                    description: `Ë∂ãÂäøÂºÇÂ∏∏Ê£ÄÊµã: ÂÅèÂ∑Æ ${(deviation * 100).toFixed(2)}% Ë∂ÖËøáÈòàÂÄº ${(parameters.deviation_threshold * 100).toFixed(2)}%`\n                });\n            }\n        }\n        \n        return anomalies;\n    }\n    \n    detectPatternAnomalies(data, parameters) {\n        const anomalies = [];\n        // ÁÆÄÂåñÁöÑÊ®°ÂºèÂºÇÂ∏∏Ê£ÄÊµã\n        const values = data.map(d => d.value || 0);\n        const mean = values.reduce((a, b) => a + b, 0) / values.length;\n        const threshold = mean * 2; // ÁÆÄÂåñÈòàÂÄº\n        \n        data.forEach((record, index) => {\n            if (record.value > threshold) {\n                anomalies.push({\n                    type: 'pattern_anomaly',\n                    record_id: record.meter_id || index,\n                    value: record.value,\n                    threshold: threshold,\n                    severity: 'medium',\n                    description: `Ê®°ÂºèÂºÇÂ∏∏Ê£ÄÊµã: ÂÄº ${record.value} Ë∂ÖËøáÊ®°ÂºèÈòàÂÄº ${threshold.toFixed(2)}`\n                });\n            }\n        });\n        \n        return anomalies;\n    }\n    \n    detectRuleViolations(data, parameters) {\n        const anomalies = [];\n        \n        data.forEach((record, index) => {\n            // Ê£ÄÊü•‰∏öÂä°ËßÑÂàôËøùÂèç\n            if (record.value <= 0) {\n                anomalies.push({\n                    type: 'rule_violation',\n                    record_id: record.meter_id || index,\n                    value: record.value,\n                    rule: 'value_must_be_positive',\n                    severity: 'high',\n                    description: `‰∏öÂä°ËßÑÂàôËøùÂèç: ÂÄºÂøÖÈ°ªÂ§ß‰∫é0ÔºåÂΩìÂâçÂÄº‰∏∫ ${record.value}`\n                });\n            }\n            \n            // Ê£ÄÊü•Êó∂Èó¥ËßÑÂàô\n            const recordTime = new Date(record.timestamp).getTime();\n            const currentTime = Date.now();\n            if (recordTime > currentTime + 300000) { // 5ÂàÜÈíüÊú™Êù•Êó∂Èó¥ÂÆπÈîô\n                anomalies.push({\n                    type: 'rule_violation',\n                    record_id: record.meter_id || index,\n                    timestamp: record.timestamp,\n                    rule: 'timestamp_cannot_be_future',\n                    severity: 'medium',\n                    description: `‰∏öÂä°ËßÑÂàôËøùÂèç: Êó∂Èó¥Êà≥‰∏çËÉΩÊòØÊú™Êù•Êó∂Èó¥`\n                });\n            }\n        });\n        \n        return anomalies;\n    }\n    \n    async evaluateAlertConditions(alertConfig) {\n        const conditions = alertConfig.trigger_conditions;\n        \n        // Ê£ÄÊü•Ë¥®ÈáèÂàÜÊï∞Êù°‰ª∂\n        if (conditions.quality_score) {\n            const latestCheck = this.realTimeStatus.get('latest_check');\n            if (latestCheck && latestCheck.quality_scores) {\n                for (const category of conditions.category || []) {\n                    const categoryScore = latestCheck.quality_scores[category];\n                    if (categoryScore && this.evaluateCondition(categoryScore.final_score, conditions.quality_score)) {\n                        return true;\n                    }\n                }\n            }\n        }\n        \n        return false;\n    }\n    \n    evaluateCondition(value, condition) {\n        switch (condition.operator) {\n            case '<':\n                return value < condition.value;\n            case '<=':\n                return value <= condition.value;\n            case '>':\n                return value > condition.value;\n            case '>=':\n                return value >= condition.value;\n            case '==':\n                return value === condition.value;\n            case '!=':\n                return value !== condition.value;\n            default:\n                return false;\n        }\n    }\n    \n    async triggerAlert(alertConfig) {\n        const alert = {\n            id: `alert_${Date.now()}`,\n            config_id: alertConfig.id,\n            name: alertConfig.name,\n            severity: alertConfig.severity,\n            triggered_at: new Date().toISOString(),\n            status: 'active',\n            description: alertConfig.description\n        };\n        \n        logger.warn(`üö® Ëß¶ÂèëÈ¢ÑË≠¶: ${alert.name} (${alert.severity})`);\n        \n        // Êõ¥Êñ∞Ëß¶ÂèëÁªüËÆ°\n        alertConfig.trigger_count++;\n        alertConfig.last_triggered = alert.triggered_at;\n        \n        this.emit('alert:triggered', alert);\n        \n        return alert;\n    }\n    \n    calculateOverallQualityScore(qualityScores) {\n        const categoryWeights = {\n            energy: 0.25,\n            carbon: 0.30,\n            production: 0.20,\n            indicators: 0.25\n        };\n        \n        let totalWeight = 0;\n        let weightedSum = 0;\n        \n        for (const [category, scoreData] of Object.entries(qualityScores)) {\n            const weight = categoryWeights[category] || 0;\n            if (weight > 0 && scoreData.final_score !== undefined) {\n                totalWeight += weight;\n                weightedSum += scoreData.final_score * weight;\n            }\n        }\n        \n        return totalWeight > 0 ? weightedSum / totalWeight : 0;\n    }\n    \n    calculateAnomalyDetectionRate() {\n        // Ê®°ÊãüÂºÇÂ∏∏Ê£ÄÊµãÁéáËÆ°ÁÆó\n        const totalDetections = Array.from(this.anomalyDetectors.values())\n            .reduce((sum, detector) => sum + detector.detection_count, 0);\n        const totalRecords = 10000; // Ê®°ÊãüÊÄªËÆ∞ÂΩïÊï∞\n        return totalRecords > 0 ? totalDetections / totalRecords : 0;\n    }\n    \n    calculateDataFreshnessScore() {\n        // Ê®°ÊãüÊï∞ÊçÆÊó∂ÊïàÊÄßËØÑÂàÜËÆ°ÁÆó\n        return 0.95;\n    }\n    \n    /**\n     * ÁîüÊàêË¥®ÈáèÊä•Âëä\n     */\n    async generateQualityReport() {\n        const report = {\n            id: `quality_report_${Date.now()}`,\n            generated_at: new Date().toISOString(),\n            period: {\n                start: new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString(),\n                end: new Date().toISOString()\n            },\n            summary: {\n                overall_quality_score: this.qualityMetrics.get('overall_quality_score')?.current_value || 0,\n                total_rules_executed: Array.from(this.qualityRules.values())\n                    .reduce((sum, rule) => sum + rule.execution_count, 0),\n                total_anomalies_detected: Array.from(this.anomalyDetectors.values())\n                    .reduce((sum, detector) => sum + detector.detection_count, 0),\n                alerts_triggered: Array.from(this.alertConfigs.values())\n                    .reduce((sum, config) => sum + config.trigger_count, 0)\n            },\n            quality_metrics: Object.fromEntries(\n                Array.from(this.qualityMetrics.entries()).map(([id, metric]) => [\n                    id,\n                    {\n                        current_value: metric.current_value,\n                        target_value: metric.target_value,\n                        trend: metric.trend,\n                        achievement_rate: metric.target_value > 0 ? \n                            (metric.current_value / metric.target_value) : 0\n                    }\n                ])\n            ),\n            recommendations: this.generateQualityRecommendations()\n        };\n        \n        this.qualityReports.set(report.id, report);\n        logger.info(`üìä Ë¥®ÈáèÊä•ÂëäÂ∑≤ÁîüÊàê: ${report.id}`);\n        \n        return report;\n    }\n    \n    generateQualityRecommendations() {\n        const recommendations = [];\n        \n        // Âü∫‰∫éË¥®ÈáèÊåáÊ†áÁîüÊàêÂª∫ËÆÆ\n        for (const [metricId, metric] of this.qualityMetrics) {\n            if (metric.current_value < metric.target_value * 0.9) {\n                recommendations.push({\n                    type: 'quality_improvement',\n                    metric: metricId,\n                    priority: 'high',\n                    description: `${metric.name}‰Ωé‰∫éÁõÆÊ†áÂÄº90%ÔºåÂª∫ËÆÆÂä†Âº∫Êï∞ÊçÆË¥®ÈáèÁÆ°Êéß`,\n                    suggested_actions: [\n                        'Â¢ûÂä†Êï∞ÊçÆÈ™åËØÅËßÑÂàô',\n                        'ÊèêÈ´òÊï∞ÊçÆÈááÈõÜÈ¢ëÁéá',\n                        'Âä†Âº∫Êï∞ÊçÆÊ∫êÁõëÊéß'\n                    ]\n                });\n            }\n        }\n        \n        return recommendations;\n    }\n    \n    /**\n     * Ëé∑ÂèñÊúçÂä°Áä∂ÊÄÅ\n     */\n    getServiceStatus() {\n        return {\n            service_name: 'RealTimeDataQualityService',\n            status: 'running',\n            uptime: Date.now() - this.startTime,\n            statistics: {\n                quality_rules: this.qualityRules.size,\n                anomaly_detectors: this.anomalyDetectors.size,\n                alert_configs: this.alertConfigs.size,\n                quality_metrics: this.qualityMetrics.size,\n                monitoring_tasks: this.monitoringTasks.size\n            },\n            latest_metrics: Object.fromEntries(\n                Array.from(this.qualityMetrics.entries()).map(([id, metric]) => [\n                    id,\n                    {\n                        value: metric.current_value,\n                        trend: metric.trend,\n                        last_updated: metric.last_updated\n                    }\n                ])\n            )\n        };\n    }\n    \n    /**\n     * ÂÅúÊ≠¢ÊúçÂä°\n     */\n    async stop() {\n        logger.info('üõë ÂÅúÊ≠¢ÂÆûÊó∂Êï∞ÊçÆË¥®ÈáèÁõëÊéßÊúçÂä°...');\n        \n        // Ê∏ÖÁêÜÁõëÊéß‰ªªÂä°\n        for (const [taskName, task] of this.monitoringTasks) {\n            clearInterval(task);\n            logger.info(`‚úÖ Â∑≤ÂÅúÊ≠¢ÁõëÊéß‰ªªÂä°: ${taskName}`);\n        }\n        \n        this.monitoringTasks.clear();\n        this.emit('quality:stopped');\n        \n        logger.info('‚úÖ ÂÆûÊó∂Êï∞ÊçÆË¥®ÈáèÁõëÊéßÊúçÂä°Â∑≤ÂÅúÊ≠¢');\n    }\n}\n\nexport default RealTimeDataQualityService; {\n            logger.error('ÂÆûÊó∂Êï∞ÊçÆË¥®ÈáèÁõëÊéßÊúçÂä°ÂêØÂä®Â§±Ë¥•:', error);\n            throw error;\n        }\n    }\n    \n    /**\n     * ÂàùÂßãÂåñÊï∞ÊçÆË¥®ÈáèËßÑÂàô\n     */\n    async initializeQualityRules() {\n        const rules = [\n            // ËÉΩÊ∫êÊï∞ÊçÆË¥®ÈáèËßÑÂàô\n            {\n                id: 'energy_completeness',\n                name: 'ËÉΩÊ∫êÊï∞ÊçÆÂÆåÊï¥ÊÄß',\n                category: 'energy',\n                data_source: 'ems_energy_data',\n                rule_type: 'completeness',\n                description: 'Ê£ÄÊü•ËÉΩÊ∫êÊ∂àË¥πÊï∞ÊçÆÁöÑÂÆåÊï¥ÊÄß',\n                validation_logic: {\n                    required_fields: ['meter_id', 'energy_type', 'consumption_amount', 'measurement_time'],\n                    null_tolerance: 0,\n                    missing_tolerance: 0.05 // 5%ÂÆπÈîôÁéá\n                },\n                thresholds: {\n                    excellent: 0.98,\n                    good: 0.95,\n                    acceptable: 0.90,\n                    poor: 0.85\n                },\n                weight: 0.25,\n                enabled: true\n            },\n            {\n                id: 'energy_accuracy',\n                name: 'ËÉΩÊ∫êÊï∞ÊçÆÂáÜÁ°ÆÊÄß',\n                category: 'energy',\n                data_source: 'ems_energy_data',\n                rule_type: 'accuracy',\n                description: 'Ê£ÄÊü•ËÉΩÊ∫êÊ∂àË¥πÊï∞ÊçÆÁöÑÂáÜÁ°ÆÊÄß',\n                validation_logic: {\n                    range_checks: {\n                        'consumption_amount': { min: 0, max: 10000 },\n                        'measurement_time': { format: 'ISO8601', future_tolerance: 300 }\n                    },\n                    business_rules: [\n                        'consumption_amount > 0',\n                        'measurement_time <= current_time + 5_minutes'\n                    ],\n                    outlier_detection: {\n                        method: 'z_score',\n                        threshold: 3,\n                        window_size: 100\n                    }\n                },\n                thresholds: {\n                    excellent: 0.99,\n                    good: 0.97,\n                    acceptable: 0.93,\n                    poor: 0.90\n                },\n                weight: 0.30,\n                enabled: true\n            },\n            {\n                id: 'energy_timeliness',\n                name: 'ËÉΩÊ∫êÊï∞ÊçÆÊó∂ÊïàÊÄß',\n                category: 'energy',\n                data_source: 'ems_energy_data',\n                rule_type: 'timeliness',\n                description: 'Ê£ÄÊü•ËÉΩÊ∫êÊï∞ÊçÆÁöÑÊó∂ÊïàÊÄß',\n                validation_logic: {\n                    max_delay: 300, // 5ÂàÜÈíü\n                    expected_frequency: 60, // ÊØèÂàÜÈíü\n                    delay_calculation: 'current_time - measurement_time'\n                },\n                thresholds: {\n                    excellent: 0.98,\n                    good: 0.95,\n                    acceptable: 0.90,\n                    poor: 0.85\n                },\n                weight: 0.20,\n                enabled: true\n            },\n            {\n                id: 'energy_consistency',\n                name: 'ËÉΩÊ∫êÊï∞ÊçÆ‰∏ÄËá¥ÊÄß',\n                category: 'energy',\n                data_source: 'ems_energy_data',\n                rule_type: 'consistency',\n                description: 'Ê£ÄÊü•ËÉΩÊ∫êÊï∞ÊçÆÁöÑ‰∏ÄËá¥ÊÄß',\n                validation_logic: {\n                    cross_validation: [\n                        'sum(sub_meters) == total_meter',\n                        'energy_type matches meter_type'\n                    ],\n                    temporal_consistency: {\n                        check_period: '1_hour',\n                        variance_threshold: 0.2\n                    }\n                },\n                thresholds: {\n                    excellent: 0.97,\n                    good: 0.94,\n                    acceptable: 0.90,\n                    poor: 0.85\n                },\n                weight: 0.25,\n                enabled: true\n            },\n            \n            // Á¢≥ÊéíÊîæÊï∞ÊçÆË¥®ÈáèËßÑÂàô\n            {\n                id: 'carbon_completeness',\n                name: 'Á¢≥ÊéíÊîæÊï∞ÊçÆÂÆåÊï¥ÊÄß',\n                category: 'carbon',\n                data_source: 'carbon_emissions',\n                rule_type: 'completeness',\n                description: 'Ê£ÄÊü•Á¢≥ÊéíÊîæËÆ°ÁÆóÊï∞ÊçÆÁöÑÂÆåÊï¥ÊÄß',\n                validation_logic: {\n                    required_fields: ['emission_id', 'emission_scope', 'emission_source', 'emission_amount', 'calculation_time'],\n                    null_tolerance: 0,\n                    missing_tolerance: 0.02\n                },\n                thresholds: {\n                    excellent: 0.99,\n                    good: 0.97,\n                    acceptable: 0.93,\n                    poor: 0.90\n                },\n                weight: 0.30,\n                enabled: true\n            },\n            {\n                id: 'carbon_accuracy',\n                name: 'Á¢≥ÊéíÊîæÊï∞ÊçÆÂáÜÁ°ÆÊÄß',\n                category: 'carbon',\n                data_source: 'carbon_emissions',\n                rule_type: 'accuracy',\n                description: 'Ê£ÄÊü•Á¢≥ÊéíÊîæËÆ°ÁÆóÁªìÊûúÁöÑÂáÜÁ°ÆÊÄß',\n                validation_logic: {\n                    calculation_verification: {\n                        recalculate_sample: 0.1, // ÈáçÊñ∞ËÆ°ÁÆó10%Ê†∑Êú¨\n                        tolerance: 0.01 // 1%ËØØÂ∑ÆÂÆπÂøç\n                    },\n                    factor_validation: {\n                        check_emission_factors: true,\n                        validate_calculation_method: true\n                    }\n                },\n                thresholds: {\n                    excellent: 0.99,\n                    good: 0.97,\n                    acceptable: 0.94,\n                    poor: 0.90\n                },\n                weight: 0.35,\n                enabled: true\n            },\n            {\n                id: 'carbon_validity',\n                name: 'Á¢≥ÊéíÊîæÊï∞ÊçÆÊúâÊïàÊÄß',\n                category: 'carbon',\n                data_source: 'carbon_emissions',\n                rule_type: 'validity',\n                description: 'Ê£ÄÊü•Á¢≥ÊéíÊîæÊï∞ÊçÆÁöÑÊúâÊïàÊÄß',\n                validation_logic: {\n                    scope_validation: {\n                        valid_scopes: ['scope1', 'scope2', 'scope3'],\n                        scope_completeness: true\n                    },\n                    source_validation: {\n                        valid_sources: ['electricity', 'natural_gas', 'coal', 'diesel', 'gasoline'],\n                        source_mapping: true\n                    }\n                },\n                thresholds: {\n                    excellent: 0.98,\n                    good: 0.95,\n                    acceptable: 0.92,\n                    poor: 0.88\n                },\n                weight: 0.20,\n                enabled: true\n            },\n            {\n                id: 'carbon_traceability',\n                name: 'Á¢≥ÊéíÊîæÊï∞ÊçÆÂèØËøΩÊ∫ØÊÄß',\n                category: 'carbon',\n                data_source: 'carbon_emissions',\n                rule_type: 'traceability',\n                description: 'Ê£ÄÊü•Á¢≥ÊéíÊîæÊï∞ÊçÆÁöÑÂèØËøΩÊ∫ØÊÄß',\n                validation_logic: {\n                    audit_trail: {\n                        required_metadata: ['calculation_method', 'emission_factor_source', 'data_source'],\n                        version_control: true\n                    },\n                    lineage_validation: {\n                        source_data_linkage: true,\n                        calculation_steps: true\n                    }\n                },\n                thresholds: {\n                    excellent: 0.96,\n                    good: 0.93,\n                    acceptable: 0.88,\n                    poor: 0.83\n                },\n                weight: 0.15,\n                enabled: true\n            },\n            \n            // Áîü‰∫ßÊï∞ÊçÆË¥®ÈáèËßÑÂàô\n            {\n                id: 'production_completeness',\n                name: 'Áîü‰∫ßÊï∞ÊçÆÂÆåÊï¥ÊÄß',\n                category: 'production',\n                data_source: 'mes_production_data',\n                rule_type: 'completeness',\n                description: 'Ê£ÄÊü•Áîü‰∫ßÊï∞ÊçÆÁöÑÂÆåÊï¥ÊÄß',\n                validation_logic: {\n                    required_fields: ['enterprise_id', 'product_code', 'production_volume', 'production_date'],\n                    null_tolerance: 0,\n                    missing_tolerance: 0.03\n                },\n                thresholds: {\n                    excellent: 0.98,\n                    good: 0.95,\n                    acceptable: 0.91,\n                    poor: 0.87\n                },\n                weight: 0.25,\n                enabled: true\n            },\n            {\n                id: 'production_consistency',\n                name: 'Áîü‰∫ßÊï∞ÊçÆ‰∏ÄËá¥ÊÄß',\n                category: 'production',\n                data_source: 'mes_production_data',\n                rule_type: 'consistency',\n                description: 'Ê£ÄÊü•Áîü‰∫ßÊï∞ÊçÆÁöÑ‰∏ÄËá¥ÊÄß',\n                validation_logic: {\n                    cross_system_validation: [\n                        'production_volume matches inventory_change',\n                        'enterprise_id exists in enterprise_registry'\n                    ],\n                    temporal_consistency: {\n                        check_period: '1_day',\n                        variance_threshold: 0.15\n                    }\n                },\n                thresholds: {\n                    excellent: 0.96,\n                    good: 0.93,\n                    acceptable: 0.89,\n                    poor: 0.84\n                },\n                weight: 0.30,\n                enabled: true\n            },\n            \n            // ÂõΩÂÆ∂ÊåáÊ†áÊï∞ÊçÆË¥®ÈáèËßÑÂàô\n            {\n                id: 'indicator_accuracy',\n                name: 'ÂõΩÂÆ∂ÊåáÊ†áÂáÜÁ°ÆÊÄß',\n                category: 'indicators',\n                data_source: 'national_indicators',\n                rule_type: 'accuracy',\n                description: 'Ê£ÄÊü•ÂõΩÂÆ∂ÊåáÊ†áËÆ°ÁÆóÁöÑÂáÜÁ°ÆÊÄß',\n                validation_logic: {\n                    calculation_verification: {\n                        recalculate_sample: 0.2,\n                        tolerance: 0.005\n                    },\n                    benchmark_comparison: {\n                        compare_with_targets: true,\n                        historical_trend_check: true\n                    }\n                },\n                thresholds: {\n                    excellent: 0.995,\n                    good: 0.99,\n                    acceptable: 0.98,\n                    poor: 0.95\n                },\n                weight: 0.40,\n                enabled: true\n            },\n            {\n                id: 'indicator_compliance',\n                name: 'ÂõΩÂÆ∂ÊåáÊ†áÂêàËßÑÊÄß',\n                category: 'indicators',\n                data_source: 'national_indicators',\n                rule_type: 'compliance',\n                description: 'Ê£ÄÊü•ÂõΩÂÆ∂ÊåáÊ†áÁöÑÂêàËßÑÊÄß',\n                validation_logic: {\n                    standard_compliance: {\n                        check_calculation_method: true,\n                        validate_data_sources: true,\n                        verify_reporting_format: true\n                    },\n                    regulatory_requirements: [\n                        'calculation_follows_national_standard',\n                        'data_retention_compliant',\n                        'audit_trail_complete'\n                    ]\n                },\n                thresholds: {\n                    excellent: 1.0,\n                    good: 0.98,\n                    acceptable: 0.95,\n                    poor: 0.90\n                },\n                weight: 0.35,\n                enabled: true\n            }\n        ];\n        \n        for (const rule of rules) {\n            this.qualityRules.set(rule.id, {\n                ...rule,\n                created_at: new Date().toISOString(),\n                last_updated: new Date().toISOString(),\n                execution_count: 0,\n                last_execution: null,\n                status: 'active'\n            });\n        }\n        \n        logger.info(`üìã Â∑≤ÂàùÂßãÂåñ ${this.qualityRules.size} ‰∏™Êï∞ÊçÆË¥®ÈáèËßÑÂàô`);\n    }\n    \n    /**\n     * ÂàùÂßãÂåñÂºÇÂ∏∏Ê£ÄÊµãÂô®\n     */\n    async initializeAnomalyDetectors() {\n        const detectors = [\n            {\n                id: 'statistical_outlier',\n                name: 'ÁªüËÆ°ÂºÇÂ∏∏Ê£ÄÊµã',\n                type: 'statistical',\n                description: 'Âü∫‰∫éÁªüËÆ°ÊñπÊ≥ïÊ£ÄÊµãÊï∞ÊçÆÂºÇÂ∏∏',\n                algorithm: 'z_score',\n                parameters: {\n                    threshold: 3,\n                    window_size: 100,\n                    min_samples: 30\n                },\n                applicable_data_types: ['numeric'],\n                sensitivity: 'medium'\n            },\n            {\n                id: 'trend_anomaly',\n                name: 'Ë∂ãÂäøÂºÇÂ∏∏Ê£ÄÊµã',\n                type: 'trend',\n                description: 'Ê£ÄÊµãÊï∞ÊçÆË∂ãÂäøÂºÇÂ∏∏',\n                algorithm: 'moving_average_deviation',\n                parameters: {\n                    window_size: 24,\n                    deviation_threshold: 0.3,\n                    trend_sensitivity: 0.1\n                },\n                applicable_data_types: ['time_series'],\n                sensitivity: 'high'\n            },\n            {\n                id: 'pattern_anomaly',\n                name: 'Ê®°ÂºèÂºÇÂ∏∏Ê£ÄÊµã',\n                type: 'pattern',\n                description: 'Ê£ÄÊµãÊï∞ÊçÆÊ®°ÂºèÂºÇÂ∏∏',\n                algorithm: 'isolation_forest',\n                parameters: {\n                    contamination: 0.1,\n                    n_estimators: 100,\n                    max_samples: 256\n                },\n                applicable_data_types: ['multivariate'],\n                sensitivity: 'medium'\n            },\n            {\n                id: 'business_rule_violation',\n                name: '‰∏öÂä°ËßÑÂàôËøùÂèçÊ£ÄÊµã',\n                type: 'rule_based',\n                description: 'Ê£ÄÊµãËøùÂèç‰∏öÂä°ËßÑÂàôÁöÑÊï∞ÊçÆ',\n                algorithm: 'rule_engine',\n                parameters: {\n                    rule_evaluation: 'strict',\n                    violation_tolerance: 0\n                },\n                applicable_data_types: ['all'],\n                sensitivity: 'high'\n            }\n        ];\n        \n        for (const detector of detectors) {\n            this.anomalyDetectors.set(detector.id, {\n                ...detector,\n                created_at: new Date().toISOString(),\n                detection_count: 0,\n                last_detection: null,\n                status: 'active'\n            });\n        }\n        \n        logger.info(`üîç Â∑≤ÂàùÂßãÂåñ ${this.anomalyDetectors.size} ‰∏™ÂºÇÂ∏∏Ê£ÄÊµãÂô®`);\n    }\n    \n    /**\n     * ÂàùÂßãÂåñÈ¢ÑË≠¶ÈÖçÁΩÆ\n     */\n    async initializeAlertConfigs() {\n        const configs = [\n            {\n                id: 'critical_quality_degradation',\n                name: 'ÂÖ≥ÈîÆË¥®Èáè‰∏ãÈôçÈ¢ÑË≠¶',\n                severity: 'critical',\n                description: 'Êï∞ÊçÆË¥®Èáè‰∏•Èáç‰∏ãÈôçÊó∂Ëß¶Âèë',\n                trigger_conditions: {\n                    quality_score: { operator: '<', value: 0.85 },\n                    category: ['energy', 'carbon', 'indicators'],\n                    duration: 300 // 5ÂàÜÈíü\n                },\n                notification_channels: ['email', 'sms', 'dashboard'],\n                escalation_rules: {\n                    level_1: { delay: 0, recipients: ['quality_team'] },\n                    level_2: { delay: 600, recipients: ['quality_manager'] },\n                    level_3: { delay: 1800, recipients: ['system_admin'] }\n                },\n                auto_actions: [\n                    'increase_monitoring_frequency',\n                    'trigger_data_validation',\n                    'generate_quality_report'\n                ]\n            },\n            {\n                id: 'anomaly_detection_alert',\n                name: 'ÂºÇÂ∏∏Ê£ÄÊµãÈ¢ÑË≠¶',\n                severity: 'high',\n                description: 'Ê£ÄÊµãÂà∞Êï∞ÊçÆÂºÇÂ∏∏Êó∂Ëß¶Âèë',\n                trigger_conditions: {\n                    anomaly_count: { operator: '>=', value: 5 },\n                    time_window: 600, // 10ÂàÜÈíü\n                    anomaly_types: ['statistical_outlier', 'trend_anomaly']\n                },\n                notification_channels: ['email', 'dashboard'],\n                escalation_rules: {\n                    level_1: { delay: 0, recipients: ['data_analyst'] },\n                    level_2: { delay: 900, recipients: ['quality_team'] }\n                },\n                auto_actions: [\n                    'detailed_anomaly_analysis',\n                    'data_source_health_check'\n                ]\n            },\n            {\n                id: 'compliance_violation',\n                name: 'ÂêàËßÑÊÄßËøùÂèçÈ¢ÑË≠¶',\n                severity: 'high',\n                description: 'Ê£ÄÊµãÂà∞ÂêàËßÑÊÄßËøùÂèçÊó∂Ëß¶Âèë',\n                trigger_conditions: {\n                    compliance_score: { operator: '<', value: 0.95 },\n                    category: ['indicators'],\n                    violation_type: ['calculation_method', 'data_retention']\n                },\n                notification_channels: ['email', 'sms'],\n                escalation_rules: {\n                    level_1: { delay: 0, recipients: ['compliance_officer'] },\n                    level_2: { delay: 300, recipients: ['legal_team'] }\n                },\n                auto_actions: [\n                    'compliance_audit_trigger',\n                    'violation_documentation'\n                ]\n            },\n            {\n                id: 'data_freshness_warning',\n                name: 'Êï∞ÊçÆÊó∂ÊïàÊÄßÈ¢ÑË≠¶',\n                severity: 'medium',\n                description: 'Êï∞ÊçÆÊõ¥Êñ∞Âª∂ËøüÊó∂Ëß¶Âèë',\n                trigger_conditions: {\n                    data_delay: { operator: '>', value: 600 }, // 10ÂàÜÈíü\n                    data_sources: ['ems_energy_data', 'mes_production_data']\n                },\n                notification_channels: ['dashboard'],\n                escalation_rules: {\n                    level_1: { delay: 0, recipients: ['data_team'] }\n                },\n                auto_actions: [\n                    'data_source_connectivity_check',\n                    'retry_data_collection'\n                ]\n            }\n        ];\n        \n        for (const config of configs) {\n            this.alertConfigs.set(config.id, {\n                ...config,\n                created_at: new Date().toISOString(),\n                trigger_count: 0,\n                last_triggered: null,\n                status: 'active'\n            });\n        }\n        \n        logger.info(`üö® Â∑≤ÂàùÂßãÂåñ ${this.alertConfigs.size} ‰∏™È¢ÑË≠¶ÈÖçÁΩÆ`);\n    }\n    \n    /**\n     * ÂêØÂä®ÂÆûÊó∂ÁõëÊéß\n     */\n    async startRealTimeMonitoring() {\n        // ÂÆûÊó∂Ë¥®ÈáèÊ£ÄÊü•‰ªªÂä°\n        const realTimeQualityTask = setInterval(async () => {\n            await this.performRealTimeQualityCheck();\n        }, MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.MILLISECONDS_PER_SECOND); // ÊØèÂàÜÈíü\n        \n        // ÂºÇÂ∏∏Ê£ÄÊµã‰ªªÂä°\n        const anomalyDetectionTask = setInterval(async () => {\n            await this.performAnomalyDetection();\n        }, MATH_CONSTANTS.FIVE * MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.MILLISECONDS_PER_SECOND); // ÊØè5ÂàÜÈíü\n        \n        // Ë¥®ÈáèË∂ãÂäøÂàÜÊûê‰ªªÂä°\n        const trendAnalysisTask = setInterval(async () => {\n            await this.performTrendAnalysis();\n        }, MATH_CONSTANTS.FIFTEEN * MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.MILLISECONDS_PER_SECOND); // ÊØè15ÂàÜÈíü\n        \n        // È¢ÑË≠¶Ê£ÄÊü•‰ªªÂä°\n        const alertCheckTask = setInterval(async () => {\n            await this.checkAlertConditions();\n        }, MATH_CONSTANTS.THIRTY * MATH_CONSTANTS.MILLISECONDS_PER_SECOND); // ÊØè30Áßí\n        \n        this.monitoringTasks.set('real_time_quality', realTimeQualityTask);\n        this.monitoringTasks.set('anomaly_detection', anomalyDetectionTask);\n        this.monitoringTasks.set('trend_analysis', trendAnalysisTask);\n        this.monitoringTasks.set('alert_check', alertCheckTask);\n        \n        logger.info('üîÑ ÂÆûÊó∂Êï∞ÊçÆË¥®ÈáèÁõëÊéß‰ªªÂä°Â∑≤ÂêØÂä®');\n    }\n    \n    /**\n     * ÂàùÂßãÂåñË¥®ÈáèÊåáÊ†á\n     */\n    async initializeQualityMetrics() {\n        const metrics = [\n            {\n                id: 'overall_quality_score',\n                name: 'Êï¥‰ΩìË¥®ÈáèËØÑÂàÜ',\n                description: 'Á≥ªÁªüÊï¥‰ΩìÊï∞ÊçÆË¥®ÈáèËØÑÂàÜ',\n                calculation_method: 'weighted_average',\n                target_value: 0.95,\n                unit: 'score',\n                category: 'overall'\n            },\n            {\n                id: 'energy_data_quality',\n                name: 'ËÉΩÊ∫êÊï∞ÊçÆË¥®Èáè',\n                description: 'ËÉΩÊ∫êÊï∞ÊçÆË¥®ÈáèËØÑÂàÜ',\n                calculation_method: 'category_average',\n                target_value: 0.96,\n                unit: 'score',\n                category: 'energy'\n            },\n            {\n                id: 'carbon_data_quality',\n                name: 'Á¢≥ÊéíÊîæÊï∞ÊçÆË¥®Èáè',\n                description: 'Á¢≥ÊéíÊîæÊï∞ÊçÆË¥®ÈáèËØÑÂàÜ',\n                calculation_method: 'category_average',\n                target_value: 0.98,\n                unit: 'score',\n                category: 'carbon'\n            },\n            {\n                id: 'production_data_quality',\n                name: 'Áîü‰∫ßÊï∞ÊçÆË¥®Èáè',\n                description: 'Áîü‰∫ßÊï∞ÊçÆË¥®ÈáèËØÑÂàÜ',\n                calculation_method: 'category_average',\n                target_value: 0.94,\n                unit: 'score',\n                category: 'production'\n            },\n            {\n                id: 'indicator_data_quality',\n                name: 'ÂõΩÂÆ∂ÊåáÊ†áÊï∞ÊçÆË¥®Èáè',\n                description: 'ÂõΩÂÆ∂ÊåáÊ†áÊï∞ÊçÆË¥®ÈáèËØÑÂàÜ',\n                calculation_method: 'category_average',\n                target_value: 0.99,\n                unit: 'score',\n                category: 'indicators'\n            },\n            {\n                id: 'anomaly_detection_rate',\n                name: 'ÂºÇÂ∏∏Ê£ÄÊµãÁéá',\n                description: 'Êï∞ÊçÆÂºÇÂ∏∏Ê£ÄÊµãÁéá',\n                calculation_method: 'percentage',\n                target_value: 0.02,\n                unit: 'percentage',\n                category: 'monitoring'\n            },\n            {\n                id: 'data_freshness_score',\n                name: 'Êï∞ÊçÆÊó∂ÊïàÊÄßËØÑÂàÜ',\n                description: 'Êï∞ÊçÆÊó∂ÊïàÊÄßËØÑÂàÜ',\n                calculation_method: 'timeliness_average',\n                target_value: 0.97,\n                unit: 'score',\n                category: 'timeliness'\n            }\n        ];\n        \n        for (const metric of metrics) {\n            this.qualityMetrics.set(metric.id, {\n                ...metric,\n                current_value: 0,\n                last_updated: new Date().toISOString(),\n                trend: 'stable',\n                history: []\n            });\n        }\n        \n        logger.info(`üìà Â∑≤ÂàùÂßãÂåñ ${this.qualityMetrics.size} ‰∏™Ë¥®ÈáèÊåáÊ†á`);\n    }\n    \n    /**\n     * ÊâßË°åÂÆûÊó∂Ë¥®ÈáèÊ£ÄÊü•\n     */\n    async performRealTimeQualityCheck() {\n        logger.info('üîç ÂºÄÂßãÂÆûÊó∂Ë¥®ÈáèÊ£ÄÊü•...');\n        \n        const checkResults = {\n            timestamp: new Date().toISOString(),\n            total_rules_checked: 0,\n            passed_rules: 0,\n            failed_rules: 0,\n            quality_scores: {},\n            issues_found: []\n        };\n        \n        // ÊâßË°åÊâÄÊúâÂêØÁî®ÁöÑË¥®ÈáèËßÑÂàô\n        for (const [ruleId, rule] of this.qualityRules) {\n            if (!rule.enabled) continue;\n            \n            try {\n                const ruleResult = await this.executeQualityRule(rule);\n                checkResults.total_rules_checked++;\n                \n                if (ruleResult.passed) {\n                    checkResults.passed_rules++;\n                } else {\n                    checkResults.failed_rules++;\n                    checkResults.issues_found.push({\n                        rule_id: ruleId,\n                        rule_name: rule.name,\n                        issue_type: ruleResult.issue_type,\n                        severity: ruleResult.severity,\n                        description: ruleResult.description,\n                        affected_records: ruleResult.affected_records\n                    });\n                }\n                \n                // Êõ¥Êñ∞Ë¥®ÈáèÂàÜÊï∞\n                if (!checkResults.quality_scores[rule.category]) {\n                    checkResults.quality_scores[rule.category] = {\n                        total_weight: 0,\n                        weighted_score: 0,\n                        rule_count: 0\n                    };\n                }\n                \n                checkResults.quality_scores[rule.category].total_weight += rule.weight;\n                checkResults.quality_scores[rule.category].weighted_score += ruleResult.score * rule.weight;\n                checkResults.quality_scores[rule.category].rule_count++;\n                \n                // Êõ¥Êñ∞ËßÑÂàôÊâßË°åÁªüËÆ°\n                rule.execution_count++;\n                rule.last_execution = new Date().toISOString();\n                \n            } catch (error) {\n                logger.error(`Ë¥®ÈáèËßÑÂàôÊâßË°åÂ§±Ë¥• ${ruleId}:`, error);\n                checkResults.issues_found.push({\n                    rule_id: ruleId,\n                    rule_name: rule.name,\n                    issue_type: 'execution_error',\n                    severity: 'high',\n                    description: `ËßÑÂàôÊâßË°åÂ§±Ë¥•: ${error.message}`,\n                    affected_records: 0\n                });\n            }\n        }\n        \n        // ËÆ°ÁÆóÂàÜÁ±ªË¥®ÈáèÂàÜÊï∞\n        for (const [category, scoreData] of Object.entries(checkResults.quality_scores)) {\n            if (scoreData.total_weight > 0) {\n                scoreData.final_score = scoreData.weighted_score / scoreData.total_weight;\n            } else {\n                scoreData.final_score = 0;\n            }\n        }\n        \n        // Êõ¥Êñ∞ÂÆûÊó∂Áä∂ÊÄÅ\n        this.realTimeStatus.set('latest_check', checkResults);\n        \n        // Êõ¥Êñ∞Ë¥®ÈáèÊåáÊ†á\n        await this.updateQualityMetrics(checkResults);\n        \n        logger.info(`‚úÖ ÂÆûÊó∂Ë¥®ÈáèÊ£ÄÊü•ÂÆåÊàêÔºåÊ£ÄÊü•‰∫Ü ${checkResults.total_rules_checked} ‰∏™ËßÑÂàôÔºåÂèëÁé∞ ${checkResults.issues_found.length} ‰∏™ÈóÆÈ¢ò`);\n        this.emit('quality:check_completed', checkResults);\n        \n        return checkResults;\n    }\n    \n    /**\n     * ÊâßË°åË¥®ÈáèËßÑÂàô\n     * @param {Object} rule Ë¥®ÈáèËßÑÂàô\n     * @returns {Object} ËßÑÂàôÊâßË°åÁªìÊûú\n     */\n    async executeQualityRule(rule) {\n        const result = {\n            rule_id: rule.id,\n            executed_at: new Date().toISOString(),\n            passed: false,\n            score: 0,\n            issue_type: null,\n            severity: 'low',\n            description: '',\n            affected_records: 0,\n            details: {}\n        };\n        \n        try {\n            // Ëé∑ÂèñÊµãËØïÊï∞ÊçÆÔºàÊ®°ÊãüÔºâ\n            const testData = await this.getTestData(rule.data_source);\n            \n            switch (rule.rule_type) {\n                case 'completeness':\n                    result = await this.checkCompleteness(rule, testData, result);\n                    break;\n                case 'accuracy':\n                    result = await this.checkAccuracy(rule, testData, result);\n                    break;\n                case 'timeliness':\n                    result = await this.checkTimeliness(rule, testData, result);\n                    break;\n                case 'consistency':\n                    result = await this.checkConsistency(rule, testData, result);\n                    break;\n                case 'validity':\n                    result = await this.checkValidity(rule, testData, result);\n                    break;\n                case 'traceability':\n                    result = await this.checkTraceability(rule, testData, result);\n                    break;\n                case 'compliance':\n                    result = await this.checkCompliance(rule, testData, result);\n                    break;\n                default:\n                    throw new Error(`‰∏çÊîØÊåÅÁöÑËßÑÂàôÁ±ªÂûã: ${rule.rule_type}`);\n            }\n            \n            // Ê†πÊçÆÂàÜÊï∞Á°ÆÂÆöÊòØÂê¶ÈÄöËøá\n            result.passed = result.score >= rule.thresholds.acceptable;\n            \n            // Á°ÆÂÆö‰∏•ÈáçÁ®ãÂ∫¶\n            if (result.score >= rule.thresholds.excellent) {\n                result.severity = 'info';\n            } else if (result.score >= rule.thresholds.good) {\n                result.severity = 'low';\n            } else if (result.score >= rule.thresholds.acceptable) {\n                result.severity = 'medium';\n            } else {\n                result.severity = 'high';\n            }\n            \n        } catch (error) {\n            result.passed = false;\n            result.score = 0;\n            result.issue_type = 'execution_error';\n            result.severity = 'high';\n            result.description = `ËßÑÂàôÊâßË°åÈîôËØØ: ${error.message}`;\n        }\n        \n        return result;\n    }\n    \n    /**\n     * Ê£ÄÊü•Êï∞ÊçÆÂÆåÊï¥ÊÄß\n     */\n    async checkCompleteness(rule, testData, result) {\n        const validation = rule.validation_logic;\n        const totalRecords = testData.length;\n        let completeRecords = 0;\n        let missingFields = {};\n        \n        for (const record of testData) {\n            let recordComplete = true;\n            \n            for (const field of validation.required_fields) {\n                if (!record[field] || record[field] === null || record[field] === undefined) {\n                    recordComplete = false;\n                    missingFields[field] = (missingFields[field] || 0) + 1;\n                }\n            }\n            \n            if (recordComplete) {\n                completeRecords++;\n            }\n        }\n        \n        const completenessRate = totalRecords > 0 ? completeRecords / totalRecords : 0;\n        \n        result.score = completenessRate;\n        result.affected_records = totalRecords - completeRecords;\n        result.details = {\n            total_records: totalRecords,\n            complete_records: completeRecords,\n            completeness_rate: completenessRate,\n            missing_fields: missingFields\n        };\n        \n        if (completenessRate < validation.missing_tolerance) {\n            result.issue_type = 'completeness_violation';\n            result.description = `Êï∞ÊçÆÂÆåÊï¥ÊÄß‰∏çË∂≥: ${(completenessRate * 100).toFixed(2)}%Ôºå‰Ωé‰∫éË¶ÅÊ±ÇÁöÑ ${((1 - validation.missing_tolerance) * 100).toFixed(2)}%`;\n        }\n        \n        return result;\n    }\n    \n    /**\n     * Ê£ÄÊü•Êï∞ÊçÆÂáÜÁ°ÆÊÄß\n     */\n    async checkAccuracy(rule, testData, result) {\n        const validation = rule.validation_logic;\n        let accurateRecords = 0;\n        let rangeViolations = 0;\n        let businessRuleViolations = 0;\n        let outliers = 0;\n        \n        for (const record of testData) {\n            let recordAccurate = true;\n            \n            // ËåÉÂõ¥Ê£ÄÊü•\n            if (validation.range_checks) {\n                for (const [field, range] of Object.entries(validation.range_checks)) {\n                    const value = record[field];\n                    if (value !== null && value !== undefined) {\n                        if ((range.min !== undefined && value < range.min) ||\n                            (range.max !== undefined && value > range.max)) {\n                            recordAccurate = false;\n                            rangeViolations++;\n                        }\n                    }\n                }\n            }\n            \n            // ‰∏öÂä°ËßÑÂàôÊ£ÄÊü•\n            if (validation.business_rules) {\n                for (const rule of validation.business_rules) {\n                    if (!this.evaluateBusinessRule(rule, record)) {\n                        recordAccurate = false;\n                        businessRuleViolations++;\n                    }\n                }\n            }\n            \n            if (recordAccurate) {\n                accurateRecords++;\n            }\n        }\n        \n        // ÂºÇÂ∏∏ÂÄºÊ£ÄÊµã\n        if (validation.outlier_detection) {\n            outliers = await this.detectOutliers(testData, validation.outlier_detection);\n        }\n        \n        const accuracyRate = testData.length > 0 ? accurateRecords / testData.length : 0;\n        \n        result.score = accuracyRate;\n        result.affected_records = testData.length - accurateRecords;\n        result.details = {\n            total_records: testData.length,\n            accurate_records: accurateRecords,\n            accuracy_rate: accuracyRate,\n            range_violations: rangeViolations,\n            business_rule_violations: businessRuleViolations,\n            outliers: outliers\n        };\n        \n        if (accuracyRate < rule.thresholds.acceptable) {\n            result.issue_type = 'accuracy_violation';\n            result.description = `Êï∞ÊçÆÂáÜÁ°ÆÊÄß‰∏çË∂≥: ${(accuracyRate * 100).toFixed(2)}%`;\n        }\n        \n        return result;\n    }\n    \n    /**\n     * Ê£ÄÊü•Êï∞ÊçÆÊó∂ÊïàÊÄß\n     */\n    async checkTimeliness(rule, testData, result) {\n        const validation = rule.validation_logic;\n        const currentTime = Date.now();\n        let timelyRecords = 0;\n        let totalDelay = 0;\n        let maxDelay = 0;\n        \n        for (const record of testData) {\n            const measurementTime = new Date(record.measurement_time || record.timestamp).getTime();\n            const delay = (currentTime - measurementTime) / 1000; // Áßí\n            \n            totalDelay += delay;\n            maxDelay = Math.max(maxDelay, delay);\n            \n            if (delay <= validation.max_delay) {\n                timelyRecords++;\n            }\n        }\n        \n        const timelinessRate = testData.length > 0 ? timelyRecords / testData.length : 0;\n        const avgDelay = testData.length > 0 ? totalDelay / testData.length : 0;\n        \n        result.score = timelinessRate;\n        result.affected_records = testData.length - timelyRecords;\n        result.details = {\n            total_records: testData.length,\n            timely_records: timelyRecords,\n            timeliness_rate: timelinessRate,\n            average_delay: avgDelay,\n            max_delay: maxDelay,\n            max_allowed_delay: validation.max_delay\n        };\n        \n        if (timelinessRate < rule.thresholds.acceptable) {\n            result.issue_type = 'timeliness_violation';\n            result.description = `Êï∞ÊçÆÊó∂ÊïàÊÄß‰∏çË∂≥: ${(timelinessRate * 100).toFixed(2)}%ÔºåÂπ≥ÂùáÂª∂Ëøü ${avgDelay.toFixed(2)} Áßí`;\n        }\n        \n        return result;\n    }\n    \n    /**\n     * Ê£ÄÊü•Êï∞ÊçÆ‰∏ÄËá¥ÊÄß\n     */\n    async checkConsistency(rule, testData, result) {\n        const validation = rule.validation_logic;\n        let consistentRecords = 0;\n        let crossValidationFailures = 0;\n        let temporalInconsistencies = 0;\n        \n        for (const record of testData) {\n            let recordConsistent = true;\n            \n            // ‰∫§ÂèâÈ™åËØÅ\n            if (validation.cross_validation) {\n                for (const validationRule of validation.cross_validation) {\n                    if (!this.evaluateConsistencyRule(validationRule, record)) {\n                        recordConsistent = false;\n                        crossValidationFailures++;\n                    }\n                }\n            }\n            \n            if (recordConsistent) {\n                consistentRecords++;\n            }\n        }\n        \n        // Êó∂Èó¥‰∏ÄËá¥ÊÄßÊ£ÄÊü•\n        if (validation.temporal_consistency) {\n            temporalInconsistencies = await this.checkTemporalConsistency(\n                testData, \n                validation.temporal_consistency\n            );\n        }\n        \n        const consistencyRate = testData.length > 0 ? consistentRecords / testData.length : 0;\n        \n        result.score = consistencyRate;\n        result.affected_records = testData.length - consistentRecords;\n        result.details = {\n            total_records: testData.length,\n            consistent_records: consistentRecords,\n            consistency_rate: consistencyRate,\n            cross_validation_failures: crossValidationFailures,\n            temporal_inconsistencies: temporalInconsistencies\n        };\n        \n        if (consistencyRate < rule.thresholds.acceptable) {\n            result.issue_type = 'consistency_violation';\n            result.description = `Êï∞ÊçÆ‰∏ÄËá¥ÊÄß‰∏çË∂≥: ${(consistencyRate * 100).toFixed(2)}%`;\n        }\n        \n        return result;\n    }\n    \n    /**\n     * Ê£ÄÊü•Êï∞ÊçÆÊúâÊïàÊÄß\n     */\n    async checkValidity(rule, testData, result) {\n        const validation = rule.validation_logic;\n        let validRecords = 0;\n        let scopeViolations = 0;\n        let sourceViolations = 0;\n        \n        for (const record of testData) {\n            let recordValid = true;\n            \n            // ËåÉÂõ¥È™åËØÅ\n            if (validation.scope_validation) {\n                const scope = record.emission_scope || record.scope;\n                if (scope && !validation.scope_validation.valid_scopes.includes(scope)) {\n                    recordValid = false;\n                    scopeViolations++;\n                }\n            }\n            \n            // Êù•Ê∫êÈ™åËØÅ\n            if (validation.source_validation) {\n                const source = record.emission_source || record.source;\n                if (source && !validation.source_validation.valid_sources.includes(source)) {\n                    recordValid = false;\n                    sourceViolations++;\n                }\n            }\n            \n            if (recordValid) {\n                validRecords++;\n            }\n        }\n        \n        const validityRate = testData.length > 0 ? validRecords / testData.length : 0;\n        \n        result.score = validityRate;\n        result.affected_records = testData.length - validRecords;\n        result.details = {\n            total_records: testData.length,\n            valid_records: validRecords,\n            validity_rate: validityRate,\n            scope_violations: scopeViolations,\n            source_violations: sourceViolations\n        };\n        \n        if (validityRate < rule.thresholds.acceptable) {\n            result.issue_type = 'validity_violation';\n            result.description = `Êï∞ÊçÆÊúâÊïàÊÄß‰∏çË∂≥: ${(validityRate * 100).toFixed(2)}%`;\n        }\n        \n        return result;\n    }\n    \n    /**\n     * Ê£ÄÊü•Êï∞ÊçÆÂèØËøΩÊ∫ØÊÄß\n     */\n    async checkTraceability(rule, testData, result) {\n        const validation = rule.validation_logic;\n        let traceableRecords = 0;\n        let missingMetadata = 0;\n        let missingLineage = 0;\n        \n        for (const record of testData) {\n            let recordTraceable = true;\n            \n            // ÂÆ°ËÆ°ËΩ®ËøπÊ£ÄÊü•\n            if (validation.audit_trail) {\n                for (const field of validation.audit_trail.required_metadata) {\n                    if (!record[field]) {\n                        recordTraceable = false;\n                        missingMetadata++;\n                        break;\n                    }\n                }\n            }\n            \n            // Ë°ÄÁºòÈ™åËØÅ\n            if (validation.lineage_validation) {\n                if (!record.source_data_id || !record.calculation_steps) {\n                    recordTraceable = false;\n                    missingLineage++;\n                }\n            }\n            \n            if (recordTraceable) {\n                traceableRecords++;\n            }\n        }\n        \n        const traceabilityRate = testData.length > 0 ? traceableRecords / testData.length : 0;\n        \n        result.score = traceabilityRate;\n        result.affected_records = testData.length - traceableRecords;\n        result.details = {\n            total_records: testData.length,\n            traceable_records: traceableRecords,\n            traceability_rate: traceabilityRate,\n            missing_metadata: missingMetadata,\n            missing_lineage: missingLineage\n        };\n        \n        if (traceabilityRate < rule.thresholds.acceptable) {\n            result.issue_type = 'traceability_violation';\n            result.description = `Êï∞ÊçÆÂèØËøΩÊ∫ØÊÄß‰∏çË∂≥: ${(traceabilityRate * 100).toFixed(2)}%`;\n        }\n        \n        return result;\n    }\n    \n    /**\n     * Ê£ÄÊü•ÂêàËßÑÊÄß\n     */\n    async checkCompliance(rule, testData, result) {\n        const validation = rule.validation_logic;\n        let compliantRecords = 0;\n        let standardViolations = 0;\n        let regulatoryViolations = 0;\n        \n        for (const record of testData) {\n            let recordCompliant = true;\n            \n            // Ê†áÂáÜÂêàËßÑÊ£ÄÊü•\n            if (validation.standard_compliance) {\n                if (validation.standard_compliance.check_calculation_method) {\n                    if (!record.calculation_method || \n                        !this.isValidCalculationMethod(record.calculation_method)) {\n                        recordCompliant = false;\n                        standardViolations++;\n                    }\n                }\n            }\n            \n            // ÁõëÁÆ°Ë¶ÅÊ±ÇÊ£ÄÊü•\n            if (validation.regulatory_requirements) {\n                for (const requirement of validation.regulatory_requirements) {\n                    if (!this.evaluateRegulatoryRequirement(requirement, record)) {\n                        recordCompliant = false;\n                        regulatoryViolations++;\n                        break;\n                    }\n                }\n            }\n            \n            if (recordCompliant) {\n                compliantRecords++;\n            }\n        }\n        \n        const complianceRate = testData.length > 0 ? compliantRecords / testData.length : 0;\n        \n        result.score = complianceRate;\n        result.affected_records = testData.length - compliantRecords;\n        result.details = {\n            total_records: testData.length,\n            compliant_records: compliantRecords,\n            compliance_rate: complianceRate,\n            standard_violations: standardViolations,\n            regulatory_violations: regulatoryViolations\n        };\n        \n        if (complianceRate < rule.thresholds.acceptable) {\n            result.issue_type = 'compliance_violation';\n            result.description = `ÂêàËßÑÊÄß‰∏çË∂≥: ${(complianceRate * 100).toFixed(2)}%`;\n        }\n        \n        return result;\n    }\n    \n    /**\n     * ÊâßË°åÂºÇÂ∏∏Ê£ÄÊµã\n     */\n    async performAnomalyDetection() {\n        logger.info('üîç ÂºÄÂßãÂºÇÂ∏∏Ê£ÄÊµã...');\n        \n        const detectionResults = {\n            timestamp: new Date().toISOString(),\n            total_detectors: this.anomalyDetectors.size,\n            anomalies_found: [],\n            detection_summary: {}\n        };\n        \n        for (const [detectorId, detector] of this.anomalyDetectors) {\n            if (detector.status !== 'active') continue;\n            \n            try {\n                const anomalies = await this.runAnomalyDetector(detector);\n                \n                detectionResults.anomalies_found.push(...anomalies);\n                detectionResults.detection_summary[detectorId] = {\n                    detector_name: detector.name,\n                    anomalies_count: anomalies.length,\n                    execution_time: new Date().toISOString()\n                };\n                \n                detector.detection_count += anomalies.length;\n                if (anomalies.length > 0) {\n                    detector.last_detection = new Date().toISOString();\n                }\n                \n            } catch (error) {\n                logger.error(`ÂºÇÂ∏∏Ê£ÄÊµãÂô®ÊâßË°åÂ§±Ë¥• ${detectorId}:`, error);\n                detectionResults.detection_summary[detectorId] = {\n                    detector_name: detector.name,\n                    error: error.message,\n                    execution_time: new Date().toISOString()\n                };\n            }\n        }\n        \n        logger.info(`‚úÖ ÂºÇÂ∏∏Ê£ÄÊµãÂÆåÊàêÔºåÂèëÁé∞ ${detectionResults.anomalies_found.length} ‰∏™ÂºÇÂ∏∏`);\n        this.emit('anomaly:detection_completed', detectionResults);\n        \n        return detectionResults;\n    }\n    \n    /**\n     * ËøêË°åÂºÇÂ∏∏Ê£ÄÊµãÂô®\n     */\n    async runAnomalyDetector(detector) {\n        const anomalies = [];\n        \n        // Ëé∑ÂèñÊ£ÄÊµãÊï∞ÊçÆ\n        const detectionData = await this.getDetectionData(detector);\n        \n        switch (detector.algorithm) {\n            case 'z_score':\n                anomalies.push(...this.detectZScoreAnomalies(detectionData, detector.parameters));\n                break;\n            case 'moving_average_deviation':\n                anomalies.push(...this.detectTrendAnomalies(detectionData, detector.parameters));\n                break;\n            case 'isolation_forest':\n                anomalies.push(...this.detectPatternAnomalies(detectionData, detector.parameters));\n                break;\n            case 'rule_engine':\n                anomalies.push(...this.detectRuleViolations(detectionData, detector.parameters));\n                break;\n        }\n        \n        return anomalies.map(anomaly => ({\n            ...anomaly,\n            detector_id: detector.id,\n            detector_name: detector.name,\n            detected_at: new Date().toISOString()\n        }));\n    }\n    \n    /**\n     * Ê£ÄÊü•È¢ÑË≠¶Êù°‰ª∂\n     */\n    async checkAlertConditions() {\n        for (const [alertId, alertConfig] of this.alertConfigs) {\n            if (alertConfig.status !== 'active') continue;\n            \n            try {\n                const shouldTrigger = await this.evaluateAlertConditions(alertConfig);\n                \n                if (shouldTrigger) {\n                    await this.triggerAlert(alertConfig);\n                }\n                \n            } catch (error) {\n                logger.error(`È¢ÑË≠¶Êù°‰ª∂Ê£ÄÊü•Â§±Ë¥• ${alertId}:`, error);\n            }\n        }\n    }\n    \n    /**\n     * Êõ¥Êñ∞Ë¥®ÈáèÊåáÊ†á\n     */\n    async updateQualityMetrics(checkResults) {\n        const timestamp = new Date().toISOString();\n        \n        // Êõ¥Êñ∞Êï¥‰ΩìË¥®ÈáèËØÑÂàÜ\n        const overallScore = this.calculateOverallQualityScore(checkResults.quality_scores);\n        this.updateMetric('overall_quality_score', overallScore, timestamp);\n        \n        // Êõ¥Êñ∞ÂàÜÁ±ªË¥®ÈáèËØÑÂàÜ\n        for (const [category, scoreData] of Object.entries(checkResults.quality_scores)) {\n            const metricId = `${category}_data_quality`;\n            if (this.qualityMetrics.has(metricId)) {\n                this.updateMetric(metricId, scoreData.final_score, timestamp);\n            }\n        }\n        \n        // Êõ¥Êñ∞ÂºÇÂ∏∏Ê£ÄÊµãÁéá\n        const anomalyRate = this.calculateAnomalyDetectionRate();\n        this.updateMetric('anomaly_detection_rate', anomalyRate, timestamp);\n        \n        // Êõ¥Êñ∞Êï∞ÊçÆÊó∂ÊïàÊÄßËØÑÂàÜ\n        const freshnessScore = this.calculateDataFreshnessScore();\n        this.updateMetric('data_freshness_score', freshnessScore, timestamp);\n    }\n    \n    /**\n     * Êõ¥Êñ∞Âçï‰∏™ÊåáÊ†á\n     */\n    updateMetric(metricId, value, timestamp) {\n        const metric = this.qualityMetrics.get(metricId);\n        if (!metric) return;\n        \n        const previousValue = metric.current_value;\n        metric.current_value = value;\n        metric.last_updated = timestamp;\n        \n        // ËÆ°ÁÆóË∂ãÂäø\n        if (previousValue !== null && previousValue !== undefined) {\n            const change = value - previousValue;\n            if (Math.abs(change) < 0.01) {\n                metric.trend = 'stable';\n            } else if (change > 0) {\n                metric.trend = 'improving';\n            } else {\n                metric.trend = 'declining';\n            }\n        }\n        \n        // ‰øùÂ≠òÂéÜÂè≤ËÆ∞ÂΩï\n        metric.history.push({\n            value: value,\n            timestamp: timestamp\n        });\n        \n        // ‰øùÊåÅÂéÜÂè≤ËÆ∞ÂΩïÂú®ÂêàÁêÜËåÉÂõ¥ÂÜÖ\n        if (metric.history.length > 1000) {\n            metric.history = metric.history.slice(-1000);\n        }\n    }\n    \n    // ËæÖÂä©ÊñπÊ≥ïÂÆûÁé∞\n    async getTestData(dataSource) {\n        // Ê®°ÊãüËé∑ÂèñÊµãËØïÊï∞ÊçÆ\n        const sampleData = {\n            'ems_energy_data': [\n                {\n                    meter_id: 'M001',\n                    energy_type: 'electricity',\n                    consumption_amount: 1250.5,\n                    measurement_time: new Date(Date.now() - 60000).toISOString(),\n                    quality_flag: 'good'\n                },\n                {\n                    meter_id: 'M002',\n                    energy_type: 'natural_gas',\n                    consumption_amount: 850.2,\n                    measurement_time: new Date(Date.now() - 120000).toISOString(),\n                    quality_flag: 'good'\n                }\n            ],\n            'carbon_emissions': [\n                {\n                    emission_id: 'E001',\n                    emission_scope: 'scope1',\n                    emission_source: 'natural_gas',\n                    emission_amount: 125.8,\n                    calculation_time: new Date().toISOString(),\n                    calculation_method: 'emission_factor_method',\n                    data_quality_score: 0.95\n                }\n            ],\n            'mes_production_data': [\n                {\n                    enterprise_id: 'ENT001',\n                    product_code: 'PROD001',\n                    production_volume: 1000,\n                    production_date: new Date().toISOString().split('T')[0]\n                }\n            ],\n            'national_indicators': [\n                {\n                    indicator_id: 'IND001',\n                    indicator_type: 'carbon_intensity',\n                    indicator_value: 0.85,\n                    target_value: 0.90,\n                    calculation_date: new Date().toISOString().split('T')[0],\n                    compliance_status: 'compliant'\n                }\n            ]\n        };\n        \n        return sampleData[dataSource] || [];\n    }\n    \n    evaluateBusinessRule(rule, record) {\n        // ÁÆÄÂåñÁöÑ‰∏öÂä°ËßÑÂàôËØÑ‰º∞\n        try {\n            if (rule.includes('consumption_amount > 0')) {\n                return record.consumption_amount > 0;\n            }\n            if (rule.includes('measurement_time <= current_time')) {\n                const measurementTime = new Date(record.measurement_time).getTime();\n                const currentTime = Date.now();\n                return measurementTime <= currentTime + 300000; // 5ÂàÜÈíüÂÆπÈîô\n            }\n            return true;\n        } catch (error) {\n            return false;\n        }\n    }\n    \n    async detectOutliers(data, config) {\n        // ÁÆÄÂåñÁöÑÂºÇÂ∏∏ÂÄºÊ£ÄÊµã\n        if (data.length < config.min_samples) return 0;\n        \n        const values = data.map(d => d.consumption_amount || d.emission_amount || d.production_volume || 0);\n        const mean = values.reduce((a, b) => a + b, 0) / values.length;\n        const variance = values.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / values.length;\n        const stdDev = Math.sqrt(variance);\n        \n        let outliers = 0;\n        for (const value of values) {\n            const zScore = Math.abs((value - mean) / stdDev);\n            if (zScore > config.threshold) {\n                outliers++;\n            }\n        }\n        \n        return outliers;\n    }\n    \n    evaluateConsistencyRule(rule, record) {\n        // ÁÆÄÂåñÁöÑ‰∏ÄËá¥ÊÄßËßÑÂàôËØÑ‰º∞\n        try {\n            if (rule.includes('sum(sub_meters) == total_meter')) {\n                // Ê®°ÊãüÂ≠êË°®Ê±ÇÂíåÊ£ÄÊü•\n                return true;\n            }\n            if (rule.includes('energy_type matches meter_type')) {\n                // Ê®°ÊãüËÉΩÊ∫êÁ±ªÂûãÂåπÈÖçÊ£ÄÊü•\n                return true;\n            }\n            return true;\n        } catch (error) {\n            return false;\n        }\n    }\n    \n    async checkTemporalConsistency(data, config) {\n        // ÁÆÄÂåñÁöÑÊó∂Èó¥‰∏ÄËá¥ÊÄßÊ£ÄÊü•\n        let inconsistencies = 0;\n        \n        for (let i = 1; i < data.length; i++) {\n            const current = data[i].consumption_amount || data[i].emission_amount || 0;\n            const previous = data[i-1].consumption_amount || data[i-1].emission_amount || 0;\n            \n            if (previous > 0) {\n                const variance = Math.abs(current - previous) / previous;\n                if (variance > config.variance_threshold) {\n                    inconsistencies++;\n                }\n            }\n        }\n        \n        return inconsistencies;\n    }\n    \n    isValidCalculationMethod(method) {\n        const validMethods = [\n            'emission_factor_method',\n            'mass_balance_method',\n            'continuous_monitoring_method'\n        ];\n        return validMethods.includes(method);\n    }\n    \n    evaluateRegulatoryRequirement(requirement, record) {\n        // ÁÆÄÂåñÁöÑÁõëÁÆ°Ë¶ÅÊ±ÇËØÑ‰º∞\n        try {\n            if (requirement.includes('calculation_follows_national_standard')) {\n                return record.calculation_method === 'emission_factor_method';\n            }\n            if (requirement.includes('audit_trail_complete')) {\n                return record.calculation_method && record.data_source;\n            }\n            return true;\n        } catch (error)","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/core/services/ReportGenerator.js","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'CARBON_CONSTANTS' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":26},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":181,"column":44,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":181,"endColumn":51,"fix":{"range":[4729,4736],"text":"{return;}"}},{"ruleId":"no-unused-vars","severity":2,"message":"'options' is defined but never used. Allowed unused args must match /^_/u.","line":327,"column":44,"nodeType":"Identifier","messageId":"unusedVar","endLine":327,"endColumn":51},{"ruleId":"object-shorthand","severity":2,"message":"Expected property shorthand.","line":499,"column":7,"nodeType":"Property","messageId":"expectedPropertyShorthand","endLine":499,"endColumn":23,"fix":{"range":[13668,13684],"text":"content"}},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000000.","line":501,"column":40,"nodeType":"Literal","messageId":"noMagic","endLine":501,"endColumn":47},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500000.","line":501,"column":51,"nodeType":"Literal","messageId":"noMagic","endLine":501,"endColumn":57},{"ruleId":"no-unused-vars","severity":2,"message":"'options' is defined but never used. Allowed unused args must match /^_/u.","line":602,"column":47,"nodeType":"Identifier","messageId":"unusedVar","endLine":602,"endColumn":54},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 36.","line":627,"column":56,"nodeType":"Literal","messageId":"noMagic","endLine":627,"endColumn":58},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 9.","line":627,"column":70,"nodeType":"Literal","messageId":"noMagic","endLine":627,"endColumn":71},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5.","line":640,"column":52,"nodeType":"Literal","messageId":"noMagic","endLine":640,"endColumn":53},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":670,"column":34,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":670,"endColumn":43,"fix":{"range":[18216,18225],"text":"{return 0;}"}},{"ruleId":"no-unused-vars","severity":2,"message":"'carbonData' is defined but never used. Allowed unused args must match /^_/u.","line":676,"column":35,"nodeType":"Identifier","messageId":"unusedVar","endLine":676,"endColumn":45},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":701,"column":22,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":701,"endColumn":32,"fix":{"range":[19199,19209],"text":"{return [];}"}},{"ruleId":"curly","severity":2,"message":"Expected { after 'if' condition.","line":713,"column":60,"nodeType":"IfStatement","messageId":"missingCurlyAfterCondition","endLine":713,"endColumn":69,"fix":{"range":[19814,19823],"text":"{return 0;}"}},{"ruleId":"no-unused-vars","severity":2,"message":"'parkId' is defined but never used. Allowed unused args must match /^_/u.","line":741,"column":32,"nodeType":"Identifier","messageId":"unusedVar","endLine":741,"endColumn":38},{"ruleId":"no-unused-vars","severity":2,"message":"'timeRange' is defined but never used. Allowed unused args must match /^_/u.","line":741,"column":40,"nodeType":"Identifier","messageId":"unusedVar","endLine":741,"endColumn":49},{"ruleId":"no-unused-vars","severity":2,"message":"'parkId' is defined but never used. Allowed unused args must match /^_/u.","line":750,"column":31,"nodeType":"Identifier","messageId":"unusedVar","endLine":750,"endColumn":37},{"ruleId":"no-unused-vars","severity":2,"message":"'timeRange' is defined but never used. Allowed unused args must match /^_/u.","line":750,"column":39,"nodeType":"Identifier","messageId":"unusedVar","endLine":750,"endColumn":48}],"suppressedMessages":[],"errorCount":13,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":5,"fixableWarningCount":0,"source":"/**\n * Êô∫ËÉΩÁî≥Êä•È™åÊî∂ÊùêÊñôÁîüÊàêÂô®\n * Ëá™Âä®ÁîüÊàêÁ¨¶ÂêàÂõΩÂÆ∂Ê†áÂáÜÁöÑÈõ∂Á¢≥Âõ≠Âå∫Áî≥Êä•È™åÊî∂ÊùêÊñô\n * ÊîØÊåÅÂ§öÁßçÊ†ºÂºèËæìÂá∫ÂíåÊ®°ÊùøÂÆöÂà∂\n */\n\nimport { EventEmitter } from 'events';\nimport logger from '../../shared/utils/logger.js';\nimport { CARBON_CONSTANTS, MATH_CONSTANTS } from '../../shared/constants/MathConstants.js';\nimport NationalIndicatorDashboard from './NationalIndicatorDashboard.js';\nimport CarbonAccountingEngine from './CarbonAccountingEngine.js';\nimport EnergyFlowVisualization from './EnergyFlowVisualization.js';\n\nclass ReportGenerator extends EventEmitter {\n  constructor() {\n    super();\n    this.indicatorDashboard = new NationalIndicatorDashboard();\n    this.carbonEngine = new CarbonAccountingEngine();\n    this.energyFlowViz = new EnergyFlowVisualization();\n    this.reportTemplates = new Map();\n    this.generationQueue = [];\n    this.isProcessing = false;\n    \n    // Êä•ÂëäÊ®°ÊùøÈÖçÁΩÆ\n    this.templateConfig = {\n      // Áî≥Êä•ÊùêÊñôÊ®°Êùø\n      application: {\n        name: 'Èõ∂Á¢≥Âõ≠Âå∫Áî≥Êä•ÊùêÊñô',\n        sections: [\n          'basic_info',\n          'energy_system',\n          'carbon_accounting',\n          'indicator_analysis',\n          'technology_innovation',\n          'management_system',\n          'supporting_documents'\n        ],\n        format: ['pdf', 'docx', 'html']\n      },\n      \n      // È™åÊî∂ÊùêÊñôÊ®°Êùø\n      acceptance: {\n        name: 'Èõ∂Á¢≥Âõ≠Âå∫È™åÊî∂ÊùêÊñô',\n        sections: [\n          'implementation_summary',\n          'indicator_achievement',\n          'carbon_neutrality_proof',\n          'energy_flow_analysis',\n          'performance_evaluation',\n          'continuous_improvement',\n          'certification_evidence'\n        ],\n        format: ['pdf', 'docx', 'html']\n      },\n      \n      // ÁõëÊµãÊä•ÂëäÊ®°Êùø\n      monitoring: {\n        name: 'Èõ∂Á¢≥Âõ≠Âå∫ÁõëÊµãÊä•Âëä',\n        sections: [\n          'monitoring_overview',\n          'real_time_indicators',\n          'trend_analysis',\n          'alert_summary',\n          'recommendations',\n          'data_quality_report'\n        ],\n        format: ['pdf', 'html', 'excel']\n      }\n    };\n    \n    this.init();\n  }\n\n  async init() {\n    try {\n      await this.loadReportTemplates();\n      this.startProcessingQueue();\n      logger.info('Êô∫ËÉΩÁî≥Êä•È™åÊî∂ÊùêÊñôÁîüÊàêÂô®ÂàùÂßãÂåñÂÆåÊàê');\n      this.emit('generator_initialized');\n    } catch (error) {\n      logger.error('Áî≥Êä•È™åÊî∂ÊùêÊñôÁîüÊàêÂô®ÂàùÂßãÂåñÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Âä†ËΩΩÊä•ÂëäÊ®°Êùø\n   */\n  async loadReportTemplates() {\n    try {\n      // Âä†ËΩΩÁî≥Êä•ÊùêÊñôÊ®°Êùø\n      this.reportTemplates.set('application', {\n        ...this.templateConfig.application,\n        template_content: await this.getApplicationTemplate()\n      });\n      \n      // Âä†ËΩΩÈ™åÊî∂ÊùêÊñôÊ®°Êùø\n      this.reportTemplates.set('acceptance', {\n        ...this.templateConfig.acceptance,\n        template_content: await this.getAcceptanceTemplate()\n      });\n      \n      // Âä†ËΩΩÁõëÊµãÊä•ÂëäÊ®°Êùø\n      this.reportTemplates.set('monitoring', {\n        ...this.templateConfig.monitoring,\n        template_content: await this.getMonitoringTemplate()\n      });\n      \n      logger.info('Êä•ÂëäÊ®°ÊùøÂä†ËΩΩÂÆåÊàê');\n    } catch (error) {\n      logger.error('Âä†ËΩΩÊä•ÂëäÊ®°ÊùøÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * ÁîüÊàêÁî≥Êä•È™åÊî∂ÊùêÊñô\n   * @param {string} parkId - Âõ≠Âå∫ID\n   * @param {string} reportType - Êä•ÂëäÁ±ªÂûã (application/acceptance/monitoring)\n   * @param {Object} options - ÁîüÊàêÈÄâÈ°π\n   * @returns {Promise<Object>} ÁîüÊàêÁªìÊûú\n   */\n  async generateReport(parkId, reportType, options = {}) {\n    try {\n      const reportId = this.generateReportId();\n      \n      // Ê∑ªÂä†Âà∞ÁîüÊàêÈòüÂàó\n      const reportTask = {\n        id: reportId,\n        park_id: parkId,\n        type: reportType,\n        options: {\n          format: options.format || 'pdf',\n          language: options.language || 'zh-CN',\n          include_charts: options.include_charts !== false,\n          include_raw_data: options.include_raw_data || false,\n          time_range: options.time_range || '1y',\n          ...options\n        },\n        status: 'queued',\n        created_at: new Date().toISOString()\n      };\n      \n      this.generationQueue.push(reportTask);\n      \n      // ÂèëÈÄÅ‰ªªÂä°ÂàõÂª∫‰∫ã‰ª∂\n      this.emit('report_task_created', {\n        report_id: reportId,\n        park_id: parkId,\n        type: reportType\n      });\n      \n      logger.info(`Êä•ÂëäÁîüÊàê‰ªªÂä°Â∑≤ÂàõÂª∫: ${reportId}`);\n      \n      return {\n        report_id: reportId,\n        status: 'queued',\n        estimated_completion: this.estimateCompletionTime(reportType)\n      };\n    } catch (error) {\n      logger.error('ÂàõÂª∫Êä•ÂëäÁîüÊàê‰ªªÂä°Â§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Â§ÑÁêÜÁîüÊàêÈòüÂàó\n   */\n  startProcessingQueue() {\n    setInterval(async () => {\n      if (!this.isProcessing && this.generationQueue.length > 0) {\n        await this.processNextReport();\n      }\n    }, MATH_CONSTANTS.FIVE * MATH_CONSTANTS.MILLISECONDS_PER_SECOND);\n  }\n\n  /**\n   * Â§ÑÁêÜ‰∏ã‰∏Ä‰∏™Êä•Âëä\n   */\n  async processNextReport() {\n    if (this.generationQueue.length === 0) return;\n    \n    this.isProcessing = true;\n    const task = this.generationQueue.shift();\n    \n    try {\n      task.status = 'processing';\n      task.started_at = new Date().toISOString();\n      \n      this.emit('report_generation_started', {\n        report_id: task.id,\n        park_id: task.park_id\n      });\n      \n      // Êî∂ÈõÜÊï∞ÊçÆ\n      const reportData = await this.collectReportData(task.park_id, task.type, task.options);\n      \n      // ÁîüÊàêÊä•ÂëäÂÜÖÂÆπ\n      const reportContent = await this.generateReportContent(task.type, reportData, task.options);\n      \n      // Ê†ºÂºèÂåñËæìÂá∫\n      const formattedReport = await this.formatReport(reportContent, task.options.format);\n      \n      // ‰øùÂ≠òÊä•Âëä\n      const savedReport = await this.saveReport(task.id, formattedReport, task.options);\n      \n      task.status = 'completed';\n      task.completed_at = new Date().toISOString();\n      task.result = savedReport;\n      \n      this.emit('report_generation_completed', {\n        report_id: task.id,\n        park_id: task.park_id,\n        result: savedReport\n      });\n      \n      logger.info(`Êä•ÂëäÁîüÊàêÂÆåÊàê: ${task.id}`);\n      \n    } catch (error) {\n      task.status = 'failed';\n      task.error = error.message;\n      task.failed_at = new Date().toISOString();\n      \n      this.emit('report_generation_failed', {\n        report_id: task.id,\n        park_id: task.park_id,\n        error: error.message\n      });\n      \n      logger.error(`Êä•ÂëäÁîüÊàêÂ§±Ë¥•: ${task.id}`, error);\n    } finally {\n      this.isProcessing = false;\n    }\n  }\n\n  /**\n   * Êî∂ÈõÜÊä•ÂëäÊï∞ÊçÆ\n   */\n  async collectReportData(parkId, reportType, options) {\n    try {\n      const timeRange = options.time_range || '1y';\n      \n      // Âü∫Á°ÄÊï∞ÊçÆ\n      const baseData = {\n        park_info: await this.getParkBasicInfo(parkId),\n        generation_time: new Date().toISOString(),\n        time_range: timeRange,\n        report_type: reportType\n      };\n      \n      // ÂõΩÂÆ∂ÊåáÊ†áÊï∞ÊçÆ\n      const indicators = this.indicatorDashboard.getParkIndicators(parkId);\n      if (indicators) {\n        baseData.national_indicators = indicators;\n      }\n      \n      // Á¢≥ÊéíÊîæÊï∞ÊçÆ\n      const carbonData = await this.carbonEngine.calculateParkTotalEmissions(parkId, timeRange);\n      baseData.carbon_accounting = carbonData;\n      \n      // ËÉΩÊ∫êÊµÅÂêëÊï∞ÊçÆ\n      if (options.include_energy_flow !== false) {\n        const energyFlowData = await this.energyFlowViz.generateEnergyFlowMap(parkId, timeRange);\n        baseData.energy_flow = energyFlowData;\n      }\n      \n      // Ê†πÊçÆÊä•ÂëäÁ±ªÂûãÊî∂ÈõÜÁâπÂÆöÊï∞ÊçÆ\n      switch (reportType) {\n        case 'application':\n          baseData.application_specific = await this.collectApplicationData(parkId, timeRange);\n          break;\n        case 'acceptance':\n          baseData.acceptance_specific = await this.collectAcceptanceData(parkId, timeRange);\n          break;\n        case 'monitoring':\n          baseData.monitoring_specific = await this.collectMonitoringData(parkId, timeRange);\n          break;\n      }\n      \n      return baseData;\n    } catch (error) {\n      logger.error('Êî∂ÈõÜÊä•ÂëäÊï∞ÊçÆÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * ÁîüÊàêÊä•ÂëäÂÜÖÂÆπ\n   */\n  async generateReportContent(reportType, data, options) {\n    try {\n      const template = this.reportTemplates.get(reportType);\n      if (!template) {\n        throw new Error(`Êú™ÊâæÂà∞Êä•ÂëäÊ®°Êùø: ${reportType}`);\n      }\n      \n      const content = {\n        title: template.name,\n        subtitle: `${data.park_info.name} - ${new Date().getFullYear()}Âπ¥Â∫¶`,\n        generation_date: new Date().toLocaleDateString('zh-CN'),\n        sections: []\n      };\n      \n      // ÁîüÊàêÂêÑ‰∏™Á´†ËäÇ\n      for (const sectionName of template.sections) {\n        const section = await this.generateSection(sectionName, data, options);\n        if (section) {\n          content.sections.push(section);\n        }\n      }\n      \n      // Ê∑ªÂä†ÈôÑÂΩï\n      if (options.include_raw_data) {\n        content.sections.push(await this.generateDataAppendix(data));\n      }\n      \n      return content;\n    } catch (error) {\n      logger.error('ÁîüÊàêÊä•ÂëäÂÜÖÂÆπÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * ÁîüÊàêÊä•ÂëäÁ´†ËäÇ\n   */\n  async generateSection(sectionName, data, options) {\n    try {\n      switch (sectionName) {\n        case 'basic_info':\n          return this.generateBasicInfoSection(data);\n        case 'energy_system':\n          return this.generateEnergySystemSection(data);\n        case 'carbon_accounting':\n          return this.generateCarbonAccountingSection(data);\n        case 'indicator_analysis':\n          return this.generateIndicatorAnalysisSection(data);\n        case 'implementation_summary':\n          return this.generateImplementationSummarySection(data);\n        case 'indicator_achievement':\n          return this.generateIndicatorAchievementSection(data);\n        case 'monitoring_overview':\n          return this.generateMonitoringOverviewSection(data);\n        case 'real_time_indicators':\n          return this.generateRealTimeIndicatorsSection(data);\n        default:\n          logger.warn(`Êú™Áü•Á´†ËäÇÁ±ªÂûã: ${sectionName}`);\n          return null;\n      }\n    } catch (error) {\n      logger.error(`ÁîüÊàêÁ´†ËäÇ ${sectionName} Â§±Ë¥•:`, error);\n      return {\n        title: sectionName,\n        content: `ÁîüÊàêÁ´†ËäÇÊó∂ÂèëÁîüÈîôËØØ: ${error.message}`,\n        error: true\n      };\n    }\n  }\n\n  /**\n   * ÁîüÊàêÂü∫Êú¨‰ø°ÊÅØÁ´†ËäÇ\n   */\n  generateBasicInfoSection(data) {\n    return {\n      title: '1. Âõ≠Âå∫Âü∫Êú¨‰ø°ÊÅØ',\n      content: {\n        park_name: data.park_info.name,\n        location: data.park_info.location,\n        area: data.park_info.area,\n        establishment_date: data.park_info.establishment_date,\n        main_industries: data.park_info.main_industries,\n        enterprise_count: data.park_info.enterprise_count,\n        employee_count: data.park_info.employee_count,\n        annual_output_value: data.park_info.annual_output_value\n      },\n      charts: []\n    };\n  }\n\n  /**\n   * ÁîüÊàêËÉΩÊ∫êÁ≥ªÁªüÁ´†ËäÇ\n   */\n  generateEnergySystemSection(data) {\n    const energyFlow = data.energy_flow;\n    return {\n      title: '2. ËÉΩÊ∫êÁ≥ªÁªüÂàÜÊûê',\n      content: {\n        energy_infrastructure: energyFlow?.infrastructure,\n        energy_statistics: energyFlow?.statistics,\n        energy_efficiency: this.calculateEnergyEfficiency(energyFlow),\n        renewable_energy_ratio: energyFlow?.statistics?.renewable_ratio\n      },\n      charts: [\n        {\n          type: 'sankey',\n          title: 'Âõ≠Âå∫ËÉΩÊ∫êÊµÅÂêëÂõæ',\n          data: energyFlow?.sankey_data\n        },\n        {\n          type: 'pie',\n          title: 'ËÉΩÊ∫êÊ∂àË¥πÁªìÊûÑ',\n          data: energyFlow?.statistics?.breakdown?.by_source\n        }\n      ]\n    };\n  }\n\n  /**\n   * ÁîüÊàêÁ¢≥Ê†∏ÁÆóÁ´†ËäÇ\n   */\n  generateCarbonAccountingSection(data) {\n    const carbonData = data.carbon_accounting;\n    return {\n      title: '3. Á¢≥ÊéíÊîæÊ†∏ÁÆó',\n      content: {\n        total_emissions: carbonData.total_emissions,\n        scope1_emissions: carbonData.scope1_emissions,\n        scope2_emissions: carbonData.scope2_emissions,\n        emission_sources: carbonData.emission_sources,\n        carbon_intensity: data.national_indicators?.carbon_intensity,\n        carbon_reduction_measures: this.generateCarbonReductionMeasures(carbonData)\n      },\n      charts: [\n        {\n          type: 'bar',\n          title: 'Á¢≥ÊéíÊîæÊ∫êÂàÜÊûê',\n          data: carbonData.emission_sources\n        },\n        {\n          type: 'line',\n          title: 'Á¢≥ÊéíÊîæË∂ãÂäø',\n          data: carbonData.historical_data\n        }\n      ]\n    };\n  }\n\n  /**\n   * ÁîüÊàêÊåáÊ†áÂàÜÊûêÁ´†ËäÇ\n   */\n  generateIndicatorAnalysisSection(data) {\n    const indicators = data.national_indicators;\n    return {\n      title: '4. ÂõΩÂÆ∂ÊåáÊ†á‰ΩìÁ≥ªÂàÜÊûê',\n      content: {\n        compliance_status: indicators?.compliance_status,\n        core_indicators: {\n          carbon_intensity: indicators?.carbon_intensity,\n          clean_energy_ratio: indicators?.clean_energy_ratio\n        },\n        guidance_indicators: {\n          solid_waste_utilization: indicators?.solid_waste_utilization,\n          waste_energy_utilization: indicators?.waste_energy_utilization,\n          water_reuse_ratio: indicators?.water_reuse_ratio\n        },\n        data_quality: indicators?.data_quality_score,\n        improvement_recommendations: this.generateImprovementRecommendations(indicators)\n      },\n      charts: [\n        {\n          type: 'radar',\n          title: 'ÊåáÊ†áËææÊàêÊÉÖÂÜµ',\n          data: this.formatIndicatorsForRadarChart(indicators)\n        }\n      ]\n    };\n  }\n\n  /**\n   * Ê†ºÂºèÂåñÊä•Âëä\n   */\n  async formatReport(content, format) {\n    try {\n      switch (format.toLowerCase()) {\n        case 'pdf':\n          return await this.generatePDF(content);\n        case 'docx':\n          return await this.generateDOCX(content);\n        case 'html':\n          return await this.generateHTML(content);\n        case 'excel':\n          return await this.generateExcel(content);\n        default:\n          throw new Error(`‰∏çÊîØÊåÅÁöÑÊ†ºÂºè: ${format}`);\n      }\n    } catch (error) {\n      logger.error('Ê†ºÂºèÂåñÊä•ÂëäÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * ÁîüÊàêPDFÊ†ºÂºè\n   */\n  async generatePDF(content) {\n    // TODO: ÂÆûÁé∞PDFÁîüÊàêÈÄªËæë\n    return {\n      format: 'pdf',\n      content: content,\n      file_path: `/reports/pdf/${this.generateReportId()}.pdf`,\n      size: Math.floor(Math.random() * 1000000) + 500000 // Ê®°ÊãüÊñá‰ª∂Â§ßÂ∞è\n    };\n  }\n\n  /**\n   * ÁîüÊàêHTMLÊ†ºÂºè\n   */\n  async generateHTML(content) {\n    const html = this.convertToHTML(content);\n    return {\n      format: 'html',\n      content: html,\n      file_path: `/reports/html/${this.generateReportId()}.html`,\n      size: html.length\n    };\n  }\n\n  /**\n   * ËΩ¨Êç¢‰∏∫HTML\n   */\n  convertToHTML(content) {\n    let html = `\n    <!DOCTYPE html>\n    <html lang=\"zh-CN\">\n    <head>\n        <meta charset=\"UTF-8\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n        <title>${content.title}</title>\n        <style>\n            body { font-family: 'Microsoft YaHei', Arial, sans-serif; margin: 40px; line-height: 1.6; }\n            .header { text-align: center; margin-bottom: 40px; }\n            .section { margin-bottom: 30px; }\n            .section-title { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; }\n            .content-table { width: 100%; border-collapse: collapse; margin: 20px 0; }\n            .content-table th, .content-table td { border: 1px solid #ddd; padding: 12px; text-align: left; }\n            .content-table th { background-color: #f2f2f2; }\n            .chart-placeholder { background-color: #f8f9fa; border: 1px dashed #dee2e6; padding: 40px; text-align: center; margin: 20px 0; }\n        </style>\n    </head>\n    <body>\n        <div class=\"header\">\n            <h1>${content.title}</h1>\n            <h2>${content.subtitle}</h2>\n            <p>ÁîüÊàêÊó•Êúü: ${content.generation_date}</p>\n        </div>\n    `;\n    \n    content.sections.forEach(section => {\n      html += `\n        <div class=\"section\">\n            <h2 class=\"section-title\">${section.title}</h2>\n            ${this.formatSectionContent(section.content)}\n            ${this.formatCharts(section.charts || [])}\n        </div>\n      `;\n    });\n    \n    html += `\n    </body>\n    </html>\n    `;\n    \n    return html;\n  }\n\n  /**\n   * Ê†ºÂºèÂåñÁ´†ËäÇÂÜÖÂÆπ\n   */\n  formatSectionContent(content) {\n    if (typeof content === 'string') {\n      return `<p>${content}</p>`;\n    }\n    \n    if (typeof content === 'object') {\n      let html = '<table class=\"content-table\">';\n      for (const [key, value] of Object.entries(content)) {\n        html += `<tr><td><strong>${this.formatFieldName(key)}</strong></td><td>${this.formatFieldValue(value)}</td></tr>`;\n      }\n      html += '</table>';\n      return html;\n    }\n    \n    return '<p>Êó†ÂÜÖÂÆπ</p>';\n  }\n\n  /**\n   * Ê†ºÂºèÂåñÂõæË°®\n   */\n  formatCharts(charts) {\n    return charts.map(chart => \n      `<div class=\"chart-placeholder\">\n        <h3>${chart.title}</h3>\n        <p>ÂõæË°®Á±ªÂûã: ${chart.type}</p>\n        <p>Ê≠§Â§ÑÂ∫îÊòæÁ§∫ ${chart.title} ÂõæË°®</p>\n      </div>`\n    ).join('');\n  }\n\n  /**\n   * ‰øùÂ≠òÊä•Âëä\n   */\n  async saveReport(reportId, formattedReport, options) {\n    try {\n      // TODO: ÂÆûÁé∞ÂÆûÈôÖÁöÑÊñá‰ª∂‰øùÂ≠òÈÄªËæë\n      const savedReport = {\n        report_id: reportId,\n        file_path: formattedReport.file_path,\n        format: formattedReport.format,\n        size: formattedReport.size,\n        created_at: new Date().toISOString(),\n        download_url: `/api/reports/download/${reportId}`,\n        preview_url: formattedReport.format === 'html' ? `/api/reports/preview/${reportId}` : null\n      };\n      \n      logger.info(`Êä•ÂëäÂ∑≤‰øùÂ≠ò: ${reportId}`);\n      return savedReport;\n    } catch (error) {\n      logger.error('‰øùÂ≠òÊä•ÂëäÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * ÁîüÊàêÊä•ÂëäID\n   */\n  generateReportId() {\n    return `RPT_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n  }\n\n  /**\n   * ‰º∞ÁÆóÂÆåÊàêÊó∂Èó¥\n   */\n  estimateCompletionTime(reportType) {\n    const estimateMinutes = {\n      application: 10,\n      acceptance: 8,\n      monitoring: 5\n    };\n    \n    const minutes = estimateMinutes[reportType] || 5;\n    const completionTime = new Date();\n    completionTime.setMinutes(completionTime.getMinutes() + minutes);\n    \n    return completionTime.toISOString();\n  }\n\n  // ËæÖÂä©ÊñπÊ≥ï\n  formatFieldName(key) {\n    const nameMap = {\n      park_name: 'Âõ≠Âå∫ÂêçÁß∞',\n      location: 'Âú∞ÁêÜ‰ΩçÁΩÆ',\n      area: 'Âç†Âú∞Èù¢ÁßØ',\n      establishment_date: 'ÊàêÁ´ãÊó•Êúü',\n      main_industries: '‰∏ªË¶Å‰∫ß‰∏ö',\n      enterprise_count: '‰ºÅ‰∏öÊï∞Èáè',\n      employee_count: 'ÂëòÂ∑•Êï∞Èáè',\n      annual_output_value: 'Âπ¥‰∫ßÂÄº'\n    };\n    return nameMap[key] || key;\n  }\n\n  formatFieldValue(value) {\n    if (typeof value === 'object' && value !== null) {\n      return JSON.stringify(value, null, 2);\n    }\n    return String(value);\n  }\n\n  calculateEnergyEfficiency(energyFlow) {\n    if (!energyFlow?.statistics) return 0;\n    const stats = energyFlow.statistics;\n    return stats.total_generation > 0 ? \n      (stats.total_consumption / stats.total_generation * MATH_CONSTANTS.ONE_HUNDRED).toFixed(MATH_CONSTANTS.DECIMAL_PLACES) : 0;\n  }\n\n  generateCarbonReductionMeasures(carbonData) {\n    return [\n      'Êé®ÂπøÂèØÂÜçÁîüËÉΩÊ∫êÂà©Áî®',\n      'ÊèêÂçáËÉΩÊ∫êÂà©Áî®ÊïàÁéá',\n      '‰ºòÂåñÂ∑•‰∏öËøáÁ®ã',\n      'Âä†Âº∫Á¢≥Ê±áÂª∫ËÆæ',\n      'ÂÆûÊñΩÂæ™ÁéØÁªèÊµéÊ®°Âºè'\n    ];\n  }\n\n  generateImprovementRecommendations(indicators) {\n    const recommendations = [];\n    \n    if (indicators?.carbon_intensity?.status === 'warning' || indicators?.carbon_intensity?.status === 'critical') {\n      recommendations.push('Âª∫ËÆÆÂä†Âº∫ËÉΩÊ∫êÁªìÊûÑ‰ºòÂåñÔºåÊèêÈ´òÊ∏ÖÊ¥ÅËÉΩÊ∫êÊØî‰æã');\n    }\n    \n    if (indicators?.clean_energy_ratio?.status === 'warning' || indicators?.clean_energy_ratio?.status === 'critical') {\n      recommendations.push('Âª∫ËÆÆÂ¢ûÂä†ÂèØÂÜçÁîüËÉΩÊ∫êË£ÖÊú∫ÂÆπÈáè');\n    }\n    \n    return recommendations.length > 0 ? recommendations : ['ÂΩìÂâçÂêÑÈ°πÊåáÊ†áË°®Áé∞ËâØÂ•ΩÔºåÂª∫ËÆÆÁªßÁª≠‰øùÊåÅ'];\n  }\n\n  formatIndicatorsForRadarChart(indicators) {\n    if (!indicators) return [];\n    \n    return [\n      { indicator: 'Âçï‰ΩçËÉΩËÄóÁ¢≥ÊéíÊîæ', value: this.getIndicatorScore(indicators.carbon_intensity) },\n      { indicator: 'Ê∏ÖÊ¥ÅËÉΩÊ∫êÊ∂àË¥πÂç†ÊØî', value: this.getIndicatorScore(indicators.clean_energy_ratio) },\n      { indicator: 'Â∑•‰∏öÂõ∫Â∫üÁªºÂêàÂà©Áî®Áéá', value: this.getIndicatorScore(indicators.solid_waste_utilization) },\n      { indicator: '‰ΩôËÉΩÁªºÂêàÂà©Áî®Áéá', value: this.getIndicatorScore(indicators.waste_energy_utilization) },\n      { indicator: 'Â∑•‰∏öÁî®Ê∞¥ÈáçÂ§çÂà©Áî®Áéá', value: this.getIndicatorScore(indicators.water_reuse_ratio) }\n    ];\n  }\n\n  getIndicatorScore(indicator) {\n    if (!indicator || typeof indicator.value !== 'number') return 0;\n    \n    const statusScores = {\n      excellent: 100,\n      good: 80,\n      warning: 60,\n      critical: 40,\n      error: 0\n    };\n    \n    return statusScores[indicator.status] || 0;\n  }\n\n  // Ê®°ÊãüÊï∞ÊçÆËé∑ÂèñÊñπÊ≥ï\n  async getParkBasicInfo(parkId) {\n    return {\n      id: parkId,\n      name: 'Á§∫‰æãÈõ∂Á¢≥Âõ≠Âå∫',\n      location: 'ÊüêÁúÅÊüêÂ∏ÇÊüêÂå∫',\n      area: '10.5Âπ≥ÊñπÂÖ¨Èáå',\n      establishment_date: '2020-01-01',\n      main_industries: ['Êñ∞ËÉΩÊ∫ê', 'ÁîµÂ≠ê‰ø°ÊÅØ', 'ÁîüÁâ©ÂåªËçØ'],\n      enterprise_count: 156,\n      employee_count: 12500,\n      annual_output_value: '280‰∫øÂÖÉ'\n    };\n  }\n\n  async collectApplicationData(parkId, timeRange) {\n    return {\n      application_date: new Date().toISOString(),\n      application_type: 'ÂõΩÂÆ∂Á∫ßÈõ∂Á¢≥Âõ≠Âå∫',\n      supporting_policies: ['Á¢≥ËææÂ≥∞Á¢≥‰∏≠ÂíåÊîøÁ≠ñ', 'ÂèØÂÜçÁîüËÉΩÊ∫êÊîøÁ≠ñ'],\n      investment_summary: 'ÊÄªÊäïËµÑ50‰∫øÂÖÉÔºåÂÖ∂‰∏≠ÁªøËâ≤ÊäïËµÑÂç†ÊØî80%'\n    };\n  }\n\n  async collectAcceptanceData(parkId, timeRange) {\n    return {\n      acceptance_date: new Date().toISOString(),\n      implementation_period: '2020-2024',\n      key_achievements: ['Á¢≥ÊéíÊîæÂº∫Â∫¶‰∏ãÈôç40%', 'Ê∏ÖÊ¥ÅËÉΩÊ∫êÂç†ÊØîËææÂà∞85%'],\n      certification_status: 'Á¨¶ÂêàÈ™åÊî∂Ê†áÂáÜ'\n    };\n  }\n\n  async collectMonitoringData(parkId, timeRange) {\n    return {\n      monitoring_period: timeRange,\n      monitoring_frequency: 'ÂÆûÊó∂ÁõëÊµã',\n      data_sources: ['Êô∫ËÉΩÁîµË°®', 'ÁéØÂ¢ÉÁõëÊµãÁ´ô', '‰ºÅ‰∏ö‰∏äÊä•'],\n      monitoring_coverage: '100%'\n    };\n  }\n\n  // Ëé∑ÂèñÊ®°ÊùøÂÜÖÂÆπÁöÑÊñπÊ≥ï\n  async getApplicationTemplate() {\n    return {\n      header: 'Èõ∂Á¢≥Âõ≠Âå∫Áî≥Êä•ÊùêÊñôÊ®°Êùø',\n      sections: this.templateConfig.application.sections\n    };\n  }\n\n  async getAcceptanceTemplate() {\n    return {\n      header: 'Èõ∂Á¢≥Âõ≠Âå∫È™åÊî∂ÊùêÊñôÊ®°Êùø',\n      sections: this.templateConfig.acceptance.sections\n    };\n  }\n\n  async getMonitoringTemplate() {\n    return {\n      header: 'Èõ∂Á¢≥Âõ≠Âå∫ÁõëÊµãÊä•ÂëäÊ®°Êùø',\n      sections: this.templateConfig.monitoring.sections\n    };\n  }\n\n  /**\n   * ÈîÄÊØÅÂÆû‰æã\n   */\n  dispose() {\n    this.generationQueue = [];\n    this.reportTemplates.clear();\n    this.removeAllListeners();\n  }\n}\n\nexport default ReportGenerator;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/core/services/ResourceCirculationCenter.js","messages":[{"ruleId":null,"fatal":true,"severity":2,"message":"Parsing error: Unexpected token Requirements","line":244,"column":55,"nodeType":null}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * ËµÑÊ∫êÂæ™ÁéØÂà©Áî®‰∏éÂõ∫Â∫üËøΩÊ∫Ø‰∏≠ÂøÉ\n * ÂÆûÁé∞Âõ∫Â∫üÂÖ®ÁîüÂëΩÂë®ÊúüÁÆ°ÁêÜ„ÄÅËµÑÊ∫êÂæ™ÁéØÂà©Áî®‰ºòÂåñÂíåËøΩÊ∫Ø‰ΩìÁ≥ª\n * ÊîØÊåÅÂõ∫Â∫üÂàÜÁ±ª„ÄÅÂ§ÑÁêÜ„ÄÅÂõûÊî∂„ÄÅÂÜçÂà©Áî®ÂÖ®ÊµÅÁ®ãÁÆ°ÁêÜ\n */\n\nimport { EventEmitter } from 'events';\nimport logger from '../../shared/utils/logger.js';\nimport { MATH_CONSTANTS } from '../../shared/constants/MathConstants.js';\n\nclass ResourceCirculationCenter extends EventEmitter {\n  constructor() {\n    super();\n    this.isInitialized = false;\n    this.wasteCategories = new Map();\n    this.recyclingProcesses = new Map();\n    this.resourceFlows = new Map();\n    this.traceabilityRecords = new Map();\n    this.circularityMetrics = new Map();\n    this.optimizationResults = new Map();\n    \n    // Âõ∫Â∫üÂàÜÁ±ªÊ†áÂáÜ\n    this.wasteClassification = {\n      hazardous: {\n        name: 'Âç±Èô©Â∫üÁâ©',\n        code: 'HW',\n        description: 'ÂÖ∑ÊúâËÖêËöÄÊÄß„ÄÅÊØíÊÄß„ÄÅÊòìÁáÉÊÄß„ÄÅÂèçÂ∫îÊÄßÊàñÊÑüÊüìÊÄßÁ≠âÂç±Èô©ÁâπÊÄßÁöÑÂ∫üÁâ©',\n        subcategories: {\n          'HW01': 'ÂåªÁñóÂ∫üÁâ©',\n          'HW02': 'ÂåªËçØÂ∫üÁâ©',\n          'HW03': 'Â∫üËçØÁâ©„ÄÅËçØÂìÅ',\n          'HW04': 'ÂÜúËçØÂ∫üÁâ©',\n          'HW05': 'Êú®ÊùêÈò≤ËÖêÂâÇÂ∫üÁâ©',\n          'HW06': 'Â∫üÊúâÊú∫Ê∫∂ÂâÇ‰∏éÂê´ÊúâÊú∫Ê∫∂ÂâÇÂ∫üÁâ©',\n          'HW07': 'ÁÉ≠Â§ÑÁêÜÂê´Ê∞∞Â∫üÁâ©',\n          'HW08': 'Â∫üÁüøÁâ©Ê≤π‰∏éÂê´ÁüøÁâ©Ê≤πÂ∫üÁâ©'\n        },\n        disposal_requirements: {\n          collection: '‰∏ìÁî®ÂÆπÂô®Êî∂ÈõÜ',\n          storage: 'Âç±Â∫üÊöÇÂ≠òÈó¥Â≠òÊîæ',\n          transport: 'Âç±Â∫üËøêËæìËµÑË¥®Âçï‰Ωç',\n          disposal: 'ÊúâËµÑË¥®Â§ÑÁΩÆÂçï‰ΩçÂ§ÑÁêÜ'\n        }\n      },\n      recyclable: {\n        name: 'ÂèØÂõûÊî∂Áâ©',\n        code: 'RC',\n        description: 'ÈÄÇÂÆúÂõûÊî∂ÂíåËµÑÊ∫êÂåñÂà©Áî®ÁöÑÂ∫üÁâ©',\n        subcategories: {\n          'RC01': 'Â∫üÁ∫∏Á±ª',\n          'RC02': 'Â∫üÂ°ëÊñô',\n          'RC03': 'Â∫üÈáëÂ±û',\n          'RC04': 'Â∫üÁéªÁíÉ',\n          'RC05': 'Â∫üÁªáÁâ©',\n          'RC06': 'Â∫üÁîµÂô®ÁîµÂ≠ê‰∫ßÂìÅ',\n          'RC07': 'Â∫üÂåÖË£ÖÁâ©'\n        },\n        recycling_potential: {\n          'RC01': { rate: 0.85, value: 800 }, // ÂõûÊî∂ÁéáÂíå‰ª∑ÂÄº(ÂÖÉ/Âê®)\n          'RC02': { rate: 0.75, value: 1200 },\n          'RC03': { rate: 0.90, value: 2500 },\n          'RC04': { rate: 0.80, value: 300 },\n          'RC05': { rate: 0.60, value: 500 },\n          'RC06': { rate: 0.70, value: 3000 },\n          'RC07': { rate: 0.85, value: 600 }\n        }\n      },\n      organic: {\n        name: 'ÊúâÊú∫Â∫üÁâ©',\n        code: 'OR',\n        description: 'ÂèØÁîüÁâ©ÈôçËß£ÁöÑÊúâÊú∫Â∫üÁâ©',\n        subcategories: {\n          'OR01': 'È§êÂé®ÂûÉÂúæ',\n          'OR02': 'Âõ≠ÊûóÁªøÂåñÂûÉÂúæ',\n          'OR03': 'ÂÜú‰∏öÂ∫üÂºÉÁâ©',\n          'OR04': 'È£üÂìÅÂä†Â∑•Â∫üÊñô'\n        },\n        treatment_options: {\n          composting: { efficiency: 0.8, product: 'organic_fertilizer' },\n          anaerobic_digestion: { efficiency: 0.75, product: 'biogas' },\n          feed_production: { efficiency: 0.6, product: 'animal_feed' }\n        }\n      },\n      inert: {\n        name: 'ÊÉ∞ÊÄßÂ∫üÁâ©',\n        code: 'IN',\n        description: 'Âª∫Á≠ëÂûÉÂúæÁ≠âÊÉ∞ÊÄßÂ∫üÁâ©',\n        subcategories: {\n          'IN01': 'Ê∑∑ÂáùÂúüÂ∫üÊñô',\n          'IN02': 'Á†ñÁì¶Â∫üÊñô',\n          'IN03': 'Áü≥ÊùêÂ∫üÊñô',\n          'IN04': 'Ê≤•ÈùíÂ∫üÊñô'\n        },\n        utilization_options: {\n          aggregate_production: { efficiency: 0.9, product: 'recycled_aggregate' },\n          road_base: { efficiency: 0.85, product: 'road_material' },\n          backfill: { efficiency: 0.95, product: 'fill_material' }\n        }\n      }\n    };\n    \n    // Âæ™ÁéØÁªèÊµéÊåáÊ†á\n    this.circularityIndicators = {\n      material_circularity: {\n        name: 'Áâ©Ë¥®Âæ™ÁéØÁéá',\n        formula: '(ÂõûÊî∂Âà©Áî®Èáè + ÂÜçÂà©Áî®Èáè) / ÊÄªÂ∫üÁâ©‰∫ßÁîüÈáè',\n        target: 0.8,\n        unit: '%'\n      },\n      waste_diversion_rate: {\n        name: 'Â∫üÁâ©ËΩ¨ÂåñÁéá',\n        formula: '(ÂõûÊî∂Èáè + ËÉΩÊ∫êÂõûÊî∂Èáè) / ÊÄªÂ∫üÁâ©Èáè',\n        target: 0.9,\n        unit: '%'\n      },\n      resource_efficiency: {\n        name: 'ËµÑÊ∫êÊïàÁéá',\n        formula: '‰∫ßÂá∫‰ª∑ÂÄº / ËµÑÊ∫êÊäïÂÖ•Èáè',\n        target: 1.5,\n        unit: 'ÂÖÉ/kg'\n      },\n      carbon_footprint_reduction: {\n        name: 'Á¢≥Ë∂≥ËøπÂáèÂ∞ë',\n        formula: 'Âü∫ÂáÜÊéíÊîæ - ÂÆûÈôÖÊéíÊîæ',\n        target: 0.3,\n        unit: 'tCO2e/tÂ∫üÁâ©'\n      }\n    };\n    \n    // Â§ÑÁêÜÊäÄÊúØÈÖçÁΩÆ\n    this.treatmentTechnologies = {\n      mechanical_recycling: {\n        name: 'Êú∫Ê¢∞ÂõûÊî∂',\n        applicable_materials: ['plastic', 'metal', 'paper', 'glass'],\n        efficiency: 0.85,\n        energy_consumption: 0.5, // kWh/kg\n        cost: 200, // ÂÖÉ/Âê®\n        carbon_factor: 0.1 // kgCO2e/kg\n      },\n      chemical_recycling: {\n        name: 'ÂåñÂ≠¶ÂõûÊî∂',\n        applicable_materials: ['plastic', 'rubber'],\n        efficiency: 0.75,\n        energy_consumption: 1.2,\n        cost: 800,\n        carbon_factor: 0.3\n      },\n      biological_treatment: {\n        name: 'ÁîüÁâ©Â§ÑÁêÜ',\n        applicable_materials: ['organic'],\n        efficiency: 0.8,\n        energy_consumption: 0.3,\n        cost: 150,\n        carbon_factor: -0.2 // Ë¥üÂÄºË°®Á§∫Á¢≥ÂáèÊéí\n      },\n      thermal_recovery: {\n        name: 'ÁÉ≠ËÉΩÂõûÊî∂',\n        applicable_materials: ['mixed', 'non_recyclable'],\n        efficiency: 0.7,\n        energy_consumption: -2.0, // Ë¥üÂÄºË°®Á§∫ËÉΩÊ∫ê‰∫ßÂá∫\n        cost: 300,\n        carbon_factor: 0.4\n      }\n    };\n    \n    this.init();\n  }\n\n  async init() {\n    try {\n      await this.initializeWasteCategories();\n      await this.setupRecyclingProcesses();\n      await this.initializeTraceabilitySystem();\n      await this.startRealTimeMonitoring();\n      \n      this.isInitialized = true;\n      logger.info('ËµÑÊ∫êÂæ™ÁéØÂà©Áî®‰∏éÂõ∫Â∫üËøΩÊ∫Ø‰∏≠ÂøÉÂàùÂßãÂåñÂÆåÊàê');\n      this.emit('initialized');\n    } catch (error) {\n      logger.error('ËµÑÊ∫êÂæ™ÁéØ‰∏≠ÂøÉÂàùÂßãÂåñÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Âª∫Á´ãÂõ∫Â∫üÂÖ®ÁîüÂëΩÂë®ÊúüËøΩÊ∫Ø‰ΩìÁ≥ª\n   * @param {string} parkId - Âõ≠Âå∫ID\n   * @param {Object} wasteItem - Â∫üÁâ©‰ø°ÊÅØ\n   * @returns {Object} ËøΩÊ∫ØËÆ∞ÂΩï\n   */\n  async establishWasteTraceability(parkId, wasteItem) {\n    try {\n      const traceId = this.generateTraceId(parkId, wasteItem);\n      \n      // ÂàõÂª∫ËøΩÊ∫ØËÆ∞ÂΩï\n      const traceRecord = {\n        trace_id: traceId,\n        park_id: parkId,\n        waste_info: {\n          ...wasteItem,\n          classification: this.classifyWaste(wasteItem),\n          hazard_level: this.assessHazardLevel(wasteItem),\n          recycling_potential: this.assessRecyclingPotential(wasteItem)\n        },\n        \n        // ÁîüÂëΩÂë®ÊúüÈò∂ÊÆµ\n        lifecycle_stages: {\n          generation: {\n            timestamp: new Date().toISOString(),\n            location: wasteItem.generation_location,\n            source: wasteItem.source,\n            quantity: wasteItem.quantity,\n            composition: wasteItem.composition,\n            generator_info: wasteItem.generator\n          },\n          collection: {\n            status: 'pending',\n            scheduled_time: null,\n            collector: null,\n            collection_method: null\n          },\n          transportation: {\n            status: 'pending',\n            vehicle_info: null,\n            route: null,\n            transport_conditions: null\n          },\n          treatment: {\n            status: 'pending',\n            facility: null,\n            treatment_method: null,\n            treatment_efficiency: null\n          },\n          disposal_or_recovery: {\n            status: 'pending',\n            final_destination: null,\n            recovery_products: null,\n            disposal_method: null\n          }\n        },\n        \n        // ÂêàËßÑÊÄßÊ£ÄÊü•\n        compliance: {\n          regulatory_requirements: this.getRegulatory Requirements(wasteItem),\n          permits_required: this.getRequiredPermits(wasteItem),\n          compliance_status: 'pending_verification'\n        },\n        \n        // ÁéØÂ¢ÉÂΩ±Âìç\n        environmental_impact: {\n          carbon_footprint: this.calculateCarbonFootprint(wasteItem),\n          resource_consumption: this.calculateResourceConsumption(wasteItem),\n          pollution_potential: this.assessPollutionPotential(wasteItem)\n        },\n        \n        // ÁªèÊµé‰ª∑ÂÄº\n        economic_value: {\n          disposal_cost: this.calculateDisposalCost(wasteItem),\n          recovery_value: this.calculateRecoveryValue(wasteItem),\n          net_value: 0 // Â∞ÜÂú®‰∏ãÈù¢ËÆ°ÁÆó\n        },\n        \n        // Ë¥®ÈáèÊéßÂà∂\n        quality_control: {\n          sampling_records: [],\n          test_results: [],\n          quality_certificates: []\n        },\n        \n        // ËøΩÊ∫ØÈìæ\n        traceability_chain: [\n          {\n            stage: 'generation',\n            timestamp: new Date().toISOString(),\n            actor: wasteItem.generator,\n            action: 'waste_generated',\n            location: wasteItem.generation_location,\n            data_hash: this.generateDataHash(wasteItem)\n          }\n        ]\n      };\n      \n      // ËÆ°ÁÆóÂáÄÁªèÊµé‰ª∑ÂÄº\n      traceRecord.economic_value.net_value = \n        traceRecord.economic_value.recovery_value - traceRecord.economic_value.disposal_cost;\n      \n      // Â≠òÂÇ®ËøΩÊ∫ØËÆ∞ÂΩï\n      this.traceabilityRecords.set(traceId, traceRecord);\n      \n      // ÁîüÊàê‰∫åÁª¥Á†Å/RFIDÊ†áÁ≠æ\n      const trackingLabel = await this.generateTrackingLabel(traceRecord);\n      \n      logger.info(`Âõ∫Â∫üËøΩÊ∫Ø‰ΩìÁ≥ªÂª∫Á´ãÂÆåÊàê: ${traceId}`);\n      this.emit('traceability_established', traceRecord);\n      \n      return {\n        trace_record: traceRecord,\n        tracking_label: trackingLabel,\n        qr_code: this.generateQRCode(traceId),\n        compliance_checklist: this.generateComplianceChecklist(traceRecord)\n      };\n    } catch (error) {\n      logger.error('Âª∫Á´ãÂõ∫Â∫üËøΩÊ∫Ø‰ΩìÁ≥ªÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * ‰ºòÂåñËµÑÊ∫êÂæ™ÁéØÂà©Áî®Ë∑ØÂæÑ\n   * @param {string} parkId - Âõ≠Âå∫ID\n   * @param {Array} wasteStreams - Â∫üÁâ©ÊµÅ\n   * @returns {Object} ‰ºòÂåñÊñπÊ°à\n   */\n  async optimizeCirculationPath(parkId, wasteStreams) {\n    try {\n      const optimizationId = this.generateOptimizationId(parkId);\n      \n      // ÂàÜÊûêÂ∫üÁâ©ÊµÅÁâπÂæÅ\n      const streamAnalysis = this.analyzeWasteStreams(wasteStreams);\n      \n      // ËØÜÂà´Âæ™ÁéØÂà©Áî®Êú∫‰ºö\n      const circulationOpportunities = this.identifyCirculationOpportunities(streamAnalysis);\n      \n      // ÊûÑÂª∫Âæ™ÁéØÁΩëÁªú\n      const circulationNetwork = this.buildCirculationNetwork(circulationOpportunities);\n      \n      // Â§öÁõÆÊ†á‰ºòÂåñ\n      const optimizationResult = await this.executeCirculationOptimization(\n        circulationNetwork,\n        streamAnalysis\n      );\n      \n      // ÁîüÊàêÂÆûÊñΩÊñπÊ°à\n      const implementationPlan = this.generateImplementationPlan(optimizationResult);\n      \n      // ËØÑ‰º∞ÁéØÂ¢ÉÂíåÁªèÊµéÊïàÁõä\n      const benefitAssessment = await this.assessCirculationBenefits(optimizationResult);\n      \n      const result = {\n        optimization_id: optimizationId,\n        park_id: parkId,\n        optimization_time: new Date().toISOString(),\n        \n        // Â∫üÁâ©ÊµÅÂàÜÊûê\n        waste_stream_analysis: streamAnalysis,\n        \n        // Âæ™ÁéØÊú∫‰ºö\n        circulation_opportunities: circulationOpportunities,\n        \n        // ‰ºòÂåñÁΩëÁªú\n        circulation_network: circulationNetwork,\n        \n        // ÊúÄ‰ºòË∑ØÂæÑ\n        optimal_paths: optimizationResult.optimal_paths,\n        \n        // ÂÆûÊñΩÊñπÊ°à\n        implementation_plan: implementationPlan,\n        \n        // ÊïàÁõäËØÑ‰º∞\n        benefits: benefitAssessment,\n        \n        // Âæ™ÁéØÁªèÊµéÊåáÊ†á\n        circularity_metrics: {\n          material_circularity_rate: this.calculateMaterialCircularityRate(optimizationResult),\n          waste_diversion_rate: this.calculateWasteDiversionRate(optimizationResult),\n          resource_efficiency: this.calculateResourceEfficiency(optimizationResult),\n          carbon_reduction: this.calculateCarbonReduction(optimizationResult)\n        },\n        \n        // ÂÖ≥ÈîÆÁª©ÊïàÊåáÊ†á\n        kpis: {\n          total_waste_processed: streamAnalysis.total_quantity,\n          recycling_rate: optimizationResult.recycling_rate,\n          recovery_rate: optimizationResult.recovery_rate,\n          cost_savings: benefitAssessment.cost_savings,\n          revenue_generation: benefitAssessment.revenue_generation,\n          carbon_footprint_reduction: benefitAssessment.carbon_reduction\n        },\n        \n        // È£éÈô©ËØÑ‰º∞\n        risk_assessment: this.assessImplementationRisks(implementationPlan),\n        \n        // ÁõëÊéßËÆ°Âàí\n        monitoring_plan: this.createMonitoringPlan(optimizationResult)\n      };\n      \n      // ÁºìÂ≠ò‰ºòÂåñÁªìÊûú\n      this.optimizationResults.set(optimizationId, result);\n      \n      logger.info(`ËµÑÊ∫êÂæ™ÁéØÂà©Áî®Ë∑ØÂæÑ‰ºòÂåñÂÆåÊàê: ${optimizationId}, Âæ™ÁéØÁéá: ${result.circularity_metrics.material_circularity_rate}%`);\n      this.emit('circulation_optimized', result);\n      \n      return result;\n    } catch (error) {\n      logger.error('‰ºòÂåñËµÑÊ∫êÂæ™ÁéØÂà©Áî®Ë∑ØÂæÑÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Êõ¥Êñ∞ËøΩÊ∫ØËÆ∞ÂΩï\n   * @param {string} traceId - ËøΩÊ∫ØID\n   * @param {string} stage - ÁîüÂëΩÂë®ÊúüÈò∂ÊÆµ\n   * @param {Object} updateData - Êõ¥Êñ∞Êï∞ÊçÆ\n   * @returns {Object} Êõ¥Êñ∞ÁªìÊûú\n   */\n  async updateTraceabilityRecord(traceId, stage, updateData) {\n    try {\n      const traceRecord = this.traceabilityRecords.get(traceId);\n      if (!traceRecord) {\n        throw new Error(`ËøΩÊ∫ØËÆ∞ÂΩï‰∏çÂ≠òÂú®: ${traceId}`);\n      }\n      \n      // È™åËØÅÈò∂ÊÆµÈ°∫Â∫è\n      this.validateStageSequence(traceRecord, stage);\n      \n      // Êõ¥Êñ∞Èò∂ÊÆµ‰ø°ÊÅØ\n      if (traceRecord.lifecycle_stages[stage]) {\n        Object.assign(traceRecord.lifecycle_stages[stage], {\n          ...updateData,\n          timestamp: new Date().toISOString(),\n          status: 'completed'\n        });\n      }\n      \n      // Ê∑ªÂä†ËøΩÊ∫ØÈìæËÆ∞ÂΩï\n      traceRecord.traceability_chain.push({\n        stage: stage,\n        timestamp: new Date().toISOString(),\n        actor: updateData.actor || 'system',\n        action: updateData.action || `${stage}_completed`,\n        location: updateData.location,\n        data_hash: this.generateDataHash(updateData),\n        previous_hash: traceRecord.traceability_chain[traceRecord.traceability_chain.length - 1].data_hash\n      });\n      \n      // Êõ¥Êñ∞ÂêàËßÑÊÄßÁä∂ÊÄÅ\n      await this.updateComplianceStatus(traceRecord, stage, updateData);\n      \n      // ÈáçÊñ∞ËÆ°ÁÆóÁéØÂ¢ÉÂΩ±Âìç\n      this.recalculateEnvironmentalImpact(traceRecord, stage, updateData);\n      \n      // Êõ¥Êñ∞Ë¥®ÈáèÊéßÂà∂ËÆ∞ÂΩï\n      if (updateData.quality_data) {\n        this.updateQualityControlRecords(traceRecord, updateData.quality_data);\n      }\n      \n      // Ê£ÄÊü•ÊòØÂê¶ÂÆåÊàêÂÖ®ÁîüÂëΩÂë®Êúü\n      const isComplete = this.checkLifecycleCompletion(traceRecord);\n      \n      const result = {\n        trace_id: traceId,\n        updated_stage: stage,\n        update_time: new Date().toISOString(),\n        lifecycle_complete: isComplete,\n        current_status: this.getCurrentStatus(traceRecord),\n        next_actions: this.getNextActions(traceRecord),\n        compliance_status: traceRecord.compliance.compliance_status,\n        environmental_impact: traceRecord.environmental_impact,\n        economic_value: traceRecord.economic_value\n      };\n      \n      // Â¶ÇÊûúÁîüÂëΩÂë®ÊúüÂÆåÊàêÔºåÁîüÊàêÊúÄÁªàÊä•Âëä\n      if (isComplete) {\n        result.final_report = await this.generateFinalReport(traceRecord);\n      }\n      \n      logger.info(`ËøΩÊ∫ØËÆ∞ÂΩïÊõ¥Êñ∞ÂÆåÊàê: ${traceId}, Èò∂ÊÆµ: ${stage}`);\n      this.emit('traceability_updated', result);\n      \n      return result;\n    } catch (error) {\n      logger.error('Êõ¥Êñ∞ËøΩÊ∫ØËÆ∞ÂΩïÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * ÁîüÊàêÂæ™ÁéØÁªèÊµéÊä•Âëä\n   * @param {string} parkId - Âõ≠Âå∫ID\n   * @param {string} period - Êä•ÂëäÊúüÈó¥\n   * @returns {Object} Âæ™ÁéØÁªèÊµéÊä•Âëä\n   */\n  async generateCircularEconomyReport(parkId, period = 'monthly') {\n    try {\n      const reportId = this.generateReportId(parkId, period);\n      \n      // Ëé∑ÂèñÊúüÈó¥ÂÜÖÁöÑÊï∞ÊçÆ\n      const periodData = await this.getPeriodData(parkId, period);\n      \n      // ËÆ°ÁÆóÂæ™ÁéØÁªèÊµéÊåáÊ†á\n      const circularityMetrics = this.calculateCircularityMetrics(periodData);\n      \n      // ÂàÜÊûêÂ∫üÁâ©ÊµÅ\n      const wasteFlowAnalysis = this.analyzeWasteFlows(periodData);\n      \n      // ËØÑ‰º∞ÁéØÂ¢ÉÊïàÁõä\n      const environmentalBenefits = this.assessEnvironmentalBenefits(periodData);\n      \n      // ËÆ°ÁÆóÁªèÊµéÊïàÁõä\n      const economicBenefits = this.calculateEconomicBenefits(periodData);\n      \n      // ËØÜÂà´ÊîπËøõÊú∫‰ºö\n      const improvementOpportunities = this.identifyImprovementOpportunities(periodData);\n      \n      // Âü∫ÂáÜÂØπÊØî\n      const benchmarkComparison = await this.performBenchmarkComparison(circularityMetrics);\n      \n      const report = {\n        report_id: reportId,\n        park_id: parkId,\n        report_period: period,\n        generation_time: new Date().toISOString(),\n        \n        // ÊâßË°åÊëòË¶Å\n        executive_summary: {\n          total_waste_processed: periodData.total_waste,\n          circularity_rate: circularityMetrics.material_circularity,\n          diversion_rate: circularityMetrics.waste_diversion_rate,\n          cost_savings: economicBenefits.total_savings,\n          carbon_reduction: environmentalBenefits.carbon_reduction,\n          key_achievements: this.identifyKeyAchievements(periodData),\n          main_challenges: this.identifyMainChallenges(periodData)\n        },\n        \n        // Âæ™ÁéØÁªèÊµéÊåáÊ†á\n        circularity_metrics: circularityMetrics,\n        \n        // Â∫üÁâ©ÊµÅÂàÜÊûê\n        waste_flow_analysis: wasteFlowAnalysis,\n        \n        // ÁéØÂ¢ÉÊïàÁõä\n        environmental_benefits: environmentalBenefits,\n        \n        // ÁªèÊµéÊïàÁõä\n        economic_benefits: economicBenefits,\n        \n        // ÊäÄÊúØÁª©Êïà\n        technology_performance: {\n          recycling_efficiency: this.calculateRecyclingEfficiency(periodData),\n          recovery_efficiency: this.calculateRecoveryEfficiency(periodData),\n          treatment_effectiveness: this.calculateTreatmentEffectiveness(periodData)\n        },\n        \n        // ÂêàËßÑÊÄßÁä∂ÊÄÅ\n        compliance_status: {\n          regulatory_compliance: this.assessRegulatoryCompliance(periodData),\n          permit_status: this.checkPermitStatus(periodData),\n          audit_results: this.getAuditResults(periodData)\n        },\n        \n        // ÊîπËøõÂª∫ËÆÆ\n        improvement_opportunities: improvementOpportunities,\n        \n        // Âü∫ÂáÜÂØπÊØî\n        benchmark_comparison: benchmarkComparison,\n        \n        // Ë∂ãÂäøÂàÜÊûê\n        trend_analysis: this.performTrendAnalysis(parkId, period),\n        \n        // È¢ÑÊµãÂíåÁõÆÊ†á\n        forecasts_and_targets: {\n          next_period_forecast: this.generateNextPeriodForecast(periodData),\n          annual_targets: this.getAnnualTargets(parkId),\n          target_achievement: this.assessTargetAchievement(circularityMetrics)\n        },\n        \n        // Ë°åÂä®ËÆ°Âàí\n        action_plan: this.generateActionPlan(improvementOpportunities),\n        \n        // ÈôÑÂΩï\n        appendices: {\n          detailed_data: periodData,\n          methodology: this.getCalculationMethodology(),\n          data_sources: this.getDataSources(),\n          assumptions: this.getAssumptions()\n        }\n      };\n      \n      logger.info(`Âæ™ÁéØÁªèÊµéÊä•ÂëäÁîüÊàêÂÆåÊàê: ${reportId}`);\n      this.emit('report_generated', report);\n      \n      return report;\n    } catch (error) {\n      logger.error('ÁîüÊàêÂæ™ÁéØÁªèÊµéÊä•ÂëäÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * ÂêØÂä®ÂÆûÊó∂ÁõëÊéß\n   */\n  async startRealTimeMonitoring() {\n    // ÊØèÂ∞èÊó∂Êõ¥Êñ∞Âæ™ÁéØÁªèÊµéÊåáÊ†á\n    setInterval(async () => {\n      try {\n        await this.updateCircularityMetrics();\n      } catch (error) {\n        logger.error('Êõ¥Êñ∞Âæ™ÁéØÁªèÊµéÊåáÊ†áÂ§±Ë¥•:', error);\n      }\n    }, MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.MILLISECONDS_PER_SECOND);\n    \n    // ÊØè30ÂàÜÈíüÊ£ÄÊü•ËøΩÊ∫ØËÆ∞ÂΩïÁä∂ÊÄÅ\n    setInterval(async () => {\n      try {\n        await this.checkTraceabilityStatus();\n      } catch (error) {\n        logger.error('Ê£ÄÊü•ËøΩÊ∫ØËÆ∞ÂΩïÁä∂ÊÄÅÂ§±Ë¥•:', error);\n      }\n    }, MATH_CONSTANTS.THIRTY * MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.MILLISECONDS_PER_SECOND);\n    \n    // ÊØè15ÂàÜÈíüÁõëÊéßÂ§ÑÁêÜËÆæÊñΩÁä∂ÊÄÅ\n    setInterval(async () => {\n      try {\n        await this.monitorTreatmentFacilities();\n      } catch (error) {\n        logger.error('ÁõëÊéßÂ§ÑÁêÜËÆæÊñΩÂ§±Ë¥•:', error);\n      }\n    }, MATH_CONSTANTS.FIFTEEN * MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.MILLISECONDS_PER_SECOND);\n  }\n\n  // Â∫üÁâ©ÂàÜÁ±ªÂíåËØÑ‰º∞ÊñπÊ≥ï\n  classifyWaste(wasteItem) {\n    const { type, composition, hazard_properties } = wasteItem;\n    \n    // Âç±Èô©Â∫üÁâ©Âà§ÂÆö\n    if (hazard_properties && hazard_properties.length > 0) {\n      return {\n        category: 'hazardous',\n        code: this.getHazardousWasteCode(type, hazard_properties),\n        subcategory: this.getHazardousSubcategory(type),\n        risk_level: this.assessRiskLevel(hazard_properties)\n      };\n    }\n    \n    // ÂèØÂõûÊî∂Áâ©Âà§ÂÆö\n    if (this.isRecyclable(composition)) {\n      return {\n        category: 'recyclable',\n        code: this.getRecyclableCode(type),\n        subcategory: this.getRecyclableSubcategory(type),\n        recycling_grade: this.assessRecyclingGrade(composition)\n      };\n    }\n    \n    // ÊúâÊú∫Â∫üÁâ©Âà§ÂÆö\n    if (this.isOrganic(composition)) {\n      return {\n        category: 'organic',\n        code: this.getOrganicCode(type),\n        subcategory: this.getOrganicSubcategory(type),\n        biodegradability: this.assessBiodegradability(composition)\n      };\n    }\n    \n    // ÊÉ∞ÊÄßÂ∫üÁâ©\n    return {\n      category: 'inert',\n      code: this.getInertCode(type),\n      subcategory: this.getInertSubcategory(type),\n      utilization_potential: this.assessUtilizationPotential(composition)\n    };\n  }\n\n  assessHazardLevel(wasteItem) {\n    const { hazard_properties, quantity, concentration } = wasteItem;\n    \n    let hazardScore = 0;\n    \n    // Âç±Èô©ÁâπÊÄßËØÑÂàÜ\n    if (hazard_properties.includes('toxic')) hazardScore += 3;\n    if (hazard_properties.includes('corrosive')) hazardScore += 2;\n    if (hazard_properties.includes('flammable')) hazardScore += 2;\n    if (hazard_properties.includes('explosive')) hazardScore += 4;\n    if (hazard_properties.includes('infectious')) hazardScore += 3;\n    \n    // Êï∞ÈáèÂΩ±Âìç\n    if (quantity > 1000) hazardScore += 2;\n    else if (quantity > 100) hazardScore += 1;\n    \n    // ÊµìÂ∫¶ÂΩ±Âìç\n    if (concentration && concentration > 0.5) hazardScore += 2;\n    else if (concentration && concentration > 0.1) hazardScore += 1;\n    \n    if (hazardScore >= 6) return 'high';\n    if (hazardScore >= 3) return 'medium';\n    return 'low';\n  }\n\n  assessRecyclingPotential(wasteItem) {\n    const { type, composition, contamination_level, quantity } = wasteItem;\n    \n    const baseRecyclability = this.getBaseRecyclability(type);\n    const contaminationPenalty = contamination_level * 0.2;\n    const quantityBonus = quantity > 100 ? 0.1 : 0;\n    \n    const potential = Math.max(0, baseRecyclability - contaminationPenalty + quantityBonus);\n    \n    return {\n      score: potential,\n      grade: potential > 0.8 ? 'excellent' : potential > 0.6 ? 'good' : potential > 0.4 ? 'fair' : 'poor',\n      estimated_recovery_rate: potential * 0.9,\n      estimated_value: this.calculateEstimatedValue(type, quantity, potential)\n    };\n  }\n\n  // Âæ™ÁéØÂà©Áî®‰ºòÂåñÊñπÊ≥ï\n  analyzeWasteStreams(wasteStreams) {\n    const analysis = {\n      total_quantity: 0,\n      composition_breakdown: {},\n      recyclable_fraction: 0,\n      organic_fraction: 0,\n      hazardous_fraction: 0,\n      inert_fraction: 0,\n      contamination_levels: {},\n      seasonal_patterns: {},\n      source_distribution: {}\n    };\n    \n    wasteStreams.forEach(stream => {\n      analysis.total_quantity += stream.quantity;\n      \n      // ÊàêÂàÜÂàÜÊûê\n      Object.keys(stream.composition).forEach(component => {\n        if (!analysis.composition_breakdown[component]) {\n          analysis.composition_breakdown[component] = 0;\n        }\n        analysis.composition_breakdown[component] += stream.composition[component] * stream.quantity;\n      });\n      \n      // ÂàÜÁ±ªÁªüËÆ°\n      const classification = this.classifyWaste(stream);\n      switch (classification.category) {\n        case 'recyclable':\n          analysis.recyclable_fraction += stream.quantity;\n          break;\n        case 'organic':\n          analysis.organic_fraction += stream.quantity;\n          break;\n        case 'hazardous':\n          analysis.hazardous_fraction += stream.quantity;\n          break;\n        case 'inert':\n          analysis.inert_fraction += stream.quantity;\n          break;\n      }\n      \n      // Ê±°ÊüìÊ∞¥Âπ≥\n      if (stream.contamination_level) {\n        if (!analysis.contamination_levels[classification.category]) {\n          analysis.contamination_levels[classification.category] = [];\n        }\n        analysis.contamination_levels[classification.category].push(stream.contamination_level);\n      }\n      \n      // Êù•Ê∫êÂàÜÂ∏É\n      if (!analysis.source_distribution[stream.source]) {\n        analysis.source_distribution[stream.source] = 0;\n      }\n      analysis.source_distribution[stream.source] += stream.quantity;\n    });\n    \n    // ËÆ°ÁÆóÊØî‰æã\n    analysis.recyclable_fraction /= analysis.total_quantity;\n    analysis.organic_fraction /= analysis.total_quantity;\n    analysis.hazardous_fraction /= analysis.total_quantity;\n    analysis.inert_fraction /= analysis.total_quantity;\n    \n    return analysis;\n  }\n\n  identifyCirculationOpportunities(streamAnalysis) {\n    const opportunities = [];\n    \n    // ÂèØÂõûÊî∂Áâ©Êú∫‰ºö\n    if (streamAnalysis.recyclable_fraction > 0.1) {\n      opportunities.push({\n        type: 'material_recycling',\n        potential_quantity: streamAnalysis.total_quantity * streamAnalysis.recyclable_fraction,\n        estimated_value: this.calculateRecyclingValue(streamAnalysis),\n        implementation_complexity: 'medium',\n        payback_period: '2-3 years'\n      });\n    }\n    \n    // ÊúâÊú∫Â∫üÁâ©Â§ÑÁêÜÊú∫‰ºö\n    if (streamAnalysis.organic_fraction > 0.15) {\n      opportunities.push({\n        type: 'organic_treatment',\n        potential_quantity: streamAnalysis.total_quantity * streamAnalysis.organic_fraction,\n        treatment_options: ['composting', 'anaerobic_digestion'],\n        estimated_value: this.calculateOrganicValue(streamAnalysis),\n        implementation_complexity: 'high',\n        payback_period: '3-5 years'\n      });\n    }\n    \n    // ËÉΩÊ∫êÂõûÊî∂Êú∫‰ºö\n    const energyRecoveryPotential = this.calculateEnergyRecoveryPotential(streamAnalysis);\n    if (energyRecoveryPotential > 1000) { // kWh\n      opportunities.push({\n        type: 'energy_recovery',\n        potential_energy: energyRecoveryPotential,\n        estimated_value: energyRecoveryPotential * 0.6, // 0.6ÂÖÉ/kWh\n        implementation_complexity: 'high',\n        payback_period: '5-7 years'\n      });\n    }\n    \n    // Â∑•‰∏öÂÖ±ÁîüÊú∫‰ºö\n    const symbiosisOpportunities = this.identifyIndustrialSymbiosis(streamAnalysis);\n    opportunities.push(...symbiosisOpportunities);\n    \n    return opportunities;\n  }\n\n  buildCirculationNetwork(opportunities) {\n    const network = {\n      nodes: [],\n      edges: [],\n      flows: [],\n      constraints: []\n    };\n    \n    // Ê∑ªÂä†Ê∫êËäÇÁÇπÔºàÂ∫üÁâ©‰∫ßÁîüÁÇπÔºâ\n    network.nodes.push({\n      id: 'waste_sources',\n      type: 'source',\n      capacity: Infinity\n    });\n    \n    // Ê∑ªÂä†Â§ÑÁêÜËäÇÁÇπ\n    opportunities.forEach((opp, index) => {\n      network.nodes.push({\n        id: `treatment_${index}`,\n        type: 'treatment',\n        treatment_type: opp.type,\n        capacity: opp.potential_quantity,\n        cost: opp.estimated_cost || 0,\n        efficiency: opp.efficiency || 0.8\n      });\n      \n      // Ê∑ªÂä†‰ªéÊ∫êÂà∞Â§ÑÁêÜÁöÑËæπ\n      network.edges.push({\n        from: 'waste_sources',\n        to: `treatment_${index}`,\n        capacity: opp.potential_quantity,\n        cost: opp.transport_cost || 50\n      });\n    });\n    \n    // Ê∑ªÂä†Ê±áËäÇÁÇπÔºàÊúÄÁªà‰∫ßÂìÅ/Â§ÑÁΩÆÔºâ\n    network.nodes.push({\n      id: 'final_products',\n      type: 'sink',\n      capacity: Infinity\n    });\n    \n    // Ê∑ªÂä†‰ªéÂ§ÑÁêÜÂà∞Ê±áÁöÑËæπ\n    opportunities.forEach((opp, index) => {\n      network.edges.push({\n        from: `treatment_${index}`,\n        to: 'final_products',\n        capacity: opp.potential_quantity * (opp.efficiency || 0.8),\n        value: opp.estimated_value || 0\n      });\n    });\n    \n    return network;\n  }\n\n  async executeCirculationOptimization(network, streamAnalysis) {\n    // ÁÆÄÂåñÁöÑÁΩëÁªúÊµÅ‰ºòÂåñ\n    // ÂÆûÈôÖÂ∫îÁî®‰∏≠Â∫î‰ΩøÁî®‰∏ì‰∏öÁöÑÁΩëÁªú‰ºòÂåñÁÆóÊ≥ï\n    \n    const optimization = {\n      objective: 'maximize_value_minimize_cost',\n      constraints: [\n        'capacity_constraints',\n        'flow_conservation',\n        'material_balance'\n      ],\n      variables: network.edges.map(edge => ({\n        id: `flow_${edge.from}_${edge.to}`,\n        type: 'continuous',\n        lower_bound: 0,\n        upper_bound: edge.capacity\n      }))\n    };\n    \n    // Ê®°Êãü‰ºòÂåñÁªìÊûú\n    const optimalFlows = this.simulateOptimalFlows(network, streamAnalysis);\n    \n    return {\n      optimal_flows: optimalFlows,\n      optimal_paths: this.extractOptimalPaths(optimalFlows, network),\n      total_value: this.calculateTotalValue(optimalFlows, network),\n      total_cost: this.calculateTotalCost(optimalFlows, network),\n      recycling_rate: this.calculateOptimalRecyclingRate(optimalFlows, streamAnalysis),\n      recovery_rate: this.calculateOptimalRecoveryRate(optimalFlows, streamAnalysis),\n      efficiency_metrics: this.calculateEfficiencyMetrics(optimalFlows, network)\n    };\n  }\n\n  // ËæÖÂä©ÊñπÊ≥ï\n  generateTraceId(parkId, wasteItem) {\n    return `TRACE_${parkId}_${wasteItem.type}_${Date.now()}`;\n  }\n\n  generateOptimizationId(parkId) {\n    return `CIRC_OPT_${parkId}_${Date.now()}`;\n  }\n\n  generateReportId(parkId, period) {\n    return `CIRC_RPT_${parkId}_${period}_${Date.now()}`;\n  }\n\n  generateDataHash(data) {\n    // ÁÆÄÂåñÁöÑÊï∞ÊçÆÂìàÂ∏åÁîüÊàê\n    return `hash_${JSON.stringify(data).length}_${Date.now()}`;\n  }\n\n  generateQRCode(traceId) {\n    return {\n      content: traceId,\n      format: 'QR_CODE',\n      size: '100x100',\n      url: `https://trace.system.com/track/${traceId}`\n    };\n  }\n\n  async generateTrackingLabel(traceRecord) {\n    return {\n      label_id: `LABEL_${traceRecord.trace_id}`,\n      type: 'RFID',\n      content: {\n        trace_id: traceRecord.trace_id,\n        waste_type: traceRecord.waste_info.type,\n        generation_date: traceRecord.lifecycle_stages.generation.timestamp,\n        hazard_level: traceRecord.waste_info.hazard_level\n      },\n      print_ready: true\n    };\n  }\n\n  // Ê®°ÊãüÊï∞ÊçÆËé∑ÂèñÊñπÊ≥ï\n  async initializeWasteCategories() {\n    Object.keys(this.wasteClassification).forEach(category => {\n      this.wasteCategories.set(category, this.wasteClassification[category]);\n    });\n    logger.info('Â∫üÁâ©ÂàÜÁ±ª‰ΩìÁ≥ªÂàùÂßãÂåñÂÆåÊàê');\n  }\n\n  async setupRecyclingProcesses() {\n    Object.keys(this.treatmentTechnologies).forEach(tech => {\n      this.recyclingProcesses.set(tech, this.treatmentTechnologies[tech]);\n    });\n    logger.info('ÂõûÊî∂Â§ÑÁêÜÂ∑•Ëâ∫ÈÖçÁΩÆÂÆåÊàê');\n  }\n\n  async initializeTraceabilitySystem() {\n    // ÂàùÂßãÂåñÂå∫ÂùóÈìæÊàñÂàÜÂ∏ÉÂºèË¥¶Êú¨Á≥ªÁªü\n    logger.info('ËøΩÊ∫ØÁ≥ªÁªüÂàùÂßãÂåñÂÆåÊàê');\n  }\n\n  async updateCircularityMetrics() {\n    // Êõ¥Êñ∞Âæ™ÁéØÁªèÊµéÊåáÊ†á\n    const parks = await this.getAllParks();\n    \n    for (const park of parks) {\n      const metrics = await this.calculateRealTimeMetrics(park.id);\n      this.circularityMetrics.set(park.id, metrics);\n    }\n  }\n\n  async checkTraceabilityStatus() {\n    // Ê£ÄÊü•ËøΩÊ∫ØËÆ∞ÂΩïÁä∂ÊÄÅ\n    for (const [traceId, record] of this.traceabilityRecords) {\n      const status = this.getCurrentStatus(record);\n      if (status === 'overdue') {\n        this.emit('traceability_alert', {\n          trace_id: traceId,\n          alert_type: 'overdue',\n          message: 'ËøΩÊ∫ØËÆ∞ÂΩïÊõ¥Êñ∞Ë∂ÖÊó∂'\n        });\n      }\n    }\n  }\n\n  async monitorTreatmentFacilities() {\n    // ÁõëÊéßÂ§ÑÁêÜËÆæÊñΩÁä∂ÊÄÅ\n    const facilities = await this.getTreatmentFacilities();\n    \n    for (const facility of facilities) {\n      const status = await this.getFacilityStatus(facility.id);\n      if (status.efficiency < 0.7) {\n        this.emit('facility_alert', {\n          facility_id: facility.id,\n          alert_type: 'low_efficiency',\n          efficiency: status.efficiency\n        });\n      }\n    }\n  }\n\n  async getAllParks() {\n    return [{ id: 'park_001', name: 'Á§∫‰æãÂõ≠Âå∫' }];\n  }\n\n  async getTreatmentFacilities() {\n    return [\n      { id: 'facility_001', name: 'ÂõûÊî∂Â§ÑÁêÜ‰∏≠ÂøÉ', type: 'recycling' },\n      { id: 'facility_002', name: 'ÊúâÊú∫Â∫üÁâ©Â§ÑÁêÜÂéÇ', type: 'organic_treatment' }\n    ];\n  }\n\n  async getFacilityStatus(facilityId) {\n    return {\n      efficiency: 0.85 + Math.random() * 0.1,\n      capacity_utilization: 0.7 + Math.random() * 0.2,\n      operational_status: 'normal'\n    };\n  }\n\n  // ÂÖ∂‰ªñËÆ°ÁÆóÊñπÊ≥ïÁöÑÁÆÄÂåñÂÆûÁé∞\n  calculateCarbonFootprint(wasteItem) {\n    const emissionFactors = {\n      plastic: 2.1,\n      paper: 0.9,\n      metal: 1.5,\n      organic: -0.3, // Ë¥üÂÄºË°®Á§∫Á¢≥Ê±á\n      glass: 0.8\n    };\n    \n    return (emissionFactors[wasteItem.type] || 1.0) * wasteItem.quantity;\n  }\n\n  calculateDisposalCost(wasteItem) {\n    const costFactors = {\n      hazardous: 2000,\n      recyclable: 200,\n      organic: 300,\n      inert: 100\n    };\n    \n    const classification = this.classifyWaste(wasteItem);\n    return (costFactors[classification.category] || 500) * wasteItem.quantity / 1000; // ÂÖÉ/Âê®\n  }\n\n  calculateRecoveryValue(wasteItem) {\n    const valueFactors = {\n      plastic: 1200,\n      paper: 800,\n      metal: 2500,\n      glass: 300,\n      organic: 150\n    };\n    \n    const potential = this.assessRecyclingPotential(wasteItem);\n    return (valueFactors[wasteItem.type] || 0) * wasteItem.quantity / 1000 * potential.score;\n  }\n\n  isRecyclable(composition) {\n    const recyclableTypes = ['plastic', 'paper', 'metal', 'glass'];\n    return Object.keys(composition).some(type => recyclableTypes.includes(type));\n  }\n\n  isOrganic(composition) {\n    const organicTypes = ['food_waste', 'garden_waste', 'wood', 'textile'];\n    return Object.keys(composition).some(type => organicTypes.includes(type));\n  }\n\n  getBaseRecyclability(type) {\n    const recyclabilityMap = {\n      plastic: 0.8,\n      paper: 0.9,\n      metal: 0.95,\n      glass: 0.85,\n      textile: 0.6,\n      electronics: 0.7\n    };\n    \n    return recyclabilityMap[type] || 0.3;\n  }\n}\n\nexport default ResourceCirculationCenter;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/core/services/SceneManager.js","messages":[{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0x87ceeb.","line":38,"column":45,"nodeType":"Literal","messageId":"noMagic","endLine":38,"endColumn":53},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0x87ceeb.","line":39,"column":36,"nodeType":"Literal","messageId":"noMagic","endLine":39,"endColumn":44},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":39,"column":46,"nodeType":"Literal","messageId":"noMagic","endLine":39,"endColumn":49},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":39,"column":51,"nodeType":"Literal","messageId":"noMagic","endLine":39,"endColumn":55},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 75.","line":43,"column":7,"nodeType":"Literal","messageId":"noMagic","endLine":43,"endColumn":9},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.1.","line":45,"column":7,"nodeType":"Literal","messageId":"noMagic","endLine":45,"endColumn":10},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 2000.","line":46,"column":7,"nodeType":"Literal","messageId":"noMagic","endLine":46,"endColumn":11},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":48,"column":30,"nodeType":"Literal","messageId":"noMagic","endLine":48,"endColumn":33},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":48,"column":35,"nodeType":"Literal","messageId":"noMagic","endLine":48,"endColumn":38},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":48,"column":40,"nodeType":"Literal","messageId":"noMagic","endLine":48,"endColumn":43},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0xffffff.","line":87,"column":49,"nodeType":"Literal","messageId":"noMagic","endLine":87,"endColumn":57},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.6.","line":87,"column":59,"nodeType":"Literal","messageId":"noMagic","endLine":87,"endColumn":62},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0xffffff.","line":91,"column":57,"nodeType":"Literal","messageId":"noMagic","endLine":91,"endColumn":65},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.8.","line":91,"column":67,"nodeType":"Literal","messageId":"noMagic","endLine":91,"endColumn":70},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":92,"column":35,"nodeType":"Literal","messageId":"noMagic","endLine":92,"endColumn":38},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":92,"column":40,"nodeType":"Literal","messageId":"noMagic","endLine":92,"endColumn":43},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 50.","line":92,"column":45,"nodeType":"Literal","messageId":"noMagic","endLine":92,"endColumn":47},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":106,"column":52,"nodeType":"Literal","messageId":"noMagic","endLine":106,"endColumn":55},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":106,"column":57,"nodeType":"Literal","messageId":"noMagic","endLine":106,"endColumn":60},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 20.","line":127,"column":27,"nodeType":"Literal","messageId":"noMagic","endLine":127,"endColumn":29},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 30.","line":128,"column":28,"nodeType":"Literal","messageId":"noMagic","endLine":128,"endColumn":30},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 15.","line":129,"column":27,"nodeType":"Literal","messageId":"noMagic","endLine":129,"endColumn":29},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0x4a90e2.","line":133,"column":48,"nodeType":"Literal","messageId":"noMagic","endLine":133,"endColumn":56},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0x66c2a5.","line":133,"column":59,"nodeType":"Literal","messageId":"noMagic","endLine":133,"endColumn":67},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 30.","line":139,"column":66,"nodeType":"Literal","messageId":"noMagic","endLine":139,"endColumn":68},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 8.","line":163,"column":42,"nodeType":"Literal","messageId":"noMagic","endLine":163,"endColumn":43},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.5.","line":163,"column":45,"nodeType":"Literal","messageId":"noMagic","endLine":163,"endColumn":48},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 4.","line":163,"column":50,"nodeType":"Literal","messageId":"noMagic","endLine":163,"endColumn":51},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.5.","line":167,"column":47,"nodeType":"Literal","messageId":"noMagic","endLine":167,"endColumn":50},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.5.","line":167,"column":52,"nodeType":"Literal","messageId":"noMagic","endLine":167,"endColumn":55},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 15.","line":167,"column":57,"nodeType":"Literal","messageId":"noMagic","endLine":167,"endColumn":59},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 3.","line":171,"column":42,"nodeType":"Literal","messageId":"noMagic","endLine":171,"endColumn":43},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 4.","line":171,"column":45,"nodeType":"Literal","messageId":"noMagic","endLine":171,"endColumn":46},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0xef4444.","line":181,"column":29,"nodeType":"Literal","messageId":"noMagic","endLine":181,"endColumn":37},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0xf59e0b.","line":183,"column":29,"nodeType":"Literal","messageId":"noMagic","endLine":183,"endColumn":37},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5.","line":213,"column":64,"nodeType":"Literal","messageId":"noMagic","endLine":213,"endColumn":65},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0x10b981.","line":228,"column":17,"nodeType":"Literal","messageId":"noMagic","endLine":228,"endColumn":25},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0xf59e0b.","line":231,"column":17,"nodeType":"Literal","messageId":"noMagic","endLine":231,"endColumn":25},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0xef4444.","line":234,"column":17,"nodeType":"Literal","messageId":"noMagic","endLine":234,"endColumn":25},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0x6b7280.","line":237,"column":17,"nodeType":"Literal","messageId":"noMagic","endLine":237,"endColumn":25},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":245,"column":52,"nodeType":"Literal","messageId":"noMagic","endLine":245,"endColumn":55},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":258,"column":44,"nodeType":"Literal","messageId":"noMagic","endLine":258,"endColumn":46},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.5.","line":259,"column":44,"nodeType":"Literal","messageId":"noMagic","endLine":259,"endColumn":47},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.5.","line":259,"column":60,"nodeType":"Literal","messageId":"noMagic","endLine":259,"endColumn":63},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 80.","line":261,"column":22,"nodeType":"Literal","messageId":"noMagic","endLine":261,"endColumn":24},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0xef4444.","line":261,"column":27,"nodeType":"Literal","messageId":"noMagic","endLine":261,"endColumn":35},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":261,"column":46,"nodeType":"Literal","messageId":"noMagic","endLine":261,"endColumn":48},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0xf59e0b.","line":261,"column":51,"nodeType":"Literal","messageId":"noMagic","endLine":261,"endColumn":59},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0x10b981.","line":261,"column":62,"nodeType":"Literal","messageId":"noMagic","endLine":261,"endColumn":70}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":49,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Êï∞Â≠óÂ≠™ÁîüÂú∫ÊôØÁÆ°ÁêÜÂô®\n * Ë¥üË¥£3DÂú∫ÊôØÁöÑÂàõÂª∫„ÄÅÊõ¥Êñ∞ÂíåÁÆ°ÁêÜ\n */\n\nimport * as THREE from 'three';\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls';\nimport { GLTFLoader as _GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader';\nimport { CSS2DRenderer, CSS2DObject } from 'three/examples/jsm/renderers/CSS2DRenderer';\n\nclass SceneManager {\n  constructor(container) {\n    this.container = container;\n    this.scene = null;\n    this.camera = null;\n    this.renderer = null;\n    this.labelRenderer = null;\n    this.controls = null;\n    this.buildings = new Map();\n    this.devices = new Map();\n    this.sensors = new Map();\n    this.animationId = null;\n\n    this.init();\n  }\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 49 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 49 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 49 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 49 Ë°å)\n\n  init() {\n    // ÂàõÂª∫Âú∫ÊôØ\n    this.scene = new THREE.Scene();\n    this.scene.background = new THREE.Color(0x87ceeb); // Â§©Á©∫Ëìù\n    this.scene.fog = new THREE.Fog(0x87ceeb, 100, 1000);\n\n    // ÂàõÂª∫Áõ∏Êú∫\n    this.camera = new THREE.PerspectiveCamera(\n      75,\n      this.container.clientWidth / this.container.clientHeight,\n      0.1,\n      2000\n    );\n    this.camera.position.set(100, 100, 100);\n\n    // ÂàõÂª∫WebGLÊ∏≤ÊüìÂô®\n    this.renderer = new THREE.WebGLRenderer({ antialias: true });\n    this.renderer.setSize(this.container.clientWidth, this.container.clientHeight);\n    this.renderer.setPixelRatio(window.devicePixelRatio);\n    this.renderer.shadowMap.enabled = true;\n    this.renderer.shadowMap.type = THREE.PCFSoftShadowMap;\n    this.container.appendChild(this.renderer.domElement);\n\n    // ÂàõÂª∫CSS2DÊ∏≤ÊüìÂô®Áî®‰∫éÊ†áÁ≠æ\n    this.labelRenderer = new CSS2DRenderer();\n    this.labelRenderer.setSize(this.container.clientWidth, this.container.clientHeight);\n    this.labelRenderer.domElement.style.position = 'absolute';\n    this.labelRenderer.domElement.style.top = '0px';\n    this.labelRenderer.domElement.style.pointerEvents = 'none';\n    this.container.appendChild(this.labelRenderer.domElement);\n\n    // ÂàõÂª∫ËΩ®ÈÅìÊéßÂà∂Âô®\n    this.controls = new OrbitControls(this.camera, this.renderer.domElement);\n    this.controls.enableDamping = true;\n    this.controls.dampingFactor = 0.05;\n    this.controls.maxPolarAngle = Math.PI / 2;\n\n    // Ê∑ªÂä†ÂÖâÊ∫ê\n    this.setupLighting();\n\n    // ÂàõÂª∫Âú∞Èù¢\n    this.createGround();\n\n    // ÂºÄÂßãÊ∏≤ÊüìÂæ™ÁéØ\n    this.animate();\n\n    // ÁõëÂê¨Á™óÂè£Â§ßÂ∞èÂèòÂåñ\n    window.addEventListener('resize', this.onWindowResize.bind(this));\n  }\n\n  setupLighting() {\n    // ÁéØÂ¢ÉÂÖâ\n    const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);\n    this.scene.add(ambientLight);\n\n    // ÊñπÂêëÂÖâÔºàÂ§™Èò≥ÂÖâÔºâ\n    const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);\n    directionalLight.position.set(100, 100, 50);\n    directionalLight.castShadow = true;\n    directionalLight.shadow.mapSize.width = 2048;\n    directionalLight.shadow.mapSize.height = 2048;\n    directionalLight.shadow.camera.near = 0.5;\n    directionalLight.shadow.camera.far = 500;\n    directionalLight.shadow.camera.left = -100;\n    directionalLight.shadow.camera.right = 100;\n    directionalLight.shadow.camera.top = 100;\n    directionalLight.shadow.camera.bottom = -100;\n    this.scene.add(directionalLight);\n  }\n\n  createGround() {\n    const groundGeometry = new THREE.PlaneGeometry(500, 500);\n    const groundMaterial = new THREE.MeshLambertMaterial({ color: 0x90ee90 });\n    const ground = new THREE.Mesh(groundGeometry, groundMaterial);\n    ground.rotation.x = -Math.PI / 2;\n    ground.receiveShadow = true;\n    this.scene.add(ground);\n\n    // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 29 Ë°å)\n\n    // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 29 Ë°å)\n\n    // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 29 Ë°å)\n\n    // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 29 Ë°å)\n  }\n\n  // ÂàõÂª∫Âª∫Á≠ëÁâ©\n  createBuilding(buildingData) {\n    const { id, name, position, dimensions, type, color } = buildingData;\n\n    const geometry = new THREE.BoxGeometry(\n      dimensions.width || 20,\n      dimensions.height || 30,\n      dimensions.depth || 15\n    );\n\n    const material = new THREE.MeshStandardMaterial({\n      color: color || (type === 'industrial' ? 0x4a90e2 : 0x66c2a5),\n      metalness: 0.3,\n      roughness: 0.8\n    });\n\n    const building = new THREE.Mesh(geometry, material);\n    building.position.set(position.x || 0, (dimensions.height || 30) / 2, position.z || 0);\n    building.castShadow = true;\n    building.receiveShadow = true;\n    building.userData = { id, type: 'building', data: buildingData };\n\n    this.scene.add(building);\n    this.buildings.set(id, building);\n\n    // Ê∑ªÂä†Âª∫Á≠ëÊ†áÁ≠æ\n    this.createLabel(building, name, 'building');\n\n    return building;\n  }\n\n  // ÂàõÂª∫ËÆæÂ§á\n  createDevice(deviceData) {\n    const { id, name, position, device_type, status } = deviceData;\n\n    let geometry;\n    let material;\n\n    // Ê†πÊçÆËÆæÂ§áÁ±ªÂûãÂàõÂª∫‰∏çÂêåÂΩ¢Áä∂\n    switch (device_type) {\n      case 'solar_panel':\n        geometry = new THREE.BoxGeometry(8, 0.5, 4);\n        material = new THREE.MeshStandardMaterial({ color: 0x1e3a8a });\n        break;\n      case 'wind_turbine':\n        geometry = new THREE.CylinderGeometry(0.5, 0.5, 15);\n        material = new THREE.MeshStandardMaterial({ color: 0xffffff });\n        break;\n      case 'battery':\n        geometry = new THREE.BoxGeometry(3, 4, 2);\n        material = new THREE.MeshStandardMaterial({ color: 0x059669 });\n        break;\n      default:\n        geometry = new THREE.BoxGeometry(2, 2, 2);\n        material = new THREE.MeshStandardMaterial({ color: 0x6b7280 });\n    }\n\n    // Ê†πÊçÆÁä∂ÊÄÅË∞ÉÊï¥È¢úËâ≤\n    if (status === 'offline') {\n      material.color.setHex(0xef4444);\n    } else if (status === 'warning') {\n      material.color.setHex(0xf59e0b);\n    }\n\n    const device = new THREE.Mesh(geometry, material);\n    device.position.set(position.x || 0, position.y || 2, position.z || 0);\n    device.castShadow = true;\n    device.userData = { id, type: 'device', data: deviceData };\n\n    this.scene.add(device);\n    this.devices.set(id, device);\n\n    // Ê∑ªÂä†ËÆæÂ§áÊ†áÁ≠æ\n    this.createLabel(device, name, 'device');\n\n    return device;\n  }\n\n  // ÂàõÂª∫Ê†áÁ≠æ\n  createLabel(object, text, type) {\n    const labelDiv = document.createElement('div');\n    labelDiv.className = `label label-${type}`;\n    labelDiv.textContent = text;\n    labelDiv.style.backgroundColor = 'rgba(0,0,0,0.7)';\n    labelDiv.style.color = 'white';\n    labelDiv.style.padding = '4px 8px';\n    labelDiv.style.borderRadius = '4px';\n    labelDiv.style.fontSize = '12px';\n    labelDiv.style.fontFamily = 'Arial, sans-serif';\n\n    const label = new CSS2DObject(labelDiv);\n    label.position.set(0, object.geometry.parameters.height || 5, 0);\n    object.add(label);\n  }\n\n  // Êõ¥Êñ∞ËÆæÂ§áÁä∂ÊÄÅ\n  updateDeviceStatus(deviceId, status, data) {\n    const device = this.devices.get(deviceId);\n    if (!device) {\n      return;\n    }\n\n    // Êõ¥Êñ∞È¢úËâ≤\n    let color;\n    switch (status) {\n      case 'online':\n        color = 0x10b981;\n        break;\n      case 'warning':\n        color = 0xf59e0b;\n        break;\n      case 'offline':\n        color = 0xef4444;\n        break;\n      default:\n        color = 0x6b7280;\n    }\n\n    device.material.color.setHex(color);\n    device.userData.data = { ...device.userData.data, ...data, status };\n  }\n\n  // Ê∑ªÂä†Êï∞ÊçÆÂèØËßÜÂåñÊïàÊûú\n  addDataVisualization(deviceId, value, maxValue = 100) {\n    const device = this.devices.get(deviceId);\n    if (!device) {\n      return;\n    }\n\n    // ÁßªÈô§ÊóßÁöÑÂèØËßÜÂåñÊïàÊûú\n    const oldViz = device.getObjectByName('dataViz');\n    if (oldViz) {\n      device.remove(oldViz);\n    }\n\n    // ÂàõÂª∫Êï∞ÊçÆÊù°\n    const barHeight = (value / maxValue) * 10;\n    const geometry = new THREE.BoxGeometry(0.5, barHeight, 0.5);\n    const material = new THREE.MeshStandardMaterial({\n      color: value > 80 ? 0xef4444 : value > 60 ? 0xf59e0b : 0x10b981\n    });\n\n    const dataBar = new THREE.Mesh(geometry, material);\n    dataBar.position.set(0, barHeight / 2 + 2, 0);\n    dataBar.name = 'dataViz';\n    device.add(dataBar);\n  }\n\n  // Âä®ÁîªÂæ™ÁéØ\n  animate() {\n    this.animationId = requestAnimationFrame(this.animate.bind(this));\n\n    this.controls.update();\n    this.renderer.render(this.scene, this.camera);\n    this.labelRenderer.render(this.scene, this.camera);\n  }\n\n  // Á™óÂè£Â§ßÂ∞èÂèòÂåñÂ§ÑÁêÜ\n  onWindowResize() {\n    this.camera.aspect = this.container.clientWidth / this.container.clientHeight;\n    this.camera.updateProjectionMatrix();\n\n    this.renderer.setSize(this.container.clientWidth, this.container.clientHeight);\n    this.labelRenderer.setSize(this.container.clientWidth, this.container.clientHeight);\n  }\n\n  // Ê∏ÖÁêÜËµÑÊ∫ê\n  dispose() {\n    if (this.animationId) {\n      cancelAnimationFrame(this.animationId);\n    }\n\n    window.removeEventListener('resize', this.onWindowResize.bind(this));\n\n    this.scene.traverse((object) => {\n      if (object.geometry) {\n        object.geometry.dispose();\n      }\n      if (object.material) {\n        if (Array.isArray(object.material)) {\n          object.material.forEach((material) => material.dispose());\n        } else {\n          object.material.dispose();\n        }\n      }\n    });\n\n    this.renderer.dispose();\n    this.labelRenderer.domElement.remove();\n    this.container.removeChild(this.renderer.domElement);\n  }\n}\n\nexport default SceneManager;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/core/services/UserManager.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/core/services/VirtualPowerPlantCenter.js","messages":[{"ruleId":"object-shorthand","severity":2,"message":"Expected property shorthand.","line":298,"column":9,"nodeType":"Property","messageId":"expectedPropertyShorthand","endLine":298,"endColumn":27,"fix":{"range":[8193,8211],"text":"strategy"}},{"ruleId":"object-shorthand","severity":2,"message":"Expected property shorthand.","line":761,"column":11,"nodeType":"Property","messageId":"expectedPropertyShorthand","endLine":761,"endColumn":39,"fix":{"range":[21845,21873],"text":"qualification"}},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":887,"column":42,"nodeType":"Literal","messageId":"noMagic","endLine":887,"endColumn":46},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.8.","line":903,"column":48,"nodeType":"Literal","messageId":"noMagic","endLine":903,"endColumn":51},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.1.","line":904,"column":40,"nodeType":"Literal","messageId":"noMagic","endLine":904,"endColumn":43},{"ruleId":"object-shorthand","severity":2,"message":"Expected property shorthand.","line":933,"column":7,"nodeType":"Property","messageId":"expectedPropertyShorthand","endLine":933,"endColumn":17,"fix":{"range":[26899,26909],"text":"bids"}},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 2000.","line":945,"column":54,"nodeType":"Literal","messageId":"noMagic","endLine":945,"endColumn":58},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 300.","line":952,"column":23,"nodeType":"Literal","messageId":"noMagic","endLine":952,"endColumn":26},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 200.","line":952,"column":45,"nodeType":"Literal","messageId":"noMagic","endLine":952,"endColumn":48},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 50.","line":953,"column":25,"nodeType":"Literal","messageId":"noMagic","endLine":953,"endColumn":27},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":953,"column":46,"nodeType":"Literal","messageId":"noMagic","endLine":953,"endColumn":49},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":961,"column":23,"nodeType":"Literal","messageId":"noMagic","endLine":961,"endColumn":27},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":961,"column":46,"nodeType":"Literal","messageId":"noMagic","endLine":961,"endColumn":49},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 950.","line":962,"column":23,"nodeType":"Literal","messageId":"noMagic","endLine":962,"endColumn":26},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 600.","line":962,"column":45,"nodeType":"Literal","messageId":"noMagic","endLine":962,"endColumn":48},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.2.","line":963,"column":43,"nodeType":"Literal","messageId":"noMagic","endLine":963,"endColumn":46},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.8.","line":964,"column":29,"nodeType":"Literal","messageId":"noMagic","endLine":964,"endColumn":32},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.15.","line":964,"column":51,"nodeType":"Literal","messageId":"noMagic","endLine":964,"endColumn":55},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.6.","line":1033,"column":44,"nodeType":"Literal","messageId":"noMagic","endLine":1033,"endColumn":47},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.3.","line":1037,"column":41,"nodeType":"Literal","messageId":"noMagic","endLine":1037,"endColumn":44},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.1.","line":1041,"column":41,"nodeType":"Literal","messageId":"noMagic","endLine":1041,"endColumn":44},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000000.","line":1079,"column":22,"nodeType":"Literal","messageId":"noMagic","endLine":1079,"endColumn":29},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500000.","line":1079,"column":48,"nodeType":"Literal","messageId":"noMagic","endLine":1079,"endColumn":54},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 15.","line":1088,"column":28,"nodeType":"Literal","messageId":"noMagic","endLine":1088,"endColumn":30},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":1088,"column":49,"nodeType":"Literal","messageId":"noMagic","endLine":1088,"endColumn":51},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 8.","line":1089,"column":23,"nodeType":"Literal","messageId":"noMagic","endLine":1089,"endColumn":24},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 7.","line":1089,"column":43,"nodeType":"Literal","messageId":"noMagic","endLine":1089,"endColumn":44},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5.","line":1090,"column":31,"nodeType":"Literal","messageId":"noMagic","endLine":1090,"endColumn":32},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5.","line":1090,"column":51,"nodeType":"Literal","messageId":"noMagic","endLine":1090,"endColumn":52},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":1091,"column":23,"nodeType":"Literal","messageId":"noMagic","endLine":1091,"endColumn":25},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":1091,"column":44,"nodeType":"Literal","messageId":"noMagic","endLine":1091,"endColumn":46},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":1096,"column":21,"nodeType":"Literal","messageId":"noMagic","endLine":1096,"endColumn":24},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 200.","line":1096,"column":54,"nodeType":"Literal","messageId":"noMagic","endLine":1096,"endColumn":57},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5.","line":1097,"column":21,"nodeType":"Literal","messageId":"noMagic","endLine":1097,"endColumn":22},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":1097,"column":41,"nodeType":"Literal","messageId":"noMagic","endLine":1097,"endColumn":43},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.01.","line":1098,"column":41,"nodeType":"Literal","messageId":"noMagic","endLine":1098,"endColumn":45},{"ruleId":"no-unused-vars","severity":2,"message":"'aggregation' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":1200,"column":21,"nodeType":"Identifier","messageId":"unusedVar","endLine":1200,"endColumn":32},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 800.","line":1214,"column":59,"nodeType":"Literal","messageId":"noMagic","endLine":1214,"endColumn":62},{"ruleId":"no-unused-vars","severity":2,"message":"'resourceId' is defined but never used. Allowed unused args must match /^_/u.","line":1224,"column":35,"nodeType":"Identifier","messageId":"unusedVar","endLine":1224,"endColumn":45},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 50.","line":1226,"column":21,"nodeType":"Literal","messageId":"noMagic","endLine":1226,"endColumn":23},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 50.","line":1226,"column":42,"nodeType":"Literal","messageId":"noMagic","endLine":1226,"endColumn":44},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.95.","line":1227,"column":21,"nodeType":"Literal","messageId":"noMagic","endLine":1227,"endColumn":25},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.05.","line":1227,"column":44,"nodeType":"Literal","messageId":"noMagic","endLine":1227,"endColumn":48},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.9.","line":1228,"column":19,"nodeType":"Literal","messageId":"noMagic","endLine":1228,"endColumn":22},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.05.","line":1228,"column":41,"nodeType":"Literal","messageId":"noMagic","endLine":1228,"endColumn":45},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 25.","line":1229,"column":20,"nodeType":"Literal","messageId":"noMagic","endLine":1229,"endColumn":22},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":1229,"column":41,"nodeType":"Literal","messageId":"noMagic","endLine":1229,"endColumn":43},{"ruleId":"no-unused-vars","severity":2,"message":"'modelId' is defined but never used. Allowed unused args must match /^_/u.","line":1234,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":1234,"endColumn":33},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 50.","line":1241,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":1241,"endColumn":18},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 30.","line":1241,"column":21,"nodeType":"Literal","messageId":"noMagic","endLine":1241,"endColumn":23},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 12.","line":1241,"column":49,"nodeType":"Literal","messageId":"noMagic","endLine":1241,"endColumn":51},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 20.","line":1241,"column":71,"nodeType":"Literal","messageId":"noMagic","endLine":1241,"endColumn":73},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.8.","line":1242,"column":21,"nodeType":"Literal","messageId":"noMagic","endLine":1242,"endColumn":24},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.15.","line":1242,"column":43,"nodeType":"Literal","messageId":"noMagic","endLine":1242,"endColumn":47},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":1253,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":1253,"endColumn":19},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 300.","line":1253,"column":38,"nodeType":"Literal","messageId":"noMagic","endLine":1253,"endColumn":41},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 2000.","line":1258,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":1258,"endColumn":20},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":1258,"column":39,"nodeType":"Literal","messageId":"noMagic","endLine":1258,"endColumn":42},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.5.","line":1303,"column":44,"nodeType":"Literal","messageId":"noMagic","endLine":1303,"endColumn":47}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":53,"fixableErrorCount":3,"fixableWarningCount":0,"source":"/**\n * ËôöÊãüÁîµÂéÇËøêËê•‰∏é‰∫§Êòì‰∏≠ÂøÉ\n * ÂÆûÁé∞ÂàÜÂ∏ÉÂºèËÉΩÊ∫êËÅöÂêà„ÄÅÁîµÂäõÂ∏ÇÂú∫‰∫§Êòì„ÄÅËæÖÂä©ÊúçÂä°ÂíåÊô∫ËÉΩË∞ÉÂ∫¶\n * ÊîØÊåÅÂ§öÁßçÂàÜÂ∏ÉÂºèËÉΩÊ∫êËµÑÊ∫êÁöÑÁªü‰∏ÄÁÆ°ÁêÜÂíå‰ºòÂåñËøêËê•\n */\n\nimport { EventEmitter } from 'events';\nimport logger from '../../shared/utils/logger.js';\nimport { MATH_CONSTANTS } from '../../shared/constants/MathConstants.js';\n\nclass VirtualPowerPlantCenter extends EventEmitter {\n  constructor() {\n    super();\n    this.isInitialized = false;\n    this.distributedResources = new Map();\n    this.aggregationGroups = new Map();\n    this.marketPositions = new Map();\n    this.tradingStrategies = new Map();\n    this.ancillaryServices = new Map();\n    this.forecastModels = new Map();\n    this.optimizationResults = new Map();\n    \n    // ÂàÜÂ∏ÉÂºèËÉΩÊ∫êËµÑÊ∫êÁ±ªÂûã\n    this.resourceTypes = {\n      solar_pv: {\n        name: 'ÂÖâ‰ºèÂèëÁîµ',\n        category: 'renewable_generation',\n        characteristics: {\n          variability: 'high',\n          predictability: 'medium',\n          response_time: 'fast',\n          ramp_rate: 'high'\n        },\n        market_participation: {\n          energy_market: true,\n          capacity_market: false,\n          ancillary_services: ['frequency_regulation']\n        }\n      },\n      wind_turbine: {\n        name: 'È£éÂäõÂèëÁîµ',\n        category: 'renewable_generation',\n        characteristics: {\n          variability: 'very_high',\n          predictability: 'low',\n          response_time: 'medium',\n          ramp_rate: 'medium'\n        },\n        market_participation: {\n          energy_market: true,\n          capacity_market: false,\n          ancillary_services: ['frequency_regulation']\n        }\n      },\n      battery_storage: {\n        name: 'ÁîµÊ±†ÂÇ®ËÉΩ',\n        category: 'energy_storage',\n        characteristics: {\n          variability: 'controllable',\n          predictability: 'high',\n          response_time: 'very_fast',\n          ramp_rate: 'very_high'\n        },\n        market_participation: {\n          energy_market: true,\n          capacity_market: true,\n          ancillary_services: ['frequency_regulation', 'spinning_reserve', 'voltage_support']\n        }\n      },\n      flexible_load: {\n        name: 'ÂèØË∞ÉËäÇË¥üËç∑',\n        category: 'demand_response',\n        characteristics: {\n          variability: 'controllable',\n          predictability: 'high',\n          response_time: 'fast',\n          ramp_rate: 'high'\n        },\n        market_participation: {\n          energy_market: true,\n          capacity_market: true,\n          ancillary_services: ['demand_response', 'spinning_reserve']\n        }\n      },\n      ev_charging: {\n        name: 'ÁîµÂä®Ê±ΩËΩ¶ÂÖÖÁîµ',\n        category: 'flexible_load',\n        characteristics: {\n          variability: 'medium',\n          predictability: 'medium',\n          response_time: 'fast',\n          ramp_rate: 'high'\n        },\n        market_participation: {\n          energy_market: true,\n          capacity_market: false,\n          ancillary_services: ['demand_response']\n        }\n      },\n      chp_unit: {\n        name: 'ÁÉ≠ÁîµËÅî‰∫ß',\n        category: 'controllable_generation',\n        characteristics: {\n          variability: 'controllable',\n          predictability: 'high',\n          response_time: 'medium',\n          ramp_rate: 'medium'\n        },\n        market_participation: {\n          energy_market: true,\n          capacity_market: true,\n          ancillary_services: ['spinning_reserve', 'voltage_support']\n        }\n      }\n    };\n    \n    // ÁîµÂäõÂ∏ÇÂú∫Á±ªÂûã\n    this.marketTypes = {\n      day_ahead: {\n        name: 'Êó•ÂâçÂ∏ÇÂú∫',\n        trading_horizon: '24h',\n        settlement_period: '15min',\n        gate_closure: '12h_before',\n        price_volatility: 'medium'\n      },\n      intraday: {\n        name: 'Êó•ÂÜÖÂ∏ÇÂú∫',\n        trading_horizon: '4h',\n        settlement_period: '15min',\n        gate_closure: '1h_before',\n        price_volatility: 'high'\n      },\n      real_time: {\n        name: 'ÂÆûÊó∂Â∏ÇÂú∫',\n        trading_horizon: '1h',\n        settlement_period: '5min',\n        gate_closure: '5min_before',\n        price_volatility: 'very_high'\n      },\n      capacity: {\n        name: 'ÂÆπÈáèÂ∏ÇÂú∫',\n        trading_horizon: '1year',\n        settlement_period: '1month',\n        gate_closure: '3months_before',\n        price_volatility: 'low'\n      }\n    };\n    \n    // ËæÖÂä©ÊúçÂä°Á±ªÂûã\n    this.ancillaryServiceTypes = {\n      frequency_regulation: {\n        name: 'È¢ëÁéáË∞ÉËäÇ',\n        response_time: '4s',\n        duration: 'continuous',\n        payment_structure: 'capacity_and_energy',\n        technical_requirements: {\n          min_capacity: 1, // MW\n          response_accuracy: 0.95,\n          availability: 0.98\n        }\n      },\n      spinning_reserve: {\n        name: 'ÊóãËΩ¨Â§áÁî®',\n        response_time: '10min',\n        duration: '30min-2h',\n        payment_structure: 'capacity',\n        technical_requirements: {\n          min_capacity: 5,\n          response_accuracy: 0.9,\n          availability: 0.95\n        }\n      },\n      non_spinning_reserve: {\n        name: 'ÈùûÊóãËΩ¨Â§áÁî®',\n        response_time: '30min',\n        duration: '2h',\n        payment_structure: 'capacity',\n        technical_requirements: {\n          min_capacity: 10,\n          response_accuracy: 0.85,\n          availability: 0.9\n        }\n      },\n      voltage_support: {\n        name: 'ÁîµÂéãÊîØÊíë',\n        response_time: '1s',\n        duration: 'continuous',\n        payment_structure: 'capacity',\n        technical_requirements: {\n          min_capacity: 2,\n          response_accuracy: 0.98,\n          availability: 0.99\n        }\n      },\n      black_start: {\n        name: 'ÈªëÂêØÂä®',\n        response_time: '15min',\n        duration: '4h',\n        payment_structure: 'availability',\n        technical_requirements: {\n          min_capacity: 50,\n          self_start_capability: true,\n          availability: 0.99\n        }\n      }\n    };\n    \n    // ËÅöÂêàÁ≠ñÁï•\n    this.aggregationStrategies = {\n      homogeneous: {\n        name: 'ÂêåË¥®ÂåñËÅöÂêà',\n        description: 'ËÅöÂêàÁõ∏ÂêåÁ±ªÂûãÁöÑÂàÜÂ∏ÉÂºèËµÑÊ∫ê',\n        advantages: ['ÁÆ°ÁêÜÁÆÄÂçï', 'È¢ÑÊµãÂáÜÁ°Æ'],\n        disadvantages: ['Â§öÊ†∑ÊÄß‰∏çË∂≥', 'È£éÈô©ÈõÜ‰∏≠']\n      },\n      heterogeneous: {\n        name: 'ÂºÇË¥®ÂåñËÅöÂêà',\n        description: 'ËÅöÂêà‰∏çÂêåÁ±ªÂûãÁöÑÂàÜÂ∏ÉÂºèËµÑÊ∫ê',\n        advantages: ['È£éÈô©ÂàÜÊï£', '‰∫íË°•ÊÄßÂº∫'],\n        disadvantages: ['ÁÆ°ÁêÜÂ§çÊùÇ', 'È¢ÑÊµãÂõ∞Èöæ']\n      },\n      geographic: {\n        name: 'Âú∞ÁêÜ‰ΩçÁΩÆËÅöÂêà',\n        description: 'ÊåâÂú∞ÁêÜ‰ΩçÁΩÆËÅöÂêàÂàÜÂ∏ÉÂºèËµÑÊ∫ê',\n        advantages: ['ÁΩëÁªúÁ∫¶ÊùüËÄÉËôë', 'Êú¨Âú∞Âπ≥Ë°°'],\n        disadvantages: ['ËßÑÊ®°ÂèóÈôê', 'ËµÑÊ∫ê‰∏çÂùá']\n      },\n      market_oriented: {\n        name: 'Â∏ÇÂú∫ÂØºÂêëËÅöÂêà',\n        description: 'ÊåâÂ∏ÇÂú∫ÂèÇ‰∏éËÉΩÂäõËÅöÂêà',\n        advantages: ['Â∏ÇÂú∫ÈÄÇÂ∫îÊÄßÂº∫', 'Êî∂ÁõäÊúÄÂ§ßÂåñ'],\n        disadvantages: ['ÊäÄÊúØË¶ÅÊ±ÇÈ´ò', 'È£éÈô©ËæÉÂ§ß']\n      }\n    };\n    \n    this.init();\n  }\n\n  async init() {\n    try {\n      await this.initializeDistributedResources();\n      await this.setupAggregationGroups();\n      await this.initializeForecastModels();\n      await this.setupTradingStrategies();\n      await this.startRealTimeOperations();\n      \n      this.isInitialized = true;\n      logger.info('ËôöÊãüÁîµÂéÇËøêËê•‰∏é‰∫§Êòì‰∏≠ÂøÉÂàùÂßãÂåñÂÆåÊàê');\n      this.emit('initialized');\n    } catch (error) {\n      logger.error('ËôöÊãüÁîµÂéÇ‰∏≠ÂøÉÂàùÂßãÂåñÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * ËÅöÂêàÂàÜÂ∏ÉÂºèËÉΩÊ∫êËµÑÊ∫ê\n   * @param {string} parkId - Âõ≠Âå∫ID\n   * @param {Array} resources - ÂàÜÂ∏ÉÂºèËµÑÊ∫êÂàóË°®\n   * @param {string} strategy - ËÅöÂêàÁ≠ñÁï•\n   * @returns {Object} ËÅöÂêàÁªìÊûú\n   */\n  async aggregateDistributedResources(parkId, resources, strategy = 'heterogeneous') {\n    try {\n      const aggregationId = this.generateAggregationId(parkId, strategy);\n      \n      // ËµÑÊ∫êËØÑ‰º∞ÂíåÁ≠õÈÄâ\n      const qualifiedResources = await this.assessResourceQualification(resources);\n      \n      // ÊâßË°åËÅöÂêàÁ≠ñÁï•\n      const aggregationResult = await this.executeAggregationStrategy(\n        qualifiedResources,\n        strategy\n      );\n      \n      // ËÆ°ÁÆóËÅöÂêàÂÆπÈáèÂíåÁâπÊÄß\n      const aggregatedCapacity = this.calculateAggregatedCapacity(aggregationResult.groups);\n      \n      // Âª∫Á´ãÊéßÂà∂ÂíåÈÄö‰ø°Êû∂ÊûÑ\n      const controlArchitecture = await this.establishControlArchitecture(aggregationResult.groups);\n      \n      // Âà∂ÂÆöËøêËê•Á≠ñÁï•\n      const operationalStrategy = this.developOperationalStrategy(\n        aggregatedCapacity,\n        controlArchitecture\n      );\n      \n      // ËØÑ‰º∞Â∏ÇÂú∫ÂèÇ‰∏éËÉΩÂäõ\n      const marketCapability = await this.assessMarketCapability(\n        aggregatedCapacity,\n        operationalStrategy\n      );\n      \n      const result = {\n        aggregation_id: aggregationId,\n        park_id: parkId,\n        aggregation_time: new Date().toISOString(),\n        strategy: strategy,\n        \n        // ËÅöÂêàËµÑÊ∫ê\n        qualified_resources: qualifiedResources,\n        aggregation_groups: aggregationResult.groups,\n        \n        // ËÅöÂêàÂÆπÈáè\n        aggregated_capacity: aggregatedCapacity,\n        \n        // ÊéßÂà∂Êû∂ÊûÑ\n        control_architecture: controlArchitecture,\n        \n        // ËøêËê•Á≠ñÁï•\n        operational_strategy: operationalStrategy,\n        \n        // Â∏ÇÂú∫ËÉΩÂäõ\n        market_capability: marketCapability,\n        \n        // ÊäÄÊúØÊåáÊ†á\n        technical_metrics: {\n          total_capacity: aggregatedCapacity.total_capacity,\n          response_time: this.calculateAggregatedResponseTime(aggregationResult.groups),\n          ramp_rate: this.calculateAggregatedRampRate(aggregationResult.groups),\n          availability: this.calculateAggregatedAvailability(aggregationResult.groups),\n          reliability: this.calculateAggregatedReliability(aggregationResult.groups)\n        },\n        \n        // ÁªèÊµéÊåáÊ†á\n        economic_metrics: {\n          aggregation_cost: this.calculateAggregationCost(aggregationResult),\n          operational_cost: this.calculateOperationalCost(operationalStrategy),\n          revenue_potential: this.calculateRevenuePotential(marketCapability),\n          payback_period: this.calculatePaybackPeriod(aggregationResult)\n        },\n        \n        // È£éÈô©ËØÑ‰º∞\n        risk_assessment: {\n          technical_risks: this.assessTechnicalRisks(aggregationResult),\n          market_risks: this.assessMarketRisks(marketCapability),\n          operational_risks: this.assessOperationalRisks(operationalStrategy)\n        }\n      };\n      \n      // Â≠òÂÇ®ËÅöÂêàÁªìÊûú\n      this.aggregationGroups.set(aggregationId, result);\n      \n      logger.info(`ÂàÜÂ∏ÉÂºèËµÑÊ∫êËÅöÂêàÂÆåÊàê: ${aggregationId}, ÊÄªÂÆπÈáè: ${aggregatedCapacity.total_capacity}MW`);\n      this.emit('aggregation_completed', result);\n      \n      return result;\n    } catch (error) {\n      logger.error('ËÅöÂêàÂàÜÂ∏ÉÂºèËÉΩÊ∫êËµÑÊ∫êÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * ÊâßË°åÁîµÂäõÂ∏ÇÂú∫‰∫§Êòì\n   * @param {string} aggregationId - ËÅöÂêàID\n   * @param {string} marketType - Â∏ÇÂú∫Á±ªÂûã\n   * @param {Object} tradingParams - ‰∫§ÊòìÂèÇÊï∞\n   * @returns {Object} ‰∫§ÊòìÁªìÊûú\n   */\n  async executeMarketTrading(aggregationId, marketType, tradingParams) {\n    try {\n      const tradingId = this.generateTradingId(aggregationId, marketType);\n      const aggregation = this.aggregationGroups.get(aggregationId);\n      \n      if (!aggregation) {\n        throw new Error(`ËÅöÂêàÁªÑ‰∏çÂ≠òÂú®: ${aggregationId}`);\n      }\n      \n      // Ëé∑ÂèñÂ∏ÇÂú∫‰ø°ÊÅØ\n      const marketInfo = await this.getMarketInformation(marketType);\n      \n      // ÁîüÊàêÂäüÁéáÈ¢ÑÊµã\n      const powerForecast = await this.generatePowerForecast(\n        aggregation,\n        marketInfo.trading_horizon\n      );\n      \n      // Âà∂ÂÆöÊäïÊ†áÁ≠ñÁï•\n      const biddingStrategy = await this.developBiddingStrategy(\n        aggregation,\n        marketInfo,\n        powerForecast,\n        tradingParams\n      );\n      \n      // ÊâßË°åÊäïÊ†á\n      const bidSubmission = await this.submitBids(\n        tradingId,\n        marketType,\n        biddingStrategy\n      );\n      \n      // Á≠âÂæÖÂ∏ÇÂú∫Âá∫Ê∏Ö\n      const marketClearing = await this.waitForMarketClearing(\n        tradingId,\n        marketType\n      );\n      \n      // ÂàÜÊûê‰∫§ÊòìÁªìÊûú\n      const tradingAnalysis = this.analyzeTradingResults(\n        bidSubmission,\n        marketClearing,\n        powerForecast\n      );\n      \n      // Êõ¥Êñ∞Â∏ÇÂú∫Â§¥ÂØ∏\n      await this.updateMarketPositions(\n        aggregationId,\n        marketType,\n        marketClearing\n      );\n      \n      const result = {\n        trading_id: tradingId,\n        aggregation_id: aggregationId,\n        market_type: marketType,\n        trading_time: new Date().toISOString(),\n        \n        // Â∏ÇÂú∫‰ø°ÊÅØ\n        market_info: marketInfo,\n        \n        // ÂäüÁéáÈ¢ÑÊµã\n        power_forecast: powerForecast,\n        \n        // ÊäïÊ†áÁ≠ñÁï•\n        bidding_strategy: biddingStrategy,\n        \n        // ÊäïÊ†áÊèê‰∫§\n        bid_submission: bidSubmission,\n        \n        // Â∏ÇÂú∫Âá∫Ê∏Ö\n        market_clearing: marketClearing,\n        \n        // ‰∫§ÊòìÂàÜÊûê\n        trading_analysis: tradingAnalysis,\n        \n        // Ë¥¢Âä°ÁªìÊûú\n        financial_results: {\n          revenue: tradingAnalysis.total_revenue,\n          cost: tradingAnalysis.total_cost,\n          profit: tradingAnalysis.net_profit,\n          margin: tradingAnalysis.profit_margin\n        },\n        \n        // ÊâßË°åËÆ°Âàí\n        execution_plan: this.generateExecutionPlan(\n          marketClearing,\n          aggregation\n        ),\n        \n        // È£éÈô©ÊåáÊ†á\n        risk_metrics: {\n          price_risk: tradingAnalysis.price_risk,\n          volume_risk: tradingAnalysis.volume_risk,\n          execution_risk: tradingAnalysis.execution_risk\n        }\n      };\n      \n      // Â≠òÂÇ®‰∫§ÊòìÁªìÊûú\n      this.marketPositions.set(tradingId, result);\n      \n      logger.info(`ÁîµÂäõÂ∏ÇÂú∫‰∫§ÊòìÂÆåÊàê: ${tradingId}, Êî∂Áõä: ${result.financial_results.profit}‰∏áÂÖÉ`);\n      this.emit('trading_completed', result);\n      \n      return result;\n    } catch (error) {\n      logger.error('ÊâßË°åÁîµÂäõÂ∏ÇÂú∫‰∫§ÊòìÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Êèê‰æõËæÖÂä©ÊúçÂä°\n   * @param {string} aggregationId - ËÅöÂêàID\n   * @param {string} serviceType - ËæÖÂä©ÊúçÂä°Á±ªÂûã\n   * @param {Object} serviceParams - ÊúçÂä°ÂèÇÊï∞\n   * @returns {Object} ÊúçÂä°ÁªìÊûú\n   */\n  async provideAncillaryServices(aggregationId, serviceType, serviceParams) {\n    try {\n      const serviceId = this.generateServiceId(aggregationId, serviceType);\n      const aggregation = this.aggregationGroups.get(aggregationId);\n      \n      if (!aggregation) {\n        throw new Error(`ËÅöÂêàÁªÑ‰∏çÂ≠òÂú®: ${aggregationId}`);\n      }\n      \n      // È™åËØÅÊúçÂä°ËÉΩÂäõ\n      const serviceCapability = await this.verifyServiceCapability(\n        aggregation,\n        serviceType\n      );\n      \n      if (!serviceCapability.qualified) {\n        throw new Error(`‰∏çÊª°Ë∂≥${serviceType}ÊúçÂä°Ë¶ÅÊ±Ç`);\n      }\n      \n      // Âà∂ÂÆöÊúçÂä°Á≠ñÁï•\n      const serviceStrategy = await this.developServiceStrategy(\n        aggregation,\n        serviceType,\n        serviceParams\n      );\n      \n      // ËµÑÊ∫êË∞ÉÂ∫¶ÂíåÊéßÂà∂\n      const resourceScheduling = await this.scheduleResourcesForService(\n        aggregation,\n        serviceStrategy\n      );\n      \n      // ÊâßË°åÊúçÂä°\n      const serviceExecution = await this.executeAncillaryService(\n        serviceId,\n        serviceType,\n        resourceScheduling\n      );\n      \n      // ÁõëÊéßÊúçÂä°ÊÄßËÉΩ\n      const performanceMonitoring = await this.monitorServicePerformance(\n        serviceId,\n        serviceType,\n        serviceExecution\n      );\n      \n      // ËÆ°ÁÆóÊúçÂä°Êî∂Áõä\n      const serviceRevenue = this.calculateServiceRevenue(\n        serviceType,\n        performanceMonitoring,\n        serviceParams\n      );\n      \n      const result = {\n        service_id: serviceId,\n        aggregation_id: aggregationId,\n        service_type: serviceType,\n        service_time: new Date().toISOString(),\n        \n        // ÊúçÂä°ËÉΩÂäõ\n        service_capability: serviceCapability,\n        \n        // ÊúçÂä°Á≠ñÁï•\n        service_strategy: serviceStrategy,\n        \n        // ËµÑÊ∫êË∞ÉÂ∫¶\n        resource_scheduling: resourceScheduling,\n        \n        // ÊúçÂä°ÊâßË°å\n        service_execution: serviceExecution,\n        \n        // ÊÄßËÉΩÁõëÊéß\n        performance_monitoring: performanceMonitoring,\n        \n        // ÊúçÂä°Êî∂Áõä\n        service_revenue: serviceRevenue,\n        \n        // ÊäÄÊúØÊÄßËÉΩ\n        technical_performance: {\n          response_accuracy: performanceMonitoring.response_accuracy,\n          response_time: performanceMonitoring.actual_response_time,\n          availability: performanceMonitoring.service_availability,\n          reliability: performanceMonitoring.service_reliability\n        },\n        \n        // ÁªèÊµéÊÄßËÉΩ\n        economic_performance: {\n          capacity_payment: serviceRevenue.capacity_payment,\n          energy_payment: serviceRevenue.energy_payment,\n          performance_bonus: serviceRevenue.performance_bonus,\n          total_revenue: serviceRevenue.total_revenue,\n          service_cost: serviceRevenue.service_cost,\n          net_profit: serviceRevenue.net_profit\n        },\n        \n        // ÂêàËßÑÊÄßÊ£ÄÊü•\n        compliance_check: {\n          technical_compliance: this.checkTechnicalCompliance(performanceMonitoring, serviceType),\n          market_compliance: this.checkMarketCompliance(serviceExecution, serviceType),\n          regulatory_compliance: this.checkRegulatoryCompliance(result, serviceType)\n        }\n      };\n      \n      // Â≠òÂÇ®ÊúçÂä°ÁªìÊûú\n      this.ancillaryServices.set(serviceId, result);\n      \n      logger.info(`ËæÖÂä©ÊúçÂä°Êèê‰æõÂÆåÊàê: ${serviceId}, Êî∂Áõä: ${result.economic_performance.net_profit}‰∏áÂÖÉ`);\n      this.emit('ancillary_service_completed', result);\n      \n      return result;\n    } catch (error) {\n      logger.error('Êèê‰æõËæÖÂä©ÊúçÂä°Â§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * ‰ºòÂåñËôöÊãüÁîµÂéÇËøêËê•\n   * @param {string} aggregationId - ËÅöÂêàID\n   * @param {Object} optimizationParams - ‰ºòÂåñÂèÇÊï∞\n   * @returns {Object} ‰ºòÂåñÁªìÊûú\n   */\n  async optimizeVPPOperation(aggregationId, optimizationParams) {\n    try {\n      const optimizationId = this.generateOptimizationId(aggregationId);\n      const aggregation = this.aggregationGroups.get(aggregationId);\n      \n      if (!aggregation) {\n        throw new Error(`ËÅöÂêàÁªÑ‰∏çÂ≠òÂú®: ${aggregationId}`);\n      }\n      \n      // Ëé∑Âèñ‰ºòÂåñÊó∂Èó¥ËåÉÂõ¥ÂÜÖÁöÑÈ¢ÑÊµãÊï∞ÊçÆ\n      const forecastData = await this.getOptimizationForecastData(\n        aggregation,\n        optimizationParams.time_horizon\n      );\n      \n      // ÊûÑÂª∫‰ºòÂåñÈóÆÈ¢ò\n      const optimizationProblem = this.buildVPPOptimizationProblem(\n        aggregation,\n        forecastData,\n        optimizationParams\n      );\n      \n      // ÊâßË°åÂ§öÁõÆÊ†á‰ºòÂåñ\n      const optimizationSolution = await this.solveVPPOptimization(\n        optimizationProblem\n      );\n      \n      // ÁîüÊàêËøêËê•ËÆ°Âàí\n      const operationalPlan = this.generateOperationalPlan(\n        optimizationSolution,\n        aggregation\n      );\n      \n      // È£éÈô©ËØÑ‰º∞ÂíåË∞ÉÊï¥\n      const riskAdjustedPlan = await this.adjustPlanForRisks(\n        operationalPlan,\n        optimizationParams\n      );\n      \n      // Âà∂ÂÆöÂ∫îÊÄ•È¢ÑÊ°à\n      const contingencyPlans = this.developContingencyPlans(\n        riskAdjustedPlan,\n        aggregation\n      );\n      \n      const result = {\n        optimization_id: optimizationId,\n        aggregation_id: aggregationId,\n        optimization_time: new Date().toISOString(),\n        time_horizon: optimizationParams.time_horizon,\n        \n        // È¢ÑÊµãÊï∞ÊçÆ\n        forecast_data: forecastData,\n        \n        // ‰ºòÂåñÈóÆÈ¢ò\n        optimization_problem: {\n          objective_functions: optimizationProblem.objectives,\n          constraints: optimizationProblem.constraints,\n          decision_variables: optimizationProblem.variables\n        },\n        \n        // ‰ºòÂåñËß£\n        optimization_solution: optimizationSolution,\n        \n        // ËøêËê•ËÆ°Âàí\n        operational_plan: riskAdjustedPlan,\n        \n        // Â∫îÊÄ•È¢ÑÊ°à\n        contingency_plans: contingencyPlans,\n        \n        // È¢ÑÊúüÊïàÁõä\n        expected_benefits: {\n          revenue_optimization: optimizationSolution.revenue_improvement,\n          cost_reduction: optimizationSolution.cost_reduction,\n          efficiency_gain: optimizationSolution.efficiency_improvement,\n          risk_mitigation: optimizationSolution.risk_reduction\n        },\n        \n        // ÂÖ≥ÈîÆÁª©ÊïàÊåáÊ†á\n        kpis: {\n          capacity_factor: this.calculateCapacityFactor(riskAdjustedPlan),\n          revenue_per_mw: this.calculateRevenuePerMW(riskAdjustedPlan),\n          operational_efficiency: this.calculateOperationalEfficiency(riskAdjustedPlan),\n          market_participation_rate: this.calculateMarketParticipationRate(riskAdjustedPlan)\n        },\n        \n        // ÂÆûÊñΩÊåáÂØº\n        implementation_guidance: {\n          execution_sequence: this.defineExecutionSequence(riskAdjustedPlan),\n          resource_allocation: this.defineResourceAllocation(riskAdjustedPlan),\n          monitoring_points: this.defineMonitoringPoints(riskAdjustedPlan),\n          success_criteria: this.defineSuccessCriteria(optimizationParams)\n        }\n      };\n      \n      // Â≠òÂÇ®‰ºòÂåñÁªìÊûú\n      this.optimizationResults.set(optimizationId, result);\n      \n      logger.info(`ËôöÊãüÁîµÂéÇËøêËê•‰ºòÂåñÂÆåÊàê: ${optimizationId}, È¢ÑÊúüÊî∂ÁõäÊèêÂçá: ${result.expected_benefits.revenue_optimization}%`);\n      this.emit('vpp_optimization_completed', result);\n      \n      return result;\n    } catch (error) {\n      logger.error('‰ºòÂåñËôöÊãüÁîµÂéÇËøêËê•Â§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * ÂêØÂä®ÂÆûÊó∂ËøêËê•\n   */\n  async startRealTimeOperations() {\n    // ÊØè5ÂàÜÈíüÊõ¥Êñ∞ËµÑÊ∫êÁä∂ÊÄÅ\n    setInterval(async () => {\n      try {\n        await this.updateResourceStatus();\n      } catch (error) {\n        logger.error('Êõ¥Êñ∞ËµÑÊ∫êÁä∂ÊÄÅÂ§±Ë¥•:', error);\n      }\n    }, MATH_CONSTANTS.FIVE * MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.MILLISECONDS_PER_SECOND);\n    \n    // ÊØè15ÂàÜÈíüÊõ¥Êñ∞ÂäüÁéáÈ¢ÑÊµã\n    setInterval(async () => {\n      try {\n        await this.updatePowerForecasts();\n      } catch (error) {\n        logger.error('Êõ¥Êñ∞ÂäüÁéáÈ¢ÑÊµãÂ§±Ë¥•:', error);\n      }\n    }, MATH_CONSTANTS.FIFTEEN * MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.MILLISECONDS_PER_SECOND);\n    \n    // ÊØèÂ∞èÊó∂ÊâßË°åËøêËê•‰ºòÂåñ\n    setInterval(async () => {\n      try {\n        await this.executeHourlyOptimization();\n      } catch (error) {\n        logger.error('ÊâßË°åÂ∞èÊó∂‰ºòÂåñÂ§±Ë¥•:', error);\n      }\n    }, MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.SIXTY * MATH_CONSTANTS.MILLISECONDS_PER_SECOND);\n    \n    // ÂÆûÊó∂ÁõëÊéßÂ∏ÇÂú∫‰ø°Âè∑\n    setInterval(async () => {\n      try {\n        await this.monitorMarketSignals();\n      } catch (error) {\n        logger.error('ÁõëÊéßÂ∏ÇÂú∫‰ø°Âè∑Â§±Ë¥•:', error);\n      }\n    }, MATH_CONSTANTS.FIVE * MATH_CONSTANTS.MILLISECONDS_PER_SECOND * MATH_CONSTANTS.MILLISECONDS_PER_SECOND);\n  }\n\n  // ËµÑÊ∫êËØÑ‰º∞ÂíåËÅöÂêàÊñπÊ≥ï\n  async assessResourceQualification(resources) {\n    const qualified = [];\n    \n    for (const resource of resources) {\n      const qualification = await this.evaluateResourceQualification(resource);\n      \n      if (qualification.qualified) {\n        qualified.push({\n          ...resource,\n          qualification: qualification,\n          market_readiness: this.assessMarketReadiness(resource),\n          technical_capability: this.assessTechnicalCapability(resource)\n        });\n      }\n    }\n    \n    return qualified;\n  }\n\n  async executeAggregationStrategy(resources, strategy) {\n    switch (strategy) {\n      case 'homogeneous':\n        return this.executeHomogeneousAggregation(resources);\n      case 'heterogeneous':\n        return this.executeHeterogeneousAggregation(resources);\n      case 'geographic':\n        return this.executeGeographicAggregation(resources);\n      case 'market_oriented':\n        return this.executeMarketOrientedAggregation(resources);\n      default:\n        throw new Error(`Êú™Áü•ÁöÑËÅöÂêàÁ≠ñÁï•: ${strategy}`);\n    }\n  }\n\n  executeHeterogeneousAggregation(resources) {\n    const groups = [];\n    \n    // Êåâ‰∫íË°•ÊÄßÂàÜÁªÑ\n    const generationResources = resources.filter(r => \n      ['solar_pv', 'wind_turbine', 'chp_unit'].includes(r.type)\n    );\n    const storageResources = resources.filter(r => \n      r.type === 'battery_storage'\n    );\n    const loadResources = resources.filter(r => \n      ['flexible_load', 'ev_charging'].includes(r.type)\n    );\n    \n    // ÂàõÂª∫Âπ≥Ë°°ÁªÑÂêà\n    if (generationResources.length > 0 && storageResources.length > 0) {\n      groups.push({\n        id: 'generation_storage_group',\n        type: 'generation_storage',\n        resources: [...generationResources, ...storageResources],\n        characteristics: {\n          variability: 'medium',\n          controllability: 'high',\n          market_value: 'high'\n        }\n      });\n    }\n    \n    if (loadResources.length > 0) {\n      groups.push({\n        id: 'demand_response_group',\n        type: 'demand_response',\n        resources: loadResources,\n        characteristics: {\n          variability: 'low',\n          controllability: 'high',\n          market_value: 'medium'\n        }\n      });\n    }\n    \n    return { groups, strategy: 'heterogeneous' };\n  }\n\n  calculateAggregatedCapacity(groups) {\n    let totalCapacity = 0;\n    let totalGeneration = 0;\n    let totalStorage = 0;\n    let totalLoad = 0;\n    \n    const capacityByType = {};\n    \n    groups.forEach(group => {\n      group.resources.forEach(resource => {\n        totalCapacity += resource.capacity;\n        \n        if (!capacityByType[resource.type]) {\n          capacityByType[resource.type] = 0;\n        }\n        capacityByType[resource.type] += resource.capacity;\n        \n        switch (resource.category || this.resourceTypes[resource.type]?.category) {\n          case 'renewable_generation':\n          case 'controllable_generation':\n            totalGeneration += resource.capacity;\n            break;\n          case 'energy_storage':\n            totalStorage += resource.capacity;\n            break;\n          case 'demand_response':\n          case 'flexible_load':\n            totalLoad += resource.capacity;\n            break;\n        }\n      });\n    });\n    \n    return {\n      total_capacity: totalCapacity,\n      generation_capacity: totalGeneration,\n      storage_capacity: totalStorage,\n      load_capacity: totalLoad,\n      capacity_by_type: capacityByType,\n      diversity_index: this.calculateDiversityIndex(capacityByType),\n      flexibility_index: this.calculateFlexibilityIndex(groups)\n    };\n  }\n\n  // Â∏ÇÂú∫‰∫§ÊòìÊñπÊ≥ï\n  async developBiddingStrategy(aggregation, marketInfo, forecast, params) {\n    const strategy = {\n      market_type: marketInfo.type,\n      bidding_approach: params.bidding_approach || 'price_taker',\n      risk_tolerance: params.risk_tolerance || 'medium',\n      \n      // ‰ª∑Ê†ºÁ≠ñÁï•\n      price_strategy: {\n        base_price: this.calculateBasePrice(forecast, marketInfo),\n        price_adjustment: this.calculatePriceAdjustment(aggregation, params),\n        price_limits: {\n          min_price: params.min_price || 0,\n          max_price: params.max_price || 1000\n        }\n      },\n      \n      // Êï∞ÈáèÁ≠ñÁï•\n      quantity_strategy: {\n        base_quantity: this.calculateBaseQuantity(aggregation, forecast),\n        quantity_adjustment: this.calculateQuantityAdjustment(params),\n        quantity_limits: {\n          min_quantity: 0,\n          max_quantity: aggregation.aggregated_capacity.total_capacity\n        }\n      },\n      \n      // È£éÈô©ÁÆ°ÁêÜ\n      risk_management: {\n        hedging_ratio: params.hedging_ratio || 0.8,\n        stop_loss: params.stop_loss || 0.1,\n        position_limits: this.calculatePositionLimits(aggregation)\n      }\n    };\n    \n    return strategy;\n  }\n\n  async submitBids(tradingId, marketType, strategy) {\n    const bids = [];\n    \n    // Ê†πÊçÆÁ≠ñÁï•ÁîüÊàêÊäïÊ†áÊõ≤Á∫ø\n    const biddingCurve = this.generateBiddingCurve(strategy);\n    \n    biddingCurve.forEach((point, index) => {\n      bids.push({\n        bid_id: `${tradingId}_${index}`,\n        price: point.price,\n        quantity: point.quantity,\n        type: point.type, // 'buy' or 'sell'\n        time_period: point.time_period,\n        submission_time: new Date().toISOString()\n      });\n    });\n    \n    // Ê®°ÊãüÊäïÊ†áÊèê‰∫§\n    const submission = {\n      trading_id: tradingId,\n      market_type: marketType,\n      bids: bids,\n      submission_time: new Date().toISOString(),\n      status: 'submitted'\n    };\n    \n    logger.info(`ÊäïÊ†áÊèê‰∫§ÂÆåÊàê: ${tradingId}, ÊäïÊ†áÊï∞Èáè: ${bids.length}`);\n    \n    return submission;\n  }\n\n  async waitForMarketClearing(tradingId, marketType) {\n    // Ê®°ÊãüÁ≠âÂæÖÂ∏ÇÂú∫Âá∫Ê∏Ö\n    await new Promise(resolve => setTimeout(resolve, 2000));\n    \n    // Ê®°ÊãüÂ∏ÇÂú∫Âá∫Ê∏ÖÁªìÊûú\n    const clearing = {\n      trading_id: tradingId,\n      market_type: marketType,\n      clearing_time: new Date().toISOString(),\n      clearing_price: 300 + Math.random() * 200, // 300-500ÂÖÉ/MWh\n      cleared_quantity: 50 + Math.random() * 100, // 50-150MW\n      market_status: 'cleared',\n      \n      // ‰∏™‰∫∫ÊäïÊ†áÁªìÊûú\n      bid_results: this.generateBidResults(tradingId),\n      \n      // Â∏ÇÂú∫ÁªüËÆ°\n      market_statistics: {\n        total_supply: 1000 + Math.random() * 500,\n        total_demand: 950 + Math.random() * 600,\n        price_volatility: Math.random() * 0.2,\n        participation_rate: 0.8 + Math.random() * 0.15\n      }\n    };\n    \n    return clearing;\n  }\n\n  // ËæÖÂä©ÊúçÂä°ÊñπÊ≥ï\n  async verifyServiceCapability(aggregation, serviceType) {\n    const requirements = this.ancillaryServiceTypes[serviceType]?.technical_requirements;\n    \n    if (!requirements) {\n      return { qualified: false, reason: 'Êú™Áü•ÁöÑËæÖÂä©ÊúçÂä°Á±ªÂûã' };\n    }\n    \n    const capability = {\n      qualified: true,\n      reasons: [],\n      \n      // ÂÆπÈáèÊ£ÄÊü•\n      capacity_check: {\n        required: requirements.min_capacity,\n        available: aggregation.aggregated_capacity.total_capacity,\n        passed: aggregation.aggregated_capacity.total_capacity >= requirements.min_capacity\n      },\n      \n      // ÂìçÂ∫îÊó∂Èó¥Ê£ÄÊü•\n      response_time_check: {\n        required: requirements.response_time || '10min',\n        available: aggregation.technical_metrics.response_time,\n        passed: this.compareResponseTime(\n          aggregation.technical_metrics.response_time,\n          requirements.response_time\n        )\n      },\n      \n      // ÂèØÁî®ÊÄßÊ£ÄÊü•\n      availability_check: {\n        required: requirements.availability,\n        available: aggregation.technical_metrics.availability,\n        passed: aggregation.technical_metrics.availability >= requirements.availability\n      }\n    };\n    \n    // Ê£ÄÊü•ÊòØÂê¶ÈÄöËøáÊâÄÊúâË¶ÅÊ±Ç\n    if (!capability.capacity_check.passed) {\n      capability.qualified = false;\n      capability.reasons.push('ÂÆπÈáè‰∏çË∂≥');\n    }\n    \n    if (!capability.response_time_check.passed) {\n      capability.qualified = false;\n      capability.reasons.push('ÂìçÂ∫îÊó∂Èó¥‰∏çÊª°Ë∂≥Ë¶ÅÊ±Ç');\n    }\n    \n    if (!capability.availability_check.passed) {\n      capability.qualified = false;\n      capability.reasons.push('ÂèØÁî®ÊÄß‰∏çÊª°Ë∂≥Ë¶ÅÊ±Ç');\n    }\n    \n    return capability;\n  }\n\n  // ‰ºòÂåñÊñπÊ≥ï\n  buildVPPOptimizationProblem(aggregation, forecastData, params) {\n    return {\n      // ÁõÆÊ†áÂáΩÊï∞\n      objectives: {\n        revenue_maximization: {\n          weight: params.revenue_weight || 0.6,\n          function: 'maximize_market_revenue'\n        },\n        cost_minimization: {\n          weight: params.cost_weight || 0.3,\n          function: 'minimize_operational_cost'\n        },\n        risk_minimization: {\n          weight: params.risk_weight || 0.1,\n          function: 'minimize_portfolio_risk'\n        }\n      },\n      \n      // Á∫¶ÊùüÊù°‰ª∂\n      constraints: {\n        power_balance: 'generation + storage_discharge = load + storage_charge',\n        capacity_limits: 'resource_output <= resource_capacity',\n        ramp_rate_limits: 'power_change <= ramp_rate * time_interval',\n        energy_limits: 'storage_energy <= storage_capacity',\n        market_limits: 'bid_quantity <= available_capacity',\n        technical_limits: 'resource_operation within technical_envelope'\n      },\n      \n      // ÂÜ≥Á≠ñÂèòÈáè\n      variables: {\n        generation_schedule: 'continuous',\n        storage_schedule: 'continuous',\n        load_schedule: 'continuous',\n        market_bids: 'continuous',\n        service_provision: 'binary'\n      },\n      \n      // È¢ÑÊµãÊï∞ÊçÆ\n      forecasts: forecastData,\n      \n      // Êó∂Èó¥ËåÉÂõ¥\n      time_horizon: params.time_horizon,\n      time_resolution: params.time_resolution || '15min'\n    };\n  }\n\n  async solveVPPOptimization(problem) {\n    // ÁÆÄÂåñÁöÑ‰ºòÂåñÊ±ÇËß£\n    // ÂÆûÈôÖÂ∫îÁî®‰∏≠Â∫î‰ΩøÁî®‰∏ì‰∏öÁöÑ‰ºòÂåñÊ±ÇËß£Âô®\n    \n    const solution = {\n      optimal_value: 1000000 + Math.random() * 500000, // 100-150‰∏áÂÖÉ\n      \n      // ‰ºòÂåñÁªìÊûú\n      generation_schedule: this.generateOptimalGenerationSchedule(problem),\n      storage_schedule: this.generateOptimalStorageSchedule(problem),\n      market_participation: this.generateOptimalMarketParticipation(problem),\n      service_provision: this.generateOptimalServiceProvision(problem),\n      \n      // ÊÄßËÉΩÊåáÊ†á\n      revenue_improvement: 15 + Math.random() * 10, // 15-25%\n      cost_reduction: 8 + Math.random() * 7, // 8-15%\n      efficiency_improvement: 5 + Math.random() * 5, // 5-10%\n      risk_reduction: 10 + Math.random() * 10, // 10-20%\n      \n      // Ê±ÇËß£‰ø°ÊÅØ\n      solver_info: {\n        algorithm: 'mixed_integer_programming',\n        iterations: 100 + Math.floor(Math.random() * 200),\n        solve_time: 5 + Math.random() * 10, // 5-15Áßí\n        optimality_gap: Math.random() * 0.01 // 0-1%\n      }\n    };\n    \n    return solution;\n  }\n\n  // ËæÖÂä©ÊñπÊ≥ï\n  generateAggregationId(parkId, strategy) {\n    return `VPP_AGG_${parkId}_${strategy}_${Date.now()}`;\n  }\n\n  generateTradingId(aggregationId, marketType) {\n    return `VPP_TRADE_${aggregationId}_${marketType}_${Date.now()}`;\n  }\n\n  generateServiceId(aggregationId, serviceType) {\n    return `VPP_SVC_${aggregationId}_${serviceType}_${Date.now()}`;\n  }\n\n  generateOptimizationId(aggregationId) {\n    return `VPP_OPT_${aggregationId}_${Date.now()}`;\n  }\n\n  // Ê®°ÊãüÊï∞ÊçÆËé∑ÂèñÊñπÊ≥ï\n  async initializeDistributedResources() {\n    const resources = [\n      {\n        id: 'solar_001',\n        type: 'solar_pv',\n        capacity: 100,\n        location: { lat: 39.9042, lng: 116.4074 },\n        owner: 'park_operator'\n      },\n      {\n        id: 'battery_001',\n        type: 'battery_storage',\n        capacity: 50,\n        location: { lat: 39.9042, lng: 116.4074 },\n        owner: 'park_operator'\n      }\n    ];\n    \n    resources.forEach(resource => {\n      this.distributedResources.set(resource.id, resource);\n    });\n    \n    logger.info(`Â∑≤ÂàùÂßãÂåñÂàÜÂ∏ÉÂºèËµÑÊ∫ê ${resources.length} ‰∏™`);\n  }\n\n  async setupAggregationGroups() {\n    // ËÆæÁΩÆÈªòËÆ§ËÅöÂêàÁªÑ\n    logger.info('ËÅöÂêàÁªÑËÆæÁΩÆÂÆåÊàê');\n  }\n\n  async initializeForecastModels() {\n    const models = {\n      solar_forecast: { accuracy: 0.85, horizon: '48h' },\n      wind_forecast: { accuracy: 0.75, horizon: '24h' },\n      load_forecast: { accuracy: 0.9, horizon: '72h' },\n      price_forecast: { accuracy: 0.7, horizon: '24h' }\n    };\n    \n    Object.keys(models).forEach(model => {\n      this.forecastModels.set(model, models[model]);\n    });\n    \n    logger.info('È¢ÑÊµãÊ®°ÂûãÂàùÂßãÂåñÂÆåÊàê');\n  }\n\n  async setupTradingStrategies() {\n    const strategies = {\n      conservative: { risk_tolerance: 'low', return_target: 0.08 },\n      moderate: { risk_tolerance: 'medium', return_target: 0.12 },\n      aggressive: { risk_tolerance: 'high', return_target: 0.18 }\n    };\n    \n    Object.keys(strategies).forEach(strategy => {\n      this.tradingStrategies.set(strategy, strategies[strategy]);\n    });\n    \n    logger.info('‰∫§ÊòìÁ≠ñÁï•ËÆæÁΩÆÂÆåÊàê');\n  }\n\n  async updateResourceStatus() {\n    // Êõ¥Êñ∞ÊâÄÊúâËµÑÊ∫êÁä∂ÊÄÅ\n    for (const [id, resource] of this.distributedResources) {\n      const status = await this.getResourceRealTimeStatus(id);\n      resource.current_status = status;\n    }\n  }\n\n  async updatePowerForecasts() {\n    // Êõ¥Êñ∞ÂäüÁéáÈ¢ÑÊµã\n    for (const [id, model] of this.forecastModels) {\n      const forecast = await this.generateForecast(id);\n      model.latest_forecast = forecast;\n    }\n  }\n\n  async executeHourlyOptimization() {\n    // ÊâßË°åÂ∞èÊó∂‰ºòÂåñ\n    for (const [id, aggregation] of this.aggregationGroups) {\n      try {\n        await this.optimizeVPPOperation(id, { time_horizon: '4h' });\n      } catch (error) {\n        logger.error(`ËÅöÂêàÁªÑ ${id} ‰ºòÂåñÂ§±Ë¥•:`, error);\n      }\n    }\n  }\n\n  async monitorMarketSignals() {\n    // ÁõëÊéßÂ∏ÇÂú∫‰ø°Âè∑\n    const signals = await this.getMarketSignals();\n    \n    signals.forEach(signal => {\n      if (signal.type === 'price_spike' && signal.value > 800) {\n        this.emit('market_alert', {\n          type: 'high_price',\n          value: signal.value,\n          action: 'increase_generation'\n        });\n      }\n    });\n  }\n\n  async getResourceRealTimeStatus(resourceId) {\n    return {\n      power_output: 50 + Math.random() * 50,\n      availability: 0.95 + Math.random() * 0.05,\n      efficiency: 0.9 + Math.random() * 0.05,\n      temperature: 25 + Math.random() * 10,\n      last_update: new Date().toISOString()\n    };\n  }\n\n  async generateForecast(modelId) {\n    const hours = 24;\n    const forecast = [];\n    \n    for (let i = 0; i < hours; i++) {\n      forecast.push({\n        hour: i,\n        value: 50 + 30 * Math.sin(i * Math.PI / 12) + Math.random() * 20,\n        confidence: 0.8 + Math.random() * 0.15\n      });\n    }\n    \n    return forecast;\n  }\n\n  async getMarketSignals() {\n    return [\n      {\n        type: 'price_update',\n        value: 400 + Math.random() * 300,\n        timestamp: new Date().toISOString()\n      },\n      {\n        type: 'demand_forecast',\n        value: 2000 + Math.random() * 500,\n        timestamp: new Date().toISOString()\n      }\n    ];\n  }\n\n  // ÂÖ∂‰ªñËÆ°ÁÆóÊñπÊ≥ïÁöÑÁÆÄÂåñÂÆûÁé∞\n  calculateDiversityIndex(capacityByType) {\n    const types = Object.keys(capacityByType);\n    const totalCapacity = Object.values(capacityByType).reduce((sum, cap) => sum + cap, 0);\n    \n    let diversity = 0;\n    types.forEach(type => {\n      const share = capacityByType[type] / totalCapacity;\n      diversity -= share * Math.log(share);\n    });\n    \n    return diversity / Math.log(types.length); // ÂΩí‰∏ÄÂåñÂà∞0-1\n  }\n\n  calculateFlexibilityIndex(groups) {\n    let totalFlexibility = 0;\n    let totalCapacity = 0;\n    \n    groups.forEach(group => {\n      group.resources.forEach(resource => {\n        const flexibility = this.getResourceFlexibility(resource.type);\n        totalFlexibility += flexibility * resource.capacity;\n        totalCapacity += resource.capacity;\n      });\n    });\n    \n    return totalCapacity > 0 ? totalFlexibility / totalCapacity : 0;\n  }\n\n  getResourceFlexibility(resourceType) {\n    const flexibilityMap = {\n      solar_pv: 0.2,\n      wind_turbine: 0.3,\n      battery_storage: 1.0,\n      flexible_load: 0.8,\n      ev_charging: 0.7,\n      chp_unit: 0.6\n    };\n    \n    return flexibilityMap[resourceType] || 0.5;\n  }\n}\n\nexport default VirtualPowerPlantCenter;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/core/services/batteryOptimization.js","messages":[{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 24.","line":13,"column":50,"nodeType":"Literal","messageId":"noMagic","endLine":13,"endColumn":52},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.001.","line":54,"column":30,"nodeType":"Literal","messageId":"noMagic","endLine":54,"endColumn":35},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":91,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":91,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[2067,2109],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":172,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":172,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[3863,3903],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":187,"column":27,"nodeType":"Literal","messageId":"noMagic","endLine":187,"endColumn":30},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":196,"column":27,"nodeType":"Literal","messageId":"noMagic","endLine":196,"endColumn":30},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":229,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":229,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[5257,5289],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":233,"column":27,"nodeType":"Literal","messageId":"noMagic","endLine":233,"endColumn":30},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":243,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":243,"endColumn":21},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 8.","line":271,"column":17,"nodeType":"Literal","messageId":"noMagic","endLine":271,"endColumn":18},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 22.","line":271,"column":30,"nodeType":"Literal","messageId":"noMagic","endLine":271,"endColumn":32},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1.2.","line":272,"column":13,"nodeType":"Literal","messageId":"noMagic","endLine":272,"endColumn":16},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.3.","line":272,"column":35,"nodeType":"Literal","messageId":"noMagic","endLine":272,"endColumn":38},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.5.","line":273,"column":13,"nodeType":"Literal","messageId":"noMagic","endLine":273,"endColumn":16},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.3.","line":273,"column":35,"nodeType":"Literal","messageId":"noMagic","endLine":273,"endColumn":38},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":282,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":282,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[6508,6550],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":301,"column":9,"nodeType":"Literal","messageId":"noMagic","endLine":301,"endColumn":12},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 24.","line":301,"column":32,"nodeType":"Literal","messageId":"noMagic","endLine":301,"endColumn":34},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 150.","line":301,"column":53,"nodeType":"Literal","messageId":"noMagic","endLine":301,"endColumn":56},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":301,"column":76,"nodeType":"Literal","messageId":"noMagic","endLine":301,"endColumn":79},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 50.","line":301,"column":82,"nodeType":"Literal","messageId":"noMagic","endLine":301,"endColumn":84},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":310,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":310,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[7261,7306],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.3.","line":324,"column":39,"nodeType":"Literal","messageId":"noMagic","endLine":324,"endColumn":42},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.8.","line":326,"column":47,"nodeType":"Literal","messageId":"noMagic","endLine":326,"endColumn":50},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.7.","line":337,"column":29,"nodeType":"Literal","messageId":"noMagic","endLine":337,"endColumn":32},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 8.","line":337,"column":35,"nodeType":"Literal","messageId":"noMagic","endLine":337,"endColumn":36},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.9.","line":337,"column":47,"nodeType":"Literal","messageId":"noMagic","endLine":337,"endColumn":50},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5.","line":337,"column":53,"nodeType":"Literal","messageId":"noMagic","endLine":337,"endColumn":54},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.7.","line":339,"column":47,"nodeType":"Literal","messageId":"noMagic","endLine":339,"endColumn":50},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.2.","line":341,"column":54,"nodeType":"Literal","messageId":"noMagic","endLine":341,"endColumn":57},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1.2.","line":352,"column":29,"nodeType":"Literal","messageId":"noMagic","endLine":352,"endColumn":32},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 9.","line":352,"column":35,"nodeType":"Literal","messageId":"noMagic","endLine":352,"endColumn":36},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 6.","line":352,"column":53,"nodeType":"Literal","messageId":"noMagic","endLine":352,"endColumn":54},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 3.","line":352,"column":57,"nodeType":"Literal","messageId":"noMagic","endLine":352,"endColumn":58},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.8.","line":394,"column":51,"nodeType":"Literal","messageId":"noMagic","endLine":394,"endColumn":54},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":395,"column":67,"nodeType":"Literal","messageId":"noMagic","endLine":395,"endColumn":70},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.2.","line":401,"column":17,"nodeType":"Literal","messageId":"noMagic","endLine":401,"endColumn":20},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.3.","line":401,"column":31,"nodeType":"Literal","messageId":"noMagic","endLine":401,"endColumn":34},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 7.","line":401,"column":65,"nodeType":"Literal","messageId":"noMagic","endLine":401,"endColumn":66},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.8.","line":411,"column":24,"nodeType":"Literal","messageId":"noMagic","endLine":411,"endColumn":27},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.7.","line":411,"column":38,"nodeType":"Literal","messageId":"noMagic","endLine":411,"endColumn":41},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 7.","line":411,"column":72,"nodeType":"Literal","messageId":"noMagic","endLine":411,"endColumn":73},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.5.","line":421,"column":50,"nodeType":"Literal","messageId":"noMagic","endLine":421,"endColumn":53},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.6.","line":430,"column":51,"nodeType":"Literal","messageId":"noMagic","endLine":430,"endColumn":54},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 24.","line":439,"column":26,"nodeType":"Literal","messageId":"noMagic","endLine":439,"endColumn":28},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":449,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":449,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[12078,12122],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 24.","line":458,"column":54,"nodeType":"Literal","messageId":"noMagic","endLine":458,"endColumn":56},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":487,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":487,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[13019,13063],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":501,"column":11,"nodeType":"Literal","messageId":"noMagic","endLine":501,"endColumn":13},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":501,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":501,"endColumn":18},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":501,"column":21,"nodeType":"Literal","messageId":"noMagic","endLine":501,"endColumn":25},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 24.","line":502,"column":11,"nodeType":"Literal","messageId":"noMagic","endLine":502,"endColumn":13},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":502,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":502,"endColumn":18},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":502,"column":21,"nodeType":"Literal","messageId":"noMagic","endLine":502,"endColumn":23},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":502,"column":26,"nodeType":"Literal","messageId":"noMagic","endLine":502,"endColumn":30},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 7.","line":503,"column":11,"nodeType":"Literal","messageId":"noMagic","endLine":503,"endColumn":12},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 24.","line":503,"column":15,"nodeType":"Literal","messageId":"noMagic","endLine":503,"endColumn":17},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":503,"column":20,"nodeType":"Literal","messageId":"noMagic","endLine":503,"endColumn":22},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":503,"column":25,"nodeType":"Literal","messageId":"noMagic","endLine":503,"endColumn":27},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":503,"column":30,"nodeType":"Literal","messageId":"noMagic","endLine":503,"endColumn":34},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 24.","line":590,"column":23,"nodeType":"Literal","messageId":"noMagic","endLine":590,"endColumn":25},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 4.","line":590,"column":27,"nodeType":"Literal","messageId":"noMagic","endLine":590,"endColumn":28},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.001.","line":622,"column":30,"nodeType":"Literal","messageId":"noMagic","endLine":622,"endColumn":35},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.8.","line":641,"column":52,"nodeType":"Literal","messageId":"noMagic","endLine":641,"endColumn":55},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 24.","line":648,"column":80,"nodeType":"Literal","messageId":"noMagic","endLine":648,"endColumn":82},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 4.","line":648,"column":84,"nodeType":"Literal","messageId":"noMagic","endLine":648,"endColumn":85},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 24.","line":649,"column":74,"nodeType":"Literal","messageId":"noMagic","endLine":649,"endColumn":76},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 4.","line":649,"column":78,"nodeType":"Literal","messageId":"noMagic","endLine":649,"endColumn":79},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":675,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":675,"endColumn":14,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[17508,17613],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":691,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":691,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[17906,17941],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":699,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":699,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[18115,18155],"text":""},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":71,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// ÂºïÂÖ•ÂøÖË¶ÅÁöÑÊ®°Âùó\nimport * as tf from '@tensorflow/tfjs-node';\nimport fs from 'fs/promises';\n\n// ÂÇ®ËÉΩËÆæÂ§áÁä∂ÊÄÅÊ®°ÊãüÊï∞ÊçÆ\nconst batteryStatusData = [\n  { timestamp: '2025-06-01T00:00:00Z', soc: 0.8, power: 50, voltage: 400 },\n  { timestamp: '2025-06-01T01:00:00Z', soc: 0.75, power: 60, voltage: 395 }\n  // ... Êõ¥Â§öÂéÜÂè≤Êï∞ÊçÆ\n];\n\n// ÂáÜÂ§áËÆ≠ÁªÉÊï∞ÊçÆ\nfunction _prepareTrainingData(data, windowSize = 24) {\n  const xs = [];\n  const ys = [];\n\n  for (let i = windowSize; i < data.length; i++) {\n    const window = data.slice(i - windowSize, i).map((d) => d.soc);\n    xs.push(window);\n    ys.push(data[i].soc);\n  }\n\n  return {\n    xs: tf.tensor2d(xs, [xs.length, windowSize]),\n    ys: tf.tensor2d(ys, [ys.length, 1])\n  };\n}\n\n// ÂàõÂª∫LSTMÊ®°Âûã\n\n// TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 21 Ë°å)\n\n// TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 21 Ë°å)\n\n// TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 21 Ë°å)\n\n// TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 21 Ë°å)\n\nfunction _createModel(inputShape) {\n  const model = tf.sequential();\n\n  model.add(\n    tf.layers.lstm({\n      units: 64,\n      inputShape,\n      returnSequences: false\n    })\n  );\n\n  model.add(tf.layers.dense({ units: 32, activation: 'relu' }));\n  model.add(tf.layers.dense({ units: 1 }));\n\n  model.compile({\n    optimizer: tf.train.adam(0.001),\n    loss: 'meanSquaredError'\n  });\n\n  return model;\n}\n\n// Âä†ËΩΩËÆ≠ÁªÉÊï∞ÊçÆ\nasync function _loadMockTrainingData() {\n  const fs = require('fs').promises;\n  const csv = require('csv-parser');\n  const results = [];\n\n  try {\n    const data = await fs.readFile(\n      '/Users/xunan/Documents/WebStormProjects/0C/test-data/battery_data.csv',\n      'utf8'\n    );\n\n    // Ëß£ÊûêCSVÊï∞ÊçÆ\n    return new Promise((resolve, reject) => {\n      require('stream')\n        .Readable.from(data)\n        .pipe(csv())\n        .on('data', (data) =>\n          results.push({\n            timestamp: data.timestamp,\n            soc: parseFloat(data.soc),\n            power: parseFloat(data.power),\n            voltage: parseFloat(data.voltage),\n            temperature: parseFloat(data.temperature)\n          })\n        )\n        .on('end', () => resolve(results))\n        .on('error', reject);\n    });\n  } catch (error) {\n    console.error('Âä†ËΩΩËÆ≠ÁªÉÊï∞ÊçÆÂ§±Ë¥•:', error.message);\n    throw new Error('TRAINING_DATA_LOAD_FAILED');\n  }\n}\n\n// È¢ÑÂ§ÑÁêÜÊï∞ÊçÆ\nfunction preprocessTrainingData(data) {\n  // Ê£ÄÊü•Êï∞ÊçÆÊúâÊïàÊÄß\n  if (!data || data.length === 0) {\n    throw new Error('EMPTY_TRAINING_DATA');\n  }\n\n  // ÊèêÂèñÁâπÂæÅÂíåÊ†áÁ≠æ\n  const features = [];\n  const labels = [];\n\n  // ‰ΩøÁî®ËøáÂéª24‰∏™Êó∂Èó¥Ê≠•ÁöÑÊï∞ÊçÆÈ¢ÑÊµã‰∏ã‰∏Ä‰∏™Êó∂Èó¥Ê≠•ÁöÑSOC\n  const windowSize = 24;\n\n  for (let i = windowSize; i < data.length; i++) {\n    // ÊèêÂèñÁâπÂæÅÁ™óÂè£\n    const window = data.slice(i - windowSize, i);\n    const featureRow = [];\n\n    // ‰∏∫ÊØè‰∏™Êó∂Èó¥Ê≠•ÊèêÂèñÁâπÂæÅ\n    window.forEach((point) => {\n      featureRow.push(point.soc);\n      featureRow.push(point.power);\n      featureRow.push(point.voltage);\n      featureRow.push(point.temperature);\n    });\n\n    features.push(featureRow);\n    labels.push([data[i].soc]); // È¢ÑÊµã‰∏ã‰∏Ä‰∏™Êó∂Èó¥Ê≠•ÁöÑSOC\n  }\n\n  // Êï∞ÊçÆÂΩí‰∏ÄÂåñ\n  const featureTensor = tf.tensor2d(features);\n  const labelTensor = tf.tensor2d(labels);\n\n  // ËÆ°ÁÆóÁâπÂæÅÁöÑÂùáÂÄºÂíåÊ†áÂáÜÂ∑Æ\n  const featureMean = featureTensor.mean(0);\n  const featureStd = featureTensor.std(0);\n\n  // Ê†áÂáÜÂåñÁâπÂæÅ (ÈÅøÂÖçÈô§‰ª•Èõ∂)\n  const epsilon = 1e-8;\n  const normalizedFeatures = featureTensor.sub(featureMean).div(featureStd.add(epsilon));\n\n  // ‰øùÂ≠òÂΩí‰∏ÄÂåñÂèÇÊï∞‰æõÊé®ÁêÜÊó∂‰ΩøÁî®\n  // ‰øùÂ≠òÂΩí‰∏ÄÂåñÂèÇÊï∞‰æõÊé®ÁêÜÊó∂‰ΩøÁî®\n  (async () => {\n    global.batteryModelStats = {\n      mean: await featureMean.array(),\n      std: await featureStd.array()\n    };\n  })();\n\n  return {\n    features: normalizedFeatures,\n    labels: labelTensor\n  };\n}\n\n// ËÆ≠ÁªÉÂÇ®ËÉΩ‰ºòÂåñÊ®°Âûã\nexport async function trainModel() {\n  try {\n    // Âä†ËΩΩËÆ≠ÁªÉÊï∞ÊçÆ\n    const data = await loadTrainingData();\n\n    // È¢ÑÂ§ÑÁêÜÊï∞ÊçÆ\n    const { features, labels } = preprocessTrainingData(data);\n\n    // ÂàõÂª∫Ê®°Âûã\n    const model = createBatteryOptimizationModel();\n\n    // ËÆ≠ÁªÉÊ®°Âûã\n    await trainBatteryOptimizationModel(model, features, labels);\n\n    // ‰øùÂ≠òÊ®°Âûã\n    await saveModel(model);\n  } catch (error) {\n    console.error('Ê®°ÂûãËÆ≠ÁªÉÂ§±Ë¥•:', error.message);\n    throw error;\n  }\n}\n\n// ÂàõÂª∫ÂÇ®ËÉΩ‰ºòÂåñË∑ØÁî±\nexport function setupBatteryRoutes(app, authenticateToken) {\n  // ÂÇ®ËÉΩ‰ºòÂåñÊé•Âè£\n  app.get('/battery/optimization', authenticateToken(), async (req, res) => {\n    try {\n      // Ëé∑ÂèñÊü•ËØ¢ÂèÇÊï∞\n      const { buildingId, start_time, end_time, interval } = req.query;\n\n      // ÂèÇÊï∞È™åËØÅ\n      if (!buildingId) {\n        return res.status(400).json({\n          error: {\n            code: 'MISSING_BUILDING_ID',\n            message: 'Áº∫Â∞ëÂøÖË¶ÅÂèÇÊï∞: buildingId'\n          }\n        });\n      }\n\n      if (!start_time || !end_time) {\n        return res.status(400).json({\n          error: {\n            code: 'INVALID_TIME_RANGE',\n            message: 'Áº∫Â∞ëÂøÖË¶ÅÊó∂Èó¥ÂèÇÊï∞: start_time, end_time'\n          }\n        });\n      }\n\n      // Ë∞ÉÁî®‰ºòÂåñÊ®°Âûã - ÊöÇÊó∂ËøîÂõûÊ®°ÊãüÊï∞ÊçÆ\n      const optimization = {\n        buildingId,\n        timeRange: { start_time, end_time },\n        interval: interval || '1h',\n        strategies: [\n          {\n            timestamp: start_time,\n            strategy: 'charge',\n            description: `Âª∫ËÆÆÂú®‰ΩéÁîµ‰ª∑Êó∂ÊÆµÂÖÖÁîµ`,\n            priority: 8,\n            economicImpact: 'È¢ÑËÆ°ËäÇÁúÅÊàêÊú¨: 50ÂÖÉ',\n            carbonImpact: 'È¢ÑËÆ°ÂáèÂ∞ëÁ¢≥ÊéíÊîæ: 25kgCO2'\n          }\n        ],\n        summary: {\n          totalSavings: 150,\n          carbonReduction: 75,\n          efficiency: 0.92\n        }\n      };\n\n      // ËøîÂõû‰ºòÂåñÁªìÊûú\n      res.json(optimization);\n    } catch (error) {\n      console.error('ÂÇ®ËÉΩ‰ºòÂåñÈîôËØØ:', error);\n\n      // Â¶ÇÊûúÂ∑≤ÁªèÊòØÁâπÂÆöÈîôËØØÂìçÂ∫îÔºåÁõ¥Êé•ËøîÂõû\n      if (error.code && error.message) {\n        return res.status(500).json({\n          error: {\n            code: error.code,\n            message: error.message,\n            details: error.stack\n          }\n        });\n      }\n\n      // Âê¶ÂàôËøîÂõûÈÄöÁî®ÈîôËØØ\n      res.status(500).json({\n        error: {\n          code: 'INTERNAL_SERVER_ERROR',\n          message: 'ÂÇ®ËÉΩ‰ºòÂåñÂ§±Ë¥•',\n          details: error.message\n        }\n      });\n    }\n  });\n\n  // ËøîÂõûappÂØπË±°‰ª•‰æøÈìæÂºèË∞ÉÁî®\n  return app;\n}\n\n// Ëé∑ÂèñÁîµ‰ª∑Êï∞ÊçÆ\nasync function getElectricityPrices(startTime, endTime) {\n  try {\n    // ÂÆûÈôÖÂ∫îÁî®‰∏≠Â∫î‰ªéAPIËé∑ÂèñÂÆûÊó∂Áîµ‰ª∑Êï∞ÊçÆ\n    // Ê≠§Â§Ñ‰ΩøÁî®Ê®°ÊãüÊï∞ÊçÆ\n    const prices = [];\n    const start = new Date(startTime);\n    const end = new Date(endTime);\n\n    // ÁîüÊàêÊØèÂ∞èÊó∂Áîµ‰ª∑ (0.5-1.5ÂÖÉ/Â∫¶)\n    for (let d = new Date(start); d <= new Date(end); d.setHours(d.getHours() + 1)) {\n      const hour = d.getHours();\n      // Ê®°ÊãüÂ≥∞Ë∞∑Áîµ‰ª∑: Â≥∞Êó∂(8-22ÁÇπ)È´ò‰ª∑ÔºåË∞∑Êó∂(22-8ÁÇπ)‰Ωé‰ª∑\n      const price =\n        hour >= 8 && hour <= 22\n          ? 1.2 + Math.random() * 0.3 // Â≥∞Êó∂: 1.2-1.5ÂÖÉ\n          : 0.5 + Math.random() * 0.3; // Ë∞∑Êó∂: 0.5-0.8ÂÖÉ\n\n      prices.push({\n        timestamp: d.toISOString(),\n        price: parseFloat(price.toFixed(2))\n      });\n    }\n    return prices;\n  } catch (error) {\n    console.error('Ëé∑ÂèñÁîµ‰ª∑Êï∞ÊçÆÂ§±Ë¥•:', error.message);\n    return [];\n  }\n}\n\n// Ëé∑ÂèñÁ¢≥ÊéíÊîæÂõ†Â≠êÊï∞ÊçÆ\nasync function getCarbonIntensity(startTime, endTime) {\n  try {\n    // ÂÆûÈôÖÂ∫îÁî®‰∏≠Â∫î‰ªéAPIËé∑ÂèñÂÆûÊó∂Á¢≥ÊéíÊîæÂõ†Â≠êÊï∞ÊçÆ\n    // Ê≠§Â§Ñ‰ΩøÁî®Ê®°ÊãüÊï∞ÊçÆ\n    const intensities = [];\n    const start = new Date(startTime);\n    const end = new Date(endTime);\n\n    // ÁîüÊàêÊØèÂ∞èÊó∂Á¢≥ÊéíÊîæÂõ†Â≠ê (300-800 gCO2/kWh)\n    for (let d = new Date(start); d <= new Date(end); d.setHours(d.getHours() + 1)) {\n      const hour = d.getHours();\n      // Ê®°ÊãüÁ¢≥ÊéíÊîæÂõ†Â≠êÂèòÂåñ\n      const intensity =\n        500 + Math.sin((hour / 24) * Math.PI * 2) * 150 + (Math.random() * 100 - 50);\n\n      intensities.push({\n        timestamp: d.toISOString(),\n        intensity: parseFloat(intensity.toFixed(0))\n      });\n    }\n    return intensities;\n  } catch (error) {\n    console.error('Ëé∑ÂèñÁ¢≥ÊéíÊîæÂõ†Â≠êÊï∞ÊçÆÂ§±Ë¥•:', error.message);\n    return [];\n  }\n}\n\n// ËÆ°ÁÆóÂÖÖÊîæÁîµÊàêÊú¨ÊïàÁõä\nfunction calculateCostBenefit(soc, price, carbonIntensity, currentState) {\n  // ÁîµÊ±†ÂèÇÊï∞\n  const batteryCapacity = 1000; // ÁîµÊ±†ÂÆπÈáè kWh\n  const chargeEfficiency = 0.9; // ÂÖÖÁîµÊïàÁéá\n  const dischargeEfficiency = 0.9; // ÊîæÁîµÊïàÁéá\n  const carbonPrice = 0.05; // Á¢≥‰ª∑ ÂÖÉ/gCO2\n\n  // ËÆ°ÁÆóÊΩúÂú®Êî∂Áõä\n  if (currentState === 'low' || soc < 0.3) {\n    // ÈúÄË¶ÅÂÖÖÁîµÊó∂ÔºåËÆ°ÁÆóÊàêÊú¨\n    const requiredEnergy = batteryCapacity * (0.8 - soc);\n    const actualEnergyNeeded = requiredEnergy / chargeEfficiency;\n    const cost = actualEnergyNeeded * price;\n    const carbonEmission = actualEnergyNeeded * carbonIntensity;\n    const carbonCost = carbonEmission * carbonPrice;\n    const totalCost = cost + carbonCost;\n\n    return {\n      action: 'charge',\n      cost: totalCost,\n      carbonEmission,\n      benefitScore: price < 0.7 ? 8 : price < 0.9 ? 5 : 2 // ‰ª∑Ê†ºË∂ä‰ΩéÔºåÂÖÖÁîµÊî∂ÁõäË∂äÈ´ò\n    };\n  } else if (currentState === 'high' || soc > 0.7) {\n    // ÈúÄË¶ÅÊîæÁîµÊó∂ÔºåËÆ°ÁÆóÊî∂Áõä\n    const availableEnergy = batteryCapacity * (soc - 0.2);\n    const actualEnergyAvailable = availableEnergy * dischargeEfficiency;\n    const revenue = actualEnergyAvailable * price;\n    const carbonReduction = actualEnergyAvailable * carbonIntensity;\n    const carbonBenefit = carbonReduction * carbonPrice;\n    const totalBenefit = revenue + carbonBenefit;\n\n    return {\n      action: 'discharge',\n      benefit: totalBenefit,\n      carbonReduction,\n      benefitScore: price > 1.2 ? 9 : price > 1.0 ? 6 : 3 // ‰ª∑Ê†ºË∂äÈ´òÔºåÊîæÁîµÊî∂ÁõäË∂äÈ´ò\n    };\n  }\n\n  return { action: 'none', benefitScore: 0 };\n}\n\n// ÁîüÊàê‰ºòÂåñÁ≠ñÁï•\nasync function _generateOptimizationStrategies(\n  predictions,\n  interval,\n  buildingId,\n  startTime,\n  endTime\n) {\n  if (!predictions || predictions.length === 0) {\n    throw new Error('Êó†ÊïàÁöÑÈ¢ÑÊµãÊï∞ÊçÆ');\n  }\n\n  if (!interval || typeof interval !== 'string') {\n    interval = '1h'; // ÈªòËÆ§Èó¥Èöî‰∏∫1Â∞èÊó∂\n  }\n\n  // Ëé∑ÂèñÁîµ‰ª∑ÂíåÁ¢≥ÊéíÊîæÂõ†Â≠êÊï∞ÊçÆ\n  const [electricityPrices, carbonIntensities] = await Promise.all([\n    getElectricityPrices(startTime, endTime),\n    getCarbonIntensity(startTime, endTime)\n  ]);\n\n  const strategies = [];\n  let currentState = 'normal';\n\n  try {\n    predictions.forEach((soc, index) => {\n      if (typeof soc !== 'number') {\n        throw new Error(`Êó†ÊïàÁöÑÈ¢ÑÊµãÂÄºÂú®Á¥¢Âºï ${index}: ${soc}`);\n      }\n\n      const timestamp = calculatePredictionTime(index, interval);\n      // Êü•ÊâæÂØπÂ∫îÊó∂Èó¥ÁöÑÁîµ‰ª∑ÂíåÁ¢≥ÊéíÊîæÂõ†Â≠ê\n      const priceData = electricityPrices.find((p) => p.timestamp === timestamp);\n      const carbonData = carbonIntensities.find((c) => c.timestamp === timestamp);\n      const price = priceData ? priceData.price : 0.8;\n      const carbonIntensity = carbonData ? carbonData.intensity : 500;\n\n      // ËÆ°ÁÆóÊàêÊú¨ÊïàÁõä\n      const costBenefit = calculateCostBenefit(soc, price, carbonIntensity, currentState);\n\n      // Ê†πÊçÆSOCÂÄºÂíåÊàêÊú¨ÊïàÁõäÁîüÊàê‰ºòÂåñÁ≠ñÁï•\n      if (soc < 0.2 || (soc < 0.3 && costBenefit.benefitScore > 7)) {\n        strategies.push({\n          timestamp,\n          strategy: 'charge',\n          description: `ÁîµÊ±†${buildingId}ÁîµÈáèËøá‰Ωé(${soc.toFixed(2)}), Âª∫ËÆÆÂÖÖÁîµ„ÄÇÂΩìÂâçÁîµ‰ª∑: ${price.toFixed(2)}ÂÖÉ/Â∫¶, Á¢≥ÊéíÊîæÂõ†Â≠ê: ${carbonIntensity}gCO2/kWh`,\n          priority: costBenefit.benefitScore,\n          economicImpact: `È¢ÑËÆ°ÊàêÊú¨: ${costBenefit.cost ? costBenefit.cost.toFixed(2) : 'N/A'}ÂÖÉ`,\n          carbonImpact: `È¢ÑËÆ°Á¢≥ÊéíÊîæ: ${costBenefit.carbonEmission ? costBenefit.carbonEmission.toFixed(2) : 'N/A'}gCO2`\n        });\n        currentState = 'low';\n      } else if (soc > 0.8 || (soc > 0.7 && costBenefit.benefitScore > 7)) {\n        strategies.push({\n          timestamp,\n          strategy: 'discharge',\n          description: `ÁîµÊ±†${buildingId}ÁîµÈáèËøáÈ´ò(${soc.toFixed(2)}), Âª∫ËÆÆÊîæÁîµ„ÄÇÂΩìÂâçÁîµ‰ª∑: ${price.toFixed(2)}ÂÖÉ/Â∫¶, Á¢≥ÊéíÊîæÂõ†Â≠ê: ${carbonIntensity}gCO2/kWh`,\n          priority: costBenefit.benefitScore,\n          economicImpact: `È¢ÑËÆ°Êî∂Áõä: ${costBenefit.benefit ? costBenefit.benefit.toFixed(2) : 'N/A'}ÂÖÉ`,\n          carbonImpact: `È¢ÑËÆ°Á¢≥ÂáèÊéí: ${costBenefit.carbonReduction ? costBenefit.carbonReduction.toFixed(2) : 'N/A'}gCO2`\n        });\n        currentState = 'high';\n      } else if (currentState === 'low' && soc > 0.5) {\n        strategies.push({\n          timestamp,\n          strategy: 'stop_charge',\n          description: `ÁîµÊ±†${buildingId}ÁîµÈáèÂ∑≤ÊÅ¢Â§ç(${soc.toFixed(2)}), ÂÅúÊ≠¢ÂÖÖÁîµ`,\n          priority: 2,\n          economicImpact: 'Êó†È¢ùÂ§ñÊàêÊú¨'\n        });\n        currentState = 'normal';\n      } else if (currentState === 'high' && soc < 0.6) {\n        strategies.push({\n          timestamp,\n          strategy: 'stop_discharge',\n          description: `ÁîµÊ±†${buildingId}ÁîµÈáèÂ∑≤ÊÅ¢Â§ç(${soc.toFixed(2)}), ÂÅúÊ≠¢ÊîæÁîµ`,\n          priority: 2,\n          economicImpact: 'Êó†È¢ùÂ§ñÊî∂Áõä'\n        });\n        currentState = 'normal';\n      } else if (index % 24 === 0) {\n        strategies.push({\n          timestamp,\n          strategy: 'maintenance',\n          description: `ÁîµÊ±†${buildingId}ÊØèÊó•Áä∂ÊÄÅÁª¥Êä§Ê£ÄÊü•`,\n          priority: 3\n        });\n      }\n    });\n  } catch (error) {\n    console.error(`ÁîüÊàê‰ºòÂåñÁ≠ñÁï•Â§±Ë¥•: ${error.message}`);\n    throw error;\n  }\n\n  // Êåâ‰ºòÂÖàÁ∫ßÊéíÂ∫è\n  return strategies.sort((a, b) => a.priority - b.priority);\n}\n\n// ÂáÜÂ§áÈ¢ÑÊµãËæìÂÖ•Êï∞ÊçÆ\nfunction _preparePredictionInput(data, _windowSize = 24) {\n  if (!data || data.length === 0) {\n    throw new Error('Êó†ÊïàÁöÑÂéÜÂè≤Êï∞ÊçÆ');\n  }\n\n  try {\n    // Á°Æ‰øùÊï∞ÊçÆÊåâÊó∂Èó¥ÊéíÂ∫è\n    const sortedData = data.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));\n\n    // ÊèêÂèñSOCÂÄºÂπ∂ËøõË°åÂΩí‰∏ÄÂåñ\n    const socValues = sortedData.map((d) => d.soc);\n\n    // Â¶ÇÊûúÊï∞ÊçÆ‰∏çË∂≥‰∏Ä‰∏™Á™óÂè£ÔºåÂàô‰ΩøÁî®ÊâÄÊúâÂèØÁî®Êï∞ÊçÆ\n    const windowSize = 24; // ‰ΩøÁî®ÊòéÁ°ÆÁöÑÁ™óÂè£Â§ßÂ∞è\n    const inputData = socValues.slice(-windowSize);\n\n    // Êï∞ÊçÆÂΩí‰∏ÄÂåñÔºàÁ°Æ‰øùÂÄºÂú®0-1‰πãÈó¥Ôºâ\n    const normalized = normalizeData(inputData);\n\n    // ÂàõÂª∫Âº†Èáè\n    const tensor = tf.tensor2d([normalized], [1, normalized.length]);\n\n    // È™åËØÅÂº†ÈáèÂΩ¢Áä∂\n    if (tensor.shape[1] !== windowSize) {\n      throw new Error(`ËæìÂÖ•Êï∞ÊçÆÂΩ¢Áä∂‰∏çÂåπÈÖç: ÈúÄË¶Å${windowSize}‰∏™Êó∂Èó¥Ê≠•Ôºå‰ΩÜÂæóÂà∞${tensor.shape[1]}‰∏™`);\n    }\n\n    return tensor;\n  } catch (error) {\n    console.error(`ÂáÜÂ§áÈ¢ÑÊµãËæìÂÖ•Â§±Ë¥•: ${error.message}`);\n    throw error;\n  }\n}\n\n// Êï∞ÊçÆÂΩí‰∏ÄÂåñ\nfunction normalizeData(data) {\n  const max = Math.max(...data);\n  return data.map((value) => value / max);\n}\n\n// ËÆ°ÁÆóÈ¢ÑÊµãÊó∂Èó¥\nfunction calculatePredictionTime(baseTime, index, interval) {\n  const intervalMap = {\n    '1h': 60 * 60 * 1000,\n    '1d': 24 * 60 * 60 * 1000,\n    '1w': 7 * 24 * 60 * 60 * 1000\n  };\n\n  // Â¶ÇÊûúÊ≤°ÊúâÊèê‰æõÂü∫ÂáÜÊó∂Èó¥Ôºå‰ΩøÁî®ÂΩìÂâçÊó∂Èó¥\n  const baseTimestamp = baseTime ? new Date(baseTime).getTime() : Date.now();\n\n  if (isNaN(baseTimestamp)) {\n    throw new Error(`Êó†ÊïàÁöÑÂü∫ÂáÜÊó∂Èó¥: ${baseTime}`);\n  }\n\n  const intervalMs = intervalMap[interval] || intervalMap['1h'];\n  const ms = baseTimestamp + (index + 1) * intervalMs;\n\n  return new Date(ms).toISOString();\n}\n\n// Ëé∑ÂèñÂéÜÂè≤ÂÇ®ËÉΩÊï∞ÊçÆÔºàÊ®°ÊãüÔºâ\nfunction _getHistoricalBatteryData(start_time, end_time, buildingId) {\n  if (!start_time || !end_time) {\n    throw new Error('ÂøÖÈ°ªÊèê‰æõÂºÄÂßãÊó∂Èó¥ÂíåÁªìÊùüÊó∂Èó¥');\n  }\n\n  // È™åËØÅÊó∂Èó¥Ê†ºÂºè\n  if (isNaN(Date.parse(start_time)) || isNaN(Date.parse(end_time))) {\n    throw new Error('Êó†ÊïàÁöÑÊó∂Èó¥Ê†ºÂºèÔºåÂ∫î‰ΩøÁî®ISO 8601Ê†ºÂºè');\n  }\n\n  if (buildingId && typeof buildingId !== 'string') {\n    throw new Error('buildingIdÂøÖÈ°ªÊòØÂ≠óÁ¨¶‰∏≤');\n  }\n\n  return new Promise((resolve, reject) => {\n    try {\n      // Âú®ÂÆûÈôÖÂ∫îÁî®‰∏≠ÔºåËøôÈáåÂ∫îËØ•Êü•ËØ¢Êï∞ÊçÆÂ∫ì\n      // Âπ∂Ê†πÊçÆbuildingId„ÄÅstart_timeÂíåend_timeËøáÊª§Êï∞ÊçÆ\n      const filteredData = batteryStatusData.filter((dataPoint) => {\n        const timestamp = new Date(dataPoint.timestamp).getTime();\n        return (\n          timestamp >= new Date(start_time).getTime() && timestamp <= new Date(end_time).getTime()\n        );\n      });\n\n      resolve(filteredData);\n    } catch (error) {\n      reject(new Error(`Ëé∑ÂèñÂéÜÂè≤Êï∞ÊçÆÂ§±Ë¥•: ${error.message}`));\n    }\n  });\n}\n\n// Ê®°ÊãüÂä†ËΩΩËÆ≠ÁªÉÊï∞ÊçÆ\nasync function loadTrainingData() {\n  // Âú®ÂÆûÈôÖÂ∫îÁî®‰∏≠ÔºåËøôÈáåÂ∫îËØ•‰ªéÊï∞ÊçÆÂ∫ìÊàñAPIËé∑ÂèñÊï∞ÊçÆ\n  return new Promise((resolve) => {\n    resolve(batteryStatusData);\n  });\n}\n\n// È¢ÑÂ§ÑÁêÜÊï∞ÊçÆ\nfunction _preprocessPredictionData(data) {\n  const _windowSize = 24;\n  const xs = [];\n  const ys = [];\n\n  for (let i = _windowSize; i < data.length; i++) {\n    const window = data.slice(i - _windowSize, i).map((d) => d.soc);\n    xs.push(window);\n    ys.push(data[i].soc);\n  }\n\n  return {\n    features: tf.tensor2d(xs, [xs.length, _windowSize]),\n    labels: tf.tensor2d(ys, [ys.length, 1])\n  };\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 42 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 45 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 48 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 51 Ë°å)\n}\n\n// ÂàõÂª∫ÂÇ®ËÉΩ‰ºòÂåñÊ®°Âûã\nfunction createBatteryOptimizationModel() {\n  // ËæìÂÖ•ÂΩ¢Áä∂: [Êó∂Èó¥Á™óÂè£Â§ßÂ∞è, ÁâπÂæÅÊï∞Èáè]\n  // Êó∂Èó¥Á™óÂè£Â§ßÂ∞è‰∏∫24, ÊØè‰∏™Êó∂Èó¥Ê≠•Êúâ4‰∏™ÁâπÂæÅ(soc, power, voltage, temperature)\n  const inputShape = [24, 4];\n\n  const model = tf.sequential();\n\n  // Á¨¨‰∏ÄÂ±ÇLSTM\n  model.add(\n    tf.layers.lstm({\n      units: 64,\n      inputShape,\n      returnSequences: true,\n      recurrentDropout: 0.2\n    })\n  );\n\n  // Á¨¨‰∫åÂ±ÇLSTM\n  model.add(\n    tf.layers.lstm({\n      units: 32,\n      returnSequences: false,\n      recurrentDropout: 0.2\n    })\n  );\n\n  // ÂÖ®ËøûÊé•Â±Ç\n  model.add(tf.layers.dense({ units: 16, activation: 'relu' }));\n  model.add(tf.layers.dropout({ rate: 0.3 }));\n\n  // ËæìÂá∫Â±Ç - È¢ÑÊµãSOCÂÄº\n  model.add(tf.layers.dense({ units: 1, activation: 'linear' }));\n\n  // ÁºñËØëÊ®°Âûã\n  model.compile({\n    optimizer: tf.train.adam(0.001),\n    loss: 'meanAbsoluteError',\n    metrics: ['mse']\n\n    // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 42 Ë°å)\n\n    // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 42 Ë°å)\n\n    // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 42 Ë°å)\n\n    // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 42 Ë°å)\n  });\n\n  return model;\n}\n\n// ËÆ≠ÁªÉÂÇ®ËÉΩ‰ºòÂåñÊ®°Âûã\nasync function trainBatteryOptimizationModel(model, features, labels) {\n  // ÂàíÂàÜËÆ≠ÁªÉÈõÜÂíåÈ™åËØÅÈõÜ (80%ËÆ≠ÁªÉ, 20%È™åËØÅ)\n  const trainSize = Math.floor(features.shape[0] * 0.8);\n  const trainFeatures = features.slice([0, 0], [trainSize, -1]);\n  const trainLabels = labels.slice([0, 0], [trainSize, -1]);\n  const valFeatures = features.slice([trainSize, 0], [-1, -1]);\n  const valLabels = labels.slice([trainSize, 0], [-1, -1]);\n\n  // ÈáçÂ°ëÁâπÂæÅ‰ª•ÈÄÇÂ∫îLSTMËæìÂÖ•ÂΩ¢Áä∂ [Ê†∑Êú¨Êï∞, Êó∂Èó¥Ê≠•, ÁâπÂæÅÊï∞]\n  const reshapedTrainFeatures = trainFeatures.reshape([trainFeatures.shape[0], 24, 4]);\n  const reshapedValFeatures = valFeatures.reshape([valFeatures.shape[0], 24, 4]);\n\n  // ËÆæÁΩÆËÆ≠ÁªÉÂèÇÊï∞\n  const batchSize = 32;\n  const epochs = 50;\n\n  // ËÆ≠ÁªÉÊ®°Âûã\n  const history = await model.fit(reshapedTrainFeatures, trainLabels, {\n    batchSize,\n    epochs,\n    validationData: [reshapedValFeatures, valLabels],\n    callbacks: {\n      earlyStopping: {\n        monitor: 'val_loss',\n        patience: 5,\n        restoreBestWeights: true\n      },\n      reduceLROnPlateau: {\n        monitor: 'val_loss',\n        factor: 0.5,\n        patience: 3,\n        minLearningRate: 0.0001\n      }\n    }\n  });\n\n  console.log(\n    'Ê®°ÂûãËÆ≠ÁªÉÂÆåÊàêÔºåÊúÄÁªàÈ™åËØÅÊçüÂ§±:',\n    history.history.val_loss[history.history.val_loss.length - 1]\n  );\n  return model;\n}\n\n// ‰øùÂ≠òÊ®°Âûã\nasync function saveModel(model) {\n  try {\n    // ÂàõÂª∫Ê®°Âûã‰øùÂ≠òÁõÆÂΩï\n    const modelDir = '/Users/xunan/Documents/WebStormProjects/0C/models/battery-optimization';\n    await fs.mkdir(modelDir, { recursive: true });\n\n    // ‰øùÂ≠òÊ®°Âûã\n    await model.save(`file://${modelDir}`);\n    console.log('Ê®°ÂûãÂ∑≤ÊàêÂäü‰øùÂ≠òÂà∞:', modelDir);\n\n    // ‰øùÂ≠òÂΩí‰∏ÄÂåñÂèÇÊï∞\n    await fs.writeFile(\n      `${modelDir}/normalization-stats.json`,\n      JSON.stringify(global.batteryModelStats, null, 2)\n    );\n  } catch (error) {\n    console.error('‰øùÂ≠òÊ®°ÂûãÂ§±Ë¥•:', error.message);\n    throw new Error('MODEL_SAVE_FAILED');\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/core/services/cacheService.js","messages":[{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: -2.","line":149,"column":14,"nodeType":"UnaryExpression","messageId":"noMagic","endLine":149,"endColumn":16},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: -2.","line":156,"column":14,"nodeType":"UnaryExpression","messageId":"noMagic","endLine":156,"endColumn":16}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import NodeCache from 'node-cache';\nimport logger from '../../shared/utils/logger.js';\n\n// ÁºìÂ≠òÈÖçÁΩÆ\nconst CACHE_CONFIG = {\n  stdTTL: 300, // ÈªòËÆ§ÁºìÂ≠òËøáÊúüÊó∂Èó¥ÔºàÁßíÔºâ\n  checkperiod: 60, // ÂÆöÊúüÊ£ÄÊü•ËøáÊúüÁºìÂ≠òÁöÑÊó∂Èó¥Èó¥ÈöîÔºàÁßíÔºâ\n  useClones: false // ‰∏çÂÖãÈöÜÂØπË±°ÔºåÊèêÈ´òÊÄßËÉΩÔºàÊ≥®ÊÑèÔºöÂèØËÉΩÂØºËá¥ÁºìÂ≠òÂØπË±°Ë¢´Â§ñÈÉ®‰øÆÊîπÔºâ\n};\n\n// ÂàõÂª∫ÁºìÂ≠òÂÆû‰æã\nconst cache = new NodeCache(CACHE_CONFIG);\n\n/**\n * ÁºìÂ≠òÊúçÂä°Á±ª\n * Êèê‰æõÂü∫Á°ÄÁöÑÁºìÂ≠òÊìç‰ΩúÂäüËÉΩ\n */\nclass CacheService {\n  constructor() {\n    // ÁõëÂê¨ÁºìÂ≠ò‰∫ã‰ª∂\n    cache.on('expired', (key, _value) => {\n      logger.debug(`ÁºìÂ≠òËøáÊúü: ${key}`);\n    });\n\n    cache.on('flush', () => {\n      logger.info('ÁºìÂ≠òÂ∑≤Ê∏ÖÁ©∫');\n    });\n  }\n\n  /**\n   * ËÆæÁΩÆÁºìÂ≠ò\n   * @param {string} key - ÁºìÂ≠òÈîÆ\n   * @param {any} value - ÁºìÂ≠òÂÄº\n   * @param {number} [ttl] - ËøáÊúüÊó∂Èó¥ÔºàÁßíÔºâÔºåÈªòËÆ§‰ΩøÁî®ÂÖ®Â±ÄÈÖçÁΩÆ\n   * @returns {boolean} - ÊòØÂê¶ËÆæÁΩÆÊàêÂäü\n   */\n  set(key, value, ttl = CACHE_CONFIG.stdTTL) {\n    if (!key) {\n      logger.error('ÁºìÂ≠òÈîÆ‰∏çËÉΩ‰∏∫Á©∫');\n      return false;\n    }\n\n    try {\n      const success = cache.set(key, value, ttl);\n      if (success) {\n        logger.debug(`ÁºìÂ≠òËÆæÁΩÆÊàêÂäü: ${key}, TTL: ${ttl}Áßí`);\n      } else {\n        logger.warn(`ÁºìÂ≠òËÆæÁΩÆÂ§±Ë¥•: ${key}`);\n      }\n      return success;\n    } catch (error) {\n      logger.error(`ÁºìÂ≠òËÆæÁΩÆÈîôËØØ: ${key}`, error);\n      return false;\n    }\n  }\n\n  /**\n   * Ëé∑ÂèñÁºìÂ≠ò\n   * @param {string} key - ÁºìÂ≠òÈîÆ\n   * @returns {any} - ÁºìÂ≠òÂÄºÔºåËã•‰∏çÂ≠òÂú®ÂàôËøîÂõûundefined\n   */\n  get(key) {\n    if (!key) {\n      logger.error('ÁºìÂ≠òÈîÆ‰∏çËÉΩ‰∏∫Á©∫');\n      return undefined;\n    }\n\n    try {\n      const value = cache.get(key);\n      if (value !== undefined) {\n        logger.debug(`ÁºìÂ≠òÂëΩ‰∏≠: ${key}`);\n      } else {\n        logger.debug(`ÁºìÂ≠òÊú™ÂëΩ‰∏≠: ${key}`);\n      }\n      return value;\n    } catch (error) {\n      logger.error(`ÁºìÂ≠òËé∑ÂèñÈîôËØØ: ${key}`, error);\n      return undefined;\n    }\n  }\n\n  /**\n   * Âà†Èô§ÁºìÂ≠ò\n   * @param {string} key - ÁºìÂ≠òÈîÆ\n   * @returns {number} - Ë¢´Âà†Èô§ÁöÑÁºìÂ≠òÊï∞Èáè\n   */\n  del(key) {\n    if (!key) {\n      logger.error('ÁºìÂ≠òÈîÆ‰∏çËÉΩ‰∏∫Á©∫');\n      return 0;\n    }\n\n    try {\n      const count = cache.del(key);\n      if (count > 0) {\n        logger.debug(`ÁºìÂ≠òÂà†Èô§ÊàêÂäü: ${key}`);\n      } else {\n        logger.debug(`ÁºìÂ≠òÂà†Èô§Â§±Ë¥•ÔºåÈîÆ‰∏çÂ≠òÂú®: ${key}`);\n      }\n      return count;\n    } catch (error) {\n      logger.error(`ÁºìÂ≠òÂà†Èô§ÈîôËØØ: ${key}`, error);\n      return 0;\n    }\n  }\n\n  /**\n   * ÊâπÈáèÂà†Èô§ÁºìÂ≠ò\n   * @param {string[]} keys - ÁºìÂ≠òÈîÆÊï∞ÁªÑ\n   * @returns {number} - Ë¢´Âà†Èô§ÁöÑÁºìÂ≠òÊï∞Èáè\n   */\n  delMulti(keys) {\n    if (!Array.isArray(keys) || keys.length === 0) {\n      logger.error('ÁºìÂ≠òÈîÆÊï∞ÁªÑ‰∏çËÉΩ‰∏∫Á©∫');\n      return 0;\n    }\n\n    try {\n      const count = cache.del(keys);\n      logger.debug(`ÊâπÈáèÂà†Èô§ÁºìÂ≠òÊàêÂäüÔºåÂÖ±Âà†Èô§ ${count} ‰∏™ÁºìÂ≠ò`);\n      return count;\n    } catch (error) {\n      logger.error('ÊâπÈáèÂà†Èô§ÁºìÂ≠òÈîôËØØ', error);\n      return 0;\n    }\n  }\n\n  /**\n   * Ê∏ÖÁ©∫ÊâÄÊúâÁºìÂ≠ò\n   * @returns {void}\n   */\n  flushAll() {\n    try {\n      cache.flushAll();\n      logger.info('ÊâÄÊúâÁºìÂ≠òÂ∑≤Ê∏ÖÁ©∫');\n    } catch (error) {\n      logger.error('Ê∏ÖÁ©∫ÁºìÂ≠òÈîôËØØ', error);\n    }\n  }\n\n  /**\n   * Ëé∑ÂèñÁºìÂ≠òÈîÆÁöÑÂâ©‰ΩôÁîüÂ≠òÊó∂Èó¥\n   * @param {string} key - ÁºìÂ≠òÈîÆ\n   * @returns {number} - Ââ©‰ΩôÊó∂Èó¥ÔºàÁßíÔºâÔºå-1Ë°®Á§∫Ê∞∏‰∏çËøáÊúüÔºå-2Ë°®Á§∫ÈîÆ‰∏çÂ≠òÂú®\n   */\n  getTtl(key) {\n    if (!key) {\n      logger.error('ÁºìÂ≠òÈîÆ‰∏çËÉΩ‰∏∫Á©∫');\n      return -2;\n    }\n\n    try {\n      return cache.getTtl(key);\n    } catch (error) {\n      logger.error(`Ëé∑ÂèñÁºìÂ≠òTTLÈîôËØØ: ${key}`, error);\n      return -2;\n    }\n  }\n\n  /**\n   * ËÆæÁΩÆÁºìÂ≠òÈîÆÁöÑÁîüÂ≠òÊó∂Èó¥\n   * @param {string} key - ÁºìÂ≠òÈîÆ\n   * @param {number} ttl - ÁîüÂ≠òÊó∂Èó¥ÔºàÁßíÔºâ\n   * @returns {boolean} - ÊòØÂê¶ËÆæÁΩÆÊàêÂäü\n   */\n  setTtl(key, ttl) {\n    if (!key || typeof ttl !== 'number' || ttl <= 0) {\n      logger.error('ÁºìÂ≠òÈîÆÂíåÊúâÊïàÁöÑTTL‰∏çËÉΩ‰∏∫Á©∫');\n      return false;\n    }\n\n    try {\n      return cache.ttl(key, ttl);\n    } catch (error) {\n      logger.error(`ËÆæÁΩÆÁºìÂ≠òTTLÈîôËØØ: ${key}`, error);\n      return false;\n    }\n  }\n\n  /**\n   * Ëé∑ÂèñÁºìÂ≠òÁªüËÆ°‰ø°ÊÅØ\n   * @returns {object} - ÁºìÂ≠òÁªüËÆ°Êï∞ÊçÆ\n   */\n  getStats() {\n    try {\n      return cache.getStats();\n    } catch (error) {\n      logger.error('Ëé∑ÂèñÁºìÂ≠òÁªüËÆ°‰ø°ÊÅØÈîôËØØ', error);\n      return null;\n    }\n  }\n\n  /**\n   * ÁºìÂ≠òË£ÖÈ•∞Âô® - Áî®‰∫éË£ÖÈ•∞ÈúÄË¶ÅÁºìÂ≠òÁöÑÂáΩÊï∞\n   * @param {number} ttl - ÁºìÂ≠òËøáÊúüÊó∂Èó¥ÔºàÁßíÔºâ\n   * @returns {Function} - Ë£ÖÈ•∞Âô®ÂáΩÊï∞\n   */\n  cacheDecorator(ttl = CACHE_CONFIG.stdTTL) {\n    return (target, propertyKey, descriptor) => {\n      const originalMethod = descriptor.value;\n\n      descriptor.value = async function (...args) {\n        // ÁîüÊàêÁºìÂ≠òÈîÆÔºàÁ±ªÂêç+ÊñπÊ≥ïÂêç+ÂèÇÊï∞ÂìàÂ∏åÔºâ\n        const key = `${target.constructor.name}_${propertyKey}_${JSON.stringify(args)}`;\n\n        // Â∞ùËØï‰ªéÁºìÂ≠òËé∑Âèñ\n        const cachedResult = this.get(key);\n        if (cachedResult !== undefined) {\n          return cachedResult;\n        }\n\n        // Ë∞ÉÁî®ÂéüÂßãÊñπÊ≥ï\n        const result = await originalMethod.apply(this, args);\n\n        // ËÆæÁΩÆÁºìÂ≠ò\n        this.set(key, result, ttl);\n\n        return result;\n      };\n\n      return descriptor;\n    };\n  }\n}\n\n// ÂàõÂª∫ÁºìÂ≠òÊúçÂä°ÂÆû‰æã\nconst cacheService = new CacheService();\n\nexport default cacheService;\n\nexport { CacheService };\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/core/services/deviceApi.js","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":23,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":23,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[619,653],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":44,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":44,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[1122,1156],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":66,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":66,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[1759,1793],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":86,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":86,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[2263,2297],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":107,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":107,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[2808,2840],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":129,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":129,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[3407,3441],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":149,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":149,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[3906,3938],"text":""},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import axios from 'axios';\nimport { getAuthToken } from './auth';\n\nimport config from '../../shared/config/index.js';\nconst API_BASE_URL =\n  process.env.REACT_APP_API_BASE_URL || `http://localhost:${config.app.port}/api`;\n\n/**\n * Ëé∑ÂèñËÆæÂ§áÁä∂ÊÄÅ‰ø°ÊÅØ\n * @param {string} deviceId - ËÆæÂ§áID\n * @returns {Promise<Object>} ËÆæÂ§áÁä∂ÊÄÅÊï∞ÊçÆ\n */\nexport const getDeviceStatus = async (deviceId) => {\n  try {\n    const token = getAuthToken();\n    const response = await axios.get(`${API_BASE_URL}/devices/${deviceId}/status`, {\n      headers: {\n        Authorization: `Bearer ${token}`\n      }\n    });\n    return response.data;\n  } catch (error) {\n    console.error('Ëé∑ÂèñËÆæÂ§áÁä∂ÊÄÅÂ§±Ë¥•:', error);\n    throw error.response?.data || { error: { message: 'Ëé∑ÂèñËÆæÂ§áÁä∂ÊÄÅÊó∂ÂèëÁîüÈîôËØØ' } };\n  }\n};\n\n/**\n * Ëé∑ÂèñËÆæÂ§áÂàóË°®\n * @param {Object} params - Êü•ËØ¢ÂèÇÊï∞\n * @returns {Promise<Object>} ËÆæÂ§áÂàóË°®Êï∞ÊçÆ\n */\nexport const fetchDevices = async (params = {}) => {\n  try {\n    const token = getAuthToken();\n    const response = await axios.get(`${API_BASE_URL}/devices`, {\n      headers: {\n        Authorization: `Bearer ${token}`\n      },\n      params\n    });\n    return response.data;\n  } catch (error) {\n    console.error('Ëé∑ÂèñËÆæÂ§áÂàóË°®Â§±Ë¥•:', error);\n    throw error.response?.data || { error: { message: 'Ëé∑ÂèñËÆæÂ§áÂàóË°®Êó∂ÂèëÁîüÈîôËØØ' } };\n  }\n};\n\n/**\n * Êõ¥Êñ∞ËÆæÂ§áÁä∂ÊÄÅ\n * @param {string} deviceId - ËÆæÂ§áID\n * @param {Object} statusData - Áä∂ÊÄÅÊï∞ÊçÆ { status, remark }\n * @returns {Promise<Object>} Êõ¥Êñ∞ÁªìÊûú\n */\nexport const updateDeviceStatus = async (deviceId, statusData) => {\n  try {\n    const token = getAuthToken();\n    const response = await axios.patch(`${API_BASE_URL}/devices/${deviceId}/status`, statusData, {\n      headers: {\n        Authorization: `Bearer ${token}`,\n        'Content-Type': 'application/json'\n      }\n    });\n    return response.data;\n  } catch (error) {\n    console.error('Êõ¥Êñ∞ËÆæÂ§áÁä∂ÊÄÅÂ§±Ë¥•:', error);\n    throw error.response?.data || { error: { message: 'Êõ¥Êñ∞ËÆæÂ§áÁä∂ÊÄÅÊó∂ÂèëÁîüÈîôËØØ' } };\n  }\n};\n\n/**\n * Ëé∑ÂèñËÆæÂ§áËØ¶ÊÉÖ\n * @param {string} deviceId - ËÆæÂ§áID\n * @returns {Promise<Object>} ËÆæÂ§áËØ¶ÊÉÖÊï∞ÊçÆ\n */\nexport const getDeviceDetails = async (deviceId) => {\n  try {\n    const token = getAuthToken();\n    const response = await axios.get(`${API_BASE_URL}/devices/${deviceId}`, {\n      headers: {\n        Authorization: `Bearer ${token}`\n      }\n    });\n    return response.data;\n  } catch (error) {\n    console.error('Ëé∑ÂèñËÆæÂ§áËØ¶ÊÉÖÂ§±Ë¥•:', error);\n    throw error.response?.data || { error: { message: 'Ëé∑ÂèñËÆæÂ§áËØ¶ÊÉÖÊó∂ÂèëÁîüÈîôËØØ' } };\n  }\n};\n\n/**\n * ÂàõÂª∫ËÆæÂ§á\n * @param {Object} deviceData - ËÆæÂ§áÊï∞ÊçÆ\n * @returns {Promise<Object>} ÂàõÂª∫ÁªìÊûú\n */\nexport const createDevice = async (deviceData) => {\n  try {\n    const token = getAuthToken();\n    const response = await axios.post(`${API_BASE_URL}/devices`, deviceData, {\n      headers: {\n        Authorization: `Bearer ${token}`,\n        'Content-Type': 'application/json'\n      }\n    });\n    return response.data;\n  } catch (error) {\n    console.error('ÂàõÂª∫ËÆæÂ§áÂ§±Ë¥•:', error);\n    throw error.response?.data || { error: { message: 'ÂàõÂª∫ËÆæÂ§áÊó∂ÂèëÁîüÈîôËØØ' } };\n  }\n};\n\n/**\n * Êõ¥Êñ∞ËÆæÂ§á‰ø°ÊÅØ\n * @param {string} deviceId - ËÆæÂ§áID\n * @param {Object} deviceData - ËÆæÂ§áÊï∞ÊçÆ\n * @returns {Promise<Object>} Êõ¥Êñ∞ÁªìÊûú\n */\nexport const updateDevice = async (deviceId, deviceData) => {\n  try {\n    const token = getAuthToken();\n    const response = await axios.put(`${API_BASE_URL}/devices/${deviceId}`, deviceData, {\n      headers: {\n        Authorization: `Bearer ${token}`,\n        'Content-Type': 'application/json'\n      }\n    });\n    return response.data;\n  } catch (error) {\n    console.error('Êõ¥Êñ∞ËÆæÂ§á‰ø°ÊÅØÂ§±Ë¥•:', error);\n    throw error.response?.data || { error: { message: 'Êõ¥Êñ∞ËÆæÂ§á‰ø°ÊÅØÊó∂ÂèëÁîüÈîôËØØ' } };\n  }\n};\n\n/**\n * Âà†Èô§ËÆæÂ§á\n * @param {string} deviceId - ËÆæÂ§áID\n * @returns {Promise<Object>} Âà†Èô§ÁªìÊûú\n */\nexport const deleteDevice = async (deviceId) => {\n  try {\n    const token = getAuthToken();\n    const response = await axios.delete(`${API_BASE_URL}/devices/${deviceId}`, {\n      headers: {\n        Authorization: `Bearer ${token}`\n      }\n    });\n    return response.data;\n  } catch (error) {\n    console.error('Âà†Èô§ËÆæÂ§áÂ§±Ë¥•:', error);\n    throw error.response?.data || { error: { message: 'Âà†Èô§ËÆæÂ§áÊó∂ÂèëÁîüÈîôËØØ' } };\n  }\n};\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/core/services/emission.js","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'express' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":15},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.5968.","line":42,"column":70,"nodeType":"Literal","messageId":"noMagic","endLine":42,"endColumn":76},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 365.","line":54,"column":23,"nodeType":"Literal","messageId":"noMagic","endLine":54,"endColumn":26},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 24.","line":54,"column":29,"nodeType":"Literal","messageId":"noMagic","endLine":54,"endColumn":31},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":54,"column":34,"nodeType":"Literal","messageId":"noMagic","endLine":54,"endColumn":36},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":54,"column":39,"nodeType":"Literal","messageId":"noMagic","endLine":54,"endColumn":41},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":54,"column":44,"nodeType":"Literal","messageId":"noMagic","endLine":54,"endColumn":48},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":124,"column":20,"nodeType":"Literal","messageId":"noMagic","endLine":124,"endColumn":23},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":137,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":137,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[3483,3516],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":138,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":138,"endColumn":21}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import express from 'express';\n// ÂºïÂÖ•ÂøÖË¶ÅÁöÑÊ®°Âùó\nimport { createRequire } from 'module';\nconst _require = createRequire(import.meta.url);\n\n// ÂÆö‰πâËÉΩÊ∫êÁ±ªÂûãÂ∏∏Èáè\nexport const ENERGY_TYPES = {\n  ELECTRICITY: 'electricity', // ÁîµÂäõ\n  DIESEL: 'diesel', // Êü¥Ê≤π\n  NATURAL_GAS: 'natural_gas', // Â§©ÁÑ∂Ê∞î\n  SOLAR: 'solar' // ÂÖâ‰ºè\n};\n\n// ÂÆö‰πâËÉΩÊ∫êÊ∂àËÄóÊï∞ÊçÆÊ†∑Êú¨\nexport const energyConsumptionData = [\n  {\n    buildingId: 'B1',\n    timestamp: new Date('2023-06-01T00:00:00Z'),\n    energyType: ENERGY_TYPES.ELECTRICITY,\n    consumption: 1500, // ÂçÉÁì¶Êó∂\n    carbonEmission: 0.5 // Âê®CO2\n  },\n  {\n    buildingId: 'B1',\n    timestamp: new Date('2023-06-01T00:00:00Z'),\n    energyType: ENERGY_TYPES.SOLAR,\n    consumption: 200, // ÂçÉÁì¶Êó∂\n    carbonEmission: 0.0 // Âê®CO2\n  }\n];\n\n// ËÆ°ÁÆóÂçï‰∏™Êï∞ÊçÆÁÇπÁöÑÁ¢≥ÊéíÊîæÈáè\nfunction calculateEmission(dataPoint) {\n  // ‰ΩøÁî®ÈªòËÆ§Á¢≥ÊéíÊîæÂõ†Â≠êÔºàÈÅøÂÖçÊï∞ÊçÆÂ∫ìÊü•ËØ¢Ôºâ\n  const defaultCarbonFactors = {\n    electricity: 0.5968, // ÁîµÂäõÁ¢≥ÊéíÊîæÂõ†Â≠ê (kg CO2/kWh)\n    diesel: 2.68, // Êü¥Ê≤πÁ¢≥ÊéíÊîæÂõ†Â≠ê (kg CO2/L)\n    natural_gas: 2.03, // Â§©ÁÑ∂Ê∞îÁ¢≥ÊéíÊîæÂõ†Â≠ê (kg CO2/m¬≥)\n    solar: 0.0 // ÂÖâ‰ºèÁ¢≥ÊéíÊîæÂõ†Â≠ê (kg CO2/kWh)\n  };\n\n  const carbonFactor = defaultCarbonFactors[dataPoint.energyType] || 0.5968;\n  return dataPoint.consumption * carbonFactor;\n}\n\n// È™åËØÅÊó∂Èó¥ËåÉÂõ¥ÊúâÊïàÊÄß\nfunction validateTimeRange(start_time, end_time) {\n  // È™åËØÅÂºÄÂßãÊó∂Èó¥ÊòØÂê¶Êó©‰∫éÁªìÊùüÊó∂Èó¥\n  if (start_time >= end_time) {\n    throw new Error('ÂºÄÂßãÊó∂Èó¥ÂøÖÈ°ªÊó©‰∫éÁªìÊùüÊó∂Èó¥');\n  }\n\n  // È™åËØÅÊó∂Èó¥ËåÉÂõ¥ÊòØÂê¶Ë∂ÖËøáÈôêÂà∂Ôºà‰æãÂ¶Ç‰∏çËÉΩË∂ÖËøá1Âπ¥Ôºâ\n  const oneYearInMs = 365 * 24 * 60 * 60 * 1000;\n  if (end_time - start_time > oneYearInMs) {\n    throw new Error('Êó∂Èó¥ËåÉÂõ¥‰∏çËÉΩË∂ÖËøá‰∏ÄÂπ¥');\n  }\n}\n\n// ËÆ°ÁÆóÊåáÂÆöÊó∂Èó¥ËåÉÂõ¥ÂÜÖÁöÑÊÄªÁ¢≥ÊéíÊîæÈáè\nfunction calculateTotalEmissions(startTime, endTime) {\n  // ËøáÊª§ÊåáÂÆöÊó∂Èó¥ËåÉÂõ¥ÂÜÖÁöÑËÉΩÊ∫êÊ∂àËÄóÊï∞ÊçÆ\n  const filteredData = energyConsumptionData.filter(\n    (dataPoint) => dataPoint.timestamp >= startTime && dataPoint.timestamp <= endTime\n  );\n\n  // ËÆ°ÁÆóÊÄªÁ¢≥ÊéíÊîæÈáè\n  let totalEmissions = 0;\n\n  filteredData.forEach((dataPoint) => {\n    totalEmissions += calculateEmission(dataPoint);\n  });\n\n  // ËøîÂõûÊÄªÁ¢≥ÊéíÊîæÈáè\n  return totalEmissions;\n}\n\n// ËÆ°ÁÆóËØ¶ÁªÜÁöÑÁ¢≥ÊéíÊîæÊòéÁªÜ\nfunction calculateEmissionDetails(startTime, endTime) {\n  // ËøáÊª§ÊåáÂÆöÊó∂Èó¥ËåÉÂõ¥ÂÜÖÁöÑËÉΩÊ∫êÊ∂àËÄóÊï∞ÊçÆ\n  const filteredData = energyConsumptionData.filter(\n    (dataPoint) => dataPoint.timestamp >= startTime && dataPoint.timestamp <= endTime\n  );\n\n  // ÊåâËÉΩÊ∫êÁ±ªÂûãÂàÜÁ±ªÁªüËÆ°\n  const emissionDetails = {};\n  let totalEmissions = 0;\n\n  filteredData.forEach((dataPoint) => {\n    const emission = calculateEmission(dataPoint);\n    if (!emissionDetails[dataPoint.energyType]) {\n      emissionDetails[dataPoint.energyType] = {\n        energyType: dataPoint.energyType,\n        totalConsumption: 0,\n        totalEmission: 0\n      };\n    }\n\n    emissionDetails[dataPoint.energyType].totalConsumption += dataPoint.consumption;\n    emissionDetails[dataPoint.energyType].totalEmission += emission;\n    totalEmissions += emission;\n  });\n\n  // ËøîÂõûÊ±áÊÄªÁªìÊûú\n  return {\n    total: totalEmissions,\n    details: Object.values(emissionDetails),\n    timeRange: {\n      start: startTime,\n      end: endTime\n    }\n  };\n}\n\n// ÂàõÂª∫Á¢≥ÊéíÊîæËÆ°ÁÆóË∑ØÁî±\nfunction setupCarbonRoutes(app, authenticateToken) {\n  // Á¢≥ÊéíÊîæËÆ°ÁÆóÊé•Âè£\n  app.get('/carbon/emissions', authenticateToken(), async (req, res) => {\n    try {\n      // Ëé∑ÂèñÊü•ËØ¢ÂèÇÊï∞\n      const { buildingId, startDate, endDate } = req.query;\n\n      if (!buildingId || !startDate || !endDate) {\n        res.status(400).json({ error: 'Áº∫Â∞ëÂøÖË¶ÅÂèÇÊï∞' });\n        return;\n      }\n\n      // È™åËØÅÊó∂Èó¥ËåÉÂõ¥\n      validateTimeRange(new Date(startDate), new Date(endDate));\n\n      // Ë∞ÉÁî®Á¢≥ÊéíÊîæËÆ°ÁÆóÊ®°Âûã\n      const emissions = calculateEmissionDetails(new Date(startDate), new Date(endDate));\n\n      // ËøîÂõûËÆ°ÁÆóÁªìÊûú\n      res.json(emissions);\n    } catch (error) {\n      console.error('Á¢≥ÊéíÊîæËÆ°ÁÆóÈîôËØØ:', error);\n      res.status(500).json({ error: 'Á¢≥ÊéíÊîæËÆ°ÁÆóÂ§±Ë¥•' });\n    }\n  });\n\n  // ËøîÂõûappÂØπË±°‰ª•‰æøÈìæÂºèË∞ÉÁî®\n  return app;\n}\n\n// Áªü‰∏ÄÂØºÂá∫ÊâÄÊúâ functions Âíå constants\nexport {\n  calculateEmission,\n  validateTimeRange,\n  calculateTotalEmissions,\n  calculateEmissionDetails,\n  setupCarbonRoutes\n};\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/core/services/energyPrediction.js","messages":[{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 24.","line":13,"column":49,"nodeType":"Literal","messageId":"noMagic","endLine":13,"endColumn":51},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.001.","line":54,"column":30,"nodeType":"Literal","messageId":"noMagic","endLine":54,"endColumn":35},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":77,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":77,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1643,1698],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":84,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":84,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1801,1831],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":86,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":86,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[1856,1896],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":99,"column":20,"nodeType":"Literal","messageId":"noMagic","endLine":99,"endColumn":23},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 24.","line":108,"column":43,"nodeType":"Literal","messageId":"noMagic","endLine":108,"endColumn":45},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":108,"column":48,"nodeType":"Literal","messageId":"noMagic","endLine":108,"endColumn":50},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":108,"column":53,"nodeType":"Literal","messageId":"noMagic","endLine":108,"endColumn":55},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":108,"column":58,"nodeType":"Literal","messageId":"noMagic","endLine":108,"endColumn":62},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":109,"column":50,"nodeType":"Literal","messageId":"noMagic","endLine":109,"endColumn":54},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":109,"column":57,"nodeType":"Literal","messageId":"noMagic","endLine":109,"endColumn":60},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":116,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":116,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[2647,2679],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":117,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":117,"endColumn":21},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":141,"column":11,"nodeType":"Literal","messageId":"noMagic","endLine":141,"endColumn":13},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":141,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":141,"endColumn":18},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":141,"column":21,"nodeType":"Literal","messageId":"noMagic","endLine":141,"endColumn":25},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 24.","line":142,"column":11,"nodeType":"Literal","messageId":"noMagic","endLine":142,"endColumn":13},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":142,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":142,"endColumn":18},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":142,"column":21,"nodeType":"Literal","messageId":"noMagic","endLine":142,"endColumn":23},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":142,"column":26,"nodeType":"Literal","messageId":"noMagic","endLine":142,"endColumn":30},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 7.","line":143,"column":11,"nodeType":"Literal","messageId":"noMagic","endLine":143,"endColumn":12},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 24.","line":143,"column":15,"nodeType":"Literal","messageId":"noMagic","endLine":143,"endColumn":17},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":143,"column":20,"nodeType":"Literal","messageId":"noMagic","endLine":143,"endColumn":22},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":143,"column":25,"nodeType":"Literal","messageId":"noMagic","endLine":143,"endColumn":27},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":143,"column":30,"nodeType":"Literal","messageId":"noMagic","endLine":143,"endColumn":34}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":26,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createRequire } from 'module';\nconst require = createRequire(import.meta.url);\nconst tf = require('@tensorflow/tfjs-node');\n\n// Ê®°ÊãüÂéÜÂè≤ËÉΩÊ∫êÊï∞ÊçÆ\nconst historicalEnergyData = [\n  { timestamp: '2025-06-01T00:00:00Z', value: 1200, type: 'electricity' },\n  { timestamp: '2025-06-01T01:00:00Z', value: 1100, type: 'electricity' }\n  // ... Êõ¥Â§öÂéÜÂè≤Êï∞ÊçÆ\n];\n\n// ÂáÜÂ§áËÆ≠ÁªÉÊï∞ÊçÆ\nfunction prepareTrainingData(data, windowSize = 24) {\n  const xs = [];\n  const ys = [];\n\n  for (let i = windowSize; i < data.length; i++) {\n    const window = data.slice(i - windowSize, i).map((d) => d.value);\n    xs.push(window);\n    ys.push(data[i].value);\n  }\n\n  return {\n    xs: tf.tensor2d(xs, [xs.length, windowSize]),\n    ys: tf.tensor2d(ys, [ys.length, 1])\n  };\n}\n\n// ÂàõÂª∫LSTMÊ®°Âûã\n\n// TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 21 Ë°å)\n\n// TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 21 Ë°å)\n\n// TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 21 Ë°å)\n\n// TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 21 Ë°å)\n\nfunction createModel(inputShape) {\n  const model = tf.sequential();\n\n  model.add(\n    tf.layers.lstm({\n      units: 64,\n      inputShape,\n      returnSequences: false\n    })\n  );\n\n  model.add(tf.layers.dense({ units: 32, activation: 'relu' }));\n  model.add(tf.layers.dense({ units: 1 }));\n\n  model.compile({\n    optimizer: tf.train.adam(0.001),\n    loss: 'meanSquaredError'\n  });\n\n  return model;\n}\n\n// ËÆ≠ÁªÉÊ®°Âûã\nasync function _trainModel() {\n  try {\n    // ÂáÜÂ§áËÆ≠ÁªÉÊï∞ÊçÆ\n    const { xs, ys } = prepareTrainingData(historicalEnergyData);\n\n    // ÂàõÂª∫Ê®°Âûã\n    const model = createModel([xs.shape[1], 1]);\n\n    // ËÆ≠ÁªÉÊ®°Âûã\n    await model.fit(xs, ys, {\n      epochs: 100,\n      batchSize: 32,\n      shuffle: true,\n      callbacks: {\n        onEpochEnd: (epoch, logs) => {\n          console.log(`Epoch ${epoch + 1}: Loss = ${logs.loss}`);\n        }\n      }\n    });\n\n    // ‰øùÂ≠òÊ®°Âûã\n    await model.save('file://./models/energy-prediction');\n    console.log('ËÉΩÊ∫êÈ¢ÑÊµãÊ®°ÂûãËÆ≠ÁªÉÂÆåÊàêÂπ∂Â∑≤‰øùÂ≠ò');\n  } catch (error) {\n    console.error('Ê®°ÂûãËÆ≠ÁªÉÂ§±Ë¥•:', error.message);\n  }\n}\n\n// ÂàõÂª∫ËÉΩÊ∫êÈ¢ÑÊµãË∑ØÁî±\nfunction setupEnergyRoutes(app, authenticateToken) {\n  // ËÉΩÊ∫êÊ∂àËÄóÈ¢ÑÊµãÊé•Âè£\n  app.get('/energy/predict', authenticateToken(), async (req, res) => {\n    try {\n      // Ëé∑ÂèñÊü•ËØ¢ÂèÇÊï∞\n      const { buildingId, days } = req.query;\n\n      if (!buildingId || !days) {\n        res.status(400).json({ error: 'Áº∫Â∞ëÂøÖË¶ÅÂèÇÊï∞' });\n        return;\n      }\n\n      // Ë∞ÉÁî®È¢ÑÊµãÊ®°Âûã - ÊöÇÊó∂ËøîÂõûÊ®°ÊãüÊï∞ÊçÆ\n      const prediction = {\n        buildingId,\n        days: parseInt(days),\n        predictions: Array.from({ length: parseInt(days) }, (_, i) => ({\n          date: new Date(Date.now() + i * 24 * 60 * 60 * 1000).toISOString(),\n          predicted_consumption: Math.random() * 1000 + 500\n        }))\n      };\n\n      // ËøîÂõûÈ¢ÑÊµãÁªìÊûú\n      res.json(prediction);\n    } catch (error) {\n      console.error('ËÉΩÊ∫êÈ¢ÑÊµãÈîôËØØ:', error);\n      res.status(500).json({ error: 'ËÉΩÊ∫êÈ¢ÑÊµãÂ§±Ë¥•' });\n    }\n  });\n\n  // ËøîÂõûappÂØπË±°‰ª•‰æøÈìæÂºèË∞ÉÁî®\n  return app;\n}\n\n// ÂáÜÂ§áÈ¢ÑÊµãËæìÂÖ•Êï∞ÊçÆ\nfunction _preparePredictionInput(data) {\n  // ÂÆûÈôÖÂºÄÂèë‰∏≠ÈúÄË¶ÅÂ∞ÜÂéÜÂè≤Êï∞ÊçÆËΩ¨Êç¢‰∏∫Ê®°ÂûãËæìÂÖ•Ê†ºÂºè\n  const normalized = normalizeData(data.map((d) => d.value));\n  return tf.tensor2d([normalized], [1, normalized.length]);\n}\n\n// Êï∞ÊçÆÂΩí‰∏ÄÂåñ\nfunction normalizeData(data) {\n  const max = Math.max(...data);\n  return data.map((value) => value / max);\n}\n\n// ËÆ°ÁÆóÈ¢ÑÊµãÊó∂Èó¥\nfunction _calculatePredictionTime(index, interval) {\n  const intervalMap = {\n    '1h': 60 * 60 * 1000,\n    '1d': 24 * 60 * 60 * 1000,\n    '1w': 7 * 24 * 60 * 60 * 1000\n  };\n\n  const ms = new Date().getTime() + (index + 1) * (intervalMap[interval] || intervalMap['1h']);\n  return new Date(ms).toISOString();\n}\n\n// Ëé∑ÂèñÂéÜÂè≤ËÉΩÊ∫êÊï∞ÊçÆÔºàÊ®°ÊãüÔºâ\nfunction _getHistoricalEnergyData(_device_id, _start_time, _end_time) {\n  // ÂÆûÈôÖÂºÄÂèë‰∏≠Â∫î‰ªéÊï∞ÊçÆÂ∫ìÊü•ËØ¢Êï∞ÊçÆ\n  return new Promise((resolve) => {\n    resolve(historicalEnergyData);\n  });\n}\n\n// ÂØºÂá∫ËÉΩÊ∫êÈ¢ÑÊµãÂäüËÉΩ\nexport { setupEnergyRoutes };\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/core/services/jwtManager.js","messages":[{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":56,"column":36,"nodeType":"Literal","messageId":"noMagic","endLine":56,"endColumn":40},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":65,"column":36,"nodeType":"Literal","messageId":"noMagic","endLine":65,"endColumn":40},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":208,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":208,"endColumn":19,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[5622,5667],"text":""},"desc":"Remove the console.warn()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 3600000.","line":279,"column":8,"nodeType":"Literal","messageId":"noMagic","endLine":279,"endColumn":15},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":287,"column":76,"nodeType":"Literal","messageId":"noMagic","endLine":287,"endColumn":80},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":297,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":297,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[7650,7772],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 401.","line":332,"column":19,"nodeType":"Literal","messageId":"noMagic","endLine":332,"endColumn":22},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":340,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":340,"endColumn":24,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[8823,8855],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 403.","line":342,"column":21,"nodeType":"Literal","messageId":"noMagic","endLine":342,"endColumn":24},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 403.","line":348,"column":29,"nodeType":"Literal","messageId":"noMagic","endLine":348,"endColumn":32},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":386,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":386,"endColumn":19,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[10084,10123],"text":""},"desc":"Remove the console.warn()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":11,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * JWTËÆ§ËØÅÁÆ°ÁêÜÂô®\n * Êèê‰æõÂÆâÂÖ®ÁöÑJWT tokenÁîüÊàê„ÄÅÈ™åËØÅÂíåÂà∑Êñ∞Êú∫Âà∂\n */\n\nimport jwt from 'jsonwebtoken';\nimport { promisify } from 'util';\nimport crypto from 'crypto';\nimport { AuthenticationError, AuthorizationError as _AuthorizationError } from '../../shared/utils/AppError.js';\nimport config from '../../shared/config/index.js';\n\n/**\n * JWTÁÆ°ÁêÜÂô®Á±ª\n */\nexport class JWTManager {\n  constructor(options = {}) {\n    this.secret = options.secret || config.jwt.secret;\n    this.accessTokenExpiry = options.accessTokenExpiry || config.jwt.accessTokenExpiry;\n    this.refreshTokenExpiry = options.refreshTokenExpiry || config.jwt.refreshTokenExpiry;\n    this.issuer = options.issuer || config.jwt.issuer;\n    this.audience = options.audience || config.jwt.audience;\n\n    // Áî®‰∫éÂ≠òÂÇ®Â∑≤Êí§ÈîÄÁöÑtokenÔºàÂú®Áîü‰∫ßÁéØÂ¢É‰∏≠Â∫î‰ΩøÁî®RedisÔºâ\n    this.revokedTokens = new Set();\n\n    // Áî®‰∫éÂ≠òÂÇ®Âà∑Êñ∞tokenÔºàÂú®Áîü‰∫ßÁéØÂ¢É‰∏≠Â∫î‰ΩøÁî®Êï∞ÊçÆÂ∫ìÔºâ\n    this.refreshTokenStore = new Map();\n\n    // ÂÆöÊúüÊ∏ÖÁêÜËøáÊúüÁöÑÊí§ÈîÄtoken\n    this.startCleanupInterval();\n  }\n\n  /**\n   * ÁîüÊàêËÆøÈóÆtokenÂíåÂà∑Êñ∞token\n   * @param {Object} payload - tokenËΩΩËç∑\n   * @param {Object} options - È¢ùÂ§ñÈÄâÈ°π\n   * @returns {Object} ÂåÖÂê´accessTokenÂíårefreshTokenÁöÑÂØπË±°\n   */\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 53 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 53 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 53 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 53 Ë°å)\n\n  generateTokens(payload, options = {}) {\n    const tokenId = crypto.randomUUID();\n    const refreshTokenId = crypto.randomUUID();\n\n    const accessTokenPayload = {\n      ...payload,\n      jti: tokenId, // JWT ID\n      type: 'access',\n      iat: Math.floor(Date.now() / 1000)\n    };\n\n    const refreshTokenPayload = {\n      userId: payload.userId,\n      username: payload.username,\n      jti: refreshTokenId,\n      type: 'refresh',\n      accessTokenId: tokenId,\n      iat: Math.floor(Date.now() / 1000)\n    };\n\n    const accessToken = jwt.sign(accessTokenPayload, this.secret, {\n      expiresIn: this.accessTokenExpiry,\n      issuer: this.issuer,\n      audience: this.audience,\n      algorithm: 'HS256'\n    });\n\n    const refreshToken = jwt.sign(refreshTokenPayload, this.secret, {\n      expiresIn: this.refreshTokenExpiry,\n      issuer: this.issuer,\n      audience: this.audience,\n      algorithm: 'HS256'\n    });\n\n    // Â≠òÂÇ®Âà∑Êñ∞token‰ø°ÊÅØ\n    this.refreshTokenStore.set(refreshTokenId, {\n      userId: payload.userId,\n      accessTokenId: tokenId,\n      createdAt: new Date(),\n      lastUsed: new Date(),\n      userAgent: options.userAgent,\n      ipAddress: options.ipAddress\n    });\n\n    return {\n      accessToken,\n      refreshToken,\n      tokenType: 'Bearer',\n      expiresIn: this.parseExpiry(this.accessTokenExpiry),\n      tokenId,\n      refreshTokenId\n    };\n  }\n\n  /**\n   * È™åËØÅtoken\n   * @param {string} token - Ë¶ÅÈ™åËØÅÁöÑtoken\n   * @param {string} expectedType - ÊúüÊúõÁöÑtokenÁ±ªÂûãÔºàaccessÊàñrefreshÔºâ\n   * @returns {Object} Ëß£Á†ÅÂêéÁöÑtokenËΩΩËç∑\n   */\n  async verifyToken(token, expectedType = 'access') {\n    try {\n      const decoded = await promisify(jwt.verify)(token, this.secret, {\n        issuer: this.issuer,\n        audience: this.audience,\n        algorithms: ['HS256']\n      });\n\n      // Ê£ÄÊü•tokenÁ±ªÂûã\n      if (decoded.type !== expectedType) {\n        throw new AuthenticationError(\n          `Êó†ÊïàÁöÑtokenÁ±ªÂûãÔºåÊúüÊúõ: ${expectedType}ÔºåÂÆûÈôÖ: ${decoded.type}`\n        );\n      }\n\n      // Ê£ÄÊü•tokenÊòØÂê¶Â∑≤Ë¢´Êí§ÈîÄ\n      if (this.revokedTokens.has(decoded.jti)) {\n        throw new AuthenticationError('TokenÂ∑≤Ë¢´Êí§ÈîÄ');\n      }\n\n      // Â¶ÇÊûúÊòØÂà∑Êñ∞tokenÔºåÊ£ÄÊü•ÊòØÂê¶Â≠òÂú®‰∫éÂ≠òÂÇ®‰∏≠\n      if (expectedType === 'refresh' && !this.refreshTokenStore.has(decoded.jti)) {\n        throw new AuthenticationError('Âà∑Êñ∞tokenÊó†ÊïàÊàñÂ∑≤ËøáÊúü');\n      }\n\n      return decoded;\n    } catch (error) {\n      if (error.name === 'TokenExpiredError') {\n        throw new AuthenticationError('TokenÂ∑≤ËøáÊúü');\n      } else if (error.name === 'JsonWebTokenError') {\n        throw new AuthenticationError('Êó†ÊïàÁöÑtokenÊ†ºÂºè');\n      } else if (error.name === 'NotBeforeError') {\n        throw new AuthenticationError('TokenÂ∞öÊú™ÁîüÊïà');\n      } else if (error instanceof AuthenticationError) {\n        throw error;\n      } else {\n        throw new AuthenticationError('TokenÈ™åËØÅÂ§±Ë¥•');\n      }\n    }\n  }\n\n  /**\n   * Âà∑Êñ∞ËÆøÈóÆtoken\n   * @param {string} refreshToken - Âà∑Êñ∞token\n   * @param {Object} options - È¢ùÂ§ñÈÄâÈ°π\n   * @returns {Object} Êñ∞ÁöÑtokenÂØπ\n   */\n  async refreshAccessToken(refreshToken, options = {}) {\n    // È™åËØÅÂà∑Êñ∞token\n    const decoded = await this.verifyToken(refreshToken, 'refresh');\n\n    // Ëé∑ÂèñÂà∑Êñ∞token‰ø°ÊÅØ\n    const refreshTokenInfo = this.refreshTokenStore.get(decoded.jti);\n    if (!refreshTokenInfo) {\n      throw new AuthenticationError('Âà∑Êñ∞token‰ø°ÊÅØ‰∏çÂ≠òÂú®');\n    }\n\n    // Êí§ÈîÄÊóßÁöÑËÆøÈóÆtoken\n    this.revokedTokens.add(decoded.accessTokenId);\n\n    // Êõ¥Êñ∞Âà∑Êñ∞tokenÁöÑÊúÄÂêé‰ΩøÁî®Êó∂Èó¥\n    refreshTokenInfo.lastUsed = new Date();\n\n    // ÁîüÊàêÊñ∞ÁöÑËÆøÈóÆtoken\n    const newTokens = this.generateTokens(\n      {\n        userId: decoded.userId,\n        username: decoded.username,\n        role: decoded.role\n      },\n      options\n    );\n\n    // ÁßªÈô§ÊóßÁöÑÂà∑Êñ∞token\n    this.refreshTokenStore.delete(decoded.jti);\n\n    return newTokens;\n  }\n\n  /**\n   * Êí§ÈîÄtoken\n   * @param {string} token - Ë¶ÅÊí§ÈîÄÁöÑtoken\n   * @param {string} tokenType - tokenÁ±ªÂûã\n   */\n  async revokeToken(token, tokenType = 'access') {\n    try {\n      const decoded = await this.verifyToken(token, tokenType);\n\n      if (tokenType === 'access') {\n        this.revokedTokens.add(decoded.jti);\n      } else if (tokenType === 'refresh') {\n        this.refreshTokenStore.delete(decoded.jti);\n        // ÂêåÊó∂Êí§ÈîÄÁõ∏ÂÖ≥ÁöÑËÆøÈóÆtoken\n        const refreshTokenInfo = this.refreshTokenStore.get(decoded.jti);\n        if (refreshTokenInfo) {\n          this.revokedTokens.add(refreshTokenInfo.accessTokenId);\n        }\n      }\n    } catch (error) {\n      // Âç≥‰ΩøtokenÊó†ÊïàÔºå‰πü‰∏çÊäõÂá∫ÈîôËØØÔºåÂõ†‰∏∫Êí§ÈîÄÊìç‰ΩúÂ∫îËØ•ÊòØÂπÇÁ≠âÁöÑ\n      console.warn('Êí§ÈîÄtokenÊó∂ÂèëÁîüÈîôËØØ:', error.message);\n    }\n  }\n\n  /**\n   * Êí§ÈîÄÁî®Êà∑ÁöÑÊâÄÊúâtoken\n   * @param {number} userId - Áî®Êà∑ID\n   */\n  revokeAllUserTokens(userId) {\n    // Êí§ÈîÄÊâÄÊúâÂà∑Êñ∞token\n    for (const [tokenId, tokenInfo] of this.refreshTokenStore.entries()) {\n      if (tokenInfo.userId === userId) {\n        this.refreshTokenStore.delete(tokenId);\n        this.revokedTokens.add(tokenInfo.accessTokenId);\n      }\n    }\n  }\n\n  /**\n   * Ëé∑ÂèñÁî®Êà∑ÁöÑÊ¥ªË∑É‰ºöËØù\n   * @param {number} userId - Áî®Êà∑ID\n   * @returns {Array} Ê¥ªË∑É‰ºöËØùÂàóË°®\n   */\n  getUserActiveSessions(userId) {\n    const sessions = [];\n\n    for (const [tokenId, tokenInfo] of this.refreshTokenStore.entries()) {\n      if (tokenInfo.userId === userId) {\n        sessions.push({\n          tokenId,\n          createdAt: tokenInfo.createdAt,\n          lastUsed: tokenInfo.lastUsed,\n          userAgent: tokenInfo.userAgent,\n          ipAddress: tokenInfo.ipAddress\n        });\n      }\n    }\n\n    return sessions.sort((a, b) => b.lastUsed - a.lastUsed);\n  }\n\n  /**\n   * Ëß£ÊûêËøáÊúüÊó∂Èó¥Â≠óÁ¨¶‰∏≤‰∏∫ÁßíÊï∞\n   * @param {string} expiry - ËøáÊúüÊó∂Èó¥Â≠óÁ¨¶‰∏≤ÔºàÂ¶Ç'15m', '7d'Ôºâ\n   * @returns {number} ÁßíÊï∞\n   */\n  parseExpiry(expiry) {\n    const units = {\n      s: 1,\n      m: 60,\n      h: 3600,\n      d: 86400,\n      w: 604800\n    };\n\n    const match = expiry.match(/^(\\d+)([smhdw])$/);\n    if (!match) {\n      throw new Error(`Êó†ÊïàÁöÑËøáÊúüÊó∂Èó¥Ê†ºÂºè: ${expiry}`);\n    }\n\n    const [, value, unit] = match;\n    return parseInt(value) * units[unit];\n  }\n\n  /**\n   * ÂêØÂä®Ê∏ÖÁêÜÂÆöÊó∂Âô®\n   */\n  startCleanupInterval() {\n    // ÊØèÂ∞èÊó∂Ê∏ÖÁêÜ‰∏ÄÊ¨°ËøáÊúüÁöÑÊí§ÈîÄtoken\n    setInterval(() => {\n      this.cleanupExpiredTokens();\n    }, 3600000); // 1Â∞èÊó∂\n  }\n\n  /**\n   * Ê∏ÖÁêÜËøáÊúüÁöÑtoken\n   */\n  cleanupExpiredTokens() {\n    const now = new Date();\n    const refreshTokenExpiry = this.parseExpiry(this.refreshTokenExpiry) * 1000;\n\n    // Ê∏ÖÁêÜËøáÊúüÁöÑÂà∑Êñ∞token\n    for (const [tokenId, tokenInfo] of this.refreshTokenStore.entries()) {\n      if (now - tokenInfo.createdAt > refreshTokenExpiry) {\n        this.refreshTokenStore.delete(tokenId);\n        this.revokedTokens.add(tokenInfo.accessTokenId);\n      }\n    }\n\n    console.log(\n      `[JWT] Ê∏ÖÁêÜÂÆåÊàêÔºåÂΩìÂâçÊí§ÈîÄtokenÊï∞Èáè: ${this.revokedTokens.size}ÔºåÊ¥ªË∑ÉÂà∑Êñ∞tokenÊï∞Èáè: ${this.refreshTokenStore.size}`\n    );\n  }\n\n  /**\n   * Ëé∑ÂèñÁªüËÆ°‰ø°ÊÅØ\n   * @returns {Object} ÁªüËÆ°‰ø°ÊÅØ\n   */\n  getStats() {\n    return {\n      revokedTokensCount: this.revokedTokens.size,\n      activeRefreshTokensCount: this.refreshTokenStore.size,\n      activeUsersCount: new Set([...this.refreshTokenStore.values()].map((info) => info.userId))\n        .size\n    };\n  }\n}\n\n/**\n * ËÆ§ËØÅ‰∏≠Èó¥‰ª∂\n * @param {Array} requiredRoles - ÈúÄË¶ÅÁöÑËßíËâ≤ÂàóË°®\n * @returns {Function} Express‰∏≠Èó¥‰ª∂ÂáΩÊï∞\n */\nexport const authenticateToken =\n  (requiredRoles = []) =>\n    (req, res, next) => {\n    // ‰ªéËØ∑Ê±ÇÂ§¥‰∏≠Ëé∑Âèñ Authorization Â≠óÊÆµ\n      const authHeader = req.headers.authorization;\n      // Â¶ÇÊûúËØ∑Ê±ÇÂ§¥Â≠òÂú®ÔºåÂàôÊèêÂèñ token ÈÉ®ÂàÜ\n      const token = authHeader && authHeader.split(' ')[1]?.trim();\n\n      // Â¶ÇÊûú token ‰∏çÂ≠òÂú®ÔºåÂàôËøîÂõû 401 Unauthorized\n      if (token === null) {\n        return res\n          .status(401)\n          .json({ error: { code: 'UNAUTHORIZED', message: 'Êú™Êèê‰æõË∫´‰ªΩÈ™åËØÅ‰ª§Áâå' } });\n      }\n\n      // ‰ΩøÁî® jwt.verify Êù•È™åËØÅ token\n      jwt.verify(token, config.jwt.secret, (err, user) => {\n        if (err) {\n        // Â¶ÇÊûú token Êó†ÊïàÊàñÂ∑≤ËøáÊúüÔºåÂàôËøîÂõû 403 Forbidden\n          console.error('JWT È™åËØÅÂ§±Ë¥•:', err);\n          return res\n            .status(403)\n            .json({ error: { code: 'FORBIDDEN', message: 'Êó†ÊïàÊàñÂ∑≤ËøáÊúüÁöÑ‰ª§Áâå' } });\n        }\n\n        // Ê£ÄÊü•ËßíËâ≤ÊùÉÈôê\n        if (requiredRoles.length > 0 && (!user || !requiredRoles.includes(user.role))) {\n          return res.status(403).json({\n            error: { code: 'FORBIDDEN', message: `ÈúÄË¶Å‰ª•‰∏ãËßíËâ≤‰πã‰∏Ä: ${requiredRoles.join(', ')}` }\n          });\n        }\n\n        // Â¶ÇÊûú token ÊúâÊïàÔºåÂàôÂ∞ÜËß£Á†ÅÂêéÁöÑÁî®Êà∑‰ø°ÊÅØÈôÑÂä†Âà∞ËØ∑Ê±ÇÂØπË±°‰∏ä\n        req.user = user;\n        // Ë∞ÉÁî® next() Â∞ÜÊéßÂà∂ÊùÉ‰∫§Áªô‰∏ã‰∏Ä‰∏™‰∏≠Èó¥‰ª∂ÊàñË∑ØÁî±Â§ÑÁêÜÂô®\n        next();\n      });\n    };\n\n/**\n * ÂèØÈÄâËÆ§ËØÅ‰∏≠Èó¥‰ª∂Ôºà‰∏çÂº∫Âà∂Ë¶ÅÊ±ÇËÆ§ËØÅÔºâ\n */\nexport const optionalAuth = () => {\n  const jwtManager = new JWTManager();\n\n  return async (req, res, next) => {\n    try {\n      const authHeader = req.headers.authorization;\n\n      if (authHeader) {\n        const parts = authHeader.split(' ');\n        if (parts.length === 2 && parts[0] === 'Bearer') {\n          const [, token] = parts;\n          const decoded = await jwtManager.verifyToken(token, 'access');\n\n          req.user = {\n            id: decoded.userId,\n            username: decoded.username,\n            role: decoded.role,\n            tokenId: decoded.jti\n          };\n        }\n      }\n    } catch (error) {\n      // ÂèØÈÄâËÆ§ËØÅÂ§±Ë¥•Êó∂‰∏çÊäõÂá∫ÈîôËØØÔºåÂè™ÊòØ‰∏çËÆæÁΩÆÁî®Êà∑‰ø°ÊÅØ\n      console.warn('ÂèØÈÄâËÆ§ËØÅÂ§±Ë¥•:', error.message);\n    }\n\n    next();\n  };\n};\n\n// ÂàõÂª∫ÈªòËÆ§ÁöÑJWTÁÆ°ÁêÜÂô®ÂÆû‰æã\nexport const defaultJWTManager = new JWTManager();\n\nexport default {\n  JWTManager,\n  authenticateToken,\n  optionalAuth,\n  defaultJWTManager\n};\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/core/services/performanceMonitor.js","messages":[{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.001.","line":13,"column":13,"nodeType":"Literal","messageId":"noMagic","endLine":13,"endColumn":18},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.005.","line":13,"column":20,"nodeType":"Literal","messageId":"noMagic","endLine":13,"endColumn":25},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.01.","line":13,"column":27,"nodeType":"Literal","messageId":"noMagic","endLine":13,"endColumn":31},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.025.","line":13,"column":33,"nodeType":"Literal","messageId":"noMagic","endLine":13,"endColumn":38},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.05.","line":13,"column":40,"nodeType":"Literal","messageId":"noMagic","endLine":13,"endColumn":44},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.1.","line":13,"column":46,"nodeType":"Literal","messageId":"noMagic","endLine":13,"endColumn":49},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.25.","line":13,"column":51,"nodeType":"Literal","messageId":"noMagic","endLine":13,"endColumn":55},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.5.","line":13,"column":57,"nodeType":"Literal","messageId":"noMagic","endLine":13,"endColumn":60},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 2.5.","line":13,"column":65,"nodeType":"Literal","messageId":"noMagic","endLine":13,"endColumn":68},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5.","line":13,"column":70,"nodeType":"Literal","messageId":"noMagic","endLine":13,"endColumn":71},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":13,"column":73,"nodeType":"Literal","messageId":"noMagic","endLine":13,"endColumn":75},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":34,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":34,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[825,946],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":44,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":44,"endColumn":22},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":121,"column":47,"nodeType":"Literal","messageId":"noMagic","endLine":121,"endColumn":51},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":121,"column":54,"nodeType":"Literal","messageId":"noMagic","endLine":121,"endColumn":56},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":126,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":126,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2791,2850],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":127,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":127,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2855,2945],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1024.","line":127,"column":64,"nodeType":"Literal","messageId":"noMagic","endLine":127,"endColumn":68},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1024.","line":127,"column":71,"nodeType":"Literal","messageId":"noMagic","endLine":127,"endColumn":75},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":127,"column":79,"nodeType":"Literal","messageId":"noMagic","endLine":127,"endColumn":82},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":127,"column":86,"nodeType":"Literal","messageId":"noMagic","endLine":127,"endColumn":89},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":128,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":128,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2950,2997],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":129,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":129,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[3002,3048],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5000.","line":132,"column":6,"nodeType":"Literal","messageId":"noMagic","endLine":132,"endColumn":10},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":155,"column":8,"nodeType":"Literal","messageId":"noMagic","endLine":155,"endColumn":11}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":25,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { performance } from 'node:perf_hooks';\nimport { Histogram } from 'prom-client';\nimport os from 'os'; // ÂºïÂÖ•Êìç‰ΩúÁ≥ªÁªüÊ®°Âùó\n\n// ÂÖ®Â±ÄÂèòÈáèË∑üË∏™Ê¥ªÂä®ËøûÊé•Êï∞\nlet activeConnections = 0;\n\n// ÂàõÂª∫APIÂª∂ËøüÊåáÊ†áÁõ¥ÊñπÂõæ\nexport const apiLatencyHistogram = new Histogram({\n  name: 'api_latency_seconds',\n  help: 'APIËØ∑Ê±ÇÂª∂ËøüÂàÜÂ∏É',\n  labelNames: ['method', 'route', 'status_code'],\n  buckets: [0.001, 0.005, 0.01, 0.025, 0.05, 0.1, 0.25, 0.5, 1, 2.5, 5, 10]\n});\n\n// ÊÄßËÉΩÁõëÊéß‰∏≠Èó¥‰ª∂\nexport function monitorAPILatency(req, res, next) {\n  const start = performance.now();\n  let connectionCounted = false;\n\n  // Â¢ûÂä†Ê¥ªÂä®ËøûÊé•Êï∞\n  activeConnections++;\n\n  // ÂÆö‰πâÂáèÂ∞ëËøûÊé•Êï∞ÁöÑÂáΩÊï∞ÔºåÁ°Æ‰øùÂè™ÊâßË°å‰∏ÄÊ¨°\n  const decreaseConnection = () => {\n    if (!connectionCounted) {\n      activeConnections--;\n      connectionCounted = true;\n    }\n  };\n\n  res.on('finish', () => {\n    const duration = performance.now() - start;\n    console.log(\n      `API: ${req.method} ${req.originalUrl} | Âª∂Ëøü: ${duration.toFixed(2)}ms | Áä∂ÊÄÅÁ†Å: ${res.statusCode}`\n    );\n    // ËÆ∞ÂΩïÊÄßËÉΩÊåáÊ†á\n    apiLatencyHistogram.observe(\n      {\n        method: req.method,\n        route: req.route ? req.route.path : req.path,\n        status_code: res.statusCode\n      },\n      duration / 1000\n    ); // ËΩ¨Êç¢‰∏∫Áßí\n\n    // ÂáèÂ∞ëÊ¥ªÂä®ËøûÊé•Êï∞\n    decreaseConnection();\n  });\n\n  res.on('close', () => {\n    // ËøûÊé•ÂÖ≥Èó≠Êó∂‰πüÂáèÂ∞ëËÆ°Êï∞\n    decreaseConnection();\n  });\n\n  next();\n}\n\n// Ëé∑ÂèñÂΩìÂâçÊ¥ªÂä®ËøûÊé•Êï∞\nexport function getActiveConnections() {\n  return activeConnections;\n}\n\n// ÂàõÂª∫ÊÄßËÉΩÊåáÊ†áË∑ØÁî±\nexport function setupPerformanceRoutes(app) {\n  // Ëé∑ÂèñÁ≥ªÁªüÊÄßËÉΩÊåáÊ†á\n  app.get('/api/performance/metrics', (req, res) => {\n    const [cpuLoad] = os.loadavg();\n    const metrics = {\n      apiLatency: collectAPILatencyMetrics(),\n      memoryUsage: process.memoryUsage(),\n      cpuLoad,\n      uptime: process.uptime(),\n      timestamp: new Date().toISOString()\n    };\n    res.json(metrics);\n  });\n\n  return app;\n}\n\n// Êî∂ÈõÜAPIÂª∂ËøüÊåáÊ†á\nexport function collectAPILatencyMetrics() {\n  const metrics = {};\n\n  try {\n    // Ëé∑ÂèñÁõ¥ÊñπÂõæÊåáÊ†á\n    const histogramData = apiLatencyHistogram.get();\n\n    // ËøîÂõûÂü∫Êú¨ÁöÑÊåáÊ†á‰ø°ÊÅØ\n    metrics.summary = {\n      name: histogramData.name,\n      help: histogramData.help,\n      type: histogramData.type,\n      values: histogramData.values || []\n    };\n\n    // Ê∑ªÂä†ÁÆÄÂçïÁöÑÁªüËÆ°‰ø°ÊÅØ\n    metrics.totalRequests = histogramData.values ? histogramData.values.length : 0;\n  } catch (error) {\n    // Â¶ÇÊûúËé∑ÂèñÊåáÊ†áÂ§±Ë¥•ÔºåËøîÂõûÈªòËÆ§ÂÄº\n    metrics.summary = {\n      name: 'api_latency_seconds',\n      help: 'APIËØ∑Ê±ÇÂª∂ËøüÂàÜÂ∏É',\n      type: 'histogram',\n      values: []\n    };\n    metrics.totalRequests = 0;\n  }\n\n  return metrics;\n}\n\n// ÂêØÂä®ÊÄßËÉΩÁõëÊéß\nexport function startPerformanceMonitoring() {\n  // ËÆ∞ÂΩïÂêØÂä®Êó∂Èó¥\n  const startTime = Date.now();\n\n  // ÂÆöÊúüËÆ∞ÂΩïÊÄßËÉΩÊåáÊ†á\n  setInterval(() => {\n    const uptime = (Date.now() - startTime) / 1000 / 60; // ËøêË°åÊó∂Èó¥ÔºàÂàÜÈíüÔºâ\n    const memoryUsage = process.memoryUsage();\n    const [cpuLoad] = os.loadavg();\n\n    // ËÆ∞ÂΩïÊÄßËÉΩÊó•Âøó\n    console.log(`\\nüìä Á≥ªÁªüÊÄßËÉΩÊä•Âëä - ËøêË°åÊó∂Èó¥: ${uptime.toFixed(2)} ÂàÜÈíü`);\n    console.log(`üíæ ÂÜÖÂ≠ò‰ΩøÁî®: ${Math.round((memoryUsage.heapUsed / 1024 / 1024) * 100) / 100}MB`);\n    console.log(`üß† CPUË¥üËΩΩ: ${cpuLoad.toFixed(2)}`);\n    console.log(`üì¶ Ê¥ªÂä®ËøûÊé•Êï∞: ${activeConnections}`);\n\n    // Â¶ÇÊûúÈúÄË¶ÅÔºåÂèØ‰ª•Ê∑ªÂä†Êõ¥Â§öËá™ÂÆö‰πâÊÄßËÉΩÊåáÊ†á\n  }, 5000); // ÊØè5ÂàÜÈíüËÆ∞ÂΩï‰∏ÄÊ¨°ÊÄßËÉΩÊï∞ÊçÆ\n}\n\n// ËÆæÁΩÆÂª∂ËøüÊµãËØïË∑ØÁî±\nexport function delayTestRoute(app, authenticateToken) {\n  // Ê∑ªÂä†ÈúÄË¶ÅË∫´‰ªΩÈ™åËØÅÁöÑÂª∂ËøüÊµãËØïÁ´ØÁÇπ\n  app.get('/test/delay', authenticateToken(), (req, res) => {\n    // ËÆ∞ÂΩïËØ∑Ê±ÇÂºÄÂßãÊó∂Èó¥\n    const startTime = performance.now();\n\n    // Ê®°ÊãüÂ§ÑÁêÜÂª∂ËøüÔºà100msÔºâ\n    setTimeout(() => {\n      const endTime = performance.now();\n      const duration = endTime - startTime;\n\n      // ËøîÂõûÂª∂Ëøü‰ø°ÊÅØ\n      res.json({\n        message: 'Âª∂ËøüÊµãËØïÊàêÂäü',\n        requestTime: startTime,\n        responseTime: endTime,\n        delay: duration,\n        unit: 'milliseconds'\n      });\n    }, 100);\n  });\n\n  return app;\n}\n\n// ÂàõÂª∫ÊÄßËÉΩÁõëÊéßÂÆû‰æã\nexport const performanceMonitor = {\n  monitorAPILatency,\n  setupPerformanceRoutes,\n  collectAPILatencyMetrics,\n  apiLatencyHistogram,\n  delayTestRoute,\n  startPerformanceMonitoring\n};\n\n// Â∞ÜÊÄßËÉΩÁõëÊéß‰∏≠Èó¥‰ª∂ÂØºÂá∫\nexport default performanceMonitor;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/core/services/permission.js","messages":[{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 401.","line":46,"column":25,"nodeType":"Literal","messageId":"noMagic","endLine":46,"endColumn":28},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 401.","line":53,"column":29,"nodeType":"Literal","messageId":"noMagic","endLine":53,"endColumn":32},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 403.","line":55,"column":29,"nodeType":"Literal","messageId":"noMagic","endLine":55,"endColumn":32},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":57,"column":27,"nodeType":"Literal","messageId":"noMagic","endLine":57,"endColumn":30},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 403.","line":85,"column":25,"nodeType":"Literal","messageId":"noMagic","endLine":85,"endColumn":28},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":116,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":116,"endColumn":21},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":121,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":121,"endColumn":21},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":129,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":129,"endColumn":21},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":142,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":142,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[3443,3483],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 201.","line":146,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":146,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// ÂºïÂÖ•ÂøÖË¶ÅÁöÑÊ®°Âùó\nimport jwt from 'jsonwebtoken';\nimport { v4 as uuidv4 } from 'uuid';\nimport config from '../../shared/config/index.js';\n\n// ÂÆö‰πâËßíËâ≤Â∏∏Èáè\nexport const roles = {\n  ADMIN: 0,\n  ENERGY_MANAGER: 1,\n  CARBON_CALCULATION_VIEWER: 2,\n  MANAGE_CARBON_CALCULATION: 3,\n  SYSTEM_MONITOR: 4\n};\n\n// Áî®Êà∑ÊùÉÈôêÂÆö‰πâ\nconst permissions = {\n  MANAGE_USERS: 'manage_users',\n  MANAGE_DEVICES: 'manage_devices',\n  VIEW_ENERGY_DATA: 'view_energy_data',\n  MANAGE_ENERGY_PREDICTION: 'manage_energy_prediction',\n  MANAGE_CARBON_CALCULATION: 'manage_carbon_calculation',\n  ACCESS_DASHBOARD: 'access_dashboard'\n};\n\n// ËßíËâ≤ÊùÉÈôêÊò†Â∞Ñ\nconst _rolePermissions = {\n  [roles.ADMIN]: Object.values(permissions),\n  [roles.ENERGY_MANAGER]: [\n    permissions.VIEW_ENERGY_DATA,\n    permissions.MANAGE_ENERGY_PREDICTION,\n    permissions.MANAGE_CARBON_CALCULATION,\n    permissions.ACCESS_DASHBOARD\n  ],\n  [roles.VIEWER]: [permissions.VIEW_ENERGY_DATA, permissions.ACCESS_DASHBOARD]\n};\n\n// ÊùÉÈôêÈ™åËØÅ‰∏≠Èó¥‰ª∂\nexport function authenticateToken() {\n  return (req, res, next) => {\n    // ‰ªéËØ∑Ê±ÇÂ§¥‰∏≠Ëé∑Âèñ‰ª§Áâå\n    const authHeader = req.headers.authorization;\n    const token = authHeader && authHeader.split(' ')[1];\n\n    // Â¶ÇÊûúÊ≤°Êúâ‰ª§ÁâåÔºåËøîÂõû401Êú™ÊéàÊùÉ\n    if (!token) {\n      return res.status(401).json({ error: 'Áº∫Â∞ëËÆøÈóÆ‰ª§Áâå' });\n    }\n\n    // È™åËØÅ‰ª§Áâå\n    jwt.verify(token, config.jwt.secret, (err, user) => {\n      if (err) {\n        if (err.name === 'TokenExpiredError') {\n          return res.status(401).json({ error: 'ËÆøÈóÆ‰ª§ÁâåÂ∑≤ËøáÊúü' });\n        } else if (err.name === 'JsonWebTokenError') {\n          return res.status(403).json({ error: 'Êó†ÊïàÁöÑËÆøÈóÆ‰ª§Áâå' });\n        }\n        return res.status(500).json({ error: '‰ª§ÁâåÈ™åËØÅÂ§±Ë¥•' });\n      }\n\n      req.user = user;\n      next();\n    });\n  };\n}\n\n// ÁîüÊàêÊñ∞ÁöÑËÆøÈóÆ‰ª§Áâå\nexport function generateAccessToken(user) {\n  // Á≠æÂèëÊñ∞ÁöÑ‰ª§Áâå\n  return jwt.sign(\n    {\n      username: user.username,\n      role: user.role,\n      userId: user.userId || uuidv4()\n    },\n    config.jwt.secret,\n    { expiresIn: config.jwt.accessTokenExpiry }\n  );\n}\n\n// Ê£ÄÊü•Áî®Êà∑ÊùÉÈôê\nexport function checkPermission(requiredRole) {\n  return (req, res, next) => {\n    // Ê£ÄÊü•Áî®Êà∑ÊòØÂê¶ÊúâË∂≥Â§üÁöÑÊùÉÈôê\n    if (!req.user || !req.user.role || req.user.role < requiredRole) {\n      return res.status(403).json({ error: 'Ê≤°ÊúâË∂≥Â§üÁöÑÊùÉÈôêÊâßË°åÊ≠§Êìç‰Ωú' });\n    }\n\n    // Áî®Êà∑ÊúâË∂≥Â§üÊùÉÈôêÔºåÁªßÁª≠ÊâßË°å‰∏ã‰∏Ä‰∏™‰∏≠Èó¥‰ª∂\n    next();\n  };\n}\n\n// Áî®Êà∑ÊùÉÈôêÁÆ°ÁêÜ\nexport function setupUserRoutes(app, authenticateToken) {\n  // Ëé∑ÂèñÊâÄÊúâÁî®Êà∑\n  app.get('/users', authenticateToken(), (req, res) => {\n    // Ê®°ÊãüÁî®Êà∑Êï∞ÊçÆÂ∫ì\n    const mockUsers = [\n      { id: 1, username: 'admin', roles: ['ADMIN'] },\n      { id: 2, username: 'manager', roles: ['ENERGY_MANAGER'] }\n    ];\n    const users = mockUsers.map((user) => ({\n      id: user.id,\n      username: user.username,\n      roles: user.roles\n    }));\n\n    res.json(users);\n  });\n\n  // ÂàõÂª∫Êñ∞Áî®Êà∑\n  app.post('/users', authenticateToken(), (req, res) => {\n    const { username, password, role } = req.body;\n\n    if (!username || !password || !role) {\n      res.status(400).json({ error: 'Áº∫Â∞ëÂøÖË¶ÅÂèÇÊï∞' });\n      return;\n    }\n\n    if (roles[role] === undefined) {\n      res.status(400).json({ error: 'Êó†ÊïàÁöÑËßíËâ≤' });\n      return;\n    }\n\n    // Ê£ÄÊü•Áî®Êà∑ÂêçÊòØÂê¶Â∑≤Â≠òÂú® - Ê®°ÊãüÊ£ÄÊü•\n    const mockUsers = ['admin', 'manager'];\n    const existingUser = mockUsers.includes(username);\n    if (existingUser) {\n      res.status(400).json({ error: 'Áî®Êà∑ÂêçÂ∑≤Â≠òÂú®' });\n      return;\n    }\n\n    // ÂàõÂª∫Êñ∞Áî®Êà∑ - Ê®°ÊãüÂàõÂª∫\n    const newUser = {\n      id: Date.now(),\n      username,\n      password: `hashed_${password}`, // Ê®°ÊãüÂØÜÁ†ÅÂìàÂ∏å\n      roles: [role]\n    };\n\n    // Ê®°Êãü‰øùÂ≠òÂà∞Êï∞ÊçÆÂ∫ì\n    console.log('Áî®Êà∑Â∑≤ÂàõÂª∫:', newUser.username);\n\n    // ËøîÂõûÂàõÂª∫ÁöÑÁî®Êà∑Ôºà‰∏çÂåÖÂê´ÂØÜÁ†ÅÔºâ\n    const { password: _, ...userWithoutPassword } = newUser;\n    res.status(201).json(userWithoutPassword);\n  });\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/core/services/recommendationService.js","messages":[{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 7.","line":85,"column":26,"nodeType":"Literal","messageId":"noMagic","endLine":85,"endColumn":27},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: -3.","line":156,"column":22,"nodeType":"UnaryExpression","messageId":"noMagic","endLine":156,"endColumn":24},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 3.","line":156,"column":72,"nodeType":"Literal","messageId":"noMagic","endLine":156,"endColumn":73},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: -3.","line":221,"column":39,"nodeType":"UnaryExpression","messageId":"noMagic","endLine":221,"endColumn":41},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.7.","line":298,"column":52,"nodeType":"Literal","messageId":"noMagic","endLine":298,"endColumn":55},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":309,"column":63,"nodeType":"Literal","messageId":"noMagic","endLine":309,"endColumn":67},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":309,"column":70,"nodeType":"Literal","messageId":"noMagic","endLine":309,"endColumn":72},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":309,"column":75,"nodeType":"Literal","messageId":"noMagic","endLine":309,"endColumn":77},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5.","line":434,"column":44,"nodeType":"Literal","messageId":"noMagic","endLine":434,"endColumn":45},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 24.","line":442,"column":25,"nodeType":"Literal","messageId":"noMagic","endLine":442,"endColumn":27},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 8.","line":540,"column":50,"nodeType":"Literal","messageId":"noMagic","endLine":540,"endColumn":51},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5.","line":540,"column":85,"nodeType":"Literal","messageId":"noMagic","endLine":540,"endColumn":86},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 4.","line":540,"column":89,"nodeType":"Literal","messageId":"noMagic","endLine":540,"endColumn":90},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 8.","line":540,"column":93,"nodeType":"Literal","messageId":"noMagic","endLine":540,"endColumn":94},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.8.","line":541,"column":64,"nodeType":"Literal","messageId":"noMagic","endLine":541,"endColumn":67},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":555,"column":54,"nodeType":"Literal","messageId":"noMagic","endLine":555,"endColumn":58},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 30.","line":556,"column":54,"nodeType":"Literal","messageId":"noMagic","endLine":556,"endColumn":56},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":556,"column":59,"nodeType":"Literal","messageId":"noMagic","endLine":556,"endColumn":61},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 50.","line":606,"column":53,"nodeType":"Literal","messageId":"noMagic","endLine":606,"endColumn":55},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":606,"column":58,"nodeType":"Literal","messageId":"noMagic","endLine":606,"endColumn":60},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 30.","line":609,"column":42,"nodeType":"Literal","messageId":"noMagic","endLine":609,"endColumn":44},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 365.","line":610,"column":41,"nodeType":"Literal","messageId":"noMagic","endLine":610,"endColumn":44},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.5.","line":612,"column":51,"nodeType":"Literal","messageId":"noMagic","endLine":612,"endColumn":54},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 365.","line":612,"column":57,"nodeType":"Literal","messageId":"noMagic","endLine":612,"endColumn":60},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":612,"column":64,"nodeType":"Literal","messageId":"noMagic","endLine":612,"endColumn":68},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":624,"column":47,"nodeType":"Literal","messageId":"noMagic","endLine":624,"endColumn":51},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":624,"column":54,"nodeType":"Literal","messageId":"noMagic","endLine":624,"endColumn":57},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 20.","line":625,"column":61,"nodeType":"Literal","messageId":"noMagic","endLine":625,"endColumn":63},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5.","line":625,"column":66,"nodeType":"Literal","messageId":"noMagic","endLine":625,"endColumn":67},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":652,"column":55,"nodeType":"Literal","messageId":"noMagic","endLine":652,"endColumn":58},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":652,"column":61,"nodeType":"Literal","messageId":"noMagic","endLine":652,"endColumn":64},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 30.","line":654,"column":42,"nodeType":"Literal","messageId":"noMagic","endLine":654,"endColumn":44},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 12.","line":656,"column":43,"nodeType":"Literal","messageId":"noMagic","endLine":656,"endColumn":45},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 8.","line":671,"column":43,"nodeType":"Literal","messageId":"noMagic","endLine":671,"endColumn":44},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5.","line":671,"column":80,"nodeType":"Literal","messageId":"noMagic","endLine":671,"endColumn":81},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":672,"column":49,"nodeType":"Literal","messageId":"noMagic","endLine":672,"endColumn":53},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 200.","line":672,"column":56,"nodeType":"Literal","messageId":"noMagic","endLine":672,"endColumn":59},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 4.","line":673,"column":53,"nodeType":"Literal","messageId":"noMagic","endLine":673,"endColumn":54},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5000.","line":699,"column":54,"nodeType":"Literal","messageId":"noMagic","endLine":699,"endColumn":58},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":699,"column":61,"nodeType":"Literal","messageId":"noMagic","endLine":699,"endColumn":65},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.2.","line":702,"column":51,"nodeType":"Literal","messageId":"noMagic","endLine":702,"endColumn":54},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.2.","line":703,"column":59,"nodeType":"Literal","messageId":"noMagic","endLine":703,"endColumn":62},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":776,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":776,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[21385,21430],"text":""},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":43,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import Recommendation from '../models/recommendation.js';\nimport EnergyData from '../models/energyData.js';\nimport CarbonData from '../models/carbonData.js';\nimport Device from '../models/Device.js';\nimport StorageDevice from '../models/storageDevice.js';\nimport { Op } from 'sequelize';\nimport moment from 'moment';\nimport { v4 as uuidv4 } from 'uuid';\n\n/**\n * Êé®ËçêÊúçÂä°Á±ªÔºåÂ§ÑÁêÜÊé®ËçêËßÑÂàôËØÑ‰º∞ÂíåÂª∫ËÆÆÁîüÊàê\n */\nclass RecommendationService {\n  /**\n   * Âü∫‰∫éÁ≥ªÁªüÊï∞ÊçÆÁîüÊàêÊé®Ëçê\n   * @param {Object} userContext - Áî®Êà∑‰∏ä‰∏ãÊñá\n   * @returns {Promise<Array>} Êé®ËçêÁªìÊûúÂàóË°®\n   */\n  static async generateSystemRecommendations(userContext) {\n    // Ëé∑ÂèñÁ≥ªÁªüÊï∞ÊçÆ\n    const systemData = await this._collectSystemData(userContext);\n\n    // ‰∏∞ÂØåÁî®Êà∑‰∏ä‰∏ãÊñá\n    const enrichedContext = {\n      ...userContext,\n      ...systemData\n    };\n\n    // ‰ΩøÁî®Êé®ËçêÊ®°ÂûãÁîüÊàêÊé®Ëçê\n    const recommendations = await Recommendation.generateRecommendations(enrichedContext);\n\n    // Â¢ûÂº∫Êé®ËçêÂÜÖÂÆπ\n    const enhancedRecommendations = await this._enhanceRecommendations(recommendations);\n\n    return enhancedRecommendations;\n  }\n\n  /**\n   * Êî∂ÈõÜÁ≥ªÁªüÊï∞ÊçÆÁî®‰∫éÊé®Ëçê\n   * @param {Object} userContext - Áî®Êà∑‰∏ä‰∏ãÊñá\n   * @returns {Promise<Object>} Á≥ªÁªüÊï∞ÊçÆ\n   */\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 25 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 25 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 25 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 25 Ë°å)\n\n  static async _collectSystemData(userContext) {\n    const { parkId, buildingId, timeRange = '7d' } = userContext;\n    const endDate = new Date();\n    const startDate = moment().subtract(this._parseTimeRange(timeRange), 'days').toDate();\n\n    // Âπ∂Ë°åÊî∂ÈõÜÂêÑÁ±ªÊï∞ÊçÆ\n    const [energyConsumption, carbonEmissions, deviceStatus, storageDevices, peakLoadData] =\n      await Promise.all([\n        this._getEnergyConsumption(parkId, buildingId, startDate, endDate),\n        this._getCarbonEmissions(parkId, buildingId, startDate, endDate),\n        this._getDeviceStatus(parkId, buildingId),\n        this._getStorageDevices(parkId, buildingId),\n        this._getPeakLoadData(parkId, buildingId, startDate, endDate)\n      ]);\n\n    return {\n      energyConsumption,\n      carbonEmissions,\n      deviceStatus,\n      storageDevices,\n      peakLoadData,\n      timeRange,\n      currentTime: new Date()\n    };\n  }\n\n  /**\n   * Ëß£ÊûêÊó∂Èó¥ËåÉÂõ¥Â≠óÁ¨¶‰∏≤\n   * @param {string} timeRange - Êó∂Èó¥ËåÉÂõ¥Â≠óÁ¨¶‰∏≤ÔºåÂ¶Ç '7d' Ë°®Á§∫7Â§©\n   * @returns {number} Â§©Êï∞\n   */\n  static _parseTimeRange(timeRange) {\n    const days = parseInt(timeRange.replace('d', ''), 10);\n    return isNaN(days) ? 7 : days;\n  }\n\n  /**\n   * Ëé∑ÂèñËÉΩÊ∫êÊ∂àËÄóÊï∞ÊçÆ\n   * @param {string} parkId - Âõ≠Âå∫ID\n   * @param {string} buildingId - Âª∫Á≠ëID\n   * @param {Date} startDate - ÂºÄÂßãÊó•Êúü\n   * @param {Date} endDate - ÁªìÊùüÊó•Êúü\n   * @returns {Promise<Object>} ËÉΩÊ∫êÊ∂àËÄóÊï∞ÊçÆ\n   */\n  static async _getEnergyConsumption(parkId, buildingId, startDate, endDate) {\n    // ÊûÑÂª∫Êü•ËØ¢Êù°‰ª∂\n    const whereClause = { timestamp: { [Op.between]: [startDate, endDate] } };\n    if (parkId) {\n      whereClause.park_id = parkId;\n    }\n    if (buildingId) {\n      whereClause.building_id = buildingId;\n    }\n\n    // Êü•ËØ¢ËÉΩÊ∫êÊï∞ÊçÆ\n    const energyData = await EnergyData.findAll({\n      where: whereClause,\n      attributes: [\n        [\n          EnergyData.sequelize.fn('strftime', '%Y-%m-%d', EnergyData.sequelize.col('timestamp')),\n          'date'\n        ],\n        [EnergyData.sequelize.fn('SUM', EnergyData.sequelize.col('value')), 'total_consumption'],\n        'type'\n      ],\n      group: ['date', 'type'],\n      order: [['date', 'ASC']]\n    });\n\n    // Ê†ºÂºèÂåñÊï∞ÊçÆ\n    const formattedData = {};\n    energyData.forEach((item) => {\n      const date = item.get('date');\n      const type = item.get('type');\n      const consumption = parseFloat(item.get('total_consumption'));\n\n      if (!formattedData[date]) {\n        formattedData[date] = {};\n      }\n      formattedData[date][type] = consumption;\n    });\n\n    // ËÆ°ÁÆóÂπ≥ÂùáÂÄºÂíåË∂ãÂäø\n    const dailyAverages = {};\n    const energyTypes = new Set();\n\n    Object.values(formattedData).forEach((dailyData) => {\n      Object.entries(dailyData).forEach(([type, value]) => {\n        energyTypes.add(type);\n        // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n        // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n        // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n        // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n        if (!dailyAverages[type]) {\n          dailyAverages[type] = [];\n        }\n        dailyAverages[type].push(value);\n      });\n    });\n\n    const trends = {};\n    Object.entries(dailyAverages).forEach(([type, values]) => {\n      const avg = values.reduce((sum, val) => sum + val, 0) / values.length;\n      const recentAvg =\n        values.slice(-3).reduce((sum, val) => sum + val, 0) / Math.min(3, values.length);\n      trends[type] = {\n        average: avg,\n        recentAverage: recentAvg,\n        trend: recentAvg > avg ? 'increasing' : recentAvg < avg ? 'decreasing' : 'stable',\n        changeRate: avg ? Math.abs((recentAvg - avg) / avg) : 0\n      };\n    });\n\n    return {\n      dailyData: formattedData,\n      trends,\n      types: Array.from(energyTypes)\n    };\n  }\n\n  /**\n   * Ëé∑ÂèñÁ¢≥ÊéíÊîæÊï∞ÊçÆ\n   * @param {string} parkId - Âõ≠Âå∫ID\n   * @param {string} buildingId - Âª∫Á≠ëID\n   * @param {Date} startDate - ÂºÄÂßãÊó•Êúü\n   * @param {Date} endDate - ÁªìÊùüÊó•Êúü\n   * @returns {Promise<Object>} Á¢≥ÊéíÊîæÊï∞ÊçÆ\n   */\n  static async _getCarbonEmissions(parkId, buildingId, startDate, endDate) {\n    // ÊûÑÂª∫Êü•ËØ¢Êù°‰ª∂\n    const whereClause = { timestamp: { [Op.between]: [startDate, endDate] } };\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (parkId) {\n      whereClause.park_id = parkId;\n    }\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (buildingId) {\n      whereClause.building_id = buildingId;\n    }\n\n    // Êü•ËØ¢Á¢≥ÊéíÊîæÊï∞ÊçÆ\n    const carbonData = await CarbonData.findAll({\n      where: whereClause,\n      attributes: [\n        [\n          CarbonData.sequelize.fn('strftime', '%Y-%m-%d', CarbonData.sequelize.col('timestamp')),\n          'date'\n        ],\n        [CarbonData.sequelize.fn('SUM', CarbonData.sequelize.col('value')), 'total_emissions']\n      ],\n      group: ['date'],\n      order: [['date', 'ASC']]\n    });\n\n    // Ê†ºÂºèÂåñÊï∞ÊçÆ\n    const dailyData = {};\n    carbonData.forEach((item) => {\n      dailyData[item.get('date')] = parseFloat(item.get('total_emissions'));\n    });\n\n    // ËÆ°ÁÆóË∂ãÂäø\n    const values = Object.values(dailyData);\n    const avg = values.length ? values.reduce((sum, val) => sum + val, 0) / values.length : 0;\n    const recentValues = values.slice(-3);\n    const recentAvg = recentValues.length\n      ? recentValues.reduce((sum, val) => sum + val, 0) / recentValues.length\n      : 0;\n    const trend = recentAvg > avg ? 'increasing' : recentAvg < avg ? 'decreasing' : 'stable';\n    const changeRate = avg ? Math.abs((recentAvg - avg) / avg) : 0;\n\n    return {\n      dailyData,\n      average: avg,\n      recentAverage: recentAvg,\n      trend,\n      changeRate,\n      total: values.reduce((sum, val) => sum + val, 0)\n    };\n  }\n\n  /**\n   * Ëé∑ÂèñËÆæÂ§áÁä∂ÊÄÅ\n   * @param {string} parkId - Âõ≠Âå∫ID\n   * @param {string} buildingId - Âª∫Á≠ëID\n   * @returns {Promise<Object>} ËÆæÂ§áÁä∂ÊÄÅÊï∞ÊçÆ\n   */\n  static async _getDeviceStatus(parkId, buildingId) {\n    // ÊûÑÂª∫Êü•ËØ¢Êù°‰ª∂\n    const whereClause = {};\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (parkId) {\n      whereClause.park_id = parkId;\n    }\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (buildingId) {\n      whereClause.building_id = buildingId;\n    }\n\n    // Êü•ËØ¢ËÆæÂ§á\n    const devices = await Device.findAll({\n      where: whereClause,\n      attributes: ['id', 'name', 'type', 'status', 'last_active', 'efficiency', 'model']\n    });\n\n    // ÂàÜÁ±ªÁªüËÆ°\n    const statusCounts = {\n      online: 0,\n      offline: 0,\n      warning: 0,\n      error: 0\n    };\n\n    const typeCounts = {};\n    const inefficientDevices = [];\n    const offlineDevices = [];\n\n    devices.forEach((device) => {\n      const status = device.status || 'unknown';\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      if (statusCounts[status] !== undefined) {\n        statusCounts[status]++;\n      }\n\n      const type = device.type || 'unknown';\n      typeCounts[type] = (typeCounts[type] || 0) + 1;\n\n      // Ê†áËÆ∞ÊïàÁéá‰Ωé‰∏ãÁöÑËÆæÂ§á\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      if (device.efficiency && device.efficiency < 0.7) {\n        inefficientDevices.push(device);\n      }\n\n      // Ê†áËÆ∞Á¶ªÁ∫øËÆæÂ§á\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      if (status === 'offline' && device.last_active) {\n        const lastActive = new Date(device.last_active);\n        const hoursSinceActive = (new Date() - lastActive) / (1000 * 60 * 60);\n        // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n        // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n        // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n        // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n        if (hoursSinceActive > 2) {\n          offlineDevices.push({\n            ...device.toJSON(),\n            hoursOffline: hoursSinceActive\n          });\n        }\n      }\n    });\n\n    return {\n      total: devices.length,\n      statusCounts,\n      typeCounts,\n      inefficientDevices,\n      offlineDevices\n    };\n  }\n\n  /**\n   * Ëé∑ÂèñÂÇ®ËÉΩËÆæÂ§áÊï∞ÊçÆ\n   * @param {string} parkId - Âõ≠Âå∫ID\n   * @param {string} buildingId - Âª∫Á≠ëID\n   * @returns {Promise<Array>} ÂÇ®ËÉΩËÆæÂ§áÂàóË°®\n   */\n  static async _getStorageDevices(parkId, buildingId) {\n    // ÂÖàÊü•ËØ¢ËÆæÂ§á\n    const whereClause = { type: 'energy_storage' };\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (parkId) {\n      whereClause.park_id = parkId;\n    }\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (buildingId) {\n      whereClause.building_id = buildingId;\n    }\n\n    const storageDevices = await Device.findAll({\n      where: whereClause,\n      attributes: ['id', 'name', 'status', 'last_active']\n    });\n\n    // Ëé∑ÂèñËØ¶ÁªÜÂèÇÊï∞\n    const detailedDevices = await Promise.all(\n      storageDevices.map(async (device) => {\n        const params = await StorageDevice.findByDeviceId(device.id);\n        return {\n          ...device.toJSON(),\n          params\n        };\n      })\n    );\n\n    return detailedDevices;\n  }\n\n  /**\n   * Ëé∑ÂèñÂ≥∞ÂÄºË¥üËç∑Êï∞ÊçÆ\n   * @param {string} parkId - Âõ≠Âå∫ID\n   * @param {string} buildingId - Âª∫Á≠ëID\n   * @param {Date} startDate - ÂºÄÂßãÊó•Êúü\n   * @param {Date} endDate - ÁªìÊùüÊó•Êúü\n   * @returns {Promise<Object>} Â≥∞ÂÄºË¥üËç∑Êï∞ÊçÆ\n   */\n  static async _getPeakLoadData(parkId, buildingId, startDate, endDate) {\n    // ÊûÑÂª∫Êü•ËØ¢Êù°‰ª∂\n    const whereClause = { timestamp: { [Op.between]: [startDate, endDate] } };\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (parkId) {\n      whereClause.park_id = parkId;\n    }\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (buildingId) {\n      whereClause.building_id = buildingId;\n    }\n\n    // Êü•ËØ¢ÁîµÂäõÊï∞ÊçÆ\n    const electricityData = await EnergyData.findAll({\n      where: {\n        ...whereClause,\n        type: 'electricity'\n      },\n      attributes: ['timestamp', 'value'],\n      order: [['timestamp', 'ASC']]\n    });\n\n    // ÊåâÂ∞èÊó∂ËÅöÂêà\n    const hourlyData = {};\n    electricityData.forEach((item) => {\n      const hour = moment(item.timestamp).format('YYYY-MM-DD HH:00');\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      if (!hourlyData[hour]) {\n        hourlyData[hour] = [];\n      }\n      hourlyData[hour].push(parseFloat(item.value));\n    });\n\n    // ËÆ°ÁÆóÊØèÂ∞èÊó∂Âπ≥ÂùáÂÄº\n    const hourlyAverages = {};\n    Object.entries(hourlyData).forEach(([hour, values]) => {\n      const avg = values.reduce((sum, val) => sum + val, 0) / values.length;\n      hourlyAverages[hour] = avg;\n    });\n\n    // ÊâæÂá∫Â≥∞ÂÄºÊó∂ÊÆµ\n    const sortedHours = Object.entries(hourlyAverages).sort((a, b) => b[1] - a[1]);\n    const peakHours = sortedHours.slice(0, 5).map(([hour, value]) => ({\n      hour: hour.split(' ')[1],\n      averageLoad: value,\n      date: hour.split(' ')[0]\n    }));\n\n    // ÊâæÂá∫Áî®ÁîµÈ´òÂ≥∞Êó∂ÊÆµÔºàÂ∞èÊó∂Ôºâ\n    const hourDistribution = {};\n    for (let i = 0; i < 24; i++) {\n      hourDistribution[i] = [];\n    }\n\n    Object.entries(hourlyAverages).forEach(([hour, value]) => {\n      const hourOfDay = parseInt(hour.split(' ')[1].split(':')[0], 10);\n      hourDistribution[hourOfDay].push(value);\n    });\n\n    const hourlyDistribution = {};\n    Object.entries(hourDistribution).forEach(([hour, values]) => {\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      if (values.length) {\n        hourlyDistribution[hour] = values.reduce((sum, val) => sum + val, 0) / values.length;\n      }\n    });\n\n    // ÊâæÂá∫Áî®ÁîµÈ´òÂ≥∞Êó∂ÊÆµ\n    const peakHour = Object.entries(hourlyDistribution).sort((a, b) => b[1] - a[1])[0] || [0, 0];\n\n    return {\n      hourlyAverages,\n      peakHours,\n      peakHour: parseInt(peakHour[0], 10),\n      peakLoad: peakHour[1]\n    };\n  }\n\n  /**\n   * Â¢ûÂº∫Êé®ËçêÂÜÖÂÆπÔºåÊ∑ªÂä†ÂÖ∑‰ΩìÊï∞ÊçÆÂíåÂÆûÊñΩÊ≠•È™§\n   * @param {Array} recommendations - ÂéüÂßãÊé®ËçêÂàóË°®\n   * @returns {Promise<Array>} Â¢ûÂº∫ÂêéÁöÑÊé®ËçêÂàóË°®\n   */\n  static async _enhanceRecommendations(recommendations) {\n    return Promise.all(\n      recommendations.map(async (recommendation) => {\n        // Ê†πÊçÆÊé®ËçêÁ±ªÂûãÊ∑ªÂä†ÂÖ∑‰ΩìÂÜÖÂÆπ\n        let details = {};\n\n        // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 26 Ë°å)\n\n        // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 26 Ë°å)\n\n        // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 26 Ë°å)\n\n        // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 26 Ë°å)\n\n        let implementationSteps = [];\n        let potentialSavings = {};\n\n        switch (recommendation.type) {\n          case 'energy_saving':\n            details = await this._calculateEnergySavingDetails(recommendation);\n            implementationSteps = this._getEnergySavingSteps(recommendation);\n            potentialSavings = await this._estimateEnergySavings(recommendation);\n            break;\n          case 'cost_reduction':\n            details = await this._calculateCostReductionDetails(recommendation);\n            implementationSteps = this._getCostReductionSteps(recommendation);\n            potentialSavings = await this._estimateCostSavings(recommendation);\n            break;\n          case 'maintenance':\n            details = await this._getMaintenanceDetails(recommendation);\n            implementationSteps = this._getMaintenanceSteps(recommendation);\n            potentialSavings = await this._estimateMaintenanceSavings(recommendation);\n            break;\n          default:\n            details = { description: 'Êé®ËçêËØ¶ÊÉÖÊ≠£Âú®ËÆ°ÁÆó‰∏≠' };\n            implementationSteps = [\n              'Êü•ÁúãÊé®ËçêËØ¶ÊÉÖ',\n              'ËØÑ‰º∞ÂÆûÊñΩÈöæÂ∫¶',\n              'Âà∂ÂÆöÂÆûÊñΩËÆ°Âàí',\n              'ÊâßË°åÊé®ËçêÊé™ÊñΩ',\n              'È™åËØÅÂÆûÊñΩÊïàÊûú'\n            ];\n        }\n\n        return {\n          ...recommendation,\n          details,\n          implementationSteps,\n          potentialSavings,\n          estimatedImplementationTime: this._estimateImplementationTime(recommendation)\n        };\n      })\n    );\n  }\n\n  /**\n   * ‰º∞ÁÆóÂÆûÊñΩÊó∂Èó¥\n   * @param {Object} recommendation - Êé®Ëçê\n   * @returns {string} ‰º∞ÁÆóÊó∂Èó¥\n   */\n  static _estimateImplementationTime(recommendation) {\n    // Ê†πÊçÆ‰ºòÂÖàÁ∫ßÂíåÁ±ªÂûã‰º∞ÁÆóÂÆûÊñΩÊó∂Èó¥\n    const baseHours = recommendation.priority >= 8 ? 2 : recommendation.priority >= 5 ? 4 : 8;\n    const typeFactor = recommendation.type === 'maintenance' ? 0.8 : 1;\n    const hours = Math.round(baseHours * typeFactor);\n\n    return hours <= 1 ? '1Â∞èÊó∂‰ª•ÂÜÖ' : `${hours}Â∞èÊó∂`;\n  }\n\n  /**\n   * ËÆ°ÁÆóËäÇËÉΩÊé®ËçêËØ¶ÊÉÖ\n   * @param {Object} recommendation - Êé®Ëçê\n   * @returns {Promise<Object>} ËäÇËÉΩËØ¶ÊÉÖ\n   */\n  static async _calculateEnergySavingDetails(recommendation) {\n    // ËøôÈáåÂ∫îËØ•ÊúâÊõ¥Â§çÊùÇÁöÑËÆ°ÁÆóÈÄªËæë\n    return {\n      currentConsumption: Math.round(Math.random() * 1000),\n      potentialReduction: Math.round(Math.random() * 30 + 10),\n      unit: 'kWh/Â§©',\n      affectedDevices: recommendation.actions?.deviceIds?.length || 1\n    };\n  }\n\n  /**\n   * Ëé∑ÂèñËäÇËÉΩÂÆûÊñΩÊ≠•È™§\n   * @param {Object} recommendation - Êé®Ëçê\n   * @returns {Array} ÂÆûÊñΩÊ≠•È™§\n   */\n  static _getEnergySavingSteps(recommendation) {\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (recommendation.actions?.type === 'schedule_adjustment') {\n      return [\n        'ÂàÜÊûêÂΩìÂâçËÆæÂ§áËøêË°åÊó∂Èó¥Ë°®',\n        'Ë∞ÉÊï¥ËÆæÂ§áËøêË°åÊó∂ÊÆµËá≥ÈùûÈ´òÂ≥∞Êó∂ÊÆµ',\n        'ËÆæÁΩÆÊñ∞ÁöÑËÆæÂ§áËøêË°åËÆ°Âàí',\n        'ÁõëÊéßË∞ÉÊï¥ÂêéÁöÑËÉΩËÄóÂèòÂåñ',\n        'Ê†πÊçÆÊïàÊûúÂæÆË∞ÉËøêË°åËÆ°Âàí'\n      ];\n    } else if (recommendation.actions?.type === 'device_adjustment') {\n      return [\n        'Ê£ÄÊü•ÁõÆÊ†áËÆæÂ§áÂΩìÂâçËÆæÁΩÆ',\n        'Ë∞ÉÊï¥ËÆæÂ§áÂèÇÊï∞Ëá≥‰ºòÂåñÂÄº',\n        'ÊµãËØïË∞ÉÊï¥ÂêéÁöÑËÆæÂ§áËøêË°åÁä∂ÊÄÅ',\n        'ËÆ∞ÂΩïËÉΩËÄóÂèòÂåñÊï∞ÊçÆ',\n        'Á°ÆËÆ§ËäÇËÉΩÊïàÊûú'\n      ];\n    }\n\n    return [\n      'ËØÑ‰º∞ÂΩìÂâçËÉΩÊ∫ê‰ΩøÁî®ÊÉÖÂÜµ',\n      'Âà∂ÂÆöËäÇËÉΩÊé™ÊñΩÂÆûÊñΩËÆ°Âàí',\n      'ÂÆûÊñΩËäÇËÉΩÊé™ÊñΩ',\n      'ÁõëÊéßËÉΩÊ∫êÊ∂àËÄóÂèòÂåñ',\n      '‰ºòÂåñË∞ÉÊï¥ËäÇËÉΩÊé™ÊñΩ'\n    ];\n  }\n\n  /**\n   * ‰º∞ÁÆóËäÇËÉΩÊïàÊûú\n   * @param {Object} recommendation - Êé®Ëçê\n   * @returns {Promise<Object>} ËäÇËÉΩ‰º∞ÁÆó\n   */\n  static async _estimateEnergySavings(_recommendation) {\n    // ËøôÈáåÂ∫îËØ•ÊúâÊõ¥Â§çÊùÇÁöÑ‰º∞ÁÆóÈÄªËæë\n    const dailySavings = Math.round(Math.random() * 50 + 10);\n    return {\n      daily: dailySavings,\n      monthly: Math.round(dailySavings * 30),\n      annual: Math.round(dailySavings * 365),\n      unit: 'kWh',\n      carbonReduction: Math.round((dailySavings * 0.5 * 365) / 1000) // Á≤óÁï•‰º∞ÁÆóÁ¢≥ÊéíÊîæÂáèÂ∞ë\n    };\n  }\n\n  /**\n   * ËÆ°ÁÆóÊàêÊú¨Èôç‰ΩéËØ¶ÊÉÖ\n   * @param {Object} recommendation - Êé®Ëçê\n   * @returns {Promise<Object>} ÊàêÊú¨ËØ¶ÊÉÖ\n   */\n  static async _calculateCostReductionDetails(_recommendation) {\n    // ËøôÈáåÂ∫îËØ•ÊúâÊõ¥Â§çÊùÇÁöÑËÆ°ÁÆóÈÄªËæë\n    return {\n      currentCost: Math.round(Math.random() * 1000 + 500),\n      potentialReductionPercent: Math.round(Math.random() * 20 + 5),\n      unit: 'ÂÖÉ/Êúà'\n    };\n  }\n\n  /**\n   * Ëé∑ÂèñÊàêÊú¨Èôç‰ΩéÂÆûÊñΩÊ≠•È™§\n   * @param {Object} recommendation - Êé®Ëçê\n   * @returns {Array} ÂÆûÊñΩÊ≠•È™§\n   */\n  static _getCostReductionSteps() {\n    return [\n      'ÂàÜÊûêÂΩìÂâçËÉΩÊ∫êÊàêÊú¨ÁªìÊûÑ',\n      'ËØÜÂà´ÊàêÊú¨‰ºòÂåñÊú∫‰ºö',\n      'Âà∂ÂÆöÊàêÊú¨‰ºòÂåñÊñπÊ°à',\n      'ÂÆûÊñΩÊàêÊú¨‰ºòÂåñÊé™ÊñΩ',\n      'ÁõëÊéßÊàêÊú¨ÂèòÂåñÂπ∂Ë∞ÉÊï¥'\n    ];\n  }\n\n  /**\n   * ‰º∞ÁÆóÊàêÊú¨ËäÇÁ∫¶\n   * @param {Object} recommendation - Êé®Ëçê\n   * @returns {Promise<Object>} ÊàêÊú¨ËäÇÁ∫¶‰º∞ÁÆó\n   */\n  static async _estimateCostSavings(_recommendation) {\n    // ËøôÈáåÂ∫îËØ•ÊúâÊõ¥Â§çÊùÇÁöÑ‰º∞ÁÆóÈÄªËæë\n    const monthlySavings = Math.round(Math.random() * 500 + 100);\n    return {\n      daily: Math.round(monthlySavings / 30),\n      monthly: monthlySavings,\n      annual: Math.round(monthlySavings * 12),\n      unit: 'ÂÖÉ'\n    };\n  }\n\n  /**\n   * Ëé∑ÂèñÁª¥Êä§ËØ¶ÊÉÖ\n   * @param {Object} recommendation - Êé®Ëçê\n   * @returns {Promise<Object>} Áª¥Êä§ËØ¶ÊÉÖ\n   */\n  static async _getMaintenanceDetails(recommendation) {\n    // ËøôÈáåÂ∫îËØ•ÊúâÊõ¥Â§çÊùÇÁöÑÈÄªËæë\n    return {\n      deviceName: recommendation.actions?.deviceName || 'ÁõÆÊ†áËÆæÂ§á',\n      issue: recommendation.actions?.issue || 'ÊΩúÂú®ÊïÖÈöúÈ£éÈô©',\n      urgency: recommendation.priority >= 8 ? 'È´ò' : recommendation.priority >= 5 ? '‰∏≠' : '‰Ωé',\n      estimatedCost: Math.round(Math.random() * 1000 + 200),\n      estimatedDowntime: Math.round(Math.random() * 4 + 1) // Â∞èÊó∂\n    };\n  }\n\n  /**\n   * Ëé∑ÂèñÁª¥Êä§ÂÆûÊñΩÊ≠•È™§\n   * @param {Object} recommendation - Êé®Ëçê\n   * @returns {Array} ÂÆûÊñΩÊ≠•È™§\n   */\n  static _getMaintenanceSteps() {\n    return [\n      'ÂáÜÂ§áÁª¥Êä§Â∑•ÂÖ∑ÂíåÂ§á‰ª∂',\n      'ÂÆâÊéíÁª¥Êä§Êó∂Èó¥Á™óÂè£',\n      'ÊâßË°åÁª¥Êä§Êìç‰Ωú',\n      'ÊµãËØïËÆæÂ§áËøêË°åÁä∂ÊÄÅ',\n      'ËÆ∞ÂΩïÁª¥Êä§ÁªìÊûú'\n    ];\n  }\n\n  /**\n   * ‰º∞ÁÆóÁª¥Êä§ËäÇÁ∫¶\n   * @param {Object} recommendation - Êé®Ëçê\n   * @returns {Promise<Object>} Áª¥Êä§ËäÇÁ∫¶‰º∞ÁÆó\n   */\n  static async _estimateMaintenanceSavings() {\n    // ËøôÈáåÂ∫îËØ•ÊúâÊõ¥Â§çÊùÇÁöÑ‰º∞ÁÆóÈÄªËæë\n    const potentialCost = Math.round(Math.random() * 5000 + 1000);\n    return {\n      potentialFailureCost: potentialCost,\n      maintenanceCost: Math.round(potentialCost * 0.2),\n      savings: potentialCost - Math.round(potentialCost * 0.2),\n      unit: 'ÂÖÉ'\n    };\n  }\n\n  /**\n   * ËØÑ‰º∞Êé®ËçêÂÆûÊñΩÊïàÊûú\n   * @param {string} recommendationId - Êé®ËçêID\n   * @param {Date} startDate - ÂºÄÂßãÊó•Êúü\n   * @param {Date} endDate - ÁªìÊùüÊó•Êúü\n   * @returns {Promise<Object>} ËØÑ‰º∞ÁªìÊûú\n   */\n  static async evaluateRecommendationEffectiveness(recommendationId, startDate, endDate) {\n    // Ëé∑ÂèñÊé®ËçêËØ¶ÊÉÖ - Ê®°ÊãüÊï∞ÊçÆÂ∫ìÊü•ËØ¢\n    const recommendation = {\n      id: recommendationId,\n      type: 'energy_saving',\n      title: 'Ê®°ÊãüÊé®Ëçê',\n      description: 'ËøôÊòØ‰∏Ä‰∏™Ê®°ÊãüÁöÑÊé®ËçêÈ°πÁõÆ'\n    };\n    if (!recommendation) {\n      throw new Error('Êé®Ëçê‰∏çÂ≠òÂú®');\n    }\n\n    // Ëé∑ÂèñÊé®ËçêÂ∫îÁî®ÂâçÁöÑÊï∞ÊçÆ\n\n    // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 25 Ë°å)\n\n    // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 25 Ë°å)\n\n    // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 25 Ë°å)\n\n    // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 25 Ë°å)\n\n    const preStartDate = moment(startDate).subtract(1, 'month').toDate();\n    const preEndDate = moment(startDate).subtract(1, 'day').toDate();\n\n    // Ê†πÊçÆÊé®ËçêÁ±ªÂûãËØÑ‰º∞ÊïàÊûú\n    let evaluation = {};\n\n    switch (recommendation.type) {\n      case 'energy_saving':\n        evaluation = await this._evaluateEnergySavingEffectiveness(\n          recommendation,\n          preStartDate,\n          preEndDate,\n          startDate,\n          endDate\n        );\n        break;\n      case 'cost_reduction':\n        evaluation = await this._evaluateCostReductionEffectiveness(\n          recommendation,\n          preStartDate,\n          preEndDate,\n          startDate,\n          endDate\n        );\n        break;\n      default:\n        evaluation = {\n          status: 'not_evaluated',\n          message: 'ÊöÇ‰∏çÊîØÊåÅËØ•Á±ªÂûãÊé®ËçêÁöÑËá™Âä®ËØÑ‰º∞'\n        };\n    }\n\n    // ‰øùÂ≠òËØÑ‰º∞ÁªìÊûú - Ê®°Êãü‰øùÂ≠ò\n    const evaluationRecord = {\n      id: uuidv4(),\n      recommendation_id: recommendationId,\n      evaluation_data: JSON.stringify(evaluation),\n      evaluated_at: new Date()\n    };\n    console.log('ËØÑ‰º∞ÁªìÊûúÂ∑≤‰øùÂ≠ò:', evaluationRecord.id);\n\n    return evaluation;\n  }\n}\n\nexport default RecommendationService;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/data/collector.js","messages":[{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1883.","line":27,"column":57,"nodeType":"Literal","messageId":"noMagic","endLine":27,"endColumn":61},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":62,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":62,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1583,1613],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":74,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":74,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[1971,2015],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":79,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":79,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2111,2139],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":84,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":84,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2239,2271],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":87,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":87,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[2310,2345],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":99,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":99,"endColumn":24,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[2562,2611],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":101,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":101,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2639,2673],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":118,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":118,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[3012,3055],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":134,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":134,"endColumn":23,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[3448,3487],"text":""},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":137,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":137,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[3524,3570],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":179,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":179,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[4512,4538],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":185,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":185,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[4626,4654],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 24.","line":190,"column":42,"nodeType":"Literal","messageId":"noMagic","endLine":190,"endColumn":44},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":190,"column":47,"nodeType":"Literal","messageId":"noMagic","endLine":190,"endColumn":49},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":190,"column":52,"nodeType":"Literal","messageId":"noMagic","endLine":190,"endColumn":54},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":190,"column":57,"nodeType":"Literal","messageId":"noMagic","endLine":190,"endColumn":61},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":192,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":192,"endColumn":19,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[4806,4838],"text":""},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":197,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":197,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[4933,4963],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":203,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":203,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[5117,5145],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100000.","line":217,"column":49,"nodeType":"Literal","messageId":"noMagic","endLine":217,"endColumn":55},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":219,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":219,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[5488,5549],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":235,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":235,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[5963,6028],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":254,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":254,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[6396,6422],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":260,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":260,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[6537,6568],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 3.","line":278,"column":37,"nodeType":"Literal","messageId":"noMagic","endLine":278,"endColumn":38},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":280,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":280,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[6965,7009],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":298,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":298,"endColumn":21,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[7330,7368],"text":""},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":305,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":305,"endColumn":21,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[7520,7564],"text":""},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":312,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":312,"endColumn":21,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[7726,7795],"text":""},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":338,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":338,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[8647,8750],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":342,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":342,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[8779,8813],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":355,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":355,"endColumn":21,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[9043,9089],"text":""},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":373,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":373,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[9594,9626],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 32.","line":394,"column":36,"nodeType":"Literal","messageId":"noMagic","endLine":394,"endColumn":38},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5.","line":394,"column":42,"nodeType":"Literal","messageId":"noMagic","endLine":394,"endColumn":43},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 9.","line":394,"column":47,"nodeType":"Literal","messageId":"noMagic","endLine":394,"endColumn":48},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 273.15.","line":395,"column":31,"nodeType":"Literal","messageId":"noMagic","endLine":395,"endColumn":37},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":411,"column":42,"nodeType":"Literal","messageId":"noMagic","endLine":411,"endColumn":46},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":411,"column":50,"nodeType":"Literal","messageId":"noMagic","endLine":411,"endColumn":54},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5.","line":422,"column":77,"nodeType":"Literal","messageId":"noMagic","endLine":422,"endColumn":78},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 3.","line":430,"column":35,"nodeType":"Literal","messageId":"noMagic","endLine":430,"endColumn":36},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.5.","line":437,"column":23,"nodeType":"Literal","messageId":"noMagic","endLine":437,"endColumn":26},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.3.","line":439,"column":36,"nodeType":"Literal","messageId":"noMagic","endLine":439,"endColumn":39},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.7.","line":439,"column":52,"nodeType":"Literal","messageId":"noMagic","endLine":439,"endColumn":55},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":439,"column":59,"nodeType":"Literal","messageId":"noMagic","endLine":439,"endColumn":63},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":439,"column":67,"nodeType":"Literal","messageId":"noMagic","endLine":439,"endColumn":71},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":444,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":444,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[11558,11590],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 50.","line":455,"column":82,"nodeType":"Literal","messageId":"noMagic","endLine":455,"endColumn":84},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":457,"column":35,"nodeType":"Literal","messageId":"noMagic","endLine":457,"endColumn":37},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 3.","line":468,"column":20,"nodeType":"Literal","messageId":"noMagic","endLine":468,"endColumn":21},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":483,"column":42,"nodeType":"Literal","messageId":"noMagic","endLine":483,"endColumn":45},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":489,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":489,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[12812,12844],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":497,"column":51,"nodeType":"Literal","messageId":"noMagic","endLine":497,"endColumn":53},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":535,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":535,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[13927,13961],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.001.","line":585,"column":59,"nodeType":"Literal","messageId":"noMagic","endLine":585,"endColumn":64},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.001.","line":587,"column":60,"nodeType":"Literal","messageId":"noMagic","endLine":587,"endColumn":65},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":632,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":632,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[16314,16350],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":634,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":634,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[16379,16411],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":646,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":646,"endColumn":21,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[16614,16662],"text":""},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":652,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":652,"endColumn":21,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[16781,16828],"text":""},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":656,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":656,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[16877,16957],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":658,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":658,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[16986,17021],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":670,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":670,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[17203,17261],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":672,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":672,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[17290,17324],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":756,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":756,"endColumn":21,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[19310,19353],"text":""},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":775,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":775,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[19848,19925],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 4.","line":775,"column":57,"nodeType":"Literal","messageId":"noMagic","endLine":775,"endColumn":58},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":777,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":777,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[19954,19987],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":903,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":903,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[22577,22610],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":910,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":910,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[22674,22698],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":917,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":917,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[22790,22814],"text":""},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":72,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createRequire } from 'module';\nimport { v4 as uuidv4 } from 'uuid';\nimport { dbPromise } from '../database.js';\nimport { alertManager as _alertManager } from '../alerts/AlertManager.js';\n\nconst require = createRequire(import.meta.url);\nconst mqtt = require('mqtt');\n\n/**\n * Êï∞ÊçÆÈááÈõÜÂô®Á±ª\n * Ë¥üË¥£MQTTÊï∞ÊçÆÊé•Êî∂„ÄÅÈ™åËØÅ„ÄÅÂ§ÑÁêÜÂíåÂ≠òÂÇ®\n */\nclass DataCollector {\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 22 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 22 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 22 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 22 Ë°å)\n\n  constructor(mqttConfig = {}) {\n    this.mqttClient = null;\n    this.config = {\n      host: mqttConfig.host || process.env.MQTT_HOST || 'localhost',\n      port: mqttConfig.port || process.env.MQTT_PORT || 1883,\n      username: mqttConfig.username || process.env.MQTT_USERNAME,\n      password: mqttConfig.password || process.env.MQTT_PASSWORD,\n      ...mqttConfig\n    };\n\n    this.topics = {\n      energy: 'energy/realtime/+',\n      carbon: 'carbon/realtime/+',\n      device_status: 'device/status/+',\n      sensor_data: 'sensor/data/+'\n    };\n\n    this.dataBuffer = new Map(); // Êï∞ÊçÆÁºìÂÜ≤Âå∫\n    this.isConnected = false;\n    this.lastMessageTime = null;\n    this.connectionTime = null;\n  }\n\n  /**\n   * ÂàùÂßãÂåñMQTTËøûÊé•\n   */\n  async initialize() {\n    try {\n      const mqttUrl = `mqtt://${this.config.host}:${this.config.port}`;\n\n      this.mqttClient = mqtt.connect(mqttUrl, {\n        username: this.config.username,\n        password: this.config.password,\n        keepalive: 60,\n        reconnectPeriod: 5000,\n        connectTimeout: 30000\n      });\n\n      this.mqttClient.on('connect', () => {\n        console.log('‚úÖ MQTTÊï∞ÊçÆÈááÈõÜÂô®Â∑≤ËøûÊé•');\n        this.isConnected = true;\n        this.connectionTime = new Date().toISOString();\n        this.subscribeToTopics();\n      });\n\n      this.mqttClient.on('message', (topic, message) => {\n        this.lastMessageTime = new Date().toISOString();\n        this.handleMessage(topic, message);\n      });\n\n      this.mqttClient.on('error', error => {\n        console.error('‚ùå MQTTËøûÊé•ÈîôËØØ:', error.message);\n        this.isConnected = false;\n      });\n\n      this.mqttClient.on('close', () => {\n        console.log('üîå MQTTËøûÊé•Â∑≤Êñ≠ÂºÄ');\n        this.isConnected = false;\n      });\n\n      this.mqttClient.on('reconnect', () => {\n        console.log('üîÑ Ê≠£Âú®ÈáçÊñ∞ËøûÊé•MQTT...');\n      });\n    } catch (error) {\n      console.error('MQTTÂàùÂßãÂåñÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * ËÆ¢ÈòÖÊâÄÊúâ‰∏ªÈ¢ò\n   */\n  subscribeToTopics() {\n    Object.entries(this.topics).forEach(([_key, topic]) => {\n      this.mqttClient.subscribe(topic, err => {\n        if (err) {\n          console.error(`‚ùå ËÆ¢ÈòÖ‰∏ªÈ¢òÂ§±Ë¥• ${topic}:`, err.message);\n        } else {\n          console.log(`üì° Â∑≤ËÆ¢ÈòÖ‰∏ªÈ¢ò: ${topic}`);\n        }\n      });\n    });\n  }\n\n  /**\n   * Â§ÑÁêÜÊé•Êî∂Âà∞ÁöÑMQTTÊ∂àÊÅØ\n   */\n  async handleMessage(topic, message) {\n    try {\n      const payload = JSON.parse(message.toString());\n      const topicParts = topic.split('/');\n      const [dataType, , deviceId] = topicParts;\n\n      // È™åËØÅÊï∞ÊçÆÊ†ºÂºè\n      if (!this.validatePayload(payload, dataType)) {\n        console.error(`‚ùå Êï∞ÊçÆÊ†ºÂºèÈ™åËØÅÂ§±Ë¥• - ‰∏ªÈ¢ò: ${topic}`);\n        return;\n      }\n\n      // Ê†πÊçÆÊï∞ÊçÆÁ±ªÂûãÂ§ÑÁêÜ\n      switch (dataType) {\n        case 'energy':\n          await this.handleEnergyData(deviceId, payload);\n          break;\n        case 'sensor':\n          await this.handleSensorData(deviceId, payload);\n          break;\n        case 'device':\n          await this.handleDeviceStatus(deviceId, payload);\n          break;\n        default:\n          console.warn(`‚ö†Ô∏è Êú™Áü•Êï∞ÊçÆÁ±ªÂûã: ${dataType}`);\n      }\n    } catch (error) {\n      console.error(`Ê∂àÊÅØÂ§ÑÁêÜÂ§±Ë¥• - ‰∏ªÈ¢ò: ${topic}`, error);\n    }\n  }\n\n  /**\n   * È™åËØÅÊï∞ÊçÆËΩΩËç∑Ê†ºÂºè\n   */\n  validatePayload(payload, dataType) {\n    const requiredFields = {\n      energy: ['timestamp', 'value', 'unit', 'type'],\n      sensor: ['timestamp', 'value', 'unit', 'sensor_id'],\n      device: ['timestamp', 'status']\n    };\n\n    const required = requiredFields[dataType];\n    if (!required) {return false;}\n\n    // Ê£ÄÊü•ÂøÖÂ°´Â≠óÊÆµ\n    if (!required.every(field => Object.prototype.hasOwnProperty.call(payload, field))) {\n      return false;\n    }\n\n    // Êï∞ÊçÆÁ±ªÂûãÂíåËåÉÂõ¥È™åËØÅ\n    switch (dataType) {\n      case 'energy':\n        return this.validateEnergyData(payload);\n      case 'sensor':\n        return this.validateSensorData(payload);\n      case 'device':\n        return this.validateDeviceData(payload);\n      default:\n        return false;\n    }\n  }\n\n  /**\n   * È™åËØÅËÉΩÊ∫êÊï∞ÊçÆ\n   */\n  validateEnergyData(payload) {\n    // È™åËØÅÊó∂Èó¥Êà≥\n    const timestamp = new Date(payload.timestamp);\n    if (isNaN(timestamp.getTime())) {\n      console.error('Êó†ÊïàÁöÑÊó∂Èó¥Êà≥Ê†ºÂºè');\n      return false;\n    }\n\n    // È™åËØÅÊó∂Èó¥Êà≥‰∏çËÉΩÊòØÊú™Êù•Êó∂Èó¥\n    if (timestamp > new Date()) {\n      console.error('Êó∂Èó¥Êà≥‰∏çËÉΩÊòØÊú™Êù•Êó∂Èó¥');\n      return false;\n    }\n\n    // È™åËØÅÊó∂Èó¥Êà≥‰∏çËÉΩÂ§™ÊóßÔºàË∂ÖËøá24Â∞èÊó∂Ôºâ\n    const dayAgo = new Date(Date.now() - 24 * 60 * 60 * 1000);\n    if (timestamp < dayAgo) {\n      console.warn('Êï∞ÊçÆÊó∂Èó¥Êà≥ËøáÊóßÔºåÂèØËÉΩÊòØÂéÜÂè≤Êï∞ÊçÆ');\n    }\n\n    // È™åËØÅÊï∞ÂÄº\n    if (typeof payload.value !== 'number' || isNaN(payload.value)) {\n      console.error('ËÉΩÊ∫êÊï∞ÊçÆÂÄºÂøÖÈ°ªÊòØÊúâÊïàÊï∞Â≠ó');\n      return false;\n    }\n\n    // È™åËØÅÊï∞ÂÄºËåÉÂõ¥Ôºà‰∏çËÉΩ‰∏∫Ë¥üÊï∞ÔºåÈô§ÈùûÊòØÁâπÊÆäÁ±ªÂûãÂ¶ÇÂáÄËÉΩËÄóÔºâ\n    if (payload.value < 0 && !['net_energy', 'power_factor'].includes(payload.type)) {\n      console.error('ËÉΩÊ∫êÊï∞ÊçÆÂÄº‰∏çËÉΩ‰∏∫Ë¥üÊï∞');\n      return false;\n    }\n\n    // È™åËØÅÊï∞ÂÄº‰∏äÈôêÔºàÈò≤Ê≠¢ÂºÇÂ∏∏Â§ßÁöÑÊï∞ÂÄºÔºâ\n    const maxValues = {\n      electricity: 10000, // kWh\n      water: 1000, // m¬≥\n      gas: 1000, // m¬≥\n      power: 5000, // kW\n      temperature: 100, // ¬∞C\n      humidity: 100 // %\n    };\n\n    const maxValue = maxValues[payload.type] || 100000;\n    if (payload.value > maxValue) {\n      console.error(`ËÉΩÊ∫êÊï∞ÊçÆÂÄºË∂ÖÂá∫ÂêàÁêÜËåÉÂõ¥: ${payload.value} > ${maxValue}`);\n      return false;\n    }\n\n    // È™åËØÅÂçï‰Ωç\n    const validUnits = {\n      electricity: ['kWh', 'MWh', 'kW', 'MW'],\n      water: ['m¬≥', 'L', 'gal'],\n      gas: ['m¬≥', 'L', 'ft¬≥'],\n      power: ['kW', 'MW', 'W'],\n      temperature: ['¬∞C', '¬∞F', 'K'],\n      humidity: ['%']\n    };\n\n    const allowedUnits = validUnits[payload.type] || [];\n    if (allowedUnits.length > 0 && !allowedUnits.includes(payload.unit)) {\n      console.error(`Êó†ÊïàÁöÑÂçï‰Ωç: ${payload.unit} for type ${payload.type}`);\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * È™åËØÅ‰º†ÊÑüÂô®Êï∞ÊçÆ\n   */\n  validateSensorData(payload) {\n    // È™åËØÅÊó∂Èó¥Êà≥\n    const timestamp = new Date(payload.timestamp);\n    if (isNaN(timestamp.getTime()) || timestamp > new Date()) {\n      return false;\n    }\n\n    // È™åËØÅ‰º†ÊÑüÂô®IDÊ†ºÂºè\n    if (typeof payload.sensor_id !== 'string' || payload.sensor_id.length === 0) {\n      console.error('Êó†ÊïàÁöÑ‰º†ÊÑüÂô®ID');\n      return false;\n    }\n\n    // È™åËØÅÊï∞ÂÄº\n    if (typeof payload.value !== 'number' || isNaN(payload.value)) {\n      console.error('‰º†ÊÑüÂô®Êï∞ÊçÆÂÄºÂøÖÈ°ªÊòØÊúâÊïàÊï∞Â≠ó');\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * È™åËØÅËÆæÂ§áÊï∞ÊçÆ\n   */\n  validateDeviceData(payload) {\n    // È™åËØÅÊó∂Èó¥Êà≥\n    const timestamp = new Date(payload.timestamp);\n    if (isNaN(timestamp.getTime()) || timestamp > new Date()) {\n      return false;\n    }\n\n    // È™åËØÅÁä∂ÊÄÅÂÄº\n    const validStatuses = [0, 1, 2, 3]; // 0:Á¶ªÁ∫ø, 1:Âú®Á∫ø, 2:ÊïÖÈöú, 3:Áª¥Êä§\n    if (!validStatuses.includes(payload.status)) {\n      console.error(`Êó†ÊïàÁöÑËÆæÂ§áÁä∂ÊÄÅ: ${payload.status}`);\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Â§ÑÁêÜËÉΩÊ∫êÊï∞ÊçÆ\n   */\n  async handleEnergyData(deviceId, payload) {\n    try {\n      const energyDataId = uuidv4();\n      const timestamp = new Date(payload.timestamp);\n\n      // È™åËØÅËÆæÂ§áÊòØÂê¶Â≠òÂú®\n      const device = await this.getDevice(deviceId);\n      if (!device) {\n        console.warn(`‚ö†Ô∏è ËÆæÂ§á‰∏çÂ≠òÂú®: ${deviceId}`);\n        return;\n      }\n\n      // Êï∞ÊçÆÊ∏ÖÊ¥óÂíåÂºÇÂ∏∏Ê£ÄÊµã\n      const cleanedData = await this.cleanEnergyData(deviceId, payload);\n      if (!cleanedData) {\n        console.warn(`‚ö†Ô∏è Êï∞ÊçÆÊ∏ÖÊ¥óÂ§±Ë¥•ÔºåË∑≥ËøáÊï∞ÊçÆ: ${deviceId}`);\n        return;\n      }\n\n      // ÂºÇÂ∏∏Ê£ÄÊµã\n      const anomalyResult = await this.detectAnomaly(deviceId, cleanedData);\n      if (anomalyResult.isAnomaly) {\n        console.warn(`üö® Ê£ÄÊµãÂà∞ÂºÇÂ∏∏Êï∞ÊçÆ: ${deviceId}, ÂéüÂõ†: ${anomalyResult.reason}`);\n        // ÂèØ‰ª•ÈÄâÊã©ÊòØÂê¶Â≠òÂÇ®ÂºÇÂ∏∏Êï∞ÊçÆÔºåËøôÈáåÊàë‰ª¨Ê†áËÆ∞‰ΩÜ‰ªçÁÑ∂Â≠òÂÇ®\n        cleanedData.is_anomaly = true;\n        cleanedData.anomaly_reason = anomalyResult.reason;\n      }\n\n      // Â≠òÂÇ®ËÉΩÊ∫êÊï∞ÊçÆ\n      await this.saveEnergyData({\n        id: energyDataId,\n        device_id: deviceId,\n        sensor_id: payload.sensor_id || null,\n        data_type: this.getEnergyDataType(payload.type),\n        value: cleanedData.value,\n        unit: cleanedData.unit,\n        timestamp: timestamp.toISOString(),\n        created_at: new Date().toISOString(),\n        is_anomaly: cleanedData.is_anomaly || false,\n        anomaly_reason: cleanedData.anomaly_reason || null\n      });\n\n      // ËÆ°ÁÆóÂπ∂Â≠òÂÇ®Á¢≥ÊéíÊîæÊï∞ÊçÆ\n      await this.calculateAndStoreCarbonEmission(energyDataId, payload.type, cleanedData.value);\n\n      // Ê£ÄÊü•ÊòØÂê¶ÈúÄË¶ÅËß¶ÂèëÂëäË≠¶\n      await this.checkAlertRules(deviceId, payload.sensor_id, cleanedData);\n\n      console.log(\n        `‚úÖ ËÉΩÊ∫êÊï∞ÊçÆÂ∑≤‰øùÂ≠ò - ËÆæÂ§á: ${deviceId}, ÂÄº: ${cleanedData.value}${cleanedData.unit}`\n      );\n    } catch (error) {\n      console.error('ËÉΩÊ∫êÊï∞ÊçÆÂ§ÑÁêÜÂ§±Ë¥•:', error);\n    }\n  }\n\n  /**\n   * Êï∞ÊçÆÊ∏ÖÊ¥ó\n   */\n  async cleanEnergyData(deviceId, payload) {\n    try {\n      let cleanedValue = payload.value;\n\n      // 1. ÂéªÈô§ÊòéÊòæÁöÑÈîôËØØÂÄºÔºàÂ¶ÇË¥üÊï∞ÁîµÈáèÔºâ\n      if (payload.type === 'electricity' && cleanedValue < 0) {\n        console.warn(`‰øÆÊ≠£Ë¥üÊï∞ÁîµÈáèÂÄº: ${cleanedValue} -> 0`);\n        cleanedValue = 0;\n      }\n\n      // 2. Âçï‰ΩçÊ†áÂáÜÂåñ\n      const standardizedData = this.standardizeUnit(cleanedValue, payload.unit, payload.type);\n      cleanedValue = standardizedData.value;\n      const standardUnit = standardizedData.unit;\n\n      // 3. Êï∞ÂÄºÂπ≥ÊªëÔºàÁßªÂä®Âπ≥ÂùáÔºâ\n      const smoothedValue = await this.applySmoothingFilter(deviceId, payload.type, cleanedValue);\n\n      return {\n        value: smoothedValue,\n        unit: standardUnit,\n        type: payload.type\n      };\n    } catch (error) {\n      console.error('Êï∞ÊçÆÊ∏ÖÊ¥óÂ§±Ë¥•:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Âçï‰ΩçÊ†áÂáÜÂåñ\n   */\n  standardizeUnit(value, unit, type) {\n    const conversions = {\n      electricity: {\n        MWh: { factor: 1000, standardUnit: 'kWh' },\n        Wh: { factor: 0.001, standardUnit: 'kWh' },\n        MW: { factor: 1000, standardUnit: 'kW' },\n        W: { factor: 0.001, standardUnit: 'kW' }\n      },\n      water: {\n        L: { factor: 0.001, standardUnit: 'm¬≥' },\n        gal: { factor: 0.00378541, standardUnit: 'm¬≥' }\n      },\n      temperature: {\n        '¬∞F': { factor: f => ((f - 32) * 5) / 9, standardUnit: '¬∞C' },\n        K: { factor: k => k - 273.15, standardUnit: '¬∞C' }\n      }\n    };\n\n    const typeConversions = conversions[type];\n    if (!typeConversions || !typeConversions[unit]) {\n      return { value, unit }; // Êó†ÈúÄËΩ¨Êç¢\n    }\n\n    const conversion = typeConversions[unit];\n    const convertedValue =\n      typeof conversion.factor === 'function' ?\n        conversion.factor(value) :\n        value * conversion.factor;\n\n    return {\n      value: Math.round(convertedValue * 1000) / 1000, // ‰øùÁïô3‰ΩçÂ∞èÊï∞\n      unit: conversion.standardUnit\n    };\n  }\n\n  /**\n   * Â∫îÁî®Âπ≥ÊªëÊª§Ê≥¢Âô®\n   */\n  async applySmoothingFilter(deviceId, dataType, value) {\n    try {\n      // Ëé∑ÂèñÊúÄËøëÁöÑÂá†‰∏™Êï∞ÊçÆÁÇπ\n      const recentData = await this.getRecentEnergyData(deviceId, dataType, 5);\n\n      if (recentData.length < 2) {\n        return value; // Êï∞ÊçÆ‰∏çË∂≥Ôºå‰∏çËøõË°åÂπ≥Êªë\n      }\n\n      // ËÆ°ÁÆóÁßªÂä®Âπ≥Âùá\n      const values = [...recentData.map(d => d.value), value];\n      const windowSize = Math.min(3, values.length);\n      const recentValues = values.slice(-windowSize);\n\n      const average = recentValues.reduce((sum, v) => sum + v, 0) / recentValues.length;\n\n      // Â¶ÇÊûúÂΩìÂâçÂÄº‰∏éÂπ≥ÂùáÂÄºÂ∑ÆÂºÇËøáÂ§ßÔºå‰ΩøÁî®Âä†ÊùÉÂπ≥Âùá\n      const deviation = Math.abs(value - average) / average;\n      if (deviation > 0.5) {\n        // ÂÅèÂ∑ÆË∂ÖËøá50%\n        return Math.round((value * 0.3 + average * 0.7) * 1000) / 1000;\n      }\n\n      return value;\n    } catch (error) {\n      console.error('Âπ≥ÊªëÊª§Ê≥¢Â§±Ë¥•:', error);\n      return value;\n    }\n  }\n\n  /**\n   * ÂºÇÂ∏∏Ê£ÄÊµã\n   */\n  async detectAnomaly(deviceId, data) {\n    try {\n      // Ëé∑ÂèñÂéÜÂè≤Êï∞ÊçÆËøõË°åÁªüËÆ°ÂàÜÊûê\n      const historicalData = await this.getRecentEnergyData(deviceId, data.type, 50);\n\n      if (historicalData.length < 10) {\n        return { isAnomaly: false }; // ÂéÜÂè≤Êï∞ÊçÆ‰∏çË∂≥\n      }\n\n      const values = historicalData.map(d => d.value);\n      const mean = values.reduce((sum, v) => sum + v, 0) / values.length;\n      const variance = values.reduce((sum, v) => sum + Math.pow(v - mean, 2), 0) / values.length;\n      const stdDev = Math.sqrt(variance);\n\n      // Z-scoreÂºÇÂ∏∏Ê£ÄÊµã\n      const zScore = Math.abs(data.value - mean) / stdDev;\n      if (zScore > 3) {\n        // 3-sigmaËßÑÂàô\n        return {\n          isAnomaly: true,\n          reason: `Z-scoreÂºÇÂ∏∏: ${zScore.toFixed(2)} (ÈòàÂÄº: 3.0)`\n        };\n      }\n\n      // Ê£ÄÊü•ÊòØÂê¶‰∏∫Á™ÅÁÑ∂ÁöÑÂ§ßÂπÖÂèòÂåñ\n      const lastValue = values[values.length - 1];\n      const changeRate = Math.abs(data.value - lastValue) / lastValue;\n      if (changeRate > 2.0) {\n        // ÂèòÂåñË∂ÖËøá200%\n        return {\n          isAnomaly: true,\n          reason: `Á™ÅÁÑ∂ÂèòÂåñ: ${(changeRate * 100).toFixed(1)}% (ÈòàÂÄº: 200%)`\n        };\n      }\n\n      return { isAnomaly: false };\n    } catch (error) {\n      console.error('ÂºÇÂ∏∏Ê£ÄÊµãÂ§±Ë¥•:', error);\n      return { isAnomaly: false };\n    }\n  }\n\n  /**\n   * Ëé∑ÂèñÊúÄËøëÁöÑËÉΩÊ∫êÊï∞ÊçÆ\n   */\n  getRecentEnergyData(deviceId, dataType, limit = 10) {\n    return new Promise((resolve, reject) => {\n      const sql = `\n        SELECT value, timestamp \n        FROM energy_data \n        WHERE device_id = ? AND data_type = ?\n        ORDER BY timestamp DESC \n        LIMIT ?\n      `;\n\n      (async () => {\n        try {\n          const db = await dbPromise;\n          const result = await db.raw(sql, [deviceId, this.getEnergyDataType(dataType), limit]);\n          resolve(result.rows || []);\n        } catch (err) {\n          reject(err);\n        }\n      })();\n    });\n  }\n\n  /**\n   * Ê£ÄÊü•ÂëäË≠¶ËßÑÂàô\n   */\n  async checkAlertRules(deviceId, sensorId, data) {\n    try {\n      // Ëé∑ÂèñÁõ∏ÂÖ≥ÁöÑÂëäË≠¶ËßÑÂàô\n      const rules = await this.getActiveAlertRules(deviceId, sensorId);\n\n      for (const rule of rules) {\n        const shouldAlert = this.evaluateAlertCondition(rule, data.value);\n\n        if (shouldAlert) {\n          await this.createAlert(rule, deviceId, sensorId, data.value);\n        }\n      }\n    } catch (error) {\n      console.error('ÂëäË≠¶ËßÑÂàôÊ£ÄÊü•Â§±Ë¥•:', error);\n    }\n  }\n\n  /**\n   * Ëé∑ÂèñÊ¥ªË∑ÉÁöÑÂëäË≠¶ËßÑÂàô\n   */\n  getActiveAlertRules(deviceId, sensorId) {\n    return new Promise((resolve, reject) => {\n      let sql = `\n        SELECT * FROM alert_rules \n        WHERE is_active = 1 AND (\n          device_id = ? OR device_id IS NULL\n        )\n      `;\n      const params = [deviceId];\n\n      if (sensorId) {\n        sql += ' AND (sensor_id = ? OR sensor_id IS NULL)';\n        params.push(sensorId);\n      }\n\n      (async () => {\n        try {\n          const db = await dbPromise;\n          const result = await db.raw(sql, params);\n          resolve(result.rows || []);\n        } catch (err) {\n          reject(err);\n        }\n      })();\n    });\n  }\n\n  /**\n   * ËØÑ‰º∞ÂëäË≠¶Êù°‰ª∂\n   */\n  evaluateAlertCondition(rule, currentValue) {\n    const { condition_operator, threshold_value } = rule;\n\n    switch (condition_operator) {\n      case '>':\n        return currentValue > threshold_value;\n      case '<':\n        return currentValue < threshold_value;\n      case '>=':\n        return currentValue >= threshold_value;\n      case '<=':\n        return currentValue <= threshold_value;\n      case '=':\n        return Math.abs(currentValue - threshold_value) < 0.001;\n      case '!=':\n        return Math.abs(currentValue - threshold_value) >= 0.001;\n      default:\n        return false;\n    }\n  }\n\n  /**\n   * ÂàõÂª∫ÂëäË≠¶\n   */\n  async createAlert(rule, deviceId, sensorId, currentValue) {\n    try {\n      const alertId = uuidv4();\n      const message = `${rule.name}: ÂΩìÂâçÂÄº ${currentValue} ${rule.condition_operator} ÈòàÂÄº ${rule.threshold_value}`;\n\n      const sql = `\n        INSERT INTO alerts (\n          id, rule_id, device_id, sensor_id, alert_level, message,\n          current_value, threshold_value, created_at\n        ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP)\n      `;\n\n      await new Promise((resolve, reject) => {\n        (async () => {\n          try {\n            const db = await dbPromise;\n            await db.raw(\n              sql,\n              [\n                alertId,\n                rule.id,\n                deviceId,\n                sensorId,\n                rule.severity,\n                message,\n                currentValue,\n                rule.threshold_value\n              ]\n            );\n            resolve();\n          } catch (err) {\n            reject(err);\n          }\n        })();\n      });\n\n      console.log(`üö® ÂëäË≠¶Â∑≤ÂàõÂª∫: ${message}`);\n    } catch (error) {\n      console.error('ÂàõÂª∫ÂëäË≠¶Â§±Ë¥•:', error);\n    }\n  }\n\n  /**\n   * Â§ÑÁêÜ‰º†ÊÑüÂô®Êï∞ÊçÆ\n   */\n  async handleSensorData(deviceId, payload) {\n    try {\n      // È™åËØÅ‰º†ÊÑüÂô®ÊòØÂê¶Â≠òÂú®\n      const sensor = await this.getSensor(payload.sensor_id);\n      if (!sensor) {\n        console.warn(`‚ö†Ô∏è ‰º†ÊÑüÂô®‰∏çÂ≠òÂú®: ${payload.sensor_id}`);\n        return;\n      }\n\n      // Ê£ÄÊü•Êï∞ÊçÆÊòØÂê¶Âú®ÂêàÁêÜËåÉÂõ¥ÂÜÖ\n      if (!this.isValueInRange(payload.value, sensor.range)) {\n        console.warn(`‚ö†Ô∏è ‰º†ÊÑüÂô®Êï∞ÊçÆË∂ÖÂá∫ËåÉÂõ¥: ${payload.value}`);\n      }\n\n      // Â≠òÂÇ®‰º†ÊÑüÂô®Êï∞ÊçÆÔºàÂèØ‰ª•Êâ©Â±ï‰∏∫Áã¨Á´ãÁöÑ‰º†ÊÑüÂô®Êï∞ÊçÆË°®Ôºâ\n      console.log(`üìä ‰º†ÊÑüÂô®Êï∞ÊçÆ - ${payload.sensor_id}: ${payload.value}${payload.unit}`);\n    } catch (error) {\n      console.error('‰º†ÊÑüÂô®Êï∞ÊçÆÂ§ÑÁêÜÂ§±Ë¥•:', error);\n    }\n  }\n\n  /**\n   * Â§ÑÁêÜËÆæÂ§áÁä∂ÊÄÅÊï∞ÊçÆ\n   */\n  async handleDeviceStatus(deviceId, payload) {\n    try {\n      // Êõ¥Êñ∞ËÆæÂ§áÁä∂ÊÄÅ\n      await this.updateDeviceStatus(deviceId, payload.status);\n\n      console.log(`üîß ËÆæÂ§áÁä∂ÊÄÅÊõ¥Êñ∞ - ${deviceId}: ${payload.status}`);\n    } catch (error) {\n      console.error('ËÆæÂ§áÁä∂ÊÄÅÂ§ÑÁêÜÂ§±Ë¥•:', error);\n    }\n  }\n\n  /**\n   * Ëé∑ÂèñËÆæÂ§á‰ø°ÊÅØ\n   */\n  getDevice(deviceId) {\n    return new Promise((resolve, reject) => {\n      (async () => {\n        try {\n          const db = await dbPromise;\n          const result = await db.raw('SELECT * FROM devices WHERE id = ?', [deviceId]);\n          resolve(result.rows ? result.rows[0] : undefined);\n        } catch (err) {\n          reject(err);\n        }\n      })();\n    });\n  }\n\n  /**\n   * Ëé∑Âèñ‰º†ÊÑüÂô®‰ø°ÊÅØ\n   */\n  getSensor(sensorId) {\n    return new Promise((resolve, reject) => {\n      (async () => {\n        try {\n          const db = await dbPromise;\n          const result = await db.raw('SELECT * FROM sensors WHERE id = ?', [sensorId]);\n          resolve(result.rows ? result.rows[0] : undefined);\n        } catch (err) {\n          reject(err);\n        }\n      })();\n    });\n  }\n\n  /**\n   * ‰øùÂ≠òËÉΩÊ∫êÊï∞ÊçÆ\n   */\n  saveEnergyData(data) {\n    return new Promise((resolve, reject) => {\n      const sql = `\n        INSERT INTO energy_data \n        (id, device_id, sensor_id, data_type, value, unit, timestamp, created_at, is_anomaly, anomaly_reason, quality_score)\n        VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n      `;\n\n      (async () => {\n        try {\n          const db = await dbPromise;\n          await db.raw(\n            sql,\n            [\n              data.id,\n              data.device_id,\n              data.sensor_id,\n              data.data_type,\n              data.value,\n              data.unit,\n              data.timestamp,\n              data.created_at,\n              data.is_anomaly ? 1 : 0,\n              data.anomaly_reason || null,\n              data.quality_score || 1.0\n            ]\n          );\n          resolve();\n        } catch (err) {\n          reject(err);\n        }\n      })();\n    });\n  }\n\n  /**\n   * ËÆ°ÁÆóÂπ∂Â≠òÂÇ®Á¢≥ÊéíÊîæÊï∞ÊçÆ\n   */\n  async calculateAndStoreCarbonEmission(energyDataId, energyType, energyValue) {\n    try {\n      // Ëé∑ÂèñÁ¢≥ÊéíÊîæÂõ†Â≠ê\n      const carbonFactor = await this.getCarbonFactor(energyType);\n      if (!carbonFactor) {\n        console.warn(`‚ö†Ô∏è Êú™ÊâæÂà∞Á¢≥ÊéíÊîæÂõ†Â≠ê: ${energyType}`);\n        return;\n      }\n\n      // ËÆ°ÁÆóÁ¢≥ÊéíÊîæÈáè\n      const emissionValue = energyValue * carbonFactor.factor_value;\n\n      // Â≠òÂÇ®Á¢≥ÊéíÊîæÊï∞ÊçÆ\n      const carbonDataId = uuidv4();\n      await this.saveCarbonData({\n        id: carbonDataId,\n        energy_data_id: energyDataId,\n        carbon_factor_id: carbonFactor.id,\n        emission_value: emissionValue,\n        emission_unit: carbonFactor.unit,\n        calculation_method: 'direct_factor',\n        created_at: new Date().toISOString()\n      });\n\n      console.log(`üå± Á¢≥ÊéíÊîæËÆ°ÁÆóÂÆåÊàê - ${emissionValue.toFixed(4)} ${carbonFactor.unit}`);\n    } catch (error) {\n      console.error('Á¢≥ÊéíÊîæËÆ°ÁÆóÂ§±Ë¥•:', error);\n    }\n  }\n\n  /**\n   * Ëé∑ÂèñÁ¢≥ÊéíÊîæÂõ†Â≠ê\n   */\n  getCarbonFactor(energyType) {\n    return new Promise((resolve, reject) => {\n      const sql = `\n        SELECT * FROM carbon_factors \n        WHERE energy_type = ? AND is_active = 1 \n        AND (valid_to IS NULL OR valid_to > date('now'))\n        ORDER BY valid_from DESC LIMIT 1\n      `;\n\n      (async () => {\n        try {\n          const db = await dbPromise;\n          const result = await db.raw(sql, [energyType]);\n          resolve(result.rows ? result.rows[0] : undefined);\n        } catch (err) {\n          reject(err);\n        }\n      })();\n    });\n  }\n\n  /**\n   * ‰øùÂ≠òÁ¢≥ÊéíÊîæÊï∞ÊçÆ\n   */\n  saveCarbonData(data) {\n    return new Promise((resolve, reject) => {\n      const sql = `\n        INSERT INTO carbon_data \n        (id, energy_data_id, carbon_factor_id, emission_value, emission_unit, calculation_method, created_at)\n        VALUES (?, ?, ?, ?, ?, ?, ?)\n      `;\n\n      (async () => {\n        try {\n          const db = await dbPromise;\n          await db.raw(\n            sql,\n            [\n              data.id,\n              data.energy_data_id,\n              data.carbon_factor_id,\n              data.emission_value,\n              data.emission_unit,\n              data.calculation_method,\n              data.created_at\n            ]\n          );\n          resolve();\n        } catch (err) {\n          reject(err);\n        }\n      })();\n    });\n  }\n\n  /**\n   * Êõ¥Êñ∞ËÆæÂ§áÁä∂ÊÄÅ\n   */\n  updateDeviceStatus(deviceId, status) {\n    return new Promise((resolve, reject) => {\n      const sql = 'UPDATE devices SET status = ?, updated_at = CURRENT_TIMESTAMP WHERE id = ?';\n\n      (async () => {\n        try {\n          const db = await dbPromise;\n          await db.raw(sql, [status, deviceId]);\n          resolve();\n        } catch (err) {\n          reject(err);\n        }\n      })();\n    });\n  }\n\n  /**\n   * Ëé∑ÂèñËÉΩÊ∫êÊï∞ÊçÆÁ±ªÂûãÁºñÁ†Å\n   */\n  getEnergyDataType(type) {\n    const typeMap = {\n      electricity: 1,\n      natural_gas: 2,\n      diesel: 3,\n      solar: 4,\n      wind: 5\n    };\n    return typeMap[type] || 0;\n  }\n\n  /**\n   * Ê£ÄÊü•Êï∞ÂÄºÊòØÂê¶Âú®ÂêàÁêÜËåÉÂõ¥ÂÜÖ\n   */\n  isValueInRange(value, range) {\n    if (!range) {return true;}\n\n    try {\n      const [min, max] = range.split('-').map(Number);\n      return value >= min && value <= max;\n    } catch {\n      return true;\n    }\n  }\n\n  /**\n   * Ëé∑ÂèñËøûÊé•Áä∂ÊÄÅ\n   */\n  getConnectionStatus() {\n    return {\n      connected: this.isConnected,\n      topics: Object.keys(this.topics).length,\n      bufferSize: this.dataBuffer.size\n    };\n  }\n\n  /**\n   * Êñ≠ÂºÄËøûÊé•\n   */\n  disconnect() {\n    if (this.mqttClient) {\n      this.mqttClient.end();\n      console.log('üîå MQTTÊï∞ÊçÆÈááÈõÜÂô®Â∑≤Êñ≠ÂºÄËøûÊé•');\n    }\n  }\n\n  // ÂêØÂä®Êï∞ÊçÆÈááÈõÜÂô®\n  start() {\n    this.initialize();\n    console.log('Êï∞ÊçÆÈááÈõÜÂô®Â∑≤ÂêØÂä®');\n  }\n\n  // ÂÅúÊ≠¢Êï∞ÊçÆÈááÈõÜÂô®\n  stop() {\n    if (this.mqttClient) {\n      this.mqttClient.end();\n      console.log('Êï∞ÊçÆÈááÈõÜÂô®Â∑≤ÂÅúÊ≠¢');\n    }\n  }\n\n  // Ëé∑ÂèñËØ¶ÁªÜËøûÊé•Áä∂ÊÄÅ\n  getDetailedConnectionStatus() {\n    return {\n      mqtt_connected: this.mqttClient && this.isConnected,\n      mqtt_broker: process.env.MQTT_BROKER_URL || 'mqtt://localhost:1883',\n      subscribed_topics: this.topics,\n      last_message_time: this.lastMessageTime,\n      connection_time: this.connectionTime\n    };\n  }\n}\n\nexport default DataCollector;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/database/redisClient.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/index.js","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":10,"column":1,"nodeType":"MemberExpression","messageId":"unexpected","endLine":10,"endColumn":12,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[160,200],"text":""},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Èõ∂Á¢≥Âõ≠Âå∫Êï∞Â≠óÂ≠™ÁîüËÉΩÁ¢≥ÁÆ°ÁêÜÁ≥ªÁªü - ‰∏ªÂÖ•Âè£Êñá‰ª∂\n * ÂêØÂä®HTTPÊúçÂä°Âô®ÂíåÁõ∏ÂÖ≥ÊúçÂä°\n */\n\nimport './interfaces/http/index.js';\n\n// ‰∏ªÂÖ•Âè£Êñá‰ª∂Âè™ÈúÄË¶ÅÂØºÂÖ•HTTPÊúçÂä°Âô®Ê®°Âùó\n// ÊâÄÊúâÁöÑÊúçÂä°Âô®ÈÖçÁΩÆÂíåÂêØÂä®ÈÄªËæëÈÉΩÂú® interfaces/http/index.js ‰∏≠\nconsole.log('üöÄ Èõ∂Á¢≥Âõ≠Âå∫Êï∞Â≠óÂ≠™ÁîüËÉΩÁ¢≥ÁÆ°ÁêÜÁ≥ªÁªüÊ≠£Âú®ÂêØÂä®...');\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/infrastructure/database/index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/interfaces/http/DigitalTwinController.js","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'generateSecureRandom' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":30},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 16.","line":4,"column":29,"nodeType":"Literal","messageId":"noMagic","endLine":4,"endColumn":31},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":36,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":36,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[693,721],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":51,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":51,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1028,1055],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":53,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":53,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[1084,1121],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":87,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":87,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[1851,1884],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":110,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":110,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[2364,2398],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.5.","line":192,"column":40,"nodeType":"Literal","messageId":"noMagic","endLine":192,"endColumn":43},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 20.","line":192,"column":47,"nodeType":"Literal","messageId":"noMagic","endLine":192,"endColumn":49},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.5.","line":193,"column":40,"nodeType":"Literal","messageId":"noMagic","endLine":193,"endColumn":43},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 20.","line":193,"column":47,"nodeType":"Literal","messageId":"noMagic","endLine":193,"endColumn":49},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.5.","line":204,"column":27,"nodeType":"Literal","messageId":"noMagic","endLine":204,"endColumn":30},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":204,"column":34,"nodeType":"Literal","messageId":"noMagic","endLine":204,"endColumn":37},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.5.","line":206,"column":27,"nodeType":"Literal","messageId":"noMagic","endLine":206,"endColumn":30},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":206,"column":34,"nodeType":"Literal","messageId":"noMagic","endLine":206,"endColumn":37},{"ruleId":"no-unused-vars","severity":2,"message":"'message' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":256,"column":30,"nodeType":"Identifier","messageId":"unusedVar","endLine":256,"endColumn":37},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 36.","line":261,"column":57,"nodeType":"Literal","messageId":"noMagic","endLine":261,"endColumn":59},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 9.","line":261,"column":71,"nodeType":"Literal","messageId":"noMagic","endLine":261,"endColumn":72},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":265,"column":30,"nodeType":"Literal","messageId":"noMagic","endLine":265,"endColumn":33},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":266,"column":42,"nodeType":"Literal","messageId":"noMagic","endLine":266,"endColumn":45},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0xff0000.","line":285,"column":19,"nodeType":"Literal","messageId":"noMagic","endLine":285,"endColumn":27},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0xffa500.","line":288,"column":19,"nodeType":"Literal","messageId":"noMagic","endLine":288,"endColumn":27},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0xffff00.","line":291,"column":19,"nodeType":"Literal","messageId":"noMagic","endLine":291,"endColumn":27},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 3000.","line":301,"column":10,"nodeType":"Literal","messageId":"noMagic","endLine":301,"endColumn":14},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":321,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":321,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[6972,7006],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":345,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":345,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[7533,7567],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":369,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":369,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[8094,8129],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 20.","line":389,"column":44,"nodeType":"Literal","messageId":"noMagic","endLine":389,"endColumn":46},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 20.","line":389,"column":64,"nodeType":"Literal","messageId":"noMagic","endLine":389,"endColumn":66},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 20.","line":389,"column":84,"nodeType":"Literal","messageId":"noMagic","endLine":389,"endColumn":86},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":394,"column":21,"nodeType":"Literal","messageId":"noMagic","endLine":394,"endColumn":23}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":29,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import crypto from 'crypto';\n// ÂÆâÂÖ®ÈöèÊú∫Êï∞ÁîüÊàêÂáΩÊï∞\nfunction generateSecureRandom() {\n  return crypto.randomBytes(16).toString('hex');\n}\n\n/**\n * Êï∞Â≠óÂ≠™ÁîüÊéßÂà∂Âô®\n * Êï¥ÂêàÂú∫ÊôØÁÆ°ÁêÜÂíåÊï∞ÊçÆÁÆ°ÁêÜÔºåÊèê‰æõÁªü‰∏ÄÁöÑÊï∞Â≠óÂ≠™ÁîüÊé•Âè£\n */\n\nimport SceneManager from './SceneManager.js';\nimport DataManager from './DataManager.js';\n\nclass DigitalTwinController {\n  constructor(container, options = {}) {\n    this.container = container;\n    this.options = {\n      apiBaseUrl: '/api',\n      updateInterval: 11250,\n      enableRealtime: true,\n      ...options\n    };\n\n    this.sceneManager = null;\n    this.dataManager = null;\n    this.isInitialized = false;\n    this.parkData = null;\n    this.alerts = [];\n\n    this.init();\n  }\n\n  async init() {\n    try {\n      console.log('ÂàùÂßãÂåñÊï∞Â≠óÂ≠™ÁîüÁ≥ªÁªü...');\n\n      // ÂàùÂßãÂåñÂú∫ÊôØÁÆ°ÁêÜÂô®\n      this.sceneManager = new SceneManager(this.container);\n\n      // ÂàùÂßãÂåñÊï∞ÊçÆÁÆ°ÁêÜÂô®\n      this.dataManager = new DataManager(this.options.apiBaseUrl);\n\n      // ËÆæÁΩÆ‰∫ã‰ª∂ÁõëÂê¨\n      this.setupEventListeners();\n\n      // Âä†ËΩΩÂõ≠Âå∫Êï∞ÊçÆ\n      await this.loadParkData();\n\n      this.isInitialized = true;\n      console.log('Êï∞Â≠óÂ≠™ÁîüÁ≥ªÁªüÂàùÂßãÂåñÂÆåÊàê');\n    } catch (error) {\n      console.error('Êï∞Â≠óÂ≠™ÁîüÁ≥ªÁªüÂàùÂßãÂåñÂ§±Ë¥•:', error);\n      throw error;\n    }\n  }\n\n  // ËÆæÁΩÆ‰∫ã‰ª∂ÁõëÂê¨\n  setupEventListeners() {\n    // ÁõëÂê¨ËÆæÂ§áÊï∞ÊçÆÂä†ËΩΩÂÆåÊàê\n    this.dataManager.on('devicesLoaded', (devices) => {\n      this.createDevicesInScene(devices);\n    });\n\n    // ÁõëÂê¨ÂÆûÊó∂ËÉΩÊ∫êÊï∞ÊçÆ\n    this.dataManager.on('realtimeEnergyData', (data) => {\n      this.updateDeviceVisualization(data);\n    });\n\n    // ÁõëÂê¨ËÆæÂ§áÁä∂ÊÄÅÂèòÂåñ\n    this.dataManager.on('deviceStatusChanged', (data) => {\n      this.updateDeviceStatus(data);\n    });\n\n    // ÁõëÂê¨ÂëäË≠¶\n    this.dataManager.on('alert', (alert) => {\n      this.handleAlert(alert);\n    });\n\n    // ÁõëÂê¨Á¢≥ÊéíÊîæÊï∞ÊçÆ\n    this.dataManager.on('realtimeCarbonData', (data) => {\n      this.updateCarbonVisualization(data);\n    });\n\n    // ÁõëÂê¨ÈîôËØØ\n    this.dataManager.on('error', (error) => {\n      console.error('Êï∞ÊçÆÁÆ°ÁêÜÂô®ÈîôËØØ:', error);\n    });\n  }\n\n  // Âä†ËΩΩÂõ≠Âå∫Êï∞ÊçÆ\n  async loadParkData() {\n    try {\n      const response = await fetch(`${this.options.apiBaseUrl}/parks`, {\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem('token')}`\n        }\n      });\n\n      if (!response.ok) {\n        throw new Error('Ëé∑ÂèñÂõ≠Âå∫Êï∞ÊçÆÂ§±Ë¥•');\n      }\n\n      const result = await response.json();\n      this.parkData = result.data || [];\n\n      // ÂàõÂª∫Âõ≠Âå∫Âª∫Á≠ë\n      this.createBuildingsInScene();\n    } catch (error) {\n      console.error('Âä†ËΩΩÂõ≠Âå∫Êï∞ÊçÆÂ§±Ë¥•:', error);\n      // ‰ΩøÁî®Ê®°ÊãüÊï∞ÊçÆ\n      this.createMockParkData();\n    }\n  }\n\n  // ÂàõÂª∫Ê®°ÊãüÂõ≠Âå∫Êï∞ÊçÆ\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 34 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 34 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 34 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 34 Ë°å)\n\n  createMockParkData() {\n    this.parkData = {\n      id: 'park_001',\n      name: 'Èõ∂Á¢≥Á§∫ËåÉÂõ≠Âå∫',\n      buildings: [\n        {\n          id: 'building_001',\n          name: 'ÂäûÂÖ¨Ê•ºA',\n          type: 'office',\n          position: { x: 0, y: 0, z: 0 },\n          dimensions: { width: 30, height: 40, depth: 20 },\n          color: 0x66c2a5\n        },\n        {\n          id: 'building_002',\n          name: 'Áîü‰∫ßËΩ¶Èó¥B',\n          type: 'industrial',\n          position: { x: 50, y: 0, z: 0 },\n          dimensions: { width: 40, height: 25, depth: 30 },\n          color: 0x4a90e2\n        },\n        {\n          id: 'building_003',\n          name: '‰ªìÂÇ®‰∏≠ÂøÉC',\n          type: 'warehouse',\n          position: { x: -40, y: 0, z: 30 },\n          dimensions: { width: 35, height: 15, depth: 25 },\n          color: 0xfc8d62\n        }\n      ]\n    };\n\n    this.createBuildingsInScene();\n  }\n\n  // Âú®Âú∫ÊôØ‰∏≠ÂàõÂª∫Âª∫Á≠ë\n  createBuildingsInScene() {\n    if (!this.parkData || !this.parkData.buildings) {\n      return;\n    }\n\n    this.parkData.buildings.forEach((building) => {\n      this.sceneManager.createBuilding(building);\n    });\n  }\n\n  // Âú®Âú∫ÊôØ‰∏≠ÂàõÂª∫ËÆæÂ§á\n  createDevicesInScene(devices) {\n    devices.forEach((device) => {\n      // ‰∏∫ËÆæÂ§áÂàÜÈÖç‰ΩçÁΩÆÔºàÂ¶ÇÊûúÊ≤°ÊúâÊåáÂÆöÔºâ\n      if (!device.position) {\n        device.position = this.generateDevicePosition(device);\n      }\n\n      this.sceneManager.createDevice(device);\n    });\n  }\n\n  // ÁîüÊàêËÆæÂ§á‰ΩçÁΩÆ\n  generateDevicePosition(device) {\n    // Ê†πÊçÆËÆæÂ§áÁ±ªÂûãÂíåÂª∫Á≠ëIDÁîüÊàêÂêàÁêÜÁöÑ‰ΩçÁΩÆ\n    const buildingId = device.building_id;\n    const building = this.parkData?.buildings?.find((b) => b.id === buildingId);\n\n    if (building) {\n      // Âú®Âª∫Á≠ëÂë®Âõ¥ÈöèÊú∫ÂàÜÂ∏É\n      const offsetX = (Math.random() - 0.5) * 20;\n      const offsetZ = (Math.random() - 0.5) * 20;\n\n      return {\n        x: building.position.x + offsetX,\n        y: 2,\n        z: building.position.z + offsetZ\n      };\n    }\n\n    // ÈªòËÆ§ÈöèÊú∫‰ΩçÁΩÆ\n    return {\n      x: (Math.random() - 0.5) * 100,\n      y: 2,\n      z: (Math.random() - 0.5) * 100\n    };\n  }\n\n  // Êõ¥Êñ∞ËÆæÂ§áÂèØËßÜÂåñ\n  updateDeviceVisualization(data) {\n    const { deviceId, value, unit } = data;\n\n    // Êõ¥Êñ∞ËÆæÂ§áÁöÑÊï∞ÊçÆÂèØËßÜÂåñ\n    this.sceneManager.addDataVisualization(deviceId, value);\n\n    // Ëß¶ÂèëËá™ÂÆö‰πâ‰∫ã‰ª∂\n    this.dispatchEvent('deviceDataUpdated', {\n      deviceId,\n      value,\n      unit,\n      timestamp: new Date()\n    });\n  }\n\n  // Êõ¥Êñ∞ËÆæÂ§áÁä∂ÊÄÅ\n  updateDeviceStatus(data) {\n    const { deviceId, status, device } = data;\n\n    this.sceneManager.updateDeviceStatus(deviceId, status, device);\n\n    // Ëß¶ÂèëËá™ÂÆö‰πâ‰∫ã‰ª∂\n    this.dispatchEvent('deviceStatusUpdated', {\n      deviceId,\n      status,\n      device\n    });\n  }\n\n  // Êõ¥Êñ∞Á¢≥ÊéíÊîæÂèØËßÜÂåñ\n  updateCarbonVisualization(data) {\n    const { deviceId, emissionValue } = data;\n\n    // ÂèØ‰ª•Âú®ËøôÈáåÊ∑ªÂä†Á¢≥ÊéíÊîæÁöÑÁâπÊÆäÂèØËßÜÂåñÊïàÊûú\n    // ÊØîÂ¶ÇÁ≤íÂ≠êÊïàÊûú„ÄÅÈ¢úËâ≤ÂèòÂåñÁ≠â\n\n    this.dispatchEvent('carbonDataUpdated', {\n      deviceId,\n      emissionValue,\n      timestamp: new Date()\n    });\n  }\n\n  // Â§ÑÁêÜÂëäË≠¶\n  handleAlert(alert) {\n    const { deviceId, level, message } = alert;\n\n    // Ê∑ªÂä†Âà∞ÂëäË≠¶ÂàóË°®\n    this.alerts.unshift({\n      ...alert,\n      id: `alert_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`\n    });\n\n    // ‰øùÊåÅÊúÄËøë100Êù°ÂëäË≠¶\n    if (this.alerts.length > 100) {\n      this.alerts = this.alerts.slice(0, 100);\n    }\n\n    // Âú®Âú∫ÊôØ‰∏≠ÊòæÁ§∫ÂëäË≠¶ÊïàÊûú\n    this.showAlertInScene(deviceId, level);\n\n    // Ëß¶ÂèëËá™ÂÆö‰πâ‰∫ã‰ª∂\n    this.dispatchEvent('alert', alert);\n  }\n\n  // Âú®Âú∫ÊôØ‰∏≠ÊòæÁ§∫ÂëäË≠¶ÊïàÊûú\n  showAlertInScene(deviceId, level) {\n    // ÂèØ‰ª•Ê∑ªÂä†Èó™ÁÉÅÊïàÊûú„ÄÅÈ¢úËâ≤ÂèòÂåñÁ≠â\n    const device = this.sceneManager.devices.get(deviceId);\n    if (device) {\n      // Ê†πÊçÆÂëäË≠¶Á∫ßÂà´ËÆæÁΩÆÈ¢úËâ≤\n      let color;\n      switch (level) {\n        case 'critical':\n          color = 0xff0000;\n          break;\n        case 'warning':\n          color = 0xffa500;\n          break;\n        default:\n          color = 0xffff00;\n      }\n\n      // ‰∏¥Êó∂ÊîπÂèòËÆæÂ§áÈ¢úËâ≤\n      const originalColor = device.material.color.getHex();\n      device.material.color.setHex(color);\n\n      // 3ÁßíÂêéÊÅ¢Â§çÂéüËâ≤\n      setTimeout(() => {\n        device.material.color.setHex(originalColor);\n      }, 3000);\n    }\n  }\n\n  // Ëé∑ÂèñËÆæÂ§áËØ¶ÁªÜ‰ø°ÊÅØ\n  async getDeviceDetails(deviceId) {\n    try {\n      const response = await fetch(`${this.options.apiBaseUrl}/devices/${deviceId}`, {\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem('token')}`\n        }\n      });\n\n      if (!response.ok) {\n        throw new Error('Ëé∑ÂèñËÆæÂ§áËØ¶ÊÉÖÂ§±Ë¥•');\n      }\n\n      const result = await response.json();\n      return result.data;\n    } catch (error) {\n      console.error('Ëé∑ÂèñËÆæÂ§áËØ¶ÊÉÖÂ§±Ë¥•:', error);\n      return null;\n    }\n  }\n\n  // Ëé∑ÂèñËÉΩÊ∫êÊï∞ÊçÆÁªüËÆ°\n  async getEnergyStatistics(timeRange = '24h') {\n    try {\n      const response = await fetch(\n        `${this.options.apiBaseUrl}/energy-data/statistics?time_range=${timeRange}`,\n        {\n          headers: {\n            Authorization: `Bearer ${localStorage.getItem('token')}`\n          }\n        }\n      );\n\n      if (!response.ok) {\n        throw new Error('Ëé∑ÂèñËÉΩÊ∫êÁªüËÆ°Â§±Ë¥•');\n      }\n\n      const result = await response.json();\n      return result.data;\n    } catch (error) {\n      console.error('Ëé∑ÂèñËÉΩÊ∫êÁªüËÆ°Â§±Ë¥•:', error);\n      return null;\n    }\n  }\n\n  // Ëé∑ÂèñÁ¢≥ÊéíÊîæÁªüËÆ°\n  async getCarbonStatistics(timeRange = '24h') {\n    try {\n      const response = await fetch(\n        `${this.options.apiBaseUrl}/carbon-data/statistics?time_range=${timeRange}`,\n        {\n          headers: {\n            Authorization: `Bearer ${localStorage.getItem('token')}`\n          }\n        }\n      );\n\n      if (!response.ok) {\n        throw new Error('Ëé∑ÂèñÁ¢≥ÊéíÊîæÁªüËÆ°Â§±Ë¥•');\n      }\n\n      const result = await response.json();\n      return result.data;\n    } catch (error) {\n      console.error('Ëé∑ÂèñÁ¢≥ÊéíÊîæÁªüËÆ°Â§±Ë¥•:', error);\n      return null;\n    }\n  }\n\n  // ËÆæÁΩÆÁõ∏Êú∫ËßÜËßí\n  setCameraView(position, target) {\n    if (this.sceneManager && this.sceneManager.camera) {\n      this.sceneManager.camera.position.set(position.x, position.y, position.z);\n      if (target) {\n        this.sceneManager.camera.lookAt(target.x, target.y, target.z);\n      }\n    }\n  }\n\n  // ËÅöÁÑ¶Âà∞ËÆæÂ§á\n  focusOnDevice(deviceId) {\n    const device = this.sceneManager.devices.get(deviceId);\n    if (device) {\n      const { position } = device;\n      this.setCameraView({ x: position.x + 20, y: position.y + 20, z: position.z + 20 }, position);\n    }\n  }\n\n  // Ëé∑ÂèñÂëäË≠¶ÂàóË°®\n  getAlerts(limit = 10) {\n    return this.alerts.slice(0, limit);\n  }\n\n  // Ê∏ÖÈô§ÂëäË≠¶\n  clearAlert(alertId) {\n    this.alerts = this.alerts.filter((alert) => alert.id !== alertId);\n  }\n\n  // Ëá™ÂÆö‰πâ‰∫ã‰ª∂ÂàÜÂèë\n  dispatchEvent(eventType, data) {\n    const event = new CustomEvent(eventType, { detail: data });\n    this.container.dispatchEvent(event);\n  }\n\n  // Ê∑ªÂä†‰∫ã‰ª∂ÁõëÂê¨\n  addEventListener(eventType, callback) {\n    this.container.addEventListener(eventType, callback);\n  }\n\n  // ÁßªÈô§‰∫ã‰ª∂ÁõëÂê¨\n  removeEventListener(eventType, callback) {\n    this.container.removeEventListener(eventType, callback);\n  }\n\n  // ÈîÄÊØÅÊï∞Â≠óÂ≠™ÁîüÁ≥ªÁªü\n  dispose() {\n    if (this.sceneManager) {\n      this.sceneManager.dispose();\n      this.sceneManager = null;\n    }\n\n    if (this.dataManager) {\n      this.dataManager.dispose();\n      this.dataManager = null;\n    }\n\n    this.alerts = [];\n    this.parkData = null;\n    this.isInitialized = false;\n  }\n}\n\nexport default DigitalTwinController;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/interfaces/http/components/optimization/EnergyStorageOptimization.js","messages":[{"ruleId":null,"fatal":true,"severity":2,"message":"Parsing error: Unexpected token <","line":207,"column":5,"nodeType":null}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport {\n  Box,\n  Typography,\n  Paper,\n  Grid,\n  Card,\n  CardContent,\n  Divider,\n  CircularProgress,\n  Alert,\n} from '@mui/material';\nimport { Line, Bar } from 'react-chartjs-2';\nimport { Chart, registerables } from 'chart.js';\nimport { getEnergyStorageDevices } from '../../controllers/deviceController.js';\nimport { generateOptimizationStrategies } from '../../optimization/battery.js';\n\n// Ê≥®ÂÜåChart.jsÁªÑ‰ª∂\nChart.register(...registerables);\n\nconst EnergyStorageOptimization = () => {\n  const [devices, setDevices] = useState([]);\n  const [selectedDevice, setSelectedDevice] = useState(null);\n  const [strategies, setStrategies] = useState([]);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(null);\n  const [timeRange, setTimeRange] = useState('24h');\n\n  // Ëé∑ÂèñÂÇ®ËÉΩËÆæÂ§áÂàóË°®\n  useEffect(() => {\n    const fetchDevices = async () => {\n      try {\n        const data = await getEnergyStorageDevices();\n        setDevices(data);\n        if (data.length > 0) {\n          setSelectedDevice(data[0]);\n        }\n      } catch (err) {\n        setError('Ëé∑ÂèñÂÇ®ËÉΩËÆæÂ§áÂ§±Ë¥•: ' + err.message);\n        console.error(err);\n      }\n    };\n\n    fetchDevices();\n  }, []);\n\n  // ÂΩìÈÄâÊã©ËÆæÂ§áÊàñÊó∂Èó¥ËåÉÂõ¥ÂèòÂåñÊó∂ÔºåÈáçÊñ∞ÁîüÊàê‰ºòÂåñÁ≠ñÁï•\n  useEffect(() => {\n    if (selectedDevice) {\n      generateStrategies();\n    }\n  }, [selectedDevice, timeRange]);\n\n  // ÁîüÊàê‰ºòÂåñÁ≠ñÁï•\n  const generateStrategies = async () => {\n    try {\n      setLoading(true);\n      setError(null);\n\n      // ËÆ°ÁÆóÊó∂Èó¥ËåÉÂõ¥\n      const endTime = new Date();\n      const startTime = new Date();\n\n      switch (timeRange) {\n        case '24h':\n          startTime.setHours(endTime.getHours() - 24);\n          break;\n        case '7d':\n          startTime.setDate(endTime.getDate() - 7);\n          break;\n        case '30d':\n          startTime.setMonth(endTime.getMonth() - 1);\n          break;\n        default:\n          startTime.setHours(endTime.getHours() - 24);\n      }\n\n      // Ëé∑ÂèñÈ¢ÑÊµãÊï∞ÊçÆÔºàÂÆûÈôÖÂ∫îÁî®‰∏≠Â∫î‰ªéAPIËé∑ÂèñÔºâ\n      // ËøôÈáå‰ΩøÁî®Ê®°ÊãüÊï∞ÊçÆ\n      const predictions = generateMockSOCData(timeRange);\n\n      // ÁîüÊàê‰ºòÂåñÁ≠ñÁï•\n      const result = await generateOptimizationStrategies(\n        predictions,\n        '1h',\n        selectedDevice.id,\n        startTime.toISOString(),\n        endTime.toISOString()\n      );\n\n      setStrategies(result);\n    } catch (err) {\n      setError('ÁîüÊàê‰ºòÂåñÁ≠ñÁï•Â§±Ë¥•: ' + err.message);\n      console.error(err);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // ÁîüÊàêÊ®°ÊãüSOCÊï∞ÊçÆ\n  const generateMockSOCData = (range) => {\n    const dataPoints = range === '24h' ? 24 : range === '7d' ? 168 : 720;\n    const data = [];\n\n    for (let i = 0; i < dataPoints; i++) {\n      // ÁîüÊàê0.3-0.7‰πãÈó¥ÁöÑÈöèÊú∫SOCÂÄºÔºåÊ∑ªÂä†‰∏Ä‰∫õÊ≥¢Âä®Ë∂ãÂäø\n      const baseValue = 0.5 + Math.sin((i / 12) * Math.PI) * 0.2;\n      const noise = (Math.random() - 0.5) * 0.1;\n      const value = Math.max(0.2, Math.min(0.8, baseValue + noise));\n      data.push(value);\n    }\n\n    return data;\n  };\n\n  // ÂáÜÂ§áÂõæË°®Êï∞ÊçÆ\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 33 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 33 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 33 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 33 Ë°å)\n\n  const prepareChartData = () => {\n    if (!strategies || strategies.length === 0) return null;\n\n    const timestamps = strategies.map((s) => new Date(s.timestamp).toLocaleTimeString());\n    const socData = strategies.map((_, index) => generateMockSOCData(timeRange)[index] * 100);\n    const prices = strategies.map((s) =>\n      s.economicImpact ? parseFloat(s.economicImpact.split(':')[1]) : 0\n    );\n\n    return {\n      labels: timestamps,\n      datasets: [\n        {\n          label: 'SOC (%)',\n          data: socData,\n          borderColor: '#3f51b5',\n          backgroundColor: 'rgba(63, 81, 181, 0.1)',\n          borderWidth: 2,\n          fill: true,\n          yAxisID: 'y',\n        },\n        {\n          label: 'ÁªèÊµéÊïàÁõä (ÂÖÉ)',\n          data: prices,\n          borderColor: '#4caf50',\n          backgroundColor: 'rgba(76, 175, 80, 0.1)',\n          borderWidth: 2,\n          fill: true,\n          yAxisID: 'y1',\n        },\n      ],\n    };\n  };\n\n  // ÂõæË°®ÈÖçÁΩÆ\n  const chartOptions = {\n    responsive: true,\n    interaction: {\n      mode: 'index',\n      intersect: false,\n    },\n    scales: {\n      y: {\n        type: 'linear',\n        display: true,\n        position: 'left',\n        title: {\n          display: true,\n          text: 'SOC (%)',\n        },\n        min: 0,\n        max: 100,\n      },\n      y1: {\n        type: 'linear',\n        display: true,\n        position: 'right',\n        title: {\n          display: true,\n          text: 'ÁªèÊµéÊïàÁõä (ÂÖÉ)',\n        },\n        grid: {\n          drawOnChartArea: false,\n        },\n      },\n    },\n  };\n\n  // Á≠ñÁï•‰ºòÂÖàÁ∫ßÈ¢úËâ≤Êò†Â∞Ñ\n  const getPriorityColor = (priority) => {\n    if (priority >= 8) return '#f44336'; // È´ò‰ºòÂÖàÁ∫ß - Á∫¢Ëâ≤\n    if (priority >= 5) return '#ff9800'; // ‰∏≠È´ò‰ºòÂÖàÁ∫ß - Ê©ôËâ≤\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (priority >= 3) return '#ffeb3b'; // ‰∏≠‰ºòÂÖàÁ∫ß - ÈªÑËâ≤\n    return '#4caf50'; // ‰Ωé‰ºòÂÖàÁ∫ß - ÁªøËâ≤\n  };\n\n  return (\n    <Box sx={{ p: 3 }}>\n      <Typography variant=\"h4\" gutterBottom>\n        ÂÇ®ËÉΩ‰ºòÂåñÁ≠ñÁï•\n      </Typography>\n\n      <Grid container spacing={3} sx={{ mb: 4 }}>\n        <Grid item xs={12} md={4}>\n          <Paper sx={{ p: 2 }}>\n            <Typography variant=\"h6\" gutterBottom>\n              ÂÇ®ËÉΩËÆæÂ§áÈÄâÊã©\n            </Typography>\n            <select\n              value={selectedDevice?.id || ''}\n              onChange={(e) => {\n                const device = devices.find((d) => d.id === e.target.value);\n                setSelectedDevice(device);\n              }}\n              style={{\n                width: '100%',\n                padding: '8px',\n                borderRadius: '4px',\n                border: '1px solid #ccc',\n              }}\n            >\n              {devices.map((device) => (\n                <option key={device.id} value={device.id}>\n                  {device.name} ({device.model})\n                </option>\n              ))}\n            </select>\n          </Paper>\n        </Grid>\n\n        <Grid item xs={12} md={4}>\n          <Paper sx={{ p: 2 }}>\n            <Typography variant=\"h6\" gutterBottom>\n              Êó∂Èó¥ËåÉÂõ¥\n            </Typography>\n            <select\n              value={timeRange}\n              onChange={(e) => setTimeRange(e.target.value)}\n              style={{\n                width: '100%',\n                padding: '8px',\n                borderRadius: '4px',\n                border: '1px solid #ccc',\n              }}\n            >\n              <option value=\"24h\">24Â∞èÊó∂</option>\n              <option value=\"7d\">7Â§©</option>\n              <option value=\"30d\">30Â§©</option>\n            </select>\n          </Paper>\n        </Grid>\n\n        <Grid item xs={12} md={4}>\n          <Paper\n            sx={{\n              p: 2,\n              display: 'flex',\n              alignItems: 'center',\n              justifyContent: 'center',\n              height: '100%',\n            }}\n          >\n            {loading ? (\n              <CircularProgress />\n            ) : (\n              <button\n                onClick={generateStrategies}\n                style={{\n                  padding: '8px 16px',\n                  backgroundColor: '#3f51b5',\n                  color: 'white',\n                  border: 'none',\n                  borderRadius: '4px',\n                  cursor: 'pointer',\n                  fontSize: '16px',\n                }}\n              >\n                ÁîüÊàê‰ºòÂåñÁ≠ñÁï•\n              </button>\n            )}\n          </Paper>\n        </Grid>\n      </Grid>\n\n      {error && (\n        <Alert severity=\"error\" sx={{ mb: 3 }}>\n          {error}\n        </Alert>\n      )}\n\n      {strategies.length > 0 && (\n        <Grid container spacing={3}>\n          <Grid item xs={12}>\n            <Paper sx={{ p: 2 }}>\n              <Typography variant=\"h6\" gutterBottom>\n                ÂÇ®ËÉΩ‰ºòÂåñË∂ãÂäø\n              </Typography>\n              <Box sx={{ height: 400 }}>\n                <Line data={prepareChartData()} options={chartOptions} />\n              </Box>\n            </Paper>\n          </Grid>\n\n          <Grid item xs={12}>\n            <Paper sx={{ p: 2 }}>\n              <Typography variant=\"h6\" gutterBottom>\n                Êé®ËçêÁ≠ñÁï•ÂàóË°®\n              </Typography>\n              <Divider sx={{ mb: 2 }} />\n              <Box sx={{ maxHeight: 400, overflowY: 'auto' }}>\n                {strategies\n                  .filter((s) => s.strategy !== 'maintenance')\n                  .sort((a, b) => b.priority - a.priority)\n                  .map((strategy, index) => (\n                    <Card\n                      key={index}\n                      sx={{ mb: 2, borderLeft: `4px solid ${getPriorityColor(strategy.priority)}` }}\n                    >\n                      <CardContent>\n                        <Grid container spacing={2} alignItems=\"center\">\n                          <Grid item xs={12} md={2}>\n                            <Typography variant=\"subtitle2\">\n                              {new Date(strategy.timestamp).toLocaleString()}\n                            </Typography>\n                          </Grid>\n                          <Grid item xs={12} md={2}>\n                            <Typography\n                              variant=\"body1\"\n                              sx={{\n                                fontWeight: 'bold',\n                                color: getPriorityColor(strategy.priority),\n                              }}\n                            >\n                              {strategy.strategy === 'charge' && 'ÂÖÖÁîµ'}\n                              {strategy.strategy === 'discharge' && 'ÊîæÁîµ'}\n                              {strategy.strategy === 'stop_charge' && 'ÂÅúÊ≠¢ÂÖÖÁîµ'}\n                              {strategy.strategy === 'stop_discharge' && 'ÂÅúÊ≠¢ÊîæÁîµ'}\n                            </Typography>\n                          </Grid>\n                          <Grid item xs={12} md={4}>\n                            <Typography variant=\"body2\">{strategy.description}</Typography>\n                          </Grid>\n                          <Grid item xs={12} md={2}>\n                            <Typography variant=\"body2\">{strategy.economicImpact}</Typography>\n                          </Grid>\n                          <Grid item xs={12} md={2}>\n                            <Typography variant=\"body2\">\n                              {strategy.carbonImpact || 'Êó†Á¢≥ÊéíÊîæÊï∞ÊçÆ'}\n                            </Typography>\n                          </Grid>\n                        </Grid>\n                      </CardContent>\n                    </Card>\n                  ))}\n              </Box>\n            </Paper>\n          </Grid>\n        </Grid>\n      )}\n    </Box>\n  );\n};\n\nexport default EnergyStorageOptimization;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/interfaces/http/controllers/AuthController.js","messages":[{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 201.","line":136,"column":41,"nodeType":"Literal","messageId":"noMagic","endLine":136,"endColumn":44}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import bcrypt from 'bcrypt';\nimport { validationResult } from 'express-validator';\nimport BaseController from './BaseController.js';\nimport User from '../../../core/entities/User.js';\nimport config from '../../../shared/config/index.js';\nimport logger from '../../../shared/utils/logger.js';\nimport { defaultJWTManager } from '../../../core/services/jwtManager.js';\n\n/**\n * ËÆ§ËØÅÊéßÂà∂Âô®\n * Â§ÑÁêÜÁî®Êà∑ËÆ§ËØÅÁõ∏ÂÖ≥ÁöÑ‰∏öÂä°ÈÄªËæë\n */\nclass AuthController extends BaseController {\n  constructor() {\n    super();\n    this.saltRounds = 12;\n    this.jwtManager = defaultJWTManager;\n  }\n\n  /**\n   * Áî®Êà∑ÁôªÂΩï\n   */\n  login = this.asyncHandler(async (req, res) => {\n    const errors = validationResult(req);\n    if (!errors.isEmpty()) {\n      return res.validationError(errors.array());\n    }\n\n    const { username, password } = req.body;\n\n    try {\n      // Êü•ÊâæÁî®Êà∑\n      const user = await User.findByUsername(username);\n      if (!user) {\n        this.logOperation(req, 'LOGIN_FAILED', { username, reason: 'USER_NOT_FOUND' });\n        return res.unauthorized('Áî®Êà∑ÂêçÊàñÂØÜÁ†ÅÈîôËØØ');\n      }\n\n      // È™åËØÅÂØÜÁ†Å\n      const isValidPassword = await bcrypt.compare(password, user.password);\n      if (!isValidPassword) {\n        this.logOperation(req, 'LOGIN_FAILED', { username, reason: 'INVALID_PASSWORD' });\n        return res.unauthorized('Áî®Êà∑ÂêçÊàñÂØÜÁ†ÅÈîôËØØ');\n      }\n\n      // Ê£ÄÊü•Áî®Êà∑Áä∂ÊÄÅ\n      if (user.status !== 'active') {\n        this.logOperation(req, 'LOGIN_FAILED', { username, reason: 'USER_INACTIVE' });\n        return res.forbidden('Áî®Êà∑Ë¥¶Êà∑Â∑≤Ë¢´Á¶ÅÁî®');\n      }\n\n      // ÁîüÊàêJWT‰ª§Áâå\n      const tokenPayload = {\n        id: user.id,\n        username: user.username,\n        role: user.role,\n        permissions: user.permissions || []\n      };\n\n      const accessToken = this.jwtManager.generateToken(tokenPayload);\n      const refreshToken = this.jwtManager.generateRefreshToken(tokenPayload);\n\n      // Êõ¥Êñ∞ÊúÄÂêéÁôªÂΩïÊó∂Èó¥\n      await User.updateLastLogin(user.id);\n\n      // Ê∏ÖÁêÜÊïèÊÑüÊï∞ÊçÆ\n      const userResponse = this.sanitizeUser(user);\n\n      this.logOperation(req, 'LOGIN_SUCCESS', { userId: user.id, username });\n\n      res.success(\n        {\n          user: userResponse,\n          tokens: {\n            accessToken,\n            refreshToken,\n            expiresIn: config.jwt.expiresIn\n          }\n        },\n        'ÁôªÂΩïÊàêÂäü'\n      );\n    } catch (error) {\n      logger.error('ÁôªÂΩïÂ§±Ë¥•', {\n        error: error.message,\n        username,\n        ip: req.ip\n      });\n      res.internalError('ÁôªÂΩïÂ§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï');\n    }\n  });\n\n  /**\n   * Áî®Êà∑Ê≥®ÂÜå\n   */\n  register = this.asyncHandler(async (req, res) => {\n    const errors = validationResult(req);\n    if (!errors.isEmpty()) {\n      return res.validationError(errors.array());\n    }\n\n    const { username, password, email, role = 'viewer' } = req.body;\n\n    try {\n      // Ê£ÄÊü•Áî®Êà∑ÂêçÊòØÂê¶Â∑≤Â≠òÂú®\n      const existingUser = await User.findByUsername(username);\n      if (existingUser) {\n        return res.conflict('Áî®Êà∑ÂêçÂ∑≤Â≠òÂú®');\n      }\n\n      // Ê£ÄÊü•ÈÇÆÁÆ±ÊòØÂê¶Â∑≤Â≠òÂú®\n      if (email) {\n        const existingEmail = await User.findByEmail(email);\n        if (existingEmail) {\n          return res.conflict('ÈÇÆÁÆ±Â∑≤Ë¢´‰ΩøÁî®');\n        }\n      }\n\n      // Âä†ÂØÜÂØÜÁ†Å\n      const hashedPassword = await bcrypt.hash(password, this.saltRounds);\n\n      // ÂàõÂª∫Áî®Êà∑\n      const userData = {\n        username,\n        password: hashedPassword,\n        email,\n        role,\n        status: 'active',\n        createdAt: new Date().toISOString()\n      };\n\n      const newUser = await User.create(userData);\n      const userResponse = this.sanitizeUser(newUser);\n\n      this.logOperation(req, 'USER_REGISTER', { userId: newUser.id, username });\n\n      res.success(userResponse, 'Ê≥®ÂÜåÊàêÂäü', 201);\n    } catch (error) {\n      logger.error('Ê≥®ÂÜåÂ§±Ë¥•', {\n        error: error.message,\n        username,\n        email,\n        ip: req.ip\n      });\n      res.internalError('Ê≥®ÂÜåÂ§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï');\n    }\n  });\n\n  /**\n   * Ëé∑ÂèñÂΩìÂâçÁî®Êà∑‰ø°ÊÅØ\n   */\n  getCurrentUser = this.asyncHandler(async (req, res) => {\n    try {\n      const user = await User.findById(req.user.id);\n      if (!user) {\n        return res.notFound('Áî®Êà∑‰∏çÂ≠òÂú®');\n      }\n\n      const userResponse = this.sanitizeUser(user);\n      res.success(userResponse);\n    } catch (error) {\n      logger.error('Ëé∑ÂèñÁî®Êà∑‰ø°ÊÅØÂ§±Ë¥•', {\n        error: error.message,\n        userId: req.user?.id\n      });\n      res.internalError('Ëé∑ÂèñÁî®Êà∑‰ø°ÊÅØÂ§±Ë¥•');\n    }\n  });\n\n  /**\n   * Êõ¥Êñ∞Áî®Êà∑‰ø°ÊÅØ\n   */\n  updateProfile = this.asyncHandler(async (req, res) => {\n    const errors = validationResult(req);\n    if (!errors.isEmpty()) {\n      return res.validationError(errors.array());\n    }\n\n    const { email, currentPassword, newPassword } = req.body;\n    const userId = req.user.id;\n\n    try {\n      const user = await User.findById(userId);\n      if (!user) {\n        return res.notFound('Áî®Êà∑‰∏çÂ≠òÂú®');\n      }\n\n      const updateData = {};\n\n      // Êõ¥Êñ∞ÈÇÆÁÆ±\n      if (email && email !== user.email) {\n        const existingEmail = await User.findByEmail(email);\n        if (existingEmail && existingEmail.id !== userId) {\n          return res.conflict('ÈÇÆÁÆ±Â∑≤Ë¢´‰ΩøÁî®');\n        }\n        updateData.email = email;\n      }\n\n      // Êõ¥Êñ∞ÂØÜÁ†Å\n      if (newPassword) {\n        if (!currentPassword) {\n          return res.badRequest('Êõ¥Êñ∞ÂØÜÁ†ÅÈúÄË¶ÅÊèê‰æõÂΩìÂâçÂØÜÁ†Å');\n        }\n\n        const isValidPassword = await bcrypt.compare(currentPassword, user.password);\n        if (!isValidPassword) {\n          return res.unauthorized('ÂΩìÂâçÂØÜÁ†ÅÈîôËØØ');\n        }\n\n        updateData.password = await bcrypt.hash(newPassword, this.saltRounds);\n      }\n\n      if (Object.keys(updateData).length === 0) {\n        return res.badRequest('Ê≤°ÊúâÈúÄË¶ÅÊõ¥Êñ∞ÁöÑÊï∞ÊçÆ');\n      }\n\n      updateData.updatedAt = new Date().toISOString();\n      const updatedUser = await User.update(userId, updateData);\n      const userResponse = this.sanitizeUser(updatedUser);\n\n      this.logOperation(req, 'PROFILE_UPDATE', { userId, fields: Object.keys(updateData) });\n\n      res.success(userResponse, 'Áî®Êà∑‰ø°ÊÅØÊõ¥Êñ∞ÊàêÂäü');\n    } catch (error) {\n      logger.error('Êõ¥Êñ∞Áî®Êà∑‰ø°ÊÅØÂ§±Ë¥•', {\n        error: error.message,\n        userId\n      });\n      res.internalError('Êõ¥Êñ∞Áî®Êà∑‰ø°ÊÅØÂ§±Ë¥•');\n    }\n  });\n\n  /**\n   * Áî®Êà∑ÁôªÂá∫\n   */\n  logout = this.asyncHandler(async (req, res) => {\n    try {\n      const token = req.headers.authorization?.replace('Bearer ', '');\n      if (token) {\n        // Â∞Ü‰ª§ÁâåÂä†ÂÖ•ÈªëÂêçÂçï\n        await this.jwtManager.blacklistToken(token);\n      }\n\n      this.logOperation(req, 'LOGOUT', { userId: req.user?.id });\n\n      res.success(null, 'ÁôªÂá∫ÊàêÂäü');\n    } catch (error) {\n      logger.error('ÁôªÂá∫Â§±Ë¥•', {\n        error: error.message,\n        userId: req.user?.id\n      });\n      res.internalError('ÁôªÂá∫Â§±Ë¥•');\n    }\n  });\n\n  /**\n   * Âà∑Êñ∞ËÆøÈóÆ‰ª§Áâå\n   */\n  refreshToken = this.asyncHandler(async (req, res) => {\n    const { refreshToken } = req.body;\n\n    if (!refreshToken) {\n      return res.badRequest('Áº∫Â∞ëÂà∑Êñ∞‰ª§Áâå');\n    }\n\n    try {\n      // È™åËØÅÂà∑Êñ∞‰ª§Áâå\n      const decoded = this.jwtManager.verifyRefreshToken(refreshToken);\n\n      // Ê£ÄÊü•Áî®Êà∑ÊòØÂê¶‰ªçÁÑ∂Â≠òÂú®‰∏îÊ¥ªË∑É\n      const user = await User.findById(decoded.id);\n      if (!user || user.status !== 'active') {\n        return res.unauthorized('Áî®Êà∑‰∏çÂ≠òÂú®ÊàñÂ∑≤Ë¢´Á¶ÅÁî®');\n      }\n\n      // ÁîüÊàêÊñ∞ÁöÑËÆøÈóÆ‰ª§Áâå\n      const tokenPayload = {\n        id: user.id,\n        username: user.username,\n        role: user.role,\n        permissions: user.permissions || []\n      };\n\n      const newAccessToken = this.jwtManager.generateToken(tokenPayload);\n      const newRefreshToken = this.jwtManager.generateRefreshToken(tokenPayload);\n\n      // Â∞ÜÊóßÁöÑÂà∑Êñ∞‰ª§ÁâåÂä†ÂÖ•ÈªëÂêçÂçï\n      await this.jwtManager.blacklistToken(refreshToken);\n\n      res.success(\n        {\n          accessToken: newAccessToken,\n          refreshToken: newRefreshToken,\n          expiresIn: config.jwt.expiresIn\n        },\n        '‰ª§ÁâåÂà∑Êñ∞ÊàêÂäü'\n      );\n    } catch (error) {\n      logger.error('Âà∑Êñ∞‰ª§ÁâåÂ§±Ë¥•', {\n        error: error.message,\n        ip: req.ip\n      });\n\n      if (error.name === 'JsonWebTokenError' || error.name === 'TokenExpiredError') {\n        return res.unauthorized('Êó†ÊïàÁöÑÂà∑Êñ∞‰ª§Áâå');\n      }\n\n      res.internalError('‰ª§ÁâåÂà∑Êñ∞Â§±Ë¥•');\n    }\n  });\n\n  /**\n   * Ê∏ÖÁêÜÁî®Êà∑ÊïèÊÑüÊï∞ÊçÆ\n   */\n  sanitizeUser(user) {\n    const { password: _password, ...sanitizedUser } = user;\n    return sanitizedUser;\n  }\n\n  /**\n   * È™åËØÅÁî®Êà∑ÊùÉÈôê\n   */\n  checkPermission = this.asyncHandler(async (req, res) => {\n    const { permission } = req.params;\n    const userPermissions = req.user.permissions || [];\n    const hasPermission = userPermissions.includes(permission) || req.user.role === 'admin';\n\n    res.success({ hasPermission }, 'ÊùÉÈôêÊ£ÄÊü•ÂÆåÊàê');\n  });\n}\n\nexport default new AuthController();\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/interfaces/http/controllers/BaseController.js","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":42,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":42,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[1077,1369],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 20.","line":104,"column":48,"nodeType":"Literal","messageId":"noMagic","endLine":104,"endColumn":50},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":109,"column":23,"nodeType":"Literal","messageId":"noMagic","endLine":109,"endColumn":26},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":359,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":359,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[10029,10312],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 200.","line":404,"column":51,"nodeType":"Literal","messageId":"noMagic","endLine":404,"endColumn":54},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":415,"column":36,"nodeType":"Literal","messageId":"noMagic","endLine":415,"endColumn":39}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Âü∫Á°ÄÊéßÂà∂Âô®Á±ª\n * Êèê‰æõÈÄöÁî®ÁöÑÊéßÂà∂Âô®ÂäüËÉΩÂíåÈîôËØØÂ§ÑÁêÜ\n */\n\nimport responseFormatter from '../middleware/responseFormatter.js';\n\nclass BaseController {\n  constructor() {\n    // ÁªëÂÆöÊñπÊ≥ïÂà∞ÂÆû‰æãÔºåÁ°Æ‰øùÊ≠£Á°ÆÁöÑthis‰∏ä‰∏ãÊñá\n    this.handleRequest = this.handleRequest.bind(this);\n    this.handleError = this.handleError.bind(this);\n    this.validateRequest = this.validateRequest.bind(this);\n    this.getPaginationParams = this.getPaginationParams.bind(this);\n    this.getSortingParams = this.getSortingParams.bind(this);\n    this.getFilterParams = this.getFilterParams.bind(this);\n  }\n\n  /**\n   * ÈÄöÁî®ËØ∑Ê±ÇÂ§ÑÁêÜÂåÖË£ÖÂô®\n   * @param {Function} handler - Â§ÑÁêÜÂáΩÊï∞\n   * @returns {Function} ExpressË∑ØÁî±Â§ÑÁêÜÂáΩÊï∞\n   */\n  handleRequest(handler) {\n    return async (req, res, next) => {\n      try {\n        await handler(req, res, next);\n      } catch (error) {\n        this.handleError(error, req, res, next);\n      }\n    };\n  }\n\n  /**\n   * Áªü‰∏ÄÈîôËØØÂ§ÑÁêÜ\n   * @param {Error} error - ÈîôËØØÂØπË±°\n   * @param {Object} req - ExpressËØ∑Ê±ÇÂØπË±°\n   * @param {Object} res - ExpressÂìçÂ∫îÂØπË±°\n   * @param {Function} next - Express nextÂáΩÊï∞\n   */\n  handleError(error, req, res, _next) {\n    console.error(`[${new Date().toISOString()}] Controller Error:`, {\n      error: error.message,\n      stack: error.stack,\n      url: req.url,\n      method: req.method,\n      user: req.user?.username || 'anonymous',\n      body: req.body,\n      params: req.params,\n      query: req.query\n    });\n\n    // Ê†πÊçÆÈîôËØØÁ±ªÂûãËøîÂõûÁõ∏Â∫îÁöÑÂìçÂ∫î\n    if (error.name === 'ValidationError') {\n      return responseFormatter.validationError(res, 'Êï∞ÊçÆÈ™åËØÅÂ§±Ë¥•', error.details);\n    } else if (error.name === 'UnauthorizedError') {\n      return responseFormatter.unauthorized(res, error.message);\n    } else if (error.name === 'ForbiddenError') {\n      return responseFormatter.forbidden(res, error.message);\n    } else if (error.name === 'NotFoundError') {\n      return responseFormatter.notFound(res, error.message);\n    } else if (error.name === 'ConflictError') {\n      return responseFormatter.conflict(res, error.message);\n    } else if (error.name === 'TooManyRequestsError') {\n      return responseFormatter.tooManyRequests(res, error.message);\n    } \n    return responseFormatter.internalError(res, 'ÊúçÂä°Âô®ÂÜÖÈÉ®ÈîôËØØ', error);\n    \n  }\n\n  /**\n   * È™åËØÅËØ∑Ê±ÇÊï∞ÊçÆ\n   * @param {Object} req - ExpressËØ∑Ê±ÇÂØπË±°\n   * @param {Object} schema - È™åËØÅÊ®°Âºè\n   * @throws {ValidationError} È™åËØÅÂ§±Ë¥•Êó∂ÊäõÂá∫ÈîôËØØ\n   */\n  validateRequest(req, schema) {\n    const { error, value } = schema.validate(req.body, {\n      abortEarly: false,\n      stripUnknown: true\n    });\n\n    if (error) {\n      const validationError = new Error('Êï∞ÊçÆÈ™åËØÅÂ§±Ë¥•');\n      validationError.name = 'ValidationError';\n      validationError.details = error.details.map((detail) => ({\n        field: detail.path.join('.'),\n        message: detail.message,\n        value: detail.context?.value\n      }));\n      throw validationError;\n    }\n\n    return value;\n  }\n\n  /**\n   * Ëé∑ÂèñÂàÜÈ°µÂèÇÊï∞\n   * @param {Object} req - ExpressËØ∑Ê±ÇÂØπË±°\n   * @returns {Object} ÂàÜÈ°µÂèÇÊï∞\n   */\n  getPaginationParams(req) {\n    const page = parseInt(req.query.page) || 1;\n    const limit = parseInt(req.query.limit) || 20;\n    const offset = parseInt(req.query.offset) || (page - 1) * limit;\n\n    return {\n      page: Math.max(1, page),\n      limit: Math.min(100, Math.max(1, limit)),\n      offset: Math.max(0, offset)\n    };\n  }\n\n  /**\n   * Ëé∑ÂèñÊéíÂ∫èÂèÇÊï∞\n   * @param {Object} req - ExpressËØ∑Ê±ÇÂØπË±°\n   * @param {Array} allowedFields - ÂÖÅËÆ∏ÊéíÂ∫èÁöÑÂ≠óÊÆµ\n   * @returns {Object} ÊéíÂ∫èÂèÇÊï∞\n   */\n  getSortingParams(req, allowedFields = []) {\n    const sortBy = req.query.sortBy || 'createdAt';\n    const sortOrder = (req.query.sortOrder || 'desc').toLowerCase();\n\n    // È™åËØÅÊéíÂ∫èÂ≠óÊÆµ\n    const validSortBy =\n      allowedFields.length > 0 && !allowedFields.includes(sortBy) ? allowedFields[0] : sortBy;\n\n    // È™åËØÅÊéíÂ∫èÊñπÂêë\n    const validSortOrder = ['asc', 'desc'].includes(sortOrder) ? sortOrder : 'desc';\n\n    return {\n      sortBy: validSortBy,\n      sortOrder: validSortOrder,\n      orderBy: `${validSortBy} ${validSortOrder.toUpperCase()}`\n    };\n  }\n\n  /**\n   * Ëé∑ÂèñËøáÊª§ÂèÇÊï∞\n   * @param {Object} req - ExpressËØ∑Ê±ÇÂØπË±°\n   * @param {Array} allowedFilters - ÂÖÅËÆ∏ÁöÑËøáÊª§Â≠óÊÆµ\n   * @returns {Object} ËøáÊª§ÂèÇÊï∞\n   */\n  getFilterParams(req, allowedFilters = []) {\n    const filters = {};\n\n    // Â§ÑÁêÜÊü•ËØ¢ÂèÇÊï∞‰∏≠ÁöÑËøáÊª§Êù°‰ª∂\n    for (const [key, value] of Object.entries(req.query)) {\n      if (allowedFilters.includes(key) && value !== undefined && value !== '') {\n        // Â§ÑÁêÜ‰∏çÂêåÁ±ªÂûãÁöÑËøáÊª§Êù°‰ª∂\n        if (key.endsWith('_min') || key.endsWith('_max')) {\n          // Êï∞ÂÄºËåÉÂõ¥ËøáÊª§\n          const fieldName = key.replace(/_min$|_max$/, '');\n          if (!filters[fieldName]) {filters[fieldName] = {};}\n\n          if (key.endsWith('_min')) {\n            filters[fieldName].min = parseFloat(value);\n          } else {\n            filters[fieldName].max = parseFloat(value);\n          }\n        } else if (key.endsWith('_like')) {\n          // Ê®°Á≥äÂåπÈÖç\n          const fieldName = key.replace(/_like$/, '');\n          filters[fieldName] = { like: `%${value}%` };\n        } else if (key.endsWith('_in')) {\n          // Êï∞ÁªÑÂåÖÂê´\n          const fieldName = key.replace(/_in$/, '');\n          filters[fieldName] = { in: Array.isArray(value) ? value : value.split(',') };\n        } else {\n          // Á≤æÁ°ÆÂåπÈÖç\n          filters[key] = value;\n        }\n      }\n    }\n\n    return filters;\n  }\n\n  /**\n   * Ëé∑ÂèñÊêúÁ¥¢ÂèÇÊï∞\n   * @param {Object} req - ExpressËØ∑Ê±ÇÂØπË±°\n   * @returns {Object} ÊêúÁ¥¢ÂèÇÊï∞\n   */\n  getSearchParams(req) {\n    const keyword = req.query.keyword || req.query.q || '';\n    const searchFields = req.query.searchFields\n      ? req.query.searchFields.split(',').map((field) => field.trim())\n      : [];\n\n    return {\n      keyword: keyword.trim(),\n      searchFields,\n      hasSearch: keyword.trim().length > 0\n    };\n  }\n\n  /**\n   * Ëé∑ÂèñÊó•ÊúüËåÉÂõ¥ÂèÇÊï∞\n   * @param {Object} req - ExpressËØ∑Ê±ÇÂØπË±°\n   * @returns {Object} Êó•ÊúüËåÉÂõ¥ÂèÇÊï∞\n   */\n  getDateRangeParams(req) {\n    const startDate = req.query.startDate ? new Date(req.query.startDate) : null;\n    const endDate = req.query.endDate ? new Date(req.query.endDate) : null;\n\n    // È™åËØÅÊó•ÊúüÊúâÊïàÊÄß\n    const validStartDate = startDate && !isNaN(startDate.getTime()) ? startDate : null;\n    const validEndDate = endDate && !isNaN(endDate.getTime()) ? endDate : null;\n\n    // Á°Æ‰øùÁªìÊùüÊó•Êúü‰∏çÊó©‰∫éÂºÄÂßãÊó•Êúü\n    let finalStartDate = validStartDate;\n    let finalEndDate = validEndDate;\n    if (finalStartDate && finalEndDate && finalEndDate < finalStartDate) {\n      const temp = finalStartDate;\n      finalStartDate = finalEndDate;\n      finalEndDate = temp;\n    }\n\n    return {\n      startDate: finalStartDate,\n      endDate: finalEndDate,\n      hasDateRange: finalStartDate || finalEndDate\n    };\n  }\n\n  /**\n   * ÊûÑÂª∫Êü•ËØ¢Êù°‰ª∂\n   * @param {Object} req - ExpressËØ∑Ê±ÇÂØπË±°\n   * @param {Object} options - Êü•ËØ¢ÈÄâÈ°π\n   * @returns {Object} Êü•ËØ¢Êù°‰ª∂\n   */\n  buildQueryConditions(req, options = {}) {\n    const {\n      allowedFilters = [],\n      allowedSortFields = [],\n      defaultSort: _defaultSort = 'createdAt',\n      searchFields = []\n    } = options;\n\n    const pagination = this.getPaginationParams(req);\n    const sorting = this.getSortingParams(req, allowedSortFields);\n    const filters = this.getFilterParams(req, allowedFilters);\n    const search = this.getSearchParams(req);\n    const dateRange = this.getDateRangeParams(req);\n\n    return {\n      pagination,\n      sorting,\n      filters,\n      search,\n      dateRange,\n      // ÊûÑÂª∫ÂÆåÊï¥ÁöÑÊü•ËØ¢ÂØπË±°\n      query: {\n        ...filters,\n        ...(search.hasSearch && searchFields.length > 0\n          ? {\n            $or: searchFields.map((field) => ({\n              [field]: { $regex: search.keyword, $options: 'i' }\n            }))\n          }\n          : {}),\n        ...(dateRange.hasDateRange\n          ? {\n            ...(dateRange.startDate ? { createdAt: { $gte: dateRange.startDate } } : {}),\n            ...(dateRange.endDate\n              ? { createdAt: { ...filters.createdAt, $lte: dateRange.endDate } }\n              : {})\n          }\n          : {})\n      }\n    };\n  }\n\n  /**\n   * Ê†ºÂºèÂåñÂàÜÈ°µÂìçÂ∫î\n   * @param {Array} data - Êï∞ÊçÆÊï∞ÁªÑ\n   * @param {number} total - ÊÄªÊï∞\n   * @param {Object} pagination - ÂàÜÈ°µÂèÇÊï∞\n   * @returns {Object} ÂàÜÈ°µÂìçÂ∫îÂØπË±°\n   */\n  formatPaginatedResponse(data, total, pagination) {\n    const { page, limit } = pagination;\n    const totalPages = Math.ceil(total / limit);\n    const hasNextPage = page < totalPages;\n    const hasPrevPage = page > 1;\n\n    return {\n      data,\n      pagination: {\n        current: page,\n        total: totalPages,\n        count: data.length,\n        totalCount: total,\n        limit,\n        hasNext: hasNextPage,\n        hasPrev: hasPrevPage,\n        nextPage: hasNextPage ? page + 1 : null,\n        prevPage: hasPrevPage ? page - 1 : null\n      }\n    };\n  }\n\n  /**\n   * Ê£ÄÊü•ËµÑÊ∫êÊòØÂê¶Â≠òÂú®\n   * @param {*} resource - ËµÑÊ∫êÂØπË±°\n   * @param {string} resourceName - ËµÑÊ∫êÂêçÁß∞\n   * @throws {NotFoundError} ËµÑÊ∫ê‰∏çÂ≠òÂú®Êó∂ÊäõÂá∫ÈîôËØØ\n   */\n  checkResourceExists(resource, resourceName = 'ËµÑÊ∫ê') {\n    if (!resource) {\n      const error = new Error(`${resourceName}‰∏çÂ≠òÂú®`);\n      error.name = 'NotFoundError';\n      throw error;\n    }\n  }\n\n  /**\n   * Ê£ÄÊü•Áî®Êà∑ÊùÉÈôê\n   * @param {Object} req - ExpressËØ∑Ê±ÇÂØπË±°\n   * @param {string|Array} requiredRoles - ÈúÄË¶ÅÁöÑËßíËâ≤\n   * @throws {ForbiddenError} ÊùÉÈôê‰∏çË∂≥Êó∂ÊäõÂá∫ÈîôËØØ\n   */\n  checkPermission(req, requiredRoles) {\n    const userRole = req.user?.role;\n    const roles = Array.isArray(requiredRoles) ? requiredRoles : [requiredRoles];\n\n    if (!userRole || !roles.includes(userRole)) {\n      const error = new Error('ÊùÉÈôê‰∏çË∂≥');\n      error.name = 'ForbiddenError';\n      throw error;\n    }\n  }\n\n  /**\n   * Ê£ÄÊü•ËµÑÊ∫êÊâÄÊúâÊùÉ\n   * @param {Object} req - ExpressËØ∑Ê±ÇÂØπË±°\n   * @param {Object} resource - ËµÑÊ∫êÂØπË±°\n   * @param {string} ownerField - ÊâÄÊúâËÄÖÂ≠óÊÆµÂêç\n   * @throws {ForbiddenError} ‰∏çÊòØËµÑÊ∫êÊâÄÊúâËÄÖÊó∂ÊäõÂá∫ÈîôËØØ\n   */\n  checkOwnership(req, resource, ownerField = 'userId') {\n    const userId = req.user?.userId;\n    const resourceOwnerId = resource[ownerField];\n\n    if (req.user?.role !== 'admin' && userId !== resourceOwnerId) {\n      const error = new Error('Âè™ËÉΩÊìç‰ΩúËá™Â∑±ÁöÑËµÑÊ∫ê');\n      error.name = 'ForbiddenError';\n      throw error;\n    }\n  }\n\n  /**\n   * ËÆ∞ÂΩïÊìç‰ΩúÊó•Âøó\n   * @param {Object} req - ExpressËØ∑Ê±ÇÂØπË±°\n   * @param {string} action - Êìç‰ΩúÁ±ªÂûã\n   * @param {Object} details - Êìç‰ΩúËØ¶ÊÉÖ\n   */\n  logOperation(req, action, details = {}) {\n    console.log(`[${new Date().toISOString()}] Operation Log:`, {\n      action,\n      user: req.user?.username || 'anonymous',\n      userId: req.user?.userId,\n      ip: req.ip,\n      userAgent: req.get('User-Agent'),\n      url: req.url,\n      method: req.method,\n      ...details\n    });\n  }\n\n  /**\n   * Ê∏ÖÁêÜÊïèÊÑüÊï∞ÊçÆ\n   * @param {Object} data - Êï∞ÊçÆÂØπË±°\n   * @param {Array} sensitiveFields - ÊïèÊÑüÂ≠óÊÆµÂàóË°®\n   * @returns {Object} Ê∏ÖÁêÜÂêéÁöÑÊï∞ÊçÆ\n   */\n  sanitizeData(data, sensitiveFields = ['password', 'token', 'secret']) {\n    if (!data || typeof data !== 'object') {\n      return data;\n    }\n\n    const sanitized = Array.isArray(data) ? [] : {};\n\n    for (const [key, value] of Object.entries(data)) {\n      if (sensitiveFields.includes(key)) {\n        sanitized[key] = '[REDACTED]';\n      } else if (typeof value === 'object' && value !== null) {\n        sanitized[key] = this.sanitizeData(value, sensitiveFields);\n      } else {\n        sanitized[key] = value;\n      }\n    }\n\n    return sanitized;\n  }\n\n  /**\n   * ÊàêÂäüÂìçÂ∫î\n   * @param {Object} res - ExpressÂìçÂ∫îÂØπË±°\n   * @param {string} message - ÂìçÂ∫îÊ∂àÊÅØ\n   * @param {Object} data - ÂìçÂ∫îÊï∞ÊçÆ\n   * @param {number} statusCode - HTTPÁä∂ÊÄÅÁ†Å\n   */\n  success(res, message, data = null, statusCode = 200) {\n    return responseFormatter.success(res, message, data, statusCode);\n  }\n\n  /**\n   * ÈîôËØØÂìçÂ∫î\n   * @param {Object} res - ExpressÂìçÂ∫îÂØπË±°\n   * @param {string} message - ÈîôËØØÊ∂àÊÅØ\n   * @param {number} statusCode - HTTPÁä∂ÊÄÅÁ†Å\n   * @param {Object} details - ÈîôËØØËØ¶ÊÉÖ\n   */\n  error(res, message, statusCode = 500, details = null) {\n    return responseFormatter.error(res, message, statusCode, details);\n  }\n\n  /**\n   * È™åËØÅÈîôËØØÂìçÂ∫î\n   * @param {Object} res - ExpressÂìçÂ∫îÂØπË±°\n   * @param {string} message - ÈîôËØØÊ∂àÊÅØ\n   * @param {Object} details - È™åËØÅÈîôËØØËØ¶ÊÉÖ\n   */\n  validationError(res, message, details = null) {\n    return responseFormatter.validationError(res, message, details);\n  }\n\n  /**\n   * Êú™ÊéàÊùÉÂìçÂ∫î\n   * @param {Object} res - ExpressÂìçÂ∫îÂØπË±°\n   * @param {string} message - ÈîôËØØÊ∂àÊÅØ\n   */\n  unauthorized(res, message = 'Êú™ÊéàÊùÉËÆøÈóÆ') {\n    return responseFormatter.unauthorized(res, message);\n  }\n\n  /**\n   * Á¶ÅÊ≠¢ËÆøÈóÆÂìçÂ∫î\n   * @param {Object} res - ExpressÂìçÂ∫îÂØπË±°\n   * @param {string} message - ÈîôËØØÊ∂àÊÅØ\n   */\n  forbidden(res, message = 'Á¶ÅÊ≠¢ËÆøÈóÆ') {\n    return responseFormatter.forbidden(res, message);\n  }\n\n  /**\n   * ËµÑÊ∫êÊú™ÊâæÂà∞ÂìçÂ∫î\n   * @param {Object} res - ExpressÂìçÂ∫îÂØπË±°\n   * @param {string} message - ÈîôËØØÊ∂àÊÅØ\n   */\n  notFound(res, message = 'ËµÑÊ∫êÊú™ÊâæÂà∞') {\n    return responseFormatter.notFound(res, message);\n  }\n}\n\nexport default BaseController;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/interfaces/http/controllers/CarbonController.js","messages":[{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 201.","line":102,"column":43,"nodeType":"Literal","messageId":"noMagic","endLine":102,"endColumn":46},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 201.","line":172,"column":9,"nodeType":"Literal","messageId":"noMagic","endLine":172,"endColumn":12},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 201.","line":301,"column":43,"nodeType":"Literal","messageId":"noMagic","endLine":301,"endColumn":46},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 7.","line":487,"column":44,"nodeType":"Literal","messageId":"noMagic","endLine":487,"endColumn":45}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { validationResult } from 'express-validator';\nimport BaseController from './BaseController.js';\nimport CarbonEmission from '../../../core/entities/CarbonEmission.js';\nimport CarbonFactor from '../../../core/entities/CarbonFactor.js';\nimport EnergyData from '../../../core/entities/EnergyData.js';\nimport logger from '../../../shared/utils/logger.js';\nimport { calculateTotalEmissions } from '../../../core/services/emission.js';\n\n/**\n * Á¢≥ÊéíÊîæÊéßÂà∂Âô®\n * Â§ÑÁêÜÁ¢≥ÊéíÊîæÁõ∏ÂÖ≥ÁöÑ‰∏öÂä°ÈÄªËæë\n */\nclass CarbonController extends BaseController {\n  constructor() {\n    super();\n  }\n\n  /**\n   * Ëé∑ÂèñÁ¢≥ÊéíÊîæÊï∞ÊçÆÂàóË°®\n   */\n  getCarbonEmissions = this.asyncHandler(async (req, res) => {\n    try {\n      const pagination = this.getPaginationParams(req);\n      const sorting = this.getSortingParams(req, 'timestamp', 'desc');\n      const filters = this.getFilterParams(req, ['device_id', 'emission_source']);\n      const dateRange = this.getDateRangeParams(req);\n\n      const queryConditions = {\n        ...filters,\n        ...dateRange\n      };\n\n      const result = await CarbonEmission.findWithPagination({\n        conditions: queryConditions,\n        pagination,\n        sorting\n      });\n\n      const response = this.formatPaginatedResponse(result, pagination);\n      res.success(response);\n    } catch (error) {\n      logger.error('Ëé∑ÂèñÁ¢≥ÊéíÊîæÊï∞ÊçÆÂàóË°®Â§±Ë¥•', {\n        error: error.message,\n        userId: req.user?.id\n      });\n      res.internalError('Ëé∑ÂèñÁ¢≥ÊéíÊîæÊï∞ÊçÆÂàóË°®Â§±Ë¥•');\n    }\n  });\n\n  /**\n   * Ëé∑ÂèñÂçï‰∏™Á¢≥ÊéíÊîæËÆ∞ÂΩï\n   */\n  getCarbonEmission = this.asyncHandler(async (req, res) => {\n    const { id } = req.params;\n\n    try {\n      const carbonRecord = await CarbonEmission.findById(id);\n      if (!carbonRecord) {\n        return res.notFound('Á¢≥ÊéíÊîæËÆ∞ÂΩï‰∏çÂ≠òÂú®');\n      }\n\n      res.success(carbonRecord);\n    } catch (error) {\n      logger.error('Ëé∑ÂèñÁ¢≥ÊéíÊîæËÆ∞ÂΩïÂ§±Ë¥•', {\n        error: error.message,\n        recordId: id,\n        userId: req.user?.id\n      });\n      res.internalError('Ëé∑ÂèñÁ¢≥ÊéíÊîæËÆ∞ÂΩïÂ§±Ë¥•');\n    }\n  });\n\n  /**\n   * ÂàõÂª∫Á¢≥ÊéíÊîæÊï∞ÊçÆËÆ∞ÂΩï\n   */\n  createCarbonEmission = this.asyncHandler(async (req, res) => {\n    const errors = validationResult(req);\n    if (!errors.isEmpty()) {\n      return res.validationError(errors.array());\n    }\n\n    try {\n      const carbonData = {\n        ...req.body,\n        created_by: req.user.id,\n        created_at: new Date().toISOString()\n      };\n\n      // ËÆæÁΩÆÈªòËÆ§Êó∂Èó¥Êà≥\n      if (!carbonData.timestamp) {\n        carbonData.timestamp = new Date().toISOString();\n      }\n\n      const newRecord = await CarbonEmission.create(carbonData);\n\n      this.logOperation(req, 'CARBON_EMISSION_CREATE', {\n        recordId: newRecord.id,\n        deviceId: carbonData.device_id,\n        emission: carbonData.emission_amount\n      });\n\n      res.success(newRecord, 'Á¢≥ÊéíÊîæÊï∞ÊçÆÂàõÂª∫ÊàêÂäü', 201);\n    } catch (error) {\n      logger.error('ÂàõÂª∫Á¢≥ÊéíÊîæÊï∞ÊçÆÂ§±Ë¥•', {\n        error: error.message,\n        carbonData: req.body,\n        userId: req.user?.id\n      });\n      res.internalError('ÂàõÂª∫Á¢≥ÊéíÊîæÊï∞ÊçÆÂ§±Ë¥•');\n    }\n  });\n\n  /**\n   * Âü∫‰∫éËÉΩËÄóÊï∞ÊçÆËÆ°ÁÆóÁ¢≥ÊéíÊîæ\n   */\n  calculateCarbonFromEnergy = this.asyncHandler(async (req, res) => {\n    const errors = validationResult(req);\n    if (!errors.isEmpty()) {\n      return res.validationError(errors.array());\n    }\n\n    try {\n      const { energy_data_ids, carbon_factor_id } = req.body;\n\n      // È™åËØÅÁ¢≥ÊéíÊîæÂõ†Â≠ê\n      const carbonFactor = await CarbonFactor.findById(carbon_factor_id);\n      if (!carbonFactor) {\n        return res.badRequest('Á¢≥ÊéíÊîæÂõ†Â≠ê‰∏çÂ≠òÂú®');\n      }\n\n      // Ëé∑ÂèñËÉΩËÄóÊï∞ÊçÆ\n      const energyRecords = await EnergyData.findByIds(energy_data_ids);\n      if (energyRecords.length === 0) {\n        return res.badRequest('Êú™ÊâæÂà∞ÊúâÊïàÁöÑËÉΩËÄóÊï∞ÊçÆ');\n      }\n\n      // ËÆ°ÁÆóÁ¢≥ÊéíÊîæ\n      const carbonEmissions = [];\n      for (const energyRecord of energyRecords) {\n        const emissionAmount = energyRecord.consumption * carbonFactor.factor_value;\n\n        const carbonData = {\n          device_id: energyRecord.device_id,\n          emission_source: energyRecord.energy_type,\n          emission_amount: emissionAmount,\n          emission_unit: carbonFactor.unit,\n          energy_consumption: energyRecord.consumption,\n          carbon_factor_id,\n          calculation_method: 'energy_based',\n          timestamp: energyRecord.timestamp,\n          created_by: req.user.id,\n          created_at: new Date().toISOString()\n        };\n\n        const newEmission = await CarbonEmission.create(carbonData);\n        carbonEmissions.push(newEmission);\n      }\n\n      this.logOperation(req, 'CARBON_CALCULATION', {\n        energyRecordCount: energyRecords.length,\n        carbonFactorId: carbon_factor_id,\n        totalEmission: carbonEmissions.reduce((sum, e) => sum + e.emission_amount, 0)\n      });\n\n      res.success(\n        {\n          calculated_emissions: carbonEmissions,\n          total_emission: carbonEmissions.reduce((sum, e) => sum + e.emission_amount, 0),\n          carbon_factor: carbonFactor\n        },\n        'Á¢≥ÊéíÊîæËÆ°ÁÆóÊàêÂäü',\n        201\n      );\n    } catch (error) {\n      logger.error('Á¢≥ÊéíÊîæËÆ°ÁÆóÂ§±Ë¥•', {\n        error: error.message,\n        requestData: req.body,\n        userId: req.user?.id\n      });\n      res.internalError('Á¢≥ÊéíÊîæËÆ°ÁÆóÂ§±Ë¥•');\n    }\n  });\n\n  /**\n   * Ëé∑ÂèñÁ¢≥ÊéíÊîæÁªüËÆ°Êï∞ÊçÆ\n   */\n  getCarbonStatistics = this.asyncHandler(async (req, res) => {\n    try {\n      const dateRange = this.getDateRangeParams(req);\n      const { device_id, emission_source, group_by = 'day' } = req.query;\n\n      const filters = {\n        ...dateRange\n      };\n\n      if (device_id) {filters.device_id = device_id;}\n      if (emission_source) {filters.emission_source = emission_source;}\n\n      const statistics = await CarbonEmission.getStatistics({\n        filters,\n        groupBy: group_by\n      });\n\n      res.success(statistics);\n    } catch (error) {\n      logger.error('Ëé∑ÂèñÁ¢≥ÊéíÊîæÁªüËÆ°Êï∞ÊçÆÂ§±Ë¥•', {\n        error: error.message,\n        filters: req.query,\n        userId: req.user?.id\n      });\n      res.internalError('Ëé∑ÂèñÁ¢≥ÊéíÊîæÁªüËÆ°Êï∞ÊçÆÂ§±Ë¥•');\n    }\n  });\n\n  /**\n   * Ëé∑ÂèñÁ¢≥ÊéíÊîæË∂ãÂäøÊï∞ÊçÆ\n   */\n  getCarbonTrend = this.asyncHandler(async (req, res) => {\n    try {\n      const { start_time, end_time, interval = 'day' } = req.query;\n\n      if (!start_time || !end_time) {\n        return res.badRequest('Áº∫Â∞ëÂøÖË¶ÅÂèÇÊï∞: start_time, end_time');\n      }\n\n      // ‰ΩøÁî®Áé∞ÊúâÁöÑÁ¢≥ÊéíÊîæËÆ°ÁÆóÊúçÂä°\n      const trendData = calculateTotalEmissions(start_time, end_time, interval);\n\n      this.logOperation(req, 'CARBON_TREND_QUERY', {\n        timeRange: { start_time, end_time },\n        interval\n      });\n\n      res.success({\n        trend: trendData,\n        unit: 'kgCO2',\n        time_range: {\n          start: start_time,\n          end: end_time\n        },\n        interval\n      });\n    } catch (error) {\n      logger.error('Ëé∑ÂèñÁ¢≥ÊéíÊîæË∂ãÂäøÊï∞ÊçÆÂ§±Ë¥•', {\n        error: error.message,\n        timeRange: { start_time: req.query.start_time, end_time: req.query.end_time },\n        userId: req.user?.id\n      });\n      res.internalError('Ëé∑ÂèñÁ¢≥ÊéíÊîæË∂ãÂäøÊï∞ÊçÆÂ§±Ë¥•');\n    }\n  });\n\n  /**\n   * Ëé∑ÂèñÁ¢≥ÊéíÊîæÂõ†Â≠êÂàóË°®\n   */\n  getCarbonFactors = this.asyncHandler(async (req, res) => {\n    try {\n      const pagination = this.getPaginationParams(req);\n      const filters = this.getFilterParams(req, ['energy_type', 'region']);\n\n      const result = await CarbonFactor.findWithPagination({\n        conditions: filters,\n        pagination\n      });\n\n      const response = this.formatPaginatedResponse(result, pagination);\n      res.success(response);\n    } catch (error) {\n      logger.error('Ëé∑ÂèñÁ¢≥ÊéíÊîæÂõ†Â≠êÂàóË°®Â§±Ë¥•', {\n        error: error.message,\n        userId: req.user?.id\n      });\n      res.internalError('Ëé∑ÂèñÁ¢≥ÊéíÊîæÂõ†Â≠êÂàóË°®Â§±Ë¥•');\n    }\n  });\n\n  /**\n   * ÂàõÂª∫Á¢≥ÊéíÊîæÂõ†Â≠ê\n   */\n  createCarbonFactor = this.asyncHandler(async (req, res) => {\n    const errors = validationResult(req);\n    if (!errors.isEmpty()) {\n      return res.validationError(errors.array());\n    }\n\n    try {\n      const factorData = {\n        ...req.body,\n        created_by: req.user.id,\n        created_at: new Date().toISOString()\n      };\n\n      const newFactor = await CarbonFactor.create(factorData);\n\n      this.logOperation(req, 'CARBON_FACTOR_CREATE', {\n        factorId: newFactor.id,\n        energyType: factorData.energy_type,\n        factorValue: factorData.factor_value\n      });\n\n      res.success(newFactor, 'Á¢≥ÊéíÊîæÂõ†Â≠êÂàõÂª∫ÊàêÂäü', 201);\n    } catch (error) {\n      logger.error('ÂàõÂª∫Á¢≥ÊéíÊîæÂõ†Â≠êÂ§±Ë¥•', {\n        error: error.message,\n        factorData: req.body,\n        userId: req.user?.id\n      });\n      res.internalError('ÂàõÂª∫Á¢≥ÊéíÊîæÂõ†Â≠êÂ§±Ë¥•');\n    }\n  });\n\n  /**\n   * Êõ¥Êñ∞Á¢≥ÊéíÊîæÂõ†Â≠ê\n   */\n  updateCarbonFactor = this.asyncHandler(async (req, res) => {\n    const errors = validationResult(req);\n    if (!errors.isEmpty()) {\n      return res.validationError(errors.array());\n    }\n\n    const { id } = req.params;\n\n    try {\n      const factor = await CarbonFactor.findById(id);\n      if (!factor) {\n        return res.notFound('Á¢≥ÊéíÊîæÂõ†Â≠ê‰∏çÂ≠òÂú®');\n      }\n\n      const updateData = {\n        ...req.body,\n        updated_by: req.user.id,\n        updated_at: new Date().toISOString()\n      };\n\n      const updatedFactor = await CarbonFactor.update(id, updateData);\n\n      this.logOperation(req, 'CARBON_FACTOR_UPDATE', {\n        factorId: id,\n        changes: Object.keys(updateData)\n      });\n\n      res.success(updatedFactor, 'Á¢≥ÊéíÊîæÂõ†Â≠êÊõ¥Êñ∞ÊàêÂäü');\n    } catch (error) {\n      logger.error('Êõ¥Êñ∞Á¢≥ÊéíÊîæÂõ†Â≠êÂ§±Ë¥•', {\n        error: error.message,\n        factorId: id,\n        updateData: req.body,\n        userId: req.user?.id\n      });\n      res.internalError('Êõ¥Êñ∞Á¢≥ÊéíÊîæÂõ†Â≠êÂ§±Ë¥•');\n    }\n  });\n\n  /**\n   * ÁîüÊàêÁ¢≥ÊéíÊîæÊä•Âëä\n   */\n  generateCarbonReport = this.asyncHandler(async (req, res) => {\n    try {\n      const dateRange = this.getDateRangeParams(req);\n      const { report_type = 'summary', device_ids } = req.query;\n\n      const filters = {\n        ...dateRange\n      };\n\n      if (device_ids) {\n        filters.device_id = device_ids.split(',');\n      }\n\n      const report = await CarbonEmission.generateReport({\n        filters,\n        reportType: report_type\n      });\n\n      this.logOperation(req, 'CARBON_REPORT_GENERATE', {\n        reportType: report_type,\n        timeRange: dateRange,\n        deviceCount: device_ids ? device_ids.split(',').length : 'all'\n      });\n\n      res.success({\n        report,\n        generated_at: new Date().toISOString(),\n        report_type,\n        time_range: dateRange\n      });\n    } catch (error) {\n      logger.error('ÁîüÊàêÁ¢≥ÊéíÊîæÊä•ÂëäÂ§±Ë¥•', {\n        error: error.message,\n        reportType: req.query.report_type,\n        userId: req.user?.id\n      });\n      res.internalError('ÁîüÊàêÁ¢≥ÊéíÊîæÊä•ÂëäÂ§±Ë¥•');\n    }\n  });\n\n  /**\n   * ÂØºÂá∫Á¢≥ÊéíÊîæÊï∞ÊçÆ\n   */\n  exportCarbonData = this.asyncHandler(async (req, res) => {\n    try {\n      const dateRange = this.getDateRangeParams(req);\n      const filters = this.getFilterParams(req, ['device_id', 'emission_source']);\n      const { format = 'csv' } = req.query;\n\n      const queryConditions = {\n        ...filters,\n        ...dateRange\n      };\n\n      let exportData;\n      let contentType;\n      let fileExtension;\n\n      switch (format.toLowerCase()) {\n        case 'csv':\n          exportData = await CarbonEmission.exportToCSV(queryConditions);\n          contentType = 'text/csv';\n          fileExtension = 'csv';\n          break;\n        case 'json':\n          exportData = await CarbonEmission.exportToJSON(queryConditions);\n          contentType = 'application/json';\n          fileExtension = 'json';\n          break;\n        default:\n          return res.badRequest('‰∏çÊîØÊåÅÁöÑÂØºÂá∫Ê†ºÂºè');\n      }\n\n      this.logOperation(req, 'CARBON_DATA_EXPORT', {\n        format,\n        filters: queryConditions,\n        recordCount: exportData.recordCount\n      });\n\n      res.downloadFile(\n        exportData.content,\n        `carbon_emissions_${Date.now()}.${fileExtension}`,\n        contentType\n      );\n    } catch (error) {\n      logger.error('ÂØºÂá∫Á¢≥ÊéíÊîæÊï∞ÊçÆÂ§±Ë¥•', {\n        error: error.message,\n        format: req.query.format,\n        filters: req.query,\n        userId: req.user?.id\n      });\n      res.internalError('ÂØºÂá∫Á¢≥ÊéíÊîæÊï∞ÊçÆÂ§±Ë¥•');\n    }\n  });\n\n  /**\n   * Âà†Èô§Á¢≥ÊéíÊîæÊï∞ÊçÆËÆ∞ÂΩï\n   */\n  deleteCarbonEmission = this.asyncHandler(async (req, res) => {\n    const { id } = req.params;\n\n    try {\n      const carbonRecord = await CarbonEmission.findById(id);\n      if (!carbonRecord) {\n        return res.notFound('Á¢≥ÊéíÊîæËÆ∞ÂΩï‰∏çÂ≠òÂú®');\n      }\n\n      await CarbonEmission.delete(id);\n\n      this.logOperation(req, 'CARBON_EMISSION_DELETE', {\n        recordId: id,\n        deviceId: carbonRecord.device_id\n      });\n\n      res.success(null, 'Á¢≥ÊéíÊîæÊï∞ÊçÆÂà†Èô§ÊàêÂäü');\n    } catch (error) {\n      logger.error('Âà†Èô§Á¢≥ÊéíÊîæÊï∞ÊçÆÂ§±Ë¥•', {\n        error: error.message,\n        recordId: id,\n        userId: req.user?.id\n      });\n      res.internalError('Âà†Èô§Á¢≥ÊéíÊîæÊï∞ÊçÆÂ§±Ë¥•');\n    }\n  });\n\n  /**\n   * Ëé∑ÂèñÁ¢≥ÊéíÊîæÈ¢ÑÊµã\n   */\n  getCarbonPrediction = this.asyncHandler(async (req, res) => {\n    try {\n      const { device_id, prediction_days = 7 } = req.query;\n\n      const filters = {};\n      if (device_id) {filters.device_id = device_id;}\n\n      const prediction = await CarbonEmission.getPrediction({\n        filters,\n        predictionDays: parseInt(prediction_days)\n      });\n\n      res.success({\n        prediction_days: parseInt(prediction_days),\n        prediction_data: prediction,\n        generated_at: new Date().toISOString()\n      });\n    } catch (error) {\n      logger.error('Ëé∑ÂèñÁ¢≥ÊéíÊîæÈ¢ÑÊµãÂ§±Ë¥•', {\n        error: error.message,\n        deviceId: req.query.device_id,\n        userId: req.user?.id\n      });\n      res.internalError('Ëé∑ÂèñÁ¢≥ÊéíÊîæÈ¢ÑÊµãÂ§±Ë¥•');\n    }\n  });\n}\n\nexport default new CarbonController();\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/interfaces/http/controllers/DeviceController.js","messages":[{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 201.","line":119,"column":40,"nodeType":"Literal","messageId":"noMagic","endLine":119,"endColumn":43}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { validationResult } from 'express-validator';\nimport BaseController from './BaseController.js';\nimport Device from '../../../core/entities/Device.js';\nimport DeviceType from '../../../core/entities/DeviceType.js';\nimport logger from '../../../shared/utils/logger.js';\n\n/**\n * ËÆæÂ§áÁÆ°ÁêÜÊéßÂà∂Âô®\n * Â§ÑÁêÜËÆæÂ§áÁõ∏ÂÖ≥ÁöÑ‰∏öÂä°ÈÄªËæë\n */\nclass DeviceController extends BaseController {\n  constructor() {\n    super();\n  }\n\n  /**\n   * Ëé∑ÂèñËÆæÂ§áÂàóË°®\n   */\n  getDevices = this.asyncHandler(async (req, res) => {\n    try {\n      const pagination = this.getPaginationParams(req);\n      const sorting = this.getSortingParams(req, 'created_at', 'desc');\n      const filters = this.getFilterParams(req, ['type', 'status', 'location']);\n      const search = this.getSearchParams(req, ['name', 'serial_number', 'model']);\n      const dateRange = this.getDateRangeParams(req);\n\n      // ÊûÑÂª∫Êü•ËØ¢Êù°‰ª∂\n      const queryConditions = {\n        ...filters,\n        ...search,\n        ...dateRange\n      };\n\n      const result = await Device.findWithPagination({\n        conditions: queryConditions,\n        pagination,\n        sorting\n      });\n\n      const response = this.formatPaginatedResponse(result, pagination);\n      res.success(response);\n    } catch (error) {\n      logger.error('Ëé∑ÂèñËÆæÂ§áÂàóË°®Â§±Ë¥•', {\n        error: error.message,\n        userId: req.user?.id\n      });\n      res.internalError('Ëé∑ÂèñËÆæÂ§áÂàóË°®Â§±Ë¥•');\n    }\n  });\n\n  /**\n   * Ëé∑ÂèñÂçï‰∏™ËÆæÂ§áËØ¶ÊÉÖ\n   */\n  getDevice = this.asyncHandler(async (req, res) => {\n    const { id } = req.params;\n\n    try {\n      const device = await Device.findById(id);\n      if (!device) {\n        return res.notFound('ËÆæÂ§á‰∏çÂ≠òÂú®');\n      }\n\n      // Ëé∑ÂèñËÆæÂ§áÁ±ªÂûã‰ø°ÊÅØ\n      if (device.type_id) {\n        device.type_info = await DeviceType.findById(device.type_id);\n      }\n\n      res.success(device);\n    } catch (error) {\n      logger.error('Ëé∑ÂèñËÆæÂ§áËØ¶ÊÉÖÂ§±Ë¥•', {\n        error: error.message,\n        deviceId: id,\n        userId: req.user?.id\n      });\n      res.internalError('Ëé∑ÂèñËÆæÂ§áËØ¶ÊÉÖÂ§±Ë¥•');\n    }\n  });\n\n  /**\n   * ÂàõÂª∫Êñ∞ËÆæÂ§á\n   */\n  createDevice = this.asyncHandler(async (req, res) => {\n    const errors = validationResult(req);\n    if (!errors.isEmpty()) {\n      return res.validationError(errors.array());\n    }\n\n    try {\n      const deviceData = {\n        ...req.body,\n        created_by: req.user.id,\n        created_at: new Date().toISOString(),\n        status: req.body.status || 'offline'\n      };\n\n      // Ê£ÄÊü•Â∫èÂàóÂè∑ÊòØÂê¶Â∑≤Â≠òÂú®\n      if (deviceData.serial_number) {\n        const existingDevice = await Device.findBySerialNumber(deviceData.serial_number);\n        if (existingDevice) {\n          return res.conflict('ËÆæÂ§áÂ∫èÂàóÂè∑Â∑≤Â≠òÂú®');\n        }\n      }\n\n      // È™åËØÅËÆæÂ§áÁ±ªÂûã\n      if (deviceData.type_id) {\n        const deviceType = await DeviceType.findById(deviceData.type_id);\n        if (!deviceType) {\n          return res.badRequest('Êó†ÊïàÁöÑËÆæÂ§áÁ±ªÂûã');\n        }\n      }\n\n      const newDevice = await Device.create(deviceData);\n\n      this.logOperation(req, 'DEVICE_CREATE', {\n        deviceId: newDevice.id,\n        deviceName: newDevice.name\n      });\n\n      res.success(newDevice, 'ËÆæÂ§áÂàõÂª∫ÊàêÂäü', 201);\n    } catch (error) {\n      logger.error('ÂàõÂª∫ËÆæÂ§áÂ§±Ë¥•', {\n        error: error.message,\n        deviceData: req.body,\n        userId: req.user?.id\n      });\n      res.internalError('ÂàõÂª∫ËÆæÂ§áÂ§±Ë¥•');\n    }\n  });\n\n  /**\n   * Êõ¥Êñ∞ËÆæÂ§á‰ø°ÊÅØ\n   */\n  updateDevice = this.asyncHandler(async (req, res) => {\n    const errors = validationResult(req);\n    if (!errors.isEmpty()) {\n      return res.validationError(errors.array());\n    }\n\n    const { id } = req.params;\n\n    try {\n      const device = await Device.findById(id);\n      if (!device) {\n        return res.notFound('ËÆæÂ§á‰∏çÂ≠òÂú®');\n      }\n\n      const updateData = {\n        ...req.body,\n        updated_by: req.user.id,\n        updated_at: new Date().toISOString()\n      };\n\n      // Ê£ÄÊü•Â∫èÂàóÂè∑ÂÜ≤Á™ÅÔºàÂ¶ÇÊûúÊõ¥Êñ∞‰∫ÜÂ∫èÂàóÂè∑Ôºâ\n      if (updateData.serial_number && updateData.serial_number !== device.serial_number) {\n        const existingDevice = await Device.findBySerialNumber(updateData.serial_number);\n        if (existingDevice && existingDevice.id !== id) {\n          return res.conflict('ËÆæÂ§áÂ∫èÂàóÂè∑Â∑≤Â≠òÂú®');\n        }\n      }\n\n      // È™åËØÅËÆæÂ§áÁ±ªÂûãÔºàÂ¶ÇÊûúÊõ¥Êñ∞‰∫ÜÁ±ªÂûãÔºâ\n      if (updateData.type_id && updateData.type_id !== device.type_id) {\n        const deviceType = await DeviceType.findById(updateData.type_id);\n        if (!deviceType) {\n          return res.badRequest('Êó†ÊïàÁöÑËÆæÂ§áÁ±ªÂûã');\n        }\n      }\n\n      const updatedDevice = await Device.update(id, updateData);\n\n      this.logOperation(req, 'DEVICE_UPDATE', {\n        deviceId: id,\n        deviceName: updatedDevice.name,\n        changes: Object.keys(updateData)\n      });\n\n      res.success(updatedDevice, 'ËÆæÂ§áÊõ¥Êñ∞ÊàêÂäü');\n    } catch (error) {\n      logger.error('Êõ¥Êñ∞ËÆæÂ§áÂ§±Ë¥•', {\n        error: error.message,\n        deviceId: id,\n        updateData: req.body,\n        userId: req.user?.id\n      });\n      res.internalError('Êõ¥Êñ∞ËÆæÂ§áÂ§±Ë¥•');\n    }\n  });\n\n  /**\n   * Âà†Èô§ËÆæÂ§á\n   */\n  deleteDevice = this.asyncHandler(async (req, res) => {\n    const { id } = req.params;\n\n    try {\n      const device = await Device.findById(id);\n      if (!device) {\n        return res.notFound('ËÆæÂ§á‰∏çÂ≠òÂú®');\n      }\n\n      // Ê£ÄÊü•ËÆæÂ§áÊòØÂê¶ÊúâÂÖ≥ËÅîÊï∞ÊçÆ\n      const hasRelatedData = await Device.hasRelatedData(id);\n      if (hasRelatedData) {\n        return res.conflict('ËÆæÂ§áÂ≠òÂú®ÂÖ≥ËÅîÊï∞ÊçÆÔºåÊó†Ê≥ïÂà†Èô§');\n      }\n\n      await Device.delete(id);\n\n      this.logOperation(req, 'DEVICE_DELETE', {\n        deviceId: id,\n        deviceName: device.name\n      });\n\n      res.success(null, 'ËÆæÂ§áÂà†Èô§ÊàêÂäü');\n    } catch (error) {\n      logger.error('Âà†Èô§ËÆæÂ§áÂ§±Ë¥•', {\n        error: error.message,\n        deviceId: id,\n        userId: req.user?.id\n      });\n      res.internalError('Âà†Èô§ËÆæÂ§áÂ§±Ë¥•');\n    }\n  });\n\n  /**\n   * Ëé∑ÂèñËÆæÂ§áÁ±ªÂûãÂàóË°®\n   */\n  getDeviceTypes = this.asyncHandler(async (req, res) => {\n    try {\n      const deviceTypes = await DeviceType.findAll();\n      res.success(deviceTypes);\n    } catch (error) {\n      logger.error('Ëé∑ÂèñËÆæÂ§áÁ±ªÂûãÂàóË°®Â§±Ë¥•', {\n        error: error.message,\n        userId: req.user?.id\n      });\n      res.internalError('Ëé∑ÂèñËÆæÂ§áÁ±ªÂûãÂàóË°®Â§±Ë¥•');\n    }\n  });\n\n  /**\n   * Ëé∑ÂèñËÆæÂ§áÁä∂ÊÄÅÁªüËÆ°\n   */\n  getDeviceStatusStats = this.asyncHandler(async (req, res) => {\n    try {\n      const stats = await Device.getStatusStatistics();\n      res.success(stats);\n    } catch (error) {\n      logger.error('Ëé∑ÂèñËÆæÂ§áÁä∂ÊÄÅÁªüËÆ°Â§±Ë¥•', {\n        error: error.message,\n        userId: req.user?.id\n      });\n      res.internalError('Ëé∑ÂèñËÆæÂ§áÁä∂ÊÄÅÁªüËÆ°Â§±Ë¥•');\n    }\n  });\n\n  /**\n   * Ëé∑ÂèñËÆæÂ§áÁ±ªÂûãÁªüËÆ°\n   */\n  getDeviceTypeStats = this.asyncHandler(async (req, res) => {\n    try {\n      const stats = await Device.getTypeStatistics();\n      res.success(stats);\n    } catch (error) {\n      logger.error('Ëé∑ÂèñËÆæÂ§áÁ±ªÂûãÁªüËÆ°Â§±Ë¥•', {\n        error: error.message,\n        userId: req.user?.id\n      });\n      res.internalError('Ëé∑ÂèñËÆæÂ§áÁ±ªÂûãÁªüËÆ°Â§±Ë¥•');\n    }\n  });\n\n  /**\n   * ÊâπÈáèÊõ¥Êñ∞ËÆæÂ§áÁä∂ÊÄÅ\n   */\n  batchUpdateStatus = this.asyncHandler(async (req, res) => {\n    const errors = validationResult(req);\n    if (!errors.isEmpty()) {\n      return res.validationError(errors.array());\n    }\n\n    const { device_ids, status } = req.body;\n\n    try {\n      const updateData = {\n        status,\n        updated_by: req.user.id,\n        updated_at: new Date().toISOString()\n      };\n\n      const result = await Device.batchUpdate(device_ids, updateData);\n\n      this.logOperation(req, 'DEVICE_BATCH_UPDATE', {\n        deviceIds: device_ids,\n        status,\n        affectedCount: result.affectedRows\n      });\n\n      res.success(\n        {\n          affected_count: result.affectedRows,\n          status\n        },\n        'ÊâπÈáèÊõ¥Êñ∞ËÆæÂ§áÁä∂ÊÄÅÊàêÂäü'\n      );\n    } catch (error) {\n      logger.error('ÊâπÈáèÊõ¥Êñ∞ËÆæÂ§áÁä∂ÊÄÅÂ§±Ë¥•', {\n        error: error.message,\n        deviceIds: req.body.device_ids,\n        status: req.body.status,\n        userId: req.user?.id\n      });\n      res.internalError('ÊâπÈáèÊõ¥Êñ∞ËÆæÂ§áÁä∂ÊÄÅÂ§±Ë¥•');\n    }\n  });\n\n  /**\n   * ËÆæÂ§áÂÅ•Â∫∑Ê£ÄÊü•\n   */\n  healthCheck = this.asyncHandler(async (req, res) => {\n    const { id } = req.params;\n\n    try {\n      const device = await Device.findById(id);\n      if (!device) {\n        return res.notFound('ËÆæÂ§á‰∏çÂ≠òÂú®');\n      }\n\n      // ÊâßË°åËÆæÂ§áÂÅ•Â∫∑Ê£ÄÊü•\n      const healthStatus = await Device.performHealthCheck(id);\n\n      // Êõ¥Êñ∞ËÆæÂ§áÂÅ•Â∫∑Áä∂ÊÄÅ\n      await Device.update(id, {\n        health_status: healthStatus.status,\n        last_health_check: new Date().toISOString(),\n        updated_by: req.user.id,\n        updated_at: new Date().toISOString()\n      });\n\n      this.logOperation(req, 'DEVICE_HEALTH_CHECK', {\n        deviceId: id,\n        healthStatus: healthStatus.status\n      });\n\n      res.success(healthStatus, 'ËÆæÂ§áÂÅ•Â∫∑Ê£ÄÊü•ÂÆåÊàê');\n    } catch (error) {\n      logger.error('ËÆæÂ§áÂÅ•Â∫∑Ê£ÄÊü•Â§±Ë¥•', {\n        error: error.message,\n        deviceId: id,\n        userId: req.user?.id\n      });\n      res.internalError('ËÆæÂ§áÂÅ•Â∫∑Ê£ÄÊü•Â§±Ë¥•');\n    }\n  });\n\n  /**\n   * Ëé∑ÂèñËÆæÂ§áÂéÜÂè≤Êï∞ÊçÆ\n   */\n  getDeviceHistory = this.asyncHandler(async (req, res) => {\n    const { id } = req.params;\n    const dateRange = this.getDateRangeParams(req);\n    const pagination = this.getPaginationParams(req);\n\n    try {\n      const device = await Device.findById(id);\n      if (!device) {\n        return res.notFound('ËÆæÂ§á‰∏çÂ≠òÂú®');\n      }\n\n      const history = await Device.getHistory(id, {\n        ...dateRange,\n        ...pagination\n      });\n\n      const response = this.formatPaginatedResponse(history, pagination);\n      res.success(response);\n    } catch (error) {\n      logger.error('Ëé∑ÂèñËÆæÂ§áÂéÜÂè≤Êï∞ÊçÆÂ§±Ë¥•', {\n        error: error.message,\n        deviceId: id,\n        userId: req.user?.id\n      });\n      res.internalError('Ëé∑ÂèñËÆæÂ§áÂéÜÂè≤Êï∞ÊçÆÂ§±Ë¥•');\n    }\n  });\n}\n\nexport default new DeviceController();\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/interfaces/http/controllers/DigitalTwinController.js","messages":[{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 20.","line":12,"column":33,"nodeType":"Literal","messageId":"noMagic","endLine":12,"endColumn":35},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":35,"column":44,"nodeType":"Literal","messageId":"noMagic","endLine":35,"endColumn":47},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 404.","line":46,"column":43,"nodeType":"Literal","messageId":"noMagic","endLine":46,"endColumn":46},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":52,"column":42,"nodeType":"Literal","messageId":"noMagic","endLine":52,"endColumn":45},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 404.","line":65,"column":45,"nodeType":"Literal","messageId":"noMagic","endLine":65,"endColumn":48},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 201.","line":77,"column":77,"nodeType":"Literal","messageId":"noMagic","endLine":77,"endColumn":80},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":80,"column":42,"nodeType":"Literal","messageId":"noMagic","endLine":80,"endColumn":45},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 404.","line":91,"column":43,"nodeType":"Literal","messageId":"noMagic","endLine":91,"endColumn":46},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":105,"column":42,"nodeType":"Literal","messageId":"noMagic","endLine":105,"endColumn":45},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 404.","line":116,"column":43,"nodeType":"Literal","messageId":"noMagic","endLine":116,"endColumn":46},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":124,"column":42,"nodeType":"Literal","messageId":"noMagic","endLine":124,"endColumn":45},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 404.","line":135,"column":43,"nodeType":"Literal","messageId":"noMagic","endLine":135,"endColumn":46},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":143,"column":42,"nodeType":"Literal","messageId":"noMagic","endLine":143,"endColumn":45},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 404.","line":154,"column":43,"nodeType":"Literal","messageId":"noMagic","endLine":154,"endColumn":46},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":167,"column":40,"nodeType":"Literal","messageId":"noMagic","endLine":167,"endColumn":43},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 404.","line":178,"column":43,"nodeType":"Literal","messageId":"noMagic","endLine":178,"endColumn":46},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":193,"column":42,"nodeType":"Literal","messageId":"noMagic","endLine":193,"endColumn":45},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 404.","line":204,"column":43,"nodeType":"Literal","messageId":"noMagic","endLine":204,"endColumn":46},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":219,"column":40,"nodeType":"Literal","messageId":"noMagic","endLine":219,"endColumn":43},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":240,"column":42,"nodeType":"Literal","messageId":"noMagic","endLine":240,"endColumn":45},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 404.","line":251,"column":43,"nodeType":"Literal","messageId":"noMagic","endLine":251,"endColumn":46},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":259,"column":40,"nodeType":"Literal","messageId":"noMagic","endLine":259,"endColumn":43},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 404.","line":270,"column":43,"nodeType":"Literal","messageId":"noMagic","endLine":270,"endColumn":46},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":284,"column":42,"nodeType":"Literal","messageId":"noMagic","endLine":284,"endColumn":45},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":319,"column":40,"nodeType":"Literal","messageId":"noMagic","endLine":319,"endColumn":43}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":25,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import BaseController from './BaseController.js';\nimport DigitalTwin from '../../../domain/entities/DigitalTwin.js';\nimport Device from '../../../domain/entities/Device.js';\nimport logger from '../../../utils/logger.js';\n\nclass DigitalTwinController extends BaseController {\n  /**\n   * Ëé∑ÂèñÊï∞Â≠óÂ≠™ÁîüÂàóË°®\n   */\n  async getDigitalTwins(req, res) {\n    try {\n      const { page = 1, limit = 20, deviceId, twinType, status, buildingId } = req.query;\n\n      const filters = {};\n      if (deviceId) {filters.deviceId = deviceId;}\n      if (twinType) {filters.twinType = twinType;}\n      if (status) {filters.status = status;}\n      if (buildingId) {filters.buildingId = buildingId;}\n\n      const offset = (page - 1) * limit;\n      const digitalTwins = await DigitalTwin.findWithPagination(filters, offset, parseInt(limit));\n      const total = await DigitalTwin.countDocuments(filters);\n\n      return this.success(res, 'Ëé∑ÂèñÊï∞Â≠óÂ≠™ÁîüÂàóË°®ÊàêÂäü', {\n        data: digitalTwins,\n        pagination: {\n          page: parseInt(page),\n          limit: parseInt(limit),\n          total,\n          pages: Math.ceil(total / limit)\n        }\n      });\n    } catch (error) {\n      logger.error('Ëé∑ÂèñÊï∞Â≠óÂ≠™ÁîüÂàóË°®ÈîôËØØ:', error);\n      return this.error(res, 'Ëé∑ÂèñÊï∞Â≠óÂ≠™ÁîüÂàóË°®Â§±Ë¥•', 500);\n    }\n  }\n\n  /**\n   * Ëé∑ÂèñÂçï‰∏™Êï∞Â≠óÂ≠™Áîü\n   */\n  async getDigitalTwin(req, res) {\n    try {\n      const digitalTwin = await DigitalTwin.findByIdWithDetails(req.params.id);\n      if (!digitalTwin) {\n        return this.error(res, 'Êï∞Â≠óÂ≠™Áîü‰∏çÂ≠òÂú®', 404);\n      }\n\n      return this.success(res, 'Ëé∑ÂèñÊï∞Â≠óÂ≠™ÁîüÊàêÂäü', { digitalTwin });\n    } catch (error) {\n      logger.error('Ëé∑ÂèñÊï∞Â≠óÂ≠™ÁîüÈîôËØØ:', error);\n      return this.error(res, 'Ëé∑ÂèñÊï∞Â≠óÂ≠™ÁîüÂ§±Ë¥•', 500);\n    }\n  }\n\n  /**\n   * ÂàõÂª∫Êï∞Â≠óÂ≠™Áîü\n   */\n  async createDigitalTwin(req, res) {\n    try {\n      // È™åËØÅÂÖ≥ËÅîËÆæÂ§áÊòØÂê¶Â≠òÂú®\n      if (req.body.deviceId) {\n        const device = await Device.findById(req.body.deviceId);\n        if (!device) {\n          return this.error(res, 'ÂÖ≥ËÅîËÆæÂ§á‰∏çÂ≠òÂú®', 404);\n        }\n      }\n\n      const digitalTwinData = {\n        ...req.body,\n        createdBy: req.user.userId,\n        createdAt: new Date()\n      };\n\n      const newDigitalTwin = await DigitalTwin.create(digitalTwinData);\n\n      return this.success(res, 'Êï∞Â≠óÂ≠™ÁîüÂàõÂª∫ÊàêÂäü', { digitalTwin: newDigitalTwin }, 201);\n    } catch (error) {\n      logger.error('ÂàõÂª∫Êï∞Â≠óÂ≠™ÁîüÈîôËØØ:', error);\n      return this.error(res, 'ÂàõÂª∫Êï∞Â≠óÂ≠™ÁîüÂ§±Ë¥•', 500);\n    }\n  }\n\n  /**\n   * Êõ¥Êñ∞Êï∞Â≠óÂ≠™Áîü\n   */\n  async updateDigitalTwin(req, res) {\n    try {\n      const digitalTwin = await DigitalTwin.findById(req.params.id);\n      if (!digitalTwin) {\n        return this.error(res, 'Êï∞Â≠óÂ≠™Áîü‰∏çÂ≠òÂú®', 404);\n      }\n\n      const updateData = {\n        ...req.body,\n        updatedBy: req.user.userId,\n        updatedAt: new Date()\n      };\n\n      const updatedDigitalTwin = await digitalTwin.update(updateData);\n\n      return this.success(res, 'Êï∞Â≠óÂ≠™ÁîüÊõ¥Êñ∞ÊàêÂäü', { digitalTwin: updatedDigitalTwin });\n    } catch (error) {\n      logger.error('Êõ¥Êñ∞Êï∞Â≠óÂ≠™ÁîüÈîôËØØ:', error);\n      return this.error(res, 'Êõ¥Êñ∞Êï∞Â≠óÂ≠™ÁîüÂ§±Ë¥•', 500);\n    }\n  }\n\n  /**\n   * Âà†Èô§Êï∞Â≠óÂ≠™Áîü\n   */\n  async deleteDigitalTwin(req, res) {\n    try {\n      const digitalTwin = await DigitalTwin.findById(req.params.id);\n      if (!digitalTwin) {\n        return this.error(res, 'Êï∞Â≠óÂ≠™Áîü‰∏çÂ≠òÂú®', 404);\n      }\n\n      await digitalTwin.delete();\n\n      return this.success(res, 'Êï∞Â≠óÂ≠™ÁîüÂà†Èô§ÊàêÂäü');\n    } catch (error) {\n      logger.error('Âà†Èô§Êï∞Â≠óÂ≠™ÁîüÈîôËØØ:', error);\n      return this.error(res, 'Âà†Èô§Êï∞Â≠óÂ≠™ÁîüÂ§±Ë¥•', 500);\n    }\n  }\n\n  /**\n   * Ëé∑ÂèñÊï∞Â≠óÂ≠™ÁîüÂÆûÊó∂Êï∞ÊçÆ\n   */\n  async getDigitalTwinRealTimeData(req, res) {\n    try {\n      const digitalTwin = await DigitalTwin.findById(req.params.id);\n      if (!digitalTwin) {\n        return this.error(res, 'Êï∞Â≠óÂ≠™Áîü‰∏çÂ≠òÂú®', 404);\n      }\n\n      const realTimeData = await digitalTwin.getRealTimeData();\n\n      return this.success(res, 'Ëé∑ÂèñÂÆûÊó∂Êï∞ÊçÆÊàêÂäü', { realTimeData });\n    } catch (error) {\n      logger.error('Ëé∑ÂèñÊï∞Â≠óÂ≠™ÁîüÂÆûÊó∂Êï∞ÊçÆÈîôËØØ:', error);\n      return this.error(res, 'Ëé∑ÂèñÂÆûÊó∂Êï∞ÊçÆÂ§±Ë¥•', 500);\n    }\n  }\n\n  /**\n   * Êõ¥Êñ∞Êï∞Â≠óÂ≠™ÁîüÁä∂ÊÄÅ\n   */\n  async updateDigitalTwinStatus(req, res) {\n    try {\n      const digitalTwin = await DigitalTwin.findById(req.params.id);\n      if (!digitalTwin) {\n        return this.error(res, 'Êï∞Â≠óÂ≠™Áîü‰∏çÂ≠òÂú®', 404);\n      }\n\n      const { status, statusData } = req.body;\n      const updatedDigitalTwin = await digitalTwin.updateStatus(\n        status,\n        statusData,\n        req.user.userId\n      );\n\n      return this.success(res, 'Êï∞Â≠óÂ≠™ÁîüÁä∂ÊÄÅÊõ¥Êñ∞ÊàêÂäü', { digitalTwin: updatedDigitalTwin });\n    } catch (error) {\n      logger.error('Êõ¥Êñ∞Êï∞Â≠óÂ≠™ÁîüÁä∂ÊÄÅÈîôËØØ:', error);\n      return this.error(res, 'Êõ¥Êñ∞Áä∂ÊÄÅÂ§±Ë¥•', 500);\n    }\n  }\n\n  /**\n   * Ëé∑ÂèñÊï∞Â≠óÂ≠™ÁîüÊ®°ÊãüÊï∞ÊçÆ\n   */\n  async getDigitalTwinSimulationData(req, res) {\n    try {\n      const digitalTwin = await DigitalTwin.findById(req.params.id);\n      if (!digitalTwin) {\n        return this.error(res, 'Êï∞Â≠óÂ≠™Áîü‰∏çÂ≠òÂú®', 404);\n      }\n\n      const { startDate, endDate, simulationType, parameters } = req.query;\n\n      const simulationData = await digitalTwin.getSimulationData({\n        startDate: startDate ? new Date(startDate) : null,\n        endDate: endDate ? new Date(endDate) : null,\n        simulationType,\n        parameters: parameters ? JSON.parse(parameters) : {}\n      });\n\n      return this.success(res, 'Ëé∑ÂèñÊ®°ÊãüÊï∞ÊçÆÊàêÂäü', { simulationData });\n    } catch (error) {\n      logger.error('Ëé∑ÂèñÊï∞Â≠óÂ≠™ÁîüÊ®°ÊãüÊï∞ÊçÆÈîôËØØ:', error);\n      return this.error(res, 'Ëé∑ÂèñÊ®°ÊãüÊï∞ÊçÆÂ§±Ë¥•', 500);\n    }\n  }\n\n  /**\n   * ËøêË°åÊï∞Â≠óÂ≠™ÁîüÊ®°Êãü\n   */\n  async runDigitalTwinSimulation(req, res) {\n    try {\n      const digitalTwin = await DigitalTwin.findById(req.params.id);\n      if (!digitalTwin) {\n        return this.error(res, 'Êï∞Â≠óÂ≠™Áîü‰∏çÂ≠òÂú®', 404);\n      }\n\n      const { simulationType, parameters, duration } = req.body;\n\n      const simulationResult = await digitalTwin.runSimulation({\n        simulationType,\n        parameters,\n        duration,\n        initiatedBy: req.user.userId\n      });\n\n      return this.success(res, 'Ê®°ÊãüËøêË°åÊàêÂäü', { simulationResult });\n    } catch (error) {\n      logger.error('ËøêË°åÊï∞Â≠óÂ≠™ÁîüÊ®°ÊãüÈîôËØØ:', error);\n      return this.error(res, 'ËøêË°åÊ®°ÊãüÂ§±Ë¥•', 500);\n    }\n  }\n\n  /**\n   * Ëé∑ÂèñÊï∞Â≠óÂ≠™ÁîüÁªüËÆ°Êï∞ÊçÆ\n   */\n  async getDigitalTwinStats(req, res) {\n    try {\n      const { twinType, buildingId, status } = req.query;\n\n      const filters = {};\n      if (twinType) {filters.twinType = twinType;}\n      if (buildingId) {filters.buildingId = buildingId;}\n      if (status) {filters.status = status;}\n\n      const stats = await DigitalTwin.getStatistics(filters);\n\n      return this.success(res, 'Ëé∑ÂèñÊï∞Â≠óÂ≠™ÁîüÁªüËÆ°ÊàêÂäü', { stats });\n    } catch (error) {\n      logger.error('Ëé∑ÂèñÊï∞Â≠óÂ≠™ÁîüÁªüËÆ°ÈîôËØØ:', error);\n      return this.error(res, 'Ëé∑ÂèñÁªüËÆ°Êï∞ÊçÆÂ§±Ë¥•', 500);\n    }\n  }\n\n  /**\n   * ÂêåÊ≠•Êï∞Â≠óÂ≠™ÁîüÊï∞ÊçÆ\n   */\n  async syncDigitalTwinData(req, res) {\n    try {\n      const digitalTwin = await DigitalTwin.findById(req.params.id);\n      if (!digitalTwin) {\n        return this.error(res, 'Êï∞Â≠óÂ≠™Áîü‰∏çÂ≠òÂú®', 404);\n      }\n\n      const syncResult = await digitalTwin.syncWithRealWorld(req.user.userId);\n\n      return this.success(res, 'Êï∞ÊçÆÂêåÊ≠•ÊàêÂäü', { syncResult });\n    } catch (error) {\n      logger.error('ÂêåÊ≠•Êï∞Â≠óÂ≠™ÁîüÊï∞ÊçÆÈîôËØØ:', error);\n      return this.error(res, 'Êï∞ÊçÆÂêåÊ≠•Â§±Ë¥•', 500);\n    }\n  }\n\n  /**\n   * Ëé∑ÂèñÊï∞Â≠óÂ≠™ÁîüÊÄßËÉΩÊåáÊ†á\n   */\n  async getDigitalTwinPerformance(req, res) {\n    try {\n      const digitalTwin = await DigitalTwin.findById(req.params.id);\n      if (!digitalTwin) {\n        return this.error(res, 'Êï∞Â≠óÂ≠™Áîü‰∏çÂ≠òÂú®', 404);\n      }\n\n      const { startDate, endDate, metrics } = req.query;\n\n      const performance = await digitalTwin.getPerformanceMetrics({\n        startDate: startDate ? new Date(startDate) : null,\n        endDate: endDate ? new Date(endDate) : null,\n        metrics: metrics ? metrics.split(',') : []\n      });\n\n      return this.success(res, 'Ëé∑ÂèñÊÄßËÉΩÊåáÊ†áÊàêÂäü', { performance });\n    } catch (error) {\n      logger.error('Ëé∑ÂèñÊï∞Â≠óÂ≠™ÁîüÊÄßËÉΩÊåáÊ†áÈîôËØØ:', error);\n      return this.error(res, 'Ëé∑ÂèñÊÄßËÉΩÊåáÊ†áÂ§±Ë¥•', 500);\n    }\n  }\n\n  /**\n   * ÂØºÂá∫Êï∞Â≠óÂ≠™ÁîüÊï∞ÊçÆ\n   */\n  async exportDigitalTwinData(req, res) {\n    try {\n      const { twinType, buildingId, status, format = 'csv' } = req.query;\n\n      const filters = {};\n      if (twinType) {filters.twinType = twinType;}\n      if (buildingId) {filters.buildingId = buildingId;}\n      if (status) {filters.status = status;}\n\n      let exportData;\n      let contentType;\n      let filename;\n\n      if (format === 'json') {\n        exportData = await DigitalTwin.exportToJSON(filters);\n        contentType = 'application/json';\n        filename = 'digital-twins.json';\n      } else {\n        exportData = await DigitalTwin.exportToCSV(filters);\n        contentType = 'text/csv';\n        filename = 'digital-twins.csv';\n      }\n\n      res.setHeader('Content-Type', contentType);\n      res.setHeader('Content-Disposition', `attachment; filename=${filename}`);\n      res.send(exportData);\n    } catch (error) {\n      logger.error('ÂØºÂá∫Êï∞Â≠óÂ≠™ÁîüÊï∞ÊçÆÈîôËØØ:', error);\n      return this.error(res, 'ÂØºÂá∫Êï∞ÊçÆÂ§±Ë¥•', 500);\n    }\n  }\n}\n\nexport default new DigitalTwinController();\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/interfaces/http/controllers/EnergyController.js","messages":[{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 201.","line":114,"column":42,"nodeType":"Literal","messageId":"noMagic","endLine":114,"endColumn":45},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 201.","line":170,"column":9,"nodeType":"Literal","messageId":"noMagic","endLine":170,"endColumn":12},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":219,"column":23,"nodeType":"Literal","messageId":"noMagic","endLine":219,"endColumn":25},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 7.","line":344,"column":44,"nodeType":"Literal","messageId":"noMagic","endLine":344,"endColumn":45}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { validationResult } from 'express-validator';\nimport BaseController from './BaseController.js';\nimport EnergyData from '../../../core/entities/EnergyData.js';\nimport Device from '../../../core/entities/Device.js';\nimport logger from '../../../shared/utils/logger.js';\n\n/**\n * ËÉΩÊ∫êÊï∞ÊçÆÊéßÂà∂Âô®\n * Â§ÑÁêÜËÉΩËÄóÊï∞ÊçÆÁõ∏ÂÖ≥ÁöÑ‰∏öÂä°ÈÄªËæë\n */\nclass EnergyController extends BaseController {\n  constructor() {\n    super();\n  }\n\n  /**\n   * Ëé∑ÂèñËÉΩËÄóÊï∞ÊçÆÂàóË°®\n   */\n  getEnergyData = this.asyncHandler(async (req, res) => {\n    try {\n      const pagination = this.getPaginationParams(req);\n      const sorting = this.getSortingParams(req, 'timestamp', 'desc');\n      const filters = this.getFilterParams(req, ['device_id', 'energy_type']);\n      const dateRange = this.getDateRangeParams(req);\n\n      // ÊûÑÂª∫Êü•ËØ¢Êù°‰ª∂\n      const queryConditions = {\n        ...filters,\n        ...dateRange\n      };\n\n      const result = await EnergyData.findWithPagination({\n        conditions: queryConditions,\n        pagination,\n        sorting\n      });\n\n      const response = this.formatPaginatedResponse(result, pagination);\n      res.success(response);\n    } catch (error) {\n      logger.error('Ëé∑ÂèñËÉΩËÄóÊï∞ÊçÆÂàóË°®Â§±Ë¥•', {\n        error: error.message,\n        userId: req.user?.id\n      });\n      res.internalError('Ëé∑ÂèñËÉΩËÄóÊï∞ÊçÆÂàóË°®Â§±Ë¥•');\n    }\n  });\n\n  /**\n   * Ëé∑ÂèñÂçï‰∏™ËÉΩËÄóËÆ∞ÂΩï\n   */\n  getEnergyRecord = this.asyncHandler(async (req, res) => {\n    const { id } = req.params;\n\n    try {\n      const energyRecord = await EnergyData.findById(id);\n      if (!energyRecord) {\n        return res.notFound('ËÉΩËÄóËÆ∞ÂΩï‰∏çÂ≠òÂú®');\n      }\n\n      // Ëé∑ÂèñÂÖ≥ËÅîËÆæÂ§á‰ø°ÊÅØ\n      if (energyRecord.device_id) {\n        energyRecord.device_info = await Device.findById(energyRecord.device_id);\n      }\n\n      res.success(energyRecord);\n    } catch (error) {\n      logger.error('Ëé∑ÂèñËÉΩËÄóËÆ∞ÂΩïÂ§±Ë¥•', {\n        error: error.message,\n        recordId: id,\n        userId: req.user?.id\n      });\n      res.internalError('Ëé∑ÂèñËÉΩËÄóËÆ∞ÂΩïÂ§±Ë¥•');\n    }\n  });\n\n  /**\n   * ÂàõÂª∫ËÉΩËÄóÊï∞ÊçÆËÆ∞ÂΩï\n   */\n  createEnergyData = this.asyncHandler(async (req, res) => {\n    const errors = validationResult(req);\n    if (!errors.isEmpty()) {\n      return res.validationError(errors.array());\n    }\n\n    try {\n      const energyData = {\n        ...req.body,\n        created_by: req.user.id,\n        created_at: new Date().toISOString()\n      };\n\n      // È™åËØÅËÆæÂ§áÊòØÂê¶Â≠òÂú®\n      if (energyData.device_id) {\n        const device = await Device.findById(energyData.device_id);\n        if (!device) {\n          return res.badRequest('ËÆæÂ§á‰∏çÂ≠òÂú®');\n        }\n      }\n\n      // ËÆæÁΩÆÈªòËÆ§Êó∂Èó¥Êà≥\n      if (!energyData.timestamp) {\n        energyData.timestamp = new Date().toISOString();\n      }\n\n      const newRecord = await EnergyData.create(energyData);\n\n      this.logOperation(req, 'ENERGY_DATA_CREATE', {\n        recordId: newRecord.id,\n        deviceId: energyData.device_id,\n        consumption: energyData.consumption\n      });\n\n      res.success(newRecord, 'ËÉΩËÄóÊï∞ÊçÆÂàõÂª∫ÊàêÂäü', 201);\n    } catch (error) {\n      logger.error('ÂàõÂª∫ËÉΩËÄóÊï∞ÊçÆÂ§±Ë¥•', {\n        error: error.message,\n        energyData: req.body,\n        userId: req.user?.id\n      });\n      res.internalError('ÂàõÂª∫ËÉΩËÄóÊï∞ÊçÆÂ§±Ë¥•');\n    }\n  });\n\n  /**\n   * ÊâπÈáèÂàõÂª∫ËÉΩËÄóÊï∞ÊçÆËÆ∞ÂΩï\n   */\n  batchCreateEnergyData = this.asyncHandler(async (req, res) => {\n    const errors = validationResult(req);\n    if (!errors.isEmpty()) {\n      return res.validationError(errors.array());\n    }\n\n    const { records } = req.body;\n\n    try {\n      // È™åËØÅÊâÄÊúâËÆæÂ§áID\n      const deviceIds = [...new Set(records.map((r) => r.device_id).filter(Boolean))];\n      if (deviceIds.length > 0) {\n        const devices = await Device.findByIds(deviceIds);\n        const existingDeviceIds = devices.map((d) => d.id);\n        const invalidDeviceIds = deviceIds.filter((id) => !existingDeviceIds.includes(id));\n\n        if (invalidDeviceIds.length > 0) {\n          return res.badRequest(`‰ª•‰∏ãËÆæÂ§á‰∏çÂ≠òÂú®: ${invalidDeviceIds.join(', ')}`);\n        }\n      }\n\n      // Â§ÑÁêÜÊâπÈáèÊï∞ÊçÆ\n      const processedRecords = records.map((record) => ({\n        ...record,\n        created_by: req.user.id,\n        created_at: new Date().toISOString(),\n        timestamp: record.timestamp || new Date().toISOString()\n      }));\n\n      const result = await EnergyData.batchCreate(processedRecords);\n\n      this.logOperation(req, 'ENERGY_DATA_BATCH_CREATE', {\n        recordCount: processedRecords.length,\n        deviceIds\n      });\n\n      res.success(\n        {\n          created_count: result.insertedCount,\n          records: result.records\n        },\n        'ÊâπÈáèÂàõÂª∫ËÉΩËÄóÊï∞ÊçÆÊàêÂäü',\n        201\n      );\n    } catch (error) {\n      logger.error('ÊâπÈáèÂàõÂª∫ËÉΩËÄóÊï∞ÊçÆÂ§±Ë¥•', {\n        error: error.message,\n        recordCount: req.body.records?.length,\n        userId: req.user?.id\n      });\n      res.internalError('ÊâπÈáèÂàõÂª∫ËÉΩËÄóÊï∞ÊçÆÂ§±Ë¥•');\n    }\n  });\n\n  /**\n   * Ëé∑ÂèñËÉΩËÄóÁªüËÆ°Êï∞ÊçÆ\n   */\n  getEnergyStatistics = this.asyncHandler(async (req, res) => {\n    try {\n      const dateRange = this.getDateRangeParams(req);\n      const { device_id, energy_type, group_by = 'day' } = req.query;\n\n      const filters = {\n        ...dateRange\n      };\n\n      if (device_id) {filters.device_id = device_id;}\n      if (energy_type) {filters.energy_type = energy_type;}\n\n      const statistics = await EnergyData.getStatistics({\n        filters,\n        groupBy: group_by\n      });\n\n      res.success(statistics);\n    } catch (error) {\n      logger.error('Ëé∑ÂèñËÉΩËÄóÁªüËÆ°Êï∞ÊçÆÂ§±Ë¥•', {\n        error: error.message,\n        filters: req.query,\n        userId: req.user?.id\n      });\n      res.internalError('Ëé∑ÂèñËÉΩËÄóÁªüËÆ°Êï∞ÊçÆÂ§±Ë¥•');\n    }\n  });\n\n  /**\n   * Ëé∑ÂèñËÆæÂ§áËÉΩËÄóÊéíË°å\n   */\n  getDeviceEnergyRanking = this.asyncHandler(async (req, res) => {\n    try {\n      const dateRange = this.getDateRangeParams(req);\n      const { limit = 10, energy_type } = req.query;\n\n      const filters = {\n        ...dateRange\n      };\n\n      if (energy_type) {filters.energy_type = energy_type;}\n\n      const ranking = await EnergyData.getDeviceRanking({\n        filters,\n        limit: parseInt(limit)\n      });\n\n      res.success(ranking);\n    } catch (error) {\n      logger.error('Ëé∑ÂèñËÆæÂ§áËÉΩËÄóÊéíË°åÂ§±Ë¥•', {\n        error: error.message,\n        filters: req.query,\n        userId: req.user?.id\n      });\n      res.internalError('Ëé∑ÂèñËÆæÂ§áËÉΩËÄóÊéíË°åÂ§±Ë¥•');\n    }\n  });\n\n  /**\n   * Ëé∑ÂèñËÉΩËÄóË∂ãÂäøÊï∞ÊçÆ\n   */\n  getEnergyTrend = this.asyncHandler(async (req, res) => {\n    try {\n      const dateRange = this.getDateRangeParams(req);\n      const { device_id, energy_type, interval = 'hour' } = req.query;\n\n      const filters = {\n        ...dateRange\n      };\n\n      if (device_id) {filters.device_id = device_id;}\n      if (energy_type) {filters.energy_type = energy_type;}\n\n      const trendData = await EnergyData.getTrendData({\n        filters,\n        interval\n      });\n\n      res.success({\n        trend: trendData,\n        interval,\n        time_range: dateRange\n      });\n    } catch (error) {\n      logger.error('Ëé∑ÂèñËÉΩËÄóË∂ãÂäøÊï∞ÊçÆÂ§±Ë¥•', {\n        error: error.message,\n        filters: req.query,\n        userId: req.user?.id\n      });\n      res.internalError('Ëé∑ÂèñËÉΩËÄóË∂ãÂäøÊï∞ÊçÆÂ§±Ë¥•');\n    }\n  });\n\n  /**\n   * Âà†Èô§ËÉΩËÄóÊï∞ÊçÆËÆ∞ÂΩï\n   */\n  deleteEnergyData = this.asyncHandler(async (req, res) => {\n    const { id } = req.params;\n\n    try {\n      const energyRecord = await EnergyData.findById(id);\n      if (!energyRecord) {\n        return res.notFound('ËÉΩËÄóËÆ∞ÂΩï‰∏çÂ≠òÂú®');\n      }\n\n      await EnergyData.delete(id);\n\n      this.logOperation(req, 'ENERGY_DATA_DELETE', {\n        recordId: id,\n        deviceId: energyRecord.device_id\n      });\n\n      res.success(null, 'ËÉΩËÄóÊï∞ÊçÆÂà†Èô§ÊàêÂäü');\n    } catch (error) {\n      logger.error('Âà†Èô§ËÉΩËÄóÊï∞ÊçÆÂ§±Ë¥•', {\n        error: error.message,\n        recordId: id,\n        userId: req.user?.id\n      });\n      res.internalError('Âà†Èô§ËÉΩËÄóÊï∞ÊçÆÂ§±Ë¥•');\n    }\n  });\n\n  /**\n   * ÂØºÂá∫ËÉΩËÄóÊï∞ÊçÆÔºàCSVÊ†ºÂºèÔºâ\n   */\n  exportEnergyData = this.asyncHandler(async (req, res) => {\n    try {\n      const dateRange = this.getDateRangeParams(req);\n      const filters = this.getFilterParams(req, ['device_id', 'energy_type']);\n\n      const queryConditions = {\n        ...filters,\n        ...dateRange\n      };\n\n      const data = await EnergyData.exportToCSV(queryConditions);\n\n      this.logOperation(req, 'ENERGY_DATA_EXPORT', {\n        filters: queryConditions,\n        recordCount: data.recordCount\n      });\n\n      res.downloadFile(data.csvContent, `energy_data_${Date.now()}.csv`, 'text/csv');\n    } catch (error) {\n      logger.error('ÂØºÂá∫ËÉΩËÄóÊï∞ÊçÆÂ§±Ë¥•', {\n        error: error.message,\n        filters: req.query,\n        userId: req.user?.id\n      });\n      res.internalError('ÂØºÂá∫ËÉΩËÄóÊï∞ÊçÆÂ§±Ë¥•');\n    }\n  });\n\n  /**\n   * Ëé∑ÂèñËÉΩËÄóÈ¢ÑÊµãÊï∞ÊçÆ\n   */\n  getEnergyPrediction = this.asyncHandler(async (req, res) => {\n    try {\n      const { device_id, prediction_days = 7 } = req.query;\n\n      if (!device_id) {\n        return res.badRequest('ËÆæÂ§áIDÊòØÂøÖÈúÄÁöÑ');\n      }\n\n      // È™åËØÅËÆæÂ§áÊòØÂê¶Â≠òÂú®\n      const device = await Device.findById(device_id);\n      if (!device) {\n        return res.badRequest('ËÆæÂ§á‰∏çÂ≠òÂú®');\n      }\n\n      const prediction = await EnergyData.getPrediction({\n        deviceId: device_id,\n        predictionDays: parseInt(prediction_days)\n      });\n\n      res.success({\n        device_id,\n        prediction_days: parseInt(prediction_days),\n        prediction_data: prediction,\n        generated_at: new Date().toISOString()\n      });\n    } catch (error) {\n      logger.error('Ëé∑ÂèñËÉΩËÄóÈ¢ÑÊµãÊï∞ÊçÆÂ§±Ë¥•', {\n        error: error.message,\n        deviceId: req.query.device_id,\n        userId: req.user?.id\n      });\n      res.internalError('Ëé∑ÂèñËÉΩËÄóÈ¢ÑÊµãÊï∞ÊçÆÂ§±Ë¥•');\n    }\n  });\n\n  /**\n   * Ëé∑ÂèñÂÆûÊó∂ËÉΩËÄóÊï∞ÊçÆ\n   */\n  getRealTimeEnergyData = this.asyncHandler(async (req, res) => {\n    try {\n      const { device_ids } = req.query;\n      const deviceIdArray = device_ids ? device_ids.split(',') : [];\n\n      const realTimeData = await EnergyData.getRealTimeData(deviceIdArray);\n\n      res.success({\n        data: realTimeData,\n        timestamp: new Date().toISOString(),\n        device_count: realTimeData.length\n      });\n    } catch (error) {\n      logger.error('Ëé∑ÂèñÂÆûÊó∂ËÉΩËÄóÊï∞ÊçÆÂ§±Ë¥•', {\n        error: error.message,\n        deviceIds: req.query.device_ids,\n        userId: req.user?.id\n      });\n      res.internalError('Ëé∑ÂèñÂÆûÊó∂ËÉΩËÄóÊï∞ÊçÆÂ§±Ë¥•');\n    }\n  });\n}\n\nexport default new EnergyController();\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/interfaces/http/controllers/MaintenanceController.js","messages":[{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 20.","line":14,"column":17,"nodeType":"Literal","messageId":"noMagic","endLine":14,"endColumn":19},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":53,"column":42,"nodeType":"Literal","messageId":"noMagic","endLine":53,"endColumn":45},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 404.","line":64,"column":43,"nodeType":"Literal","messageId":"noMagic","endLine":64,"endColumn":46},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":70,"column":42,"nodeType":"Literal","messageId":"noMagic","endLine":70,"endColumn":45},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 404.","line":82,"column":41,"nodeType":"Literal","messageId":"noMagic","endLine":82,"endColumn":44},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 201.","line":97,"column":9,"nodeType":"Literal","messageId":"noMagic","endLine":97,"endColumn":12},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":101,"column":42,"nodeType":"Literal","messageId":"noMagic","endLine":101,"endColumn":45},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 404.","line":112,"column":43,"nodeType":"Literal","messageId":"noMagic","endLine":112,"endColumn":46},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":126,"column":42,"nodeType":"Literal","messageId":"noMagic","endLine":126,"endColumn":45},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 404.","line":137,"column":43,"nodeType":"Literal","messageId":"noMagic","endLine":137,"endColumn":46},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":145,"column":42,"nodeType":"Literal","messageId":"noMagic","endLine":145,"endColumn":45},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":170,"column":42,"nodeType":"Literal","messageId":"noMagic","endLine":170,"endColumn":45},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":194,"column":42,"nodeType":"Literal","messageId":"noMagic","endLine":194,"endColumn":45},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 404.","line":205,"column":43,"nodeType":"Literal","messageId":"noMagic","endLine":205,"endColumn":46},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":209,"column":43,"nodeType":"Literal","messageId":"noMagic","endLine":209,"endColumn":46},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":227,"column":42,"nodeType":"Literal","messageId":"noMagic","endLine":227,"endColumn":45},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 20.","line":237,"column":33,"nodeType":"Literal","messageId":"noMagic","endLine":237,"endColumn":35},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":258,"column":44,"nodeType":"Literal","messageId":"noMagic","endLine":258,"endColumn":47},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":286,"column":42,"nodeType":"Literal","messageId":"noMagic","endLine":286,"endColumn":45}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":19,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import BaseController from './BaseController.js';\nimport MaintenanceRecord from '../../../domain/entities/MaintenanceRecord.js';\nimport Device from '../../../domain/entities/Device.js';\nimport logger from '../../../utils/logger.js';\n\nclass MaintenanceController extends BaseController {\n  /**\n   * Ëé∑ÂèñÁª¥Êä§ËÆ∞ÂΩïÂàóË°®\n   */\n  async getMaintenanceRecords(req, res) {\n    try {\n      const {\n        page = 1,\n        limit = 20,\n        deviceId,\n        maintenanceType,\n        status,\n        startDate,\n        endDate,\n        priority\n      } = req.query;\n\n      const filters = {};\n      if (deviceId) {filters.deviceId = deviceId;}\n      if (maintenanceType) {filters.maintenanceType = maintenanceType;}\n      if (status) {filters.status = status;}\n      if (priority) {filters.priority = priority;}\n      if (startDate || endDate) {\n        filters.scheduledDate = {};\n        if (startDate) {filters.scheduledDate.$gte = new Date(startDate);}\n        if (endDate) {filters.scheduledDate.$lte = new Date(endDate);}\n      }\n\n      const offset = (page - 1) * limit;\n      const maintenanceRecords = await MaintenanceRecord.findWithPagination(\n        filters,\n        offset,\n        parseInt(limit)\n      );\n      const total = await MaintenanceRecord.countDocuments(filters);\n\n      return this.success(res, 'Ëé∑ÂèñÁª¥Êä§ËÆ∞ÂΩïÊàêÂäü', {\n        data: maintenanceRecords,\n        pagination: {\n          page: parseInt(page),\n          limit: parseInt(limit),\n          total,\n          pages: Math.ceil(total / limit)\n        }\n      });\n    } catch (error) {\n      logger.error('Ëé∑ÂèñÁª¥Êä§ËÆ∞ÂΩïÈîôËØØ:', error);\n      return this.error(res, 'Ëé∑ÂèñÁª¥Êä§ËÆ∞ÂΩïÂ§±Ë¥•', 500);\n    }\n  }\n\n  /**\n   * Ëé∑ÂèñÂçï‰∏™Áª¥Êä§ËÆ∞ÂΩï\n   */\n  async getMaintenanceRecord(req, res) {\n    try {\n      const maintenanceRecord = await MaintenanceRecord.findByIdWithDevice(req.params.id);\n      if (!maintenanceRecord) {\n        return this.error(res, 'Áª¥Êä§ËÆ∞ÂΩï‰∏çÂ≠òÂú®', 404);\n      }\n\n      return this.success(res, 'Ëé∑ÂèñÁª¥Êä§ËÆ∞ÂΩïÊàêÂäü', { maintenanceRecord });\n    } catch (error) {\n      logger.error('Ëé∑ÂèñÁª¥Êä§ËÆ∞ÂΩïÈîôËØØ:', error);\n      return this.error(res, 'Ëé∑ÂèñÁª¥Êä§ËÆ∞ÂΩïÂ§±Ë¥•', 500);\n    }\n  }\n\n  /**\n   * ÂàõÂª∫Áª¥Êä§ËÆ∞ÂΩï\n   */\n  async createMaintenanceRecord(req, res) {\n    try {\n      // È™åËØÅËÆæÂ§áÊòØÂê¶Â≠òÂú®\n      const device = await Device.findById(req.body.deviceId);\n      if (!device) {\n        return this.error(res, 'ËÆæÂ§á‰∏çÂ≠òÂú®', 404);\n      }\n\n      const maintenanceData = {\n        ...req.body,\n        createdBy: req.user.userId,\n        createdAt: new Date()\n      };\n\n      const newMaintenanceRecord = await MaintenanceRecord.create(maintenanceData);\n\n      return this.success(\n        res,\n        'Áª¥Êä§ËÆ∞ÂΩïÂàõÂª∫ÊàêÂäü',\n        { maintenanceRecord: newMaintenanceRecord },\n        201\n      );\n    } catch (error) {\n      logger.error('ÂàõÂª∫Áª¥Êä§ËÆ∞ÂΩïÈîôËØØ:', error);\n      return this.error(res, 'ÂàõÂª∫Áª¥Êä§ËÆ∞ÂΩïÂ§±Ë¥•', 500);\n    }\n  }\n\n  /**\n   * Êõ¥Êñ∞Áª¥Êä§ËÆ∞ÂΩï\n   */\n  async updateMaintenanceRecord(req, res) {\n    try {\n      const maintenanceRecord = await MaintenanceRecord.findById(req.params.id);\n      if (!maintenanceRecord) {\n        return this.error(res, 'Áª¥Êä§ËÆ∞ÂΩï‰∏çÂ≠òÂú®', 404);\n      }\n\n      const updateData = {\n        ...req.body,\n        updatedBy: req.user.userId,\n        updatedAt: new Date()\n      };\n\n      const updatedRecord = await maintenanceRecord.update(updateData);\n\n      return this.success(res, 'Áª¥Êä§ËÆ∞ÂΩïÊõ¥Êñ∞ÊàêÂäü', { maintenanceRecord: updatedRecord });\n    } catch (error) {\n      logger.error('Êõ¥Êñ∞Áª¥Êä§ËÆ∞ÂΩïÈîôËØØ:', error);\n      return this.error(res, 'Êõ¥Êñ∞Áª¥Êä§ËÆ∞ÂΩïÂ§±Ë¥•', 500);\n    }\n  }\n\n  /**\n   * Âà†Èô§Áª¥Êä§ËÆ∞ÂΩï\n   */\n  async deleteMaintenanceRecord(req, res) {\n    try {\n      const maintenanceRecord = await MaintenanceRecord.findById(req.params.id);\n      if (!maintenanceRecord) {\n        return this.error(res, 'Áª¥Êä§ËÆ∞ÂΩï‰∏çÂ≠òÂú®', 404);\n      }\n\n      await maintenanceRecord.delete();\n\n      return this.success(res, 'Áª¥Êä§ËÆ∞ÂΩïÂà†Èô§ÊàêÂäü');\n    } catch (error) {\n      logger.error('Âà†Èô§Áª¥Êä§ËÆ∞ÂΩïÈîôËØØ:', error);\n      return this.error(res, 'Âà†Èô§Áª¥Êä§ËÆ∞ÂΩïÂ§±Ë¥•', 500);\n    }\n  }\n\n  /**\n   * Ëé∑ÂèñÁª¥Êä§ÁªüËÆ°Êï∞ÊçÆ\n   */\n  async getMaintenanceStats(req, res) {\n    try {\n      const { startDate, endDate, deviceId, maintenanceType } = req.query;\n\n      const filters = {};\n      if (deviceId) {filters.deviceId = deviceId;}\n      if (maintenanceType) {filters.maintenanceType = maintenanceType;}\n      if (startDate || endDate) {\n        filters.scheduledDate = {};\n        if (startDate) {filters.scheduledDate.$gte = new Date(startDate);}\n        if (endDate) {filters.scheduledDate.$lte = new Date(endDate);}\n      }\n\n      const stats = await MaintenanceRecord.getStatistics(filters);\n\n      return this.success(res, 'Ëé∑ÂèñÁª¥Êä§ÁªüËÆ°ÊàêÂäü', { stats });\n    } catch (error) {\n      logger.error('Ëé∑ÂèñÁª¥Êä§ÁªüËÆ°ÈîôËØØ:', error);\n      return this.error(res, 'Ëé∑ÂèñÁª¥Êä§ÁªüËÆ°Â§±Ë¥•', 500);\n    }\n  }\n\n  /**\n   * Ëé∑ÂèñÁª¥Êä§ËÆ°Âàí\n   */\n  async getMaintenanceSchedule(req, res) {\n    try {\n      const { startDate, endDate, deviceId, status = 'scheduled' } = req.query;\n\n      const filters = { status };\n      if (deviceId) {filters.deviceId = deviceId;}\n      if (startDate || endDate) {\n        filters.scheduledDate = {};\n        if (startDate) {filters.scheduledDate.$gte = new Date(startDate);}\n        if (endDate) {filters.scheduledDate.$lte = new Date(endDate);}\n      }\n\n      const schedule = await MaintenanceRecord.findScheduled(filters);\n\n      return this.success(res, 'Ëé∑ÂèñÁª¥Êä§ËÆ°ÂàíÊàêÂäü', { schedule });\n    } catch (error) {\n      logger.error('Ëé∑ÂèñÁª¥Êä§ËÆ°ÂàíÈîôËØØ:', error);\n      return this.error(res, 'Ëé∑ÂèñÁª¥Êä§ËÆ°ÂàíÂ§±Ë¥•', 500);\n    }\n  }\n\n  /**\n   * ÂÆåÊàêÁª¥Êä§‰ªªÂä°\n   */\n  async completeMaintenance(req, res) {\n    try {\n      const maintenanceRecord = await MaintenanceRecord.findById(req.params.id);\n      if (!maintenanceRecord) {\n        return this.error(res, 'Áª¥Êä§ËÆ∞ÂΩï‰∏çÂ≠òÂú®', 404);\n      }\n\n      if (maintenanceRecord.status === 'completed') {\n        return this.error(res, 'Áª¥Êä§‰ªªÂä°Â∑≤ÂÆåÊàê', 400);\n      }\n\n      const completionData = {\n        status: 'completed',\n        completedDate: new Date(),\n        completedBy: req.user.userId,\n        notes: req.body.notes || '',\n        actualCost: req.body.actualCost,\n        actualDuration: req.body.actualDuration,\n        updatedAt: new Date()\n      };\n\n      const completedRecord = await maintenanceRecord.update(completionData);\n\n      return this.success(res, 'Áª¥Êä§‰ªªÂä°ÂÆåÊàê', { maintenanceRecord: completedRecord });\n    } catch (error) {\n      logger.error('ÂÆåÊàêÁª¥Êä§‰ªªÂä°ÈîôËØØ:', error);\n      return this.error(res, 'ÂÆåÊàêÁª¥Êä§‰ªªÂä°Â§±Ë¥•', 500);\n    }\n  }\n\n  /**\n   * Ëé∑ÂèñËÆæÂ§áÁª¥Êä§ÂéÜÂè≤\n   */\n  async getDeviceMaintenanceHistory(req, res) {\n    try {\n      const { deviceId } = req.params;\n      const { page = 1, limit = 20, maintenanceType, status } = req.query;\n\n      const filters = { deviceId };\n      if (maintenanceType) {filters.maintenanceType = maintenanceType;}\n      if (status) {filters.status = status;}\n\n      const offset = (page - 1) * limit;\n      const history = await MaintenanceRecord.findWithPagination(filters, offset, parseInt(limit));\n      const total = await MaintenanceRecord.countDocuments(filters);\n\n      return this.success(res, 'Ëé∑ÂèñËÆæÂ§áÁª¥Êä§ÂéÜÂè≤ÊàêÂäü', {\n        data: history,\n        pagination: {\n          page: parseInt(page),\n          limit: parseInt(limit),\n          total,\n          pages: Math.ceil(total / limit)\n        }\n      });\n    } catch (error) {\n      logger.error('Ëé∑ÂèñËÆæÂ§áÁª¥Êä§ÂéÜÂè≤ÈîôËØØ:', error);\n      return this.error(res, 'Ëé∑ÂèñËÆæÂ§áÁª¥Êä§ÂéÜÂè≤Â§±Ë¥•', 500);\n    }\n  }\n\n  /**\n   * ÂØºÂá∫Áª¥Êä§ËÆ∞ÂΩï\n   */\n  async exportMaintenanceRecords(req, res) {\n    try {\n      const { startDate, endDate, deviceId, maintenanceType, status } = req.query;\n\n      const filters = {};\n      if (deviceId) {filters.deviceId = deviceId;}\n      if (maintenanceType) {filters.maintenanceType = maintenanceType;}\n      if (status) {filters.status = status;}\n      if (startDate || endDate) {\n        filters.scheduledDate = {};\n        if (startDate) {filters.scheduledDate.$gte = new Date(startDate);}\n        if (endDate) {filters.scheduledDate.$lte = new Date(endDate);}\n      }\n\n      const csvData = await MaintenanceRecord.exportToCSV(filters);\n\n      res.setHeader('Content-Type', 'text/csv');\n      res.setHeader('Content-Disposition', 'attachment; filename=maintenance-records.csv');\n      res.send(csvData);\n    } catch (error) {\n      logger.error('ÂØºÂá∫Áª¥Êä§ËÆ∞ÂΩïÈîôËØØ:', error);\n      return this.error(res, 'ÂØºÂá∫Áª¥Êä§ËÆ∞ÂΩïÂ§±Ë¥•', 500);\n    }\n  }\n}\n\nexport default new MaintenanceController();\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/interfaces/http/deviceController.js","messages":[{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 200.","line":29,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":29,"endColumn":19},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 404.","line":52,"column":25,"nodeType":"Literal","messageId":"noMagic","endLine":52,"endColumn":28},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 200.","line":61,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":61,"endColumn":19},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":63,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":63,"endColumn":19},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":79,"column":25,"nodeType":"Literal","messageId":"noMagic","endLine":79,"endColumn":28},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":139,"column":27,"nodeType":"Literal","messageId":"noMagic","endLine":139,"endColumn":30},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":163,"column":27,"nodeType":"Literal","messageId":"noMagic","endLine":163,"endColumn":30},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 501.","line":167,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":167,"endColumn":21},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":173,"column":27,"nodeType":"Literal","messageId":"noMagic","endLine":173,"endColumn":30},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 501.","line":177,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":177,"endColumn":21},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 200.","line":181,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":181,"endColumn":19},{"ruleId":"no-undef","severity":2,"message":"'existingDevice' is not defined.","line":183,"column":15,"nodeType":"Identifier","messageId":"undef","endLine":183,"endColumn":29},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":200,"column":25,"nodeType":"Literal","messageId":"noMagic","endLine":200,"endColumn":28},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 404.","line":206,"column":25,"nodeType":"Literal","messageId":"noMagic","endLine":206,"endColumn":28},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":372,"column":27,"nodeType":"Literal","messageId":"noMagic","endLine":372,"endColumn":30},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 501.","line":376,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":376,"endColumn":21},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":386,"column":27,"nodeType":"Literal","messageId":"noMagic","endLine":386,"endColumn":30},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 501.","line":390,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":390,"endColumn":21},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 201.","line":394,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":394,"endColumn":19},{"ruleId":"no-undef","severity":2,"message":"'device' is not defined.","line":396,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":396,"endColumn":13},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":418,"column":25,"nodeType":"Literal","messageId":"noMagic","endLine":418,"endColumn":28},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 200.","line":422,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":422,"endColumn":19},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":427,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":427,"endColumn":19},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 404.","line":450,"column":25,"nodeType":"Literal","messageId":"noMagic","endLine":450,"endColumn":28},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 200.","line":463,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":463,"endColumn":19},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":465,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":465,"endColumn":19},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 200.","line":482,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":482,"endColumn":19},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":484,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":484,"endColumn":19},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 404.","line":508,"column":25,"nodeType":"Literal","messageId":"noMagic","endLine":508,"endColumn":28},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":517,"column":25,"nodeType":"Literal","messageId":"noMagic","endLine":517,"endColumn":28},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 200.","line":536,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":536,"endColumn":19},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":544,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":544,"endColumn":19}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":30,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import Device from '../../core/entities/Device.js';\nimport StorageDevice from '../../core/entities/storageDevice.js';\nimport { validationResult } from 'express-validator';\nimport db, { dbPromise } from '../../infrastructure/database/index.js';\n\n/**\n * Ëé∑ÂèñËÆæÂ§áÂàóË°®ÔºåÊîØÊåÅÈÄöËøáÊü•ËØ¢ÂèÇÊï∞ËøõË°åËøáÊª§\n * @param {object} req - Express ËØ∑Ê±ÇÂØπË±°\n * @param {object} res - Express ÂìçÂ∫îÂØπË±°\n * @param {function} next - Express next ‰∏≠Èó¥‰ª∂ÂáΩÊï∞\n */\nexport const getDevices = async (req, res, next) => {\n  try {\n    const db = await dbPromise;\n    // Âü∫Á°ÄÊü•ËØ¢ËØ≠Âè•\n    let sql = 'SELECT * FROM devices';\n    const params = [];\n    const conditions = [];\n\n    // (ÂèØÈÄâ) ËøôÈáåÂèØ‰ª•Ê†πÊçÆ req.query Ê∑ªÂä†ËøáÊª§Êù°‰ª∂\n    // ‰æãÂ¶Ç: if (req.query.status) { ... }\n\n    if (conditions.length > 0) {\n      sql += ` WHERE ${conditions.join(' AND ')}`;\n    }\n\n    const devices = await db.raw(sql, params);\n\n    res.status(200).json({\n      message: 'ËÆæÂ§áÂàóË°®Ëé∑ÂèñÊàêÂäü',\n      data: devices\n    });\n  } catch (error) {\n    // --- ËøôÊòØÂÖ≥ÈîÆÁöÑ‰øÆÂ§ç ---\n    // Êàë‰ª¨‰∏çÂÜçÁõ¥Êé•ÂìçÂ∫îÔºåËÄåÊòØË∞ÉÁî® next(error)\n    // Â∞ÜÈîôËØØ‰º†ÈÄíÁªôÂú® index.js ‰∏≠Ê≥®ÂÜåÁöÑÂÖ®Â±ÄÈîôËØØÂ§ÑÁêÜÂô®ËøõË°åËÆ∞ÂΩï„ÄÇ\n    next(error);\n  }\n};\n\n/**\n * Ê†πÊçÆIDËé∑ÂèñËÆæÂ§á\n * @param {Object} req - ËØ∑Ê±ÇÂØπË±°\n * @param {Object} res - ÂìçÂ∫îÂØπË±°\n */\nexport const getDeviceById = async (req, res) => {\n  try {\n    const { id } = req.params;\n    const device = await Device.findById(id);\n\n    if (!device) {\n      return res.status(404).json({ message: 'ËÆæÂ§á‰∏çÂ≠òÂú®' });\n    }\n\n    // Â¶ÇÊûúÊòØÂÇ®ËÉΩËÆæÂ§áÔºåËé∑ÂèñÂØπÂ∫îÁöÑÂÇ®ËÉΩÂèÇÊï∞\n    if (device.type === 'energy_storage') {\n      const storageParams = await StorageDevice.findByDeviceId(device.id);\n      device.storage_params = storageParams;\n    }\n\n    res.status(200).json(device);\n  } catch (error) {\n    res.status(500).json({\n      message: 'Ëé∑ÂèñËÆæÂ§áËØ¶ÊÉÖÂ§±Ë¥•',\n      error: error.message\n    });\n  }\n};\n\n/**\n * ÂàõÂª∫Êñ∞ËÆæÂ§á\n * @param {Object} req - ËØ∑Ê±ÇÂØπË±°\n * @param {Object} res - ÂìçÂ∫îÂØπË±°\n */\nexport const createDevice = async (req, res, next) => {\n  try {\n    const errors = validationResult(req);\n    if (!errors.isEmpty()) {\n      return res.status(400).json({ errors: errors.array() });\n    }\n\n    // ÊèêÂèñÂπ∂Ê∏ÖÊ¥óËÆæÂ§áÂü∫Êú¨‰ø°ÊÅØ\n    const {\n      name,\n      type,\n      location,\n      status,\n      manufacturer,\n      model,\n      serial_number,\n      installation_date,\n      last_maintenance_date,\n      notes,\n      energy_storage_params,\n      solar_panel_params,\n      ev_charger_params\n    } = req.body;\n\n    const deviceData = {\n      name: String(name).trim(),\n      type: String(type).trim(),\n      location: String(location).trim(),\n      status: String(status).trim(),\n      manufacturer: String(manufacturer).trim(),\n      model: String(model).trim(),\n      serial_number: String(serial_number).trim(),\n      installation_date: installation_date ? new Date(installation_date).toISOString() : null,\n      last_maintenance_date: last_maintenance_date\n        ? new Date(last_maintenance_date).toISOString()\n        : null,\n      notes: notes ? String(notes).trim() : null\n    };\n\n    const device = await Device.create(deviceData);\n\n    // Ê†πÊçÆËÆæÂ§áÁ±ªÂûãÂ§ÑÁêÜ‰∏çÂêåÁöÑÂèÇÊï∞\n    if (device.type === 'energy_storage' && energy_storage_params) {\n      // È™åËØÅÂÇ®ËÉΩËÆæÂ§áÂèÇÊï∞\n      const {\n        capacity,\n        efficiency,\n        min_soc,\n        max_soc,\n        charge_rate,\n        discharge_rate,\n        battery_type,\n        cycle_life\n      } = energy_storage_params;\n      if (\n        !capacity ||\n        !efficiency ||\n        !min_soc ||\n        !max_soc ||\n        !charge_rate ||\n        !discharge_rate ||\n        !battery_type ||\n        !cycle_life\n      ) {\n        return res.status(400).json({ message: 'ÂÇ®ËÉΩËÆæÂ§áÂèÇÊï∞‰∏çÂÆåÊï¥' });\n      }\n      const storageParams = {\n        device_id: device.id,\n        capacity: Number(capacity),\n        efficiency: Number(efficiency),\n        min_soc: Number(min_soc),\n        max_soc: Number(max_soc),\n        charge_rate: Number(charge_rate),\n        discharge_rate: Number(discharge_rate),\n        battery_type: String(battery_type).trim(),\n        cycle_life: Number(cycle_life)\n      };\n      await StorageDevice.create(storageParams);\n    } else if (device.type === 'solar_panel' && solar_panel_params) {\n      // È™åËØÅÂ§™Èò≥ËÉΩÊùøÂèÇÊï∞\n      const {\n        peak_power,\n        efficiency,\n        orientation,\n        tilt_angle,\n        installation_date: spInstallationDate\n      } = solar_panel_params;\n      if (!peak_power || !efficiency || !orientation || !tilt_angle || !spInstallationDate) {\n        return res.status(400).json({ message: 'Â§™Èò≥ËÉΩÊùøÂèÇÊï∞‰∏çÂÆåÊï¥' });\n      }\n      // ÂÅáËÆæÊúâ‰∏Ä‰∏™ SolarPanel Ê®°Âûã\n      // await SolarPanel.create({ device_id: device.id, ...solar_panel_params });\n      res.status(501).json({ message: 'Â§™Èò≥ËÉΩÊùøÂèÇÊï∞ÈÖçÁΩÆÂäüËÉΩÂæÖÂÆûÁé∞' });\n      return;\n    } else if (device.type === 'ev_charger' && ev_charger_params) {\n      // È™åËØÅÁîµÂä®Ê±ΩËΩ¶ÂÖÖÁîµÊ°©ÂèÇÊï∞\n      const { max_power, connector_type, num_ports, charging_standards } = ev_charger_params;\n      if (!max_power || !connector_type || !num_ports || !charging_standards) {\n        return res.status(400).json({ message: 'ÁîµÂä®Ê±ΩËΩ¶ÂÖÖÁîµÊ°©ÂèÇÊï∞‰∏çÂÆåÊï¥' });\n      }\n      // ÂÅáËÆæÊúâ‰∏Ä‰∏™ EvCharger Ê®°Âûã\n      // await EvCharger.create({ device_id: device.id, ...ev_charger_params });\n      res.status(501).json({ message: 'ÁîµÂä®Ê±ΩËΩ¶ÂÖÖÁîµÊ°©ÂèÇÊï∞ÈÖçÁΩÆÂäüËÉΩÂæÖÂÆûÁé∞' });\n      return;\n    }\n\n    res.status(200).json({\n      message: 'ËÆæÂ§áÊõ¥Êñ∞ÊàêÂäü',\n      device: existingDevice\n    });\n  } catch (error) {\n    next(error);\n  }\n};\n\n/**\n * Êõ¥Êñ∞ËÆæÂ§á‰ø°ÊÅØ\n * @param {Object} req - ËØ∑Ê±ÇÂØπË±°\n * @param {Object} res - ÂìçÂ∫îÂØπË±°\n */\nexport const updateDevice = async (req, res, next) => {\n  try {\n    const { id } = req.params;\n    const errors = validationResult(req);\n    if (!errors.isEmpty()) {\n      return res.status(400).json({ errors: errors.array() });\n    }\n\n    // Ê£ÄÊü•ËÆæÂ§áÊòØÂê¶Â≠òÂú®\n    const existingDevice = await Device.findById(id);\n    if (!existingDevice) {\n      return res.status(404).json({ message: 'ËÆæÂ§á‰∏çÂ≠òÂú®' });\n    }\n\n    // ÊèêÂèñÂπ∂Ê∏ÖÊ¥óËÆæÂ§áÂü∫Êú¨‰ø°ÊÅØ\n    const {\n      name,\n      type,\n      location,\n      status,\n      manufacturer,\n      model,\n      serial_number,\n      installation_date,\n      last_maintenance_date,\n      notes,\n      energy_storage_params,\n      solar_panel_params,\n      ev_charger_params\n    } = req.body;\n\n    const updates = {};\n    if (name !== undefined) {\n      updates.name = String(name).trim();\n    }\n    // Â¶ÇÊûúËÆæÂ§áÁ±ªÂûãÂèëÁîüÂèòÂåñÔºåÈúÄË¶ÅÁâπÂà´Â§ÑÁêÜÔºåÂèØËÉΩÈúÄË¶ÅÂà†Èô§ÊóßÁöÑÂèÇÊï∞ËÆ∞ÂΩïÂπ∂ÂàõÂª∫Êñ∞ÁöÑ\n    if (type !== undefined && type !== existingDevice.type) {\n      updates.type = String(type).trim();\n      // ËøôÈáåÂèØ‰ª•Ê∑ªÂä†ÈÄªËæëÊù•Âà†Èô§ÊóßÁöÑÁâπÂÆöÁ±ªÂûãÂèÇÊï∞ËÆ∞ÂΩï\n      // ‰æãÂ¶ÇÔºöif (existingDevice.type === 'energy_storage') { await StorageDevice.deleteByDeviceId(id); }\n    } else if (type !== undefined) {\n      updates.type = String(type).trim();\n    }\n    if (location !== undefined) {\n      updates.location = String(location).trim();\n    }\n    if (status !== undefined) {\n      updates.status = String(status).trim();\n    }\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (manufacturer !== undefined) {\n      updates.manufacturer = String(manufacturer).trim();\n    }\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (model !== undefined) {\n      updates.model = String(model).trim();\n    }\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (serial_number !== undefined) {\n      updates.serial_number = String(serial_number).trim();\n    }\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (installation_date !== undefined) {\n      updates.installation_date = installation_date\n        ? new Date(installation_date).toISOString()\n        : null;\n    }\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (last_maintenance_date !== undefined) {\n      updates.last_maintenance_date = last_maintenance_date\n        ? new Date(last_maintenance_date).toISOString()\n        : null;\n    }\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (notes !== undefined) {\n      updates.notes = notes ? String(notes).trim() : null;\n    }\n\n    const _updatedDevice = await Device.update(id, updates);\n\n    // Ê†πÊçÆËÆæÂ§áÁ±ªÂûãÂ§ÑÁêÜ‰∏çÂêåÁöÑÂèÇÊï∞Êõ¥Êñ∞\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (existingDevice.type === 'energy_storage' && energy_storage_params) {\n      const storageUpdates = {};\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      if (energy_storage_params.capacity !== undefined) {\n        storageUpdates.capacity = Number(energy_storage_params.capacity);\n      }\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      if (energy_storage_params.efficiency !== undefined) {\n        storageUpdates.efficiency = Number(energy_storage_params.efficiency);\n      }\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      if (energy_storage_params.min_soc !== undefined) {\n        storageUpdates.min_soc = Number(energy_storage_params.min_soc);\n      }\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      if (energy_storage_params.max_soc !== undefined) {\n        storageUpdates.max_soc = Number(energy_storage_params.max_soc);\n      }\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      if (energy_storage_params.charge_rate !== undefined) {\n        storageUpdates.charge_rate = Number(energy_storage_params.charge_rate);\n      }\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      if (energy_storage_params.discharge_rate !== undefined) {\n        storageUpdates.discharge_rate = Number(energy_storage_params.discharge_rate);\n      }\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      if (energy_storage_params.battery_type !== undefined) {\n        storageUpdates.battery_type = String(energy_storage_params.battery_type).trim();\n      }\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      if (energy_storage_params.cycle_life !== undefined) {\n        storageUpdates.cycle_life = Number(energy_storage_params.cycle_life);\n      }\n\n      await StorageDevice.updateByDeviceId(id, storageUpdates);\n    } else if (existingDevice.type === 'solar_panel' && solar_panel_params) {\n      // È™åËØÅÂ§™Èò≥ËÉΩÊùøÂèÇÊï∞\n      const {\n        peak_power,\n        efficiency,\n        orientation,\n        tilt_angle,\n        installation_date: spInstallationDate\n      } = solar_panel_params;\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      if (!peak_power || !efficiency || !orientation || !tilt_angle || !spInstallationDate) {\n        return res.status(400).json({ message: 'Â§™Èò≥ËÉΩÊùøÂèÇÊï∞‰∏çÂÆåÊï¥' });\n      }\n      // ÂÅáËÆæÊúâ‰∏Ä‰∏™ SolarPanel Ê®°Âûã\n      // await SolarPanel.updateByDeviceId(id, solar_panel_params);\n      res.status(501).json({ message: 'Â§™Èò≥ËÉΩÊùøÂèÇÊï∞ÈÖçÁΩÆÂäüËÉΩÂæÖÂÆûÁé∞' });\n      return;\n    } else if (existingDevice.type === 'ev_charger' && ev_charger_params) {\n      // È™åËØÅÁîµÂä®Ê±ΩËΩ¶ÂÖÖÁîµÊ°©ÂèÇÊï∞\n      const { max_power, connector_type, num_ports, charging_standards } = ev_charger_params;\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n      if (!max_power || !connector_type || !num_ports || !charging_standards) {\n        return res.status(400).json({ message: 'ÁîµÂä®Ê±ΩËΩ¶ÂÖÖÁîµÊ°©ÂèÇÊï∞‰∏çÂÆåÊï¥' });\n      }\n      // ÂÅáËÆæÊúâ‰∏Ä‰∏™ EvCharger Ê®°Âûã\n      // await EvCharger.updateByDeviceId(id, ev_charger_params);\n      res.status(501).json({ message: 'ÁîµÂä®Ê±ΩËΩ¶ÂÖÖÁîµÊ°©ÂèÇÊï∞ÈÖçÁΩÆÂäüËÉΩÂæÖÂÆûÁé∞' });\n      return;\n    }\n\n    res.status(201).json({\n      message: 'ËÆæÂ§áÂàõÂª∫ÊàêÂäü',\n      device\n    });\n  } catch (error) {\n    next(error);\n  }\n};\n\n/**\n * Êõ¥Êñ∞ËÆæÂ§áÁä∂ÊÄÅ\n * @param {Object} req - ËØ∑Ê±ÇÂØπË±°\n * @param {Object} res - ÂìçÂ∫îÂØπË±°\n */\nexport const updateDeviceStatus = async (req, res) => {\n  try {\n    const { id } = req.params;\n    const { status } = req.body;\n\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (!status) {\n      return res.status(400).json({ message: 'Áä∂ÊÄÅÂèÇÊï∞‰∏çËÉΩ‰∏∫Á©∫' });\n    }\n\n    const updatedDevice = await Device.updateStatus(id, status);\n    res.status(200).json({\n      message: 'ËÆæÂ§áÁä∂ÊÄÅÊõ¥Êñ∞ÊàêÂäü',\n      device: updatedDevice\n    });\n  } catch (error) {\n    res.status(500).json({\n      message: 'Êõ¥Êñ∞ËÆæÂ§áÁä∂ÊÄÅÂ§±Ë¥•',\n      error: error.message\n    });\n  }\n};\n\n/**\n * Âà†Èô§ËÆæÂ§á\n * @param {Object} req - ËØ∑Ê±ÇÂØπË±°\n * @param {Object} res - ÂìçÂ∫îÂØπË±°\n */\nexport const deleteDevice = async (req, res) => {\n  try {\n    const { id } = req.params;\n\n    // Ê£ÄÊü•ËÆæÂ§áÊòØÂê¶Â≠òÂú®\n    const existingDevice = await Device.findById(id);\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (!existingDevice) {\n      return res.status(404).json({ message: 'ËÆæÂ§á‰∏çÂ≠òÂú®' });\n    }\n\n    // Â¶ÇÊûúÊòØÂÇ®ËÉΩËÆæÂ§áÔºåÂêåÊó∂Âà†Èô§ÂØπÂ∫îÁöÑÂÇ®ËÉΩÂèÇÊï∞ËÆ∞ÂΩï\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (existingDevice.type === 'energy_storage') {\n      await StorageDevice.deleteByDeviceId(id);\n    }\n\n    await Device.delete(id);\n    res.status(200).json({ message: 'ËÆæÂ§áÂà†Èô§ÊàêÂäü' });\n  } catch (error) {\n    res.status(500).json({\n      message: 'Âà†Èô§ËÆæÂ§áÂ§±Ë¥•',\n      error: error.message\n    });\n  }\n};\n\n/**\n * Ëé∑ÂèñÂÇ®ËÉΩËÆæÂ§áÂàóË°®\n * @param {Object} req - ËØ∑Ê±ÇÂØπË±°\n * @param {Object} res - ÂìçÂ∫îÂØπË±°\n */\nexport const getEnergyStorageDevices = async (req, res) => {\n  try {\n    const devices = await Device.findAll({\n      type: 'energy_storage'\n    });\n    res.status(200).json(devices);\n  } catch (error) {\n    res.status(500).json({\n      message: 'Ëé∑ÂèñÂÇ®ËÉΩËÆæÂ§áÂàóË°®Â§±Ë¥•',\n      error: error.message\n    });\n  }\n};\n\n/**\n * Êõ¥Êñ∞ÂÇ®ËÉΩËÆæÂ§áÂèÇÊï∞\n * @param {Object} req - ËØ∑Ê±ÇÂØπË±°\n * @param {Object} res - ÂìçÂ∫îÂØπË±°\n */\nexport const updateStorageDeviceParams = async (req, res) => {\n  try {\n    const { id } = req.params;\n    const { capacity, efficiency, min_soc, max_soc } = req.body;\n\n    // Ê£ÄÊü•ËÆæÂ§áÊòØÂê¶Â≠òÂú®\n    const existingDevice = await Device.findById(id);\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (!existingDevice) {\n      return res.status(404).json({ message: 'ËÆæÂ§á‰∏çÂ≠òÂú®' });\n    }\n\n    // Ê£ÄÊü•ËÆæÂ§áÁ±ªÂûãÊòØÂê¶‰∏∫ÂÇ®ËÉΩËÆæÂ§á\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (existingDevice.type !== 'energy_storage') {\n      return res.status(400).json({ message: 'ËØ•ËÆæÂ§á‰∏çÊòØÂÇ®ËÉΩËÆæÂ§á' });\n    }\n\n    // Êõ¥Êñ∞ÂÇ®ËÉΩËÆæÂ§áÁâπÂÆöÂèÇÊï∞\n    const storageParams = {\n      capacity,\n      efficiency,\n      min_soc,\n      max_soc,\n      updated_at: new Date().toISOString()\n    };\n\n    // ËøôÈáåÂÅáËÆæÊï∞ÊçÆÂ∫ì‰∏≠Êúâ‰∏Ä‰∏™storage_devicesË°®Â≠òÂÇ®ÂÇ®ËÉΩËÆæÂ§áÂèÇÊï∞\n    await db('storage_devices').where({ device_id: id }).update(storageParams);\n\n    // ËøîÂõûÊõ¥Êñ∞ÂêéÁöÑÂÆåÊï¥ËÆæÂ§á‰ø°ÊÅØ\n    const updatedDevice = await Device.findById(id);\n    const deviceParams = await db('storage_devices').where({ device_id: id }).first();\n\n    res.status(200).json({\n      message: 'ÂÇ®ËÉΩËÆæÂ§áÂèÇÊï∞Êõ¥Êñ∞ÊàêÂäü',\n      device: {\n        ...updatedDevice,\n        params: deviceParams\n      }\n    });\n  } catch (error) {\n    res.status(500).json({\n      message: 'Êõ¥Êñ∞ÂÇ®ËÉΩËÆæÂ§áÂèÇÊï∞Â§±Ë¥•',\n      error: error.message\n    });\n  }\n};\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/interfaces/http/index.js","messages":[{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 16.","line":4,"column":29,"nodeType":"Literal","messageId":"noMagic","endLine":4,"endColumn":31},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":146,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":146,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[3876,3916],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":147,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":147,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[3921,4002],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":148,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":148,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[4007,4084],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":149,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":149,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[4089,4172],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":150,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":150,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[4177,4289],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":153,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":153,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[4294,4336],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 16.","line":201,"column":63,"nodeType":"Literal","messageId":"noMagic","endLine":201,"endColumn":65},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 8.","line":201,"column":77,"nodeType":"Literal","messageId":"noMagic","endLine":201,"endColumn":78},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":396,"column":23,"nodeType":"Literal","messageId":"noMagic","endLine":396,"endColumn":26},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":430,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":430,"endColumn":19},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":474,"column":23,"nodeType":"Literal","messageId":"noMagic","endLine":474,"endColumn":26},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":488,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":488,"endColumn":19},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":571,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":571,"endColumn":14,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[14015,14067],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":576,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":576,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[14170,14219],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":580,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":580,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[14359,14419],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":586,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":586,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[14530,14573],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":590,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":590,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[14615,14665],"text":""},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":18,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import crypto from 'crypto';\n// ÂÆâÂÖ®ÈöèÊú∫Êï∞ÁîüÊàêÂáΩÊï∞\nfunction _generateSecureRandom() {\n  return crypto.randomBytes(16).toString('hex');\n}\n\nimport express from 'express';\nimport http from 'http';\nimport https from 'https';\nimport WebSocket from 'ws';\nimport helmet from 'helmet';\nimport rateLimit from 'express-rate-limit';\nimport cors from 'cors';\nimport fs from 'fs';\nimport path from 'path';\nimport { fileURLToPath } from 'url';\nimport { createRequire } from 'module';\nimport { body as _body } from 'express-validator';\n// import session from 'express-session';\n// import connectRedis from 'connect-redis';\n// import csurf from 'csurf';\n\n// ÂØºÂÖ•ÈÖçÁΩÆÁÆ°ÁêÜ\nimport config, { isDevelopment } from '../../shared/config/index.js';\n\n// ÂØºÂÖ•ÈîôËØØÂ§ÑÁêÜ\n// import { setupProcessHandlers } from '../../shared/utils/processHandlers.js';\n\n// ÂØºÂÖ•Áªü‰∏ÄÈîôËØØÂ§ÑÁêÜÂíåÈ™åËØÅ‰∏≠Èó¥‰ª∂\nimport {\n  errorHandler as unifiedErrorHandler,\n  asyncHandler as _asyncHandler,\n  notFoundHandler as unifiedNotFoundHandler\n} from '../../shared/middleware/errorHandler.js';\nimport {\n  sanitizeInput\n} from '../../shared/middleware/validation.js';\nimport { CacheManager } from '../../shared/cache/CacheManager.js';\n\n// ÂØºÂÖ•ÂÆâÂÖ®ÂíåÊÄßËÉΩÁõëÊéß‰∏≠Èó¥‰ª∂\nimport {\n  securityHeaders,\n  inputSizeLimit,\n  requestId\n} from '../../shared/middleware/security.js';\nimport {\n  performanceMiddleware,\n  healthCheckEndpoint,\n  metricsApiEndpoint\n} from '../../shared/middleware/performance.js';\n\n// ÂØºÂÖ•Êó•ÂøóÊ®°Âùó\nimport logger, { requestLogger, auditLogger } from '../../shared/utils/logger.js';\n\n// ÂØºÂÖ•JWTËÆ§ËØÅ\nimport { authenticateToken } from '../../core/services/jwtManager.js';\n\n// ÂØºÂÖ•RedisÂÆ¢Êà∑Á´Ø\n// import redisClient from '../../database/redisClient.js';\n\nconst require = createRequire(import.meta.url);\nconst mqtt = require('mqtt');\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\n\n// ÂØºÂÖ•Êï∞ÊçÆÂ∫ì\nimport dbPromise from '../../infrastructure/database/index.js';\n\n// ÂØºÂÖ•Á¢≥ÊéíÊîæËÆ°ÁÆóÊ®°Âùó\nimport { calculateTotalEmissions } from '../../core/services/emission.js';\n\n// ÂØºÂÖ•Êï∞ÊçÆÈááÈõÜÂô®\nimport DataCollector from '../../core/services/DataCollector.js';\n\n// ÂØºÂÖ•APIË∑ØÁî±\nimport apiRoutes from './routes.js';\n\n// ÂàõÂª∫ExpressÂ∫îÁî®\nconst app = express();\n\n// Ê†πÊçÆÈÖçÁΩÆÂàõÂª∫HTTPÊàñHTTPSÊúçÂä°Âô®\nlet server;\nif (config.security?.https?.enabled) {\n  try {\n    const privateKey = fs.readFileSync(config.security.https.keyPath, 'utf8');\n    const certificate = fs.readFileSync(config.security.https.certPath, 'utf8');\n    const credentials = { key: privateKey, cert: certificate };\n    server = https.createServer(credentials, app);\n    logger.info('HTTPSÊúçÂä°Âô®Â∑≤ÂêØÁî®');\n  } catch (error) {\n    logger.error('HTTPSÈÖçÁΩÆÈîôËØØÔºåÂ∞ÜÂõûÈÄÄÂà∞HTTP', { error: error.message });\n    server = http.createServer(app);\n  }\n} else {\n  server = http.createServer(app);\n}\n\n// ËÆæÁΩÆËøõÁ®ãÂºÇÂ∏∏Â§ÑÁêÜ\n// setupProcessHandlers();\n\n// ÂàùÂßãÂåñÊï∞ÊçÆÈááÈõÜÂô®Ôºà‰ΩÜ‰∏çÁ´ãÂç≥ÂêØÂä®Ôºâ\nconst dataCollector = new DataCollector({\n  brokerUrl: config.mqtt?.brokerUrl || 'mqtt://localhost:1883',\n  username: config.mqtt?.username || '',\n  password: config.mqtt?.password || ''\n});\n\n// ÂàùÂßãÂåñÁºìÂ≠òÁÆ°ÁêÜÂô®\nconst _cacheManager = new CacheManager({\n  type: 'memory', // ‰ΩøÁî®ÂÜÖÂ≠òÁºìÂ≠òÔºåÈÅøÂÖçRedis‰æùËµñÈóÆÈ¢ò\n  defaultTTL: 300, // 5ÂàÜÈíüÈªòËÆ§ËøáÊúüÊó∂Èó¥\n  maxSize: 1000 // ÊúÄÂ§ßÁºìÂ≠òÊù°ÁõÆÊï∞\n});\n\n// Á≠âÂæÖÊï∞ÊçÆÂ∫ìÂàùÂßãÂåñÂÆåÊàêÂêéÂÜçÂêØÂä®Êï∞ÊçÆÈááÈõÜÂô®\n\n// TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 30 Ë°å)\n\n// TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 30 Ë°å)\n\n// TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 30 Ë°å)\n\n// TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 30 Ë°å)\n\nserver.listen(config.app.port, config.app.host, () => {\n  const protocol = config.security?.https?.enabled ? 'https' : 'http';\n  logger.info(\n    `ÊúçÂä°Âô®Â∑≤ÂêØÂä®ÔºåÁõëÂê¨ ${protocol}://${config.app.host}:${config.app.port}ÔºåÁ≠âÂæÖÊï∞ÊçÆÂ∫ìËøûÊé•...`,\n    {\n      port: config.app.port,\n      host: config.app.host,\n      protocol,\n      environment: config.app.env,\n      nodeVersion: process.version,\n      pid: process.pid\n    }\n  );\n  auditLogger.info('ÊúçÂä°Âô®ÂêØÂä®', {\n    action: 'SERVER_START',\n    target: 'Server',\n    details: `ÊúçÂä°Âô®Â∑≤Âú® ${protocol}://${config.app.host}:${config.app.port} ÂêØÂä®`\n  });\n\n  if (isDevelopment()) {\n    console.log('\\nüöÄ Èõ∂Á¢≥Âõ≠Âå∫Êï∞Â≠óÂ≠™ÁîüËÉΩÁ¢≥ÁÆ°ÁêÜÁ≥ªÁªüÂêØÂä®ÊàêÂäü!');\n    console.log(`üìä APIÊúçÂä°: ${protocol}://${config.app.host}:${config.app.port}/api`);\n    console.log(`üí¨ WebSocketÊúçÂä°: ws://${config.app.host}:${config.app.port}/ws`);\n    console.log(`üíö ÂÅ•Â∫∑Ê£ÄÊü•: ${protocol}://${config.app.host}:${config.app.port}/health`);\n    console.log(\n      `üìà ÊÄßËÉΩÁõëÊéß: ${protocol}://${config.app.host}:${config.app.port}/api/performance/metrics`\n    );\n    console.log(`üîß ÁéØÂ¢É: ${config.app.env}\\n`);\n  }\n});\n\ndbPromise\n  .then(() => {\n    logger.info('Êï∞ÊçÆÂ∫ìËøûÊé•ÊàêÂäüÔºåÂêØÂä®Êï∞ÊçÆÈááÈõÜÂô®');\n    return dataCollector.initialize();\n  })\n  .catch((error) => {\n    logger.error('Êï∞ÊçÆÂ∫ìËøûÊé•Â§±Ë¥•', { error: error.message });\n    process.exit(1);\n  });\n\n// ÁõëÂê¨ËøõÁ®ãÈÄÄÂá∫‰∫ã‰ª∂ÔºåËÆ∞ÂΩïÂÆ°ËÆ°Êó•Âøó\nprocess.on('exit', (code) => {\n  auditLogger.info('ÊúçÂä°Âô®ÂÖ≥Èó≠', {\n    action: 'SERVER_SHUTDOWN',\n    target: 'Server',\n    details: `ÊúçÂä°Âô®Â∑≤ÂÖ≥Èó≠ÔºåÈÄÄÂá∫Á†Å: ${code}`\n  });\n});\n\nprocess.on('SIGINT', () => {\n  logger.info('Êé•Êî∂Âà∞ SIGINT ‰ø°Âè∑ÔºåÊ≠£Âú®ÂÖ≥Èó≠ÊúçÂä°Âô®...');\n  server.close(() => {\n    logger.info('ÊúçÂä°Âô®Â∑≤‰ºòÈõÖÂÖ≥Èó≠');\n    process.exit(0);\n  });\n});\n\nprocess.on('SIGTERM', () => {\n  logger.info('Êé•Êî∂Âà∞ SIGTERM ‰ø°Âè∑ÔºåÊ≠£Âú®ÂÖ≥Èó≠ÊúçÂä°Âô®...');\n  server.close(() => {\n    logger.info('ÊúçÂä°Âô®Â∑≤‰ºòÈõÖÂÖ≥Èó≠');\n    process.exit(0);\n  });\n});\n\n// ËßíËâ≤ÂÆö‰πâ\nconst _roles = {\n  ADMIN: 'admin',\n  ENERGY_MANAGER: 'energy_manager',\n  VIEWER: 'viewer'\n};\n\n// ÂÆûÊó∂Êï∞ÊçÆÈááÈõÜÈÖçÁΩÆ\nconst mqttClient = mqtt.connect(config.mqtt.brokerUrl, {\n  clientId: `${config.mqtt.clientId}-${Math.random().toString(16).substr(2, 8)}`,\n  username: config.mqtt.username,\n  password: config.mqtt.password,\n  clean: true,\n  keepalive: config.mqtt.keepalive,\n  connectTimeout: config.mqtt.connectTimeout,\n  reconnectPeriod: config.mqtt.reconnectPeriod\n});\n\n// ËøûÊé•ÊàêÂäüÂõûË∞É\nmqttClient.on('connect', () => {\n  logger.info('Â∑≤ËøûÊé•Âà∞MQTT Broker', { brokerUrl: config.mqtt.brokerUrl });\n\n  // ËÆ¢ÈòÖËÉΩÊ∫êÊï∞ÊçÆ‰∏ªÈ¢ò\n  mqttClient.subscribe(config.mqtt.topics.energyData, (err) => {\n    if (err) {\n      logger.error('MQTTËÉΩÊ∫êÊï∞ÊçÆ‰∏ªÈ¢òËÆ¢ÈòÖÂ§±Ë¥•', {\n        error: err.message,\n        topic: config.mqtt.topics.energyData\n      });\n    } else {\n      logger.info('Â∑≤ËÆ¢ÈòÖMQTT‰∏ªÈ¢ò', { topic: config.mqtt.topics.energyData });\n    }\n  });\n});\n\n// MQTTÈîôËØØÂ§ÑÁêÜ\nmqttClient.on('error', (error) => {\n  logger.error('MQTTËøûÊé•ÈîôËØØ', { error: error.message });\n});\n\n// MQTTÊ∂àÊÅØÂ§ÑÁêÜÁé∞Âú®Áî±DataCollectorÂ§ÑÁêÜ\n\n// ‰ø°‰ªª‰ª£ÁêÜÔºàÂ¶ÇÊûúÂú®ÂèçÂêë‰ª£ÁêÜÂêéÈù¢Ôºâ\napp.set('trust proxy', 1);\n\n// ËØ∑Ê±ÇID‰∏≠Èó¥‰ª∂ÔºàÁî®‰∫éËØ∑Ê±ÇËøΩË∏™Ôºâ\napp.use(requestId());\n\n// ÂÆâÂÖ®Â§¥‰∏≠Èó¥‰ª∂\napp.use(securityHeaders());\n\n// ËæìÂÖ•Â§ßÂ∞èÈôêÂà∂‰∏≠Èó¥‰ª∂\napp.use(inputSizeLimit());\n\n// ËØ∑Ê±ÇÊó•Âøó‰∏≠Èó¥‰ª∂\napp.use(requestLogger());\n\n// ÊÄßËÉΩÁõëÊéß‰∏≠Èó¥‰ª∂\n\n// TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 39 Ë°å)\n\n// TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 39 Ë°å)\n\n// TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 39 Ë°å)\n\n// TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 39 Ë°å)\n\napp.use(performanceMiddleware);\n\n// ÂÆâÂÖ®‰∏≠Èó¥‰ª∂\nif (config.security.helmet.enabled) {\n  app.use(\n    helmet({\n      contentSecurityPolicy: {\n        directives: {\n          defaultSrc: [\"'self'\"],\n          scriptSrc: [\"'self'\", \"'unsafe-inline'\"],\n          styleSrc: [\"'self'\", \"'unsafe-inline'\"],\n          imgSrc: [\"'self'\", 'data:', 'https:'],\n          fontSrc: [\"'self'\", 'https://fonts.gstatic.com'],\n          connectSrc: [\n            \"'self'\",\n            'https://*.tiles.mapbox.com',\n            'ws://localhost:*',\n            'wss://localhost:*'\n          ],\n          frameSrc: [\"'self'\"],\n          objectSrc: [\"'none'\"],\n          mediaSrc: [\"'self'\"]\n        }\n      },\n      crossOriginResourcePolicy: { policy: 'cross-origin' },\n      crossOriginOpenerPolicy: { policy: 'same-origin' },\n      crossOriginEmbedderPolicy: { policy: 'require-corp' },\n      originAgentCluster: true,\n\n      dnsPrefetchControl: { allow: true },\n      expectCt: { enforce: true, maxAge: 86400 },\n      frameguard: { action: 'deny' },\n      hidePoweredBy: true,\n      hsts: { maxAge: 31536000, includeSubDomains: true, preload: true },\n      ieNoOpen: true,\n      noSniff: true,\n      permittedCrossDomainPolicies: { permittedPolicies: 'none' },\n      referrerPolicy: { policy: 'no-referrer' },\n      xssFilter: true\n    })\n  );\n}\n\n// CORSÈÖçÁΩÆ\nif (config.security.cors.enabled) {\n  app.use(\n    cors({\n      origin:\n        config.security.cors.origin === '*'\n          ? '*'\n          : config.security.cors.origin.split(',').map((s) => s.trim()),\n      methods: config.security.cors.methods.split(',').map((s) => s.trim()),\n      allowedHeaders: config.security.cors.allowedHeaders.split(',').map((s) => s.trim()),\n      exposedHeaders: config.security.cors.exposedHeaders\n        ? config.security.cors.exposedHeaders.split(',').map((s) => s.trim())\n        : [],\n      credentials: config.security.cors.credentials,\n      maxAge: config.security.cors.maxAge\n    })\n  );\n}\n\n// Âü∫Á°Ä‰∏≠Èó¥‰ª∂\napp.use(express.json({ limit: '10mb' }));\napp.use(express.urlencoded({ extended: true, limit: '10mb' }));\n\n// ‰ºöËØùÁÆ°ÁêÜ - ÊöÇÊó∂Á¶ÅÁî®Ôºå‰ΩøÁî®JWTËÆ§ËØÅ\n// const RedisStore = connectRedis(session);\n// app.use(\n//   session({\n//     store: new RedisStore({ client: redisClient }),\n//     secret: config.security.session.secret,\n//     resave: false,\n//     saveUninitialized: false,\n//     name: config.security.session.name,\n//     cookie: {\n//       secure: config.security.session.cookie.secure,\n//       httpOnly: config.security.session.cookie.httpOnly,\n//       maxAge: config.security.session.cookie.maxAge,\n//       sameSite: config.security.session.cookie.sameSite,\n//     },\n//   })\n// );\n\n// ÈÄöÁî®ËæìÂÖ•È™åËØÅÂíåÊï∞ÊçÆÊ∏ÖÊ¥ó‰∏≠Èó¥‰ª∂\napp.use((req, res, next) => {\n  // ÂØπÊâÄÊúâËØ∑Ê±ÇËøõË°åËæìÂÖ•Ê∏ÖÊ¥ó\n  if (req.body) {\n    req.body = sanitizeInput(req.body);\n  }\n  if (req.query) {\n    req.query = sanitizeInput(req.query);\n  }\n  if (req.params) {\n    req.params = sanitizeInput(req.params);\n  }\n  next();\n});\n\n// CSRF‰øùÊä§ - ÊöÇÊó∂Á¶ÅÁî®ÔºåÈúÄË¶ÅÂÆâË£ÖcsurfÂåÖ\n// if (config.security.csrf.enabled) {\n//   app.use(csurf({ cookie: true }));\n//   app.use((req, res, next) => {\n//     res.cookie('XSRF-TOKEN', req.csrfToken());\n//     next();\n//   });\n// }\n\n// ÈÖçÁΩÆÈÄüÁéáÈôêÂà∂\nif (config.security.rateLimit.enabled) {\n  const limiter = rateLimit({\n    windowMs: config.security.rateLimit.windowMs,\n    max: config.security.rateLimit.max,\n    message: config.security.rateLimit.message,\n    standardHeaders: true,\n    legacyHeaders: false,\n    skip: (req, _res) => req.method === 'OPTIONS'\n  });\n  // Â∫îÁî®ÈÄüÁéáÈôêÂà∂\n  app.use(limiter);\n}\n\n// ÂØºÂÖ•ÁºìÂ≠ò‰∏≠Èó¥‰ª∂\n// import { cacheMiddleware } from './middleware/cache.js';\n\n// Â∫îÁî®ÁºìÂ≠ò‰∏≠Èó¥‰ª∂Âà∞APIË∑ØÁî±\n// app.use('/api', cacheMiddleware()); // Â∑≤Á¶ÅÁî®ÁºìÂ≠ò‰∏≠Èó¥‰ª∂‰ª•Ëß£ÂÜ≥RedisÈîôËØØ\n\n// ‰ΩøÁî®APIË∑ØÁî±\napp.use('/api', apiRoutes);\n\n// ÂêØÂä®Á¢≥ÊéíÊîæËÆ°ÁÆóÊ®°ÂùóÁõ∏ÂÖ≥Ë∑ØÁî±\napp.get('/carbon/trend', authenticateToken(['admin', 'energy_manager']), async (req, res) => {\n  const { start_time, end_time, interval } = req.query;\n\n  // ÂèÇÊï∞È™åËØÅ\n  if (!start_time || !end_time) {\n    return res.status(400).json({\n      error: {\n        code: 'INVALID_PARAMETERS',\n        message: 'Áº∫Â∞ëÂøÖË¶ÅÂèÇÊï∞: start_time, end_time'\n      }\n    });\n  }\n\n  try {\n    // ËÆ°ÁÆóÁ¢≥ÊéíÊîæË∂ãÂäø\n    const trendData = calculateTotalEmissions(start_time, end_time, interval);\n\n    logger.info('Á¢≥ÊéíÊîæË∂ãÂäøËÆ°ÁÆóÊàêÂäü', {\n      userId: req.user.id,\n      timeRange: { start_time, end_time },\n      interval\n    });\n\n    res.json({\n      data: {\n        trend: trendData,\n        unit: 'kgCO2',\n        time_range: {\n          start: start_time,\n          end: end_time\n        }\n      }\n    });\n  } catch (error) {\n    logger.error('Á¢≥ÊéíÊîæË∂ãÂäøËÆ°ÁÆóÂ§±Ë¥•', {\n      error: error.message,\n      userId: req.user?.id,\n      timeRange: { start_time, end_time }\n    });\n    res.status(500).json({\n      error: {\n        code: 'CALCULATION_FAILED',\n        message: 'Á¢≥ÊéíÊîæË∂ãÂäøËÆ°ÁÆóÂ§±Ë¥•',\n        details: error.message\n      }\n    });\n  }\n});\n\n// JWTÈ™åËØÅ‰∏≠Èó¥‰ª∂Â∑≤ÁßªËá≥APIË∑ØÁî±Ê®°Âùó\n\n// Âü∫Á°ÄË∑ØÁî±\napp.get('/', (req, res) => {\n  res.json({\n    message: 'Èõ∂Á¢≥Âõ≠Âå∫Êï∞Â≠óÂ≠™ÁîüËÉΩÁ¢≥ÁÆ°ÁêÜÁ≥ªÁªü API v1',\n    version: config.app?.version || '1.0.0',\n    environment: config.app?.env || 'development',\n    status: 'running',\n    data_collector: dataCollector.getConnectionStatus(),\n    timestamp: new Date().toISOString()\n  });\n});\n\n// ËØªÂèñÊµãËØïÊï∞ÊçÆ\nfunction readTestData(filename) {\n  try {\n    const dataPath = path.join(__dirname, '..', 'test-data', filename);\n    if (fs.existsSync(dataPath)) {\n      return fs.readFileSync(dataPath, 'utf-8');\n    }\n    return null;\n  } catch (error) {\n    logger.error('ËØªÂèñÊµãËØïÊï∞ÊçÆÂ§±Ë¥•', { filename, error: error.message });\n    return null;\n  }\n}\n\n// ÊµãËØïÊï∞ÊçÆAPI\napp.get('/api/test-data/:type', (req, res) => {\n  const { type } = req.params;\n  const allowedTypes = ['energy', 'carbon', 'battery', 'performance'];\n\n  if (!allowedTypes.includes(type)) {\n    return res.status(400).json({\n      error: {\n        code: 'INVALID_TYPE',\n        message: '‰∏çÊîØÊåÅÁöÑÊï∞ÊçÆÁ±ªÂûã'\n      }\n    });\n  }\n\n  const data = readTestData(`${type}_data.csv`);\n  if (data) {\n    logger.info('ÊµãËØïÊï∞ÊçÆËÆøÈóÆ', { type, ip: req.ip });\n    res.header('Content-Type', 'text/csv');\n    res.send(data);\n  } else {\n    res.status(500).json({\n      error: {\n        code: 'DATA_READ_ERROR',\n        message: `Êó†Ê≥ïËØªÂèñ${type}Êï∞ÊçÆ`\n      }\n    });\n  }\n});\n\n// Á≥ªÁªüÂÅ•Â∫∑Ê£ÄÊü•Êé•Âè£ - ‰ΩøÁî®Êñ∞ÁöÑÊÄßËÉΩÁõëÊéß\n\n// TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 33 Ë°å)\n\n// TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 33 Ë°å)\n\n// TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 33 Ë°å)\n\n// TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 33 Ë°å)\n\napp.get('/health', healthCheckEndpoint);\n\n// ÊÄßËÉΩÊåáÊ†áAPIÁ´ØÁÇπ\napp.get('/api/metrics', metricsApiEndpoint);\n\n// ËØ¶ÁªÜÂÅ•Â∫∑Ê£ÄÊü•Êé•Âè£Ôºà‰øùÁïôÂéüÊúâÂäüËÉΩÔºâ\napp.get('/health/detailed', (_req, res) => {\n  const healthCheck = {\n    status: 'healthy',\n    components: {\n      database: {\n        status: 'healthy',\n        version: 'SQLite 3.45.0',\n        uptime: '99.9%'\n      },\n      storage: {\n        status: 'healthy',\n        availableSpace: '120GB',\n        usage: '35%'\n      },\n      network: {\n        status: 'healthy',\n        latency: '<5ms'\n      },\n      security: {\n        status: 'healthy',\n        tlsVersion: 'TLS 1.3',\n        certificateExpiry: '2025-12-31'\n      },\n      mqtt: {\n        status: mqttClient ? (mqttClient.connected ? 'connected' : 'disconnected') : 'unavailable',\n        broker: config.mqtt.brokerUrl\n      }\n    },\n    timestamp: new Date().toISOString()\n  };\n\n  res.json(healthCheck);\n});\n\n// ËÆæÂ§áÁÆ°ÁêÜÂíåËÉΩÊ∫êÊï∞ÊçÆË∑ØÁî±Â∑≤ÁßªËá≥APIË∑ØÁî±Ê®°Âùó\n\n// Á¢≥ÊéíÊîæËÆ°ÁÆóÂäüËÉΩÂ∑≤ÁßªËá≥Êï∞ÊçÆÈááÈõÜÂô®ÂíåAPIË∑ØÁî±Ê®°Âùó\n\n// ÂÇ®ËÉΩ‰ºòÂåñ„ÄÅÁ¢≥ÊéíÊîæËÆ°ÁÆó„ÄÅËÉΩÊ∫êÈ¢ÑÊµãÂíåÁî®Êà∑ÊùÉÈôêÁÆ°ÁêÜAPIÂ∑≤ÁßªËá≥APIË∑ØÁî±Ê®°Âùó\n\n// ÊÄßËÉΩÁõëÊéßÊ®°ÂùóÂ∑≤Âú®Êñá‰ª∂ÂºÄÂ§¥ÂØºÂÖ•ÂíåÈÖçÁΩÆ\n\n// 404ÈîôËØØÂ§ÑÁêÜ\napp.use(unifiedNotFoundHandler);\n\n// ÂÖ®Â±ÄÈîôËØØÂ§ÑÁêÜ‰∏≠Èó¥‰ª∂\napp.use(unifiedErrorHandler);\n\n// ÂêØÂä®ÊÄßËÉΩÁõëÊéß\n// ÊÄßËÉΩÁõëÊéßÂ∑≤ÈÄöËøá‰∏≠Èó¥‰ª∂ÂêØÁî®\n\n// ÂêØÂä®ÊúçÂä°\nconst _PORT = config.app.port;\n\n// WebSocket server setup\nconst wss = new WebSocket.Server({ server });\n\nwss.on('connection', (ws) => {\n  console.log('New WebSocket connection established');\n\n  ws.on('message', (message) => {\n    try {\n      const data = JSON.parse(message.toString());\n      console.log('Received WebSocket message:', data);\n      // Handle incoming message\n      ws.send(JSON.stringify({ status: 'received', timestamp: new Date() }));\n    } catch (error) {\n      console.error('Error processing WebSocket message:', error);\n      ws.send(JSON.stringify({ error: 'Invalid message format' }));\n    }\n  });\n\n  ws.on('close', () => {\n    console.log('WebSocket connection closed');\n  });\n\n  ws.on('error', (error) => {\n    console.error('WebSocket error occurred:', error);\n  });\n});\n\n// ‰ºòÈõÖÂÖ≥Èó≠Â§ÑÁêÜ\nprocess.on('SIGTERM', () => {\n  logger.info('Êî∂Âà∞SIGTERM‰ø°Âè∑ÔºåÂºÄÂßã‰ºòÈõÖÂÖ≥Èó≠');\n  gracefulShutdown();\n});\n\nprocess.on('SIGINT', () => {\n  logger.info('Êî∂Âà∞SIGINT‰ø°Âè∑ÔºåÂºÄÂßã‰ºòÈõÖÂÖ≥Èó≠');\n  gracefulShutdown();\n});\n\nfunction gracefulShutdown() {\n  server.close(() => {\n    logger.info('HTTPÊúçÂä°Âô®Â∑≤ÂÖ≥Èó≠');\n\n    // ÂÖ≥Èó≠MQTTËøûÊé•\n    if (mqttClient.connected) {\n      mqttClient.end(() => {\n        logger.info('MQTTËøûÊé•Â∑≤ÂÖ≥Èó≠');\n      });\n    }\n\n    // ÂÖ≥Èó≠Êï∞ÊçÆÂ∫ìËøûÊé•\n    dbPromise.then((db) => {\n      db.close((err) => {\n        if (err) {\n          logger.error('Êï∞ÊçÆÂ∫ìÂÖ≥Èó≠Â§±Ë¥•', { error: err.message });\n        } else {\n          logger.info('Êï∞ÊçÆÂ∫ìËøûÊé•Â∑≤ÂÖ≥Èó≠');\n        }\n        process.exit(0);\n      });\n    }).catch(() => {\n      process.exit(0);\n    });\n  });\n}\n\n// ÂØºÂá∫appÂÆû‰æã\nexport default app;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/interfaces/http/middleware/authMiddleware.js","messages":[{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 24.","line":80,"column":5,"nodeType":"Literal","messageId":"noMagic","endLine":80,"endColumn":7},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":80,"column":10,"nodeType":"Literal","messageId":"noMagic","endLine":80,"endColumn":12},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":80,"column":15,"nodeType":"Literal","messageId":"noMagic","endLine":80,"endColumn":17},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":80,"column":20,"nodeType":"Literal","messageId":"noMagic","endLine":80,"endColumn":24},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 7.","line":102,"column":33,"nodeType":"Literal","messageId":"noMagic","endLine":102,"endColumn":34},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":159,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":159,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[3414,3544],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":165,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":165,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[3582,3612],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":217,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":217,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[4837,4980],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":225,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":225,"endColumn":17,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[5049,5088],"text":""},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":283,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":283,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[6396,6510],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":289,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":289,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[6548,6580],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":312,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":312,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[7068,7199],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":323,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":323,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[7301,7331],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":334,"column":41,"nodeType":"Literal","messageId":"noMagic","endLine":334,"endColumn":45},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 30.","line":338,"column":24,"nodeType":"Literal","messageId":"noMagic","endLine":338,"endColumn":26},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":338,"column":29,"nodeType":"Literal","messageId":"noMagic","endLine":338,"endColumn":31},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":353,"column":38,"nodeType":"Literal","messageId":"noMagic","endLine":353,"endColumn":41},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 15.","line":353,"column":54,"nodeType":"Literal","messageId":"noMagic","endLine":353,"endColumn":56},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":353,"column":59,"nodeType":"Literal","messageId":"noMagic","endLine":353,"endColumn":61},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":353,"column":64,"nodeType":"Literal","messageId":"noMagic","endLine":353,"endColumn":68}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":20,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * ËÆ§ËØÅ‰∏≠Èó¥‰ª∂\n * Áî®‰∫éÈ™åËØÅJWT‰ª§ÁâåÂíåÁî®Êà∑Ë∫´‰ªΩ\n */\n\nconst jwt = require('jsonwebtoken');\nconst responseFormatter = require('./responseFormatter');\n\n// JWTÈÖçÁΩÆ\nconst JWT_SECRET = process.env.JWT_SECRET || 'your-secret-key';\nconst JWT_EXPIRES_IN = process.env.JWT_EXPIRES_IN || '24h';\nconst JWT_REFRESH_SECRET = process.env.JWT_REFRESH_SECRET || 'your-refresh-secret-key';\nconst JWT_REFRESH_EXPIRES_IN = process.env.JWT_REFRESH_EXPIRES_IN || '7d';\n\n// ‰ª§ÁâåÈªëÂêçÂçïÔºàÂú®Áîü‰∫ßÁéØÂ¢É‰∏≠Â∫î‰ΩøÁî®RedisÁ≠âÂ§ñÈÉ®Â≠òÂÇ®Ôºâ\nconst tokenBlacklist = new Set();\n\n/**\n * ÁîüÊàêËÆøÈóÆ‰ª§Áâå\n * @param {Object} payload - ‰ª§ÁâåËΩΩËç∑\n * @returns {string} JWT‰ª§Áâå\n */\nfunction generateAccessToken(payload) {\n  return jwt.sign(payload, JWT_SECRET, {\n    expiresIn: JWT_EXPIRES_IN,\n    issuer: 'carbon-management-system',\n    audience: 'carbon-management-client'\n  });\n}\n\n/**\n * ÁîüÊàêÂà∑Êñ∞‰ª§Áâå\n * @param {Object} payload - ‰ª§ÁâåËΩΩËç∑\n * @returns {string} JWTÂà∑Êñ∞‰ª§Áâå\n */\nfunction generateRefreshToken(payload) {\n  return jwt.sign(payload, JWT_REFRESH_SECRET, {\n    expiresIn: JWT_REFRESH_EXPIRES_IN,\n    issuer: 'carbon-management-system',\n    audience: 'carbon-management-client'\n  });\n}\n\n/**\n * È™åËØÅËÆøÈóÆ‰ª§Áâå\n * @param {string} token - JWT‰ª§Áâå\n * @returns {Object} Ëß£Á†ÅÂêéÁöÑËΩΩËç∑\n */\nfunction verifyAccessToken(token) {\n  return jwt.verify(token, JWT_SECRET, {\n    issuer: 'carbon-management-system',\n    audience: 'carbon-management-client'\n  });\n}\n\n/**\n * È™åËØÅÂà∑Êñ∞‰ª§Áâå\n * @param {string} token - JWTÂà∑Êñ∞‰ª§Áâå\n * @returns {Object} Ëß£Á†ÅÂêéÁöÑËΩΩËç∑\n */\nfunction verifyRefreshToken(token) {\n  return jwt.verify(token, JWT_REFRESH_SECRET, {\n    issuer: 'carbon-management-system',\n    audience: 'carbon-management-client'\n  });\n}\n\n/**\n * Â∞Ü‰ª§ÁâåÂä†ÂÖ•ÈªëÂêçÂçï\n * @param {string} token - Ë¶ÅÂä†ÂÖ•ÈªëÂêçÂçïÁöÑ‰ª§Áâå\n */\nfunction blacklistToken(token) {\n  tokenBlacklist.add(token);\n\n  // ÂÆöÊúüÊ∏ÖÁêÜËøáÊúüÁöÑ‰ª§ÁâåÔºàÁÆÄÂçïÂÆûÁé∞ÔºåÁîü‰∫ßÁéØÂ¢ÉÂ∫î‰ΩøÁî®Êõ¥È´òÊïàÁöÑÊñπÊ≥ïÔºâ\n  setTimeout(\n    () => {\n      tokenBlacklist.delete(token);\n    },\n    24 * 60 * 60 * 1000\n  ); // 24Â∞èÊó∂ÂêéÊ∏ÖÁêÜ\n}\n\n/**\n * Ê£ÄÊü•‰ª§ÁâåÊòØÂê¶Âú®ÈªëÂêçÂçï‰∏≠\n * @param {string} token - Ë¶ÅÊ£ÄÊü•ÁöÑ‰ª§Áâå\n * @returns {boolean} ÊòØÂê¶Âú®ÈªëÂêçÂçï‰∏≠\n */\nfunction isTokenBlacklisted(token) {\n  return tokenBlacklist.has(token);\n}\n\n/**\n * ‰ªéËØ∑Ê±Ç‰∏≠ÊèêÂèñ‰ª§Áâå\n * @param {Object} req - ExpressËØ∑Ê±ÇÂØπË±°\n * @returns {string|null} ÊèêÂèñÁöÑ‰ª§Áâå\n */\nfunction extractToken(req) {\n  // ‰ªéAuthorizationÂ§¥‰∏≠ÊèêÂèñ\n  const authHeader = req.headers.authorization;\n  if (authHeader && authHeader.startsWith('Bearer ')) {\n    return authHeader.substring(7);\n  }\n\n  // ‰ªéÊü•ËØ¢ÂèÇÊï∞‰∏≠ÊèêÂèñ\n  if (req.query.token) {\n    return req.query.token;\n  }\n\n  // ‰ªéCookie‰∏≠ÊèêÂèñ\n  if (req.cookies && req.cookies.accessToken) {\n    return req.cookies.accessToken;\n  }\n\n  return null;\n}\n\n/**\n * ËÆ§ËØÅ‰∏≠Èó¥‰ª∂\n * È™åËØÅÁî®Êà∑Ë∫´‰ªΩÂπ∂Â∞ÜÁî®Êà∑‰ø°ÊÅØÈôÑÂä†Âà∞ËØ∑Ê±ÇÂØπË±°\n */\nfunction authenticate(req, res, next) {\n  try {\n    const token = extractToken(req);\n\n    if (!token) {\n      return responseFormatter.unauthorized(res, 'Áº∫Â∞ëËÆøÈóÆ‰ª§Áâå');\n    }\n\n    // Ê£ÄÊü•‰ª§ÁâåÊòØÂê¶Âú®ÈªëÂêçÂçï‰∏≠\n    if (isTokenBlacklisted(token)) {\n      return responseFormatter.unauthorized(res, '‰ª§ÁâåÂ∑≤Â§±Êïà');\n    }\n\n    // È™åËØÅ‰ª§Áâå\n    const decoded = verifyAccessToken(token);\n\n    // Ê£ÄÊü•‰ª§ÁâåÊòØÂê¶ÂåÖÂê´ÂøÖË¶ÅÁöÑÁî®Êà∑‰ø°ÊÅØ\n    if (!decoded.userId || !decoded.username || !decoded.role) {\n      return responseFormatter.unauthorized(res, '‰ª§ÁâåÊ†ºÂºèÊó†Êïà');\n    }\n\n    // Â∞ÜÁî®Êà∑‰ø°ÊÅØÈôÑÂä†Âà∞ËØ∑Ê±ÇÂØπË±°\n    req.user = {\n      userId: decoded.userId,\n      username: decoded.username,\n      email: decoded.email,\n      role: decoded.role,\n      permissions: decoded.permissions || [],\n      tokenId: decoded.jti, // JWT ID\n      issuedAt: decoded.iat,\n      expiresAt: decoded.exp\n    };\n\n    // Â∞ÜÂéüÂßã‰ª§Áâå‰πüÈôÑÂä†Âà∞ËØ∑Ê±ÇÂØπË±°ÔºàÁî®‰∫éÊ≥®ÈîÄÁ≠âÊìç‰ΩúÔºâ\n    req.token = token;\n\n    // ËÆ∞ÂΩïËÆ§ËØÅÊó•Âøó\n    console.log(\n      `[${new Date().toISOString()}] Authentication: User ${decoded.username} (${decoded.role}) authenticated`\n    );\n\n    next();\n  } catch (error) {\n    console.error('ËÆ§ËØÅÈîôËØØ:', error);\n\n    if (error.name === 'TokenExpiredError') {\n      return responseFormatter.unauthorized(res, '‰ª§ÁâåÂ∑≤ËøáÊúü');\n    } else if (error.name === 'JsonWebTokenError') {\n      return responseFormatter.unauthorized(res, '‰ª§ÁâåÊó†Êïà');\n    } else if (error.name === 'NotBeforeError') {\n      return responseFormatter.unauthorized(res, '‰ª§ÁâåÂ∞öÊú™ÁîüÊïà');\n    } \n    return responseFormatter.internalError(res, 'ËÆ§ËØÅÂ§±Ë¥•', error);\n    \n  }\n}\n\n/**\n * ÂèØÈÄâËÆ§ËØÅ‰∏≠Èó¥‰ª∂\n * Â¶ÇÊûúÊèê‰æõ‰∫Ü‰ª§ÁâåÂàôÈ™åËØÅÔºåÂê¶ÂàôÁªßÁª≠ÊâßË°å\n */\nfunction optionalAuthenticate(req, res, next) {\n  try {\n    const token = extractToken(req);\n\n    if (!token) {\n      // Ê≤°Êúâ‰ª§ÁâåÔºåÁªßÁª≠ÊâßË°å‰ΩÜ‰∏çËÆæÁΩÆÁî®Êà∑‰ø°ÊÅØ\n      return next();\n    }\n\n    // Ê£ÄÊü•‰ª§ÁâåÊòØÂê¶Âú®ÈªëÂêçÂçï‰∏≠\n    if (isTokenBlacklisted(token)) {\n      // ‰ª§ÁâåÂú®ÈªëÂêçÂçï‰∏≠ÔºåÁªßÁª≠ÊâßË°å‰ΩÜ‰∏çËÆæÁΩÆÁî®Êà∑‰ø°ÊÅØ\n      return next();\n    }\n\n    // È™åËØÅ‰ª§Áâå\n    const decoded = verifyAccessToken(token);\n\n    // Ê£ÄÊü•‰ª§ÁâåÊòØÂê¶ÂåÖÂê´ÂøÖË¶ÅÁöÑÁî®Êà∑‰ø°ÊÅØ\n    if (decoded.userId && decoded.username && decoded.role) {\n      // Â∞ÜÁî®Êà∑‰ø°ÊÅØÈôÑÂä†Âà∞ËØ∑Ê±ÇÂØπË±°\n      req.user = {\n        userId: decoded.userId,\n        username: decoded.username,\n        email: decoded.email,\n        role: decoded.role,\n        permissions: decoded.permissions || [],\n        tokenId: decoded.jti,\n        issuedAt: decoded.iat,\n        expiresAt: decoded.exp\n      };\n\n      req.token = token;\n\n      console.log(\n        `[${new Date().toISOString()}] Optional Authentication: User ${decoded.username} (${decoded.role}) authenticated`\n      );\n    }\n\n    next();\n  } catch (error) {\n    // ÂèØÈÄâËÆ§ËØÅÂ§±Ë¥•Êó∂‰∏çËøîÂõûÈîôËØØÔºåÁªßÁª≠ÊâßË°å\n    console.warn('ÂèØÈÄâËÆ§ËØÅÂ§±Ë¥•:', error.message);\n    next();\n  }\n}\n\n/**\n * Âà∑Êñ∞‰ª§Áâå‰∏≠Èó¥‰ª∂\n * È™åËØÅÂà∑Êñ∞‰ª§ÁâåÂπ∂ÁîüÊàêÊñ∞ÁöÑËÆøÈóÆ‰ª§Áâå\n */\nfunction refreshToken(req, res, next) {\n  try {\n    const refreshToken = req.body.refreshToken || req.cookies.refreshToken;\n\n    if (!refreshToken) {\n      return responseFormatter.unauthorized(res, 'Áº∫Â∞ëÂà∑Êñ∞‰ª§Áâå');\n    }\n\n    // È™åËØÅÂà∑Êñ∞‰ª§Áâå\n    const decoded = verifyRefreshToken(refreshToken);\n\n    // Ê£ÄÊü•Âà∑Êñ∞‰ª§ÁâåÊòØÂê¶ÂåÖÂê´ÂøÖË¶ÅÁöÑÁî®Êà∑‰ø°ÊÅØ\n    if (!decoded.userId || !decoded.username || !decoded.role) {\n      return responseFormatter.unauthorized(res, 'Âà∑Êñ∞‰ª§ÁâåÊ†ºÂºèÊó†Êïà');\n    }\n\n    // ÁîüÊàêÊñ∞ÁöÑËÆøÈóÆ‰ª§Áâå\n    const newAccessToken = generateAccessToken({\n      userId: decoded.userId,\n      username: decoded.username,\n      email: decoded.email,\n      role: decoded.role,\n      permissions: decoded.permissions\n    });\n\n    // ÂèØÈÄâÔºöÁîüÊàêÊñ∞ÁöÑÂà∑Êñ∞‰ª§ÁâåÔºàÊªöÂä®Âà∑Êñ∞Ôºâ\n    const newRefreshToken = generateRefreshToken({\n      userId: decoded.userId,\n      username: decoded.username,\n      email: decoded.email,\n      role: decoded.role\n    });\n\n    // Â∞ÜÊñ∞‰ª§ÁâåÈôÑÂä†Âà∞ÂìçÂ∫îÂØπË±°\n    res.locals.newTokens = {\n      accessToken: newAccessToken,\n      refreshToken: newRefreshToken,\n      expiresIn: JWT_EXPIRES_IN\n    };\n\n    // Â∞ÜÁî®Êà∑‰ø°ÊÅØÈôÑÂä†Âà∞ËØ∑Ê±ÇÂØπË±°\n    req.user = {\n      userId: decoded.userId,\n      username: decoded.username,\n      email: decoded.email,\n      role: decoded.role,\n      permissions: decoded.permissions || []\n    };\n\n    console.log(\n      `[${new Date().toISOString()}] Token Refresh: User ${decoded.username} tokens refreshed`\n    );\n\n    next();\n  } catch (error) {\n    console.error('‰ª§ÁâåÂà∑Êñ∞ÈîôËØØ:', error);\n\n    if (error.name === 'TokenExpiredError') {\n      return responseFormatter.unauthorized(res, 'Âà∑Êñ∞‰ª§ÁâåÂ∑≤ËøáÊúü');\n    } else if (error.name === 'JsonWebTokenError') {\n      return responseFormatter.unauthorized(res, 'Âà∑Êñ∞‰ª§ÁâåÊó†Êïà');\n    } \n    return responseFormatter.internalError(res, '‰ª§ÁâåÂà∑Êñ∞Â§±Ë¥•', error);\n    \n  }\n}\n\n/**\n * Ê≥®ÈîÄ‰∏≠Èó¥‰ª∂\n * Â∞ÜÂΩìÂâç‰ª§ÁâåÂä†ÂÖ•ÈªëÂêçÂçï\n */\nfunction logout(req, res, next) {\n  try {\n    const token = extractToken(req);\n\n    if (token) {\n      // Â∞Ü‰ª§ÁâåÂä†ÂÖ•ÈªëÂêçÂçï\n      blacklistToken(token);\n      console.log(\n        `[${new Date().toISOString()}] Logout: Token blacklisted for user ${req.user?.username || 'unknown'}`\n      );\n    }\n\n    // Ê∏ÖÈô§Áî®Êà∑‰ø°ÊÅØ\n    req.user = null;\n    req.token = null;\n\n    next();\n  } catch (error) {\n    console.error('Ê≥®ÈîÄÈîôËØØ:', error);\n    return responseFormatter.internalError(res, 'Ê≥®ÈîÄÂ§±Ë¥•', error);\n  }\n}\n\n/**\n * Ê£ÄÊü•‰ª§ÁâåÊúâÊïàÊúü‰∏≠Èó¥‰ª∂\n * Â¶ÇÊûú‰ª§ÁâåÂç≥Â∞ÜËøáÊúüÔºåÂú®ÂìçÂ∫îÂ§¥‰∏≠Ê∑ªÂä†ÊèêÁ§∫\n */\nfunction checkTokenExpiry(req, res, next) {\n  if (req.user && req.user.expiresAt) {\n    const now = Math.floor(Date.now() / 1000);\n    const timeToExpiry = req.user.expiresAt - now;\n\n    // Â¶ÇÊûú‰ª§ÁâåÂú®30ÂàÜÈíüÂÜÖËøáÊúüÔºåÊ∑ªÂä†Ë≠¶ÂëäÂ§¥\n    if (timeToExpiry < 30 * 60) {\n      res.set('X-Token-Warning', 'Token expires soon');\n      res.set('X-Token-Expires-In', timeToExpiry.toString());\n    }\n  }\n\n  next();\n}\n\n/**\n * ÈÄüÁéáÈôêÂà∂‰∏≠Èó¥‰ª∂ÔºàÂü∫‰∫éÁî®Êà∑Ôºâ\n * @param {number} maxRequests - ÊúÄÂ§ßËØ∑Ê±ÇÊï∞\n * @param {number} windowMs - Êó∂Èó¥Á™óÂè£ÔºàÊØ´ÁßíÔºâ\n * @returns {Function} Express‰∏≠Èó¥‰ª∂ÂáΩÊï∞\n */\nfunction userRateLimit(maxRequests = 100, windowMs = 15 * 60 * 1000) {\n  const userRequests = new Map();\n\n  return (req, res, next) => {\n    const userId = req.user?.userId || req.ip;\n    const now = Date.now();\n\n    if (!userRequests.has(userId)) {\n      userRequests.set(userId, { count: 1, resetTime: now + windowMs });\n      return next();\n    }\n\n    const userRequest = userRequests.get(userId);\n\n    if (now > userRequest.resetTime) {\n      // ÈáçÁΩÆËÆ°Êï∞Âô®\n      userRequest.count = 1;\n      userRequest.resetTime = now + windowMs;\n      return next();\n    }\n\n    if (userRequest.count >= maxRequests) {\n      return responseFormatter.tooManyRequests(res, 'ËØ∑Ê±ÇËøá‰∫éÈ¢ëÁπÅÔºåËØ∑Á®çÂêéÂÜçËØï');\n    }\n\n    userRequest.count++;\n    next();\n  };\n}\n\nmodule.exports = {\n  authenticate,\n  optionalAuthenticate,\n  refreshToken,\n  logout,\n  checkTokenExpiry,\n  userRateLimit,\n  generateAccessToken,\n  generateRefreshToken,\n  verifyAccessToken,\n  verifyRefreshToken,\n  blacklistToken,\n  isTokenBlacklisted,\n  extractToken\n};\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/interfaces/http/middleware/cache.js","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":36,"column":29,"nodeType":"MemberExpression","messageId":"unexpected","endLine":36,"endColumn":42},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":43,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":43,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[1082,1113],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":58,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":58,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[1374,1404],"text":""},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import cache from '../../../shared/config/cache.js';\nimport redisClient from '../../../database/redisClient.js';\nconst { setAsync, expireAsync, DEFAULT_TTL } = cache;\n\n/**\n * ÁºìÂ≠ò‰∏≠Èó¥‰ª∂ - Áî®‰∫éÁºìÂ≠òGETËØ∑Ê±ÇÁöÑÂìçÂ∫îÁªìÊûú\n * @param {number} ttl - ÁºìÂ≠òËøáÊúüÊó∂Èó¥(Áßí)\n */\nconst cacheMiddleware =\n  (ttl = DEFAULT_TTL) =>\n    async (req, res, next) => {\n    // Âè™ÁºìÂ≠òGETËØ∑Ê±Ç\n      if (req.method !== 'GET') {\n        return next();\n      }\n\n      // ÁîüÊàêÂîØ‰∏ÄÁºìÂ≠òÈîÆ\n      const cacheKey = `api:${req.originalUrl}`;\n\n      try {\n      // Â∞ùËØï‰ªéÁºìÂ≠òËé∑ÂèñÊï∞ÊçÆ\n        const cachedData = await redisClient.get(cacheKey);\n\n        if (cachedData) {\n        // ËøîÂõûÁºìÂ≠òÊï∞ÊçÆ\n          const data = JSON.parse(cachedData);\n          return res.json(data);\n        }\n\n        // ÈáçÂÜôres.jsonÊñπÊ≥ï\n        const originalJson = res.json;\n        res.json = function (body) {\n        // ÁºìÂ≠òÂìçÂ∫îÊï∞ÊçÆ\n          setAsync(cacheKey, JSON.stringify(body))\n            .then(() => expireAsync(cacheKey, ttl))\n            .catch((err) => console.error('ÁºìÂ≠òËÆæÁΩÆÂ§±Ë¥•:', err));\n\n          return originalJson.call(this, body);\n        };\n\n        next();\n      } catch (err) {\n        console.error('ÁºìÂ≠ò‰∏≠Èó¥‰ª∂ÈîôËØØ:', err);\n        next();\n      }\n    };\nexport { cacheMiddleware, clearCacheMiddleware };\n\n/**\n * Ê∏ÖÈô§ÁºìÂ≠òÁöÑ‰∏≠Èó¥‰ª∂\n * @param {string} pattern - ÁºìÂ≠òÈîÆÂåπÈÖçÊ®°Âºè\n */\nconst clearCacheMiddleware = () => async (req, res, next) => {\n  try {\n    // ÂÆûÁé∞ÁºìÂ≠òÊ∏ÖÈô§ÈÄªËæë\n    next();\n  } catch (err) {\n    console.error('Ê∏ÖÈô§ÁºìÂ≠òÂ§±Ë¥•:', err);\n    next();\n  }\n};\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/interfaces/http/middleware/cacheMiddleware.js","messages":[{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 300.","line":18,"column":19,"nodeType":"Literal","messageId":"noMagic","endLine":18,"endColumn":22},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":112,"column":32,"nodeType":"Literal","messageId":"noMagic","endLine":112,"endColumn":34},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 200.","line":117,"column":29,"nodeType":"Literal","messageId":"noMagic","endLine":117,"endColumn":32},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 300.","line":126,"column":33,"nodeType":"Literal","messageId":"noMagic","endLine":126,"endColumn":36},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 200.","line":129,"column":61,"nodeType":"Literal","messageId":"noMagic","endLine":129,"endColumn":64}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import cacheService from '../../../core/services/cacheService.js';\nimport logger from '../../../shared/utils/logger.js';\n\n/**\n * APIÂìçÂ∫îÁºìÂ≠ò‰∏≠Èó¥‰ª∂\n * Áî®‰∫éÁºìÂ≠òAPIÊé•Âè£ÁöÑÂìçÂ∫îÁªìÊûúÔºåÂáèÂ∞ëÈáçÂ§çËÆ°ÁÆóÂíåÊï∞ÊçÆÂ∫ìÊü•ËØ¢\n */\nclass CacheMiddleware {\n  /**\n   * ÂàõÂª∫ÁºìÂ≠ò‰∏≠Èó¥‰ª∂\n   * @param {Object} options - ÁºìÂ≠òÈÄâÈ°π\n   * @param {number} options.ttl - ÁºìÂ≠òËøáÊúüÊó∂Èó¥ÔºàÁßíÔºâ\n   * @param {Function} [options.keyGenerator] - Ëá™ÂÆö‰πâÁºìÂ≠òÈîÆÁîüÊàêÂáΩÊï∞\n   * @param {Function} [options.shouldCache] - Âà§Êñ≠ÊòØÂê¶ÁºìÂ≠òÂìçÂ∫îÁöÑÂáΩÊï∞\n   * @returns {Function} - Express‰∏≠Èó¥‰ª∂\n   */\n  static createCacheMiddleware(options = {}) {\n    const { ttl = 300, keyGenerator, shouldCache } = options;\n\n    return (req, res, next) => {\n      // Âè™ÁºìÂ≠òGETËØ∑Ê±Ç\n      if (req.method !== 'GET') {\n        return next();\n      }\n\n      // ÁîüÊàêÁºìÂ≠òÈîÆ\n      const cacheKey = keyGenerator ? keyGenerator(req) : CacheMiddleware.defaultKeyGenerator(req);\n\n      try {\n        // Â∞ùËØï‰ªéÁºìÂ≠òËé∑ÂèñÊï∞ÊçÆ\n        const cachedData = cacheService.get(cacheKey);\n\n        if (cachedData) {\n          logger.debug(`ÁºìÂ≠òÂëΩ‰∏≠: ${cacheKey}`);\n          return res.json(cachedData);\n        }\n\n        // ÈáçÂÜôres.jsonÊñπÊ≥ï‰ª•ÁºìÂ≠òÂìçÂ∫î\n        const originalJson = res.json;\n        res.json = function (body) {\n          // Âà§Êñ≠ÊòØÂê¶Â∫îËØ•ÁºìÂ≠ò\n          if (!shouldCache || shouldCache(req, res, body)) {\n            cacheService.set(cacheKey, body, ttl);\n            logger.debug(`ÁºìÂ≠òËÆæÁΩÆÊàêÂäü: ${cacheKey}, TTL: ${ttl}Áßí`);\n          }\n          return originalJson.call(this, body);\n        };\n\n        next();\n      } catch (error) {\n        logger.error(`ÁºìÂ≠ò‰∏≠Èó¥‰ª∂ÈîôËØØ: ${cacheKey}`, error);\n        next(); // ÁºìÂ≠òÂá∫ÈîôÊó∂ÁªßÁª≠ËØ∑Ê±ÇÂ§ÑÁêÜÔºå‰∏çÂΩ±ÂìçÊ≠£Â∏∏‰∏öÂä°\n      }\n    };\n  }\n\n  /**\n   * ÈªòËÆ§ÁºìÂ≠òÈîÆÁîüÊàêÂô®\n   * @param {Object} req - ExpressËØ∑Ê±ÇÂØπË±°\n   * @returns {string} - ÁºìÂ≠òÈîÆ\n   */\n  static defaultKeyGenerator(req) {\n    // ÂåÖÂê´Êü•ËØ¢ÂèÇÊï∞ÁöÑÂÆåÊï¥URL‰Ωú‰∏∫ÁºìÂ≠òÈîÆ\n    const queryString = new URLSearchParams(req.query).toString();\n    return `${req.originalUrl}${queryString ? `?${queryString}` : ''}`;\n  }\n\n  /**\n   * ÂàõÂª∫ÁºìÂ≠òÊ∏ÖÈô§‰∏≠Èó¥‰ª∂\n   * Áî®‰∫éÂú®Êï∞ÊçÆÊõ¥Êñ∞Êó∂Ê∏ÖÈô§Áõ∏ÂÖ≥ÁºìÂ≠ò\n   * @param {Function} keyPatternGenerator - ÁîüÊàêÁºìÂ≠òÈîÆÊ®°ÂºèÁöÑÂáΩÊï∞\n   * @returns {Function} - Express‰∏≠Èó¥‰ª∂\n   */\n  static createCacheInvalidator(keyPatternGenerator) {\n    return async (req, res, next) => {\n      try {\n        // ÂÖàÊâßË°åÂêéÁª≠‰∏≠Èó¥‰ª∂\n        await new Promise((resolve, reject) => {\n          res.on('finish', resolve);\n          res.on('error', reject);\n          next();\n        });\n\n        // ÁîüÊàêÁºìÂ≠òÈîÆÊ®°ÂºèÂπ∂Ê∏ÖÈô§ÂåπÈÖçÁöÑÁºìÂ≠ò\n        const keyPattern = keyPatternGenerator(req, res);\n        if (keyPattern) {\n          const stats = cacheService.getStats();\n          const keys = stats && stats.keys ? stats.keys : [];\n          const matchedKeys = keys.filter((key) => key.includes(keyPattern));\n\n          if (matchedKeys.length > 0) {\n            const count = cacheService.delMulti(matchedKeys);\n            logger.debug(`ÁºìÂ≠òÊ∏ÖÈô§ÊàêÂäü: Ê®°Âºè=${keyPattern}, Êï∞Èáè=${count}`);\n          }\n        }\n      } catch (error) {\n        logger.error('ÁºìÂ≠òÊ∏ÖÈô§‰∏≠Èó¥‰ª∂ÈîôËØØ', error);\n        // ÁºìÂ≠òÊ∏ÖÈô§Â§±Ë¥•‰∏çÂΩ±Âìç‰∏ªÊµÅÁ®ã\n      }\n    };\n  }\n\n  /**\n   * Â∏∏Áî®ÁºìÂ≠òÂú∫ÊôØÁöÑÂø´Êç∑ÊñπÊ≥ï\n   */\n\n  /**\n   * ËÆæÂ§áÊï∞ÊçÆÁºìÂ≠ò‰∏≠Èó¥‰ª∂\n   * @param {number} [ttl=60] - ÁºìÂ≠òÊó∂Èó¥ÔºàÁßíÔºâ\n   * @returns {Function} - Express‰∏≠Èó¥‰ª∂\n   */\n  static deviceDataCache(ttl = 60) {\n    return CacheMiddleware.createCacheMiddleware({\n      ttl,\n      shouldCache: (req, _res, body) =>\n        // Âè™ÁºìÂ≠òÊàêÂäüÂìçÂ∫î\n        _res.statusCode === 200 && body && body.success !== false\n    });\n  }\n\n  /**\n   * ËÉΩÊ∫êÁªüËÆ°Êï∞ÊçÆÁºìÂ≠ò‰∏≠Èó¥‰ª∂\n   * @param {number} [ttl=300] - ÁºìÂ≠òÊó∂Èó¥ÔºàÁßíÔºâ\n   * @returns {Function} - Express‰∏≠Èó¥‰ª∂\n   */\n  static energyStatsCache(ttl = 300) {\n    return CacheMiddleware.createCacheMiddleware({\n      ttl,\n      shouldCache: (req, _res, body) => _res.statusCode === 200 && body && body.success !== false\n    });\n  }\n\n  /**\n   * Ê∏ÖÈô§ËÆæÂ§áÊï∞ÊçÆÁºìÂ≠òÁöÑ‰∏≠Èó¥‰ª∂\n   * @returns {Function} - Express‰∏≠Èó¥‰ª∂\n   */\n  static invalidateDeviceCache() {\n    return CacheMiddleware.createCacheInvalidator((req, _) => {\n      // ‰ªéËØ∑Ê±ÇÂèÇÊï∞‰∏≠Ëé∑ÂèñËÆæÂ§áID\n      const deviceId = req.params.id || req.body.deviceId;\n      return deviceId ? `device/${deviceId}` : null;\n    });\n  }\n\n  /**\n   * Ê∏ÖÈô§ËÉΩÊ∫êÁªüËÆ°ÁºìÂ≠òÁöÑ‰∏≠Èó¥‰ª∂\n   * @returns {Function} - Express‰∏≠Èó¥‰ª∂\n   */\n  static invalidateEnergyStatsCache() {\n    return CacheMiddleware.createCacheInvalidator(() => 'energy/stats');\n  }\n}\n\nexport default CacheMiddleware;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/interfaces/http/middleware/httpErrorHandler.js","messages":[{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":29,"column":20,"nodeType":"Literal","messageId":"noMagic","endLine":29,"endColumn":23},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 401.","line":38,"column":20,"nodeType":"Literal","messageId":"noMagic","endLine":38,"endColumn":23},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 403.","line":47,"column":20,"nodeType":"Literal","messageId":"noMagic","endLine":47,"endColumn":23},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 404.","line":56,"column":29,"nodeType":"Literal","messageId":"noMagic","endLine":56,"endColumn":32},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":65,"column":20,"nodeType":"Literal","messageId":"noMagic","endLine":65,"endColumn":23},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 502.","line":74,"column":37,"nodeType":"Literal","messageId":"noMagic","endLine":74,"endColumn":40},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":165,"column":10,"nodeType":"Literal","messageId":"noMagic","endLine":165,"endColumn":13},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 401.","line":167,"column":10,"nodeType":"Literal","messageId":"noMagic","endLine":167,"endColumn":13},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 403.","line":169,"column":10,"nodeType":"Literal","messageId":"noMagic","endLine":169,"endColumn":13},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 404.","line":171,"column":10,"nodeType":"Literal","messageId":"noMagic","endLine":171,"endColumn":13},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 429.","line":173,"column":10,"nodeType":"Literal","messageId":"noMagic","endLine":173,"endColumn":13},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":175,"column":10,"nodeType":"Literal","messageId":"noMagic","endLine":175,"endColumn":13},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 502.","line":177,"column":10,"nodeType":"Literal","messageId":"noMagic","endLine":177,"endColumn":13},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 503.","line":179,"column":10,"nodeType":"Literal","messageId":"noMagic","endLine":179,"endColumn":13},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 504.","line":181,"column":10,"nodeType":"Literal","messageId":"noMagic","endLine":181,"endColumn":13},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":210,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":210,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[4491,4521],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":211,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":211,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[4526,4554],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":217,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":217,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[4666,4706],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":218,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":218,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[4711,4746],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":221,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":221,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[4824,4852],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":228,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":228,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[4946,4987],"text":""},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":21,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Áªü‰∏ÄÈîôËØØÂ§ÑÁêÜÊ®°Âùó\n * Êèê‰æõÊ†áÂáÜÂåñÁöÑÈîôËØØÁ±ªÂíåÈîôËØØÂ§ÑÁêÜ‰∏≠Èó¥‰ª∂\n */\n\nimport { logger } from './logger.js';\n\n/**\n * Â∫îÁî®Á®ãÂ∫èÈîôËØØÁ±ª\n * ÁªßÊâøËá™ErrorÔºåÊ∑ªÂä†Áä∂ÊÄÅÁ†ÅÂíåÈîôËØØ‰ª£Á†Å\n */\nexport class AppError extends Error {\n  constructor(message, statusCode, errorCode, details = {}) {\n    super(message);\n    this.statusCode = statusCode;\n    this.errorCode = errorCode;\n    this.details = details;\n    this.isOperational = true;\n    this.timestamp = new Date().toISOString();\n    Error.captureStackTrace(this, this.constructor);\n  }\n}\n\n/**\n * È™åËØÅÈîôËØØÁ±ª\n */\nexport class ValidationError extends AppError {\n  constructor(message, details) {\n    super(message, 400, 'VALIDATION_ERROR', details);\n  }\n}\n\n/**\n * ËÆ§ËØÅÈîôËØØÁ±ª\n */\nexport class AuthenticationError extends AppError {\n  constructor(message = 'ËÆ§ËØÅÂ§±Ë¥•') {\n    super(message, 401, 'AUTHENTICATION_ERROR');\n  }\n}\n\n/**\n * ÊéàÊùÉÈîôËØØÁ±ª\n */\nexport class AuthorizationError extends AppError {\n  constructor(message = 'ÊùÉÈôê‰∏çË∂≥') {\n    super(message, 403, 'AUTHORIZATION_ERROR');\n  }\n}\n\n/**\n * ËµÑÊ∫êÊú™ÊâæÂà∞ÈîôËØØÁ±ª\n */\nexport class NotFoundError extends AppError {\n  constructor(resource = 'ËµÑÊ∫ê') {\n    super(`${resource}Êú™ÊâæÂà∞`, 404, 'NOT_FOUND');\n  }\n}\n\n/**\n * Êï∞ÊçÆÂ∫ìÈîôËØØÁ±ª\n */\nexport class DatabaseError extends AppError {\n  constructor(message, details) {\n    super(message, 500, 'DATABASE_ERROR', details);\n  }\n}\n\n/**\n * Â§ñÈÉ®ÊúçÂä°ÈîôËØØÁ±ª\n */\nexport class ExternalServiceError extends AppError {\n  constructor(service, message = 'Â§ñÈÉ®ÊúçÂä°Ë∞ÉÁî®Â§±Ë¥•') {\n    super(`${service}: ${message}`, 502, 'EXTERNAL_SERVICE_ERROR');\n    this.service = service;\n  }\n}\n\n/**\n * ÈîôËØØÂ§ÑÁêÜ‰∏≠Èó¥‰ª∂\n * Áªü‰∏ÄÂ§ÑÁêÜÂ∫îÁî®Á®ãÂ∫è‰∏≠ÁöÑÈîôËØØ\n */\nexport const errorHandler = (err, req, res, _next) => {\n  let error = { ...err };\n  error.message = err.message;\n\n  // ËÆ∞ÂΩïÈîôËØØÊó•Âøó\n  // ÁªìÊûÑÂåñÈîôËØØÊó•Âøó\n  logger.error('API Error', {\n    errorCode: error.errorCode || 'UNKNOWN_ERROR',\n    message: error.message,\n    details: error.details,\n    url: req.url,\n    method: req.method,\n    ip: req.ip,\n    userAgent: req.get('User-Agent'),\n    stack: error.stack\n  });\n\n  // Â§ÑÁêÜÁâπÂÆöÁ±ªÂûãÁöÑÈîôËØØ\n  if (err.name === 'ValidationError') {\n    error = new ValidationError(err.message);\n  } else if (err.name === 'JsonWebTokenError') {\n    error = new AuthenticationError('Êó†ÊïàÁöÑËÆøÈóÆ‰ª§Áâå');\n  } else if (err.name === 'TokenExpiredError') {\n    error = new AuthenticationError('ËÆøÈóÆ‰ª§ÁâåÂ∑≤ËøáÊúü');\n  } else if (err.code === 'SQLITE_CONSTRAINT') {\n    error = new ValidationError('Êï∞ÊçÆÁ∫¶ÊùüËøùÂèç');\n  } else if (err.code === 'ENOTFOUND') {\n    error = new ExternalServiceError('DNS', 'ÂüüÂêçËß£ÊûêÂ§±Ë¥•');\n  } else if (err.code === 'ECONNREFUSED') {\n    error = new ExternalServiceError('Network', 'ËøûÊé•Ë¢´ÊãíÁªù');\n  }\n\n  // ËÆæÁΩÆÈªòËÆ§ÈîôËØØ‰ø°ÊÅØ\n  if (!error.statusCode) {\n    error.statusCode = 500;\n  }\n  if (!error.errorCode) {\n    error.errorCode = 'INTERNAL_SERVER_ERROR';\n  }\n\n  // ÊûÑÂª∫ÂìçÂ∫î\n  const response = {\n    success: false,\n    error: {\n      code: error.errorCode,\n      message:\n        process.env.NODE_ENV === 'production'\n          ? getProductionMessage(error.statusCode)\n          : error.message,\n      timestamp: new Date().toISOString(),\n      ...(process.env.NODE_ENV !== 'production' && { details: error.details })\n    }\n  };\n\n  // Âú®ÂºÄÂèëÁéØÂ¢É‰∏≠ÂåÖÂê´Â†ÜÊ†àË∑üË∏™\n  if (process.env.NODE_ENV === 'development') {\n    response.error.stack = error.stack;\n  }\n\n  // Â¶ÇÊûúÊòØÈ™åËØÅÈîôËØØÔºåÂåÖÂê´Â≠óÊÆµ‰ø°ÊÅØ\n  if (error instanceof ValidationError && error.field) {\n    response.error.field = error.field;\n  }\n\n  res.status(error.statusCode).json(response);\n};\n\n/**\n * Ê†πÊçÆÁä∂ÊÄÅÁ†ÅËé∑ÂèñÁîü‰∫ßÁéØÂ¢É‰∏ãÁöÑÈîôËØØÊ∂àÊÅØ\n * @param {number} statusCode HTTPÁä∂ÊÄÅÁ†Å\n * @returns {string} ÈîôËØØÊ∂àÊÅØ\n */\nconst getProductionMessage = (statusCode) => {\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 22 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 22 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 22 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 22 Ë°å)\n\n  switch (statusCode) {\n    case 400:\n      return 'ËØ∑Ê±ÇÂèÇÊï∞Êó†ÊïàÊàñÊ†ºÂºè‰∏çÊ≠£Á°Æ„ÄÇ';\n    case 401:\n      return 'ËÆ§ËØÅÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•ÊÇ®ÁöÑÂá≠ÊçÆ„ÄÇ';\n    case 403:\n      return 'ÊÇ®Ê≤°ÊúâÊâßË°åÊ≠§Êìç‰ΩúÁöÑÊùÉÈôê„ÄÇ';\n    case 404:\n      return 'ËØ∑Ê±ÇÁöÑËµÑÊ∫ê‰∏çÂ≠òÂú®„ÄÇ';\n    case 429:\n      return 'ËØ∑Ê±ÇËøá‰∫éÈ¢ëÁπÅÔºåËØ∑Á®çÂêéÂÜçËØï„ÄÇ';\n    case 500:\n      return 'ÊúçÂä°Âô®ÂÜÖÈÉ®ÈîôËØØÔºåËØ∑Á®çÂêéÂÜçËØï„ÄÇ';\n    case 502:\n      return 'ÁΩëÂÖ≥ÈîôËØØÊàñ‰∏äÊ∏∏ÊúçÂä°Êó†ÂìçÂ∫î„ÄÇ';\n    case 503:\n      return 'ÊúçÂä°ÊöÇÊó∂‰∏çÂèØÁî®ÔºåËØ∑Á®çÂêéÂÜçËØï„ÄÇ';\n    case 504:\n      return 'ÁΩëÂÖ≥Ë∂ÖÊó∂„ÄÇ';\n    default:\n      return 'ÂèëÁîüÊú™Áü•ÈîôËØØ„ÄÇ';\n  }\n};\n\n/**\n * ÂºÇÊ≠•ÈîôËØØÂåÖË£ÖÂô®\n * Ëá™Âä®ÊçïËé∑ÂºÇÊ≠•ÂáΩÊï∞‰∏≠ÁöÑÈîôËØØÂπ∂‰º†ÈÄíÁªôÈîôËØØÂ§ÑÁêÜ‰∏≠Èó¥‰ª∂\n */\nexport const asyncHandler = (fn) => (req, res, next) => {\n  Promise.resolve(fn(req, res, next)).catch(next);\n};\n\n/**\n * 404ÈîôËØØÂ§ÑÁêÜ‰∏≠Èó¥‰ª∂\n */\nexport const notFoundHandler = (req, res, next) => {\n  const error = new NotFoundError(`Ë∑ØÁî± ${req.originalUrl}`);\n  next(error);\n};\n\n/**\n * ËøõÁ®ãÂºÇÂ∏∏Â§ÑÁêÜ\n */\nexport const setupProcessHandlers = () => {\n  // Â§ÑÁêÜÊú™ÊçïËé∑ÁöÑÂºÇÂ∏∏\n  process.on('uncaughtException', (err) => {\n    console.error('Êú™ÊçïËé∑ÁöÑÂºÇÂ∏∏:', err);\n    console.error('Â∫îÁî®Á®ãÂ∫èÂ∞ÜÈÄÄÂá∫...');\n    process.exit(1);\n  });\n\n  // Â§ÑÁêÜÊú™Â§ÑÁêÜÁöÑPromiseÊãíÁªù\n  process.on('unhandledRejection', (reason, promise) => {\n    console.error('Êú™Â§ÑÁêÜÁöÑPromiseÊãíÁªù:', reason);\n    console.error('Promise:', promise);\n    // Âú®Áîü‰∫ßÁéØÂ¢É‰∏≠ÂèØËÉΩÈúÄË¶ÅÈÄÄÂá∫ËøõÁ®ã\n    if (process.env.NODE_ENV === 'production') {\n      console.error('Â∫îÁî®Á®ãÂ∫èÂ∞ÜÈÄÄÂá∫...');\n      process.exit(1);\n    }\n  });\n\n  // ‰ºòÈõÖÂÖ≥Èó≠Â§ÑÁêÜ\n  const gracefulShutdown = (signal) => {\n    console.log(`Êî∂Âà∞ ${signal} ‰ø°Âè∑ÔºåÂºÄÂßã‰ºòÈõÖÂÖ≥Èó≠...`);\n    // ËøôÈáåÂèØ‰ª•Ê∑ªÂä†Ê∏ÖÁêÜÈÄªËæëÔºåÂ¶ÇÂÖ≥Èó≠Êï∞ÊçÆÂ∫ìËøûÊé•„ÄÅÂÅúÊ≠¢ÂÆöÊó∂Âô®Á≠â\n    process.exit(0);\n  };\n\n  process.on('SIGTERM', () => gracefulShutdown('SIGTERM'));\n  process.on('SIGINT', () => gracefulShutdown('SIGINT'));\n};\n\nexport default {\n  AppError,\n  ValidationError,\n  AuthenticationError,\n  AuthorizationError,\n  NotFoundError,\n  DatabaseError,\n  ExternalServiceError,\n  errorHandler,\n  asyncHandler,\n  notFoundHandler,\n  setupProcessHandlers\n};\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/interfaces/http/middleware/performance.js","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":71,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":71,"endColumn":26,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[1745,1783],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":75,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":75,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[1840,1875],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":120,"column":25,"nodeType":"Literal","messageId":"noMagic","endLine":120,"endColumn":28},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":149,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":149,"endColumn":26,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[3454,3486],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":154,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":154,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[3549,3583],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":167,"column":92,"nodeType":"Literal","messageId":"noMagic","endLine":167,"endColumn":95},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":175,"column":79,"nodeType":"Literal","messageId":"noMagic","endLine":175,"endColumn":82},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":182,"column":44,"nodeType":"Literal","messageId":"noMagic","endLine":182,"endColumn":47},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":182,"column":51,"nodeType":"Literal","messageId":"noMagic","endLine":182,"endColumn":54},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":193,"column":47,"nodeType":"Literal","messageId":"noMagic","endLine":193,"endColumn":50},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":193,"column":54,"nodeType":"Literal","messageId":"noMagic","endLine":193,"endColumn":57},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":218,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":218,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[5495,5527],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":220,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":220,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[5551,5592],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":230,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":230,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[5872,5910],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":232,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":232,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[5934,5980],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 50.","line":265,"column":30,"nodeType":"Literal","messageId":"noMagic","endLine":265,"endColumn":32},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 80.","line":267,"column":37,"nodeType":"Literal","messageId":"noMagic","endLine":267,"endColumn":39},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":271,"column":33,"nodeType":"Literal","messageId":"noMagic","endLine":271,"endColumn":37},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 200.","line":273,"column":40,"nodeType":"Literal","messageId":"noMagic","endLine":273,"endColumn":43},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":283,"column":64,"nodeType":"Literal","messageId":"noMagic","endLine":283,"endColumn":67},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":303,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":303,"endColumn":26,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[8133,8167],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5.","line":306,"column":9,"nodeType":"Literal","messageId":"noMagic","endLine":306,"endColumn":10},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":306,"column":13,"nodeType":"Literal","messageId":"noMagic","endLine":306,"endColumn":15},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":306,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":306,"endColumn":22},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":314,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":314,"endColumn":24,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[8354,8386],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":315,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":315,"endColumn":24,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[8399,8443],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":316,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":316,"endColumn":24,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[8456,8506],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":317,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":317,"endColumn":24,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[8519,8564],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":318,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":318,"endColumn":24,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[8577,8613],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":320,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":320,"endColumn":26,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[8654,8690],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":323,"column":9,"nodeType":"Literal","messageId":"noMagic","endLine":323,"endColumn":11},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":323,"column":14,"nodeType":"Literal","messageId":"noMagic","endLine":323,"endColumn":16},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":323,"column":19,"nodeType":"Literal","messageId":"noMagic","endLine":323,"endColumn":23},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":325,"column":8,"nodeType":"Literal","messageId":"noMagic","endLine":325,"endColumn":10},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":325,"column":13,"nodeType":"Literal","messageId":"noMagic","endLine":325,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":35,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import path from 'path';\nimport fs from 'fs';\n\n/**\n * ÊÄßËÉΩÁõëÊéß‰∏≠Èó¥‰ª∂\n * Áî®‰∫éË∑üË∏™APIÂìçÂ∫îÊó∂Èó¥„ÄÅÁºìÂ≠òÂëΩ‰∏≠ÁéáÁ≠âÊÄßËÉΩÊåáÊ†á\n */\nclass PerformanceMonitor {\n  constructor() {\n    this.metrics = {\n      requests: 0,\n      totalResponseTime: 0,\n      cacheHits: 0,\n      cacheMisses: 0,\n      endpoints: new Map()\n    };\n\n    this.logFile = path.join(process.cwd(), 'logs', 'performance.log');\n    this.reportFile = path.join(process.cwd(), 'test-results', 'performance_monitor.csv');\n\n    // Á°Æ‰øùÊó•ÂøóÁõÆÂΩïÂ≠òÂú®\n    this.ensureLogDirectory();\n\n    // ÂÆöÊúüÁîüÊàêÊÄßËÉΩÊä•Âëä\n    this.startPeriodicReporting();\n  }\n\n  ensureLogDirectory() {\n    const logDir = path.dirname(this.logFile);\n    const reportDir = path.dirname(this.reportFile);\n\n    if (!fs.existsSync(logDir)) {\n      fs.mkdirSync(logDir, { recursive: true });\n    }\n\n    if (!fs.existsSync(reportDir)) {\n      fs.mkdirSync(reportDir, { recursive: true });\n    }\n  }\n\n  /**\n   * ÂàõÂª∫ÊÄßËÉΩÁõëÊéß‰∏≠Èó¥‰ª∂\n   */\n  middleware() {\n    return (req, res, next) => {\n      try {\n        const startTime = Date.now();\n        // ‰øÆÂ§çÔºöÂÆâÂÖ®Âú∞Ëé∑ÂèñË∑ØÂæÑÔºåÈÅøÂÖçÊú™ÂÆö‰πâÈîôËØØ\n        let endpoint = req.path;\n        try {\n          endpoint = `${req.method} ${req.route?.path || req.path}`;\n        } catch (e) {\n          // Â¶ÇÊûúËé∑Âèñroute.pathÂ§±Ë¥•Ôºå‰ΩøÁî®req.path\n          endpoint = `${req.method} ${req.path}`;\n        }\n\n        // ËÆ∞ÂΩïËØ∑Ê±ÇÂºÄÂßã\n        this.recordRequestStart(endpoint);\n\n        // ÁõëÂê¨ÂìçÂ∫îÁªìÊùü\n        res.on('finish', () => {\n          try {\n            const responseTime = Date.now() - startTime;\n            const cacheHit = res.getHeader('X-Cache-Hit') === 'true';\n\n            // ‰ΩøÁî®process.nextTickÂª∂ËøüËÆ∞ÂΩïÔºåÈÅøÂÖçÈòªÂ°ûÂìçÂ∫î\n            process.nextTick(() => {\n              this.recordRequestEnd(endpoint, responseTime, cacheHit, res.statusCode);\n            });\n          } catch (error) {\n            console.error('ÊÄßËÉΩÁõëÊéßËÆ∞ÂΩïÂìçÂ∫îÁªìÊùüÂ§±Ë¥•:', error);\n          }\n        });\n      } catch (error) {\n        console.error('ÊÄßËÉΩÁõëÊéß‰∏≠Èó¥‰ª∂ÈîôËØØ:', error);\n      }\n\n      // Êó†ËÆ∫Â¶Ç‰ΩïÈÉΩÁªßÁª≠Â§ÑÁêÜËØ∑Ê±Ç\n      next();\n    };\n  }\n\n  /**\n   * ËÆ∞ÂΩïËØ∑Ê±ÇÂºÄÂßã\n   */\n  recordRequestStart(endpoint) {\n    this.metrics.requests++;\n\n    if (!this.metrics.endpoints.has(endpoint)) {\n      this.metrics.endpoints.set(endpoint, {\n        requests: 0,\n        totalTime: 0,\n        cacheHits: 0,\n        cacheMisses: 0,\n        errors: 0\n      });\n    }\n\n    this.metrics.endpoints.get(endpoint).requests++;\n  }\n\n  /**\n   * ËÆ∞ÂΩïËØ∑Ê±ÇÁªìÊùü\n   */\n  recordRequestEnd(endpoint, responseTime, cacheHit, statusCode) {\n    this.metrics.totalResponseTime += responseTime;\n\n    const endpointMetrics = this.metrics.endpoints.get(endpoint);\n    if (endpointMetrics) {\n      endpointMetrics.totalTime += responseTime;\n\n      if (cacheHit) {\n        this.metrics.cacheHits++;\n        endpointMetrics.cacheHits++;\n      } else {\n        this.metrics.cacheMisses++;\n        endpointMetrics.cacheMisses++;\n      }\n\n      if (statusCode >= 400) {\n        endpointMetrics.errors++;\n      }\n    }\n\n    // ËÆ∞ÂΩïÂà∞Êó•ÂøóÊñá‰ª∂\n    this.logPerformanceData(endpoint, responseTime, cacheHit, statusCode);\n  }\n\n  /**\n   * ËÆ∞ÂΩïÊÄßËÉΩÊï∞ÊçÆÂà∞Êó•ÂøóÊñá‰ª∂\n   */\n  logPerformanceData(endpoint, responseTime, cacheHit, statusCode) {\n    try {\n      const logEntry = {\n        timestamp: new Date().toISOString(),\n        endpoint,\n        responseTime,\n        cacheHit,\n        statusCode\n      };\n\n      const logLine = `${JSON.stringify(logEntry)}\\n`;\n\n      // ‰ΩøÁî®ÂºÇÊ≠•Êñá‰ª∂Êìç‰ΩúÔºåÈÅøÂÖçÈòªÂ°ûËØ∑Ê±Ç\n      // ‰ΩøÁî®setImmediateËøõ‰∏ÄÊ≠•Âª∂ËøüÊó•ÂøóÂÜôÂÖ•ÔºåÁ°Æ‰øù‰∏çÂΩ±ÂìçËØ∑Ê±ÇÂ§ÑÁêÜ\n      setImmediate(() => {\n        fs.appendFile(this.logFile, logLine, (err) => {\n          if (err) {\n            console.error('ÂÜôÂÖ•ÊÄßËÉΩÊó•ÂøóÂ§±Ë¥•:', err);\n          }\n        });\n      });\n    } catch (error) {\n      console.error('ËÆ∞ÂΩïÊÄßËÉΩÊï∞ÊçÆÂ§±Ë¥•:', error);\n    }\n  }\n\n  /**\n   * Ëé∑ÂèñÊÄßËÉΩÁªüËÆ°‰ø°ÊÅØ\n   */\n  getStats() {\n    const avgResponseTime =\n      this.metrics.requests > 0 ? this.metrics.totalResponseTime / this.metrics.requests : 0;\n\n    const cacheHitRate =\n      this.metrics.cacheHits + this.metrics.cacheMisses > 0\n        ? (this.metrics.cacheHits / (this.metrics.cacheHits + this.metrics.cacheMisses)) * 100\n        : 0;\n\n    const endpointStats = [];\n    for (const [endpoint, metrics] of this.metrics.endpoints) {\n      const avgTime = metrics.requests > 0 ? metrics.totalTime / metrics.requests : 0;\n      const hitRate =\n        metrics.cacheHits + metrics.cacheMisses > 0\n          ? (metrics.cacheHits / (metrics.cacheHits + metrics.cacheMisses)) * 100\n          : 0;\n\n      endpointStats.push({\n        endpoint,\n        requests: metrics.requests,\n        avgResponseTime: Math.round(avgTime),\n        cacheHitRate: Math.round(hitRate * 100) / 100,\n        errors: metrics.errors\n      });\n    }\n\n    // ÊåâËØ∑Ê±ÇÊï∞ÊéíÂ∫è\n    endpointStats.sort((a, b) => b.requests - a.requests);\n\n    return {\n      totalRequests: this.metrics.requests,\n      avgResponseTime: Math.round(avgResponseTime),\n      cacheHitRate: Math.round(cacheHitRate * 100) / 100,\n      totalCacheHits: this.metrics.cacheHits,\n      totalCacheMisses: this.metrics.cacheMisses,\n      endpoints: endpointStats\n    };\n  }\n\n  /**\n   * ÁîüÊàêÊÄßËÉΩÊä•Âëä\n   */\n  generateReport() {\n    const stats = this.getStats();\n    const timestamp = new Date().toISOString();\n\n    // ÁîüÊàêCSVÊ†ºÂºèÁöÑÊä•Âëä\n    const csvHeader = 'timestamp,endpoint,requests,avg_response_time,cache_hit_rate,errors\\n';\n    let csvContent = csvHeader;\n\n    for (const endpoint of stats.endpoints) {\n      csvContent += `${timestamp},\"${endpoint.endpoint}\",${endpoint.requests},${endpoint.avgResponseTime},${endpoint.cacheHitRate},${endpoint.errors}\\n`;\n    }\n\n    // ÂÜôÂÖ•CSVÊñá‰ª∂\n    fs.writeFile(this.reportFile, csvContent, (err) => {\n      if (err) {\n        console.error('ÁîüÊàêÊÄßËÉΩÊä•ÂëäÂ§±Ë¥•:', err);\n      } else {\n        console.log('ÊÄßËÉΩÊä•ÂëäÂ∑≤ÁîüÊàê:', this.reportFile);\n      }\n    });\n\n    // ÁîüÊàêMarkdownÊ†ºÂºèÁöÑÊä•Âëä\n    const markdownReport = this.generateMarkdownReport(stats);\n    const markdownFile = path.join(process.cwd(), 'test-results', 'performance_report.md');\n\n    fs.writeFile(markdownFile, markdownReport, (err) => {\n      if (err) {\n        console.error('ÁîüÊàêMarkdownÊä•ÂëäÂ§±Ë¥•:', err);\n      } else {\n        console.log('MarkdownÊÄßËÉΩÊä•ÂëäÂ∑≤ÁîüÊàê:', markdownFile);\n      }\n    });\n\n    return stats;\n  }\n\n  /**\n   * ÁîüÊàêMarkdownÊ†ºÂºèÁöÑÊÄßËÉΩÊä•Âëä\n   */\n  generateMarkdownReport(stats) {\n    const timestamp = new Date().toLocaleString('zh-CN');\n\n    let markdown = '# Á≥ªÁªüÊÄßËÉΩÁõëÊéßÊä•Âëä\\n\\n';\n    markdown += `**ÁîüÊàêÊó∂Èó¥:** ${timestamp}\\n\\n`;\n\n    markdown += '## ÊÄª‰ΩìÊÄßËÉΩÊåáÊ†á\\n\\n';\n    markdown += `- **ÊÄªËØ∑Ê±ÇÊï∞:** ${stats.totalRequests}\\n`;\n    markdown += `- **Âπ≥ÂùáÂìçÂ∫îÊó∂Èó¥:** ${stats.avgResponseTime}ms\\n`;\n    markdown += `- **ÁºìÂ≠òÂëΩ‰∏≠Áéá:** ${stats.cacheHitRate}%\\n`;\n    markdown += `- **ÁºìÂ≠òÂëΩ‰∏≠Ê¨°Êï∞:** ${stats.totalCacheHits}\\n`;\n    markdown += `- **ÁºìÂ≠òÊú™ÂëΩ‰∏≠Ê¨°Êï∞:** ${stats.totalCacheMisses}\\n\\n`;\n\n    markdown += '## Êé•Âè£ÊÄßËÉΩËØ¶ÊÉÖ\\n\\n';\n    markdown += '| Êé•Âè£ | ËØ∑Ê±ÇÊï∞ | Âπ≥ÂùáÂìçÂ∫îÊó∂Èó¥(ms) | ÁºìÂ≠òÂëΩ‰∏≠Áéá(%) | ÈîôËØØÊï∞ |\\n';\n    markdown += '|------|--------|------------------|---------------|--------|\\n';\n\n    for (const endpoint of stats.endpoints) {\n      markdown += `| ${endpoint.endpoint} | ${endpoint.requests} | ${endpoint.avgResponseTime} | ${endpoint.cacheHitRate} | ${endpoint.errors} |\\n`;\n    }\n\n    markdown += '\\n## ÊÄßËÉΩ‰ºòÂåñÂª∫ËÆÆ\\n\\n';\n\n    if (stats.cacheHitRate < 50) {\n      markdown += `- ‚ö†Ô∏è ÁºìÂ≠òÂëΩ‰∏≠ÁéáËæÉ‰Ωé(${stats.cacheHitRate}%)ÔºåÂª∫ËÆÆÊ£ÄÊü•ÁºìÂ≠òÁ≠ñÁï•\\n`;\n    } else if (stats.cacheHitRate > 80) {\n      markdown += `- ‚úÖ ÁºìÂ≠òÂëΩ‰∏≠ÁéáËâØÂ•Ω(${stats.cacheHitRate}%)\\n`;\n    }\n\n    if (stats.avgResponseTime > 1000) {\n      markdown += `- ‚ö†Ô∏è Âπ≥ÂùáÂìçÂ∫îÊó∂Èó¥ËæÉÈïø(${stats.avgResponseTime}ms)ÔºåÂª∫ËÆÆ‰ºòÂåñÊü•ËØ¢ÊàñÂ¢ûÂä†ÁºìÂ≠ò\\n`;\n    } else if (stats.avgResponseTime < 200) {\n      markdown += `- ‚úÖ ÂìçÂ∫îÊó∂Èó¥Ë°®Áé∞ËâØÂ•Ω(${stats.avgResponseTime}ms)\\n`;\n    }\n\n    // ÊâæÂá∫ÂìçÂ∫îÊó∂Èó¥ÊúÄÈïøÁöÑÊé•Âè£\n    if (stats.endpoints && stats.endpoints.length > 0) {\n      const slowestEndpoint = stats.endpoints.reduce((prev, current) =>\n        prev.avgResponseTime > current.avgResponseTime ? prev : current\n      );\n\n      if (slowestEndpoint && slowestEndpoint.avgResponseTime > 500) {\n        markdown += `- ‚ö†Ô∏è ÊúÄÊÖ¢Êé•Âè£: ${slowestEndpoint.endpoint} (${slowestEndpoint.avgResponseTime}ms)ÔºåÂª∫ËÆÆ‰ºòÂåñ\\n`;\n      }\n    }\n\n    return markdown;\n  }\n\n  /**\n   * ÂºÄÂßãÂÆöÊúüÊä•Âëä\n   */\n  startPeriodicReporting() {\n    // Âª∂ËøüÂêØÂä®Êä•ÂëäÁîüÊàêÔºåÈÅøÂÖçÂú®Â∫îÁî®ÂêØÂä®Êó∂Â∞±ÂºÄÂßãÁîüÊàêÊä•Âëä\n    setTimeout(() => {\n      // ÊØè5ÂàÜÈíüÁîüÊàê‰∏ÄÊ¨°Êä•Âëä\n      setInterval(\n        () => {\n          try {\n            this.generateReport();\n          } catch (error) {\n            console.error('ÁîüÊàêÊÄßËÉΩÊä•ÂëäÂ§±Ë¥•:', error);\n          }\n        },\n        5 * 60 * 1000\n      );\n\n      // ÊØèÂ∞èÊó∂ËæìÂá∫‰∏ÄÊ¨°ÁªüËÆ°‰ø°ÊÅØÂà∞ÊéßÂà∂Âè∞\n      setInterval(\n        () => {\n          try {\n            const stats = this.getStats();\n            console.log('\\n=== ÊÄßËÉΩÁõëÊéßÁªüËÆ° ===');\n            console.log(`ÊÄªËØ∑Ê±ÇÊï∞: ${stats.totalRequests}`);\n            console.log(`Âπ≥ÂùáÂìçÂ∫îÊó∂Èó¥: ${stats.avgResponseTime}ms`);\n            console.log(`ÁºìÂ≠òÂëΩ‰∏≠Áéá: ${stats.cacheHitRate}%`);\n            console.log('==================\\n');\n          } catch (error) {\n            console.error('ËæìÂá∫ÊÄßËÉΩÁªüËÆ°‰ø°ÊÅØÂ§±Ë¥•:', error);\n          }\n        },\n        60 * 60 * 1000\n      );\n    }, 60 * 1000); // Âª∂Ëøü1ÂàÜÈíüÂêØÂä®\n  }\n\n  /**\n   * ÈáçÁΩÆÁªüËÆ°Êï∞ÊçÆ\n   */\n  reset() {\n    this.metrics = {\n      requests: 0,\n      totalResponseTime: 0,\n      cacheHits: 0,\n      cacheMisses: 0,\n      endpoints: new Map()\n    };\n  }\n}\n\n// ÂàõÂª∫ÂÖ®Â±ÄÊÄßËÉΩÁõëÊéßÂÆû‰æã\nconst performanceMonitor = new PerformanceMonitor();\n\nexport { performanceMonitor, performanceMonitor as default };\n\nexport const performanceMiddleware = performanceMonitor.middleware.bind(performanceMonitor);\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/interfaces/http/middleware/responseFormatter.js","messages":[{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 200.","line":14,"column":67,"nodeType":"Literal","messageId":"noMagic","endLine":14,"endColumn":70},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":36,"column":52,"nodeType":"Literal","messageId":"noMagic","endLine":36,"endColumn":55},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":49,"column":23,"nodeType":"Literal","messageId":"noMagic","endLine":49,"endColumn":26},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":50,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":50,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[1032,1156],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 20.","line":76,"column":36,"nodeType":"Literal","messageId":"noMagic","endLine":76,"endColumn":38},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 200.","line":84,"column":23,"nodeType":"Literal","messageId":"noMagic","endLine":84,"endColumn":26},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":99,"column":38,"nodeType":"Literal","messageId":"noMagic","endLine":99,"endColumn":41},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 401.","line":108,"column":37,"nodeType":"Literal","messageId":"noMagic","endLine":108,"endColumn":40},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 403.","line":117,"column":37,"nodeType":"Literal","messageId":"noMagic","endLine":117,"endColumn":40},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 404.","line":126,"column":37,"nodeType":"Literal","messageId":"noMagic","endLine":126,"endColumn":40},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 409.","line":135,"column":37,"nodeType":"Literal","messageId":"noMagic","endLine":135,"endColumn":40},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":144,"column":64,"nodeType":"Literal","messageId":"noMagic","endLine":144,"endColumn":66},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 429.","line":146,"column":37,"nodeType":"Literal","messageId":"noMagic","endLine":146,"endColumn":40},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":166,"column":37,"nodeType":"Literal","messageId":"noMagic","endLine":166,"endColumn":40},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 200.","line":177,"column":37,"nodeType":"Literal","messageId":"noMagic","endLine":177,"endColumn":40},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 300.","line":177,"column":57,"nodeType":"Literal","messageId":"noMagic","endLine":177,"endColumn":60},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":214,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":214,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[5214,5252],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 3600.","line":228,"column":46,"nodeType":"Literal","messageId":"noMagic","endLine":228,"endColumn":50},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 200.","line":261,"column":23,"nodeType":"Literal","messageId":"noMagic","endLine":261,"endColumn":26},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":271,"column":62,"nodeType":"Literal","messageId":"noMagic","endLine":271,"endColumn":65},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":294,"column":76,"nodeType":"Literal","messageId":"noMagic","endLine":294,"endColumn":80},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 503.","line":297,"column":23,"nodeType":"Literal","messageId":"noMagic","endLine":297,"endColumn":26}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":22,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * ÂìçÂ∫îÊ†ºÂºèÂåñ‰∏≠Èó¥‰ª∂\n * Êèê‰æõÁªü‰∏ÄÁöÑAPIÂìçÂ∫îÊ†ºÂºè\n */\n\nclass ResponseFormatter {\n  /**\n   * ÊàêÂäüÂìçÂ∫î\n   * @param {Object} res - ExpressÂìçÂ∫îÂØπË±°\n   * @param {string} message - ÂìçÂ∫îÊ∂àÊÅØ\n   * @param {*} data - ÂìçÂ∫îÊï∞ÊçÆ\n   * @param {number} statusCode - HTTPÁä∂ÊÄÅÁ†Å\n   */\n  static success(res, message = 'Êìç‰ΩúÊàêÂäü', data = null, statusCode = 200) {\n    const response = {\n      success: true,\n      message,\n      timestamp: new Date().toISOString(),\n      statusCode\n    };\n\n    if (data !== null) {\n      response.data = data;\n    }\n\n    return res.status(statusCode).json(response);\n  }\n\n  /**\n   * ÈîôËØØÂìçÂ∫î\n   * @param {Object} res - ExpressÂìçÂ∫îÂØπË±°\n   * @param {string} message - ÈîôËØØÊ∂àÊÅØ\n   * @param {number} statusCode - HTTPÁä∂ÊÄÅÁ†Å\n   * @param {*} errors - ËØ¶ÁªÜÈîôËØØ‰ø°ÊÅØ\n   */\n  static error(res, message = 'Êìç‰ΩúÂ§±Ë¥•', statusCode = 500, errors = null) {\n    const response = {\n      success: false,\n      message,\n      timestamp: new Date().toISOString(),\n      statusCode\n    };\n\n    if (errors !== null) {\n      response.errors = errors;\n    }\n\n    // ËÆ∞ÂΩïÈîôËØØÊó•Âøó\n    if (statusCode >= 500) {\n      console.error(`[${new Date().toISOString()}] Server Error:`, {\n        message,\n        statusCode,\n        errors\n      });\n    }\n\n    return res.status(statusCode).json(response);\n  }\n\n  /**\n   * ÂàÜÈ°µÂìçÂ∫î\n   * @param {Object} res - ExpressÂìçÂ∫îÂØπË±°\n   * @param {string} message - ÂìçÂ∫îÊ∂àÊÅØ\n   * @param {Array} data - Êï∞ÊçÆÊï∞ÁªÑ\n   * @param {Object} pagination - ÂàÜÈ°µ‰ø°ÊÅØ\n   */\n  static paginated(res, message = 'Ëé∑ÂèñÊï∞ÊçÆÊàêÂäü', data = [], pagination = {}) {\n    const response = {\n      success: true,\n      message,\n      timestamp: new Date().toISOString(),\n      statusCode: 200,\n      data,\n      pagination: {\n        page: pagination.page || 1,\n        limit: pagination.limit || 20,\n        total: pagination.total || 0,\n        pages: pagination.pages || 0,\n        hasNext: pagination.hasNext || false,\n        hasPrev: pagination.hasPrev || false\n      }\n    };\n\n    return res.status(200).json(response);\n  }\n\n  /**\n   * È™åËØÅÈîôËØØÂìçÂ∫î\n   * @param {Object} res - ExpressÂìçÂ∫îÂØπË±°\n   * @param {Array} validationErrors - È™åËØÅÈîôËØØÊï∞ÁªÑ\n   */\n  static validationError(res, validationErrors) {\n    const formattedErrors = validationErrors.map((error) => ({\n      field: error.param || error.path,\n      message: error.msg || error.message,\n      value: error.value\n    }));\n\n    return this.error(res, 'ËæìÂÖ•È™åËØÅÂ§±Ë¥•', 400, formattedErrors);\n  }\n\n  /**\n   * Êú™ÊéàÊùÉÂìçÂ∫î\n   * @param {Object} res - ExpressÂìçÂ∫îÂØπË±°\n   * @param {string} message - ÈîôËØØÊ∂àÊÅØ\n   */\n  static unauthorized(res, message = 'Êú™ÊéàÊùÉËÆøÈóÆ') {\n    return this.error(res, message, 401);\n  }\n\n  /**\n   * Á¶ÅÊ≠¢ËÆøÈóÆÂìçÂ∫î\n   * @param {Object} res - ExpressÂìçÂ∫îÂØπË±°\n   * @param {string} message - ÈîôËØØÊ∂àÊÅØ\n   */\n  static forbidden(res, message = 'Á¶ÅÊ≠¢ËÆøÈóÆ') {\n    return this.error(res, message, 403);\n  }\n\n  /**\n   * ËµÑÊ∫ê‰∏çÂ≠òÂú®ÂìçÂ∫î\n   * @param {Object} res - ExpressÂìçÂ∫îÂØπË±°\n   * @param {string} message - ÈîôËØØÊ∂àÊÅØ\n   */\n  static notFound(res, message = 'ËµÑÊ∫ê‰∏çÂ≠òÂú®') {\n    return this.error(res, message, 404);\n  }\n\n  /**\n   * ÂÜ≤Á™ÅÂìçÂ∫î\n   * @param {Object} res - ExpressÂìçÂ∫îÂØπË±°\n   * @param {string} message - ÈîôËØØÊ∂àÊÅØ\n   */\n  static conflict(res, message = 'ËµÑÊ∫êÂÜ≤Á™Å') {\n    return this.error(res, message, 409);\n  }\n\n  /**\n   * ËØ∑Ê±ÇËøá‰∫éÈ¢ëÁπÅÂìçÂ∫î\n   * @param {Object} res - ExpressÂìçÂ∫îÂØπË±°\n   * @param {string} message - ÈîôËØØÊ∂àÊÅØ\n   * @param {number} retryAfter - ÈáçËØïÁ≠âÂæÖÊó∂Èó¥ÔºàÁßíÔºâ\n   */\n  static tooManyRequests(res, message = 'ËØ∑Ê±ÇËøá‰∫éÈ¢ëÁπÅ', retryAfter = 60) {\n    res.setHeader('Retry-After', retryAfter);\n    return this.error(res, message, 429);\n  }\n\n  /**\n   * ÊúçÂä°Âô®ÂÜÖÈÉ®ÈîôËØØÂìçÂ∫î\n   * @param {Object} res - ExpressÂìçÂ∫îÂØπË±°\n   * @param {string} message - ÈîôËØØÊ∂àÊÅØ\n   * @param {Error} error - ÈîôËØØÂØπË±°\n   */\n  static internalError(res, message = 'ÊúçÂä°Âô®ÂÜÖÈÉ®ÈîôËØØ', error = null) {\n    // Âú®ÂºÄÂèëÁéØÂ¢É‰∏≠ÂåÖÂê´ÈîôËØØÂ†ÜÊ†à\n    const isDevelopment = process.env.NODE_ENV === 'development';\n    const errorDetails =\n      isDevelopment && error\n        ? {\n          stack: error.stack,\n          name: error.name\n        }\n        : null;\n\n    return this.error(res, message, 500, errorDetails);\n  }\n\n  /**\n   * Ëá™ÂÆö‰πâÁä∂ÊÄÅÁ†ÅÂìçÂ∫î\n   * @param {Object} res - ExpressÂìçÂ∫îÂØπË±°\n   * @param {number} statusCode - HTTPÁä∂ÊÄÅÁ†Å\n   * @param {string} message - ÂìçÂ∫îÊ∂àÊÅØ\n   * @param {*} data - ÂìçÂ∫îÊï∞ÊçÆ\n   */\n  static custom(res, statusCode, message, data = null) {\n    const isSuccess = statusCode >= 200 && statusCode < 300;\n\n    if (isSuccess) {\n      return this.success(res, message, data, statusCode);\n    } \n    return this.error(res, message, statusCode, data);\n    \n  }\n\n  /**\n   * Êñá‰ª∂‰∏ãËΩΩÂìçÂ∫î\n   * @param {Object} res - ExpressÂìçÂ∫îÂØπË±°\n   * @param {Buffer|string} fileData - Êñá‰ª∂Êï∞ÊçÆ\n   * @param {string} filename - Êñá‰ª∂Âêç\n   * @param {string} contentType - ÂÜÖÂÆπÁ±ªÂûã\n   */\n  static fileDownload(res, fileData, filename, contentType = 'application/octet-stream') {\n    res.setHeader('Content-Type', contentType);\n    res.setHeader('Content-Disposition', `attachment; filename=\"${filename}\"`);\n    res.setHeader('Content-Length', Buffer.byteLength(fileData));\n\n    return res.send(fileData);\n  }\n\n  /**\n   * ÊµÅÂºèÂìçÂ∫î\n   * @param {Object} res - ExpressÂìçÂ∫îÂØπË±°\n   * @param {Stream} stream - Êï∞ÊçÆÊµÅ\n   * @param {string} contentType - ÂÜÖÂÆπÁ±ªÂûã\n   */\n  static stream(res, stream, contentType = 'application/octet-stream') {\n    res.setHeader('Content-Type', contentType);\n    res.setHeader('Transfer-Encoding', 'chunked');\n\n    stream.pipe(res);\n\n    stream.on('error', (error) => {\n      console.error('Stream error:', error);\n      if (!res.headersSent) {\n        this.internalError(res, 'Êï∞ÊçÆÊµÅ‰º†ËæìÈîôËØØ', error);\n      }\n    });\n  }\n\n  /**\n   * ÁºìÂ≠òÂìçÂ∫î\n   * @param {Object} res - ExpressÂìçÂ∫îÂØπË±°\n   * @param {string} message - ÂìçÂ∫îÊ∂àÊÅØ\n   * @param {*} data - ÂìçÂ∫îÊï∞ÊçÆ\n   * @param {number} maxAge - ÁºìÂ≠òÊó∂Èó¥ÔºàÁßíÔºâ\n   */\n  static cached(res, message, data, maxAge = 3600) {\n    res.setHeader('Cache-Control', `public, max-age=${maxAge}`);\n    res.setHeader('ETag', this._generateETag(data));\n\n    return this.success(res, message, data);\n  }\n\n  /**\n   * ÁîüÊàêETag\n   * @param {*} data - Êï∞ÊçÆ\n   * @returns {string} ETagÂÄº\n   * @private\n   */\n  static _generateETag(data) {\n    const crypto = require('crypto');\n    const content = typeof data === 'string' ? data : JSON.stringify(data);\n    return crypto.createHash('md5').update(content).digest('hex');\n  }\n\n  /**\n   * ÂÅ•Â∫∑Ê£ÄÊü•ÂìçÂ∫î\n   * @param {Object} res - ExpressÂìçÂ∫îÂØπË±°\n   * @param {Object} healthData - ÂÅ•Â∫∑Áä∂ÊÄÅÊï∞ÊçÆ\n   */\n  static health(res, healthData = {}) {\n    const response = {\n      status: 'healthy',\n      timestamp: new Date().toISOString(),\n      uptime: process.uptime(),\n      memory: process.memoryUsage(),\n      ...healthData\n    };\n\n    return res.status(200).json(response);\n  }\n\n  /**\n   * APIÁâàÊú¨‰∏çÊîØÊåÅÂìçÂ∫î\n   * @param {Object} res - ExpressÂìçÂ∫îÂØπË±°\n   * @param {string} requestedVersion - ËØ∑Ê±ÇÁöÑÁâàÊú¨\n   * @param {Array} supportedVersions - ÊîØÊåÅÁöÑÁâàÊú¨ÂàóË°®\n   */\n  static unsupportedVersion(res, requestedVersion, supportedVersions = []) {\n    return this.error(res, `‰∏çÊîØÊåÅÁöÑAPIÁâàÊú¨: ${requestedVersion}`, 400, {\n      requestedVersion,\n      supportedVersions\n    });\n  }\n\n  /**\n   * Áª¥Êä§Ê®°ÂºèÂìçÂ∫î\n   * @param {Object} res - ExpressÂìçÂ∫îÂØπË±°\n   * @param {string} message - Áª¥Êä§Ê∂àÊÅØ\n   * @param {Date} estimatedEnd - È¢ÑËÆ°ÁªìÊùüÊó∂Èó¥\n   */\n  static maintenance(res, message = 'Á≥ªÁªüÊ≠£Âú®Áª¥Êä§‰∏≠', estimatedEnd = null) {\n    const response = {\n      success: false,\n      message,\n      timestamp: new Date().toISOString(),\n      statusCode: 503,\n      maintenance: true\n    };\n\n    if (estimatedEnd) {\n      response.estimatedEnd = estimatedEnd.toISOString();\n      res.setHeader('Retry-After', Math.ceil((estimatedEnd - new Date()) / 1000));\n    }\n\n    return res.status(503).json(response);\n  }\n}\n\n// ‰∏≠Èó¥‰ª∂ÂáΩÊï∞ÔºåÂ∞ÜResponseFormatterÊ∑ªÂä†Âà∞resÂØπË±°\nconst responseFormatterMiddleware = (req, res, next) => {\n  // Â∞ÜÊâÄÊúâÈùôÊÄÅÊñπÊ≥ïÁªëÂÆöÂà∞resÂØπË±°\n  res.success = (message, data, statusCode) =>\n    ResponseFormatter.success(res, message, data, statusCode);\n  res.error = (message, statusCode, errors) =>\n    ResponseFormatter.error(res, message, statusCode, errors);\n  res.paginated = (message, data, pagination) =>\n    ResponseFormatter.paginated(res, message, data, pagination);\n  res.validationError = (validationErrors) =>\n    ResponseFormatter.validationError(res, validationErrors);\n  res.unauthorized = (message) => ResponseFormatter.unauthorized(res, message);\n  res.forbidden = (message) => ResponseFormatter.forbidden(res, message);\n  res.notFound = (message) => ResponseFormatter.notFound(res, message);\n  res.conflict = (message) => ResponseFormatter.conflict(res, message);\n  res.tooManyRequests = (message, retryAfter) =>\n    ResponseFormatter.tooManyRequests(res, message, retryAfter);\n  res.internalError = (message, error) => ResponseFormatter.internalError(res, message, error);\n  res.custom = (statusCode, message, data) =>\n    ResponseFormatter.custom(res, statusCode, message, data);\n  res.fileDownload = (fileData, filename, contentType) =>\n    ResponseFormatter.fileDownload(res, fileData, filename, contentType);\n  res.stream = (stream, contentType) => ResponseFormatter.stream(res, stream, contentType);\n  res.cached = (message, data, maxAge) => ResponseFormatter.cached(res, message, data, maxAge);\n  res.health = (healthData) => ResponseFormatter.health(res, healthData);\n  res.unsupportedVersion = (requestedVersion, supportedVersions) =>\n    ResponseFormatter.unsupportedVersion(res, requestedVersion, supportedVersions);\n  res.maintenance = (message, estimatedEnd) =>\n    ResponseFormatter.maintenance(res, message, estimatedEnd);\n\n  next();\n};\n\nmodule.exports = ResponseFormatter;\nmodule.exports.middleware = responseFormatterMiddleware;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/interfaces/http/middleware/roleCheck.js","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":103,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":103,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2094,2243],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":109,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":109,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[2287,2319],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":150,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":150,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[3399,3561],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":156,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":156,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[3605,3637],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":184,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":184,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[4319,4511],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":190,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":190,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[4555,4589],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":226,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":226,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[5405,5532],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":232,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":232,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[5576,5609],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":272,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":272,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[6634,6788],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":278,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":278,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[6832,6866],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 405.","line":354,"column":59,"nodeType":"Literal","messageId":"noMagic","endLine":354,"endColumn":62}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":11,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * ËßíËâ≤Ê£ÄÊü•‰∏≠Èó¥‰ª∂\n * Áî®‰∫éÈ™åËØÅÁî®Êà∑ÊòØÂê¶ÂÖ∑ÊúâÊâßË°åÁâπÂÆöÊìç‰ΩúÁöÑÊùÉÈôê\n */\n\nconst responseFormatter = require('./responseFormatter');\n\n// ËßíËâ≤ÊùÉÈôêÁ∫ßÂà´ÂÆö‰πâ\nconst ROLE_LEVELS = {\n  admin: 100,\n  operator: 50,\n  user: 10,\n  guest: 1\n};\n\n// ËßíËâ≤ÊùÉÈôêÊò†Â∞Ñ\nconst ROLE_PERMISSIONS = {\n  admin: [\n    'user:create',\n    'user:read',\n    'user:update',\n    'user:delete',\n    'device:create',\n    'device:read',\n    'device:update',\n    'device:delete',\n    'energy:create',\n    'energy:read',\n    'energy:update',\n    'energy:delete',\n    'carbon:create',\n    'carbon:read',\n    'carbon:update',\n    'carbon:delete',\n    'maintenance:create',\n    'maintenance:read',\n    'maintenance:update',\n    'maintenance:delete',\n    'digitaltwin:create',\n    'digitaltwin:read',\n    'digitaltwin:update',\n    'digitaltwin:delete',\n    'system:config',\n    'system:backup',\n    'system:restore',\n    'report:generate',\n    'report:export'\n  ],\n  operator: [\n    'device:create',\n    'device:read',\n    'device:update',\n    'energy:create',\n    'energy:read',\n    'energy:update',\n    'carbon:create',\n    'carbon:read',\n    'carbon:update',\n    'maintenance:create',\n    'maintenance:read',\n    'maintenance:update',\n    'digitaltwin:create',\n    'digitaltwin:read',\n    'digitaltwin:update',\n    'report:generate',\n    'report:export'\n  ],\n  user: [\n    'device:read',\n    'energy:read',\n    'carbon:read',\n    'maintenance:read',\n    'digitaltwin:read',\n    'report:generate'\n  ],\n  guest: ['device:read', 'energy:read', 'carbon:read']\n};\n\n/**\n * Ê£ÄÊü•Áî®Êà∑ÊòØÂê¶ÂÖ∑ÊúâÊåáÂÆöËßíËâ≤\n * @param {Array|string} allowedRoles - ÂÖÅËÆ∏ÁöÑËßíËâ≤ÂàóË°®\n * @returns {Function} Express‰∏≠Èó¥‰ª∂ÂáΩÊï∞\n */\nfunction requireRole(allowedRoles) {\n  // Á°Æ‰øùallowedRolesÊòØÊï∞ÁªÑ\n  const roles = Array.isArray(allowedRoles) ? allowedRoles : [allowedRoles];\n\n  return (req, res, next) => {\n    try {\n      // Ê£ÄÊü•Áî®Êà∑ÊòØÂê¶Â∑≤ËÆ§ËØÅ\n      if (!req.user) {\n        return responseFormatter.unauthorized(res, 'Áî®Êà∑Êú™ËÆ§ËØÅ');\n      }\n\n      const userRole = req.user.role;\n\n      // Ê£ÄÊü•Áî®Êà∑ËßíËâ≤ÊòØÂê¶Âú®ÂÖÅËÆ∏ÁöÑËßíËâ≤ÂàóË°®‰∏≠\n      if (!roles.includes(userRole)) {\n        return responseFormatter.forbidden(res, `ÈúÄË¶Å‰ª•‰∏ãËßíËâ≤‰πã‰∏Ä: ${roles.join(', ')}`);\n      }\n\n      // ËÆ∞ÂΩïÊùÉÈôêÊ£ÄÊü•Êó•Âøó\n      console.log(\n        `[${new Date().toISOString()}] Role Check: User ${req.user.username} (${userRole}) accessing ${req.method} ${req.path}`\n      );\n\n      next();\n    } catch (error) {\n      console.error('ËßíËâ≤Ê£ÄÊü•ÈîôËØØ:', error);\n      return responseFormatter.internalError(res, 'ÊùÉÈôêÈ™åËØÅÂ§±Ë¥•', error);\n    }\n  };\n}\n\n/**\n * Ê£ÄÊü•Áî®Êà∑ÊòØÂê¶ÂÖ∑ÊúâÊåáÂÆöÊùÉÈôê\n * @param {Array|string} requiredPermissions - ÈúÄË¶ÅÁöÑÊùÉÈôêÂàóË°®\n * @returns {Function} Express‰∏≠Èó¥‰ª∂ÂáΩÊï∞\n */\nfunction requirePermission(requiredPermissions) {\n  // Á°Æ‰øùrequiredPermissionsÊòØÊï∞ÁªÑ\n  const permissions = Array.isArray(requiredPermissions)\n    ? requiredPermissions\n    : [requiredPermissions];\n\n  return (req, res, next) => {\n    try {\n      // Ê£ÄÊü•Áî®Êà∑ÊòØÂê¶Â∑≤ËÆ§ËØÅ\n      if (!req.user) {\n        return responseFormatter.unauthorized(res, 'Áî®Êà∑Êú™ËÆ§ËØÅ');\n      }\n\n      const userRole = req.user.role;\n      const userPermissions = ROLE_PERMISSIONS[userRole] || [];\n\n      // Ê£ÄÊü•Áî®Êà∑ÊòØÂê¶ÂÖ∑ÊúâÊâÄÊúâÈúÄË¶ÅÁöÑÊùÉÈôê\n      const hasAllPermissions = permissions.every((permission) =>\n        userPermissions.includes(permission)\n      );\n\n      if (!hasAllPermissions) {\n        const missingPermissions = permissions.filter(\n          (permission) => !userPermissions.includes(permission)\n        );\n\n        return responseFormatter.forbidden(res, `Áº∫Â∞ëÊùÉÈôê: ${missingPermissions.join(', ')}`);\n      }\n\n      // ËÆ∞ÂΩïÊùÉÈôêÊ£ÄÊü•Êó•Âøó\n      console.log(\n        `[${new Date().toISOString()}] Permission Check: User ${req.user.username} (${userRole}) has permissions: ${permissions.join(', ')}`\n      );\n\n      next();\n    } catch (error) {\n      console.error('ÊùÉÈôêÊ£ÄÊü•ÈîôËØØ:', error);\n      return responseFormatter.internalError(res, 'ÊùÉÈôêÈ™åËØÅÂ§±Ë¥•', error);\n    }\n  };\n}\n\n/**\n * Ê£ÄÊü•Áî®Êà∑ÊòØÂê¶ÂÖ∑ÊúâË∂≥Â§üÁöÑËßíËâ≤Á∫ßÂà´\n * @param {string} minimumRole - ÊúÄ‰ΩéË¶ÅÊ±ÇÁöÑËßíËâ≤\n * @returns {Function} Express‰∏≠Èó¥‰ª∂ÂáΩÊï∞\n */\nfunction requireMinimumRole(minimumRole) {\n  return (req, res, next) => {\n    try {\n      // Ê£ÄÊü•Áî®Êà∑ÊòØÂê¶Â∑≤ËÆ§ËØÅ\n      if (!req.user) {\n        return responseFormatter.unauthorized(res, 'Áî®Êà∑Êú™ËÆ§ËØÅ');\n      }\n\n      const userRole = req.user.role;\n      const userLevel = ROLE_LEVELS[userRole] || 0;\n      const requiredLevel = ROLE_LEVELS[minimumRole] || 0;\n\n      if (userLevel < requiredLevel) {\n        return responseFormatter.forbidden(res, `ÈúÄË¶ÅËá≥Â∞ë ${minimumRole} ËßíËâ≤ÊùÉÈôê`);\n      }\n\n      // ËÆ∞ÂΩïÊùÉÈôêÊ£ÄÊü•Êó•Âøó\n      console.log(\n        `[${new Date().toISOString()}] Role Level Check: User ${req.user.username} (${userRole}:${userLevel}) meets minimum requirement (${minimumRole}:${requiredLevel})`\n      );\n\n      next();\n    } catch (error) {\n      console.error('ËßíËâ≤Á∫ßÂà´Ê£ÄÊü•ÈîôËØØ:', error);\n      return responseFormatter.internalError(res, 'ÊùÉÈôêÈ™åËØÅÂ§±Ë¥•', error);\n    }\n  };\n}\n\n/**\n * Ê£ÄÊü•Áî®Êà∑ÊòØÂê¶‰∏∫ËµÑÊ∫êÊâÄÊúâËÄÖÊàñÂÖ∑ÊúâÁÆ°ÁêÜÊùÉÈôê\n * @param {Function} getResourceOwnerId - Ëé∑ÂèñËµÑÊ∫êÊâÄÊúâËÄÖIDÁöÑÂáΩÊï∞\n * @returns {Function} Express‰∏≠Èó¥‰ª∂ÂáΩÊï∞\n */\nfunction requireOwnershipOrAdmin(getResourceOwnerId) {\n  return async (req, res, next) => {\n    try {\n      // Ê£ÄÊü•Áî®Êà∑ÊòØÂê¶Â∑≤ËÆ§ËØÅ\n      if (!req.user) {\n        return responseFormatter.unauthorized(res, 'Áî®Êà∑Êú™ËÆ§ËØÅ');\n      }\n\n      const userRole = req.user.role;\n      const {userId} = req.user;\n\n      // ÁÆ°ÁêÜÂëòÂèØ‰ª•ËÆøÈóÆÊâÄÊúâËµÑÊ∫ê\n      if (userRole === 'admin') {\n        return next();\n      }\n\n      // Ëé∑ÂèñËµÑÊ∫êÊâÄÊúâËÄÖID\n      const resourceOwnerId = await getResourceOwnerId(req);\n\n      // Ê£ÄÊü•Áî®Êà∑ÊòØÂê¶‰∏∫ËµÑÊ∫êÊâÄÊúâËÄÖ\n      if (userId !== resourceOwnerId) {\n        return responseFormatter.forbidden(res, 'Âè™ËÉΩËÆøÈóÆËá™Â∑±ÁöÑËµÑÊ∫ê');\n      }\n\n      // ËÆ∞ÂΩïÊùÉÈôêÊ£ÄÊü•Êó•Âøó\n      console.log(\n        `[${new Date().toISOString()}] Ownership Check: User ${req.user.username} accessing own resource`\n      );\n\n      next();\n    } catch (error) {\n      console.error('ÊâÄÊúâÊùÉÊ£ÄÊü•ÈîôËØØ:', error);\n      return responseFormatter.internalError(res, 'ÊùÉÈôêÈ™åËØÅÂ§±Ë¥•', error);\n    }\n  };\n}\n\n/**\n * Êù°‰ª∂ÊùÉÈôêÊ£ÄÊü•\n * @param {Function} condition - Êù°‰ª∂Ê£ÄÊü•ÂáΩÊï∞\n * @param {Array|string} allowedRoles - Êª°Ë∂≥Êù°‰ª∂Êó∂ÂÖÅËÆ∏ÁöÑËßíËâ≤\n * @param {Array|string} fallbackRoles - ‰∏çÊª°Ë∂≥Êù°‰ª∂Êó∂ÂÖÅËÆ∏ÁöÑËßíËâ≤\n * @returns {Function} Express‰∏≠Èó¥‰ª∂ÂáΩÊï∞\n */\nfunction conditionalRole(condition, allowedRoles, fallbackRoles = []) {\n  return async (req, res, next) => {\n    try {\n      // Ê£ÄÊü•Áî®Êà∑ÊòØÂê¶Â∑≤ËÆ§ËØÅ\n      if (!req.user) {\n        return responseFormatter.unauthorized(res, 'Áî®Êà∑Êú™ËÆ§ËØÅ');\n      }\n\n      const userRole = req.user.role;\n      const conditionMet = await condition(req);\n\n      const targetRoles = conditionMet\n        ? Array.isArray(allowedRoles)\n          ? allowedRoles\n          : [allowedRoles]\n        : Array.isArray(fallbackRoles)\n          ? fallbackRoles\n          : [fallbackRoles];\n\n      if (!targetRoles.includes(userRole)) {\n        return responseFormatter.forbidden(\n          res,\n          `ÂΩìÂâçÊù°‰ª∂‰∏ãÈúÄË¶Å‰ª•‰∏ãËßíËâ≤‰πã‰∏Ä: ${targetRoles.join(', ')}`\n        );\n      }\n\n      // ËÆ∞ÂΩïÊùÉÈôêÊ£ÄÊü•Êó•Âøó\n      console.log(\n        `[${new Date().toISOString()}] Conditional Role Check: User ${req.user.username} (${userRole}) - condition: ${conditionMet}`\n      );\n\n      next();\n    } catch (error) {\n      console.error('Êù°‰ª∂ÊùÉÈôêÊ£ÄÊü•ÈîôËØØ:', error);\n      return responseFormatter.internalError(res, 'ÊùÉÈôêÈ™åËØÅÂ§±Ë¥•', error);\n    }\n  };\n}\n\n/**\n * Ëé∑ÂèñÁî®Êà∑ÊùÉÈôêÂàóË°®\n * @param {string} role - Áî®Êà∑ËßíËâ≤\n * @returns {Array} ÊùÉÈôêÂàóË°®\n */\nfunction getUserPermissions(role) {\n  return ROLE_PERMISSIONS[role] || [];\n}\n\n/**\n * Ê£ÄÊü•ËßíËâ≤ÊòØÂê¶ÂÖ∑ÊúâÊåáÂÆöÊùÉÈôê\n * @param {string} role - ËßíËâ≤\n * @param {string} permission - ÊùÉÈôê\n * @returns {boolean} ÊòØÂê¶ÂÖ∑ÊúâÊùÉÈôê\n */\nfunction hasPermission(role, permission) {\n  const permissions = ROLE_PERMISSIONS[role] || [];\n  return permissions.includes(permission);\n}\n\n/**\n * Ëé∑ÂèñËßíËâ≤Á∫ßÂà´\n * @param {string} role - ËßíËâ≤\n * @returns {number} ËßíËâ≤Á∫ßÂà´\n */\nfunction getRoleLevel(role) {\n  return ROLE_LEVELS[role] || 0;\n}\n\n/**\n * ÊØîËæÉ‰∏§‰∏™ËßíËâ≤ÁöÑÁ∫ßÂà´\n * @param {string} role1 - ËßíËâ≤1\n * @param {string} role2 - ËßíËâ≤2\n * @returns {number} ÊØîËæÉÁªìÊûú (1: role1 > role2, 0: Áõ∏Á≠â, -1: role1 < role2)\n */\nfunction compareRoles(role1, role2) {\n  const level1 = getRoleLevel(role1);\n  const level2 = getRoleLevel(role2);\n\n  if (level1 > level2) {return 1;}\n  if (level1 < level2) {return -1;}\n  return 0;\n}\n\n/**\n * ÊùÉÈôêÊ£ÄÊü•‰∏≠Èó¥‰ª∂Â∑•ÂéÇ\n * Ê†πÊçÆHTTPÊñπÊ≥ïËá™Âä®ÈÄâÊã©ÊùÉÈôêÊ£ÄÊü•Á≠ñÁï•\n * @param {string} resource - ËµÑÊ∫êÂêçÁß∞\n * @returns {Function} Express‰∏≠Èó¥‰ª∂ÂáΩÊï∞\n */\nfunction autoPermissionCheck(resource) {\n  return (req, res, next) => {\n    const method = req.method.toLowerCase();\n    let requiredPermission;\n\n    switch (method) {\n      case 'get':\n        requiredPermission = `${resource}:read`;\n        break;\n      case 'post':\n        requiredPermission = `${resource}:create`;\n        break;\n      case 'put':\n      case 'patch':\n        requiredPermission = `${resource}:update`;\n        break;\n      case 'delete':\n        requiredPermission = `${resource}:delete`;\n        break;\n      default:\n        return responseFormatter.error(res, '‰∏çÊîØÊåÅÁöÑHTTPÊñπÊ≥ï', 405);\n    }\n\n    return requirePermission(requiredPermission)(req, res, next);\n  };\n}\n\nmodule.exports = {\n  requireRole,\n  requirePermission,\n  requireMinimumRole,\n  requireOwnershipOrAdmin,\n  conditionalRole,\n  autoPermissionCheck,\n  getUserPermissions,\n  hasPermission,\n  getRoleLevel,\n  compareRoles,\n  ROLE_LEVELS,\n  ROLE_PERMISSIONS\n};\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/interfaces/http/middleware/validation.js","messages":[{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 3.","line":56,"column":10,"nodeType":"Literal","messageId":"noMagic","endLine":56,"endColumn":11},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 50.","line":57,"column":10,"nodeType":"Literal","messageId":"noMagic","endLine":57,"endColumn":12},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 3.","line":71,"column":50,"nodeType":"Literal","messageId":"noMagic","endLine":71,"endColumn":51},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 999999.","line":71,"column":57,"nodeType":"Literal","messageId":"noMagic","endLine":71,"endColumn":63},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 6.","line":78,"column":46,"nodeType":"Literal","messageId":"noMagic","endLine":78,"endColumn":47},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 999999.","line":78,"column":53,"nodeType":"Literal","messageId":"noMagic","endLine":78,"endColumn":59},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":87,"column":46,"nodeType":"Literal","messageId":"noMagic","endLine":87,"endColumn":49},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 20.","line":87,"column":59,"nodeType":"Literal","messageId":"noMagic","endLine":87,"endColumn":61},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 3.","line":98,"column":41,"nodeType":"Literal","messageId":"noMagic","endLine":98,"endColumn":42},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 30.","line":98,"column":48,"nodeType":"Literal","messageId":"noMagic","endLine":98,"endColumn":50},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 8.","line":106,"column":10,"nodeType":"Literal","messageId":"noMagic","endLine":106,"endColumn":11},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 128.","line":107,"column":10,"nodeType":"Literal","messageId":"noMagic","endLine":107,"endColumn":13},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 255.","line":116,"column":35,"nodeType":"Literal","messageId":"noMagic","endLine":116,"endColumn":38},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":131,"column":32,"nodeType":"Literal","messageId":"noMagic","endLine":131,"endColumn":35},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 6.","line":143,"column":56,"nodeType":"Literal","messageId":"noMagic","endLine":143,"endColumn":57},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":157,"column":34,"nodeType":"Literal","messageId":"noMagic","endLine":157,"endColumn":37},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 3.","line":158,"column":48,"nodeType":"Literal","messageId":"noMagic","endLine":158,"endColumn":49},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 3.","line":159,"column":37,"nodeType":"Literal","messageId":"noMagic","endLine":159,"endColumn":38},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: -50.","line":160,"column":35,"nodeType":"UnaryExpression","messageId":"noMagic","endLine":160,"endColumn":38},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":160,"column":44,"nodeType":"Literal","messageId":"noMagic","endLine":160,"endColumn":47},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 3.","line":161,"column":49,"nodeType":"Literal","messageId":"noMagic","endLine":161,"endColumn":50},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":177,"column":40,"nodeType":"Literal","messageId":"noMagic","endLine":177,"endColumn":43},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":179,"column":34,"nodeType":"Literal","messageId":"noMagic","endLine":179,"endColumn":37},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":219,"column":42,"nodeType":"Literal","messageId":"noMagic","endLine":219,"endColumn":45},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 200.","line":223,"column":32,"nodeType":"Literal","messageId":"noMagic","endLine":223,"endColumn":35},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":224,"column":36,"nodeType":"Literal","messageId":"noMagic","endLine":224,"endColumn":39},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":225,"column":29,"nodeType":"Literal","messageId":"noMagic","endLine":225,"endColumn":32},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":238,"column":40,"nodeType":"Literal","messageId":"noMagic","endLine":238,"endColumn":43},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":251,"column":35,"nodeType":"Literal","messageId":"noMagic","endLine":251,"endColumn":38},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":300,"column":33,"nodeType":"Literal","messageId":"noMagic","endLine":300,"endColumn":35},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1024.","line":300,"column":38,"nodeType":"Literal","messageId":"noMagic","endLine":300,"endColumn":42},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1024.","line":300,"column":45,"nodeType":"Literal","messageId":"noMagic","endLine":300,"endColumn":49}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":32,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * ËæìÂÖ•È™åËØÅ‰∏≠Èó¥‰ª∂\n * ‰ΩøÁî®JoiËøõË°åËØ∑Ê±ÇÊï∞ÊçÆÈ™åËØÅÂíåÊ∏ÖÁêÜ\n */\n\nimport Joi from 'joi';\nimport { ValidationError } from '../utils/errorHandler.js';\n\n/**\n * ÈÄöÁî®È™åËØÅ‰∏≠Èó¥‰ª∂\n * @param {Object} schema - JoiÈ™åËØÅÊ®°Âºè\n * @param {Object} options - È™åËØÅÈÄâÈ°π\n */\nexport const validateRequest = (schema, options = {}) => {\n  const defaultOptions = {\n    abortEarly: false, // ËøîÂõûÊâÄÊúâÈ™åËØÅÈîôËØØ\n    allowUnknown: false, // ‰∏çÂÖÅËÆ∏Êú™Áü•Â≠óÊÆµ\n    stripUnknown: true, // ÁßªÈô§Êú™Áü•Â≠óÊÆµ\n    ...options\n  };\n\n  return (req, res, next) => {\n    const dataToValidate = {\n      body: req.body || {},\n      query: req.query || {},\n      params: req.params || {},\n      headers: req.headers || {}\n    };\n\n    const { error, value } = schema.validate(dataToValidate, defaultOptions);\n\n    if (error) {\n      const errorMessage = error.details.map((detail) => detail.message).join('; ');\n\n      const field = error.details[0]?.path?.join('.') || null;\n\n      return next(new ValidationError(errorMessage, field));\n    }\n\n    // Â∞ÜÈ™åËØÅÂêéÁöÑÊï∞ÊçÆÊõøÊç¢ÂéüÂßãÊï∞ÊçÆ\n    req.body = value.body || {};\n    req.query = value.query || {};\n    req.params = value.params || {};\n\n    next();\n  };\n};\n\n/**\n * Ëá™ÂÆö‰πâÈ™åËØÅËßÑÂàô\n */\nconst customValidators = {\n  // ËÆæÂ§áIDÈ™åËØÅ\n  deviceId: Joi.string()\n    .pattern(/^[a-zA-Z0-9_-]+$/)\n    .min(3)\n    .max(50)\n    .messages({\n      'string.pattern.base': 'ËÆæÂ§áIDÂè™ËÉΩÂåÖÂê´Â≠óÊØç„ÄÅÊï∞Â≠ó„ÄÅ‰∏ãÂàíÁ∫øÂíåËøûÂ≠óÁ¨¶',\n      'string.min': 'ËÆæÂ§áIDÈïøÂ∫¶Ëá≥Â∞ë3‰∏™Â≠óÁ¨¶',\n      'string.max': 'ËÆæÂ§áIDÈïøÂ∫¶‰∏çËÉΩË∂ÖËøá50‰∏™Â≠óÁ¨¶'\n    }),\n\n  // Êó∂Èó¥Êà≥È™åËØÅ\n  timestamp: Joi.date().iso().max('now').messages({\n    'date.format': 'Êó∂Èó¥Êà≥ÂøÖÈ°ªÊòØÊúâÊïàÁöÑISO 8601Ê†ºÂºè',\n    'date.max': 'Êó∂Èó¥Êà≥‰∏çËÉΩÊòØÊú™Êù•Êó∂Èó¥'\n  }),\n\n  // ËÉΩËÄóÂÄºÈ™åËØÅ\n  energyValue: Joi.number().positive().precision(3).max(999999).messages({\n    'number.positive': 'ËÉΩËÄóÂÄºÂøÖÈ°ª‰∏∫Ê≠£Êï∞',\n    'number.precision': 'ËÉΩËÄóÂÄºÊúÄÂ§ö‰øùÁïô3‰ΩçÂ∞èÊï∞',\n    'number.max': 'ËÉΩËÄóÂÄº‰∏çËÉΩË∂ÖËøá999999'\n  }),\n\n  // Á¢≥ÊéíÊîæÂÄºÈ™åËØÅ\n  carbonValue: Joi.number().min(0).precision(6).max(999999).messages({\n    'number.min': 'Á¢≥ÊéíÊîæÂÄº‰∏çËÉΩ‰∏∫Ë¥üÊï∞',\n    'number.precision': 'Á¢≥ÊéíÊîæÂÄºÊúÄÂ§ö‰øùÁïô6‰ΩçÂ∞èÊï∞',\n    'number.max': 'Á¢≥ÊéíÊîæÂÄº‰∏çËÉΩË∂ÖËøá999999'\n  }),\n\n  // ÂàÜÈ°µÂèÇÊï∞È™åËØÅ\n  pagination: {\n    page: Joi.number().integer().min(1).default(1),\n    limit: Joi.number().integer().min(1).max(100).default(20),\n    offset: Joi.number().integer().min(0)\n  },\n\n  // Êó∂Èó¥ËåÉÂõ¥È™åËØÅ\n  timeRange: {\n    startTime: Joi.date().iso().required(),\n    endTime: Joi.date().iso().min(Joi.ref('startTime')).required()\n  },\n\n  // Áî®Êà∑ÂêçÈ™åËØÅ\n  username: Joi.string().alphanum().min(3).max(30).messages({\n    'string.alphanum': 'Áî®Êà∑ÂêçÂè™ËÉΩÂåÖÂê´Â≠óÊØçÂíåÊï∞Â≠ó',\n    'string.min': 'Áî®Êà∑ÂêçÈïøÂ∫¶Ëá≥Â∞ë3‰∏™Â≠óÁ¨¶',\n    'string.max': 'Áî®Êà∑ÂêçÈïøÂ∫¶‰∏çËÉΩË∂ÖËøá30‰∏™Â≠óÁ¨¶'\n  }),\n\n  // ÂØÜÁ†ÅÈ™åËØÅ\n  password: Joi.string()\n    .min(8)\n    .max(128)\n    .pattern(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[@$!%*?&])[A-Za-z\\d@$!%*?&]$/)\n    .messages({\n      'string.min': 'ÂØÜÁ†ÅÈïøÂ∫¶Ëá≥Â∞ë8‰∏™Â≠óÁ¨¶',\n      'string.max': 'ÂØÜÁ†ÅÈïøÂ∫¶‰∏çËÉΩË∂ÖËøá128‰∏™Â≠óÁ¨¶',\n      'string.pattern.base': 'ÂØÜÁ†ÅÂøÖÈ°ªÂåÖÂê´Â§ßÂ∞èÂÜôÂ≠óÊØç„ÄÅÊï∞Â≠óÂíåÁâπÊÆäÂ≠óÁ¨¶'\n    }),\n\n  // ÈÇÆÁÆ±È™åËØÅ\n  email: Joi.string().email().max(255).messages({\n    'string.email': 'ÈÇÆÁÆ±Ê†ºÂºèÊó†Êïà',\n    'string.max': 'ÈÇÆÁÆ±ÈïøÂ∫¶‰∏çËÉΩË∂ÖËøá255‰∏™Â≠óÁ¨¶'\n  })\n};\n\n/**\n * ËÉΩÊ∫êÊï∞ÊçÆÈ™åËØÅÊ®°Âºè\n */\nexport const energyDataSchema = Joi.object({\n  body: Joi.object({\n    device_id: customValidators.deviceId.required(),\n    value: customValidators.energyValue.required(),\n    unit: Joi.string().valid('kWh', 'MWh', 'GWh').required(),\n    timestamp: customValidators.timestamp.required(),\n    location: Joi.string().max(100).optional(),\n    metadata: Joi.object().optional()\n  })\n});\n\n/**\n * Á¢≥ÊéíÊîæÊï∞ÊçÆÈ™åËØÅÊ®°Âºè\n */\nexport const carbonDataSchema = Joi.object({\n  body: Joi.object({\n    device_id: customValidators.deviceId.required(),\n    emission_value: customValidators.carbonValue.required(),\n    emission_factor: Joi.number().positive().precision(6).required(),\n    energy_consumption: customValidators.energyValue.required(),\n    timestamp: customValidators.timestamp.required(),\n    calculation_method: Joi.string().valid('direct', 'indirect', 'lifecycle').default('direct'),\n    metadata: Joi.object().optional()\n  })\n});\n\n/**\n * ÁîµÊ±†Êï∞ÊçÆÈ™åËØÅÊ®°Âºè\n */\nexport const batteryDataSchema = Joi.object({\n  body: Joi.object({\n    device_id: customValidators.deviceId.required(),\n    soc: Joi.number().min(0).max(100).precision(2).required(), // ÁîµÈáèÁôæÂàÜÊØî\n    voltage: Joi.number().positive().precision(3).required(),\n    current: Joi.number().precision(3).required(), // ÂèØ‰ª•‰∏∫Ë¥üÊï∞ÔºàÊîæÁîµÔºâ\n    temperature: Joi.number().min(-50).max(100).precision(2).required(),\n    capacity: Joi.number().positive().precision(3).required(),\n    cycle_count: Joi.number().integer().min(0).optional(),\n    health_status: Joi.string().valid('good', 'warning', 'critical').default('good'),\n    timestamp: customValidators.timestamp.required(),\n    metadata: Joi.object().optional()\n  })\n});\n\n/**\n * Áî®Êà∑Ê≥®ÂÜåÈ™åËØÅÊ®°Âºè\n */\nexport const userRegistrationSchema = Joi.object({\n  body: Joi.object({\n    username: customValidators.username.required(),\n    password: customValidators.password.required(),\n    email: customValidators.email.required(),\n    full_name: Joi.string().min(2).max(100).required(),\n    role: Joi.string().valid('admin', 'operator', 'viewer').default('viewer'),\n    department: Joi.string().max(100).optional(),\n    phone: Joi.string()\n      .pattern(/^\\+?[1-9]\\d{1,14}$/)\n      .optional()\n  })\n});\n\n/**\n * Áî®Êà∑ÁôªÂΩïÈ™åËØÅÊ®°Âºè\n */\nexport const userLoginSchema = Joi.object({\n  body: Joi.object({\n    username: Joi.string().required(),\n    password: Joi.string().required(),\n    remember_me: Joi.boolean().default(false)\n  })\n});\n\n/**\n * Êï∞ÊçÆÊü•ËØ¢È™åËØÅÊ®°Âºè\n */\nexport const dataQuerySchema = Joi.object({\n  query: Joi.object({\n    device_id: customValidators.deviceId.optional(),\n    start_time: Joi.date().iso().optional(),\n    end_time: Joi.date().iso().min(Joi.ref('start_time')).optional(),\n    page: customValidators.pagination.page,\n    limit: customValidators.pagination.limit,\n    sort_by: Joi.string().valid('timestamp', 'value', 'device_id').default('timestamp'),\n    sort_order: Joi.string().valid('asc', 'desc').default('desc'),\n    aggregation: Joi.string().valid('none', 'hourly', 'daily', 'monthly').default('none')\n  })\n});\n\n/**\n * ËÆæÂ§áÁÆ°ÁêÜÈ™åËØÅÊ®°Âºè\n */\nexport const deviceSchema = Joi.object({\n  body: Joi.object({\n    device_id: customValidators.deviceId.required(),\n    device_name: Joi.string().min(2).max(100).required(),\n    device_type: Joi.string()\n      .valid('energy_meter', 'carbon_sensor', 'battery', 'solar_panel', 'wind_turbine')\n      .required(),\n    location: Joi.string().max(200).required(),\n    manufacturer: Joi.string().max(100).optional(),\n    model: Joi.string().max(100).optional(),\n    installation_date: Joi.date().iso().max('now').optional(),\n    status: Joi.string().valid('active', 'inactive', 'maintenance').default('active'),\n    specifications: Joi.object().optional(),\n    metadata: Joi.object().optional()\n  })\n});\n\n/**\n * ÂëäË≠¶ËßÑÂàôÈ™åËØÅÊ®°Âºè\n */\nexport const alertRuleSchema = Joi.object({\n  body: Joi.object({\n    rule_name: Joi.string().min(2).max(100).required(),\n    device_id: customValidators.deviceId.optional(),\n    metric_type: Joi.string()\n      .valid('energy', 'carbon', 'battery_soc', 'battery_temperature')\n      .required(),\n    condition: Joi.string().valid('>', '<', '>=', '<=', '==', '!=').required(),\n    threshold_value: Joi.number().required(),\n    severity: Joi.string().valid('low', 'medium', 'high', 'critical').required(),\n    enabled: Joi.boolean().default(true),\n    notification_channels: Joi.array()\n      .items(Joi.string().valid('email', 'sms', 'webhook'))\n      .min(1)\n      .required(),\n    description: Joi.string().max(500).optional()\n  })\n});\n\n/**\n * Êä•ÂëäÁîüÊàêÈ™åËØÅÊ®°Âºè\n */\nexport const reportGenerationSchema = Joi.object({\n  body: Joi.object({\n    report_type: Joi.string()\n      .valid('energy_consumption', 'carbon_emission', 'battery_performance', 'comprehensive')\n      .required(),\n    start_time: Joi.date().iso().required(),\n    end_time: Joi.date().iso().min(Joi.ref('start_time')).required(),\n    device_ids: Joi.array().items(customValidators.deviceId).optional(),\n    aggregation_level: Joi.string().valid('hourly', 'daily', 'weekly', 'monthly').default('daily'),\n    include_charts: Joi.boolean().default(true),\n    format: Joi.string().valid('pdf', 'excel', 'csv').default('pdf'),\n    email_recipients: Joi.array().items(customValidators.email).optional()\n  })\n});\n\n/**\n * IDÂèÇÊï∞È™åËØÅÊ®°Âºè\n */\nexport const idParamSchema = Joi.object({\n  params: Joi.object({\n    id: Joi.string()\n      .pattern(/^[0-9]+$/)\n      .required()\n      .messages({\n        'string.pattern.base': 'IDÂøÖÈ°ªÊòØÊúâÊïàÁöÑÊï∞Â≠ó'\n      })\n  })\n});\n\n/**\n * ËÆæÂ§áIDÂèÇÊï∞È™åËØÅÊ®°Âºè\n */\nexport const deviceIdParamSchema = Joi.object({\n  params: Joi.object({\n    deviceId: customValidators.deviceId.required()\n  })\n});\n\n/**\n * Êñá‰ª∂‰∏ä‰º†È™åËØÅ\n */\nexport const validateFileUpload =\n  (allowedTypes = [], maxSize = 10 * 1024 * 1024) =>\n    (req, res, next) => {\n      if (!req.file && !req.files) {\n        return next(new ValidationError('Êú™ÊâæÂà∞‰∏ä‰º†ÁöÑÊñá‰ª∂'));\n      }\n\n      const files = req.files || [req.file];\n\n      for (const file of files) {\n      // Ê£ÄÊü•Êñá‰ª∂Á±ªÂûã\n        if (allowedTypes.length > 0 && !allowedTypes.includes(file.mimetype)) {\n          return next(\n            new ValidationError(\n              `‰∏çÊîØÊåÅÁöÑÊñá‰ª∂Á±ªÂûã: ${file.mimetype}ÔºåÊîØÊåÅÁöÑÁ±ªÂûã: ${allowedTypes.join(', ')}`\n            )\n          );\n        }\n\n        // Ê£ÄÊü•Êñá‰ª∂Â§ßÂ∞è\n        if (file.size > maxSize) {\n          return next(\n            new ValidationError(`Êñá‰ª∂Â§ßÂ∞èË∂ÖËøáÈôêÂà∂: ${file.size} bytesÔºåÊúÄÂ§ßÂÖÅËÆ∏: ${maxSize} bytes`)\n          );\n        }\n\n        // Ê£ÄÊü•Êñá‰ª∂Âêç\n        if (!/^[a-zA-Z0-9._-]+$/.test(file.originalname)) {\n          return next(new ValidationError('Êñá‰ª∂ÂêçÂåÖÂê´ÈùûÊ≥ïÂ≠óÁ¨¶'));\n        }\n      }\n\n      next();\n    };\n\n/**\n * ËØ∑Ê±ÇÂ§¥È™åËØÅ\n */\nexport const validateHeaders =\n  (requiredHeaders = []) =>\n    (req, res, next) => {\n      for (const header of requiredHeaders) {\n        if (!req.headers[header.toLowerCase()]) {\n          return next(new ValidationError(`Áº∫Â∞ëÂøÖÈúÄÁöÑËØ∑Ê±ÇÂ§¥: ${header}`));\n        }\n      }\n      next();\n    };\n\n/**\n * ÂÜÖÂÆπÁ±ªÂûãÈ™åËØÅ\n */\nexport const validateContentType =\n  (allowedTypes = ['application/json']) =>\n    (req, res, next) => {\n      const contentType = req.headers['content-type'];\n\n      if (!contentType) {\n        return next(new ValidationError('Áº∫Â∞ëContent-TypeËØ∑Ê±ÇÂ§¥'));\n      }\n\n      const isAllowed = allowedTypes.some((type) =>\n        contentType.toLowerCase().includes(type.toLowerCase())\n      );\n\n      if (!isAllowed) {\n        return next(\n          new ValidationError(\n            `‰∏çÊîØÊåÅÁöÑContent-Type: ${contentType}ÔºåÊîØÊåÅÁöÑÁ±ªÂûã: ${allowedTypes.join(', ')}`\n          )\n        );\n      }\n\n      next();\n    };\n\nexport default {\n  validateRequest,\n  energyDataSchema,\n  carbonDataSchema,\n  batteryDataSchema,\n  userRegistrationSchema,\n  userLoginSchema,\n  dataQuerySchema,\n  deviceSchema,\n  alertRuleSchema,\n  reportGenerationSchema,\n  idParamSchema,\n  deviceIdParamSchema,\n  validateFileUpload,\n  validateHeaders,\n  validateContentType\n};\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/interfaces/http/recommendationController.js","messages":[{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":13,"column":25,"nodeType":"Literal","messageId":"noMagic","endLine":13,"endColumn":28},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 201.","line":17,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":17,"endColumn":19},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":22,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":22,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[560,594],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":23,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":23,"endColumn":19},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 200.","line":43,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":43,"endColumn":19},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":45,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":45,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[1115,1149],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":46,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":46,"endColumn":19},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 404.","line":62,"column":25,"nodeType":"Literal","messageId":"noMagic","endLine":62,"endColumn":28},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 200.","line":65,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":65,"endColumn":19},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":67,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":67,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[1609,1643],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":68,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":68,"endColumn":19},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":84,"column":25,"nodeType":"Literal","messageId":"noMagic","endLine":84,"endColumn":28},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 404.","line":89,"column":25,"nodeType":"Literal","messageId":"noMagic","endLine":89,"endColumn":28},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 200.","line":92,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":92,"endColumn":19},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":97,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":97,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[2289,2323],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":98,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":98,"endColumn":19},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":114,"column":25,"nodeType":"Literal","messageId":"noMagic","endLine":114,"endColumn":28},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 404.","line":119,"column":25,"nodeType":"Literal","messageId":"noMagic","endLine":119,"endColumn":28},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 200.","line":122,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":122,"endColumn":19},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":127,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":127,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[3021,3057],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":128,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":128,"endColumn":19},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 404.","line":144,"column":25,"nodeType":"Literal","messageId":"noMagic","endLine":144,"endColumn":28},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 200.","line":147,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":147,"endColumn":19},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":149,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":149,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[3554,3588],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":150,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":150,"endColumn":19},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":166,"column":25,"nodeType":"Literal","messageId":"noMagic","endLine":166,"endColumn":28},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 200.","line":170,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":170,"endColumn":19},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":176,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":176,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[4185,4217],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":177,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":177,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":29,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import Recommendation from '../models/recommendation.js';\nimport { validationResult } from 'express-validator';\n\n/**\n * ÂàõÂª∫Êé®ËçêËßÑÂàô\n * @route POST /api/recommendations/rules\n * @access Private\n */\nexport const createRecommendationRule = async (req, res) => {\n  try {\n    const errors = validationResult(req);\n    if (!errors.isEmpty()) {\n      return res.status(400).json({ errors: errors.array() });\n    }\n\n    const rule = await Recommendation.createRule(req.body);\n    res.status(201).json({\n      message: 'Êé®ËçêËßÑÂàôÂàõÂª∫ÊàêÂäü',\n      rule\n    });\n  } catch (error) {\n    console.error('ÂàõÂª∫Êé®ËçêËßÑÂàôÂ§±Ë¥•:', error);\n    res.status(500).json({\n      message: 'ÂàõÂª∫Êé®ËçêËßÑÂàôÂ§±Ë¥•',\n      error: error.message\n    });\n  }\n};\n\n/**\n * Ëé∑ÂèñÊâÄÊúâÊé®ËçêËßÑÂàô\n * @route GET /api/recommendations/rules\n * @access Private\n */\nexport const getAllRecommendationRules = async (req, res) => {\n  try {\n    const filters = {\n      type: req.query.type,\n      is_active: req.query.is_active !== undefined ? req.query.is_active === 'true' : undefined\n    };\n\n    const rules = await Recommendation.getAllRules(filters);\n    res.status(200).json(rules);\n  } catch (error) {\n    console.error('Ëé∑ÂèñÊé®ËçêËßÑÂàôÂ§±Ë¥•:', error);\n    res.status(500).json({\n      message: 'Ëé∑ÂèñÊé®ËçêËßÑÂàôÂ§±Ë¥•',\n      error: error.message\n    });\n  }\n};\n\n/**\n * Ê†πÊçÆIDËé∑ÂèñÊé®ËçêËßÑÂàô\n * @route GET /api/recommendations/rules/:id\n * @access Private\n */\nexport const getRecommendationRuleById = async (req, res) => {\n  try {\n    const rule = await Recommendation.getRuleById(req.params.id);\n    if (!rule) {\n      return res.status(404).json({ message: 'Êé®ËçêËßÑÂàô‰∏çÂ≠òÂú®' });\n    }\n\n    res.status(200).json(rule);\n  } catch (error) {\n    console.error('Ëé∑ÂèñÊé®ËçêËßÑÂàôÂ§±Ë¥•:', error);\n    res.status(500).json({\n      message: 'Ëé∑ÂèñÊé®ËçêËßÑÂàôÂ§±Ë¥•',\n      error: error.message\n    });\n  }\n};\n\n/**\n * Êõ¥Êñ∞Êé®ËçêËßÑÂàô\n * @route PUT /api/recommendations/rules/:id\n * @access Private\n */\nexport const updateRecommendationRule = async (req, res) => {\n  try {\n    const errors = validationResult(req);\n    if (!errors.isEmpty()) {\n      return res.status(400).json({ errors: errors.array() });\n    }\n\n    const rule = await Recommendation.updateRule(req.params.id, req.body);\n    if (!rule) {\n      return res.status(404).json({ message: 'Êé®ËçêËßÑÂàô‰∏çÂ≠òÂú®' });\n    }\n\n    res.status(200).json({\n      message: 'Êé®ËçêËßÑÂàôÊõ¥Êñ∞ÊàêÂäü',\n      rule\n    });\n  } catch (error) {\n    console.error('Êõ¥Êñ∞Êé®ËçêËßÑÂàôÂ§±Ë¥•:', error);\n    res.status(500).json({\n      message: 'Êõ¥Êñ∞Êé®ËçêËßÑÂàôÂ§±Ë¥•',\n      error: error.message\n    });\n  }\n};\n\n/**\n * ÊøÄÊ¥ª/Á¶ÅÁî®Êé®ËçêËßÑÂàô\n * @route PATCH /api/recommendations/rules/:id/status\n * @access Private\n */\nexport const toggleRecommendationRuleStatus = async (req, res) => {\n  try {\n    const { is_active } = req.body;\n    if (is_active === undefined) {\n      return res.status(400).json({ message: 'ÂøÖÈ°ªÊèê‰æõis_activeÂèÇÊï∞' });\n    }\n\n    const rule = await Recommendation.toggleRuleStatus(req.params.id, is_active);\n    if (!rule) {\n      return res.status(404).json({ message: 'Êé®ËçêËßÑÂàô‰∏çÂ≠òÂú®' });\n    }\n\n    res.status(200).json({\n      message: `Êé®ËçêËßÑÂàôÂ∑≤${is_active ? 'ÊøÄÊ¥ª' : 'Á¶ÅÁî®'}`,\n      rule\n    });\n  } catch (error) {\n    console.error('Êõ¥Êñ∞Êé®ËçêËßÑÂàôÁä∂ÊÄÅÂ§±Ë¥•:', error);\n    res.status(500).json({\n      message: 'Êõ¥Êñ∞Êé®ËçêËßÑÂàôÁä∂ÊÄÅÂ§±Ë¥•',\n      error: error.message\n    });\n  }\n};\n\n/**\n * Âà†Èô§Êé®ËçêËßÑÂàô\n * @route DELETE /api/recommendations/rules/:id\n * @access Private\n */\nexport const deleteRecommendationRule = async (req, res) => {\n  try {\n    const deletedRows = await Recommendation.deleteRule(req.params.id);\n    if (deletedRows === 0) {\n      return res.status(404).json({ message: 'Êé®ËçêËßÑÂàô‰∏çÂ≠òÂú®' });\n    }\n\n    res.status(200).json({ message: 'Êé®ËçêËßÑÂàôÂà†Èô§ÊàêÂäü' });\n  } catch (error) {\n    console.error('Âà†Èô§Êé®ËçêËßÑÂàôÂ§±Ë¥•:', error);\n    res.status(500).json({\n      message: 'Âà†Èô§Êé®ËçêËßÑÂàôÂ§±Ë¥•',\n      error: error.message\n    });\n  }\n};\n\n/**\n * ÁîüÊàêÊé®Ëçê\n * @route POST /api/recommendations/generate\n * @access Private\n */\nexport const generateRecommendations = async (req, res) => {\n  try {\n    const { context } = req.body;\n    if (!context) {\n      return res.status(400).json({ message: 'ÂøÖÈ°ªÊèê‰æõÁî®Êà∑‰∏ä‰∏ãÊñáÊï∞ÊçÆ' });\n    }\n\n    const recommendations = await Recommendation.generateRecommendations(context);\n    res.status(200).json({\n      message: 'Êé®ËçêÁîüÊàêÊàêÂäü',\n      count: recommendations.length,\n      recommendations\n    });\n  } catch (error) {\n    console.error('ÁîüÊàêÊé®ËçêÂ§±Ë¥•:', error);\n    res.status(500).json({\n      message: 'ÁîüÊàêÊé®ËçêÂ§±Ë¥•',\n      error: error.message\n    });\n  }\n};\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/interfaces/http/routes.js","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":98,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":98,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[2318,2596],"text":""},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * ‰∏ªË∑ØÁî±Êñá‰ª∂ - ÈáçÊûÑÂêéÁöÑÊ®°ÂùóÂåñÁâàÊú¨\n * Êï¥ÂêàÊâÄÊúâÂ≠êË∑ØÁî±Ê®°Âùó\n */\n\nimport express from 'express';\nimport responseFormatter from './middleware/responseFormatter.js';\nimport { authenticate } from './middleware/authMiddleware.js';\n\n// ÂØºÂÖ•Ê®°ÂùóÂåñË∑ØÁî±\nimport authRoutes from './routes/auth.js';\nimport deviceRoutes from './routes/devices.js';\nimport energyRoutes from './routes/energy.js';\nimport carbonRoutes from './routes/carbon.js';\nimport maintenanceRoutes from './routes/maintenance.js';\nimport digitalTwinRoutes from './routes/digital-twin.js';\n\nconst router = express.Router();\n\n// Â∫îÁî®ÂìçÂ∫îÊ†ºÂºèÂåñ‰∏≠Èó¥‰ª∂\nrouter.use(responseFormatter);\n\n// APIÊ†πË∑ØÂæÑ‰ø°ÊÅØ\nrouter.get('/', (req, res) => {\n  res.success({\n    message: 'Èõ∂Á¢≥Âõ≠Âå∫Êï∞Â≠óÂ≠™ÁîüËÉΩÁ¢≥ÁÆ°ÁêÜÁ≥ªÁªü API',\n    version: '2.0.0',\n    status: 'running',\n    timestamp: new Date().toISOString(),\n    endpoints: {\n      auth: '/auth',\n      devices: '/devices',\n      energy: '/energy',\n      carbon: '/carbon',\n      maintenance: '/maintenance',\n      digitalTwin: '/digital-twin'\n    }\n  });\n});\n\n// ÂÅ•Â∫∑Ê£ÄÊü•Á´ØÁÇπ\nrouter.get('/health', (req, res) => {\n  res.healthCheck({\n    status: 'healthy',\n    timestamp: new Date().toISOString(),\n    uptime: process.uptime(),\n    memory: process.memoryUsage(),\n    version: '2.0.0'\n  });\n});\n\n// APIÁâàÊú¨‰ø°ÊÅØ\nrouter.get('/version', (req, res) => {\n  res.success({\n    version: '2.0.0',\n    apiVersion: 'v1',\n    buildDate: new Date().toISOString(),\n    features: [\n      'modular-architecture',\n      'enhanced-security',\n      'improved-validation',\n      'better-error-handling',\n      'comprehensive-logging'\n    ]\n  });\n});\n\n// ÊåÇËΩΩÂ≠êË∑ØÁî±\nrouter.use('/auth', authRoutes);\nrouter.use('/devices', authenticate, deviceRoutes);\nrouter.use('/energy', authenticate, energyRoutes);\nrouter.use('/carbon', authenticate, carbonRoutes);\nrouter.use('/maintenance', authenticate, maintenanceRoutes);\nrouter.use('/digital-twin', authenticate, digitalTwinRoutes);\n\n// 404Â§ÑÁêÜ\nrouter.use('*', (req, res) => {\n  res.notFound('APIÁ´ØÁÇπ‰∏çÂ≠òÂú®', {\n    requestedPath: req.originalUrl,\n    method: req.method,\n    availableEndpoints: [\n      'GET /',\n      'GET /health',\n      'GET /version',\n      'POST /auth/login',\n      'POST /auth/register',\n      'GET /devices',\n      'GET /energy',\n      'GET /carbon',\n      'GET /maintenance',\n      'GET /digital-twin'\n    ]\n  });\n});\n\n// ÂÖ®Â±ÄÈîôËØØÂ§ÑÁêÜ‰∏≠Èó¥‰ª∂\nrouter.use((error, req, res, _next) => {\n  console.error(`[${new Date().toISOString()}] Global Error Handler:`, {\n    error: error.message,\n    stack: error.stack,\n    url: req.url,\n    method: req.method,\n    user: req.user?.username || 'anonymous',\n    body: req.body,\n    params: req.params,\n    query: req.query\n  });\n\n  // Ê†πÊçÆÈîôËØØÁ±ªÂûãËøîÂõûÁõ∏Â∫îÁöÑÂìçÂ∫î\n  if (error.name === 'ValidationError') {\n    return res.validationError('Êï∞ÊçÆÈ™åËØÅÂ§±Ë¥•', error.details);\n  } else if (error.name === 'UnauthorizedError') {\n    return res.unauthorized(error.message);\n  } else if (error.name === 'ForbiddenError') {\n    return res.forbidden(error.message);\n  } else if (error.name === 'NotFoundError') {\n    return res.notFound(error.message);\n  } else if (error.name === 'ConflictError') {\n    return res.conflict(error.message);\n  } else if (error.name === 'TooManyRequestsError') {\n    return res.tooManyRequests(error.message);\n  } \n  return res.internalError('ÊúçÂä°Âô®ÂÜÖÈÉ®ÈîôËØØ', error);\n  \n});\n\nexport default router;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/interfaces/http/routes/auth.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/interfaces/http/routes/carbon.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/interfaces/http/routes/devices.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/interfaces/http/routes/digital-twin.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/interfaces/http/routes/digitalTwin.js","messages":[{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":23,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":23,"endColumn":21},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1024.","line":23,"column":24,"nodeType":"Literal","messageId":"noMagic","endLine":23,"endColumn":28},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1024.","line":23,"column":31,"nodeType":"Literal","messageId":"noMagic","endLine":23,"endColumn":35},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":70,"column":55,"nodeType":"Literal","messageId":"noMagic","endLine":70,"endColumn":58},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":105,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":105,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[3817,3855],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":106,"column":52,"nodeType":"Literal","messageId":"noMagic","endLine":106,"endColumn":55},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":119,"column":55,"nodeType":"Literal","messageId":"noMagic","endLine":119,"endColumn":58},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 404.","line":124,"column":58,"nodeType":"Literal","messageId":"noMagic","endLine":124,"endColumn":61},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":129,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":129,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[4483,4521],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":130,"column":52,"nodeType":"Literal","messageId":"noMagic","endLine":130,"endColumn":55},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":144,"column":55,"nodeType":"Literal","messageId":"noMagic","endLine":144,"endColumn":58},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 409.","line":158,"column":56,"nodeType":"Literal","messageId":"noMagic","endLine":158,"endColumn":59},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 201.","line":163,"column":73,"nodeType":"Literal","messageId":"noMagic","endLine":163,"endColumn":76},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":165,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":165,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[5432,5468],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":166,"column":50,"nodeType":"Literal","messageId":"noMagic","endLine":166,"endColumn":53},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":183,"column":55,"nodeType":"Literal","messageId":"noMagic","endLine":183,"endColumn":58},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 404.","line":188,"column":58,"nodeType":"Literal","messageId":"noMagic","endLine":188,"endColumn":61},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 409.","line":195,"column":58,"nodeType":"Literal","messageId":"noMagic","endLine":195,"endColumn":61},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":209,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":209,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[6657,6693],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":210,"column":50,"nodeType":"Literal","messageId":"noMagic","endLine":210,"endColumn":53},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":224,"column":55,"nodeType":"Literal","messageId":"noMagic","endLine":224,"endColumn":58},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 404.","line":229,"column":58,"nodeType":"Literal","messageId":"noMagic","endLine":229,"endColumn":61},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 409.","line":235,"column":62,"nodeType":"Literal","messageId":"noMagic","endLine":235,"endColumn":65},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":242,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":242,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[7540,7576],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":243,"column":50,"nodeType":"Literal","messageId":"noMagic","endLine":243,"endColumn":53},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":256,"column":55,"nodeType":"Literal","messageId":"noMagic","endLine":256,"endColumn":58},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 404.","line":261,"column":58,"nodeType":"Literal","messageId":"noMagic","endLine":261,"endColumn":61},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":268,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":268,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[8253,8287],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":269,"column":48,"nodeType":"Literal","messageId":"noMagic","endLine":269,"endColumn":51},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":287,"column":55,"nodeType":"Literal","messageId":"noMagic","endLine":287,"endColumn":58},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 404.","line":292,"column":58,"nodeType":"Literal","messageId":"noMagic","endLine":292,"endColumn":61},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 404.","line":300,"column":56,"nodeType":"Literal","messageId":"noMagic","endLine":300,"endColumn":59},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":307,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":307,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[9354,9386],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":308,"column":46,"nodeType":"Literal","messageId":"noMagic","endLine":308,"endColumn":49},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":322,"column":55,"nodeType":"Literal","messageId":"noMagic","endLine":322,"endColumn":58},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 3600.","line":325,"column":63,"nodeType":"Literal","messageId":"noMagic","endLine":325,"endColumn":67},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":325,"column":80,"nodeType":"Literal","messageId":"noMagic","endLine":325,"endColumn":82},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 404.","line":330,"column":58,"nodeType":"Literal","messageId":"noMagic","endLine":330,"endColumn":61},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":334,"column":60,"nodeType":"Literal","messageId":"noMagic","endLine":334,"endColumn":63},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 201.","line":350,"column":64,"nodeType":"Literal","messageId":"noMagic","endLine":350,"endColumn":67},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":352,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":352,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[10526,10558],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":353,"column":46,"nodeType":"Literal","messageId":"noMagic","endLine":353,"endColumn":49},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":366,"column":55,"nodeType":"Literal","messageId":"noMagic","endLine":366,"endColumn":58},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 404.","line":371,"column":54,"nodeType":"Literal","messageId":"noMagic","endLine":371,"endColumn":57},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":376,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":376,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[11195,11229],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":377,"column":48,"nodeType":"Literal","messageId":"noMagic","endLine":377,"endColumn":51},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":390,"column":55,"nodeType":"Literal","messageId":"noMagic","endLine":390,"endColumn":58},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":401,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":401,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[11890,11924],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":402,"column":48,"nodeType":"Literal","messageId":"noMagic","endLine":402,"endColumn":51},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":416,"column":55,"nodeType":"Literal","messageId":"noMagic","endLine":416,"endColumn":58},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 201.","line":427,"column":73,"nodeType":"Literal","messageId":"noMagic","endLine":427,"endColumn":76},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":429,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":429,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[12598,12632],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":430,"column":48,"nodeType":"Literal","messageId":"noMagic","endLine":430,"endColumn":51},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":443,"column":55,"nodeType":"Literal","messageId":"noMagic","endLine":443,"endColumn":58},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 404.","line":448,"column":58,"nodeType":"Literal","messageId":"noMagic","endLine":448,"endColumn":61},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":455,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":455,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[13321,13357],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":456,"column":50,"nodeType":"Literal","messageId":"noMagic","endLine":456,"endColumn":53},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":476,"column":55,"nodeType":"Literal","messageId":"noMagic","endLine":476,"endColumn":58},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 404.","line":481,"column":58,"nodeType":"Literal","messageId":"noMagic","endLine":481,"endColumn":61},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":494,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":494,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[14477,14509],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":495,"column":46,"nodeType":"Literal","messageId":"noMagic","endLine":495,"endColumn":49},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":507,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":507,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[14790,14826],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":508,"column":48,"nodeType":"Literal","messageId":"noMagic","endLine":508,"endColumn":51},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":523,"column":55,"nodeType":"Literal","messageId":"noMagic","endLine":523,"endColumn":58},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 404.","line":528,"column":58,"nodeType":"Literal","messageId":"noMagic","endLine":528,"endColumn":61},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":541,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":541,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[15873,15907],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":542,"column":48,"nodeType":"Literal","messageId":"noMagic","endLine":542,"endColumn":51}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":67,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const express = require('express');\nconst { body, query, param, validationResult } = require('express-validator');\nconst DigitalTwinModel = require('../../../core/entities/DigitalTwinModel');\nconst Device = require('../../../core/entities/Device');\nconst authMiddleware = require('../middleware/auth');\nconst responseFormatter = require('../middleware/responseFormatter');\nconst { requireRole } = require('../middleware/roleCheck');\n\nconst router = express.Router();\n\n// Â∫îÁî®ËÆ§ËØÅ‰∏≠Èó¥‰ª∂Âà∞ÊâÄÊúâË∑ØÁî±\nrouter.use(authMiddleware);\n\n// Â∏∏ÈáèÂÆö‰πâ\nconst DIGITAL_TWIN_CONSTANTS = {\n  MAX_MODELS_PER_PAGE: 50,\n  DEFAULT_PAGE_SIZE: 20,\n  MODEL_TYPES: ['building', 'equipment', 'system', 'zone', 'component'],\n  MODEL_STATUS: ['active', 'inactive', 'maintenance', 'error'],\n  SIMULATION_TYPES: ['energy', 'thermal', 'airflow', 'lighting', 'structural'],\n  VIEW_PRESETS: ['overview', 'energy_view', 'maintenance_view', 'security_view', 'custom'],\n  SUPPORTED_FORMATS: ['gltf', 'fbx', 'obj', 'ifc'],\n  MAX_FILE_SIZE: 100 * 1024 * 1024 // 100MB\n};\n\n// È™åËØÅËßÑÂàô\nconst digitalTwinValidation = [\n  body('name').notEmpty().withMessage('Ê®°ÂûãÂêçÁß∞‰∏çËÉΩ‰∏∫Á©∫'),\n  body('type').isIn(DIGITAL_TWIN_CONSTANTS.MODEL_TYPES).withMessage('Ê®°ÂûãÁ±ªÂûãÊó†Êïà'),\n  body('description').optional().isString().withMessage('ÊèèËø∞ÂøÖÈ°ªÊòØÂ≠óÁ¨¶‰∏≤'),\n  body('modelPath').notEmpty().withMessage('Ê®°ÂûãË∑ØÂæÑ‰∏çËÉΩ‰∏∫Á©∫'),\n  body('position').optional().isObject().withMessage('‰ΩçÁΩÆ‰ø°ÊÅØÂøÖÈ°ªÊòØÂØπË±°'),\n  body('rotation').optional().isObject().withMessage('ÊóãËΩ¨‰ø°ÊÅØÂøÖÈ°ªÊòØÂØπË±°'),\n  body('scale').optional().isObject().withMessage('Áº©Êîæ‰ø°ÊÅØÂøÖÈ°ªÊòØÂØπË±°'),\n  body('metadata').optional().isObject().withMessage('ÂÖÉÊï∞ÊçÆÂøÖÈ°ªÊòØÂØπË±°')\n];\n\nconst simulationValidation = [\n  body('modelId').isMongoId().withMessage('Ê®°ÂûãIDÊ†ºÂºèÊó†Êïà'),\n  body('simulationType').isIn(DIGITAL_TWIN_CONSTANTS.SIMULATION_TYPES).withMessage('‰ªøÁúüÁ±ªÂûãÊó†Êïà'),\n  body('parameters').isObject().withMessage('ÂèÇÊï∞ÂøÖÈ°ªÊòØÂØπË±°'),\n  body('duration').optional().isNumeric().withMessage('ÊåÅÁª≠Êó∂Èó¥ÂøÖÈ°ªÊòØÊï∞Â≠ó'),\n  body('timeStep').optional().isNumeric().withMessage('Êó∂Èó¥Ê≠•ÈïøÂøÖÈ°ªÊòØÊï∞Â≠ó')\n];\n\nconst viewPresetValidation = [\n  body('name').notEmpty().withMessage('ËßÜÂõæÂêçÁß∞‰∏çËÉΩ‰∏∫Á©∫'),\n  body('type').isIn(DIGITAL_TWIN_CONSTANTS.VIEW_PRESETS).withMessage('ËßÜÂõæÁ±ªÂûãÊó†Êïà'),\n  body('cameraPosition').isObject().withMessage('Áõ∏Êú∫‰ΩçÁΩÆÂøÖÈ°ªÊòØÂØπË±°'),\n  body('cameraTarget').isObject().withMessage('Áõ∏Êú∫ÁõÆÊ†áÂøÖÈ°ªÊòØÂØπË±°'),\n  body('visibleLayers').optional().isArray().withMessage('ÂèØËßÅÂõæÂ±ÇÂøÖÈ°ªÊòØÊï∞ÁªÑ'),\n  body('settings').optional().isObject().withMessage('ËÆæÁΩÆÂøÖÈ°ªÊòØÂØπË±°')\n];\n\n// Ëé∑ÂèñÊï∞Â≠óÂ≠™ÁîüÊ®°ÂûãÂàóË°®\nrouter.get(\n  '/models',\n  [\n    query('type').optional().isIn(DIGITAL_TWIN_CONSTANTS.MODEL_TYPES).withMessage('Ê®°ÂûãÁ±ªÂûãÊó†Êïà'),\n    query('status')\n      .optional()\n      .isIn(DIGITAL_TWIN_CONSTANTS.MODEL_STATUS)\n      .withMessage('Ê®°ÂûãÁä∂ÊÄÅÊó†Êïà'),\n    query('search').optional().isString().withMessage('ÊêúÁ¥¢ÂÖ≥ÈîÆËØçÂøÖÈ°ªÊòØÂ≠óÁ¨¶‰∏≤')\n  ],\n  async (req, res) => {\n    try {\n      const errors = validationResult(req);\n      if (!errors.isEmpty()) {\n        return responseFormatter.error(res, 'ËæìÂÖ•È™åËØÅÂ§±Ë¥•', 400, errors.array());\n      }\n\n      const {\n        page = 1,\n        limit = DIGITAL_TWIN_CONSTANTS.DEFAULT_PAGE_SIZE,\n        type,\n        status,\n        search\n      } = req.query;\n\n      const filters = {};\n      if (type) {filters.type = type;}\n      if (status) {filters.status = status;}\n      if (search) {\n        filters.$or = [\n          { name: { $regex: search, $options: 'i' } },\n          { description: { $regex: search, $options: 'i' } }\n        ];\n      }\n\n      const offset = (page - 1) * limit;\n      const models = await DigitalTwinModel.findWithPagination(filters, offset, parseInt(limit));\n      const total = await DigitalTwinModel.countDocuments(filters);\n\n      responseFormatter.success(res, 'Ëé∑ÂèñÊï∞Â≠óÂ≠™ÁîüÊ®°ÂûãÂàóË°®ÊàêÂäü', {\n        models,\n        pagination: {\n          page: parseInt(page),\n          limit: parseInt(limit),\n          total,\n          pages: Math.ceil(total / limit)\n        }\n      });\n    } catch (error) {\n      console.error('Ëé∑ÂèñÊï∞Â≠óÂ≠™ÁîüÊ®°ÂûãÂàóË°®ÈîôËØØ:', error);\n      responseFormatter.error(res, 'Ëé∑ÂèñÊï∞Â≠óÂ≠™ÁîüÊ®°ÂûãÂàóË°®Â§±Ë¥•', 500);\n    }\n  }\n);\n\n// Ëé∑ÂèñÂçï‰∏™Êï∞Â≠óÂ≠™ÁîüÊ®°ÂûãËØ¶ÊÉÖ\nrouter.get(\n  '/models/:id',\n  [param('id').isMongoId().withMessage('Ê®°ÂûãIDÊ†ºÂºèÊó†Êïà')],\n  async (req, res) => {\n    try {\n      const errors = validationResult(req);\n      if (!errors.isEmpty()) {\n        return responseFormatter.error(res, 'ËæìÂÖ•È™åËØÅÂ§±Ë¥•', 400, errors.array());\n      }\n\n      const model = await DigitalTwinModel.findByIdWithDetails(req.params.id);\n      if (!model) {\n        return responseFormatter.error(res, 'Êï∞Â≠óÂ≠™ÁîüÊ®°Âûã‰∏çÂ≠òÂú®', 404);\n      }\n\n      responseFormatter.success(res, 'Ëé∑ÂèñÊï∞Â≠óÂ≠™ÁîüÊ®°ÂûãËØ¶ÊÉÖÊàêÂäü', { model });\n    } catch (error) {\n      console.error('Ëé∑ÂèñÊï∞Â≠óÂ≠™ÁîüÊ®°ÂûãËØ¶ÊÉÖÈîôËØØ:', error);\n      responseFormatter.error(res, 'Ëé∑ÂèñÊï∞Â≠óÂ≠™ÁîüÊ®°ÂûãËØ¶ÊÉÖÂ§±Ë¥•', 500);\n    }\n  }\n);\n\n// ÂàõÂª∫Êï∞Â≠óÂ≠™ÁîüÊ®°Âûã\nrouter.post(\n  '/models',\n  requireRole(['admin', 'operator']),\n  digitalTwinValidation,\n  async (req, res) => {\n    try {\n      const errors = validationResult(req);\n      if (!errors.isEmpty()) {\n        return responseFormatter.error(res, 'ËæìÂÖ•È™åËØÅÂ§±Ë¥•', 400, errors.array());\n      }\n\n      const modelData = {\n        ...req.body,\n        status: 'active',\n        createdBy: req.user.userId,\n        createdAt: new Date(),\n        version: '1.0.0'\n      };\n\n      // Ê£ÄÊü•Ê®°ÂûãÂêçÁß∞ÊòØÂê¶Â∑≤Â≠òÂú®\n      const existingModel = await DigitalTwinModel.findByName(modelData.name);\n      if (existingModel) {\n        return responseFormatter.error(res, 'Ê®°ÂûãÂêçÁß∞Â∑≤Â≠òÂú®', 409);\n      }\n\n      const newModel = await DigitalTwinModel.create(modelData);\n\n      responseFormatter.success(res, 'Êï∞Â≠óÂ≠™ÁîüÊ®°ÂûãÂàõÂª∫ÊàêÂäü', { model: newModel }, 201);\n    } catch (error) {\n      console.error('ÂàõÂª∫Êï∞Â≠óÂ≠™ÁîüÊ®°ÂûãÈîôËØØ:', error);\n      responseFormatter.error(res, 'ÂàõÂª∫Êï∞Â≠óÂ≠™ÁîüÊ®°ÂûãÂ§±Ë¥•', 500);\n    }\n  }\n);\n\n// Êõ¥Êñ∞Êï∞Â≠óÂ≠™ÁîüÊ®°Âûã\nrouter.put(\n  '/models/:id',\n  requireRole(['admin', 'operator']),\n  [\n    param('id').isMongoId().withMessage('Ê®°ÂûãIDÊ†ºÂºèÊó†Êïà'),\n    ...digitalTwinValidation.map((rule) => rule.optional())\n  ],\n  async (req, res) => {\n    try {\n      const errors = validationResult(req);\n      if (!errors.isEmpty()) {\n        return responseFormatter.error(res, 'ËæìÂÖ•È™åËØÅÂ§±Ë¥•', 400, errors.array());\n      }\n\n      const model = await DigitalTwinModel.findById(req.params.id);\n      if (!model) {\n        return responseFormatter.error(res, 'Êï∞Â≠óÂ≠™ÁîüÊ®°Âûã‰∏çÂ≠òÂú®', 404);\n      }\n\n      // Â¶ÇÊûúÊõ¥Êñ∞Ê®°ÂûãÂêçÁß∞ÔºåÊ£ÄÊü•ÊòØÂê¶ÈáçÂ§ç\n      if (req.body.name && req.body.name !== model.name) {\n        const existingModel = await DigitalTwinModel.findByName(req.body.name);\n        if (existingModel) {\n          return responseFormatter.error(res, 'Ê®°ÂûãÂêçÁß∞Â∑≤Â≠òÂú®', 409);\n        }\n      }\n\n      const updateData = {\n        ...req.body,\n        updatedBy: req.user.userId,\n        updatedAt: new Date()\n      };\n\n      const updatedModel = await model.update(updateData);\n\n      responseFormatter.success(res, 'Êï∞Â≠óÂ≠™ÁîüÊ®°ÂûãÊõ¥Êñ∞ÊàêÂäü', { model: updatedModel });\n    } catch (error) {\n      console.error('Êõ¥Êñ∞Êï∞Â≠óÂ≠™ÁîüÊ®°ÂûãÈîôËØØ:', error);\n      responseFormatter.error(res, 'Êõ¥Êñ∞Êï∞Â≠óÂ≠™ÁîüÊ®°ÂûãÂ§±Ë¥•', 500);\n    }\n  }\n);\n\n// Âà†Èô§Êï∞Â≠óÂ≠™ÁîüÊ®°Âûã\nrouter.delete(\n  '/models/:id',\n  requireRole(['admin']),\n  [param('id').isMongoId().withMessage('Ê®°ÂûãIDÊ†ºÂºèÊó†Êïà')],\n  async (req, res) => {\n    try {\n      const errors = validationResult(req);\n      if (!errors.isEmpty()) {\n        return responseFormatter.error(res, 'ËæìÂÖ•È™åËØÅÂ§±Ë¥•', 400, errors.array());\n      }\n\n      const model = await DigitalTwinModel.findById(req.params.id);\n      if (!model) {\n        return responseFormatter.error(res, 'Êï∞Â≠óÂ≠™ÁîüÊ®°Âûã‰∏çÂ≠òÂú®', 404);\n      }\n\n      // Ê£ÄÊü•Ê®°ÂûãÊòØÂê¶ÊúâÂÖ≥ËÅîÁöÑËÆæÂ§áÊàñ‰ªøÁúü\n      const hasAssociations = await model.hasAssociations();\n      if (hasAssociations) {\n        return responseFormatter.error(res, 'Ê®°ÂûãÂ≠òÂú®ÂÖ≥ËÅîÊï∞ÊçÆÔºåÊó†Ê≥ïÂà†Èô§', 409);\n      }\n\n      await model.delete();\n\n      responseFormatter.success(res, 'Êï∞Â≠óÂ≠™ÁîüÊ®°ÂûãÂà†Èô§ÊàêÂäü');\n    } catch (error) {\n      console.error('Âà†Èô§Êï∞Â≠óÂ≠™ÁîüÊ®°ÂûãÈîôËØØ:', error);\n      responseFormatter.error(res, 'Âà†Èô§Êï∞Â≠óÂ≠™ÁîüÊ®°ÂûãÂ§±Ë¥•', 500);\n    }\n  }\n);\n\n// Ëé∑ÂèñÊ®°ÂûãÂÖ≥ËÅîÁöÑËÆæÂ§á\nrouter.get(\n  '/models/:id/devices',\n  [param('id').isMongoId().withMessage('Ê®°ÂûãIDÊ†ºÂºèÊó†Êïà')],\n  async (req, res) => {\n    try {\n      const errors = validationResult(req);\n      if (!errors.isEmpty()) {\n        return responseFormatter.error(res, 'ËæìÂÖ•È™åËØÅÂ§±Ë¥•', 400, errors.array());\n      }\n\n      const model = await DigitalTwinModel.findById(req.params.id);\n      if (!model) {\n        return responseFormatter.error(res, 'Êï∞Â≠óÂ≠™ÁîüÊ®°Âûã‰∏çÂ≠òÂú®', 404);\n      }\n\n      const devices = await model.getAssociatedDevices();\n\n      responseFormatter.success(res, 'Ëé∑ÂèñÂÖ≥ËÅîËÆæÂ§áÊàêÂäü', { devices });\n    } catch (error) {\n      console.error('Ëé∑ÂèñÂÖ≥ËÅîËÆæÂ§áÈîôËØØ:', error);\n      responseFormatter.error(res, 'Ëé∑ÂèñÂÖ≥ËÅîËÆæÂ§áÂ§±Ë¥•', 500);\n    }\n  }\n);\n\n// ÂÖ≥ËÅîËÆæÂ§áÂà∞Ê®°Âûã\nrouter.post(\n  '/models/:id/devices',\n  requireRole(['admin', 'operator']),\n  [\n    param('id').isMongoId().withMessage('Ê®°ÂûãIDÊ†ºÂºèÊó†Êïà'),\n    body('deviceIds').isArray().withMessage('ËÆæÂ§áIDÂàóË°®ÂøÖÈ°ªÊòØÊï∞ÁªÑ'),\n    body('deviceIds.*').isMongoId().withMessage('ËÆæÂ§áIDÊ†ºÂºèÊó†Êïà')\n  ],\n  async (req, res) => {\n    try {\n      const errors = validationResult(req);\n      if (!errors.isEmpty()) {\n        return responseFormatter.error(res, 'ËæìÂÖ•È™åËØÅÂ§±Ë¥•', 400, errors.array());\n      }\n\n      const model = await DigitalTwinModel.findById(req.params.id);\n      if (!model) {\n        return responseFormatter.error(res, 'Êï∞Â≠óÂ≠™ÁîüÊ®°Âûã‰∏çÂ≠òÂú®', 404);\n      }\n\n      const { deviceIds } = req.body;\n\n      // È™åËØÅÊâÄÊúâËÆæÂ§áÊòØÂê¶Â≠òÂú®\n      const devices = await Device.findByIds(deviceIds);\n      if (devices.length !== deviceIds.length) {\n        return responseFormatter.error(res, 'ÈÉ®ÂàÜËÆæÂ§á‰∏çÂ≠òÂú®', 404);\n      }\n\n      await model.associateDevices(deviceIds, req.user.userId);\n\n      responseFormatter.success(res, 'ËÆæÂ§áÂÖ≥ËÅîÊàêÂäü');\n    } catch (error) {\n      console.error('ÂÖ≥ËÅîËÆæÂ§áÈîôËØØ:', error);\n      responseFormatter.error(res, 'ÂÖ≥ËÅîËÆæÂ§áÂ§±Ë¥•', 500);\n    }\n  }\n);\n\n// ËøêË°å‰ªøÁúü\nrouter.post(\n  '/simulations',\n  requireRole(['admin', 'operator']),\n  simulationValidation,\n  async (req, res) => {\n    try {\n      const errors = validationResult(req);\n      if (!errors.isEmpty()) {\n        return responseFormatter.error(res, 'ËæìÂÖ•È™åËØÅÂ§±Ë¥•', 400, errors.array());\n      }\n\n      const { modelId, simulationType, parameters, duration = 3600, timeStep = 60 } = req.body;\n\n      // È™åËØÅÊ®°ÂûãÊòØÂê¶Â≠òÂú®\n      const model = await DigitalTwinModel.findById(modelId);\n      if (!model) {\n        return responseFormatter.error(res, 'Êï∞Â≠óÂ≠™ÁîüÊ®°Âûã‰∏çÂ≠òÂú®', 404);\n      }\n\n      if (model.status !== 'active') {\n        return responseFormatter.error(res, 'Ê®°ÂûãÁä∂ÊÄÅ‰∏çÂÖÅËÆ∏ËøêË°å‰ªøÁúü', 400);\n      }\n\n      const simulationData = {\n        modelId,\n        simulationType,\n        parameters,\n        duration,\n        timeStep,\n        status: 'running',\n        startedBy: req.user.userId,\n        startedAt: new Date()\n      };\n\n      const simulation = await model.runSimulation(simulationData);\n\n      responseFormatter.success(res, '‰ªøÁúüÂêØÂä®ÊàêÂäü', { simulation }, 201);\n    } catch (error) {\n      console.error('ËøêË°å‰ªøÁúüÈîôËØØ:', error);\n      responseFormatter.error(res, 'ËøêË°å‰ªøÁúüÂ§±Ë¥•', 500);\n    }\n  }\n);\n\n// Ëé∑Âèñ‰ªøÁúüÁªìÊûú\nrouter.get(\n  '/simulations/:id/results',\n  [param('id').isMongoId().withMessage('‰ªøÁúüIDÊ†ºÂºèÊó†Êïà')],\n  async (req, res) => {\n    try {\n      const errors = validationResult(req);\n      if (!errors.isEmpty()) {\n        return responseFormatter.error(res, 'ËæìÂÖ•È™åËØÅÂ§±Ë¥•', 400, errors.array());\n      }\n\n      const simulation = await DigitalTwinModel.getSimulationResults(req.params.id);\n      if (!simulation) {\n        return responseFormatter.error(res, '‰ªøÁúü‰∏çÂ≠òÂú®', 404);\n      }\n\n      responseFormatter.success(res, 'Ëé∑Âèñ‰ªøÁúüÁªìÊûúÊàêÂäü', { simulation });\n    } catch (error) {\n      console.error('Ëé∑Âèñ‰ªøÁúüÁªìÊûúÈîôËØØ:', error);\n      responseFormatter.error(res, 'Ëé∑Âèñ‰ªøÁúüÁªìÊûúÂ§±Ë¥•', 500);\n    }\n  }\n);\n\n// Ëé∑ÂèñËßÜÂõæÈ¢ÑËÆæÂàóË°®\nrouter.get(\n  '/view-presets',\n  [query('type').optional().isIn(DIGITAL_TWIN_CONSTANTS.VIEW_PRESETS).withMessage('ËßÜÂõæÁ±ªÂûãÊó†Êïà')],\n  async (req, res) => {\n    try {\n      const errors = validationResult(req);\n      if (!errors.isEmpty()) {\n        return responseFormatter.error(res, 'ËæìÂÖ•È™åËØÅÂ§±Ë¥•', 400, errors.array());\n      }\n\n      const { type } = req.query;\n      const filters = {};\n      if (type) {filters.type = type;}\n\n      const presets = await DigitalTwinModel.getViewPresets(filters);\n\n      responseFormatter.success(res, 'Ëé∑ÂèñËßÜÂõæÈ¢ÑËÆæÊàêÂäü', { presets });\n    } catch (error) {\n      console.error('Ëé∑ÂèñËßÜÂõæÈ¢ÑËÆæÈîôËØØ:', error);\n      responseFormatter.error(res, 'Ëé∑ÂèñËßÜÂõæÈ¢ÑËÆæÂ§±Ë¥•', 500);\n    }\n  }\n);\n\n// ÂàõÂª∫ËßÜÂõæÈ¢ÑËÆæ\nrouter.post(\n  '/view-presets',\n  requireRole(['admin', 'operator']),\n  viewPresetValidation,\n  async (req, res) => {\n    try {\n      const errors = validationResult(req);\n      if (!errors.isEmpty()) {\n        return responseFormatter.error(res, 'ËæìÂÖ•È™åËØÅÂ§±Ë¥•', 400, errors.array());\n      }\n\n      const presetData = {\n        ...req.body,\n        createdBy: req.user.userId,\n        createdAt: new Date()\n      };\n\n      const newPreset = await DigitalTwinModel.createViewPreset(presetData);\n\n      responseFormatter.success(res, 'ËßÜÂõæÈ¢ÑËÆæÂàõÂª∫ÊàêÂäü', { preset: newPreset }, 201);\n    } catch (error) {\n      console.error('ÂàõÂª∫ËßÜÂõæÈ¢ÑËÆæÈîôËØØ:', error);\n      responseFormatter.error(res, 'ÂàõÂª∫ËßÜÂõæÈ¢ÑËÆæÂ§±Ë¥•', 500);\n    }\n  }\n);\n\n// Ëé∑ÂèñÊ®°ÂûãÊÄßËÉΩÁªüËÆ°\nrouter.get(\n  '/models/:id/performance',\n  [param('id').isMongoId().withMessage('Ê®°ÂûãIDÊ†ºÂºèÊó†Êïà')],\n  async (req, res) => {\n    try {\n      const errors = validationResult(req);\n      if (!errors.isEmpty()) {\n        return responseFormatter.error(res, 'ËæìÂÖ•È™åËØÅÂ§±Ë¥•', 400, errors.array());\n      }\n\n      const model = await DigitalTwinModel.findById(req.params.id);\n      if (!model) {\n        return responseFormatter.error(res, 'Êï∞Â≠óÂ≠™ÁîüÊ®°Âûã‰∏çÂ≠òÂú®', 404);\n      }\n\n      const performance = await model.getPerformanceMetrics();\n\n      responseFormatter.success(res, 'Ëé∑ÂèñÊ®°ÂûãÊÄßËÉΩÁªüËÆ°ÊàêÂäü', { performance });\n    } catch (error) {\n      console.error('Ëé∑ÂèñÊ®°ÂûãÊÄßËÉΩÁªüËÆ°ÈîôËØØ:', error);\n      responseFormatter.error(res, 'Ëé∑ÂèñÊ®°ÂûãÊÄßËÉΩÁªüËÆ°Â§±Ë¥•', 500);\n    }\n  }\n);\n\n// ‰ºòÂåñÊ®°Âûã\nrouter.post(\n  '/models/:id/optimize',\n  requireRole(['admin', 'operator']),\n  [\n    param('id').isMongoId().withMessage('Ê®°ÂûãIDÊ†ºÂºèÊó†Êïà'),\n    body('optimizationType')\n      .isIn(['lod', 'texture', 'geometry', 'all'])\n      .withMessage('‰ºòÂåñÁ±ªÂûãÊó†Êïà'),\n    body('targetQuality').optional().isIn(['low', 'medium', 'high']).withMessage('ÁõÆÊ†áË¥®ÈáèÊó†Êïà')\n  ],\n  async (req, res) => {\n    try {\n      const errors = validationResult(req);\n      if (!errors.isEmpty()) {\n        return responseFormatter.error(res, 'ËæìÂÖ•È™åËØÅÂ§±Ë¥•', 400, errors.array());\n      }\n\n      const model = await DigitalTwinModel.findById(req.params.id);\n      if (!model) {\n        return responseFormatter.error(res, 'Êï∞Â≠óÂ≠™ÁîüÊ®°Âûã‰∏çÂ≠òÂú®', 404);\n      }\n\n      const { optimizationType, targetQuality = 'medium' } = req.body;\n\n      const optimizationResult = await model.optimize({\n        type: optimizationType,\n        quality: targetQuality,\n        optimizedBy: req.user.userId\n      });\n\n      responseFormatter.success(res, 'Ê®°Âûã‰ºòÂåñÂÆåÊàê', { result: optimizationResult });\n    } catch (error) {\n      console.error('‰ºòÂåñÊ®°ÂûãÈîôËØØ:', error);\n      responseFormatter.error(res, '‰ºòÂåñÊ®°ÂûãÂ§±Ë¥•', 500);\n    }\n  }\n);\n\n// Ëé∑ÂèñÊ®°ÂûãÁªüËÆ°Êï∞ÊçÆ\nrouter.get('/stats/summary', async (req, res) => {\n  try {\n    const stats = await DigitalTwinModel.getStatistics();\n\n    responseFormatter.success(res, 'Ëé∑ÂèñÊ®°ÂûãÁªüËÆ°Êï∞ÊçÆÊàêÂäü', { stats });\n  } catch (error) {\n    console.error('Ëé∑ÂèñÊ®°ÂûãÁªüËÆ°Êï∞ÊçÆÈîôËØØ:', error);\n    responseFormatter.error(res, 'Ëé∑ÂèñÊ®°ÂûãÁªüËÆ°Êï∞ÊçÆÂ§±Ë¥•', 500);\n  }\n});\n\n// ÂØºÂá∫Ê®°ÂûãÈÖçÁΩÆ\nrouter.get(\n  '/models/:id/export',\n  [\n    param('id').isMongoId().withMessage('Ê®°ÂûãIDÊ†ºÂºèÊó†Êïà'),\n    query('format').optional().isIn(['json', 'xml']).withMessage('ÂØºÂá∫Ê†ºÂºèÊó†Êïà')\n  ],\n  async (req, res) => {\n    try {\n      const errors = validationResult(req);\n      if (!errors.isEmpty()) {\n        return responseFormatter.error(res, 'ËæìÂÖ•È™åËØÅÂ§±Ë¥•', 400, errors.array());\n      }\n\n      const model = await DigitalTwinModel.findById(req.params.id);\n      if (!model) {\n        return responseFormatter.error(res, 'Êï∞Â≠óÂ≠™ÁîüÊ®°Âûã‰∏çÂ≠òÂú®', 404);\n      }\n\n      const { format = 'json' } = req.query;\n      const exportData = await model.exportConfiguration(format);\n\n      const contentType = format === 'xml' ? 'application/xml' : 'application/json';\n      const filename = `model-${model.name}-config.${format}`;\n\n      res.setHeader('Content-Type', contentType);\n      res.setHeader('Content-Disposition', `attachment; filename=${filename}`);\n      res.send(exportData);\n    } catch (error) {\n      console.error('ÂØºÂá∫Ê®°ÂûãÈÖçÁΩÆÈîôËØØ:', error);\n      responseFormatter.error(res, 'ÂØºÂá∫Ê®°ÂûãÈÖçÁΩÆÂ§±Ë¥•', 500);\n    }\n  }\n);\n\nmodule.exports = router;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/interfaces/http/routes/energy.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/interfaces/http/routes/maintenance.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/interfaces/http/validators/commonValidators.js","messages":[{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 255.","line":132,"column":46,"nodeType":"Literal","messageId":"noMagic","endLine":132,"endColumn":49},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":141,"column":45,"nodeType":"Literal","messageId":"noMagic","endLine":141,"endColumn":48},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 4102444800000.","line":227,"column":40,"nodeType":"Literal","messageId":"noMagic","endLine":227,"endColumn":53},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":234,"column":31,"nodeType":"Literal","messageId":"noMagic","endLine":234,"endColumn":33},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1024.","line":234,"column":36,"nodeType":"Literal","messageId":"noMagic","endLine":234,"endColumn":40},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1024.","line":234,"column":43,"nodeType":"Literal","messageId":"noMagic","endLine":234,"endColumn":47},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1024.","line":237,"column":60,"nodeType":"Literal","messageId":"noMagic","endLine":237,"endColumn":64},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1024.","line":237,"column":67,"nodeType":"Literal","messageId":"noMagic","endLine":237,"endColumn":71}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * ÈÄöÁî®È™åËØÅÂô®\n * Êèê‰æõÂ∏∏Áî®ÁöÑÊï∞ÊçÆÈ™åËØÅËßÑÂàôÂíåËá™ÂÆö‰πâÈ™åËØÅÂô®\n */\n\nconst { body, param, query, validationResult } = require('express-validator');\nconst responseFormatter = require('../middleware/responseFormatter');\n\n// Â∏∏Áî®Ê≠£ÂàôË°®ËææÂºè\nconst REGEX_PATTERNS = {\n  // Áî®Êà∑ÂêçÔºö3-20‰ΩçÂ≠óÊØçÊï∞Â≠ó‰∏ãÂàíÁ∫ø\n  USERNAME: /^[a-zA-Z0-9_]{3,20}$/,\n  // ÂØÜÁ†ÅÔºöËá≥Â∞ë8‰ΩçÔºåÂåÖÂê´Â≠óÊØçÂíåÊï∞Â≠ó\n  PASSWORD: /^(?=.*[A-Za-z])(?=.*\\d)[A-Za-z\\d@$!%*#?&]{8,}$/,\n  // ÈÇÆÁÆ±\n  EMAIL: /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/,\n  // ÊâãÊú∫Âè∑Ôºà‰∏≠ÂõΩÔºâ\n  PHONE: /^1[3-9]\\d{9}$/,\n  // IPv4Âú∞ÂùÄ\n  IPV4: /^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,\n  // MACÂú∞ÂùÄ\n  MAC: /^([0-9A-Fa-f]{2}[:-]){5}([0-9A-Fa-f]{2})$/,\n  // ËÆæÂ§áÂ∫èÂàóÂè∑\n  DEVICE_SERIAL: /^[A-Z0-9]{8,20}$/,\n  // ÁâàÊú¨Âè∑\n  VERSION: /^\\d+\\.\\d+\\.\\d+$/\n};\n\n// Â∏∏Áî®È™åËØÅËßÑÂàô\nconst VALIDATION_RULES = {\n  // IDÈ™åËØÅ\n  id: param('id').isInt({ min: 1 }).withMessage('IDÂøÖÈ°ªÊòØÊ≠£Êï¥Êï∞'),\n\n  // UUIDÈ™åËØÅ\n  uuid: param('id').isUUID().withMessage('IDÂøÖÈ°ªÊòØÊúâÊïàÁöÑUUID'),\n\n  // ÂàÜÈ°µÂèÇÊï∞È™åËØÅ\n  pagination: [\n    query('page').optional().isInt({ min: 1 }).withMessage('È°µÁ†ÅÂøÖÈ°ªÊòØÊ≠£Êï¥Êï∞').toInt(),\n    query('limit')\n      .optional()\n      .isInt({ min: 1, max: 100 })\n      .withMessage('ÊØèÈ°µÊï∞ÈáèÂøÖÈ°ªÂú®1-100‰πãÈó¥')\n      .toInt(),\n    query('offset').optional().isInt({ min: 0 }).withMessage('ÂÅèÁßªÈáèÂøÖÈ°ªÊòØÈùûË¥üÊï¥Êï∞').toInt()\n  ],\n\n  // ÊéíÂ∫èÂèÇÊï∞È™åËØÅ\n  sorting: [\n    query('sortBy')\n      .optional()\n      .isString()\n      .isLength({ min: 1, max: 50 })\n      .withMessage('ÊéíÂ∫èÂ≠óÊÆµÈïøÂ∫¶ÂøÖÈ°ªÂú®1-50‰πãÈó¥'),\n    query('sortOrder')\n      .optional()\n      .isIn(['asc', 'desc', 'ASC', 'DESC'])\n      .withMessage('ÊéíÂ∫èÊñπÂêëÂøÖÈ°ªÊòØascÊàñdesc')\n  ],\n\n  // Êó•ÊúüËåÉÂõ¥È™åËØÅ\n  dateRange: [\n    query('startDate').optional().isISO8601().withMessage('ÂºÄÂßãÊó•ÊúüÊ†ºÂºèÊó†Êïà').toDate(),\n    query('endDate')\n      .optional()\n      .isISO8601()\n      .withMessage('ÁªìÊùüÊó•ÊúüÊ†ºÂºèÊó†Êïà')\n      .toDate()\n      .custom((value, { req }) => {\n        if (req.query.startDate && value < new Date(req.query.startDate)) {\n          throw new Error('ÁªìÊùüÊó•Êúü‰∏çËÉΩÊó©‰∫éÂºÄÂßãÊó•Êúü');\n        }\n        return true;\n      })\n  ],\n\n  // ÊêúÁ¥¢ÂèÇÊï∞È™åËØÅ\n  search: [\n    query('keyword')\n      .optional()\n      .isString()\n      .isLength({ min: 1, max: 100 })\n      .withMessage('ÊêúÁ¥¢ÂÖ≥ÈîÆËØçÈïøÂ∫¶ÂøÖÈ°ªÂú®1-100‰πãÈó¥')\n      .trim()\n      .escape(),\n    query('searchFields').optional().isString().withMessage('ÊêúÁ¥¢Â≠óÊÆµÂøÖÈ°ªÊòØÂ≠óÁ¨¶‰∏≤')\n  ],\n\n  // Áî®Êà∑ÂêçÈ™åËØÅ\n  username: body('username')\n    .matches(REGEX_PATTERNS.USERNAME)\n    .withMessage('Áî®Êà∑ÂêçÂøÖÈ°ªÊòØ3-20‰ΩçÂ≠óÊØç„ÄÅÊï∞Â≠óÊàñ‰∏ãÂàíÁ∫ø'),\n\n  // ÂØÜÁ†ÅÈ™åËØÅ\n  password: body('password')\n    .matches(REGEX_PATTERNS.PASSWORD)\n    .withMessage('ÂØÜÁ†ÅËá≥Â∞ë8‰ΩçÔºåÂøÖÈ°ªÂåÖÂê´Â≠óÊØçÂíåÊï∞Â≠ó'),\n\n  // ÈÇÆÁÆ±È™åËØÅ\n  email: body('email').isEmail().normalizeEmail().withMessage('ÈÇÆÁÆ±Ê†ºÂºèÊó†Êïà'),\n\n  // ÊâãÊú∫Âè∑È™åËØÅ\n  phone: body('phone').optional().matches(REGEX_PATTERNS.PHONE).withMessage('ÊâãÊú∫Âè∑Ê†ºÂºèÊó†Êïà'),\n\n  // ËßíËâ≤È™åËØÅ\n  role: body('role')\n    .isIn(['admin', 'operator', 'user', 'guest'])\n    .withMessage('ËßíËâ≤ÂøÖÈ°ªÊòØadmin„ÄÅoperator„ÄÅuserÊàñguest‰πã‰∏Ä'),\n\n  // Áä∂ÊÄÅÈ™åËØÅ\n  status: body('status')\n    .isIn(['active', 'inactive', 'pending', 'suspended'])\n    .withMessage('Áä∂ÊÄÅÂøÖÈ°ªÊòØactive„ÄÅinactive„ÄÅpendingÊàñsuspended‰πã‰∏Ä'),\n\n  // Â∏ÉÂ∞îÂÄºÈ™åËØÅ\n  boolean: (field) => body(field).isBoolean().withMessage(`${field}ÂøÖÈ°ªÊòØÂ∏ÉÂ∞îÂÄº`).toBoolean(),\n\n  // Êï∞Â≠óÈ™åËØÅ\n  number: (field, min = 0, max = Number.MAX_SAFE_INTEGER) =>\n    body(field)\n      .isNumeric()\n      .withMessage(`${field}ÂøÖÈ°ªÊòØÊï∞Â≠ó`)\n      .isFloat({ min, max })\n      .withMessage(`${field}ÂøÖÈ°ªÂú®${min}-${max}‰πãÈó¥`)\n      .toFloat(),\n\n  // Êï¥Êï∞È™åËØÅ\n  integer: (field, min = 0, max = Number.MAX_SAFE_INTEGER) =>\n    body(field).isInt({ min, max }).withMessage(`${field}ÂøÖÈ°ªÊòØ${min}-${max}‰πãÈó¥ÁöÑÊï¥Êï∞`).toInt(),\n\n  // Â≠óÁ¨¶‰∏≤È™åËØÅ\n  string: (field, minLength = 1, maxLength = 255) =>\n    body(field)\n      .isString()\n      .withMessage(`${field}ÂøÖÈ°ªÊòØÂ≠óÁ¨¶‰∏≤`)\n      .isLength({ min: minLength, max: maxLength })\n      .withMessage(`${field}ÈïøÂ∫¶ÂøÖÈ°ªÂú®${minLength}-${maxLength}‰πãÈó¥`)\n      .trim(),\n\n  // Êï∞ÁªÑÈ™åËØÅ\n  array: (field, minLength = 0, maxLength = 100) =>\n    body(field)\n      .isArray({ min: minLength, max: maxLength })\n      .withMessage(`${field}ÂøÖÈ°ªÊòØÂåÖÂê´${minLength}-${maxLength}‰∏™ÂÖÉÁ¥†ÁöÑÊï∞ÁªÑ`),\n\n  // JSONÈ™åËØÅ\n  json: (field) =>\n    body(field).custom((value) => {\n      try {\n        JSON.parse(typeof value === 'string' ? value : JSON.stringify(value));\n        return true;\n      } catch (error) {\n        throw new Error(`${field}ÂøÖÈ°ªÊòØÊúâÊïàÁöÑJSONÊ†ºÂºè`);\n      }\n    })\n};\n\n// Ëá™ÂÆö‰πâÈ™åËØÅÂô®\nconst CUSTOM_VALIDATORS = {\n  // È™åËØÅËÆæÂ§áÂ∫èÂàóÂè∑\n  deviceSerial: body('serialNumber')\n    .matches(REGEX_PATTERNS.DEVICE_SERIAL)\n    .withMessage('ËÆæÂ§áÂ∫èÂàóÂè∑Ê†ºÂºèÊó†Êïà'),\n\n  // È™åËØÅIPÂú∞ÂùÄ\n  ipAddress: (field) =>\n    body(field).matches(REGEX_PATTERNS.IPV4).withMessage(`${field}ÂøÖÈ°ªÊòØÊúâÊïàÁöÑIPv4Âú∞ÂùÄ`),\n\n  // È™åËØÅMACÂú∞ÂùÄ\n  macAddress: (field) =>\n    body(field).matches(REGEX_PATTERNS.MAC).withMessage(`${field}ÂøÖÈ°ªÊòØÊúâÊïàÁöÑMACÂú∞ÂùÄ`),\n\n  // È™åËØÅÁâàÊú¨Âè∑\n  version: (field) =>\n    body(field)\n      .matches(REGEX_PATTERNS.VERSION)\n      .withMessage(`${field}ÂøÖÈ°ªÊòØÊúâÊïàÁöÑÁâàÊú¨Âè∑Ê†ºÂºèÔºàÂ¶Ç1.0.0Ôºâ`),\n\n  // È™åËØÅËÉΩËÄóÂÄº\n  energyValue: body('value').isFloat({ min: 0 }).withMessage('ËÉΩËÄóÂÄºÂøÖÈ°ªÊòØÈùûË¥üÊï∞').toFloat(),\n\n  // È™åËØÅÁ¢≥ÊéíÊîæÂõ†Â≠ê\n  carbonFactor: body('factor')\n    .isFloat({ min: 0, max: 10 })\n    .withMessage('Á¢≥ÊéíÊîæÂõ†Â≠êÂøÖÈ°ªÂú®0-10‰πãÈó¥')\n    .toFloat(),\n\n  // È™åËØÅÊ∏©Â∫¶ÂÄº\n  temperature: (field) =>\n    body(field)\n      .isFloat({ min: -273.15, max: 1000 })\n      .withMessage(`${field}ÂøÖÈ°ªÊòØÊúâÊïàÁöÑÊ∏©Â∫¶ÂÄºÔºà-273.15¬∞CÂà∞1000¬∞CÔºâ`)\n      .toFloat(),\n\n  // È™åËØÅÊπøÂ∫¶ÂÄº\n  humidity: (field) =>\n    body(field)\n      .isFloat({ min: 0, max: 100 })\n      .withMessage(`${field}ÂøÖÈ°ªÊòØ0-100‰πãÈó¥ÁöÑÊπøÂ∫¶ÂÄº`)\n      .toFloat(),\n\n  // È™åËØÅÂäüÁéáÂÄº\n  power: (field) =>\n    body(field).isFloat({ min: 0 }).withMessage(`${field}ÂøÖÈ°ªÊòØÈùûË¥üÁöÑÂäüÁéáÂÄº`).toFloat(),\n\n  // È™åËØÅÁªèÁ∫¨Â∫¶\n  latitude: (field) =>\n    body(field)\n      .isFloat({ min: -90, max: 90 })\n      .withMessage(`${field}ÂøÖÈ°ªÊòØÊúâÊïàÁöÑÁ∫¨Â∫¶ÂÄºÔºà-90Âà∞90Ôºâ`)\n      .toFloat(),\n\n  longitude: (field) =>\n    body(field)\n      .isFloat({ min: -180, max: 180 })\n      .withMessage(`${field}ÂøÖÈ°ªÊòØÊúâÊïàÁöÑÁªèÂ∫¶ÂÄºÔºà-180Âà∞180Ôºâ`)\n      .toFloat(),\n\n  // È™åËØÅÊó∂Èó¥Êà≥\n  timestamp: (field) =>\n    body(field).custom((value) => {\n      const timestamp = new Date(value).getTime();\n      if (isNaN(timestamp)) {\n        throw new Error(`${field}ÂøÖÈ°ªÊòØÊúâÊïàÁöÑÊó∂Èó¥Êà≥`);\n      }\n      // Ê£ÄÊü•Êó∂Èó¥Êà≥ÊòØÂê¶Âú®ÂêàÁêÜËåÉÂõ¥ÂÜÖÔºà1970Âπ¥Âà∞2100Âπ¥Ôºâ\n      if (timestamp < 0 || timestamp > 4102444800000) {\n        throw new Error(`${field}Êó∂Èó¥Êà≥Ë∂ÖÂá∫ÊúâÊïàËåÉÂõ¥`);\n      }\n      return true;\n    }),\n\n  // È™åËØÅÊñá‰ª∂Â§ßÂ∞èÔºàÂ≠óËäÇÔºâ\n  fileSize: (field, maxSize = 10 * 1024 * 1024) =>\n    body(field)\n      .isInt({ min: 0, max: maxSize })\n      .withMessage(`${field}Êñá‰ª∂Â§ßÂ∞è‰∏çËÉΩË∂ÖËøá${Math.round(maxSize / 1024 / 1024)}MB`)\n      .toInt(),\n\n  // È™åËØÅÈ¢úËâ≤ÂÄºÔºàÂçÅÂÖ≠ËøõÂà∂Ôºâ\n  hexColor: (field) =>\n    body(field)\n      .matches(/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/)\n      .withMessage(`${field}ÂøÖÈ°ªÊòØÊúâÊïàÁöÑÂçÅÂÖ≠ËøõÂà∂È¢úËâ≤ÂÄº`),\n\n  // È™åËØÅURL\n  url: (field) =>\n    body(field)\n      .isURL({\n        protocols: ['http', 'https'],\n        require_protocol: true\n      })\n      .withMessage(`${field}ÂøÖÈ°ªÊòØÊúâÊïàÁöÑURLÂú∞ÂùÄ`),\n\n  // È™åËØÅËÆæÂ§áÁ±ªÂûã\n  deviceType: body('type')\n    .isIn(['sensor', 'actuator', 'controller', 'gateway', 'meter', 'camera', 'other'])\n    .withMessage('ËÆæÂ§áÁ±ªÂûãÂøÖÈ°ªÊòØsensor„ÄÅactuator„ÄÅcontroller„ÄÅgateway„ÄÅmeter„ÄÅcameraÊàñother‰πã‰∏Ä'),\n\n  // È™åËØÅËÉΩÊ∫êÁ±ªÂûã\n  energyType: body('energyType')\n    .isIn(['electricity', 'gas', 'water', 'steam', 'coal', 'oil', 'solar', 'wind', 'other'])\n    .withMessage('ËÉΩÊ∫êÁ±ªÂûãÊó†Êïà'),\n\n  // È™åËØÅÂçï‰Ωç\n  unit: body('unit')\n    .isIn(['kWh', 'MWh', 'GWh', 'm¬≥', 'L', 'kg', 't', 'J', 'kJ', 'MJ', 'GJ'])\n    .withMessage('Âçï‰ΩçÊó†Êïà'),\n\n  // È™åËØÅ‰ºòÂÖàÁ∫ß\n  priority: body('priority')\n    .isIn(['low', 'medium', 'high', 'critical'])\n    .withMessage('‰ºòÂÖàÁ∫ßÂøÖÈ°ªÊòØlow„ÄÅmedium„ÄÅhighÊàñcritical‰πã‰∏Ä'),\n\n  // È™åËØÅÁª¥Êä§Á±ªÂûã\n  maintenanceType: body('type')\n    .isIn(['preventive', 'corrective', 'predictive', 'emergency'])\n    .withMessage('Áª¥Êä§Á±ªÂûãÂøÖÈ°ªÊòØpreventive„ÄÅcorrective„ÄÅpredictiveÊàñemergency‰πã‰∏Ä')\n};\n\n/**\n * È™åËØÅÁªìÊûúÂ§ÑÁêÜ‰∏≠Èó¥‰ª∂\n * Ê£ÄÊü•È™åËØÅÁªìÊûúÔºåÂ¶ÇÊûúÊúâÈîôËØØÂàôËøîÂõûÈîôËØØÂìçÂ∫î\n */\nfunction handleValidationErrors(req, res, next) {\n  const errors = validationResult(req);\n\n  if (!errors.isEmpty()) {\n    const formattedErrors = errors.array().map((error) => ({\n      field: error.param,\n      message: error.msg,\n      value: error.value,\n      location: error.location\n    }));\n\n    return responseFormatter.validationError(res, 'Êï∞ÊçÆÈ™åËØÅÂ§±Ë¥•', formattedErrors);\n  }\n\n  next();\n}\n\n/**\n * ÂàõÂª∫È™åËØÅÈìæ\n * @param {Array} validators - È™åËØÅÂô®Êï∞ÁªÑ\n * @returns {Array} ÂåÖÂê´È™åËØÅÂô®ÂíåÈîôËØØÂ§ÑÁêÜÁöÑÂÆåÊï¥È™åËØÅÈìæ\n */\nfunction createValidationChain(validators) {\n  return [...validators, handleValidationErrors];\n}\n\n/**\n * Êù°‰ª∂È™åËØÅ\n * @param {Function} condition - Êù°‰ª∂ÂáΩÊï∞\n * @param {Array} validators - ÂΩìÊù°‰ª∂‰∏∫ÁúüÊó∂Â∫îÁî®ÁöÑÈ™åËØÅÂô®\n * @returns {Function} Êù°‰ª∂È™åËØÅ‰∏≠Èó¥‰ª∂\n */\nfunction conditionalValidation(condition, validators) {\n  const runNext = function(req, res, next, validationChain, index) {\n    if (index >= validationChain.length) {\n      return next();\n    }\n\n    const validator = validationChain[index];\n    validator(req, res, () => runNext(req, res, next, validationChain, index + 1));\n  };\n\n  return (req, res, next) => {\n    if (condition(req)) {\n      // Â∫îÁî®È™åËØÅÂô®\n      const validationChain = createValidationChain(validators);\n      runNext(req, res, next, validationChain, 0);\n    } else {\n      next();\n    }\n  };\n}\n\n/**\n * ÊâπÈáèÈ™åËØÅ\n * @param {Object} validationRules - È™åËØÅËßÑÂàôÂØπË±°\n * @returns {Array} È™åËØÅÂô®Êï∞ÁªÑ\n */\nfunction batchValidation(validationRules) {\n  const validators = [];\n\n  for (const [_field, rules] of Object.entries(validationRules)) {\n    if (Array.isArray(rules)) {\n      validators.push(...rules);\n    } else {\n      validators.push(rules);\n    }\n  }\n\n  return createValidationChain(validators);\n}\n\n/**\n * Ëá™ÂÆö‰πâÈ™åËØÅÂô®Â∑•ÂéÇ\n * @param {Function} validatorFn - È™åËØÅÂáΩÊï∞\n * @param {string} errorMessage - ÈîôËØØÊ∂àÊÅØ\n * @returns {Function} Ëá™ÂÆö‰πâÈ™åËØÅÂô®\n */\nfunction customValidator(validatorFn, errorMessage) {\n  return (field) => body(field).custom(validatorFn).withMessage(errorMessage);\n}\n\nmodule.exports = {\n  REGEX_PATTERNS,\n  VALIDATION_RULES,\n  CUSTOM_VALIDATORS,\n  handleValidationErrors,\n  createValidationChain,\n  conditionalValidation,\n  batchValidation,\n  customValidator\n};\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/shared/cache/CacheManager.js","messages":[{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":100,"column":39,"nodeType":"Literal","messageId":"noMagic","endLine":100,"endColumn":43},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 300.","line":240,"column":10,"nodeType":"Literal","messageId":"noMagic","endLine":240,"endColumn":13},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60000.","line":284,"column":4,"nodeType":"Literal","messageId":"noMagic","endLine":284,"endColumn":9}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import logger from '../utils/logger.js';\n\n/**\n * ÁºìÂ≠òÁÆ°ÁêÜÂô®\n * ÊîØÊåÅÂÜÖÂ≠òÁºìÂ≠òÂíåRedisÁºìÂ≠ò\n */\nclass CacheManager {\n  constructor() {\n    this.memoryCache = new Map();\n    this.redisClient = null;\n    this.defaultTTL = 3600; // ÈªòËÆ§1Â∞èÊó∂\n    this.maxMemoryItems = 1000; // ÂÜÖÂ≠òÁºìÂ≠òÊúÄÂ§ßÊù°ÁõÆÊï∞\n\n    this.initializeRedis();\n  }\n\n  /**\n   * ÂàùÂßãÂåñRedisËøûÊé•\n   */\n  async initializeRedis() {\n    try {\n      // Â∞ùËØïÂØºÂÖ•RedisÂÆ¢Êà∑Á´Ø\n      const redisClient = await import('../../database/redisClient.js');\n      this.redisClient = redisClient.default;\n      logger.info('RedisÁºìÂ≠òÂ∑≤ÂêØÁî®');\n    } catch (error) {\n      logger.warn('Redis‰∏çÂèØÁî®Ôºå‰ΩøÁî®ÂÜÖÂ≠òÁºìÂ≠ò', { error: error.message });\n    }\n  }\n\n  /**\n   * Ëé∑ÂèñÁºìÂ≠òÂÄº\n   * @param {string} key - ÁºìÂ≠òÈîÆ\n   * @returns {Promise<any>} ÁºìÂ≠òÂÄº\n   */\n  async get(key) {\n    try {\n      // ‰ºòÂÖà‰ΩøÁî®Redis\n      if (this.redisClient) {\n        const value = await this.redisClient.get(key);\n        if (value !== null) {\n          return JSON.parse(value);\n        }\n      }\n\n      // ÂõûÈÄÄÂà∞ÂÜÖÂ≠òÁºìÂ≠ò\n      const memoryItem = this.memoryCache.get(key);\n      if (memoryItem) {\n        // Ê£ÄÊü•ÊòØÂê¶ËøáÊúü\n        if (Date.now() < memoryItem.expiry) {\n          return memoryItem.value;\n        }\n        this.memoryCache.delete(key);\n      }\n\n      return null;\n    } catch (error) {\n      logger.error('ÁºìÂ≠òËé∑ÂèñÂ§±Ë¥•', { key, error: error.message });\n      return null;\n    }\n  }\n\n  /**\n   * ËÆæÁΩÆÁºìÂ≠òÂÄº\n   * @param {string} key - ÁºìÂ≠òÈîÆ\n   * @param {any} value - ÁºìÂ≠òÂÄº\n   * @param {number} ttl - ËøáÊúüÊó∂Èó¥ÔºàÁßíÔºâ\n   */\n  async set(key, value, ttl = this.defaultTTL) {\n    try {\n      const serializedValue = JSON.stringify(value);\n\n      // ‰ΩøÁî®Redis\n      if (this.redisClient) {\n        await this.redisClient.setex(key, ttl, serializedValue);\n      }\n\n      // ÂêåÊó∂Â≠òÂÇ®Âà∞ÂÜÖÂ≠òÁºìÂ≠ò\n      this.setMemoryCache(key, value, ttl);\n\n      logger.debug('ÁºìÂ≠òËÆæÁΩÆÊàêÂäü', { key, ttl });\n    } catch (error) {\n      logger.error('ÁºìÂ≠òËÆæÁΩÆÂ§±Ë¥•', { key, error: error.message });\n    }\n  }\n\n  /**\n   * ËÆæÁΩÆÂÜÖÂ≠òÁºìÂ≠ò\n   * @param {string} key - ÁºìÂ≠òÈîÆ\n   * @param {any} value - ÁºìÂ≠òÂÄº\n   * @param {number} ttl - ËøáÊúüÊó∂Èó¥ÔºàÁßíÔºâ\n   */\n  setMemoryCache(key, value, ttl) {\n    // Â¶ÇÊûúÂÜÖÂ≠òÁºìÂ≠òÂ∑≤Êª°ÔºåÂà†Èô§ÊúÄÊóßÁöÑÊù°ÁõÆ\n    if (this.memoryCache.size >= this.maxMemoryItems) {\n      const firstKey = this.memoryCache.keys().next().value;\n      this.memoryCache.delete(firstKey);\n    }\n\n    const expiry = Date.now() + ttl * 1000;\n    this.memoryCache.set(key, { value, expiry });\n  }\n\n  /**\n   * Âà†Èô§ÁºìÂ≠ò\n   * @param {string} key - ÁºìÂ≠òÈîÆ\n   */\n  async delete(key) {\n    try {\n      if (this.redisClient) {\n        await this.redisClient.del(key);\n      }\n      this.memoryCache.delete(key);\n      logger.debug('ÁºìÂ≠òÂà†Èô§ÊàêÂäü', { key });\n    } catch (error) {\n      logger.error('ÁºìÂ≠òÂà†Èô§Â§±Ë¥•', { key, error: error.message });\n    }\n  }\n\n  /**\n   * ÊâπÈáèÂà†Èô§ÁºìÂ≠òÔºàÊîØÊåÅÊ®°ÂºèÂåπÈÖçÔºâ\n   * @param {string} pattern - ÂåπÈÖçÊ®°Âºè\n   */\n  async invalidate(pattern) {\n    try {\n      if (this.redisClient) {\n        const keys = await this.redisClient.keys(pattern);\n        if (keys.length > 0) {\n          await this.redisClient.del(...keys);\n        }\n      }\n\n      // Ê∏ÖÁêÜÂÜÖÂ≠òÁºìÂ≠ò\n      const regex = new RegExp(pattern.replace(/\\*/g, '.*'));\n      for (const key of this.memoryCache.keys()) {\n        if (regex.test(key)) {\n          this.memoryCache.delete(key);\n        }\n      }\n\n      logger.debug('ÁºìÂ≠òÊâπÈáèÂà†Èô§ÊàêÂäü', { pattern });\n    } catch (error) {\n      logger.error('ÁºìÂ≠òÊâπÈáèÂà†Èô§Â§±Ë¥•', { pattern, error: error.message });\n    }\n  }\n\n  /**\n   * Ê∏ÖÁ©∫ÊâÄÊúâÁºìÂ≠ò\n   */\n  async clear() {\n    try {\n      if (this.redisClient) {\n        await this.redisClient.flushdb();\n      }\n      this.memoryCache.clear();\n      logger.info('ÊâÄÊúâÁºìÂ≠òÂ∑≤Ê∏ÖÁ©∫');\n    } catch (error) {\n      logger.error('Ê∏ÖÁ©∫ÁºìÂ≠òÂ§±Ë¥•', { error: error.message });\n    }\n  }\n\n  /**\n   * Ëé∑ÂèñÁºìÂ≠òÁªüËÆ°‰ø°ÊÅØ\n   */\n  async getStats() {\n    const stats = {\n      memoryCache: {\n        size: this.memoryCache.size,\n        maxSize: this.maxMemoryItems\n      },\n      redis: {\n        connected: !!this.redisClient\n      }\n    };\n\n    if (this.redisClient) {\n      try {\n        const info = await this.redisClient.info('memory');\n        stats.redis.memory = info;\n      } catch (error) {\n        logger.warn('Ëé∑ÂèñRedisÁªüËÆ°‰ø°ÊÅØÂ§±Ë¥•', { error: error.message });\n      }\n    }\n\n    return stats;\n  }\n\n  /**\n   * ÁºìÂ≠òË£ÖÈ•∞Âô®\n   * @param {string} keyPrefix - ÁºìÂ≠òÈîÆÂâçÁºÄ\n   * @param {number} ttl - ËøáÊúüÊó∂Èó¥\n   * @returns {Function} Ë£ÖÈ•∞Âô®ÂáΩÊï∞\n   */\n  cached(keyPrefix, ttl = this.defaultTTL) {\n    return (target, propertyName, descriptor) => {\n      const originalMethod = descriptor.value;\n\n      descriptor.value = async function (...args) {\n        const cacheKey = `${keyPrefix}:${JSON.stringify(args)}`;\n\n        // Â∞ùËØï‰ªéÁºìÂ≠òËé∑Âèñ\n        const cachedResult = await this.get(cacheKey);\n        if (cachedResult !== null) {\n          return cachedResult;\n        }\n\n        // ÊâßË°åÂéüÊñπÊ≥ï\n        const result = await originalMethod.apply(this, args);\n\n        // Â≠òÂÇ®Âà∞ÁºìÂ≠ò\n        await this.set(cacheKey, result, ttl);\n\n        return result;\n      }.bind(this);\n\n      return descriptor;\n    };\n  }\n\n  /**\n   * Ê∏ÖÁêÜËøáÊúüÁöÑÂÜÖÂ≠òÁºìÂ≠ò\n   */\n  cleanupExpiredMemoryCache() {\n    const now = Date.now();\n    for (const [key, item] of this.memoryCache.entries()) {\n      if (now >= item.expiry) {\n        this.memoryCache.delete(key);\n      }\n    }\n  }\n}\n\n/**\n * ÁºìÂ≠ò‰∏≠Èó¥‰ª∂Â∑•ÂéÇ\n * @param {number} ttl - ÁºìÂ≠òÊó∂Èó¥ÔºàÁßíÔºâ\n * @param {Function} keyGenerator - ÁºìÂ≠òÈîÆÁîüÊàêÂáΩÊï∞\n * @returns {Function} Express‰∏≠Èó¥‰ª∂\n */\nconst createCacheMiddleware =\n  (ttl = 300, keyGenerator = null) =>\n    async (req, res, next) => {\n      try {\n      // ÁîüÊàêÁºìÂ≠òÈîÆ\n        const cacheKey = keyGenerator\n          ? keyGenerator(req)\n          : `api:${req.method}:${req.originalUrl}:${JSON.stringify(req.query)}`;\n\n        // Â∞ùËØï‰ªéÁºìÂ≠òËé∑Âèñ\n        const cachedData = await cacheManager.get(cacheKey);\n        if (cachedData) {\n          return res.json({\n            success: true,\n            data: cachedData,\n            cached: true,\n            timestamp: new Date().toISOString()\n          });\n        }\n\n        // ÈáçÂÜôres.jsonÊñπÊ≥ï‰ª•ÁºìÂ≠òÂìçÂ∫î\n        const originalJson = res.json;\n        res.json = function (data) {\n        // Âè™ÁºìÂ≠òÊàêÂäüÁöÑÂìçÂ∫î\n          if (data.success !== false) {\n            cacheManager.set(cacheKey, data, ttl).catch((error) => {\n              logger.error('ÁºìÂ≠òÂìçÂ∫îÂ§±Ë¥•', { cacheKey, error: error.message });\n            });\n          }\n          return originalJson.call(this, data);\n        };\n\n        next();\n      } catch (error) {\n        logger.error('ÁºìÂ≠ò‰∏≠Èó¥‰ª∂ÈîôËØØ', { error: error.message });\n        next();\n      }\n    };\n\n// ÂàõÂª∫ÂÖ®Â±ÄÁºìÂ≠òÁÆ°ÁêÜÂô®ÂÆû‰æã\nconst cacheManager = new CacheManager();\n\n// ÂÆöÊúüÊ∏ÖÁêÜËøáÊúüÁöÑÂÜÖÂ≠òÁºìÂ≠ò\nsetInterval(() => {\n  cacheManager.cleanupExpiredMemoryCache();\n}, 60000); // ÊØèÂàÜÈíüÊ∏ÖÁêÜ‰∏ÄÊ¨°\n\nexport { CacheManager, createCacheMiddleware, cacheManager };\n\nexport default cacheManager;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/shared/config/cache.js","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":10,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":10,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[321,364],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":19,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":19,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[513,544],"text":""},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import redis from 'redis';\n\n// ÂàõÂª∫RedisÂÆ¢Êà∑Á´Ø\nconst redisClient = redis.createClient({\n  host: process.env.REDIS_HOST || 'localhost',\n  port: process.env.REDIS_PORT || 6379,\n  password: process.env.REDIS_PASSWORD || '',\n  retry_strategy: (options) => {\n    if (options.error && options.error.code === 'ECONNREFUSED') {\n      console.error('RedisËøûÊé•Ë¢´ÊãíÁªùÔºåËØ∑Ê£ÄÊü•RedisÊúçÂä°ÊòØÂê¶ËøêË°å');\n      return 5000; // 5ÁßíÂêéÈáçËØï\n    }\n    return Math.min(options.attempt * 100, 3000); // ÊåáÊï∞ÈÄÄÈÅøÁ≠ñÁï•\n  }\n});\n\n// ÈîôËØØÂ§ÑÁêÜ\nredisClient.on('error', (err) => {\n  console.error('RedisÈîôËØØ:', err);\n});\n\n// ÂØºÂá∫RedisÂÆ¢Êà∑Á´ØÂíåÂ∏∏Áî®ÊñπÊ≥ï\nexport default {\n  redisClient,\n  get: (key) => redisClient.get(key),\n  set: (key, value) => redisClient.set(key, value),\n  setAsync: (key, value) => redisClient.set(key, value),\n  del: (key) => redisClient.del(key),\n  expire: (key, ttl) => redisClient.expire(key, ttl),\n  expireAsync: (key, ttl) => redisClient.expire(key, ttl),\n  // ÈªòËÆ§ÁºìÂ≠òÊó∂Èó¥Ôºö5ÂàÜÈíü\n  DEFAULT_TTL: 300,\n  // ÈïøÊó∂ÁºìÂ≠òÊó∂Èó¥Ôºö1Â∞èÊó∂\n  LONG_TTL: 3600,\n  // Áü≠ÊúüÁºìÂ≠òÊó∂Èó¥Ôºö30Áßí\n  SHORT_TTL: 30\n};\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/shared/config/index.js","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":315,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":315,"endColumn":14,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[9792,9845],"text":""},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * ÈÖçÁΩÆÁÆ°ÁêÜÊ®°Âùó\n * Êèê‰æõÈõÜ‰∏≠ÂåñÁöÑÈÖçÁΩÆÁÆ°ÁêÜ„ÄÅÈ™åËØÅÂíåÁ±ªÂûãËΩ¨Êç¢\n */\n\nimport dotenv from 'dotenv';\nimport path from 'path';\nimport { fileURLToPath } from 'url';\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\n\n// Âä†ËΩΩÁéØÂ¢ÉÂèòÈáè\nconst envFile = process.env.NODE_ENV === 'production' ? '.env.prod' : '.env';\nconst envPath = path.resolve(__dirname, '../../../', envFile);\ndotenv.config({ path: envPath });\n\n/**\n * ÈÖçÁΩÆÈ™åËØÅÂíåÁ±ªÂûãËΩ¨Êç¢Â∑•ÂÖ∑\n */\nclass ConfigValidator {\n  /**\n   * Ëé∑ÂèñÂ≠óÁ¨¶‰∏≤ÈÖçÁΩÆ\n   */\n  static getString(key, defaultValue = null, required = false) {\n    const value = process.env[key];\n\n    if (!value) {\n      if (required) {\n        throw new Error(`ÂøÖÈúÄÁöÑÈÖçÁΩÆÈ°π ${key} Êú™ËÆæÁΩÆ`);\n      }\n      return defaultValue;\n    }\n\n    return value;\n  }\n\n  /**\n   * Ëé∑ÂèñÊï∞Â≠óÈÖçÁΩÆ\n   */\n  static getNumber(key, defaultValue = null, required = false) {\n    const value = process.env[key];\n\n    if (!value) {\n      if (required) {\n        throw new Error(`ÂøÖÈúÄÁöÑÈÖçÁΩÆÈ°π ${key} Êú™ËÆæÁΩÆ`);\n      }\n      return defaultValue;\n    }\n\n    const numValue = Number(value);\n    if (isNaN(numValue)) {\n      throw new Error(`ÈÖçÁΩÆÈ°π ${key} ÂøÖÈ°ªÊòØÊúâÊïàÁöÑÊï∞Â≠óÔºåÂΩìÂâçÂÄº: ${value}`);\n    }\n\n    return numValue;\n  }\n\n  /**\n   * Ëé∑ÂèñÂ∏ÉÂ∞îÈÖçÁΩÆ\n   */\n  static getBoolean(key, defaultValue = false, required = false) {\n    const value = process.env[key];\n\n    if (!value) {\n      if (required) {\n        throw new Error(`ÂøÖÈúÄÁöÑÈÖçÁΩÆÈ°π ${key} Êú™ËÆæÁΩÆ`);\n      }\n      return defaultValue;\n    }\n\n    return value.toLowerCase() === 'true' || value === '1';\n  }\n\n  /**\n   * Ëé∑ÂèñÊï∞ÁªÑÈÖçÁΩÆÔºàÈÄóÂè∑ÂàÜÈöîÔºâ\n   */\n  static getArray(key, defaultValue = [], required = false) {\n    const value = process.env[key];\n\n    if (!value) {\n      if (required) {\n        throw new Error(`ÂøÖÈúÄÁöÑÈÖçÁΩÆÈ°π ${key} Êú™ËÆæÁΩÆ`);\n      }\n      return defaultValue;\n    }\n\n    return value\n      .split(',')\n      .map((item) => item.trim())\n      .filter((item) => item);\n  }\n\n  /**\n   * È™åËØÅÊûö‰∏æÂÄº\n   */\n  static getEnum(key, validValues, defaultValue = null, required = false) {\n    const value = this.getString(key, defaultValue, required);\n\n    if (value && !validValues.includes(value)) {\n      throw new Error(`ÈÖçÁΩÆÈ°π ${key} ÁöÑÂÄº ${value} Êó†ÊïàÔºåÊúâÊïàÂÄº: ${validValues.join(', ')}`);\n    }\n\n    return value;\n  }\n\n  /**\n   * È™åËØÅURLÊ†ºÂºè\n   */\n  static getUrl(key, defaultValue = null, required = false) {\n    const value = this.getString(key, defaultValue, required);\n\n    if (value) {\n      try {\n        new URL(value);\n      } catch (error) {\n        throw new Error(`ÈÖçÁΩÆÈ°π ${key} ÂøÖÈ°ªÊòØÊúâÊïàÁöÑURLÔºåÂΩìÂâçÂÄº: ${value}`);\n      }\n    }\n\n    return value;\n  }\n\n  /**\n   * È™åËØÅÊñá‰ª∂Ë∑ØÂæÑ\n   */\n  static getPath(key, defaultValue = null, required = false) {\n    const value = this.getString(key, defaultValue, required);\n\n    if (value && !path.isAbsolute(value)) {\n      // Â¶ÇÊûúÊòØÁõ∏ÂØπË∑ØÂæÑÔºåËΩ¨Êç¢‰∏∫ÁªùÂØπË∑ØÂæÑÔºàÁõ∏ÂØπ‰∫éÈ°πÁõÆÊ†πÁõÆÂΩïÔºâ\n      return path.resolve(__dirname, '../../../', value);\n    }\n\n    return value;\n  }\n}\n\n/**\n * Â∫îÁî®Á®ãÂ∫èÈÖçÁΩÆ\n */\nconst config = {\n  // Â∫îÁî®Á®ãÂ∫èÂü∫Êú¨ÈÖçÁΩÆ\n  app: {\n    name: ConfigValidator.getString('APP_NAME', 'Èõ∂Á¢≥Âõ≠Âå∫Êï∞Â≠óÂ≠™ÁîüËÉΩÁ¢≥ÁÆ°ÁêÜÁ≥ªÁªü'),\n    version: ConfigValidator.getString('APP_VERSION', '1.0.0'),\n    env: ConfigValidator.getEnum('NODE_ENV', ['development', 'production', 'test'], 'development'),\n    port: ConfigValidator.getNumber('PORT', 1125),\n    host: ConfigValidator.getString('HOST', '0.0.0.0'),\n    timezone: ConfigValidator.getString('TZ', 'Asia/Shanghai')\n  },\n\n  // Êï∞ÊçÆÂ∫ìÈÖçÁΩÆ\n  database: {\n    path: ConfigValidator.getPath('DB_PATH', 'data/park.db', true),\n    connectionTimeout: ConfigValidator.getNumber('DB_CONNECTION_TIMEOUT', 30000),\n    queryTimeout: ConfigValidator.getNumber('DB_QUERY_TIMEOUT', 10000),\n    maxConnections: ConfigValidator.getNumber('DB_MAX_CONNECTIONS', 10),\n    enableWAL: ConfigValidator.getBoolean('DB_ENABLE_WAL', true),\n    enableForeignKeys: ConfigValidator.getBoolean('DB_ENABLE_FOREIGN_KEYS', true)\n  },\n\n  // JWTËÆ§ËØÅÈÖçÁΩÆ\n  jwt: {\n    secret: ConfigValidator.getString('JWT_SECRET', null, true),\n    accessTokenExpiry: ConfigValidator.getNumber('JWT_ACCESS_TOKEN_EXPIRY', 900000),\n    refreshTokenExpiry: ConfigValidator.getNumber('JWT_REFRESH_TOKEN_EXPIRY', 604800),\n    issuer: ConfigValidator.getString('JWT_ISSUER', 'zero-carbon-park'),\n    audience: ConfigValidator.getString('JWT_AUDIENCE', 'zero-carbon-park-users')\n  },\n\n  // MQTTÈÖçÁΩÆ\n  mqtt: {\n    brokerUrl: ConfigValidator.getUrl('MQTT_BROKER_URL', 'mqtt://localhost:1883', true),\n    clientId: ConfigValidator.getString('MQTT_CLIENT_ID', 'zero-carbon-park-server'),\n    username: ConfigValidator.getString('MQTT_USERNAME'),\n    password: ConfigValidator.getString('MQTT_PASSWORD'),\n    keepalive: ConfigValidator.getNumber('MQTT_KEEPALIVE', 60),\n    connectTimeout: ConfigValidator.getNumber('MQTT_CONNECT_TIMEOUT', 30000),\n    reconnectPeriod: ConfigValidator.getNumber('MQTT_RECONNECT_PERIOD', 1000),\n    topics: {\n      energyData: ConfigValidator.getString('MQTT_TOPIC_ENERGY', 'park/energy/+/data'),\n      carbonData: ConfigValidator.getString('MQTT_TOPIC_CARBON', 'park/carbon/+/data'),\n      batteryData: ConfigValidator.getString('MQTT_TOPIC_BATTERY', 'park/battery/+/data'),\n      alerts: ConfigValidator.getString('MQTT_TOPIC_ALERTS', 'park/alerts')\n    }\n  },\n\n  // RedisÁºìÂ≠òÈÖçÁΩÆ\n  redis: {\n    enabled: ConfigValidator.getBoolean('REDIS_ENABLED', false),\n    host: ConfigValidator.getString('REDIS_HOST', 'localhost'),\n    port: ConfigValidator.getNumber('REDIS_PORT', 6379),\n    password: ConfigValidator.getString('REDIS_PASSWORD'),\n    db: ConfigValidator.getNumber('REDIS_DB', 0),\n    keyPrefix: ConfigValidator.getString('REDIS_KEY_PREFIX', 'zcp:'),\n    defaultTTL: ConfigValidator.getNumber('REDIS_DEFAULT_TTL', 3600),\n    maxRetriesPerRequest: ConfigValidator.getNumber('REDIS_MAX_RETRIES', 3),\n    retryDelayOnFailover: ConfigValidator.getNumber('REDIS_RETRY_DELAY', 100)\n  },\n\n  // ÂÆâÂÖ®ÈÖçÁΩÆ\n  security: {\n    passwordSaltRounds: ConfigValidator.getNumber('SECURITY_PASSWORD_SALT_ROUNDS', 10),\n    cors: {\n      enabled: ConfigValidator.getBoolean('SECURITY_CORS_ENABLED', true),\n      origin: ConfigValidator.getString('SECURITY_CORS_ORIGIN', '*'), // Áîü‰∫ßÁéØÂ¢ÉÂ∫îÈôêÂà∂‰∏∫ÁâπÂÆöÂüüÂêç\n      methods: ConfigValidator.getString('SECURITY_CORS_METHODS', 'GET,HEAD,PUT,PATCH,POST,DELETE'),\n      allowedHeaders: ConfigValidator.getString(\n        'SECURITY_CORS_ALLOWED_HEADERS',\n        'Content-Type,Authorization'\n      ),\n      exposedHeaders: ConfigValidator.getString('SECURITY_CORS_EXPOSED_HEADERS', ''),\n      credentials: ConfigValidator.getBoolean('SECURITY_CORS_CREDENTIALS', true),\n      maxAge: ConfigValidator.getNumber('SECURITY_CORS_MAX_AGE', 3600)\n    },\n    rateLimit: {\n      enabled: ConfigValidator.getBoolean('SECURITY_RATE_LIMIT_ENABLED', true),\n      windowMs: ConfigValidator.getNumber('SECURITY_RATE_LIMIT_WINDOW_MS', 15 * 60 * 1000), // 15 minutes\n      max: ConfigValidator.getNumber('SECURITY_RATE_LIMIT_MAX', 100), // limit each IP to 100 requests per windowMs\n      message: ConfigValidator.getString(\n        'SECURITY_RATE_LIMIT_MESSAGE',\n        'Too many requests from this IP, please try again after 15 minutes'\n      )\n    },\n    helmet: {\n      enabled: ConfigValidator.getBoolean('SECURITY_HELMET_ENABLED', true)\n    },\n    csrf: {\n      enabled: ConfigValidator.getBoolean('SECURITY_CSRF_ENABLED', false) // CSRF‰øùÊä§ÈÄöÂ∏∏Áî®‰∫éÂü∫‰∫é‰ºöËØùÁöÑËÆ§ËØÅÔºåJWTÈÄöÂ∏∏‰∏çÈúÄË¶Å\n    }\n  },\n\n  // Êó•ÂøóÈÖçÁΩÆ\n  logging: {\n    level: 'debug', // Âº∫Âà∂ËÆæÁΩÆ‰∏∫debugÁ∫ßÂà´‰ª•ÊçïËé∑SQLÊü•ËØ¢Êó•Âøó\n    enableConsole: ConfigValidator.getBoolean('LOG_ENABLE_CONSOLE', true),\n    enableFile: ConfigValidator.getBoolean('LOG_ENABLE_FILE', true),\n    logDir: ConfigValidator.getPath('LOG_DIR', 'logs'),\n    maxFileSize: ConfigValidator.getNumber('LOG_MAX_FILE_SIZE', 10485760), // 10MB\n    maxFiles: ConfigValidator.getNumber('LOG_MAX_FILES', 10)\n  },\n  // ÁõëÊéßÈÖçÁΩÆ\n  monitoring: {\n    enableMetrics: ConfigValidator.getBoolean('MONITORING_ENABLE_METRICS', true),\n    metricsPort: ConfigValidator.getNumber('MONITORING_METRICS_PORT', 9090),\n    enableHealthCheck: ConfigValidator.getBoolean('MONITORING_ENABLE_HEALTH_CHECK', true),\n    healthCheckInterval: ConfigValidator.getNumber('MONITORING_HEALTH_CHECK_INTERVAL', 30000),\n    enablePerformanceMonitoring: ConfigValidator.getBoolean('MONITORING_ENABLE_PERFORMANCE', true)\n  },\n\n  // Êñá‰ª∂‰∏ä‰º†ÈÖçÁΩÆ\n  upload: {\n    maxFileSize: ConfigValidator.getNumber('UPLOAD_MAX_FILE_SIZE', 10 * 1024 * 1024), // 10MB\n    allowedMimeTypes: ConfigValidator.getArray('UPLOAD_ALLOWED_MIME_TYPES', [\n      'image/jpeg',\n      'image/png',\n      'image/gif',\n      'application/pdf',\n      'text/csv'\n    ]),\n    uploadDir: ConfigValidator.getPath('UPLOAD_DIR', 'uploads'),\n    enableVirusScan: ConfigValidator.getBoolean('UPLOAD_ENABLE_VIRUS_SCAN', false)\n  },\n\n  // Â§ñÈÉ®ÊúçÂä°ÈÖçÁΩÆ\n  external: {\n    weatherApiKey: ConfigValidator.getString('WEATHER_API_KEY'),\n    weatherApiUrl: ConfigValidator.getUrl(\n      'WEATHER_API_URL',\n      'https://api.openweathermap.org/data/2.5'\n    ),\n    carbonFactorApiUrl: ConfigValidator.getUrl('CARBON_FACTOR_API_URL'),\n    enableExternalServices: ConfigValidator.getBoolean('ENABLE_EXTERNAL_SERVICES', false)\n  },\n\n  // ÂºÄÂèëÈÖçÁΩÆ\n  development: {\n    enableMockData: ConfigValidator.getBoolean('DEV_ENABLE_MOCK_DATA', false),\n    enableDebugRoutes: ConfigValidator.getBoolean('DEV_ENABLE_DEBUG_ROUTES', false),\n    enableSqlLogging: ConfigValidator.getBoolean('DEV_ENABLE_SQL_LOGGING', false)\n  }\n};\n\n/**\n * ÈÖçÁΩÆÈ™åËØÅÂáΩÊï∞\n */\nexport function validateConfig() {\n  const errors = [];\n\n  // È™åËØÅJWTÂØÜÈí•ÈïøÂ∫¶\n  if (config.jwt.secret && config.jwt.secret.length < 32) {\n    errors.push('JWT_SECRET ÈïøÂ∫¶ÂøÖÈ°ªËá≥Â∞ë32‰∏™Â≠óÁ¨¶');\n  }\n\n  // È™åËØÅÁ´ØÂè£ËåÉÂõ¥\n  if (config.app.port < 1 || config.app.port > 65535) {\n    errors.push('PORT ÂøÖÈ°ªÂú®1-65535ËåÉÂõ¥ÂÜÖ');\n  }\n\n  // È™åËØÅÊó•ÂøóÁõÆÂΩï\n  if (config.logging.enableFile && !config.logging.logDir) {\n    errors.push('ÂêØÁî®Êñá‰ª∂Êó•ÂøóÊó∂ÂøÖÈ°ªËÆæÁΩÆ LOG_DIR');\n  }\n\n  // È™åËØÅ‰∏ä‰º†ÁõÆÂΩï\n  if (!config.upload.uploadDir) {\n    errors.push('ÂøÖÈ°ªËÆæÁΩÆ UPLOAD_DIR');\n  }\n\n  if (errors.length > 0) {\n    throw new Error(`ÈÖçÁΩÆÈ™åËØÅÂ§±Ë¥•:\\n${errors.join('\\n')}`);\n  }\n\n  console.log(`[CONFIG] ÈÖçÁΩÆÈ™åËØÅÈÄöËøáÔºåÁéØÂ¢É: ${config.app.env}`);\n}\n\n/**\n * Ëé∑ÂèñÈÖçÁΩÆ‰ø°ÊÅØÔºàÁî®‰∫éË∞ÉËØïÔºâ\n */\nexport function getConfigInfo() {\n  const safeConfig = JSON.parse(JSON.stringify(config));\n\n  // ÈöêËóèÊïèÊÑü‰ø°ÊÅØ\n  if (safeConfig.jwt.secret) {\n    safeConfig.jwt.secret = '***';\n  }\n  if (safeConfig.mqtt.password) {\n    safeConfig.mqtt.password = '***';\n  }\n  if (safeConfig.redis.password) {\n    safeConfig.redis.password = '***';\n  }\n  if (safeConfig.external.weatherApiKey) {\n    safeConfig.external.weatherApiKey = '***';\n  }\n\n  return safeConfig;\n}\n\n/**\n * Ê£ÄÊü•ÊòØÂê¶‰∏∫Áîü‰∫ßÁéØÂ¢É\n */\nexport function isProduction() {\n  return config.app.env === 'production';\n}\n\n/**\n * Ê£ÄÊü•ÊòØÂê¶‰∏∫ÂºÄÂèëÁéØÂ¢É\n */\nexport function isDevelopment() {\n  return config.app.env === 'development';\n}\n\n/**\n * Ê£ÄÊü•ÊòØÂê¶‰∏∫ÊµãËØïÁéØÂ¢É\n */\nexport function isTest() {\n  return config.app.env === 'test';\n}\n\n// Âú®Ê®°ÂùóÂä†ËΩΩÊó∂È™åËØÅÈÖçÁΩÆ\nvalidateConfig();\n\nexport default config;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/shared/constants/MathConstants.js","messages":[{"ruleId":"no-dupe-keys","severity":2,"message":"Duplicate key 'SEVENTY'.","line":106,"column":3,"nodeType":"ObjectExpression","messageId":"unexpected","endLine":106,"endColumn":10},{"ruleId":"no-dupe-keys","severity":2,"message":"Duplicate key 'FIFTEEN'.","line":125,"column":3,"nodeType":"ObjectExpression","messageId":"unexpected","endLine":125,"endColumn":10},{"ruleId":"no-dupe-keys","severity":2,"message":"Duplicate key 'SIXTEEN'.","line":126,"column":3,"nodeType":"ObjectExpression","messageId":"unexpected","endLine":126,"endColumn":10},{"ruleId":"no-dupe-keys","severity":2,"message":"Duplicate key 'TWENTY_FIVE'.","line":127,"column":3,"nodeType":"ObjectExpression","messageId":"unexpected","endLine":127,"endColumn":14},{"ruleId":"no-dupe-keys","severity":2,"message":"Duplicate key 'THIRTY_SIX'.","line":128,"column":3,"nodeType":"ObjectExpression","messageId":"unexpected","endLine":128,"endColumn":13},{"ruleId":"no-dupe-keys","severity":2,"message":"Duplicate key 'NINE'.","line":129,"column":3,"nodeType":"ObjectExpression","messageId":"unexpected","endLine":129,"endColumn":7},{"ruleId":"no-dupe-keys","severity":2,"message":"Duplicate key 'ONE_HUNDRED'.","line":130,"column":3,"nodeType":"ObjectExpression","messageId":"unexpected","endLine":130,"endColumn":14},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5.","line":161,"column":32,"nodeType":"Literal","messageId":"noMagic","endLine":161,"endColumn":33},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":161,"column":36,"nodeType":"Literal","messageId":"noMagic","endLine":161,"endColumn":38},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":161,"column":41,"nodeType":"Literal","messageId":"noMagic","endLine":161,"endColumn":45},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5.","line":440,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":440,"endColumn":19},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":440,"column":22,"nodeType":"Literal","messageId":"noMagic","endLine":440,"endColumn":24},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":440,"column":27,"nodeType":"Literal","messageId":"noMagic","endLine":440,"endColumn":31},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":524,"column":27,"nodeType":"Literal","messageId":"noMagic","endLine":524,"endColumn":29},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":524,"column":32,"nodeType":"Literal","messageId":"noMagic","endLine":524,"endColumn":34},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":524,"column":37,"nodeType":"Literal","messageId":"noMagic","endLine":524,"endColumn":41}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Êï∞Â≠¶ÂíåÂü∫Á°ÄÂ∏∏ÈáèÂÆö‰πâ\n * Áî®‰∫éÊõøÊç¢È°πÁõÆ‰∏≠ÁöÑÈ≠îÊ≥ïÊï∞Â≠óÔºåÊèêÈ´ò‰ª£Á†ÅÂèØÁª¥Êä§ÊÄß\n */\n\n// Âü∫Á°ÄÊï∞Â≠¶Â∏∏Èáè\nexport const MATH_CONSTANTS = {\n  // Êï∞Â≠¶Áõ∏ÂÖ≥Â∏∏Èáè\n  PI: Math.PI,\n  E: Math.E,\n  GOLDEN_RATIO: 1.618033988749895,\n  DECIMAL_PLACES: 2, // Â∞èÊï∞‰ΩçÊï∞\n  \n  // Âü∫Á°ÄÊï∞ÂÄºÂ∏∏Èáè\n  ZERO: 0,\n  ONE: 1,\n  TWO: 2,\n  THREE: 3,\n  FOUR: 4,\n  FIVE: 5,\n  SIX: 6,\n  SEVEN: 7,\n  EIGHT: 8,\n  NINE: 9,\n  TEN: 10,\n  ELEVEN: 11,\n  TWELVE: 12,\n  THIRTEEN: 13,\n  FOURTEEN: 14,\n  FIFTEEN: 15,\n  SIXTEEN: 16,\n  SEVENTEEN: 17,\n  EIGHTEEN: 18,\n  NINETEEN: 19,\n  TWENTY: 20,\n  TWENTY_ONE: 21,\n  TWENTY_TWO: 22,\n  TWENTY_THREE: 23,\n  TWENTY_FOUR: 24,\n  TWENTY_FIVE: 25,\n  THIRTY: 30,\n  THIRTY_SIX: 36,\n  FORTY: 40,\n  FIFTY: 50,\n  SIXTY: 60,\n  SEVENTY: 70,\n  EIGHTY: 80,\n  NINETY: 90,\n  ONE_HUNDRED: 100,\n  TWO_HUNDRED: 200,\n  THREE_HUNDRED: 300,\n  \n  // Êó∂Èó¥Áõ∏ÂÖ≥Âü∫Á°ÄÊï∞ÂÄº\n  SECONDS_PER_MINUTE: 60,\n  MINUTES_PER_HOUR: 60,\n  HOURS_PER_DAY: 24,\n  DAYS_PER_YEAR: 365,\n  \n  // Êó∂Èó¥ËΩ¨Êç¢ÔºàÊØ´ÁßíÔºâ\n  MILLISECONDS_PER_SECOND: 1000,\n  \n  // Â≠òÂÇ®ÂíåÊï∞ÊçÆÁõ∏ÂÖ≥\n  BYTES_PER_KB: 1024,\n  \n  // ÁôæÂàÜÊØîÁõ∏ÂÖ≥\n  PERCENTAGE_BASE: 100,\n  \n  // Â∞èÊï∞Â∏∏Èáè\n  ZERO_POINT_ZERO_FIVE: 0.05,\n  ZERO_POINT_ONE: 0.1,\n  ZERO_POINT_FIFTEEN: 0.15,\n  ZERO_POINT_TWO: 0.2,\n  ZERO_POINT_FIVE: 0.5,\n  ZERO_POINT_SIX: 0.6,\n  ZERO_POINT_EIGHT: 0.8,\n  ZERO_POINT_EIGHTY_FIVE: 0.85,\n  ZERO_POINT_NINE: 0.9,\n  ZERO_POINT_NINETY_FIVE: 0.95,\n  \n  // ÁôæÂàÜÊØîÂ∏∏Èáè\n  FIVE_PERCENT: 0.05,\n  TEN_PERCENT: 0.1,\n  TWENTY_PERCENT: 0.2,\n  THIRTY_PERCENT: 0.3,\n  FIFTY_PERCENT: 0.5,\n  EIGHTY_PERCENT: 0.8,\n  NINETY_PERCENT: 0.9,\n  \n  // ÂàÜÊï∞Â∏∏Èáè\n  ONE_HALF: 0.5,\n  ONE_THIRD: 0.33,\n  ONE_QUARTER: 0.25,\n  \n  // Â≠òÂÇ®ÂíåÊï∞ÊçÆÁõ∏ÂÖ≥\n  FOUR_HUNDRED: 400,\n  FIVE_HUNDRED: 500,\n  EIGHT_HUNDRED: 800,\n  ONE_THOUSAND: 1000,\n  TWO_THOUSAND: 2000,\n  THREE_THOUSAND: 3000,\n  THREE_THOUSAND_THREE_HUNDRED_SIX: 3306,\n  FIVE_THOUSAND: 5000,\n  TEN_THOUSAND: 10000,\n  THIRTY_THOUSAND: 30000,\n  SIXTY_SEVEN: 67,\n  SEVENTY: 70,\n  SEVENTY_FIVE: 75,\n  EIGHTY_FIVE: 85,\n  EIGHTY_EIGHT: 88,\n  NINETY_TWO: 92,\n  NINETY_FIVE: 95,\n  NINETY_EIGHT: 98,\n  \n  // ÂÄçÊï∞Â∏∏Èáè\n  ONE_POINT_TWO: 1.2,\n  \n  // Âçï‰ΩçËΩ¨Êç¢Âü∫Êï∞\n  UNIT_CONVERSION_BASE: 1000,\n  \n  // ÂØÜÁ†ÅÂíåÂÆâÂÖ®Áõ∏ÂÖ≥\n  MIN_PASSWORD_LENGTH: 8,\n  CRYPTO_RANDOM_BYTES: 16,\n  \n  // ËÉΩÊ∫êÁÆ°ÁêÜÁõ∏ÂÖ≥Â∏∏Èáè\n  FIFTEEN: 15,\n  SIXTEEN: 16,\n  TWENTY_FIVE: 25,\n  THIRTY_SIX: 36,\n  NINE: 9,\n  ONE_HUNDRED: 100\n};\n\n// Êó∂Èó¥Èó¥ÈöîÂ∏∏ÈáèÔºàÂü∫‰∫éÂü∫Á°ÄÊï∞Â≠¶Â∏∏ÈáèËÆ°ÁÆóÔºâ\nexport const TIME_INTERVALS = {\n  ONE_SECOND_MS: 1000,\n  FIVE_SECONDS_MS: 5000,\n  TEN_SECONDS_MS: 10000,\n  THIRTY_SECONDS_MS: 30000,\n  ONE_MINUTE_MS: 60000,\n  FIVE_MINUTES_MS: MATH_CONSTANTS.FIVE * MATH_CONSTANTS.SECONDS_PER_MINUTE * MATH_CONSTANTS.MILLISECONDS_PER_SECOND,\n  TEN_MINUTES_MS: 600000,\n  FIFTEEN_MINUTES_MS: 900000,\n  THIRTY_MINUTES_MS: 1800000,\n  ONE_HOUR_MS: MATH_CONSTANTS.MINUTES_PER_HOUR * MATH_CONSTANTS.SECONDS_PER_MINUTE * MATH_CONSTANTS.MILLISECONDS_PER_SECOND,\n  TWO_HOURS_MS: 7200000,\n  SIX_HOURS_MS: 21600000,\n  TWELVE_HOURS_MS: 43200000,\n  ONE_DAY_MS: MATH_CONSTANTS.HOURS_PER_DAY * MATH_CONSTANTS.MINUTES_PER_HOUR * MATH_CONSTANTS.SECONDS_PER_MINUTE * MATH_CONSTANTS.MILLISECONDS_PER_SECOND,\n  ONE_WEEK_MS: 604800000,\n  ONE_MONTH_MS: 2592000000,\n  ONE_YEAR_MS: MATH_CONSTANTS.DAYS_PER_YEAR * MATH_CONSTANTS.HOURS_PER_DAY * MATH_CONSTANTS.MINUTES_PER_HOUR * MATH_CONSTANTS.SECONDS_PER_MINUTE * MATH_CONSTANTS.MILLISECONDS_PER_SECOND\n};\n\n// ËÉΩÊ∫êÁÆ°ÁêÜÁõ∏ÂÖ≥Â∏∏Èáè\nexport const ENERGY_CONSTANTS = {\n  // ËÉΩÊ∫êÁõ∏ÂÖ≥Â∏∏Èáè\n  RENEWABLE_THRESHOLD: 0.3,\n  EFFICIENCY_THRESHOLD: 0.8,\n  LOAD_BALANCE_THRESHOLD: 0.7,\n  OPTIMIZATION_IMPACT: 0.15,\n  DEFAULT_MONITORING_INTERVAL: 5 * 60 * 1000, // 5ÂàÜÈíü\n  OPTIMIZATION_THRESHOLD: 0.1,\n  \n  // ÊïàÁéáÈòàÂÄº\n  EFFICIENCY_THRESHOLD_HIGH: 80,\n  EFFICIENCY_THRESHOLD_MEDIUM: 70,\n  EFFICIENCY_THRESHOLD_LOW: 50,\n  \n  // ÂèØÂÜçÁîüËÉΩÊ∫êÊØî‰æãÈòàÂÄº\n  RENEWABLE_RATIO_THRESHOLD_HIGH: 50,\n  RENEWABLE_RATIO_THRESHOLD_LOW: 30,\n  \n  // Ë¥üËΩΩÂõ†Â≠êÈòàÂÄº\n  LOAD_FACTOR_THRESHOLD_HIGH: 60,\n  LOAD_FACTOR_THRESHOLD_LOW: 50,\n  \n  // Ê®°ÊãüÊï∞ÊçÆËåÉÂõ¥\n  MOCK_PRODUCTION_MAX: 1000,\n  MOCK_CONSUMPTION_MAX: 800,\n  MOCK_RENEWABLE_BASE: 60,\n  MOCK_RENEWABLE_RANGE: 30,\n  MOCK_EFFICIENCY_BASE: 80,\n  MOCK_EFFICIENCY_RANGE: 15,\n  MOCK_COST_SAVINGS_MAX: 5000,\n  MOCK_HOURLY_PRODUCTION_MAX: 100,\n  MOCK_HOURLY_CONSUMPTION_MAX: 80,\n  MOCK_HOURLY_RENEWABLE_MAX: 60,\n  MOCK_DEVICE_CONTRIBUTION_MAX: 100,\n  MOCK_DEVICE_EFFICIENCY_BASE: 80,\n  MOCK_DEVICE_EFFICIENCY_RANGE: 20,\n  MOCK_ENERGY_SAVED_MAX: 50,\n  MOCK_COST_SAVED_MAX: 100,\n  MOCK_EFFICIENCY_IMPROVED_MAX: 5,\n  \n  // Êó∂Èó¥ËåÉÂõ¥ÈôêÂà∂\n  MAX_HOURLY_DATA_HOURS: 24,\n  \n  // Á¢≥ÊéíÊîæÁõ∏ÂÖ≥Â∏∏Èáè\n  ELECTRICITY_EMISSION_FACTOR: 0.5, // kg CO2e / kWh\n  NATURAL_GAS_EMISSION_FACTOR: 0.2, // kg CO2e / kWh\n  BASE_ENERGY_USAGE: 500, // kWh\n  RANDOM_ENERGY_RANGE: 500 // kWh\n};\n\n// Êó∂Èó¥ËåÉÂõ¥Â∏∏Èáè\nexport const PREVIOUS_TIME_RANGES = {\n  ONE_HOUR: '-2 hours',\n  SIX_HOURS: '-12 hours',\n  ONE_DAY: '-2 days',\n  SEVEN_DAYS: '-14 days',\n  THIRTY_DAYS: '-60 days',\n  NINETY_DAYS: '-180 days',\n  ONE_YEAR: '-2 years'\n};\n\n// Â≠òÂÇ®Â§ßÂ∞èÂ∏∏Èáè\nexport const STORAGE_CONSTANTS = {\n  ONE_MB: MATH_CONSTANTS.BYTES_PER_KB * MATH_CONSTANTS.BYTES_PER_KB,\n  FILE_SIZE_LIMIT: MATH_CONSTANTS.BYTES_PER_KB * MATH_CONSTANTS.BYTES_PER_KB // 1MB\n};\n\n// HTTPÁä∂ÊÄÅÁ†ÅÂ∏∏Èáè\nexport const HTTP_STATUS_CODES = {\n  // ÊàêÂäüÁä∂ÊÄÅÁ†Å\n  OK: 200,\n  CREATED: 201,\n  ACCEPTED: 202,\n  NO_CONTENT: 204,\n  \n  // ÈáçÂÆöÂêëÁä∂ÊÄÅÁ†Å\n  MOVED_PERMANENTLY: 301,\n  FOUND: 302,\n  NOT_MODIFIED: 304,\n  \n  // ÂÆ¢Êà∑Á´ØÈîôËØØÁä∂ÊÄÅÁ†Å\n  BAD_REQUEST: 400,\n  UNAUTHORIZED: 401,\n  FORBIDDEN: 403,\n  NOT_FOUND: 404,\n  METHOD_NOT_ALLOWED: 405,\n  CONFLICT: 409,\n  UNPROCESSABLE_ENTITY: 422,\n  TOO_MANY_REQUESTS: 429,\n  \n  // ÊúçÂä°Âô®ÈîôËØØÁä∂ÊÄÅÁ†Å\n  INTERNAL_SERVER_ERROR: 500,\n  NOT_IMPLEMENTED: 501,\n  BAD_GATEWAY: 502,\n  SERVICE_UNAVAILABLE: 503,\n  GATEWAY_TIMEOUT: 504\n};\n\n// Êï∞ÊçÆÂ§ÑÁêÜÁõ∏ÂÖ≥Â∏∏Èáè\nexport const DATA_PROCESSING_CONSTANTS = {\n  // ÊâπÂ§ÑÁêÜÂ§ßÂ∞è\n  BATCH_SIZE_SMALL: 100,\n  BATCH_SIZE_MEDIUM: 500,\n  BATCH_SIZE_LARGE: 1000,\n  BATCH_SIZE_EXTRA_LARGE: 5000,\n  \n  // ÂàÜÈ°µÁõ∏ÂÖ≥\n  DEFAULT_PAGE_SIZE: 20,\n  MAX_PAGE_SIZE: 100,\n  MIN_PAGE_SIZE: 1,\n  \n  // ÈáçËØïÁõ∏ÂÖ≥\n  MAX_RETRY_ATTEMPTS: 3,\n  RETRY_DELAY_MS: 1000,\n  EXPONENTIAL_BACKOFF_MULTIPLIER: 2,\n  \n  // Ë∂ÖÊó∂ËÆæÁΩÆ\n  DEFAULT_TIMEOUT_MS: 30000,\n  LONG_TIMEOUT_MS: 60000,\n  SHORT_TIMEOUT_MS: 5000,\n  \n  // ÁºìÂ≠òÁõ∏ÂÖ≥\n  CACHE_TTL_SHORT: 300, // 5ÂàÜÈíü\n  CACHE_TTL_MEDIUM: 1800, // 30ÂàÜÈíü\n  CACHE_TTL_LONG: 3600, // 1Â∞èÊó∂\n  CACHE_TTL_EXTRA_LONG: 86400, // 24Â∞èÊó∂\n  \n  // Êï∞ÊçÆÈ™åËØÅ\n  MIN_STRING_LENGTH: 1,\n  MAX_STRING_LENGTH: 255,\n  MAX_TEXT_LENGTH: 65535,\n  \n  // Êï∞ÂÄºËåÉÂõ¥\n  MIN_POSITIVE_NUMBER: 0.0001,\n  MAX_SAFE_INTEGER: Number.MAX_SAFE_INTEGER,\n  MIN_SAFE_INTEGER: Number.MIN_SAFE_INTEGER\n};\n\n// ËÉΩÊ∫êËÆæÂ§áÁõ∏ÂÖ≥Â∏∏Èáè\nexport const DEVICE_CONSTANTS = {\n  // ËÆæÂ§áÁä∂ÊÄÅ\n  STATUS_ONLINE: 1,\n  STATUS_OFFLINE: 0,\n  STATUS_MAINTENANCE: 2,\n  STATUS_ERROR: 3,\n  \n  // ËÆæÂ§áÁ±ªÂûãID\n  TYPE_SOLAR_PANEL: 1,\n  TYPE_WIND_TURBINE: 2,\n  TYPE_BATTERY: 3,\n  TYPE_INVERTER: 4,\n  TYPE_METER: 5,\n  \n  // ËÆæÂ§á‰ºòÂÖàÁ∫ß\n  PRIORITY_LOW: 1,\n  PRIORITY_MEDIUM: 2,\n  PRIORITY_HIGH: 3,\n  PRIORITY_CRITICAL: 4,\n  \n  // Áª¥Êä§Èó¥ÈöîÔºàÂ§©Ôºâ\n  MAINTENANCE_INTERVAL_DAILY: 1,\n  MAINTENANCE_INTERVAL_WEEKLY: 7,\n  MAINTENANCE_INTERVAL_MONTHLY: 30,\n  MAINTENANCE_INTERVAL_QUARTERLY: 90,\n  MAINTENANCE_INTERVAL_YEARLY: 365,\n  \n  // ËÆæÂ§áÂÆπÈáèÁ≠âÁ∫ß\n  CAPACITY_SMALL: 10, // kW\n  CAPACITY_MEDIUM: 100, // kW\n  CAPACITY_LARGE: 1000, // kW\n  CAPACITY_EXTRA_LARGE: 10000 // kW\n};\n\n// ÁÆóÊ≥ïÂíåËÆ°ÁÆóÁõ∏ÂÖ≥Â∏∏Èáè\nexport const ALGORITHM_CONSTANTS = {\n  // Êú∫Âô®Â≠¶‰π†Áõ∏ÂÖ≥\n  LEARNING_RATE: 0.01,\n  EPOCHS: 100,\n  BATCH_SIZE: 32,\n  VALIDATION_SPLIT: 0.2,\n  TEST_SPLIT: 0.1,\n  \n  // ‰ºòÂåñÁÆóÊ≥ïÂèÇÊï∞\n  CONVERGENCE_THRESHOLD: 0.001,\n  MAX_ITERATIONS: 1000,\n  STEP_SIZE: 0.1,\n  \n  // ÁªüËÆ°ÂàÜÊûê\n  CONFIDENCE_LEVEL: 0.95,\n  SIGNIFICANCE_LEVEL: 0.05,\n  Z_SCORE_THRESHOLD: 2.0,\n  \n  // È¢ÑÊµãÊ®°Âûã\n  FORECAST_HORIZON_HOURS: 24,\n  FORECAST_HORIZON_DAYS: 7,\n  FORECAST_HORIZON_MONTHS: 12,\n  \n  // ÂºÇÂ∏∏Ê£ÄÊµã\n  ANOMALY_THRESHOLD: 3.0, // Ê†áÂáÜÂ∑ÆÂÄçÊï∞\n  OUTLIER_PERCENTILE: 0.95,\n  \n  // ËÅöÁ±ªÂàÜÊûê\n  MIN_CLUSTER_SIZE: 3,\n  MAX_CLUSTER_SIZE: 10,\n  CLUSTER_DISTANCE_THRESHOLD: 0.5\n};\n\n// ÂÆâÂÖ®ÂíåËÆ§ËØÅÁõ∏ÂÖ≥Â∏∏Èáè\nexport const SECURITY_CONSTANTS = {\n  // JWTÁõ∏ÂÖ≥\n  JWT_EXPIRY_HOURS: 24,\n  JWT_REFRESH_EXPIRY_DAYS: 7,\n  \n  // ÂØÜÁ†ÅÁ≠ñÁï•\n  MIN_PASSWORD_LENGTH: 8,\n  MAX_PASSWORD_LENGTH: 128,\n  PASSWORD_COMPLEXITY_SCORE: 3,\n  \n  // ‰ºöËØùÁÆ°ÁêÜ\n  SESSION_TIMEOUT_MINUTES: 30,\n  MAX_CONCURRENT_SESSIONS: 5,\n  \n  // ËÆøÈóÆÊéßÂà∂\n  MAX_LOGIN_ATTEMPTS: 5,\n  LOCKOUT_DURATION_MINUTES: 15,\n  \n  // Âä†ÂØÜÁõ∏ÂÖ≥\n  SALT_ROUNDS: 12,\n  ENCRYPTION_KEY_LENGTH: 32,\n  IV_LENGTH: 16,\n  \n  // APIÈôêÊµÅ\n  RATE_LIMIT_REQUESTS_PER_MINUTE: 60,\n  RATE_LIMIT_REQUESTS_PER_HOUR: 1000,\n  RATE_LIMIT_BURST_SIZE: 10\n};\n\n// ÁõëÊéßÂíåÂëäË≠¶Áõ∏ÂÖ≥Â∏∏Èáè\nexport const MONITORING_CONSTANTS = {\n  // ÂëäË≠¶Á∫ßÂà´\n  ALERT_LEVEL_INFO: 1,\n  ALERT_LEVEL_WARNING: 2,\n  ALERT_LEVEL_ERROR: 3,\n  ALERT_LEVEL_CRITICAL: 4,\n  \n  // ÁõëÊéßÈó¥Èöî\n  MONITOR_INTERVAL_REALTIME: 1000, // 1Áßí\n  MONITOR_INTERVAL_FAST: 5000, // 5Áßí\n  MONITOR_INTERVAL_NORMAL: 30000, // 30Áßí\n  MONITOR_INTERVAL_SLOW: 300000, // 5ÂàÜÈíü\n  \n  // ÊÄßËÉΩÈòàÂÄº\n  CPU_USAGE_WARNING: 70,\n  CPU_USAGE_CRITICAL: 90,\n  MEMORY_USAGE_WARNING: 80,\n  MEMORY_USAGE_CRITICAL: 95,\n  DISK_USAGE_WARNING: 85,\n  DISK_USAGE_CRITICAL: 95,\n  \n  // ÂìçÂ∫îÊó∂Èó¥ÈòàÂÄºÔºàÊØ´ÁßíÔºâ\n  RESPONSE_TIME_FAST: 100,\n  RESPONSE_TIME_NORMAL: 500,\n  RESPONSE_TIME_SLOW: 1000,\n  RESPONSE_TIME_CRITICAL: 5000,\n  \n  // ÈîôËØØÁéáÈòàÂÄº\n  ERROR_RATE_WARNING: 0.01, // 1%\n  ERROR_RATE_CRITICAL: 0.05, // 5%\n  \n  // ÂèØÁî®ÊÄßÈòàÂÄº\n  AVAILABILITY_TARGET: 0.999, // 99.9%\n  AVAILABILITY_WARNING: 0.99, // 99%\n  AVAILABILITY_CRITICAL: 0.95, // 95%\n  \n  // Ë¥®ÈáèÈòàÂÄºÔºàÁôæÂàÜÊØîÔºâ\n  QUALITY_THRESHOLD_LOW: 60,\n  QUALITY_THRESHOLD_MEDIUM: 75,\n  QUALITY_THRESHOLD_HIGH: 85,\n  QUALITY_THRESHOLD_VERY_HIGH: 90,\n  QUALITY_THRESHOLD_CRITICAL: 95\n};\n\n// Á¢≥ÊéíÊîæÊ†∏ÁÆóÁõ∏ÂÖ≥Â∏∏ÈáèÔºàÁ¨¶ÂêàÂõΩÂÆ∂Ê†áÂáÜÔºâ\nexport const CARBON_CONSTANTS = {\n  // ÁºìÂ≠òË∂ÖÊó∂Êó∂Èó¥\n  CACHE_TIMEOUT: 5 * 60 * 1000, // 5ÂàÜÈíü\n  \n  // ÂõΩÂÆ∂Ê†áÂáÜÊéíÊîæÂõ†Â≠êÔºà2024Âπ¥ÁâàÔºâ\n  NATIONAL_EMISSION_FACTORS: {\n    // ÂÖ®ÂõΩÁîµÁΩëÂπ≥ÂùáÊéíÊîæÂõ†Â≠ê (kg CO2/kWh)\n    NATIONAL_GRID_ELECTRICITY: 0.5703,\n    \n    // Âå∫ÂüüÁîµÁΩëÊéíÊîæÂõ†Â≠ê (kg CO2/kWh)\n    NORTH_CHINA_GRID: 0.8843,\n    NORTHEAST_CHINA_GRID: 0.8825,\n    EAST_CHINA_GRID: 0.7035,\n    CENTRAL_CHINA_GRID: 0.8257,\n    NORTHWEST_CHINA_GRID: 0.8922,\n    SOUTH_CHINA_GRID: 0.5271,\n    \n    // ÂåñÁü≥ÁáÉÊñôÊéíÊîæÂõ†Â≠ê\n    NATURAL_GAS: 2.1622, // kg CO2/m¬≥\n    COAL: 2.4930, // kg CO2/kg\n    DIESEL: 3.0959, // kg CO2/L\n    GASOLINE: 2.9251, // kg CO2/L\n    HEAVY_OIL: 3.1705, // kg CO2/kg\n    LPG: 3.0012, // kg CO2/kg\n    \n    // Â∑•‰∏öËøáÁ®ãÊéíÊîæÂõ†Â≠ê\n    CEMENT: 0.5273, // kg CO2/kgÊ∞¥Ê≥•\n    STEEL: 2.07, // kg CO2/kgÈí¢ÈìÅ\n    ALUMINUM: 11.46, // kg CO2/kgÈìù\n    CHEMICAL: 1.5, // kg CO2/kgÂåñÂ∑•‰∫ßÂìÅÔºàÂπ≥ÂùáÂÄºÔºâ\n    PAPER: 0.9, // kg CO2/kgÁ∫∏Âº†\n    \n    // ÂèØÂÜçÁîüËÉΩÊ∫êÊéíÊîæÂõ†Â≠ê\n    SOLAR: 0.0,\n    WIND: 0.0,\n    HYDRO: 0.0,\n    NUCLEAR: 0.0\n  },\n  \n  // ÂõΩÂÆ∂Ê†∏ÂøÉÊåáÊ†áÁõÆÊ†áÂÄº\n  NATIONAL_TARGETS: {\n    // Âçï‰ΩçËÉΩËÄóÁ¢≥ÊéíÊîæÁõÆÊ†áÂÄº (Âê®CO‚ÇÇ/Âê®Ê†áÂáÜÁÖ§)\n    CARBON_INTENSITY_TARGET_MIN: 0.2,\n    CARBON_INTENSITY_TARGET_MAX: 0.3,\n    \n    // Ê∏ÖÊ¥ÅËÉΩÊ∫êÊ∂àË¥πÂç†ÊØîÁõÆÊ†áÂÄº (%)\n    CLEAN_ENERGY_RATIO_TARGET: 90,\n    \n    // Â∑•‰∏öÂõ∫Â∫üÁªºÂêàÂà©Áî®ÁéáÁõÆÊ†áÂÄº (%)\n    SOLID_WASTE_UTILIZATION_TARGET: 95,\n    \n    // ‰ΩôÁÉ≠/‰ΩôÂÜ∑/‰ΩôÂéãÁªºÂêàÂà©Áî®ÁéáÁõÆÊ†áÂÄº (%)\n    WASTE_ENERGY_UTILIZATION_TARGET: 80,\n    \n    // Â∑•‰∏öÁî®Ê∞¥ÈáçÂ§çÂà©Áî®ÁéáÁõÆÊ†áÂÄº (%)\n    WATER_REUSE_TARGET: 90\n  },\n  \n  // ËÉΩÊ∫êÊäòÊ†áÁÖ§Á≥ªÊï∞\n  ENERGY_CONVERSION_FACTORS: {\n    // ÁîµÂäõÔºàÁ≠â‰ª∑ÂÄºËÆ°ÁÆóÔºâ\n    ELECTRICITY_EQUIVALENT: 0.1229, // kgce/kWh\n    \n    // ÂåñÁü≥ÁáÉÊñôÊäòÊ†áÁÖ§Á≥ªÊï∞\n    NATURAL_GAS: 1.33, // kgce/m¬≥\n    COAL: 0.7143, // kgce/kg\n    DIESEL: 1.4571, // kgce/kg\n    GASOLINE: 1.4714, // kgce/kg\n    HEAVY_OIL: 1.4286, // kgce/kg\n    LPG: 1.7143, // kgce/kg\n    \n    // ÁÉ≠ÂäõÊäòÊ†áÁÖ§Á≥ªÊï∞\n    HEAT: 0.03412 // kgce/MJ\n  },\n  \n  // ËÆ°ÁÆóÁ≤æÂ∫¶\n  CALCULATION_PRECISION: {\n    EMISSION_DECIMAL_PLACES: 4,\n    RATIO_DECIMAL_PLACES: 2,\n    ENERGY_DECIMAL_PLACES: 3\n  },\n  \n  // Êï∞ÊçÆË¥®ÈáèÈòàÂÄº\n  DATA_QUALITY_THRESHOLDS: {\n    COMPLETENESS_MIN: 0.95, // Êï∞ÊçÆÂÆåÊï¥ÊÄßÊúÄ‰ΩéË¶ÅÊ±Ç95%\n    ACCURACY_MIN: 0.99, // Êï∞ÊçÆÂáÜÁ°ÆÊÄßÊúÄ‰ΩéË¶ÅÊ±Ç99%\n    TIMELINESS_MAX_DELAY: 60 * 60 * 1000 // Êï∞ÊçÆÊó∂ÊïàÊÄßÊúÄÂ§ßÂª∂Ëøü1Â∞èÊó∂\n  }\n};\n\n// ÂØºÂá∫ÊâÄÊúâÂ∏∏ÈáèÁöÑÁªÑÂêàÂØπË±°\nexport const ALL_CONSTANTS = {\n  ...MATH_CONSTANTS,\n  ...TIME_INTERVALS,\n  ...STORAGE_CONSTANTS,\n  ...PREVIOUS_TIME_RANGES,\n  ...ENERGY_CONSTANTS,\n  ...CARBON_CONSTANTS,\n  ...HTTP_STATUS_CODES,\n  ...DATA_PROCESSING_CONSTANTS,\n  ...DEVICE_CONSTANTS,\n  ...ALGORITHM_CONSTANTS,\n  ...SECURITY_CONSTANTS,\n  ...MONITORING_CONSTANTS\n};\n\nexport default ALL_CONSTANTS;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/shared/database/QueryOptimizer.js","messages":[{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":11,"column":57,"nodeType":"Literal","messageId":"noMagic","endLine":11,"endColumn":61},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":13,"column":39,"nodeType":"Literal","messageId":"noMagic","endLine":13,"endColumn":42},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 300000.","line":237,"column":39,"nodeType":"Literal","messageId":"noMagic","endLine":237,"endColumn":45},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":295,"column":31,"nodeType":"Literal","messageId":"noMagic","endLine":295,"endColumn":34},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":295,"column":52,"nodeType":"Literal","messageId":"noMagic","endLine":295,"endColumn":55},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 200.","line":356,"column":29,"nodeType":"Literal","messageId":"noMagic","endLine":356,"endColumn":32},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 200.","line":356,"column":50,"nodeType":"Literal","messageId":"noMagic","endLine":356,"endColumn":53},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":396,"column":66,"nodeType":"Literal","messageId":"noMagic","endLine":396,"endColumn":69},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":446,"column":49,"nodeType":"Literal","messageId":"noMagic","endLine":446,"endColumn":51},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 30000.","line":448,"column":49,"nodeType":"Literal","messageId":"noMagic","endLine":448,"endColumn":54},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 300000.","line":449,"column":43,"nodeType":"Literal","messageId":"noMagic","endLine":449,"endColumn":49}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":11,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { performance } from 'perf_hooks';\nimport logger from '../../interfaces/http/utils/logger.js';\n\n/**\n * Êï∞ÊçÆÂ∫ìÊü•ËØ¢‰ºòÂåñÂô®\n */\nexport class QueryOptimizer {\n  constructor(options = {}) {\n    this.options = {\n      enableQueryLogging: options.enableQueryLogging !== false,\n      slowQueryThreshold: options.slowQueryThreshold || 1000, // 1Áßí\n      enableQueryCache: options.enableQueryCache !== false,\n      cacheSize: options.cacheSize || 100,\n      enableExplainPlan: options.enableExplainPlan || false,\n      ...options\n    };\n\n    this.queryCache = new Map();\n    this.queryStats = new Map();\n    this.preparedStatements = new Map();\n  }\n\n  /**\n   * ÊâßË°å‰ºòÂåñÁöÑÊü•ËØ¢\n   */\n  async executeQuery(db, sql, params = [], options = {}) {\n    const startTime = performance.now();\n    const queryKey = this.generateQueryKey(sql, params);\n\n    try {\n      // Ê£ÄÊü•Êü•ËØ¢ÁºìÂ≠ò\n      if (this.options.enableQueryCache && options.useCache !== false) {\n        const cached = this.queryCache.get(queryKey);\n        if (cached && !this.isCacheExpired(cached)) {\n          this.recordQueryStats(sql, performance.now() - startTime, true);\n          return cached.result;\n        }\n      }\n\n      // ÊâßË°åÊü•ËØ¢\n      let result;\n      if (options.useTransaction) {\n        result = await this.executeInTransaction(db, sql, params);\n      } else if (options.usePreparedStatement) {\n        result = await this.executePreparedStatement(db, sql, params);\n      } else {\n        result = await this.executeDirectQuery(db, sql, params);\n      }\n\n      const executionTime = performance.now() - startTime;\n\n      // ËÆ∞ÂΩïÊü•ËØ¢ÁªüËÆ°\n      this.recordQueryStats(sql, executionTime, false);\n\n      // ÁºìÂ≠òÁªìÊûú\n      if (this.options.enableQueryCache && options.useCache !== false && this.isCacheable(sql)) {\n        this.cacheResult(queryKey, result, options.cacheTTL);\n      }\n\n      // ËÆ∞ÂΩïÊÖ¢Êü•ËØ¢\n      if (executionTime > this.options.slowQueryThreshold) {\n        this.logSlowQuery(sql, params, executionTime);\n      }\n\n      return result;\n    } catch (error) {\n      const executionTime = performance.now() - startTime;\n      this.recordQueryStats(sql, executionTime, false, error);\n      throw error;\n    }\n  }\n\n  /**\n   * Áõ¥Êé•ÊâßË°åÊü•ËØ¢\n   */\n  async executeDirectQuery(db, sql, params) {\n    if (params && params.length > 0) {\n      return new Promise((resolve, reject) => {\n        db.all(sql, params, (err, rows) => {\n          if (err) {\n            reject(err);\n          } else {\n            resolve(rows);\n          }\n        });\n      });\n    }\n    return new Promise((resolve, reject) => {\n      db.all(sql, (err, rows) => {\n        if (err) {\n          reject(err);\n        } else {\n          resolve(rows);\n        }\n      });\n    });\n  }\n\n  /**\n   * ‰ΩøÁî®È¢ÑÂ§ÑÁêÜËØ≠Âè•ÊâßË°åÊü•ËØ¢\n   */\n  async executePreparedStatement(db, sql, params) {\n    const stmtKey = this.generateStatementKey(sql);\n\n    if (!this.preparedStatements.has(stmtKey)) {\n      const stmt = db.prepare(sql);\n      this.preparedStatements.set(stmtKey, stmt);\n    }\n\n    const stmt = this.preparedStatements.get(stmtKey);\n\n    return new Promise((resolve, reject) => {\n      stmt.all(params, (err, rows) => {\n        if (err) {\n          reject(err);\n        } else {\n          resolve(rows);\n        }\n      });\n    });\n  }\n\n  /**\n   * Âú®‰∫ãÂä°‰∏≠ÊâßË°åÊü•ËØ¢\n   */\n  async executeInTransaction(db, sql, params) {\n    return new Promise((resolve, reject) => {\n      db.serialize(() => {\n        db.run('BEGIN TRANSACTION');\n\n        db.all(sql, params, (err, rows) => {\n          if (err) {\n            db.run('ROLLBACK', (rollbackErr) => {\n              if (rollbackErr) {\n                logger.error('‰∫ãÂä°ÂõûÊªöÂ§±Ë¥•', { error: rollbackErr.message });\n              }\n              reject(err);\n            });\n          } else {\n            db.run('COMMIT', (commitErr) => {\n              if (commitErr) {\n                reject(commitErr);\n              } else {\n                resolve(rows);\n              }\n            });\n          }\n        });\n      });\n    });\n  }\n\n  /**\n   * ÊâπÈáèÊâßË°åÊü•ËØ¢\n   */\n  async executeBatch(db, queries) {\n    const results = [];\n    const startTime = performance.now();\n\n    return new Promise((resolve, reject) => {\n      db.serialize(() => {\n        db.run('BEGIN TRANSACTION');\n\n        let completed = 0;\n        let hasError = false;\n\n        queries.forEach((query, index) => {\n          const { sql, params = [] } = query;\n\n          db.all(sql, params, (err, rows) => {\n            if (err && !hasError) {\n              hasError = true;\n              db.run('ROLLBACK', () => {\n                reject(err);\n              });\n              return;\n            }\n\n            if (!hasError) {\n              results[index] = rows;\n              completed++;\n\n              if (completed === queries.length) {\n                db.run('COMMIT', (commitErr) => {\n                  if (commitErr) {\n                    reject(commitErr);\n                  } else {\n                    const executionTime = performance.now() - startTime;\n                    logger.info('ÊâπÈáèÊü•ËØ¢ÂÆåÊàê', {\n                      queryCount: queries.length,\n                      executionTime: `${executionTime.toFixed(2)}ms`\n                    });\n                    resolve(results);\n                  }\n                });\n              }\n            }\n          });\n        });\n      });\n    });\n  }\n\n  /**\n   * ÁîüÊàêÊü•ËØ¢ÁºìÂ≠òÈîÆ\n   */\n  generateQueryKey(sql, params) {\n    const normalizedSql = sql.replace(/\\s+/g, ' ').trim().toLowerCase();\n    const paramsStr = JSON.stringify(params || []);\n    return `${normalizedSql}:${paramsStr}`;\n  }\n\n  /**\n   * ÁîüÊàêÈ¢ÑÂ§ÑÁêÜËØ≠Âè•ÈîÆ\n   */\n  generateStatementKey(sql) {\n    return sql.replace(/\\s+/g, ' ').trim().toLowerCase();\n  }\n\n  /**\n   * Âà§Êñ≠Êü•ËØ¢ÊòØÂê¶ÂèØÁºìÂ≠ò\n   */\n  isCacheable(sql) {\n    const normalizedSql = sql.toLowerCase().trim();\n    // Âè™ÁºìÂ≠òSELECTÊü•ËØ¢ÔºåÊéíÈô§ÂåÖÂê´NOW()„ÄÅRANDOM()Á≠âÂáΩÊï∞ÁöÑÊü•ËØ¢\n    return (\n      normalizedSql.startsWith('select') &&\n      !normalizedSql.includes('now()') &&\n      !normalizedSql.includes('random()') &&\n      !normalizedSql.includes('current_timestamp')\n    );\n  }\n\n  /**\n   * ÁºìÂ≠òÊü•ËØ¢ÁªìÊûú\n   */\n  cacheResult(queryKey, result, ttl = 300000) {\n    // ÈªòËÆ§5ÂàÜÈíü\n    // Â¶ÇÊûúÁºìÂ≠òÂ∑≤Êª°ÔºåÂà†Èô§ÊúÄÊóßÁöÑÊù°ÁõÆ\n    if (this.queryCache.size >= this.options.cacheSize) {\n      const firstKey = this.queryCache.keys().next().value;\n      this.queryCache.delete(firstKey);\n    }\n\n    this.queryCache.set(queryKey, {\n      result: JSON.parse(JSON.stringify(result)), // Ê∑±Êã∑Ë¥ù\n      timestamp: Date.now(),\n      ttl\n    });\n  }\n\n  /**\n   * Ê£ÄÊü•ÁºìÂ≠òÊòØÂê¶ËøáÊúü\n   */\n  isCacheExpired(cached) {\n    return Date.now() - cached.timestamp > cached.ttl;\n  }\n\n  /**\n   * ËÆ∞ÂΩïÊü•ËØ¢ÁªüËÆ°\n   */\n  recordQueryStats(sql, executionTime, fromCache, error = null) {\n    const queryType = this.getQueryType(sql);\n\n    if (!this.queryStats.has(queryType)) {\n      this.queryStats.set(queryType, {\n        count: 0,\n        totalTime: 0,\n        avgTime: 0,\n        minTime: Infinity,\n        maxTime: 0,\n        cacheHits: 0,\n        errors: 0\n      });\n    }\n\n    const stats = this.queryStats.get(queryType);\n    stats.count++;\n\n    if (fromCache) {\n      stats.cacheHits++;\n    } else {\n      stats.totalTime += executionTime;\n      stats.avgTime = stats.totalTime / (stats.count - stats.cacheHits);\n      stats.minTime = Math.min(stats.minTime, executionTime);\n      stats.maxTime = Math.max(stats.maxTime, executionTime);\n    }\n\n    if (error) {\n      stats.errors++;\n    }\n\n    if (this.options.enableQueryLogging) {\n      logger.debug('Êü•ËØ¢ÊâßË°å', {\n        sql: sql.substring(0, 100) + (sql.length > 100 ? '...' : ''),\n        executionTime: `${executionTime.toFixed(2)}ms`,\n        fromCache,\n        queryType\n      });\n    }\n  }\n\n  /**\n   * Ëé∑ÂèñÊü•ËØ¢Á±ªÂûã\n   */\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 23 Ë°å)\n\n  getQueryType(sql) {\n    const normalizedSql = sql.toLowerCase().trim();\n    if (normalizedSql.startsWith('select')) {\n      return 'SELECT';\n    }\n    if (normalizedSql.startsWith('insert')) {\n      return 'INSERT';\n    }\n    if (normalizedSql.startsWith('update')) {\n      return 'UPDATE';\n    }\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (normalizedSql.startsWith('delete')) {\n      return 'DELETE';\n    }\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (normalizedSql.startsWith('create')) {\n      return 'CREATE';\n    }\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (normalizedSql.startsWith('drop')) {\n      return 'DROP';\n    }\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    // TODO: ËÄÉËôë‰ΩøÁî®Êó©ÊúüËøîÂõûÊàñÁ≠ñÁï•Ê®°ÂºèÊù•ÂáèÂ∞ëÂµåÂ•ó\n    if (normalizedSql.startsWith('alter')) {\n      return 'ALTER';\n    }\n    return 'OTHER';\n  }\n\n  /**\n   * ËÆ∞ÂΩïÊÖ¢Êü•ËØ¢\n   */\n  logSlowQuery(sql, params, executionTime) {\n    logger.warn('ÊÖ¢Êü•ËØ¢Ê£ÄÊµã', {\n      sql: sql.substring(0, 200) + (sql.length > 200 ? '...' : ''),\n      params: JSON.stringify(params),\n      executionTime: `${executionTime.toFixed(2)}ms`,\n      threshold: `${this.options.slowQueryThreshold}ms`\n    });\n  }\n\n  /**\n   * Ëé∑ÂèñÊü•ËØ¢ÁªüËÆ°‰ø°ÊÅØ\n   */\n  getQueryStats() {\n    const stats = {};\n    for (const [queryType, data] of this.queryStats.entries()) {\n      stats[queryType] = { ...data };\n    }\n    return {\n      queryStats: stats,\n      cacheStats: {\n        size: this.queryCache.size,\n        maxSize: this.options.cacheSize,\n        hitRate: this.calculateCacheHitRate()\n      },\n      preparedStatements: {\n        count: this.preparedStatements.size\n      }\n    };\n  }\n\n  /**\n   * ËÆ°ÁÆóÁºìÂ≠òÂëΩ‰∏≠Áéá\n   */\n  calculateCacheHitRate() {\n    let totalQueries = 0;\n    let totalCacheHits = 0;\n\n    for (const stats of this.queryStats.values()) {\n      totalQueries += stats.count;\n      totalCacheHits += stats.cacheHits;\n    }\n\n    return totalQueries > 0 ? ((totalCacheHits / totalQueries) * 100).toFixed(2) : 0;\n  }\n\n  /**\n   * Ê∏ÖÁêÜÁºìÂ≠ò\n   */\n  clearCache() {\n    this.queryCache.clear();\n    logger.info('Êü•ËØ¢ÁºìÂ≠òÂ∑≤Ê∏ÖÁêÜ');\n  }\n\n  /**\n   * Ê∏ÖÁêÜÈ¢ÑÂ§ÑÁêÜËØ≠Âè•\n   */\n  clearPreparedStatements() {\n    for (const stmt of this.preparedStatements.values()) {\n      try {\n        stmt.finalize();\n      } catch (error) {\n        logger.error('Ê∏ÖÁêÜÈ¢ÑÂ§ÑÁêÜËØ≠Âè•Â§±Ë¥•', { error: error.message });\n      }\n    }\n    this.preparedStatements.clear();\n    logger.info('È¢ÑÂ§ÑÁêÜËØ≠Âè•Â∑≤Ê∏ÖÁêÜ');\n  }\n\n  /**\n   * ÈáçÁΩÆÁªüËÆ°‰ø°ÊÅØ\n   */\n  resetStats() {\n    this.queryStats.clear();\n    logger.info('Êü•ËØ¢ÁªüËÆ°‰ø°ÊÅØÂ∑≤ÈáçÁΩÆ');\n  }\n\n  /**\n   * ÂÖ≥Èó≠‰ºòÂåñÂô®\n   */\n  close() {\n    this.clearCache();\n    this.clearPreparedStatements();\n    this.resetStats();\n  }\n}\n\n/**\n * Êï∞ÊçÆÂ∫ìËøûÊé•Ê±†ÁÆ°ÁêÜÂô®\n */\nexport class ConnectionPoolManager {\n  constructor(options = {}) {\n    this.options = {\n      maxConnections: options.maxConnections || 10,\n      minConnections: options.minConnections || 2,\n      acquireTimeout: options.acquireTimeout || 30000,\n      idleTimeout: options.idleTimeout || 300000,\n      ...options\n    };\n\n    this.pool = [];\n    this.activeConnections = new Set();\n    this.waitingQueue = [];\n    this.stats = {\n      created: 0,\n      acquired: 0,\n      released: 0,\n      destroyed: 0,\n      timeouts: 0\n    };\n  }\n\n  /**\n   * Ëé∑ÂèñËøûÊé•\n   */\n  async acquire() {\n    return new Promise((resolve, reject) => {\n      // Ê£ÄÊü•ÊòØÂê¶ÊúâÂèØÁî®ËøûÊé•\n      const availableConnection = this.pool.find((conn) => !conn.inUse);\n      if (availableConnection) {\n        availableConnection.inUse = true;\n        availableConnection.lastUsed = Date.now();\n        this.activeConnections.add(availableConnection);\n        this.stats.acquired++;\n        resolve(availableConnection.connection);\n        return;\n      }\n\n      // Â¶ÇÊûúÂèØ‰ª•ÂàõÂª∫Êñ∞ËøûÊé•\n      if (this.pool.length < this.options.maxConnections) {\n        this.createConnection()\n          .then((connection) => {\n            this.stats.acquired++;\n            resolve(connection);\n          })\n          .catch(reject);\n        return;\n      }\n\n      // Âä†ÂÖ•Á≠âÂæÖÈòüÂàó\n      const timeout = setTimeout(() => {\n        const index = this.waitingQueue.findIndex((item) => item.resolve === resolve);\n        if (index !== -1) {\n          this.waitingQueue.splice(index, 1);\n          this.stats.timeouts++;\n          reject(new Error('Ëé∑ÂèñÊï∞ÊçÆÂ∫ìËøûÊé•Ë∂ÖÊó∂'));\n        }\n      }, this.options.acquireTimeout);\n\n      this.waitingQueue.push({ resolve, reject, timeout });\n    });\n  }\n\n  /**\n   * ÈáäÊîæËøûÊé•\n   */\n  release(connection) {\n    const poolConnection = this.pool.find((conn) => conn.connection === connection);\n    if (poolConnection) {\n      poolConnection.inUse = false;\n      poolConnection.lastUsed = Date.now();\n      this.activeConnections.delete(poolConnection);\n      this.stats.released++;\n\n      // Â§ÑÁêÜÁ≠âÂæÖÈòüÂàó\n      if (this.waitingQueue.length > 0) {\n        const { resolve, timeout } = this.waitingQueue.shift();\n        clearTimeout(timeout);\n        poolConnection.inUse = true;\n        poolConnection.lastUsed = Date.now();\n        this.activeConnections.add(poolConnection);\n        this.stats.acquired++;\n        resolve(connection);\n      }\n    }\n  }\n\n  /**\n   * ÂàõÂª∫Êñ∞ËøûÊé•\n   */\n  async createConnection() {\n    // ËøôÈáåÈúÄË¶ÅÊ†πÊçÆÂÆûÈôÖÁöÑÊï∞ÊçÆÂ∫ìÁ±ªÂûãÂÆûÁé∞\n    // Á§∫‰æã‰ΩøÁî®SQLite\n    const sqlite3 = require('sqlite3').verbose();\n    const connection = new sqlite3.Database(':memory:');\n\n    const poolConnection = {\n      connection,\n      inUse: true,\n      created: Date.now(),\n      lastUsed: Date.now()\n    };\n\n    this.pool.push(poolConnection);\n    this.activeConnections.add(poolConnection);\n    this.stats.created++;\n\n    return connection;\n  }\n\n  /**\n   * Ê∏ÖÁêÜÁ©∫Èó≤ËøûÊé•\n   */\n  cleanupIdleConnections() {\n    const now = Date.now();\n    const connectionsToRemove = [];\n\n    for (const poolConnection of this.pool) {\n      if (\n        !poolConnection.inUse &&\n        now - poolConnection.lastUsed > this.options.idleTimeout &&\n        this.pool.length > this.options.minConnections\n      ) {\n        connectionsToRemove.push(poolConnection);\n      }\n    }\n\n    for (const poolConnection of connectionsToRemove) {\n      this.destroyConnection(poolConnection);\n    }\n  }\n\n  /**\n   * ÈîÄÊØÅËøûÊé•\n   */\n  destroyConnection(poolConnection) {\n    try {\n      poolConnection.connection.close();\n      const index = this.pool.indexOf(poolConnection);\n      if (index !== -1) {\n        this.pool.splice(index, 1);\n      }\n      this.activeConnections.delete(poolConnection);\n      this.stats.destroyed++;\n    } catch (error) {\n      logger.error('ÈîÄÊØÅÊï∞ÊçÆÂ∫ìËøûÊé•Â§±Ë¥•', { error: error.message });\n    }\n  }\n\n  /**\n   * Ëé∑ÂèñËøûÊé•Ê±†ÁªüËÆ°‰ø°ÊÅØ\n   */\n  getStats() {\n    return {\n      ...this.stats,\n      totalConnections: this.pool.length,\n      activeConnections: this.activeConnections.size,\n      idleConnections: this.pool.length - this.activeConnections.size,\n      waitingRequests: this.waitingQueue.length,\n      maxConnections: this.options.maxConnections,\n      minConnections: this.options.minConnections\n    };\n  }\n\n  /**\n   * ÂÖ≥Èó≠ËøûÊé•Ê±†\n   */\n  async close() {\n    // Ê∏ÖÁêÜÁ≠âÂæÖÈòüÂàó\n    for (const { reject, timeout } of this.waitingQueue) {\n      clearTimeout(timeout);\n      reject(new Error('ËøûÊé•Ê±†Ê≠£Âú®ÂÖ≥Èó≠'));\n    }\n    this.waitingQueue = [];\n\n    // ÂÖ≥Èó≠ÊâÄÊúâËøûÊé•\n    for (const poolConnection of this.pool) {\n      this.destroyConnection(poolConnection);\n    }\n\n    logger.info('Êï∞ÊçÆÂ∫ìËøûÊé•Ê±†Â∑≤ÂÖ≥Èó≠');\n  }\n}\n\n// ÂØºÂá∫ÈªòËÆ§ÂÆû‰æã\nexport const defaultQueryOptimizer = new QueryOptimizer();\nexport const defaultConnectionPool = new ConnectionPoolManager();\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/shared/middleware/enhancedErrorHandler.js","messages":[{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":25,"column":18,"nodeType":"Literal","messageId":"noMagic","endLine":25,"endColumn":21},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":43,"column":20,"nodeType":"Literal","messageId":"noMagic","endLine":43,"endColumn":23},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 401.","line":51,"column":20,"nodeType":"Literal","messageId":"noMagic","endLine":51,"endColumn":23},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 403.","line":59,"column":20,"nodeType":"Literal","messageId":"noMagic","endLine":59,"endColumn":23},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 404.","line":67,"column":29,"nodeType":"Literal","messageId":"noMagic","endLine":67,"endColumn":32},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 409.","line":75,"column":20,"nodeType":"Literal","messageId":"noMagic","endLine":75,"endColumn":23},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":83,"column":20,"nodeType":"Literal","messageId":"noMagic","endLine":83,"endColumn":23},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 502.","line":90,"column":46,"nodeType":"Literal","messageId":"noMagic","endLine":90,"endColumn":49},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 429.","line":100,"column":20,"nodeType":"Literal","messageId":"noMagic","endLine":100,"endColumn":23},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":112,"column":33,"nodeType":"Literal","messageId":"noMagic","endLine":112,"endColumn":36},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":128,"column":69,"nodeType":"Literal","messageId":"noMagic","endLine":128,"endColumn":72},{"ruleId":"no-unused-vars","severity":2,"message":"'next' is defined but never used. Allowed unused args must match /^_/u.","line":194,"column":55,"nodeType":"Identifier","messageId":"unusedVar","endLine":194,"endColumn":59},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":215,"column":29,"nodeType":"Literal","messageId":"noMagic","endLine":215,"endColumn":32},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":222,"column":49,"nodeType":"Literal","messageId":"noMagic","endLine":222,"endColumn":52},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":243,"column":43,"nodeType":"Literal","messageId":"noMagic","endLine":243,"endColumn":46},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 3.","line":261,"column":55,"nodeType":"Literal","messageId":"noMagic","endLine":261,"endColumn":56},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":261,"column":66,"nodeType":"Literal","messageId":"noMagic","endLine":261,"endColumn":70},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5.","line":282,"column":54,"nodeType":"Literal","messageId":"noMagic","endLine":282,"endColumn":55},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60000.","line":282,"column":67,"nodeType":"Literal","messageId":"noMagic","endLine":282,"endColumn":72},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 503.","line":296,"column":63,"nodeType":"Literal","messageId":"noMagic","endLine":296,"endColumn":66}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":19,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Â¢ûÂº∫ÁöÑÈîôËØØÂ§ÑÁêÜ‰∏≠Èó¥‰ª∂\n * Êèê‰æõÁªü‰∏ÄÁöÑÈîôËØØÂìçÂ∫îÊ†ºÂºèÂíåÈîôËØØÂàÜÁ±ª\n */\n\nimport { logger } from '../utils/logger.js';\n\n// ÈîôËØØÁ±ªÂûãÊûö‰∏æ\nexport const ErrorTypes = {\n  VALIDATION_ERROR: 'VALIDATION_ERROR',\n  AUTHENTICATION_ERROR: 'AUTHENTICATION_ERROR',\n  AUTHORIZATION_ERROR: 'AUTHORIZATION_ERROR',\n  NOT_FOUND_ERROR: 'NOT_FOUND_ERROR',\n  CONFLICT_ERROR: 'CONFLICT_ERROR',\n  DATABASE_ERROR: 'DATABASE_ERROR',\n  EXTERNAL_SERVICE_ERROR: 'EXTERNAL_SERVICE_ERROR',\n  RATE_LIMIT_ERROR: 'RATE_LIMIT_ERROR',\n  INTERNAL_SERVER_ERROR: 'INTERNAL_SERVER_ERROR'\n};\n\n// Ëá™ÂÆö‰πâÈîôËØØÁ±ª\nexport class AppError extends Error {\n  constructor(\n    message,\n    statusCode = 500,\n    errorType = ErrorTypes.INTERNAL_SERVER_ERROR,\n    details = null\n  ) {\n    super(message);\n    this.name = 'AppError';\n    this.statusCode = statusCode;\n    this.errorType = errorType;\n    this.details = details;\n    this.isOperational = true;\n\n    Error.captureStackTrace(this, this.constructor);\n  }\n}\n\n// È™åËØÅÈîôËØØ\nexport class ValidationError extends AppError {\n  constructor(message, details = null) {\n    super(message, 400, ErrorTypes.VALIDATION_ERROR, details);\n    this.name = 'ValidationError';\n  }\n}\n\n// ËÆ§ËØÅÈîôËØØ\nexport class AuthenticationError extends AppError {\n  constructor(message = 'ËÆ§ËØÅÂ§±Ë¥•') {\n    super(message, 401, ErrorTypes.AUTHENTICATION_ERROR);\n    this.name = 'AuthenticationError';\n  }\n}\n\n// ÊéàÊùÉÈîôËØØ\nexport class AuthorizationError extends AppError {\n  constructor(message = 'ÊùÉÈôê‰∏çË∂≥') {\n    super(message, 403, ErrorTypes.AUTHORIZATION_ERROR);\n    this.name = 'AuthorizationError';\n  }\n}\n\n// ËµÑÊ∫êÊú™ÊâæÂà∞ÈîôËØØ\nexport class NotFoundError extends AppError {\n  constructor(resource = 'ËµÑÊ∫ê') {\n    super(`${resource}Êú™ÊâæÂà∞`, 404, ErrorTypes.NOT_FOUND_ERROR);\n    this.name = 'NotFoundError';\n  }\n}\n\n// ÂÜ≤Á™ÅÈîôËØØ\nexport class ConflictError extends AppError {\n  constructor(message = 'ËµÑÊ∫êÂÜ≤Á™Å') {\n    super(message, 409, ErrorTypes.CONFLICT_ERROR);\n    this.name = 'ConflictError';\n  }\n}\n\n// Êï∞ÊçÆÂ∫ìÈîôËØØ\nexport class DatabaseError extends AppError {\n  constructor(message, originalError = null) {\n    super(message, 500, ErrorTypes.DATABASE_ERROR, originalError);\n    this.name = 'DatabaseError';\n  }\n}\n\n// Â§ñÈÉ®ÊúçÂä°ÈîôËØØ\nexport class ExternalServiceError extends AppError {\n  constructor(service, message, statusCode = 502) {\n    super(`${service}ÊúçÂä°ÈîôËØØ: ${message}`, statusCode, ErrorTypes.EXTERNAL_SERVICE_ERROR);\n    this.name = 'ExternalServiceError';\n    this.service = service;\n  }\n}\n\n// ÈôêÊµÅÈîôËØØ\nexport class RateLimitError extends AppError {\n  constructor(message = 'ËØ∑Ê±ÇËøá‰∫éÈ¢ëÁπÅÔºåËØ∑Á®çÂêéÂÜçËØï') {\n    super(message, 429, ErrorTypes.RATE_LIMIT_ERROR);\n    this.name = 'RateLimitError';\n  }\n}\n\n// ÈîôËØØÂìçÂ∫îÊ†ºÂºèÂåñ\nfunction formatErrorResponse(error, req) {\n  const response = {\n    success: false,\n    error: {\n      type: error.errorType || ErrorTypes.INTERNAL_SERVER_ERROR,\n      message: error.message,\n      code: error.statusCode || 500\n    },\n    timestamp: new Date().toISOString(),\n    path: req.originalUrl,\n    method: req.method\n  };\n\n  // ÂºÄÂèëÁéØÂ¢É‰∏ãÂåÖÂê´Êõ¥Â§öË∞ÉËØï‰ø°ÊÅØ\n  if (process.env.NODE_ENV === 'development') {\n    response.error.stack = error.stack;\n    if (error.details) {\n      response.error.details = error.details;\n    }\n  }\n\n  // Áîü‰∫ßÁéØÂ¢É‰∏ãÈöêËóèÊïèÊÑü‰ø°ÊÅØ\n  if (process.env.NODE_ENV === 'production' && error.statusCode === 500) {\n    response.error.message = 'ÊúçÂä°Âô®ÂÜÖÈÉ®ÈîôËØØ';\n  }\n\n  return response;\n}\n\n// Êï∞ÊçÆÂ∫ìÈîôËØØÂ§ÑÁêÜ\nfunction handleDatabaseError(error) {\n  // SQLiteÈîôËØØÂ§ÑÁêÜ\n  if (error.code === 'SQLITE_CONSTRAINT_UNIQUE') {\n    return new ConflictError('Êï∞ÊçÆÂ∑≤Â≠òÂú®ÔºåËØ∑Ê£ÄÊü•ÂîØ‰∏ÄÊÄßÁ∫¶Êùü');\n  }\n\n  if (error.code === 'SQLITE_CONSTRAINT_FOREIGNKEY') {\n    return new ValidationError('Â§ñÈîÆÁ∫¶ÊùüËøùÂèçÔºåËØ∑Ê£ÄÊü•ÂÖ≥ËÅîÊï∞ÊçÆ');\n  }\n\n  if (error.message && error.message.includes('no such column')) {\n    return new DatabaseError('Êï∞ÊçÆÂ∫ìÁªìÊûÑÈîôËØØÔºåËØ∑Ê£ÄÊü•Â≠óÊÆµÂêçÁß∞');\n  }\n\n  if (error.message && error.message.includes('no such table')) {\n    return new DatabaseError('Êï∞ÊçÆË°®‰∏çÂ≠òÂú®ÔºåËØ∑Ê£ÄÊü•Êï∞ÊçÆÂ∫ìËøÅÁßª');\n  }\n\n  // Knex.jsÈîôËØØÂ§ÑÁêÜ\n  if (error.code === 'ER_DUP_ENTRY') {\n    return new ConflictError('Êï∞ÊçÆÈáçÂ§çÔºåËØ∑Ê£ÄÊü•ÂîØ‰∏ÄÊÄßÁ∫¶Êùü');\n  }\n\n  if (error.code === 'ER_NO_REFERENCED_ROW_2') {\n    return new ValidationError('Â§ñÈîÆÁ∫¶ÊùüËøùÂèçÔºåÂÖ≥ËÅîÊï∞ÊçÆ‰∏çÂ≠òÂú®');\n  }\n\n  return new DatabaseError('Êï∞ÊçÆÂ∫ìÊìç‰ΩúÂ§±Ë¥•', error);\n}\n\n// JWTÈîôËØØÂ§ÑÁêÜ\nfunction handleJWTError(error) {\n  if (error.name === 'JsonWebTokenError') {\n    return new AuthenticationError('Êó†ÊïàÁöÑËÆøÈóÆ‰ª§Áâå');\n  }\n\n  if (error.name === 'TokenExpiredError') {\n    return new AuthenticationError('ËÆøÈóÆ‰ª§ÁâåÂ∑≤ËøáÊúü');\n  }\n\n  if (error.name === 'NotBeforeError') {\n    return new AuthenticationError('ËÆøÈóÆ‰ª§ÁâåÂ∞öÊú™ÁîüÊïà');\n  }\n\n  return new AuthenticationError('‰ª§ÁâåÈ™åËØÅÂ§±Ë¥•');\n}\n\n// È™åËØÅÈîôËØØÂ§ÑÁêÜ\nfunction handleValidationError(error) {\n  if (error.name === 'ValidationError' && error.details) {\n    const messages = error.details.map((detail) => detail.message);\n    return new ValidationError('Êï∞ÊçÆÈ™åËØÅÂ§±Ë¥•', messages);\n  }\n\n  return new ValidationError(error.message);\n}\n\n// ‰∏ªÈîôËØØÂ§ÑÁêÜ‰∏≠Èó¥‰ª∂\nexport function enhancedErrorHandler(error, req, res, next) {\n  let processedError = error;\n\n  // Â¶ÇÊûú‰∏çÊòØËá™ÂÆö‰πâÈîôËØØÔºåËøõË°åÈîôËØØËΩ¨Êç¢\n  if (!error.isOperational) {\n    // Êï∞ÊçÆÂ∫ìÈîôËØØ\n    if (error.code && (error.code.startsWith('SQLITE_') || error.code.startsWith('ER_'))) {\n      processedError = handleDatabaseError(error);\n    }\n    // JWTÈîôËØØ\n    else if (error.name && error.name.includes('Token')) {\n      processedError = handleJWTError(error);\n    }\n    // È™åËØÅÈîôËØØ\n    else if (error.name === 'ValidationError') {\n      processedError = handleValidationError(error);\n    }\n    // ÂÖ∂‰ªñÊú™Áü•ÈîôËØØ\n    else {\n      processedError = new AppError(\n        error.message || 'ÊúçÂä°Âô®ÂÜÖÈÉ®ÈîôËØØ',\n        error.statusCode || 500,\n        ErrorTypes.INTERNAL_SERVER_ERROR\n      );\n    }\n  }\n\n  // ËÆ∞ÂΩïÈîôËØØÊó•Âøó\n  const logLevel = processedError.statusCode >= 500 ? 'error' : 'warn';\n  logger[logLevel]('ËØ∑Ê±ÇÂ§ÑÁêÜÈîôËØØ', {\n    error: {\n      name: processedError.name,\n      message: processedError.message,\n      type: processedError.errorType,\n      statusCode: processedError.statusCode,\n      stack: processedError.stack\n    },\n    request: {\n      method: req.method,\n      url: req.originalUrl,\n      ip: req.ip,\n      userAgent: req.get('User-Agent'),\n      userId: req.user?.id,\n      body: req.method !== 'GET' ? req.body : undefined\n    }\n  });\n\n  // ÂèëÈÄÅÈîôËØØÂìçÂ∫î\n  const errorResponse = formatErrorResponse(processedError, req);\n  res.status(processedError.statusCode || 500).json(errorResponse);\n}\n\n// 404ÈîôËØØÂ§ÑÁêÜ‰∏≠Èó¥‰ª∂\nexport function notFoundHandler(req, res, next) {\n  const error = new NotFoundError(`Ë∑ØÁî± ${req.originalUrl}`);\n  next(error);\n}\n\n// ÂºÇÊ≠•ÈîôËØØÊçïËé∑ÂåÖË£ÖÂô®\nexport function asyncHandler(fn) {\n  return (req, res, next) => {\n    Promise.resolve(fn(req, res, next)).catch(next);\n  };\n}\n\n// ÈîôËØØÊÅ¢Â§çÁ≠ñÁï•\nexport class ErrorRecoveryStrategy {\n  static async retryOperation(operation, maxRetries = 3, delay = 1000) {\n    for (let attempt = 1; attempt <= maxRetries; attempt++) {\n      try {\n        return await operation();\n      } catch (error) {\n        if (attempt === maxRetries) {\n          throw error;\n        }\n\n        // ÊåáÊï∞ÈÄÄÈÅø\n        const waitTime = delay * Math.pow(2, attempt - 1);\n        await new Promise((resolve) => setTimeout(resolve, waitTime));\n\n        logger.warn(`Êìç‰ΩúÈáçËØï ${attempt}/${maxRetries}`, {\n          error: error.message,\n          nextRetryIn: waitTime\n        });\n      }\n    }\n  }\n\n  static async circuitBreaker(operation, threshold = 5, timeout = 60000) {\n    // ÁÆÄÂçïÁöÑÊñ≠Ë∑ØÂô®ÂÆûÁé∞\n    const key = operation.name || 'default';\n\n    if (!this.failures) {\n      this.failures = new Map();\n    }\n\n    const failures = this.failures.get(key) || { count: 0, lastFailure: 0 };\n\n    // Ê£ÄÊü•Êñ≠Ë∑ØÂô®Áä∂ÊÄÅ\n    if (failures.count >= threshold) {\n      const timeSinceLastFailure = Date.now() - failures.lastFailure;\n      if (timeSinceLastFailure < timeout) {\n        throw new ExternalServiceError('ÊúçÂä°', 'ÊúçÂä°ÊöÇÊó∂‰∏çÂèØÁî®ÔºåËØ∑Á®çÂêéÈáçËØï', 503);\n      } else {\n        // ÈáçÁΩÆËÆ°Êï∞Âô®\n        failures.count = 0;\n      }\n    }\n\n    try {\n      const result = await operation();\n      // ÊàêÂäüÊó∂ÈáçÁΩÆËÆ°Êï∞Âô®\n      failures.count = 0;\n      this.failures.set(key, failures);\n      return result;\n    } catch (error) {\n      // Â§±Ë¥•Êó∂Â¢ûÂä†ËÆ°Êï∞Âô®\n      failures.count++;\n      failures.lastFailure = Date.now();\n      this.failures.set(key, failures);\n      throw error;\n    }\n  }\n}\n\n// ÂÅ•Â∫∑Ê£ÄÊü•ÈîôËØØÂ§ÑÁêÜ\nexport function healthCheckErrorHandler(error) {\n  if (error.code === 'ECONNREFUSED') {\n    return {\n      status: 'unhealthy',\n      error: 'Êï∞ÊçÆÂ∫ìËøûÊé•Â§±Ë¥•',\n      details: error.message\n    };\n  }\n\n  if (error.code === 'ETIMEDOUT') {\n    return {\n      status: 'unhealthy',\n      error: 'ÊúçÂä°ÂìçÂ∫îË∂ÖÊó∂',\n      details: error.message\n    };\n  }\n\n  return {\n    status: 'unhealthy',\n    error: 'ÂÅ•Â∫∑Ê£ÄÊü•Â§±Ë¥•',\n    details: error.message\n  };\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/shared/middleware/errorHandler.js","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'next' is defined but never used. Allowed unused args must match /^_/u.","line":11,"column":38,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":42},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":16,"column":44,"nodeType":"Literal","messageId":"noMagic","endLine":16,"endColumn":47},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":41,"column":27,"nodeType":"Literal","messageId":"noMagic","endLine":41,"endColumn":30},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":43,"column":34,"nodeType":"Literal","messageId":"noMagic","endLine":43,"endColumn":37},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 404.","line":90,"column":59,"nodeType":"Literal","messageId":"noMagic","endLine":90,"endColumn":62},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 409.","line":106,"column":34,"nodeType":"Literal","messageId":"noMagic","endLine":106,"endColumn":37},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":112,"column":36,"nodeType":"Literal","messageId":"noMagic","endLine":112,"endColumn":39},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":116,"column":37,"nodeType":"Literal","messageId":"noMagic","endLine":116,"endColumn":40},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":122,"column":34,"nodeType":"Literal","messageId":"noMagic","endLine":122,"endColumn":37},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 401.","line":134,"column":36,"nodeType":"Literal","messageId":"noMagic","endLine":134,"endColumn":39},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 401.","line":138,"column":36,"nodeType":"Literal","messageId":"noMagic","endLine":138,"endColumn":39},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 401.","line":141,"column":33,"nodeType":"Literal","messageId":"noMagic","endLine":141,"endColumn":36}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":11,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import logger from '../utils/logger.js';\nimport { AppError } from '../utils/AppError.js';\n\n/**\n * Áªü‰∏ÄÈîôËØØÂ§ÑÁêÜ‰∏≠Èó¥‰ª∂\n * @param {Error} err - ÈîôËØØÂØπË±°\n * @param {Object} req - ËØ∑Ê±ÇÂØπË±°\n * @param {Object} res - ÂìçÂ∫îÂØπË±°\n * @param {Function} next - ‰∏ã‰∏Ä‰∏™‰∏≠Èó¥‰ª∂\n */\nconst errorHandler = (err, req, res, next) => {\n  let error = err;\n\n  // Â¶ÇÊûú‰∏çÊòØ AppError ÂÆû‰æãÔºåËΩ¨Êç¢‰∏∫ AppError\n  if (!(error instanceof AppError)) {\n    const statusCode = error.statusCode || 500;\n    const message = error.message || 'ÊúçÂä°Âô®ÂÜÖÈÉ®ÈîôËØØ';\n    error = new AppError(message, statusCode);\n  }\n\n  // ËÆ∞ÂΩïÈîôËØØÊó•Âøó\n  const logData = {\n    error: {\n      message: error.message,\n      statusCode: error.statusCode,\n      errorCode: error.errorCode,\n      stack: error.stack\n    },\n    request: {\n      method: req.method,\n      url: req.originalUrl,\n      ip: req.ip,\n      userAgent: req.get('User-Agent'),\n      userId: req.user?.id,\n      body: req.method !== 'GET' ? req.body : undefined\n    },\n    timestamp: new Date().toISOString()\n  };\n\n  // Ê†πÊçÆÈîôËØØÁ∫ßÂà´ËÆ∞ÂΩï‰∏çÂêåÁ∫ßÂà´ÁöÑÊó•Âøó\n  if (error.statusCode >= 500) {\n    logger.error('ÊúçÂä°Âô®ÈîôËØØ', logData);\n  } else if (error.statusCode >= 400) {\n    logger.warn('ÂÆ¢Êà∑Á´ØÈîôËØØ', logData);\n  } else {\n    logger.info('ËØ∑Ê±ÇÈîôËØØ', logData);\n  }\n\n  // ÊûÑÂª∫ÂìçÂ∫îÊï∞ÊçÆ\n  const responseData = {\n    success: false,\n    error: {\n      code: error.errorCode,\n      message: error.message,\n      details: error.details,\n      timestamp: error.timestamp\n    }\n  };\n\n  // ÂºÄÂèëÁéØÂ¢É‰∏ãÂåÖÂê´Â†ÜÊ†à‰ø°ÊÅØ\n  if (process.env.NODE_ENV === 'development') {\n    responseData.error.stack = error.stack;\n    responseData.error.request = {\n      method: req.method,\n      url: req.originalUrl\n    };\n  }\n\n  // ÂèëÈÄÅÈîôËØØÂìçÂ∫î\n  res.status(error.statusCode).json(responseData);\n};\n\n/**\n * ÂºÇÊ≠•ÈîôËØØÂåÖË£ÖÂô®\n * Áî®‰∫éÂåÖË£ÖÂºÇÊ≠•Ë∑ØÁî±Â§ÑÁêÜÂô®ÔºåËá™Âä®ÊçïËé∑ÂºÇÊ≠•ÈîôËØØ\n * @param {Function} fn - ÂºÇÊ≠•ÂáΩÊï∞\n * @returns {Function} ÂåÖË£ÖÂêéÁöÑÂáΩÊï∞\n */\nconst asyncHandler = (fn) => (req, res, next) => {\n  Promise.resolve(fn(req, res, next)).catch(next);\n};\n\n/**\n * 404 ÈîôËØØÂ§ÑÁêÜ‰∏≠Èó¥‰ª∂\n * @param {Object} req - ËØ∑Ê±ÇÂØπË±°\n * @param {Object} res - ÂìçÂ∫îÂØπË±°\n * @param {Function} next - ‰∏ã‰∏Ä‰∏™‰∏≠Èó¥‰ª∂\n */\nconst notFoundHandler = (req, res, next) => {\n  const error = new AppError(`Ë∑ØÁî± ${req.originalUrl} Êú™ÊâæÂà∞`, 404, 'ROUTE_NOT_FOUND', {\n    method: req.method,\n    url: req.originalUrl\n  });\n  next(error);\n};\n\n/**\n * Êï∞ÊçÆÂ∫ìÈîôËØØËΩ¨Êç¢Âô®\n * Â∞ÜÊï∞ÊçÆÂ∫ìÁâπÂÆöÈîôËØØËΩ¨Êç¢‰∏∫Â∫îÁî®Á®ãÂ∫èÈîôËØØ\n * @param {Error} err - Êï∞ÊçÆÂ∫ìÈîôËØØ\n * @returns {AppError} Â∫îÁî®Á®ãÂ∫èÈîôËØØ\n */\nconst handleDatabaseError = (err) => {\n  // SQLite ÈîôËØØÂ§ÑÁêÜ\n  if (err.code === 'SQLITE_CONSTRAINT_UNIQUE') {\n    return new AppError('Êï∞ÊçÆÂ∑≤Â≠òÂú®', 409, 'DUPLICATE_ENTRY', {\n      field: err.message.match(/\\.(\\w+)/)?.[1]\n    });\n  }\n\n  if (err.code === 'SQLITE_CONSTRAINT_FOREIGNKEY') {\n    return new AppError('ÂÖ≥ËÅîÊï∞ÊçÆ‰∏çÂ≠òÂú®', 400, 'FOREIGN_KEY_CONSTRAINT');\n  }\n\n  if (err.code === 'SQLITE_CONSTRAINT_NOTNULL') {\n    return new AppError('ÂøÖÂ°´Â≠óÊÆµ‰∏çËÉΩ‰∏∫Á©∫', 400, 'REQUIRED_FIELD_MISSING', {\n      field: err.message.match(/\\.(\\w+)/)?.[1]\n    });\n  }\n\n  // ÈÄöÁî®Êï∞ÊçÆÂ∫ìÈîôËØØ\n  return new AppError('Êï∞ÊçÆÂ∫ìÊìç‰ΩúÂ§±Ë¥•', 500, 'DATABASE_ERROR', {\n    originalError: err.message\n  });\n};\n\n/**\n * JWT ÈîôËØØËΩ¨Êç¢Âô®\n * @param {Error} err - JWT ÈîôËØØ\n * @returns {AppError} Â∫îÁî®Á®ãÂ∫èÈîôËØØ\n */\nconst handleJWTError = (err) => {\n  if (err.name === 'JsonWebTokenError') {\n    return new AppError('Êó†ÊïàÁöÑËÆøÈóÆ‰ª§Áâå', 401, 'INVALID_TOKEN');\n  }\n\n  if (err.name === 'TokenExpiredError') {\n    return new AppError('ËÆøÈóÆ‰ª§ÁâåÂ∑≤ËøáÊúü', 401, 'TOKEN_EXPIRED');\n  }\n\n  return new AppError('‰ª§ÁâåÈ™åËØÅÂ§±Ë¥•', 401, 'TOKEN_VERIFICATION_FAILED');\n};\n\nexport { errorHandler, asyncHandler, notFoundHandler, handleDatabaseError, handleJWTError };\n\nexport default errorHandler;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/shared/middleware/performance.js","messages":[{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":22,"column":61,"nodeType":"Literal","messageId":"noMagic","endLine":22,"endColumn":65},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.8.","line":23,"column":65,"nodeType":"Literal","messageId":"noMagic","endLine":23,"endColumn":68},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.8.","line":24,"column":59,"nodeType":"Literal","messageId":"noMagic","endLine":24,"endColumn":62},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5000.","line":69,"column":8,"nodeType":"Literal","messageId":"noMagic","endLine":69,"endColumn":12},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":120,"column":53,"nodeType":"Literal","messageId":"noMagic","endLine":120,"endColumn":56},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1024.","line":121,"column":46,"nodeType":"Literal","messageId":"noMagic","endLine":121,"endColumn":50},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1024.","line":121,"column":53,"nodeType":"Literal","messageId":"noMagic","endLine":121,"endColumn":57},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1024.","line":121,"column":60,"nodeType":"Literal","messageId":"noMagic","endLine":121,"endColumn":64},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1024.","line":122,"column":48,"nodeType":"Literal","messageId":"noMagic","endLine":122,"endColumn":52},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1024.","line":122,"column":55,"nodeType":"Literal","messageId":"noMagic","endLine":122,"endColumn":59},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1024.","line":122,"column":62,"nodeType":"Literal","messageId":"noMagic","endLine":122,"endColumn":66},{"ruleId":"prefer-destructuring","severity":2,"message":"Use array destructuring.","line":127,"column":11,"nodeType":"VariableDeclarator","messageId":"preferDestructuring","endLine":127,"endColumn":52},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":131,"column":31,"nodeType":"Literal","messageId":"noMagic","endLine":131,"endColumn":34},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 200.","line":166,"column":27,"nodeType":"Literal","messageId":"noMagic","endLine":166,"endColumn":30},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":166,"column":51,"nodeType":"Literal","messageId":"noMagic","endLine":166,"endColumn":54},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":168,"column":34,"nodeType":"Literal","messageId":"noMagic","endLine":168,"endColumn":37},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":192,"column":27,"nodeType":"Literal","messageId":"noMagic","endLine":192,"endColumn":30},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.95.","line":212,"column":36,"nodeType":"Literal","messageId":"noMagic","endLine":212,"endColumn":40},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.99.","line":213,"column":36,"nodeType":"Literal","messageId":"noMagic","endLine":213,"endColumn":40},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.9.","line":323,"column":33,"nodeType":"Literal","messageId":"noMagic","endLine":323,"endColumn":36},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.9.","line":324,"column":57,"nodeType":"Literal","messageId":"noMagic","endLine":324,"endColumn":60},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 2000.","line":325,"column":32,"nodeType":"Literal","messageId":"noMagic","endLine":325,"endColumn":36},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 200.","line":328,"column":34,"nodeType":"Literal","messageId":"noMagic","endLine":328,"endColumn":37},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 503.","line":328,"column":40,"nodeType":"Literal","messageId":"noMagic","endLine":328,"endColumn":43},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":335,"column":46,"nodeType":"Literal","messageId":"noMagic","endLine":335,"endColumn":49},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1024.","line":336,"column":39,"nodeType":"Literal","messageId":"noMagic","endLine":336,"endColumn":43},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1024.","line":336,"column":46,"nodeType":"Literal","messageId":"noMagic","endLine":336,"endColumn":50},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1024.","line":336,"column":53,"nodeType":"Literal","messageId":"noMagic","endLine":336,"endColumn":57},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1024.","line":337,"column":41,"nodeType":"Literal","messageId":"noMagic","endLine":337,"endColumn":45},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1024.","line":337,"column":48,"nodeType":"Literal","messageId":"noMagic","endLine":337,"endColumn":52},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1024.","line":337,"column":55,"nodeType":"Literal","messageId":"noMagic","endLine":337,"endColumn":59},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":341,"column":72,"nodeType":"Literal","messageId":"noMagic","endLine":341,"endColumn":75}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":31,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import os from 'os';\nimport process from 'process';\nimport { performance } from 'perf_hooks';\nimport logger from '../utils/logger.js';\n\n/**\n * ÊÄßËÉΩÁõëÊéß‰∏≠Èó¥‰ª∂\n */\nexport class PerformanceMonitor {\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 44 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 44 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 44 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 44 Ë°å)\n\n  constructor(options = {}) {\n    this.options = {\n      enableMetrics: options.enableMetrics !== false,\n      enableLogging: options.enableLogging !== false,\n      slowRequestThreshold: options.slowRequestThreshold || 1000, // 1Áßí\n      memoryWarningThreshold: options.memoryWarningThreshold || 0.8, // 80%\n      cpuWarningThreshold: options.cpuWarningThreshold || 0.8, // 80%\n      ...options\n    };\n\n    this.metrics = {\n      requests: {\n        total: 0,\n        success: 0,\n        error: 0,\n        slow: 0\n      },\n      responseTime: {\n        min: Infinity,\n        max: 0,\n        avg: 0,\n        p95: 0,\n        p99: 0\n      },\n      memory: {\n        used: 0,\n        free: 0,\n        total: 0,\n        percentage: 0\n      },\n      cpu: {\n        usage: 0,\n        loadAverage: [0, 0, 0]\n      },\n      errors: new Map(),\n      endpoints: new Map()\n    };\n\n    this.responseTimes = [];\n    this.maxResponseTimeHistory = 1000; // ‰øùÁïôÊúÄËøë1000‰∏™ÂìçÂ∫îÊó∂Èó¥\n\n    // ÊöÇÊó∂Á¶ÅÁî®Á≥ªÁªüÁõëÊéßÔºåÈÅøÂÖçÈ´òËµÑÊ∫ê‰ΩøÁî®ÁéáË≠¶Âëä\n    // this.startSystemMonitoring();\n  }\n\n  /**\n   * ÂêØÂä®Á≥ªÁªüÁõëÊéß\n   */\n  startSystemMonitoring() {\n    setInterval(() => {\n      this.updateSystemMetrics();\n    }, 5000); // ÊØè5ÁßíÊõ¥Êñ∞‰∏ÄÊ¨°\n  }\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 29 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 29 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 29 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 29 Ë°å)\n\n  /**\n   * Êõ¥Êñ∞Á≥ªÁªüÊåáÊ†á\n   */\n  updateSystemMetrics() {\n    // ÂÜÖÂ≠ò‰ΩøÁî®ÊÉÖÂÜµ\n    const memUsage = process.memoryUsage();\n    const totalMem = os.totalmem();\n    const freeMem = os.freemem();\n    const usedMem = totalMem - freeMem;\n\n    this.metrics.memory = {\n      used: usedMem,\n      free: freeMem,\n      total: totalMem,\n      percentage: usedMem / totalMem,\n      heap: {\n        used: memUsage.heapUsed,\n        total: memUsage.heapTotal,\n        external: memUsage.external,\n        rss: memUsage.rss\n      }\n    };\n\n    // CPUË¥üËΩΩ\n    this.metrics.cpu = {\n      loadAverage: os.loadavg(),\n      cpuCount: os.cpus().length\n    };\n\n    // Ê£ÄÊü•Ë≠¶ÂëäÈòàÂÄº\n    this.checkThresholds();\n  }\n\n  /**\n   * Ê£ÄÊü•ÊÄßËÉΩÈòàÂÄº\n   */\n  checkThresholds() {\n    // ÂÜÖÂ≠òË≠¶Âëä\n    if (this.metrics.memory.percentage > this.options.memoryWarningThreshold) {\n      logger.warn('ÂÜÖÂ≠ò‰ΩøÁî®ÁéáËøáÈ´ò', {\n        usage: `${(this.metrics.memory.percentage * 100).toFixed(2)}%`,\n        used: `${(this.metrics.memory.used / 1024 / 1024 / 1024).toFixed(2)}GB`,\n        total: `${(this.metrics.memory.total / 1024 / 1024 / 1024).toFixed(2)}GB`\n      });\n    }\n\n    // CPUË¥üËΩΩË≠¶Âëä\n    const avgLoad = this.metrics.cpu.loadAverage[0];\n    const cpuUsage = avgLoad / this.metrics.cpu.cpuCount;\n    if (cpuUsage > this.options.cpuWarningThreshold) {\n      logger.warn('CPUË¥üËΩΩËøáÈ´ò', {\n        usage: `${(cpuUsage * 100).toFixed(2)}%`,\n        loadAverage: this.metrics.cpu.loadAverage,\n        cpuCount: this.metrics.cpu.cpuCount\n      });\n    }\n  }\n\n  /**\n   * ËÆ∞ÂΩïËØ∑Ê±ÇÊåáÊ†á\n   */\n  recordRequest(req, res, responseTime) {\n    this.metrics.requests.total++;\n\n    // ËÆ∞ÂΩïÂìçÂ∫îÊó∂Èó¥\n    this.responseTimes.push(responseTime);\n    if (this.responseTimes.length > this.maxResponseTimeHistory) {\n      this.responseTimes.shift();\n    }\n\n    // Êõ¥Êñ∞ÂìçÂ∫îÊó∂Èó¥ÁªüËÆ°\n    this.updateResponseTimeStats();\n\n    // ËÆ∞ÂΩïÊÖ¢ËØ∑Ê±Ç\n    if (responseTime > this.options.slowRequestThreshold) {\n      this.metrics.requests.slow++;\n      logger.warn('ÊÖ¢ËØ∑Ê±ÇÊ£ÄÊµã', {\n        method: req.method,\n        path: req.path,\n        responseTime: `${responseTime}ms`,\n        userAgent: req.get('User-Agent'),\n        ip: req.ip\n      });\n    }\n\n    // ËÆ∞ÂΩïÁä∂ÊÄÅÁ†Å\n    if (res.statusCode >= 200 && res.statusCode < 400) {\n      this.metrics.requests.success++;\n    } else if (res.statusCode >= 400) {\n      this.metrics.requests.error++;\n    }\n\n    // ËÆ∞ÂΩïÁ´ØÁÇπÁªüËÆ°\n    const endpoint = `${req.method} ${req.route?.path || req.path}`;\n    if (!this.metrics.endpoints.has(endpoint)) {\n      this.metrics.endpoints.set(endpoint, {\n        count: 0,\n        totalTime: 0,\n        avgTime: 0,\n        minTime: Infinity,\n        maxTime: 0,\n        errors: 0\n      });\n    }\n\n    const endpointStats = this.metrics.endpoints.get(endpoint);\n    endpointStats.count++;\n    endpointStats.totalTime += responseTime;\n    endpointStats.avgTime = endpointStats.totalTime / endpointStats.count;\n    endpointStats.minTime = Math.min(endpointStats.minTime, responseTime);\n    endpointStats.maxTime = Math.max(endpointStats.maxTime, responseTime);\n\n    if (res.statusCode >= 400) {\n      endpointStats.errors++;\n    }\n  }\n\n  /**\n   * Êõ¥Êñ∞ÂìçÂ∫îÊó∂Èó¥ÁªüËÆ°\n   */\n  updateResponseTimeStats() {\n    if (this.responseTimes.length === 0) {\n      return;\n    }\n\n    const sorted = [...this.responseTimes].sort((a, b) => a - b);\n    const len = sorted.length;\n\n    this.metrics.responseTime = {\n      min: sorted[0],\n      max: sorted[len - 1],\n      avg: sorted.reduce((sum, time) => sum + time, 0) / len,\n      p95: sorted[Math.floor(len * 0.95)],\n      p99: sorted[Math.floor(len * 0.99)]\n    };\n  }\n\n  /**\n   * ËÆ∞ÂΩïÈîôËØØ\n   */\n  recordError(error, req) {\n    const errorKey = `${error.name}: ${error.message}`;\n    const errorCount = this.metrics.errors.get(errorKey) || 0;\n    this.metrics.errors.set(errorKey, errorCount + 1);\n\n    logger.error('ËØ∑Ê±ÇÂ§ÑÁêÜÈîôËØØ', {\n      error: error.message,\n      stack: error.stack,\n      method: req.method,\n      path: req.path,\n      ip: req.ip,\n      userAgent: req.get('User-Agent')\n    });\n  }\n\n  /**\n   * Ëé∑ÂèñÊÄßËÉΩÊåáÊ†á\n   */\n  getMetrics() {\n    return {\n      ...this.metrics,\n      uptime: process.uptime(),\n      timestamp: new Date().toISOString(),\n      nodeVersion: process.version,\n      platform: os.platform(),\n      arch: os.arch()\n    };\n  }\n\n  /**\n   * ÈáçÁΩÆÊåáÊ†á\n   */\n  resetMetrics() {\n    this.metrics.requests = {\n      total: 0,\n      success: 0,\n      error: 0,\n      slow: 0\n    };\n    this.metrics.errors.clear();\n    this.metrics.endpoints.clear();\n    this.responseTimes = [];\n  }\n\n  /**\n   * ÊÄßËÉΩÁõëÊéß‰∏≠Èó¥‰ª∂\n   */\n  middleware() {\n    return (req, res, next) => {\n      const startTime = performance.now();\n\n      // ËÆ∞ÂΩïËØ∑Ê±ÇÂºÄÂßãÊó∂Èó¥\n      req.startTime = startTime;\n\n      // ÁõëÂê¨ÂìçÂ∫îÁªìÊùü‰∫ã‰ª∂\n      res.on('finish', () => {\n        const endTime = performance.now();\n        const responseTime = Math.round(endTime - startTime);\n\n        if (this.options.enableMetrics) {\n          this.recordRequest(req, res, responseTime);\n        }\n\n        if (this.options.enableLogging) {\n          logger.info('ËØ∑Ê±ÇÂÆåÊàê', {\n            method: req.method,\n            path: req.path,\n            statusCode: res.statusCode,\n            responseTime: `${responseTime}ms`,\n            ip: req.ip,\n            userAgent: req.get('User-Agent')\n          });\n        }\n      });\n\n      // ÁõëÂê¨ÈîôËØØ‰∫ã‰ª∂\n      res.on('error', (error) => {\n        if (this.options.enableMetrics) {\n          this.recordError(error, req);\n        }\n      });\n\n      next();\n    };\n\n    // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 33 Ë°å)\n\n    // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 36 Ë°å)\n\n    // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 39 Ë°å)\n\n    // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 42 Ë°å)\n  }\n}\n\n/**\n * ÂÅ•Â∫∑Ê£ÄÊü•‰∏≠Èó¥‰ª∂\n */\nexport const healthCheck = (monitor) => (req, res) => {\n  const metrics = monitor.getMetrics();\n\n  // Âà§Êñ≠Á≥ªÁªüÂÅ•Â∫∑Áä∂ÊÄÅ\n  const isHealthy =\n    metrics.memory.percentage < 0.9 && // ÂÜÖÂ≠ò‰ΩøÁî®ÁéáÂ∞è‰∫é90%\n    metrics.cpu.loadAverage[0] / metrics.cpu.cpuCount < 0.9 && // CPUË¥üËΩΩÂ∞è‰∫é90%\n    metrics.responseTime.avg < 2000; // Âπ≥ÂùáÂìçÂ∫îÊó∂Èó¥Â∞è‰∫é2Áßí\n\n  const status = isHealthy ? 'healthy' : 'unhealthy';\n  const statusCode = isHealthy ? 200 : 503;\n\n  res.status(statusCode).json({\n    status,\n    timestamp: new Date().toISOString(),\n    uptime: process.uptime(),\n    memory: {\n      usage: `${(metrics.memory.percentage * 100).toFixed(2)}%`,\n      used: `${(metrics.memory.used / 1024 / 1024 / 1024).toFixed(2)}GB`,\n      total: `${(metrics.memory.total / 1024 / 1024 / 1024).toFixed(2)}GB`\n    },\n    cpu: {\n      loadAverage: metrics.cpu.loadAverage,\n      usage: `${((metrics.cpu.loadAverage[0] / metrics.cpu.cpuCount) * 100).toFixed(2)}%`\n    },\n    requests: metrics.requests,\n    responseTime: {\n      avg: `${metrics.responseTime.avg.toFixed(2)}ms`,\n\n      // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 21 Ë°å)\n\n      // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 21 Ë°å)\n\n      // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 21 Ë°å)\n\n      // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 21 Ë°å)\n\n      p95: `${metrics.responseTime.p95}ms`,\n      p99: `${metrics.responseTime.p99}ms`\n    }\n  });\n};\n\n/**\n * ÊÄßËÉΩÊåáÊ†áAPI‰∏≠Èó¥‰ª∂\n */\nexport const metricsEndpoint = (monitor) => (req, res) => {\n  const metrics = monitor.getMetrics();\n\n  // ËΩ¨Êç¢Á´ØÁÇπÁªüËÆ°‰∏∫Êï∞ÁªÑÊ†ºÂºè\n  const endpoints = Array.from(metrics.endpoints.entries()).map(([path, stats]) => ({\n    path,\n    ...stats\n  }));\n\n  // ËΩ¨Êç¢ÈîôËØØÁªüËÆ°‰∏∫Êï∞ÁªÑÊ†ºÂºè\n  const errors = Array.from(metrics.errors.entries()).map(([error, count]) => ({\n    error,\n    count\n  }));\n\n  res.json({\n    ...metrics,\n    endpoints,\n    errors\n  });\n};\n\n// ÂàõÂª∫ÈªòËÆ§ÊÄßËÉΩÁõëÊéßÂÆû‰æã\nexport const defaultPerformanceMonitor = new PerformanceMonitor();\n\n// ÂØºÂá∫‰∏≠Èó¥‰ª∂ÂáΩÊï∞\nexport const performanceMiddleware = defaultPerformanceMonitor.middleware();\nexport const healthCheckEndpoint = healthCheck(defaultPerformanceMonitor);\nexport const metricsApiEndpoint = metricsEndpoint(defaultPerformanceMonitor);\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/shared/middleware/security.js","messages":[{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 7.","line":100,"column":35,"nodeType":"Literal","messageId":"noMagic","endLine":100,"endColumn":36},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 16.","line":129,"column":81,"nodeType":"Literal","messageId":"noMagic","endLine":129,"endColumn":83},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 15.","line":230,"column":15,"nodeType":"Literal","messageId":"noMagic","endLine":230,"endColumn":17},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":230,"column":20,"nodeType":"Literal","messageId":"noMagic","endLine":230,"endColumn":22},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":230,"column":25,"nodeType":"Literal","messageId":"noMagic","endLine":230,"endColumn":29},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1024.","line":264,"column":46,"nodeType":"Literal","messageId":"noMagic","endLine":264,"endColumn":50},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1024.","line":264,"column":53,"nodeType":"Literal","messageId":"noMagic","endLine":264,"endColumn":57},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":265,"column":52,"nodeType":"Literal","messageId":"noMagic","endLine":265,"endColumn":56},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 8192.","line":266,"column":50,"nodeType":"Literal","messageId":"noMagic","endLine":266,"endColumn":54},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 36.","line":330,"column":76,"nodeType":"Literal","messageId":"noMagic","endLine":330,"endColumn":78},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 9.","line":330,"column":90,"nodeType":"Literal","messageId":"noMagic","endLine":330,"endColumn":91}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":11,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import jwt from 'jsonwebtoken';\nimport rateLimit from 'express-rate-limit';\nimport {\n  AuthenticationError,\n  AuthorizationError,\n  ValidationError\n} from '../utils/AppError.js';\nimport logger from '../utils/logger.js';\n\n/**\n * JWTËÆ§ËØÅ‰∏≠Èó¥‰ª∂Â¢ûÂº∫Áâà\n * ÊîØÊåÅÂ§öÁßçtokenÊù•Ê∫ê„ÄÅtokenÂà∑Êñ∞„ÄÅÈªëÂêçÂçïÊ£ÄÊü•\n */\nexport class JWTAuthenticator {\n  constructor(options = {}) {\n    this.secret = options.secret || process.env.JWT_SECRET || 'default-secret';\n    this.refreshSecret =\n      options.refreshSecret || process.env.JWT_REFRESH_SECRET || 'default-refresh-secret';\n    this.tokenExpiry = options.tokenExpiry || '15m';\n    this.refreshTokenExpiry = options.refreshTokenExpiry || '7d';\n    this.blacklistedTokens = new Set(); // ÁÆÄÂçïÁöÑÂÜÖÂ≠òÈªëÂêçÂçïÔºåÁîü‰∫ßÁéØÂ¢ÉÂ∫î‰ΩøÁî®Redis\n    this.algorithm = options.algorithm || 'HS256';\n  }\n\n  /**\n   * ÁîüÊàêËÆøÈóÆ‰ª§Áâå\n   */\n  generateAccessToken(payload) {\n    return jwt.sign(payload, this.secret, {\n      expiresIn: this.tokenExpiry,\n      algorithm: this.algorithm,\n      issuer: 'zero-carbon-system',\n      audience: 'zero-carbon-users'\n    });\n  }\n\n  /**\n   * ÁîüÊàêÂà∑Êñ∞‰ª§Áâå\n   */\n  generateRefreshToken(payload) {\n    return jwt.sign(payload, this.refreshSecret, {\n      expiresIn: this.refreshTokenExpiry,\n      algorithm: this.algorithm,\n      issuer: 'zero-carbon-system',\n      audience: 'zero-carbon-users'\n    });\n  }\n\n  /**\n   * È™åËØÅËÆøÈóÆ‰ª§Áâå\n   */\n  verifyAccessToken(token) {\n    try {\n      if (this.blacklistedTokens.has(token)) {\n        throw new AuthenticationError('‰ª§ÁâåÂ∑≤Ë¢´Êí§ÈîÄ');\n      }\n\n      return jwt.verify(token, this.secret, {\n        algorithms: [this.algorithm],\n        issuer: 'zero-carbon-system',\n        audience: 'zero-carbon-users'\n      });\n    } catch (error) {\n      if (error instanceof jwt.TokenExpiredError) {\n        throw new AuthenticationError('‰ª§ÁâåÂ∑≤ËøáÊúü');\n      } else if (error instanceof jwt.JsonWebTokenError) {\n        throw new AuthenticationError('Êó†ÊïàÁöÑ‰ª§Áâå');\n      }\n      throw error;\n    }\n  }\n\n  /**\n   * È™åËØÅÂà∑Êñ∞‰ª§Áâå\n   */\n  verifyRefreshToken(token) {\n    try {\n      return jwt.verify(token, this.refreshSecret, {\n        algorithms: [this.algorithm],\n        issuer: 'zero-carbon-system',\n        audience: 'zero-carbon-users'\n      });\n    } catch (error) {\n      if (error instanceof jwt.TokenExpiredError) {\n        throw new AuthenticationError('Âà∑Êñ∞‰ª§ÁâåÂ∑≤ËøáÊúü');\n      } else if (error instanceof jwt.JsonWebTokenError) {\n        throw new AuthenticationError('Êó†ÊïàÁöÑÂà∑Êñ∞‰ª§Áâå');\n      }\n      throw error;\n    }\n  }\n\n  /**\n   * ‰ªéËØ∑Ê±Ç‰∏≠ÊèêÂèñ‰ª§Áâå\n   */\n  extractToken(req) {\n    // 1. ‰ªéAuthorizationÂ§¥ÊèêÂèñ\n    const authHeader = req.headers.authorization;\n    if (authHeader && authHeader.startsWith('Bearer ')) {\n      return authHeader.substring(7);\n    }\n\n    // 2. ‰ªéCookieÊèêÂèñ\n    if (req.cookies && req.cookies.accessToken) {\n      return req.cookies.accessToken;\n    }\n\n    // 3. ‰ªéÊü•ËØ¢ÂèÇÊï∞ÊèêÂèñÔºà‰∏çÊé®ËçêÔºå‰ªÖÁî®‰∫éÁâπÊÆäÊÉÖÂÜµÔºâ\n    if (req.query.token) {\n      return req.query.token;\n    }\n\n    return null;\n  }\n\n  /**\n   * Êí§ÈîÄ‰ª§ÁâåÔºàÂä†ÂÖ•ÈªëÂêçÂçïÔºâ\n   */\n  revokeToken(token) {\n    this.blacklistedTokens.add(token);\n    logger.info('‰ª§ÁâåÂ∑≤Êí§ÈîÄ', { tokenHash: this.hashToken(token) });\n  }\n\n  /**\n   * ‰ª§ÁâåÂìàÂ∏åÔºàÁî®‰∫éÊó•ÂøóËÆ∞ÂΩïÔºåÈÅøÂÖçÊ≥ÑÈú≤ÂÆåÊï¥‰ª§ÁâåÔºâ\n   */\n  hashToken(token) {\n    const crypto = require('crypto');\n    return crypto.createHash('sha256').update(token).digest('hex').substring(0, 16);\n  }\n\n  /**\n   * ËÆ§ËØÅ‰∏≠Èó¥‰ª∂\n   */\n  authenticate(_options = {}) {\n    return (req, res, next) => {\n      try {\n        const token = this.extractToken(req);\n\n        if (!token) {\n          throw new AuthenticationError('Áº∫Â∞ëËÆ§ËØÅ‰ª§Áâå');\n        }\n\n        const decoded = this.verifyAccessToken(token);\n        req.user = decoded;\n        req.token = token;\n\n        // ËÆ∞ÂΩïËÆ§ËØÅÊàêÂäüÊó•Âøó\n        logger.info('Áî®Êà∑ËÆ§ËØÅÊàêÂäü', {\n          userId: decoded.id,\n          username: decoded.username,\n          role: decoded.role,\n          ip: req.ip,\n          userAgent: req.get('User-Agent')\n        });\n\n        next();\n      } catch (error) {\n        logger.warn('ËÆ§ËØÅÂ§±Ë¥•', {\n          error: error.message,\n          ip: req.ip,\n          userAgent: req.get('User-Agent'),\n          path: req.path\n        });\n        next(error);\n      }\n    };\n  }\n\n  /**\n   * ËßíËâ≤ÊéàÊùÉ‰∏≠Èó¥‰ª∂\n   */\n  authorize(requiredRoles = []) {\n    return (req, res, next) => {\n      try {\n        if (!req.user) {\n          throw new AuthenticationError('Áî®Êà∑Êú™ËÆ§ËØÅ');\n        }\n\n        const userRole = req.user.role;\n        const hasPermission = Array.isArray(requiredRoles)\n          ? requiredRoles.includes(userRole)\n          : requiredRoles === userRole;\n\n        if (!hasPermission) {\n          throw new AuthorizationError('ÊùÉÈôê‰∏çË∂≥', {\n            requiredRoles,\n            userRole\n          });\n        }\n\n        next();\n      } catch (error) {\n        logger.warn('ÊéàÊùÉÂ§±Ë¥•', {\n          error: error.message,\n          userId: req.user?.id,\n          userRole: req.user?.role,\n          requiredRoles,\n          path: req.path\n        });\n        next(error);\n      }\n    };\n  }\n}\n\n/**\n * ÂÆâÂÖ®Â§¥‰∏≠Èó¥‰ª∂\n */\nexport const securityHeaders = () => (req, res, next) => {\n  // ËÆæÁΩÆÂÆâÂÖ®ÂìçÂ∫îÂ§¥\n  res.setHeader('X-Content-Type-Options', 'nosniff');\n  res.setHeader('X-Frame-Options', 'DENY');\n  res.setHeader('X-XSS-Protection', '1; mode=block');\n  res.setHeader('Referrer-Policy', 'strict-origin-when-cross-origin');\n  res.setHeader('Permissions-Policy', 'geolocation=(), microphone=(), camera=()');\n\n  // ÁßªÈô§ÂèØËÉΩÊ≥ÑÈú≤ÊúçÂä°Âô®‰ø°ÊÅØÁöÑÂ§¥\n  res.removeHeader('X-Powered-By');\n  res.removeHeader('Server');\n\n  next();\n};\n\n/**\n * APIÈÄüÁéáÈôêÂà∂‰∏≠Èó¥‰ª∂\n */\nexport const createRateLimiter = (options = {}) => {\n  const defaultOptions = {\n    windowMs: 15 * 60 * 1000, // 15ÂàÜÈíü\n    max: 100, // ÊØè‰∏™IPÊúÄÂ§ö100‰∏™ËØ∑Ê±Ç\n    message: {\n      error: {\n        code: 'RATE_LIMIT_EXCEEDED',\n        message: 'ËØ∑Ê±ÇËøá‰∫éÈ¢ëÁπÅÔºåËØ∑Á®çÂêéÂÜçËØï'\n      }\n    },\n    standardHeaders: true,\n    legacyHeaders: false,\n    skip: (req) =>\n      // Ë∑≥ËøáÂÅ•Â∫∑Ê£ÄÊü•ÂíåÈùôÊÄÅËµÑÊ∫ê\n      req.path === '/health' || req.path.startsWith('/static/'),\n    keyGenerator: (req) =>\n      // ÂØπËÆ§ËØÅÁî®Êà∑‰ΩøÁî®Áî®Êà∑IDÔºåÂØπÂåøÂêçÁî®Êà∑‰ΩøÁî®IP\n      req.user?.id || req.ip,\n    onLimitReached: (req, _res, _options) => {\n      logger.warn('ÈÄüÁéáÈôêÂà∂Ëß¶Âèë', {\n        ip: req.ip,\n        userId: req.user?.id,\n        path: req.path,\n        method: req.method,\n        userAgent: req.get('User-Agent')\n      });\n    }\n  };\n\n  return rateLimit({ ...defaultOptions, ...options });\n};\n\n/**\n * ËæìÂÖ•Â§ßÂ∞èÈôêÂà∂‰∏≠Èó¥‰ª∂\n */\nexport const inputSizeLimit = (options = {}) => {\n  const maxBodySize = options.maxBodySize || 1024 * 1024; // 1MB\n  const maxQueryLength = options.maxQueryLength || 1000;\n  const maxHeaderSize = options.maxHeaderSize || 8192;\n\n  return (req, res, next) => {\n    try {\n      // Ê£ÄÊü•ËØ∑Ê±Ç‰ΩìÂ§ßÂ∞è\n      const contentLength = parseInt(req.get('Content-Length') || '0');\n      if (contentLength > maxBodySize) {\n        throw new ValidationError('ËØ∑Ê±Ç‰ΩìËøáÂ§ß', {\n          maxSize: maxBodySize,\n          actualSize: contentLength\n        });\n      }\n\n      // Ê£ÄÊü•Êü•ËØ¢Â≠óÁ¨¶‰∏≤ÈïøÂ∫¶\n      const queryString = req.url.split('?')[1] || '';\n      if (queryString.length > maxQueryLength) {\n        throw new ValidationError('Êü•ËØ¢ÂèÇÊï∞ËøáÈïø', {\n          maxLength: maxQueryLength,\n          actualLength: queryString.length\n        });\n      }\n\n      // Ê£ÄÊü•Â§¥ÈÉ®Â§ßÂ∞è\n      const headerSize = JSON.stringify(req.headers).length;\n      if (headerSize > maxHeaderSize) {\n        throw new ValidationError('ËØ∑Ê±ÇÂ§¥ËøáÂ§ß', {\n          maxSize: maxHeaderSize,\n          actualSize: headerSize\n        });\n      }\n\n      next();\n    } catch (error) {\n      next(error);\n    }\n  };\n};\n\n/**\n * IPÁôΩÂêçÂçï‰∏≠Èó¥‰ª∂\n */\nexport const ipWhitelist =\n  (allowedIPs = []) =>\n    (req, res, next) => {\n      const clientIP = req.ip || req.connection.remoteAddress;\n\n      if (allowedIPs.length > 0 && !allowedIPs.includes(clientIP)) {\n        logger.warn('IPËÆøÈóÆË¢´ÊãíÁªù', {\n          ip: clientIP,\n          path: req.path,\n          userAgent: req.get('User-Agent')\n        });\n\n        throw new AuthorizationError('ËÆøÈóÆË¢´ÊãíÁªù');\n      }\n\n      next();\n    };\n\n/**\n * ËØ∑Ê±ÇID‰∏≠Èó¥‰ª∂ÔºàÁî®‰∫éËØ∑Ê±ÇËøΩË∏™Ôºâ\n */\nexport const requestId = () => (req, res, next) => {\n  const requestId =\n    req.get('X-Request-ID') || `req_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n\n  req.requestId = requestId;\n  res.setHeader('X-Request-ID', requestId);\n\n  next();\n};\n\n// ÂØºÂá∫ÈªòËÆ§ÁöÑJWTËÆ§ËØÅÂô®ÂÆû‰æã\nexport const defaultJWTAuth = new JWTAuthenticator({\n  secret: process.env.JWT_SECRET,\n  refreshSecret: process.env.JWT_REFRESH_SECRET,\n  tokenExpiry: process.env.JWT_EXPIRY || '15m',\n  refreshTokenExpiry: process.env.JWT_REFRESH_EXPIRY || '7d'\n});\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/shared/middleware/validation.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/shared/utils/AppError.js","messages":[{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":6,"column":37,"nodeType":"Literal","messageId":"noMagic","endLine":6,"endColumn":40},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":40,"column":20,"nodeType":"Literal","messageId":"noMagic","endLine":40,"endColumn":23},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 401.","line":46,"column":20,"nodeType":"Literal","messageId":"noMagic","endLine":46,"endColumn":23},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 403.","line":52,"column":20,"nodeType":"Literal","messageId":"noMagic","endLine":52,"endColumn":23},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 404.","line":58,"column":20,"nodeType":"Literal","messageId":"noMagic","endLine":58,"endColumn":23},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 409.","line":64,"column":20,"nodeType":"Literal","messageId":"noMagic","endLine":64,"endColumn":23},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":70,"column":20,"nodeType":"Literal","messageId":"noMagic","endLine":70,"endColumn":23},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 502.","line":76,"column":20,"nodeType":"Literal","messageId":"noMagic","endLine":76,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Â∫îÁî®Á®ãÂ∫èÈîôËØØÁ±ª\n * Êèê‰æõÁªü‰∏ÄÁöÑÈîôËØØÂ§ÑÁêÜÊú∫Âà∂\n */\nclass AppError extends Error {\n  constructor(message, statusCode = 500, errorCode = 'INTERNAL_SERVER_ERROR', details = {}) {\n    super(message);\n    this.name = 'AppError';\n    this.statusCode = statusCode;\n    this.errorCode = errorCode;\n    this.details = details;\n    this.isOperational = true;\n    this.timestamp = new Date().toISOString();\n\n    // ÊçïËé∑Â†ÜÊ†àË∑üË∏™\n    Error.captureStackTrace(this, this.constructor);\n  }\n\n  /**\n   * ËΩ¨Êç¢‰∏∫JSONÊ†ºÂºè\n   */\n  toJSON() {\n    return {\n      name: this.name,\n      message: this.message,\n      statusCode: this.statusCode,\n      errorCode: this.errorCode,\n      details: this.details,\n      timestamp: this.timestamp,\n      stack: process.env.NODE_ENV === 'development' ? this.stack : undefined\n    };\n  }\n}\n\n/**\n * È¢ÑÂÆö‰πâÁöÑÈîôËØØÁ±ªÂûã\n */\nclass ValidationError extends AppError {\n  constructor(message, details = {}) {\n    super(message, 400, 'VALIDATION_ERROR', details);\n  }\n}\n\nclass AuthenticationError extends AppError {\n  constructor(message = 'ËÆ§ËØÅÂ§±Ë¥•') {\n    super(message, 401, 'AUTHENTICATION_ERROR');\n  }\n}\n\nclass AuthorizationError extends AppError {\n  constructor(message = 'ÊùÉÈôê‰∏çË∂≥') {\n    super(message, 403, 'AUTHORIZATION_ERROR');\n  }\n}\n\nclass NotFoundError extends AppError {\n  constructor(message = 'ËµÑÊ∫êÊú™ÊâæÂà∞') {\n    super(message, 404, 'NOT_FOUND');\n  }\n}\n\nclass ConflictError extends AppError {\n  constructor(message = 'ËµÑÊ∫êÂÜ≤Á™Å') {\n    super(message, 409, 'CONFLICT');\n  }\n}\n\nclass DatabaseError extends AppError {\n  constructor(message = 'Êï∞ÊçÆÂ∫ìÊìç‰ΩúÂ§±Ë¥•', details = {}) {\n    super(message, 500, 'DATABASE_ERROR', details);\n  }\n}\n\nclass ExternalServiceError extends AppError {\n  constructor(message = 'Â§ñÈÉ®ÊúçÂä°ÈîôËØØ', details = {}) {\n    super(message, 502, 'EXTERNAL_SERVICE_ERROR', details);\n  }\n}\n\nexport {\n  AppError,\n  ValidationError,\n  AuthenticationError,\n  AuthorizationError,\n  NotFoundError,\n  ConflictError,\n  DatabaseError,\n  ExternalServiceError\n};\n\nexport default AppError;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/shared/utils/LogAggregator.js","messages":[{"ruleId":"no-duplicate-imports","severity":2,"message":"'fs' import is duplicated.","line":3,"column":1,"nodeType":"ImportDeclaration","messageId":"import","endLine":3,"endColumn":40},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":24,"column":43,"nodeType":"Literal","messageId":"noMagic","endLine":24,"endColumn":46},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1024.","line":24,"column":49,"nodeType":"Literal","messageId":"noMagic","endLine":24,"endColumn":53},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1024.","line":24,"column":56,"nodeType":"Literal","messageId":"noMagic","endLine":24,"endColumn":60},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":25,"column":37,"nodeType":"Literal","messageId":"noMagic","endLine":25,"endColumn":39},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 24.","line":26,"column":49,"nodeType":"Literal","messageId":"noMagic","endLine":26,"endColumn":51},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":26,"column":54,"nodeType":"Literal","messageId":"noMagic","endLine":26,"endColumn":56},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":26,"column":59,"nodeType":"Literal","messageId":"noMagic","endLine":26,"endColumn":61},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":26,"column":64,"nodeType":"Literal","messageId":"noMagic","endLine":26,"endColumn":68},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":45,"column":45,"nodeType":"Literal","messageId":"noMagic","endLine":45,"endColumn":49},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":68,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":68,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1401,1428],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":182,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":182,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[3730,3758],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":196,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":196,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[3976,4000],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":234,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":234,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[4913,4970],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.05.","line":247,"column":28,"nodeType":"Literal","messageId":"noMagic","endLine":247,"endColumn":32},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5.","line":250,"column":17,"nodeType":"Literal","messageId":"noMagic","endLine":250,"endColumn":18},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":250,"column":21,"nodeType":"Literal","messageId":"noMagic","endLine":250,"endColumn":23},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":250,"column":26,"nodeType":"Literal","messageId":"noMagic","endLine":250,"endColumn":30},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5000.","line":255,"column":91,"nodeType":"Literal","messageId":"noMagic","endLine":255,"endColumn":95},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":257,"column":17,"nodeType":"Literal","messageId":"noMagic","endLine":257,"endColumn":19},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":257,"column":22,"nodeType":"Literal","messageId":"noMagic","endLine":257,"endColumn":26},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 5.","line":265,"column":67,"nodeType":"Literal","messageId":"noMagic","endLine":265,"endColumn":68},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":265,"column":71,"nodeType":"Literal","messageId":"noMagic","endLine":265,"endColumn":73},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":265,"column":76,"nodeType":"Literal","messageId":"noMagic","endLine":265,"endColumn":80},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":266,"column":38,"nodeType":"Literal","messageId":"noMagic","endLine":266,"endColumn":40},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":269,"column":17,"nodeType":"Literal","messageId":"noMagic","endLine":269,"endColumn":19},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":269,"column":22,"nodeType":"Literal","messageId":"noMagic","endLine":269,"endColumn":24},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":269,"column":27,"nodeType":"Literal","messageId":"noMagic","endLine":269,"endColumn":31},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":302,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":302,"endColumn":24,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[6555,6598],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":333,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":333,"endColumn":17,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[7128,7170],"text":""},"desc":"Remove the console.warn()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":353,"column":8,"nodeType":"Literal","messageId":"noMagic","endLine":353,"endColumn":10},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":353,"column":13,"nodeType":"Literal","messageId":"noMagic","endLine":353,"endColumn":17},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":381,"column":39,"nodeType":"Literal","messageId":"noMagic","endLine":381,"endColumn":41},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 60.","line":381,"column":44,"nodeType":"Literal","messageId":"noMagic","endLine":381,"endColumn":46},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1000.","line":381,"column":49,"nodeType":"Literal","messageId":"noMagic","endLine":381,"endColumn":53},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":413,"column":17,"nodeType":"Literal","messageId":"noMagic","endLine":413,"endColumn":19},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":452,"column":17,"nodeType":"Literal","messageId":"noMagic","endLine":452,"endColumn":19},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 10.","line":487,"column":19,"nodeType":"Literal","messageId":"noMagic","endLine":487,"endColumn":21},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 1.2.","line":525,"column":42,"nodeType":"Literal","messageId":"noMagic","endLine":525,"endColumn":45},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 0.8.","line":527,"column":49,"nodeType":"Literal","messageId":"noMagic","endLine":527,"endColumn":52},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":548,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":548,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[12534,12568],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":559,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":559,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[12775,12809],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 100.","line":567,"column":67,"nodeType":"Literal","messageId":"noMagic","endLine":567,"endColumn":70},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":664,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":664,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[15108,15137],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":683,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":683,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[15504,15530],"text":""},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":44,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import fs from 'fs';\nimport path from 'path';\nimport { createWriteStream } from 'fs';\nimport EventEmitter from 'events';\n\n/**\n * Êó•ÂøóËÅöÂêàÂô®\n * Êèê‰æõÊó•ÂøóÊî∂ÈõÜ„ÄÅÂàÜÊûê„ÄÅÂ≠òÂÇ®ÂíåÊü•ËØ¢ÂäüËÉΩ\n */\nclass LogAggregator extends EventEmitter {\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 30 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 30 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 30 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 30 Ë°å)\n\n  constructor(options = {}) {\n    super();\n\n    this.options = {\n      logDir: options.logDir || './logs',\n      maxFileSize: options.maxFileSize || 100 * 1024 * 1024, // 100MB\n      maxFiles: options.maxFiles || 10,\n      rotateInterval: options.rotateInterval || 24 * 60 * 60 * 1000, // 24Â∞èÊó∂\n      enableAnalysis: options.enableAnalysis !== false,\n      enableAlerts: options.enableAlerts !== false,\n      ...options\n    };\n\n    this.logStreams = new Map();\n    this.logStats = {\n      totalLogs: 0,\n      errorCount: 0,\n      warningCount: 0,\n      infoCount: 0,\n      debugCount: 0,\n      lastLogTime: null,\n      startTime: new Date()\n    };\n\n    this.alertRules = new Map();\n    this.logBuffer = [];\n    this.bufferSize = options.bufferSize || 1000;\n\n    this.init();\n  }\n\n  /**\n   * ÂàùÂßãÂåñÊó•ÂøóËÅöÂêàÂô®\n   */\n  init() {\n    // Á°Æ‰øùÊó•ÂøóÁõÆÂΩïÂ≠òÂú®\n    this.ensureLogDir();\n\n    // ËÆæÁΩÆÊó•ÂøóËΩÆËΩ¨\n    this.setupLogRotation();\n\n    // ËÆæÁΩÆÈªòËÆ§ÂëäË≠¶ËßÑÂàô\n    this.setupDefaultAlertRules();\n\n    // ÂêØÂä®ÂàÜÊûê‰ªªÂä°\n    if (this.options.enableAnalysis) {\n      this.startAnalysisTask();\n    }\n\n    console.log('üìä Êó•ÂøóËÅöÂêàÂô®Â∑≤ÂêØÂä®');\n  }\n\n  /**\n   * Á°Æ‰øùÊó•ÂøóÁõÆÂΩïÂ≠òÂú®\n   */\n  ensureLogDir() {\n    if (!fs.existsSync(this.options.logDir)) {\n      fs.mkdirSync(this.options.logDir, { recursive: true });\n    }\n  }\n\n  /**\n   * ËÆ∞ÂΩïÊó•Âøó\n   */\n  log(level, message, metadata = {}) {\n    const logEntry = {\n      timestamp: new Date().toISOString(),\n      level: level.toUpperCase(),\n      message,\n      metadata,\n      requestId: metadata.requestId,\n      userId: metadata.userId,\n      ip: metadata.ip,\n      userAgent: metadata.userAgent,\n      duration: metadata.duration,\n      statusCode: metadata.statusCode,\n      error: metadata.error\n    };\n\n    // Êõ¥Êñ∞ÁªüËÆ°‰ø°ÊÅØ\n    this.updateStats(logEntry);\n\n    // Ê∑ªÂä†Âà∞ÁºìÂÜ≤Âå∫\n    this.logBuffer.push(logEntry);\n\n    // ÂÜôÂÖ•Êó•ÂøóÊñá‰ª∂\n    this.writeToFile(logEntry);\n\n    // Ê£ÄÊü•ÂëäË≠¶ËßÑÂàô\n    if (this.options.enableAlerts) {\n      this.checkAlertRules(logEntry);\n    }\n\n    // Ëß¶Âèë‰∫ã‰ª∂\n    this.emit('log', logEntry);\n\n    // Â¶ÇÊûúÁºìÂÜ≤Âå∫Êª°‰∫ÜÔºåÊ∏ÖÁêÜÊóßÊó•Âøó\n    if (this.logBuffer.length > this.bufferSize) {\n      this.logBuffer = this.logBuffer.slice(-this.bufferSize);\n    }\n  }\n\n  /**\n   * Êõ¥Êñ∞ÁªüËÆ°‰ø°ÊÅØ\n   */\n  updateStats(logEntry) {\n    this.logStats.totalLogs++;\n    this.logStats.lastLogTime = logEntry.timestamp;\n\n    switch (logEntry.level) {\n      case 'ERROR':\n        this.logStats.errorCount++;\n        break;\n      case 'WARN':\n        this.logStats.warningCount++;\n        break;\n      case 'INFO':\n        this.logStats.infoCount++;\n        break;\n      case 'DEBUG':\n        this.logStats.debugCount++;\n        break;\n    }\n  }\n\n  /**\n   * ÂÜôÂÖ•Êó•ÂøóÊñá‰ª∂\n   */\n  writeToFile(logEntry) {\n    const fileName = this.getLogFileName(logEntry.level);\n    const filePath = path.join(this.options.logDir, fileName);\n\n    if (!this.logStreams.has(fileName)) {\n      this.logStreams.set(fileName, createWriteStream(filePath, { flags: 'a' }));\n    }\n\n    const stream = this.logStreams.get(fileName);\n    const logLine = `${JSON.stringify(logEntry)}\\n`;\n\n    stream.write(logLine);\n  }\n\n  /**\n   * Ëé∑ÂèñÊó•ÂøóÊñá‰ª∂Âêç\n   */\n  getLogFileName(level) {\n    const [date] = new Date().toISOString().split('T');\n    return `${level.toLowerCase()}-${date}.log`;\n  }\n\n  /**\n   * ËÆæÁΩÆÊó•ÂøóËΩÆËΩ¨\n   */\n  setupLogRotation() {\n    this.rotationTimer = setInterval(() => {\n      this.rotateLogFiles();\n    }, this.options.rotateInterval);\n  }\n\n  /**\n   * ËΩÆËΩ¨Êó•ÂøóÊñá‰ª∂\n   */\n  rotateLogFiles() {\n    console.log('üîÑ ÂºÄÂßãÊó•ÂøóËΩÆËΩ¨...');\n\n    // ÂÖ≥Èó≠ÂΩìÂâçÊµÅ\n    for (const [_fileName, stream] of this.logStreams) {\n      stream.end();\n    }\n    this.logStreams.clear();\n\n    // ÂéãÁº©ÊóßÊó•ÂøóÊñá‰ª∂\n    this.compressOldLogs();\n\n    // Ê∏ÖÁêÜËøáÊúüÊó•Âøó\n    this.cleanupOldLogs();\n\n    console.log('‚úÖ Êó•ÂøóËΩÆËΩ¨ÂÆåÊàê');\n  }\n\n  /**\n   * ÂéãÁº©ÊóßÊó•ÂøóÊñá‰ª∂\n   */\n  compressOldLogs() {\n    // ËøôÈáåÂèØ‰ª•Ê∑ªÂä†Êó•ÂøóÂéãÁº©ÈÄªËæë\n    // ‰æãÂ¶Ç‰ΩøÁî® gzip ÂéãÁº©\n  }\n\n  /**\n   * Ê∏ÖÁêÜËøáÊúüÊó•Âøó\n   */\n  cleanupOldLogs() {\n    const files = fs.readdirSync(this.options.logDir);\n    const logFiles = files.filter((file) => file.endsWith('.log'));\n\n    if (logFiles.length > this.options.maxFiles) {\n      // Êåâ‰øÆÊîπÊó∂Èó¥ÊéíÂ∫è\n      const sortedFiles = logFiles\n        .map((file) => ({\n          name: file,\n          path: path.join(this.options.logDir, file),\n          mtime: fs.statSync(path.join(this.options.logDir, file)).mtime\n        }))\n        .sort((a, b) => a.mtime - b.mtime);\n\n      // Âà†Èô§ÊúÄÊóßÁöÑÊñá‰ª∂\n      const filesToDelete = sortedFiles.slice(0, sortedFiles.length - this.options.maxFiles);\n\n      const deletedFiles = [];\n      for (const file of filesToDelete) {\n        fs.unlinkSync(file.path);\n        deletedFiles.push(file.name);\n      }\n\n      if (deletedFiles.length > 0) {\n        console.log(`üóëÔ∏è  Âà†Èô§ËøáÊúüÊó•ÂøóÊñá‰ª∂: ${deletedFiles.join(', ')}`);\n      }\n    }\n  }\n\n  /**\n   * ËÆæÁΩÆÈªòËÆ§ÂëäË≠¶ËßÑÂàô\n   */\n  setupDefaultAlertRules() {\n    // ÈîôËØØÁéáÂëäË≠¶\n    this.addAlertRule('high_error_rate', {\n      condition: (stats) => {\n        const errorRate = stats.errorCount / stats.totalLogs;\n        return errorRate > 0.05; // ÈîôËØØÁéáË∂ÖËøá5%\n      },\n      message: 'ÈîôËØØÁéáËøáÈ´ò',\n      cooldown: 5 * 60 * 1000 // 5ÂàÜÈíüÂÜ∑Âç¥Êúü\n    });\n\n    // ÂìçÂ∫îÊó∂Èó¥ÂëäË≠¶\n    this.addAlertRule('slow_response', {\n      condition: (logEntry) => logEntry.metadata.duration && logEntry.metadata.duration > 5000, // ÂìçÂ∫îÊó∂Èó¥Ë∂ÖËøá5Áßí\n      message: 'ÂìçÂ∫îÊó∂Èó¥ËøáÈïø',\n      cooldown: 60 * 1000 // 1ÂàÜÈíüÂÜ∑Âç¥Êúü\n    });\n\n    // È¢ëÁπÅÈîôËØØÂëäË≠¶\n    this.addAlertRule('frequent_errors', {\n      condition: () => {\n        const recentErrors = this.logBuffer\n          .filter((log) => log.level === 'ERROR')\n          .filter((log) => new Date() - new Date(log.timestamp) < 5 * 60 * 1000); // 5ÂàÜÈíüÂÜÖ\n        return recentErrors.length > 10; // 5ÂàÜÈíüÂÜÖË∂ÖËøá10‰∏™ÈîôËØØ\n      },\n      message: 'È¢ëÁπÅÂá∫Áé∞ÈîôËØØ',\n      cooldown: 10 * 60 * 1000 // 10ÂàÜÈíüÂÜ∑Âç¥Êúü\n    });\n  }\n\n  /**\n   * Ê∑ªÂä†ÂëäË≠¶ËßÑÂàô\n   */\n  addAlertRule(name, rule) {\n    this.alertRules.set(name, {\n      ...rule,\n      lastTriggered: 0\n    });\n  }\n\n  /**\n   * Ê£ÄÊü•ÂëäË≠¶ËßÑÂàô\n   */\n  checkAlertRules(logEntry) {\n    const now = Date.now();\n\n    for (const [name, rule] of this.alertRules) {\n      // Ê£ÄÊü•ÂÜ∑Âç¥Êúü\n      if (now - rule.lastTriggered < rule.cooldown) {\n        continue;\n      }\n\n      // Ê£ÄÊü•Êù°‰ª∂\n      let shouldAlert = false;\n\n      if (typeof rule.condition === 'function') {\n        try {\n          shouldAlert = rule.condition(logEntry, this.logStats, this.logBuffer);\n        } catch (error) {\n          console.error(`ÂëäË≠¶ËßÑÂàô ${name} ÊâßË°åÂ§±Ë¥•:`, error);\n        }\n      }\n\n      if (shouldAlert) {\n        this.triggerAlert(name, rule, logEntry);\n        rule.lastTriggered = now;\n      }\n    }\n  }\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 21 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 21 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 21 Ë°å)\n\n  // TODO: ËÄÉËôëÂ∞ÜÊ≠§ÂáΩÊï∞ÊãÜÂàÜ‰∏∫Êõ¥Â∞èÁöÑÂáΩÊï∞ (ÂΩìÂâç 21 Ë°å)\n\n  /**\n   * Ëß¶ÂèëÂëäË≠¶\n   */\n  triggerAlert(ruleName, rule, logEntry) {\n    const alert = {\n      ruleName,\n      message: rule.message,\n      timestamp: new Date().toISOString(),\n      logEntry,\n      stats: { ...this.logStats }\n    };\n\n    console.warn(`üö® ÂëäË≠¶Ëß¶Âèë: ${alert.message}`);\n\n    // Ëß¶ÂèëÂëäË≠¶‰∫ã‰ª∂\n    this.emit('alert', alert);\n\n    // ËÆ∞ÂΩïÂëäË≠¶Êó•Âøó\n    this.log('warn', `ÂëäË≠¶Ëß¶Âèë: ${alert.message}`, {\n      alert: true,\n      ruleName,\n      originalLog: logEntry\n    });\n  }\n\n  /**\n   * ÂêØÂä®ÂàÜÊûê‰ªªÂä°\n   */\n  startAnalysisTask() {\n    // ÊØèÂàÜÈíüÊâßË°å‰∏ÄÊ¨°ÂàÜÊûê\n    this.analysisTimer = setInterval(() => {\n      this.performAnalysis();\n    }, 60 * 1000);\n  }\n\n  /**\n   * ÊâßË°åÊó•ÂøóÂàÜÊûê\n   */\n  performAnalysis() {\n    const analysis = {\n      timestamp: new Date().toISOString(),\n      stats: { ...this.logStats },\n      trends: this.analyzeTrends(),\n      topErrors: this.getTopErrors(),\n      slowEndpoints: this.getSlowEndpoints(),\n      userActivity: this.analyzeUserActivity()\n    };\n\n    // Ëß¶ÂèëÂàÜÊûê‰∫ã‰ª∂\n    this.emit('analysis', analysis);\n\n    // ‰øùÂ≠òÂàÜÊûêÁªìÊûú\n    this.saveAnalysis(analysis);\n  }\n\n  /**\n   * ÂàÜÊûêË∂ãÂäø\n   */\n  analyzeTrends() {\n    const now = new Date();\n    const oneHourAgo = new Date(now - 60 * 60 * 1000);\n\n    const recentLogs = this.logBuffer.filter((log) => new Date(log.timestamp) > oneHourAgo);\n\n    const hourlyStats = {\n      total: recentLogs.length,\n      errors: recentLogs.filter((log) => log.level === 'ERROR').length,\n      warnings: recentLogs.filter((log) => log.level === 'WARN').length,\n      avgResponseTime: this.calculateAverageResponseTime(recentLogs)\n    };\n\n    return {\n      hourly: hourlyStats,\n      errorRate: hourlyStats.errors / hourlyStats.total || 0,\n      trend: this.calculateTrend(recentLogs)\n    };\n  }\n\n  /**\n   * Ëé∑ÂèñÊúÄÂ∏∏ËßÅÈîôËØØ\n   */\n  getTopErrors() {\n    const errorLogs = this.logBuffer.filter((log) => log.level === 'ERROR');\n    const errorCounts = new Map();\n\n    for (const log of errorLogs) {\n      const errorKey = log.message || log.metadata.error?.message || 'Unknown Error';\n      errorCounts.set(errorKey, (errorCounts.get(errorKey) || 0) + 1);\n    }\n\n    return Array.from(errorCounts.entries())\n      .sort((a, b) => b[1] - a[1])\n      .slice(0, 10)\n      .map(([error, count]) => ({ error, count }));\n  }\n\n  /**\n   * Ëé∑ÂèñÊÖ¢Á´ØÁÇπ\n   */\n  getSlowEndpoints() {\n    const logsWithDuration = this.logBuffer.filter(\n      (log) => log.metadata.duration && log.metadata.url\n    );\n\n    const endpointStats = new Map();\n\n    for (const log of logsWithDuration) {\n      const endpoint = `${log.metadata.method} ${log.metadata.url}`;\n\n      if (!endpointStats.has(endpoint)) {\n        endpointStats.set(endpoint, {\n          count: 0,\n          totalDuration: 0,\n          maxDuration: 0\n        });\n      }\n\n      const stats = endpointStats.get(endpoint);\n      stats.count++;\n      stats.totalDuration += log.metadata.duration;\n      stats.maxDuration = Math.max(stats.maxDuration, log.metadata.duration);\n    }\n\n    return Array.from(endpointStats.entries())\n      .map(([endpoint, stats]) => ({\n        endpoint,\n        avgDuration: stats.totalDuration / stats.count,\n        maxDuration: stats.maxDuration,\n        count: stats.count\n      }))\n      .sort((a, b) => b.avgDuration - a.avgDuration)\n      .slice(0, 10);\n  }\n\n  /**\n   * ÂàÜÊûêÁî®Êà∑Ê¥ªÂä®\n   */\n  analyzeUserActivity() {\n    const userLogs = this.logBuffer.filter((log) => log.userId);\n    const userStats = new Map();\n\n    for (const log of userLogs) {\n      if (!userStats.has(log.userId)) {\n        userStats.set(log.userId, {\n          requests: 0,\n          errors: 0,\n          lastActivity: log.timestamp\n        });\n      }\n\n      const stats = userStats.get(log.userId);\n      stats.requests++;\n\n      if (log.level === 'ERROR') {\n        stats.errors++;\n      }\n\n      if (new Date(log.timestamp) > new Date(stats.lastActivity)) {\n        stats.lastActivity = log.timestamp;\n      }\n    }\n\n    return {\n      activeUsers: userStats.size,\n      topUsers: Array.from(userStats.entries())\n        .sort((a, b) => b[1].requests - a[1].requests)\n        .slice(0, 10)\n        .map(([userId, stats]) => ({ userId, ...stats }))\n    };\n  }\n\n  /**\n   * ËÆ°ÁÆóÂπ≥ÂùáÂìçÂ∫îÊó∂Èó¥\n   */\n  calculateAverageResponseTime(logs) {\n    const logsWithDuration = logs.filter((log) => log.metadata.duration);\n\n    if (logsWithDuration.length === 0) {\n      return 0;\n    }\n\n    const totalDuration = logsWithDuration.reduce((sum, log) => sum + log.metadata.duration, 0);\n\n    return totalDuration / logsWithDuration.length;\n  }\n\n  /**\n   * ËÆ°ÁÆóË∂ãÂäø\n   */\n  calculateTrend(logs) {\n    if (logs.length < 2) {\n      return 'stable';\n    }\n\n    const midpoint = Math.floor(logs.length / 2);\n    const firstHalf = logs.slice(0, midpoint);\n    const secondHalf = logs.slice(midpoint);\n\n    const firstHalfErrors = firstHalf.filter((log) => log.level === 'ERROR').length;\n    const secondHalfErrors = secondHalf.filter((log) => log.level === 'ERROR').length;\n\n    const firstHalfRate = firstHalfErrors / firstHalf.length;\n    const secondHalfRate = secondHalfErrors / secondHalf.length;\n\n    if (secondHalfRate > firstHalfRate * 1.2) {\n      return 'increasing';\n    } else if (secondHalfRate < firstHalfRate * 0.8) {\n      return 'decreasing';\n    }\n    return 'stable';\n  }\n\n  /**\n   * ‰øùÂ≠òÂàÜÊûêÁªìÊûú\n   */\n  async saveAnalysis(analysis) {\n    const fileName = `analysis-${new Date().toISOString().split('T')[0]}.json`;\n    const filePath = path.join(this.options.logDir, fileName);\n\n    let existingData = [];\n\n    try {\n      await fs.promises.access(filePath);\n      try {\n        const content = await fs.promises.readFile(filePath, 'utf8');\n        existingData = JSON.parse(content);\n      } catch (error) {\n        console.error('ËØªÂèñÂàÜÊûêÊñá‰ª∂Â§±Ë¥•:', error);\n      }\n    } catch {\n      // Êñá‰ª∂‰∏çÂ≠òÂú®Ôºå‰ΩøÁî®Á©∫Êï∞ÁªÑ\n    }\n\n    existingData.push(analysis);\n\n    try {\n      await fs.promises.writeFile(filePath, JSON.stringify(existingData, null, 2));\n    } catch (error) {\n      console.error('‰øùÂ≠òÂàÜÊûêÁªìÊûúÂ§±Ë¥•:', error);\n    }\n  }\n\n  /**\n   * Êü•ËØ¢Êó•Âøó\n   */\n  async queryLogs(options = {}) {\n    const { level, startTime, endTime, userId, requestId, limit = 100, offset = 0 } = options;\n\n    let results = [...this.logBuffer];\n\n    // Â∫îÁî®ËøáÊª§Êù°‰ª∂\n    if (level) {\n      results = results.filter((log) => log.level === level.toUpperCase());\n    }\n\n    if (startTime) {\n      results = results.filter((log) => new Date(log.timestamp) >= new Date(startTime));\n    }\n\n    if (endTime) {\n      results = results.filter((log) => new Date(log.timestamp) <= new Date(endTime));\n    }\n\n    if (userId) {\n      results = results.filter((log) => log.userId === userId);\n    }\n\n    if (requestId) {\n      results = results.filter((log) => log.requestId === requestId);\n    }\n\n    // ÊéíÂ∫èÔºàÊúÄÊñ∞ÁöÑÂú®ÂâçÔºâ\n    results.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));\n\n    // ÂàÜÈ°µ\n    const total = results.length;\n    results = results.slice(offset, offset + limit);\n\n    return {\n      logs: results,\n      total,\n      offset,\n      limit,\n      hasMore: offset + limit < total\n    };\n  }\n\n  /**\n   * Ëé∑ÂèñÁªüËÆ°‰ø°ÊÅØ\n   */\n  getStats() {\n    return {\n      ...this.logStats,\n      uptime: Date.now() - this.logStats.startTime.getTime(),\n      bufferSize: this.logBuffer.length,\n      activeStreams: this.logStreams.size\n    };\n  }\n\n  /**\n   * ÂàõÂª∫Êó•Âøó‰∏≠Èó¥‰ª∂\n   */\n  createMiddleware() {\n    return (req, res, next) => {\n      const startTime = Date.now();\n\n      // ËÆ∞ÂΩïËØ∑Ê±ÇÂºÄÂßã\n      this.log('info', `${req.method} ${req.url}`, {\n        requestId: req.requestId,\n        userId: req.user?.id,\n        ip: req.ip,\n        userAgent: req.get('User-Agent'),\n        method: req.method,\n        url: req.url,\n        query: req.query,\n        body: req.method !== 'GET' ? req.body : undefined\n      });\n\n      // ÁõëÂê¨ÂìçÂ∫îÁªìÊùü\n      res.on('finish', () => {\n        const duration = Date.now() - startTime;\n\n        this.log('info', `${req.method} ${req.url} - ${res.statusCode}`, {\n          requestId: req.requestId,\n          userId: req.user?.id,\n          ip: req.ip,\n          userAgent: req.get('User-Agent'),\n          method: req.method,\n          url: req.url,\n          statusCode: res.statusCode,\n          duration,\n          responseSize: res.get('Content-Length')\n        });\n      });\n\n      next();\n    };\n  }\n\n  /**\n   * ÂÖ≥Èó≠Êó•ÂøóËÅöÂêàÂô®\n   */\n  close() {\n    console.log('üîÑ ÂÖ≥Èó≠Êó•ÂøóËÅöÂêàÂô®...');\n\n    // Ê∏ÖÁêÜÂÆöÊó∂Âô®\n    if (this.rotationTimer) {\n      clearInterval(this.rotationTimer);\n      this.rotationTimer = null;\n    }\n    if (this.analysisTimer) {\n      clearInterval(this.analysisTimer);\n      this.analysisTimer = null;\n    }\n\n    // ÂÖ≥Èó≠ÊâÄÊúâÊµÅ\n    for (const [_fileName, stream] of this.logStreams) {\n      stream.end();\n    }\n\n    this.logStreams.clear();\n\n    console.log('‚úÖ Êó•ÂøóËÅöÂêàÂô®Â∑≤ÂÖ≥Èó≠');\n  }\n}\n\n// ÂàõÂª∫ÈªòËÆ§ÂÆû‰æã\nconst defaultLogAggregator = new LogAggregator();\n\n// ‰æøÊç∑ÊñπÊ≥ï\nexport const logInfo = (message, metadata) => defaultLogAggregator.log('info', message, metadata);\nexport const logWarn = (message, metadata) => defaultLogAggregator.log('warn', message, metadata);\nexport const logError = (message, metadata) => defaultLogAggregator.log('error', message, metadata);\nexport const logDebug = (message, metadata) => defaultLogAggregator.log('debug', message, metadata);\n\nexport { LogAggregator };\nexport default defaultLogAggregator;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/shared/utils/apiResponse.js","messages":[{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 36.","line":357,"column":54,"nodeType":"Literal","messageId":"noMagic","endLine":357,"endColumn":56},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 9.","line":357,"column":68,"nodeType":"Literal","messageId":"noMagic","endLine":357,"endColumn":69},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 500.","line":373,"column":21,"nodeType":"Literal","messageId":"noMagic","endLine":373,"endColumn":24},{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 400.","line":375,"column":28,"nodeType":"Literal","messageId":"noMagic","endLine":375,"endColumn":31}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * APIÂìçÂ∫îÊ†áÂáÜÂåñÂ∑•ÂÖ∑\n * Á°Æ‰øùÊâÄÊúâAPIÂìçÂ∫îÊ†ºÂºèÁöÑ‰∏ÄËá¥ÊÄß\n */\n\nimport { logger } from './logger.js';\n\n// ÂìçÂ∫îÁä∂ÊÄÅÁ†ÅÂ∏∏Èáè\nexport const HTTP_STATUS = {\n  // ÊàêÂäüÂìçÂ∫î\n  OK: 200,\n  CREATED: 201,\n  ACCEPTED: 202,\n  NO_CONTENT: 204,\n\n  // ÈáçÂÆöÂêë\n  MOVED_PERMANENTLY: 301,\n  FOUND: 302,\n  NOT_MODIFIED: 304,\n\n  // ÂÆ¢Êà∑Á´ØÈîôËØØ\n  BAD_REQUEST: 400,\n  UNAUTHORIZED: 401,\n  FORBIDDEN: 403,\n  NOT_FOUND: 404,\n  METHOD_NOT_ALLOWED: 405,\n  CONFLICT: 409,\n  UNPROCESSABLE_ENTITY: 422,\n  TOO_MANY_REQUESTS: 429,\n\n  // ÊúçÂä°Âô®ÈîôËØØ\n  INTERNAL_SERVER_ERROR: 500,\n  NOT_IMPLEMENTED: 501,\n  BAD_GATEWAY: 502,\n  SERVICE_UNAVAILABLE: 503,\n  GATEWAY_TIMEOUT: 504\n};\n\n// ‰∏öÂä°ÈîôËØØÁ†ÅÂ∏∏Èáè\nexport const BUSINESS_CODES = {\n  SUCCESS: 'SUCCESS',\n\n  // ËÆ§ËØÅÁõ∏ÂÖ≥\n  AUTH_INVALID_CREDENTIALS: 'AUTH_INVALID_CREDENTIALS',\n  AUTH_TOKEN_EXPIRED: 'AUTH_TOKEN_EXPIRED',\n  AUTH_TOKEN_INVALID: 'AUTH_TOKEN_INVALID',\n  AUTH_INSUFFICIENT_PERMISSIONS: 'AUTH_INSUFFICIENT_PERMISSIONS',\n\n  // È™åËØÅÁõ∏ÂÖ≥\n  VALIDATION_FAILED: 'VALIDATION_FAILED',\n  VALIDATION_REQUIRED_FIELD: 'VALIDATION_REQUIRED_FIELD',\n  VALIDATION_INVALID_FORMAT: 'VALIDATION_INVALID_FORMAT',\n  VALIDATION_OUT_OF_RANGE: 'VALIDATION_OUT_OF_RANGE',\n\n  // ËµÑÊ∫êÁõ∏ÂÖ≥\n  RESOURCE_NOT_FOUND: 'RESOURCE_NOT_FOUND',\n  RESOURCE_ALREADY_EXISTS: 'RESOURCE_ALREADY_EXISTS',\n  RESOURCE_CONFLICT: 'RESOURCE_CONFLICT',\n  RESOURCE_LOCKED: 'RESOURCE_LOCKED',\n\n  // ‰∏öÂä°ÈÄªËæëÁõ∏ÂÖ≥\n  BUSINESS_RULE_VIOLATION: 'BUSINESS_RULE_VIOLATION',\n  OPERATION_NOT_ALLOWED: 'OPERATION_NOT_ALLOWED',\n  QUOTA_EXCEEDED: 'QUOTA_EXCEEDED',\n\n  // Á≥ªÁªüÁõ∏ÂÖ≥\n  SYSTEM_ERROR: 'SYSTEM_ERROR',\n  DATABASE_ERROR: 'DATABASE_ERROR',\n  EXTERNAL_SERVICE_ERROR: 'EXTERNAL_SERVICE_ERROR',\n  RATE_LIMIT_EXCEEDED: 'RATE_LIMIT_EXCEEDED'\n};\n\n// ÈîôËØØÊ∂àÊÅØÊò†Â∞Ñ\nconst ERROR_MESSAGES = {\n  [BUSINESS_CODES.AUTH_INVALID_CREDENTIALS]: 'Áî®Êà∑ÂêçÊàñÂØÜÁ†ÅÈîôËØØ',\n  [BUSINESS_CODES.AUTH_TOKEN_EXPIRED]: 'ËÆøÈóÆ‰ª§ÁâåÂ∑≤ËøáÊúü',\n  [BUSINESS_CODES.AUTH_TOKEN_INVALID]: 'Êó†ÊïàÁöÑËÆøÈóÆ‰ª§Áâå',\n  [BUSINESS_CODES.AUTH_INSUFFICIENT_PERMISSIONS]: 'ÊùÉÈôê‰∏çË∂≥',\n\n  [BUSINESS_CODES.VALIDATION_FAILED]: 'Êï∞ÊçÆÈ™åËØÅÂ§±Ë¥•',\n  [BUSINESS_CODES.VALIDATION_REQUIRED_FIELD]: 'ÂøÖÂ°´Â≠óÊÆµÁº∫Â§±',\n  [BUSINESS_CODES.VALIDATION_INVALID_FORMAT]: 'Êï∞ÊçÆÊ†ºÂºèÊó†Êïà',\n  [BUSINESS_CODES.VALIDATION_OUT_OF_RANGE]: 'Êï∞ÊçÆË∂ÖÂá∫ÂÖÅËÆ∏ËåÉÂõ¥',\n\n  [BUSINESS_CODES.RESOURCE_NOT_FOUND]: 'ËµÑÊ∫êÊú™ÊâæÂà∞',\n  [BUSINESS_CODES.RESOURCE_ALREADY_EXISTS]: 'ËµÑÊ∫êÂ∑≤Â≠òÂú®',\n  [BUSINESS_CODES.RESOURCE_CONFLICT]: 'ËµÑÊ∫êÂÜ≤Á™Å',\n  [BUSINESS_CODES.RESOURCE_LOCKED]: 'ËµÑÊ∫êË¢´ÈîÅÂÆö',\n\n  [BUSINESS_CODES.BUSINESS_RULE_VIOLATION]: 'ËøùÂèç‰∏öÂä°ËßÑÂàô',\n  [BUSINESS_CODES.OPERATION_NOT_ALLOWED]: 'Êìç‰Ωú‰∏çË¢´ÂÖÅËÆ∏',\n  [BUSINESS_CODES.QUOTA_EXCEEDED]: 'ÈÖçÈ¢ùÂ∑≤Ë∂ÖÂá∫',\n\n  [BUSINESS_CODES.SYSTEM_ERROR]: 'Á≥ªÁªüÂÜÖÈÉ®ÈîôËØØ',\n  [BUSINESS_CODES.DATABASE_ERROR]: 'Êï∞ÊçÆÂ∫ìÊìç‰ΩúÂ§±Ë¥•',\n  [BUSINESS_CODES.EXTERNAL_SERVICE_ERROR]: 'Â§ñÈÉ®ÊúçÂä°ÈîôËØØ',\n  [BUSINESS_CODES.RATE_LIMIT_EXCEEDED]: 'ËØ∑Ê±ÇÈ¢ëÁéáË∂ÖÂá∫ÈôêÂà∂'\n};\n\n// Ê†áÂáÜÂìçÂ∫îÊ†ºÂºèÁ±ª\nexport class ApiResponse {\n  constructor() {\n    this.timestamp = new Date().toISOString();\n    this.requestId = null;\n    this.success = true;\n    this.code = BUSINESS_CODES.SUCCESS;\n    this.message = null;\n    this.data = null;\n    this.errors = null;\n    this.meta = null;\n  }\n\n  // ËÆæÁΩÆËØ∑Ê±ÇID\n  setRequestId(requestId) {\n    this.requestId = requestId;\n    return this;\n  }\n\n  // ËÆæÁΩÆÊàêÂäüÂìçÂ∫î\n  setSuccess(data = null, message = null, meta = null) {\n    this.success = true;\n    this.code = BUSINESS_CODES.SUCCESS;\n    this.message = message;\n    this.data = data;\n    this.meta = meta;\n    return this;\n  }\n\n  // ËÆæÁΩÆÈîôËØØÂìçÂ∫î\n  setError(code, message = null, errors = null, data = null) {\n    this.success = false;\n    this.code = code;\n    this.message = message || ERROR_MESSAGES[code] || 'Êú™Áü•ÈîôËØØ';\n    this.errors = errors;\n    this.data = data;\n    return this;\n  }\n\n  // ËÆæÁΩÆÂÖÉÊï∞ÊçÆ\n  setMeta(meta) {\n    this.meta = { ...this.meta, ...meta };\n    return this;\n  }\n\n  // Ê∑ªÂä†ÂàÜÈ°µ‰ø°ÊÅØ\n  setPagination(page, limit, total, totalPages = null) {\n    const pagination = {\n      page: parseInt(page),\n      limit: parseInt(limit),\n      total: parseInt(total),\n      totalPages: totalPages || Math.ceil(total / limit),\n      hasNext: page < Math.ceil(total / limit),\n      hasPrev: page > 1\n    };\n\n    return this.setMeta({ pagination });\n  }\n\n  // ËΩ¨Êç¢‰∏∫JSONÂØπË±°\n  toJSON() {\n    const response = {\n      success: this.success,\n      timestamp: this.timestamp,\n      code: this.code\n    };\n\n    if (this.requestId) {\n      response.requestId = this.requestId;\n    }\n\n    if (this.message) {\n      response.message = this.message;\n    }\n\n    if (this.data !== null) {\n      response.data = this.data;\n    }\n\n    if (this.errors) {\n      response.errors = this.errors;\n    }\n\n    if (this.meta) {\n      response.meta = this.meta;\n    }\n\n    return response;\n  }\n}\n\n// ÂìçÂ∫îÊûÑÂª∫Âô®Á±ª\nexport class ResponseBuilder {\n  // ÊàêÂäüÂìçÂ∫î\n  static success(data = null, message = null, meta = null) {\n    return new ApiResponse().setSuccess(data, message, meta);\n  }\n\n  // ÂàõÂª∫ÊàêÂäüÂìçÂ∫î\n  static created(data = null, message = 'ÂàõÂª∫ÊàêÂäü', meta = null) {\n    return new ApiResponse().setSuccess(data, message, meta);\n  }\n\n  // Êó†ÂÜÖÂÆπÂìçÂ∫î\n  static noContent(message = 'Êìç‰ΩúÊàêÂäü') {\n    return new ApiResponse().setSuccess(null, message);\n  }\n\n  // ÂàÜÈ°µÂìçÂ∫î\n  static paginated(data, page, limit, total, message = null) {\n    return new ApiResponse().setSuccess(data, message).setPagination(page, limit, total);\n  }\n\n  // ÈîôËØØÂìçÂ∫î\n  static error(code, message = null, errors = null, data = null) {\n    return new ApiResponse().setError(code, message, errors, data);\n  }\n\n  // È™åËØÅÈîôËØØ\n  static validationError(errors, message = 'Êï∞ÊçÆÈ™åËØÅÂ§±Ë¥•') {\n    return new ApiResponse().setError(BUSINESS_CODES.VALIDATION_FAILED, message, errors);\n  }\n\n  // ËÆ§ËØÅÈîôËØØ\n  static unauthorized(message = 'ËÆ§ËØÅÂ§±Ë¥•') {\n    return new ApiResponse().setError(BUSINESS_CODES.AUTH_TOKEN_INVALID, message);\n  }\n\n  // ÊùÉÈôêÈîôËØØ\n  static forbidden(message = 'ÊùÉÈôê‰∏çË∂≥') {\n    return new ApiResponse().setError(BUSINESS_CODES.AUTH_INSUFFICIENT_PERMISSIONS, message);\n  }\n\n  // ËµÑÊ∫êÊú™ÊâæÂà∞\n  static notFound(resource = 'ËµÑÊ∫ê', message = null) {\n    return new ApiResponse().setError(\n      BUSINESS_CODES.RESOURCE_NOT_FOUND,\n      message || `${resource}Êú™ÊâæÂà∞`\n    );\n  }\n\n  // ËµÑÊ∫êÂÜ≤Á™Å\n  static conflict(message = 'ËµÑÊ∫êÂÜ≤Á™Å') {\n    return new ApiResponse().setError(BUSINESS_CODES.RESOURCE_CONFLICT, message);\n  }\n\n  // Á≥ªÁªüÈîôËØØ\n  static systemError(message = 'Á≥ªÁªüÂÜÖÈÉ®ÈîôËØØ', errors = null) {\n    return new ApiResponse().setError(BUSINESS_CODES.SYSTEM_ERROR, message, errors);\n  }\n\n  // ÈôêÊµÅÈîôËØØ\n  static rateLimitExceeded(message = 'ËØ∑Ê±ÇÈ¢ëÁéáË∂ÖÂá∫ÈôêÂà∂') {\n    return new ApiResponse().setError(BUSINESS_CODES.RATE_LIMIT_EXCEEDED, message);\n  }\n}\n\n// Express‰∏≠Èó¥‰ª∂ÔºöÊ∑ªÂä†ÂìçÂ∫îÊûÑÂª∫Âô®Âà∞resÂØπË±°\nexport function responseMiddleware(req, res, next) {\n  // Ê∑ªÂä†ËØ∑Ê±ÇID\n  const requestId =\n    req.headers['x-request-id'] || req.headers['x-correlation-id'] || generateRequestId();\n\n  req.requestId = requestId;\n\n  // Ê∑ªÂä†ÂìçÂ∫îÊñπÊ≥ïÂà∞resÂØπË±°\n  res.apiSuccess = (data, message, meta) => {\n    const response = ResponseBuilder.success(data, message, meta).setRequestId(requestId);\n\n    logResponse(req, response, HTTP_STATUS.OK);\n    return res.status(HTTP_STATUS.OK).json(response.toJSON());\n  };\n\n  res.apiCreated = (data, message, meta) => {\n    const response = ResponseBuilder.created(data, message, meta).setRequestId(requestId);\n\n    logResponse(req, response, HTTP_STATUS.CREATED);\n    return res.status(HTTP_STATUS.CREATED).json(response.toJSON());\n  };\n\n  res.apiNoContent = (message) => {\n    const response = ResponseBuilder.noContent(message).setRequestId(requestId);\n\n    logResponse(req, response, HTTP_STATUS.NO_CONTENT);\n    return res.status(HTTP_STATUS.NO_CONTENT).json(response.toJSON());\n  };\n\n  res.apiPaginated = (data, page, limit, total, message) => {\n    const response = ResponseBuilder.paginated(data, page, limit, total, message).setRequestId(\n      requestId\n    );\n\n    logResponse(req, response, HTTP_STATUS.OK);\n    return res.status(HTTP_STATUS.OK).json(response.toJSON());\n  };\n\n  res.apiError = (code, message, errors, statusCode = HTTP_STATUS.BAD_REQUEST) => {\n    const response = ResponseBuilder.error(code, message, errors).setRequestId(requestId);\n\n    logResponse(req, response, statusCode);\n    return res.status(statusCode).json(response.toJSON());\n  };\n\n  res.apiValidationError = (errors, message) => {\n    const response = ResponseBuilder.validationError(errors, message).setRequestId(requestId);\n\n    logResponse(req, response, HTTP_STATUS.UNPROCESSABLE_ENTITY);\n    return res.status(HTTP_STATUS.UNPROCESSABLE_ENTITY).json(response.toJSON());\n  };\n\n  res.apiUnauthorized = (message) => {\n    const response = ResponseBuilder.unauthorized(message).setRequestId(requestId);\n\n    logResponse(req, response, HTTP_STATUS.UNAUTHORIZED);\n    return res.status(HTTP_STATUS.UNAUTHORIZED).json(response.toJSON());\n  };\n\n  res.apiForbidden = (message) => {\n    const response = ResponseBuilder.forbidden(message).setRequestId(requestId);\n\n    logResponse(req, response, HTTP_STATUS.FORBIDDEN);\n    return res.status(HTTP_STATUS.FORBIDDEN).json(response.toJSON());\n  };\n\n  res.apiNotFound = (resource, message) => {\n    const response = ResponseBuilder.notFound(resource, message).setRequestId(requestId);\n\n    logResponse(req, response, HTTP_STATUS.NOT_FOUND);\n    return res.status(HTTP_STATUS.NOT_FOUND).json(response.toJSON());\n  };\n\n  res.apiConflict = (message) => {\n    const response = ResponseBuilder.conflict(message).setRequestId(requestId);\n\n    logResponse(req, response, HTTP_STATUS.CONFLICT);\n    return res.status(HTTP_STATUS.CONFLICT).json(response.toJSON());\n  };\n\n  res.apiSystemError = (message, errors) => {\n    const response = ResponseBuilder.systemError(message, errors).setRequestId(requestId);\n\n    logResponse(req, response, HTTP_STATUS.INTERNAL_SERVER_ERROR);\n    return res.status(HTTP_STATUS.INTERNAL_SERVER_ERROR).json(response.toJSON());\n  };\n\n  res.apiRateLimitExceeded = (message) => {\n    const response = ResponseBuilder.rateLimitExceeded(message).setRequestId(requestId);\n\n    logResponse(req, response, HTTP_STATUS.TOO_MANY_REQUESTS);\n    return res.status(HTTP_STATUS.TOO_MANY_REQUESTS).json(response.toJSON());\n  };\n\n  next();\n}\n\n// ÁîüÊàêËØ∑Ê±ÇID\nfunction generateRequestId() {\n  return `req_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n}\n\n// ËÆ∞ÂΩïÂìçÂ∫îÊó•Âøó\nfunction logResponse(req, response, statusCode) {\n  const logData = {\n    requestId: req.requestId,\n    method: req.method,\n    url: req.originalUrl,\n    statusCode,\n    success: response.success,\n    code: response.code,\n    userId: req.user?.id,\n    ip: req.ip\n  };\n\n  if (statusCode >= 500) {\n    logger.error('APIÂìçÂ∫î', logData);\n  } else if (statusCode >= 400) {\n    logger.warn('APIÂìçÂ∫î', logData);\n  } else {\n    logger.info('APIÂìçÂ∫î', logData);\n  }\n}\n\n// ÂìçÂ∫îÈ™åËØÅÂô®\nexport class ResponseValidator {\n  static validate(response) {\n    const errors = [];\n\n    // Ê£ÄÊü•ÂøÖÈúÄÂ≠óÊÆµ\n    if (typeof response.success !== 'boolean') {\n      errors.push('successÂ≠óÊÆµÂøÖÈ°ªÊòØÂ∏ÉÂ∞îÂÄº');\n    }\n\n    if (!response.timestamp) {\n      errors.push('timestampÂ≠óÊÆµÊòØÂøÖÈúÄÁöÑ');\n    }\n\n    if (!response.code) {\n      errors.push('codeÂ≠óÊÆµÊòØÂøÖÈúÄÁöÑ');\n    }\n\n    // Ê£ÄÊü•Êó∂Èó¥Êà≥Ê†ºÂºè\n    if (response.timestamp && !isValidISO8601(response.timestamp)) {\n      errors.push('timestampÂøÖÈ°ªÊòØÊúâÊïàÁöÑISO8601Ê†ºÂºè');\n    }\n\n    // Ê£ÄÊü•‰∏öÂä°‰ª£Á†Å\n    if (response.code && !Object.values(BUSINESS_CODES).includes(response.code)) {\n      errors.push('Êó†ÊïàÁöÑ‰∏öÂä°‰ª£Á†Å');\n    }\n\n    // Ê£ÄÊü•ÊàêÂäüÂìçÂ∫îÁöÑÊï∞ÊçÆ‰∏ÄËá¥ÊÄß\n    if (response.success && response.code !== BUSINESS_CODES.SUCCESS) {\n      errors.push('ÊàêÂäüÂìçÂ∫îÁöÑcodeÂøÖÈ°ªÊòØSUCCESS');\n    }\n\n    // Ê£ÄÊü•Â§±Ë¥•ÂìçÂ∫îÁöÑÊï∞ÊçÆ‰∏ÄËá¥ÊÄß\n    if (!response.success && response.code === BUSINESS_CODES.SUCCESS) {\n      errors.push('Â§±Ë¥•ÂìçÂ∫îÁöÑcode‰∏çËÉΩÊòØSUCCESS');\n    }\n\n    return {\n      valid: errors.length === 0,\n      errors\n    };\n  }\n}\n\n// Ê£ÄÊü•ISO8601Êó∂Èó¥Ê†ºÂºè\nfunction isValidISO8601(dateString) {\n  const iso8601Regex = /^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d{3})?Z?$/;\n  return iso8601Regex.test(dateString) && !isNaN(Date.parse(dateString));\n}\n\n// ÂìçÂ∫îËΩ¨Êç¢Âô®\nexport class ResponseTransformer {\n  // ËΩ¨Êç¢Êï∞ÊçÆÂ∫ìËÆ∞ÂΩï\n  static transformDatabaseRecord(record, fields = null) {\n    if (!record) {\n      return null;\n    }\n\n    const transformed = { ...record };\n\n    // ÁßªÈô§ÊïèÊÑüÂ≠óÊÆµ\n    delete transformed.password_hash;\n    delete transformed.password;\n    delete transformed.secret;\n    delete transformed.token;\n\n    // ËΩ¨Êç¢Êó∂Èó¥Â≠óÊÆµ\n    ['created_at', 'updated_at', 'deleted_at', 'last_login', 'expires_at'].forEach((field) => {\n      if (transformed[field]) {\n        transformed[field] = new Date(transformed[field]).toISOString();\n      }\n    });\n\n    // Âè™ËøîÂõûÊåáÂÆöÂ≠óÊÆµ\n    if (fields && Array.isArray(fields)) {\n      const filteredRecord = {};\n      fields.forEach((field) => {\n        if (Object.prototype.hasOwnProperty.call(transformed, field)) {\n          filteredRecord[field] = transformed[field];\n        }\n      });\n      return filteredRecord;\n    }\n\n    return transformed;\n  }\n\n  // ËΩ¨Êç¢Êï∞ÊçÆÂ∫ìËÆ∞ÂΩïÂàóË°®\n  static transformDatabaseRecords(records, fields = null) {\n    if (!Array.isArray(records)) {\n      return [];\n    }\n\n    return records.map((record) => this.transformDatabaseRecord(record, fields));\n  }\n\n  // ËΩ¨Êç¢ÈîôËØØÂØπË±°\n  static transformError(error) {\n    if (error.isJoi) {\n      // JoiÈ™åËØÅÈîôËØØ\n      return {\n        type: 'validation',\n        details: error.details.map((detail) => ({\n          field: detail.path.join('.'),\n          message: detail.message,\n          value: detail.context?.value\n        }))\n      };\n    }\n\n    if (error.code && error.code.startsWith('SQLITE_')) {\n      // SQLiteÈîôËØØ\n      return {\n        type: 'database',\n        code: error.code,\n        message: 'Êï∞ÊçÆÂ∫ìÊìç‰ΩúÂ§±Ë¥•'\n      };\n    }\n\n    // ÈÄöÁî®ÈîôËØØ\n    return {\n      type: 'general',\n      message: error.message || 'Êú™Áü•ÈîôËØØ'\n    };\n  }\n}\n\n// ÂØºÂá∫Â∏∏Áî®ÂáΩÊï∞\nexport {\n  HTTP_STATUS as HttpStatus,\n  BUSINESS_CODES as BusinessCodes,\n  ERROR_MESSAGES as ErrorMessages\n};\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/shared/utils/cache.js","messages":[{"ruleId":"no-magic-numbers","severity":1,"message":"No magic number: 200.","line":167,"column":30,"nodeType":"Literal","messageId":"noMagic","endLine":167,"endColumn":33}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * ÁÆÄÂçïÁöÑÂÜÖÂ≠òÁºìÂ≠òÁ≥ªÁªü\n * Áî®‰∫é‰ºòÂåñAPIÂìçÂ∫îÊó∂Èó¥\n */\n\nimport { MATH_CONSTANTS, TIME_INTERVALS } from '../constants/MathConstants.js';\nimport { defaultLogger } from './logger.js';\n\nconst logger = defaultLogger.child('Cache');\n\nclass MemoryCache {\n  constructor() {\n    this.cache = new Map();\n    this.ttlMap = new Map();\n    this.defaultTTL = TIME_INTERVALS.FIVE_MINUTES_MS; // ÈªòËÆ§5ÂàÜÈíüËøáÊúü\n\n    // ÂÆöÊúüÊ∏ÖÁêÜËøáÊúüÁºìÂ≠ò\n    setInterval(() => {\n      this.cleanup();\n    }, MATH_CONSTANTS.SECONDS_PER_MINUTE * MATH_CONSTANTS.MILLISECONDS_PER_SECOND); // ÊØèÂàÜÈíüÊ∏ÖÁêÜ‰∏ÄÊ¨°\n  }\n\n  /**\n   * ËÆæÁΩÆÁºìÂ≠ò\n   * @param {string} key - ÁºìÂ≠òÈîÆ\n   * @param {any} value - ÁºìÂ≠òÂÄº\n   * @param {number} ttl - ËøáÊúüÊó∂Èó¥ÔºàÊØ´ÁßíÔºâÔºåÈªòËÆ§‰ΩøÁî®defaultTTL\n   */\n  set(key, value, ttl = this.defaultTTL) {\n    const expiresAt = Date.now() + ttl;\n    this.cache.set(key, value);\n    this.ttlMap.set(key, expiresAt);\n  }\n\n  /**\n   * Ëé∑ÂèñÁºìÂ≠ò\n   * @param {string} key - ÁºìÂ≠òÈîÆ\n   * @returns {any|null} ÁºìÂ≠òÂÄºÊàñnull\n   */\n  get(key) {\n    const expiresAt = this.ttlMap.get(key);\n\n    // Ê£ÄÊü•ÊòØÂê¶ËøáÊúü\n    if (!expiresAt || Date.now() > expiresAt) {\n      this.delete(key);\n      return null;\n    }\n\n    return this.cache.get(key);\n  }\n\n  /**\n   * Âà†Èô§ÁºìÂ≠ò\n   * @param {string} key - ÁºìÂ≠òÈîÆ\n   */\n  delete(key) {\n    this.cache.delete(key);\n    this.ttlMap.delete(key);\n  }\n\n  /**\n   * Ê∏ÖÁ©∫ÊâÄÊúâÁºìÂ≠ò\n   */\n  clear() {\n    this.cache.clear();\n    this.ttlMap.clear();\n  }\n\n  /**\n   * Ê£ÄÊü•ÁºìÂ≠òÊòØÂê¶Â≠òÂú®‰∏îÊú™ËøáÊúü\n   * @param {string} key - ÁºìÂ≠òÈîÆ\n   * @returns {boolean}\n   */\n  has(key) {\n    const expiresAt = this.ttlMap.get(key);\n    if (!expiresAt || Date.now() > expiresAt) {\n      this.delete(key);\n      return false;\n    }\n    return this.cache.has(key);\n  }\n\n  /**\n   * Ëé∑ÂèñÁºìÂ≠òÁªüËÆ°‰ø°ÊÅØ\n   * @returns {object} ÁªüËÆ°‰ø°ÊÅØ\n   */\n  getStats() {\n    return {\n      size: this.cache.size,\n      keys: Array.from(this.cache.keys())\n    };\n  }\n\n  /**\n   * Ê∏ÖÁêÜËøáÊúüÁºìÂ≠ò\n   */\n  cleanup() {\n    const now = Date.now();\n    const expiredKeys = [];\n\n    for (const [key, expiresAt] of this.ttlMap.entries()) {\n      if (now > expiresAt) {\n        expiredKeys.push(key);\n      }\n    }\n\n    expiredKeys.forEach((key) => this.delete(key));\n\n    if (expiredKeys.length > 0) {\n      logger.info(`Ê∏ÖÁêÜ‰∫Ü ${expiredKeys.length} ‰∏™ËøáÊúüÁºìÂ≠òÈ°π`);\n    }\n  }\n\n  /**\n   * ÁîüÊàêÁºìÂ≠òÈîÆ\n   * @param {string} prefix - ÂâçÁºÄ\n   * @param {object} params - ÂèÇÊï∞ÂØπË±°\n   * @returns {string} ÁºìÂ≠òÈîÆ\n   */\n  generateKey(prefix, params = {}) {\n    const sortedParams = Object.keys(params)\n      .sort()\n      .map((key) => `${key}:${params[key]}`)\n      .join('|');\n\n    return `${prefix}:${sortedParams}`;\n  }\n}\n\n// ÂàõÂª∫ÂÖ®Â±ÄÁºìÂ≠òÂÆû‰æã\nconst cache = new MemoryCache();\n\n/**\n * ÁºìÂ≠ò‰∏≠Èó¥‰ª∂Â∑•ÂéÇÂáΩÊï∞\n * @param {number} ttl - ÁºìÂ≠òËøáÊúüÊó∂Èó¥ÔºàÊØ´ÁßíÔºâ\n * @param {function} keyGenerator - ÁºìÂ≠òÈîÆÁîüÊàêÂáΩÊï∞\n * @returns {function} Express‰∏≠Èó¥‰ª∂\n */\nexport function createCacheMiddleware(ttl = TIME_INTERVALS.FIVE_MINUTES_MS, keyGenerator = null) {\n  return (req, res, next) => {\n    // Âè™ÁºìÂ≠òGETËØ∑Ê±Ç\n    if (req.method !== 'GET') {\n      return next();\n    }\n\n    // ÁîüÊàêÁºìÂ≠òÈîÆ\n    const cacheKey = keyGenerator ? keyGenerator(req) : cache.generateKey(req.path, req.query);\n\n    // Â∞ùËØï‰ªéÁºìÂ≠òËé∑ÂèñÊï∞ÊçÆ\n    const cachedData = cache.get(cacheKey);\n    if (cachedData) {\n      logger.debug(`ÁºìÂ≠òÂëΩ‰∏≠: ${cacheKey}`);\n      // ËÆæÁΩÆÁºìÂ≠òÂëΩ‰∏≠Â§¥‰ø°ÊÅØ\n      res.setHeader('X-Cache-Hit', 'true');\n      res.setHeader('X-Cache-Key', cacheKey);\n      return res.json(cachedData);\n    }\n\n    // ËÆæÁΩÆÁºìÂ≠òÊú™ÂëΩ‰∏≠Â§¥‰ø°ÊÅØ\n    res.setHeader('X-Cache-Hit', 'false');\n    res.setHeader('X-Cache-Key', cacheKey);\n\n    // ÈáçÂÜôres.jsonÊñπÊ≥ï‰ª•ÁºìÂ≠òÂìçÂ∫î\n    const originalJson = res.json;\n    res.json = function (data) {\n      // Âè™ÁºìÂ≠òÊàêÂäüÁöÑÂìçÂ∫î\n      if (res.statusCode === 200) {\n        cache.set(cacheKey, data, ttl);\n        logger.debug(`ÁºìÂ≠òÂ≠òÂÇ®: ${cacheKey}`);\n      }\n      return originalJson.call(this, data);\n    };\n\n    next();\n  };\n}\n\n/**\n * Ê∏ÖÈô§ÁâπÂÆöÂâçÁºÄÁöÑÁºìÂ≠ò\n * @param {string} prefix - ÁºìÂ≠òÈîÆÂâçÁºÄ\n */\nexport function clearCacheByPrefix(prefix) {\n  const stats = cache.getStats();\n  const keysToDelete = stats.keys.filter((key) => key.startsWith(prefix));\n\n  keysToDelete.forEach((key) => cache.delete(key));\n\n  logger.info(`Ê∏ÖÈô§‰∫Ü ${keysToDelete.length} ‰∏™ÂâçÁºÄ‰∏∫ \"${prefix}\" ÁöÑÁºìÂ≠òÈ°π`);\n}\n\n/**\n * È¢ÑÁÉ≠ÁºìÂ≠òÂáΩÊï∞\n * @param {string} key - ÁºìÂ≠òÈîÆ\n * @param {function} dataLoader - Êï∞ÊçÆÂä†ËΩΩÂáΩÊï∞\n * @param {number} ttl - ËøáÊúüÊó∂Èó¥\n */\nexport async function warmupCache(key, dataLoader, ttl = TIME_INTERVALS.FIVE_MINUTES_MS) {\n  try {\n    const data = await dataLoader();\n    cache.set(key, data, ttl);\n    logger.info(`È¢ÑÁÉ≠ÁºìÂ≠ò: ${key}`);\n  } catch (error) {\n    logger.error(`È¢ÑÁÉ≠ÁºìÂ≠òÂ§±Ë¥•: ${key}`, { error: error.message, stack: error.stack });\n  }\n}\n\nexport { cache };\nexport default cache;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/shared/utils/inputValidator.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/shared/utils/inputValidatorConstants.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/shared/utils/logger.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/shared/utils/schemaValidator.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/xunan/Documents/WebStormProjects/0C/src/shared/utils/testHelpers.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]}]